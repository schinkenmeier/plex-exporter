{
  "version": 3,
  "sources": ["../js/state.js", "../js/dom.js", "../js/cache.js", "../js/data.js", "../js/utils.js", "../js/watchlist.js", "../js/modal/seasonsAccordion.js", "../js/modal/shared.js", "../js/modalV2.js", "../js/grid.js", "../js/filter.js", "../js/services/tmdb.js", "../js/main.js", "../js/loader.js", "../js/debug.js", "../js/errorHandler.js"],
  "sourcesContent": ["const S = { view: 'movies', movies: [], shows: [], facets: {}, filtered: [], cfg: {} };\nconst listeners = new Set();\n\nexport const getState = () => S;\nexport function setState(patch){ Object.assign(S, patch); listeners.forEach(fn=>fn(S)); }\nexport function subscribe(fn){ listeners.add(fn); return ()=>listeners.delete(fn); }\n", "export const qs  = (s, r=document) => r.querySelector(s);\nexport const qsa = (s, r=document) => [...r.querySelectorAll(s)];\nexport function el(tag, cls, content){\n  const n=document.createElement(tag);\n  if(cls) n.className=cls;\n  if(content!=null) n.textContent = content;\n  return n;\n}\n\n", "/**\r\n * Enhanced Caching System with TTL and Storage Management\r\n */\r\n\r\nconst CACHE_PREFIX = 'plex_cache_';\r\nconst DEFAULT_TTL = 1000 * 60 * 60 * 24; // 24 hours\r\nconst MAX_CACHE_SIZE = 5 * 1024 * 1024; // 5MB\r\n\r\n/**\r\n * Set an item in cache with TTL\r\n * @param {string} key - Cache key\r\n * @param {any} value - Value to cache\r\n * @param {number} ttl - Time to live in milliseconds\r\n */\r\nexport function setCache(key, value, ttl = DEFAULT_TTL) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    const item = {\r\n      value,\r\n      timestamp: Date.now(),\r\n      ttl\r\n    };\r\n    localStorage.setItem(cacheKey, JSON.stringify(item));\r\n\r\n    // Check if we're approaching storage limits\r\n    checkCacheSize();\r\n  } catch (error) {\r\n    if (error.name === 'QuotaExceededError') {\r\n      console.warn('[cache] Storage quota exceeded, cleaning old entries');\r\n      cleanOldestEntries();\r\n      // Try again after cleanup\r\n      try {\r\n        const cacheKey = CACHE_PREFIX + key;\r\n        const item = { value, timestamp: Date.now(), ttl };\r\n        localStorage.setItem(cacheKey, JSON.stringify(item));\r\n      } catch (retryError) {\r\n        console.error('[cache] Failed to cache after cleanup:', retryError);\r\n      }\r\n    } else {\r\n      console.error('[cache] Failed to set cache:', error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get an item from cache\r\n * @param {string} key - Cache key\r\n * @returns {any|null} Cached value or null if expired/not found\r\n */\r\nexport function getCache(key) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    const cached = localStorage.getItem(cacheKey);\r\n\r\n    if (!cached) return null;\r\n\r\n    const item = JSON.parse(cached);\r\n    const now = Date.now();\r\n\r\n    // Check if expired\r\n    if (item.timestamp + item.ttl < now) {\r\n      localStorage.removeItem(cacheKey);\r\n      return null;\r\n    }\r\n\r\n    return item.value;\r\n  } catch (error) {\r\n    console.error('[cache] Failed to get cache:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove an item from cache\r\n * @param {string} key - Cache key\r\n */\r\nexport function removeCache(key) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    localStorage.removeItem(cacheKey);\r\n  } catch (error) {\r\n    console.error('[cache] Failed to remove cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all cache entries\r\n */\r\nexport function clearAllCache() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n    console.log('[cache] All cache cleared');\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clear cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear expired cache entries\r\n */\r\nexport function clearExpiredCache() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const now = Date.now();\r\n    let cleared = 0;\r\n\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        try {\r\n          const item = JSON.parse(localStorage.getItem(key));\r\n          if (item.timestamp + item.ttl < now) {\r\n            localStorage.removeItem(key);\r\n            cleared++;\r\n          }\r\n        } catch (e) {\r\n          // Invalid cache entry, remove it\r\n          localStorage.removeItem(key);\r\n          cleared++;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (cleared > 0) {\r\n      console.log(`[cache] Cleared ${cleared} expired entries`);\r\n    }\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clear expired cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nexport function getCacheStats() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const cacheKeys = keys.filter(k => k.startsWith(CACHE_PREFIX));\r\n    const now = Date.now();\r\n\r\n    let totalSize = 0;\r\n    let validEntries = 0;\r\n    let expiredEntries = 0;\r\n\r\n    cacheKeys.forEach(key => {\r\n      const value = localStorage.getItem(key);\r\n      totalSize += value.length * 2; // Approximate size in bytes (UTF-16)\r\n\r\n      try {\r\n        const item = JSON.parse(value);\r\n        if (item.timestamp + item.ttl >= now) {\r\n          validEntries++;\r\n        } else {\r\n          expiredEntries++;\r\n        }\r\n      } catch (e) {\r\n        expiredEntries++;\r\n      }\r\n    });\r\n\r\n    return {\r\n      totalEntries: cacheKeys.length,\r\n      validEntries,\r\n      expiredEntries,\r\n      totalSize,\r\n      totalSizeMB: (totalSize / 1024 / 1024).toFixed(2)\r\n    };\r\n  } catch (error) {\r\n    console.error('[cache] Failed to get cache stats:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Check cache size and clean if necessary\r\n */\r\nfunction checkCacheSize() {\r\n  try {\r\n    const stats = getCacheStats();\r\n    if (stats && stats.totalSize > MAX_CACHE_SIZE) {\r\n      console.warn('[cache] Cache size exceeded limit, cleaning...');\r\n      cleanOldestEntries(0.3); // Remove 30% of entries\r\n    }\r\n  } catch (error) {\r\n    console.error('[cache] Failed to check cache size:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clean oldest cache entries\r\n * @param {number} percentage - Percentage of entries to remove (0-1)\r\n */\r\nfunction cleanOldestEntries(percentage = 0.3) {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const cacheEntries = [];\r\n\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        try {\r\n          const item = JSON.parse(localStorage.getItem(key));\r\n          cacheEntries.push({ key, timestamp: item.timestamp });\r\n        } catch (e) {\r\n          // Invalid entry, mark for removal\r\n          cacheEntries.push({ key, timestamp: 0 });\r\n        }\r\n      }\r\n    });\r\n\r\n    // Sort by timestamp (oldest first)\r\n    cacheEntries.sort((a, b) => a.timestamp - b.timestamp);\r\n\r\n    // Remove oldest percentage\r\n    const toRemove = Math.ceil(cacheEntries.length * percentage);\r\n    for (let i = 0; i < toRemove; i++) {\r\n      localStorage.removeItem(cacheEntries[i].key);\r\n    }\r\n\r\n    console.log(`[cache] Removed ${toRemove} oldest entries`);\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clean oldest entries:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Cached fetch wrapper\r\n * @param {string} url - URL to fetch\r\n * @param {object} options - Fetch options\r\n * @param {number} ttl - Cache TTL in milliseconds\r\n */\r\nexport async function cachedFetch(url, options = {}, ttl = DEFAULT_TTL) {\r\n  const cacheKey = `fetch_${url}`;\r\n\r\n  // Try to get from cache first\r\n  const cached = getCache(cacheKey);\r\n  if (cached !== null) {\r\n    return cached;\r\n  }\r\n\r\n  // Fetch and cache\r\n  try {\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    setCache(cacheKey, data, ttl);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`[cache] Fetch failed for ${url}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Auto-cleanup on page load (only in real browser environments)\r\nlet cleanupInterval = null;\r\n\r\nif (typeof window !== 'undefined' && typeof window.document !== 'undefined' && window === globalThis) {\r\n  // Clear expired entries on load\r\n  clearExpiredCache();\r\n\r\n  // Periodic cleanup every 5 minutes\r\n  cleanupInterval = setInterval(clearExpiredCache, 5 * 60 * 1000);\r\n}\r\n\r\n/**\r\n * Stop the periodic cleanup interval (useful for testing)\r\n */\r\nexport function stopCleanupInterval() {\r\n  if (cleanupInterval) {\r\n    clearInterval(cleanupInterval);\r\n    cleanupInterval = null;\r\n  }\r\n}\r\n", "import { getCache, setCache } from './cache.js';\r\n\r\nlet lastSources = { movies: null, shows: null };\r\nconst showDetailCache = new Map();\r\nlet loadRetryCount = { movies: 0, shows: 0 };\r\nconst MAX_RETRIES = 3;\r\nconst DATA_CACHE_TTL = 1000 * 60 * 30; // 30 minutes for data files\r\n\r\nconst MOVIE_THUMB_BASE = 'data/movies/';\r\nconst SHOW_THUMB_BASE = 'data/series/';\r\nconst SCHEME_RE = /^[a-z][a-z0-9+.-]*:/i;\r\n\r\nasync function fetchJson(url, retries = 2, useCache = true){\r\n  // Try cache first if enabled\r\n  if(useCache){\r\n    const cached = getCache(url);\r\n    if(cached !== null) {\r\n      console.log(`[data] Cache hit for ${url}`);\r\n      return cached;\r\n    }\r\n  }\r\n\r\n  let lastError = null;\r\n  for(let attempt = 0; attempt <= retries; attempt++){\r\n    try{\r\n      const r = await fetch(url, { cache:'no-store' });\r\n      if(r && r.ok) {\r\n        const data = await r.json();\r\n        // Cache successful responses\r\n        if(useCache && data) {\r\n          setCache(url, data, DATA_CACHE_TTL);\r\n        }\r\n        return data;\r\n      }\r\n      if(r && r.status === 404) return null; // Don't retry 404s\r\n      lastError = new Error(`HTTP ${r.status}: ${r.statusText}`);\r\n    }\r\n    catch(err){\r\n      lastError = err;\r\n      console.warn(`[data] Fetch attempt ${attempt + 1}/${retries + 1} failed for ${url}:`, err.message);\r\n    }\r\n    if(attempt < retries){\r\n      // Exponential backoff\r\n      const delay = Math.min(1000 * Math.pow(2, attempt), 5000);\r\n      await new Promise(resolve => setTimeout(resolve, delay));\r\n    }\r\n  }\r\n  if(lastError){\r\n    console.error(`[data] All fetch attempts failed for ${url}:`, lastError.message);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction embeddedJsonById(id){\r\n  try{\r\n    const n = document.getElementById(id);\r\n    if(n && n.textContent) return JSON.parse(n.textContent);\r\n  }\r\n  catch(err){\r\n    console.warn(`[data] Failed to parse embedded JSON #${id}:`, err.message);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction fromGlobalBag(key){\r\n  try{\r\n    const bag = window.__PLEX_EXPORTER__;\r\n    const arr = bag && Array.isArray(bag[key]) ? bag[key] : null;\r\n    return arr || null;\r\n  }\r\n  catch(err){\r\n    console.warn(`[data] Failed to access global bag[${key}]:`, err.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction fromWindow(varName){\r\n  try{\r\n    const arr = Array.isArray(window[varName]) ? window[varName] : null;\r\n    return arr || null;\r\n  }\r\n  catch(err){\r\n    console.warn(`[data] Failed to access window.${varName}:`, err.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function loadWithCompat(primaryUrl, opts){\r\n  // default: try site/data first\r\n  let data = await fetchJson(primaryUrl);\r\n  if(Array.isArray(data) && data.length){ markSource(opts?.label, `primary:${primaryUrl}`); return data; }\r\n  // fallback: embedded <script id=\"...\"> JSON\r\n  if(opts?.embedId){ const emb = embeddedJsonById(opts.embedId); if(Array.isArray(emb) && emb.length){ markSource(opts?.label, `embedded:${opts.embedId}`); return emb; } }\r\n  // fallback: global exporter bag\r\n  if(opts?.exportKey){ const bag = fromGlobalBag(opts.exportKey); if(Array.isArray(bag) && bag.length){ markSource(opts?.label, `globalBag:${opts.exportKey}`); return bag; } }\r\n  // fallback: window variable\r\n  if(opts?.globalVar){ const win = fromWindow(opts.globalVar); if(Array.isArray(win) && win.length){ markSource(opts?.label, `window:${opts.globalVar}`); return win; } }\r\n  // alt paths (legacy)\r\n  for(const alt of (opts?.altUrls||[])){\r\n    const j = await fetchJson(alt); if(Array.isArray(j) && j.length){ markSource(opts?.label, `alt:${alt}`); return j; }\r\n  }\r\n  // last resort: empty array\r\n  markSource(opts?.label, 'empty');\r\n  return Array.isArray(data) ? data : [];\r\n}\r\n\r\nexport function prefixThumbValue(value, base){\r\n  const raw = value == null ? '' : String(value).trim();\r\n  if(!raw) return '';\r\n  if(raw.startsWith('//') || raw.startsWith('/') || SCHEME_RE.test(raw)) return raw;\r\n  const normalizedRaw = raw.replace(/\\\\/g, '/');\r\n  const normalizedBase = base ? (base.endsWith('/') ? base : `${base}/`) : '';\r\n  const encodePath = path => path.split('/').map(segment => {\r\n    if(!segment) return '';\r\n    try{\r\n      return encodeURIComponent(decodeURIComponent(segment));\r\n    }catch{\r\n      return encodeURIComponent(segment);\r\n    }\r\n  }).join('/');\r\n  const trimmed = normalizedRaw.replace(/^\\/+/, '');\r\n  const segments = trimmed.split('/');\r\n  const normalizedSegments = [];\r\n  for(const segment of segments){\r\n    if(!segment || segment === '.') continue;\r\n    if(segment === '..'){\r\n      if(normalizedSegments.length) normalizedSegments.pop();\r\n      continue;\r\n    }\r\n    normalizedSegments.push(segment);\r\n  }\r\n  const normalizedPath = normalizedSegments.join('/');\r\n  if(normalizedPath.startsWith('data/')) return encodePath(normalizedPath);\r\n  let relativeSegments = normalizedSegments;\r\n  if(normalizedBase && relativeSegments.length){\r\n    const baseDir = normalizedBase.replace(/\\/+$/, '').split('/').pop();\r\n    if(baseDir && relativeSegments[0] === baseDir){\r\n      relativeSegments = relativeSegments.slice(1);\r\n    }\r\n  }\r\n  const cleaned = relativeSegments.join('/');\r\n  const encoded = encodePath(cleaned);\r\n  return `${normalizedBase}${encoded}`;\r\n}\r\n\r\n\r\nexport function prefixThumb(obj, base){\r\n  if(!obj || typeof obj !== 'object') return obj;\r\n  const current = obj.thumbFile ?? obj.thumb ?? '';\r\n  const prefixed = prefixThumbValue(current, base);\r\n  if(prefixed){\r\n    obj.thumbFile = prefixed;\r\n    obj.thumb = prefixed;\r\n  }else if(current){\r\n    const str = String(current);\r\n    obj.thumbFile = str;\r\n    if(obj.thumb == null) obj.thumb = str;\r\n  }\r\n  return obj;\r\n}\r\n\r\nexport function prefixMovieThumb(obj){\r\n  return prefixThumb(obj, MOVIE_THUMB_BASE);\r\n}\r\n\r\nexport function prefixShowThumb(obj){\r\n  return prefixThumb(obj, SHOW_THUMB_BASE);\r\n}\r\n\r\nexport function prefixShowTree(show){\r\n  if(!show || typeof show !== 'object') return show;\r\n  prefixShowThumb(show);\r\n  if(Array.isArray(show.seasons)) show.seasons.forEach(prefixSeasonTree);\r\n  return show;\r\n}\r\n\r\nfunction prefixSeasonTree(season){\r\n  if(!season || typeof season !== 'object') return season;\r\n  prefixShowThumb(season);\r\n  if(Array.isArray(season.episodes)) season.episodes.forEach(ep=>prefixShowThumb(ep));\r\n  return season;\r\n}\r\n\r\nfunction normalizeMovieThumbs(list){\r\n  if(!Array.isArray(list)) return [];\r\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixMovieThumb(item); });\r\n  return list;\r\n}\r\n\r\nfunction normalizeShowThumbs(list){\r\n  if(!Array.isArray(list)) return [];\r\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixShowTree(item); });\r\n  return list;\r\n}\r\n\r\nexport async function loadMovies(){\r\n  try {\r\n    const movies = await loadWithCompat('data/movies/movies.json', {\r\n      label: 'movies',\r\n      embedId: 'movies-json',\r\n      exportKey: 'movies',\r\n      globalVar: '__PLEX_MOVIES__',\r\n      altUrls: [\r\n        'movies/movies.json',\r\n        'data/movies.json',\r\n        'Filme/movies.json',\r\n        'movies.json',\r\n      ],\r\n    });\r\n    loadRetryCount.movies = 0; // Reset on success\r\n    return normalizeMovieThumbs(movies);\r\n  } catch (error) {\r\n    console.error('[data] loadMovies failed:', error);\r\n    if (loadRetryCount.movies < MAX_RETRIES) {\r\n      loadRetryCount.movies++;\r\n      console.log(`[data] Retrying loadMovies (${loadRetryCount.movies}/${MAX_RETRIES})...`);\r\n      await new Promise(resolve => setTimeout(resolve, 1000 * loadRetryCount.movies));\r\n      return loadMovies();\r\n    }\r\n    throw error;\r\n  }\r\n}\r\nexport async function loadShows(){\r\n  try {\r\n    const shows = await loadWithCompat('data/series/series_index.json', {\r\n      label: 'shows',\r\n      embedId: 'series-json',\r\n      exportKey: 'shows',\r\n      globalVar: '__PLEX_SHOWS__',\r\n      altUrls: [\r\n        'series/series_index.json',\r\n        'data/shows.json',\r\n        'data/series.json',\r\n        'Serien/series.json',\r\n        'series/series.json',\r\n        'series.json',\r\n        'shows.json',\r\n      ],\r\n    });\r\n    loadRetryCount.shows = 0; // Reset on success\r\n    return normalizeShowThumbs(shows);\r\n  } catch (error) {\r\n    console.error('[data] loadShows failed:', error);\r\n    if (loadRetryCount.shows < MAX_RETRIES) {\r\n      loadRetryCount.shows++;\r\n      console.log(`[data] Retrying loadShows (${loadRetryCount.shows}/${MAX_RETRIES})...`);\r\n      await new Promise(resolve => setTimeout(resolve, 1000 * loadRetryCount.shows));\r\n      return loadShows();\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function loadShowDetail(item){\r\n  if(!item) return null;\r\n  const keys = cacheKeys(item);\r\n  const cached = getCachedDetail(keys);\r\n  if(cached !== undefined) return cached;\r\n\r\n  const urls = detailUrlCandidates(item);\r\n  let lastError = null;\r\n\r\n  for(const url of urls){\r\n    try {\r\n      const data = await fetchJson(url);\r\n      if(data && typeof data === 'object'){\r\n        const normalized = normalizeShowDetail(data);\r\n        storeDetail(keys, normalized, item);\r\n        return cloneDetail(normalized);\r\n      }\r\n    } catch (error) {\r\n      lastError = error;\r\n      console.warn(`[data] Failed to load show detail from ${url}:`, error.message);\r\n    }\r\n  }\r\n\r\n  if(lastError) {\r\n    console.error(`[data] Could not load show detail for ${item.title || 'unknown'}`, lastError);\r\n  }\r\n\r\n  storeDetail(keys, null, item);\r\n  return null;\r\n}\r\n\r\nfunction markSource(label, src){\r\n  if(!label) return;\r\n  try{ lastSources[label] = src; }catch{}\r\n}\r\n\r\nexport function getSources(){ return { ...lastSources }; }\r\nexport function buildFacets(movies, shows){\r\n  // kept for compatibility; filter.js provides a richer computeFacets\r\n  const genres = new Set();\r\n  const years = new Set();\r\n  (movies||[]).concat(shows||[]).forEach(x=>{\r\n    (x.genres||[]).forEach(g=>{ if(g&&g.tag) genres.add(g.tag); });\r\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\r\n    if(y) years.add(Number(y));\r\n  });\r\n  return { genres:[...genres].sort(), years:[...years].sort((a,b)=>a-b), collections: [] };\r\n}\r\n\r\nfunction cacheKeys(item){\r\n  const keys = [];\r\n  if(item?.ratingKey !== undefined && item?.ratingKey !== null && item?.ratingKey !== ''){\r\n    keys.push(`rk:${String(item.ratingKey)}`);\r\n  }\r\n  const href = normalizeHrefKey(item?.href);\r\n  if(href) keys.push(`href:${href}`);\r\n  return keys;\r\n}\r\n\r\nfunction normalizeHrefKey(href){\r\n  if(!href) return '';\r\n  return String(href).trim().replace(/^\\.\\//,'').replace(/^\\/+/, '');\r\n}\r\n\r\nfunction getCachedDetail(keys){\r\n  for(const key of keys){\r\n    if(showDetailCache.has(key)){\r\n      const cached = showDetailCache.get(key);\r\n      return cached ? cloneDetail(cached) : null;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction storeDetail(keys, value, item){\r\n  const val = value;\r\n  keys.forEach(key=>{ showDetailCache.set(key, val); });\r\n  const rk = item?.ratingKey;\r\n  if(rk !== undefined && rk !== null){\r\n    showDetailCache.set(`rk:${String(rk)}`, val);\r\n  }\r\n  const detailKey = value && typeof value === 'object' ? value.ratingKey : undefined;\r\n  if(detailKey !== undefined && detailKey !== null){\r\n    showDetailCache.set(`rk:${String(detailKey)}`, val);\r\n  }\r\n  const href = normalizeHrefKey(item?.href);\r\n  if(href){\r\n    showDetailCache.set(`href:${href}`, val);\r\n  }\r\n  const detailHref = value && typeof value === 'object' ? normalizeHrefKey(value.href) : '';\r\n  if(detailHref){\r\n    showDetailCache.set(`href:${detailHref}`, val);\r\n  }\r\n}\r\n\r\nfunction detailUrlCandidates(item){\r\n  const urls = new Set();\r\n  const hrefKey = normalizeHrefKey(item?.href);\r\n  if(hrefKey){\r\n    if(/^https?:/i.test(hrefKey)){ urls.add(hrefKey); }\r\n    else{\r\n      if(hrefKey.startsWith('data/')) urls.add(hrefKey);\r\n      else urls.add(`data/${hrefKey}`);\r\n      const withoutData = hrefKey.replace(/^data\\//,'');\r\n      if(!withoutData.startsWith('series/')) urls.add(`data/series/${withoutData}`);\r\n      const idPart = withoutData.replace(/^series\\//,'').replace(/^details\\//,'').replace(/\\.json$/,'');\r\n      if(idPart) urls.add(`data/series/details/${idPart}.json`);\r\n    }\r\n  }\r\n  const rk = item?.ratingKey;\r\n  if(rk !== undefined && rk !== null){\r\n    urls.add(`data/series/details/${String(rk)}.json`);\r\n  }\r\n  return Array.from(urls);\r\n}\r\n\r\nfunction normalizeShowDetail(data){\r\n  if(!data || typeof data !== 'object') return null;\r\n  const show = { ...data };\r\n  prefixShowThumb(show);\r\n  show.genres = normalizeGenres(show.genres);\r\n  const castList = normalizePeople(show.cast || show.roles || []);\r\n  show.cast = castList;\r\n  show.roles = castList;\r\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeason).filter(Boolean) : [];\r\n  show.seasonCount = Number.isFinite(show.seasonCount) ? show.seasonCount : show.seasons.length;\r\n  prefixShowTree(show);\r\n  return show;\r\n}\r\n\r\nfunction normalizeSeason(season){\r\n  if(!season || typeof season !== 'object') return null;\r\n  const out = { ...season };\r\n  prefixShowThumb(out);\r\n  out.genres = normalizeGenres(out.genres);\r\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisode).filter(Boolean) : [];\r\n  prefixSeasonTree(out);\r\n  return out;\r\n}\r\n\r\nfunction normalizeEpisode(ep){\r\n  if(!ep || typeof ep !== 'object') return null;\r\n  const out = { ...ep };\r\n  prefixShowThumb(out);\r\n  out.genres = normalizeGenres(out.genres);\r\n  return out;\r\n}\r\n\r\nfunction normalizeGenres(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const seen = new Set();\r\n  const result = [];\r\n  list.forEach(entry=>{\r\n    let obj = null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      if(tag) obj = { tag };\r\n    }else if(entry && typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\r\n      if(tag){ obj = { ...entry, tag }; }\r\n    }\r\n    if(obj && !seen.has(obj.tag)){\r\n      seen.add(obj.tag);\r\n      result.push(obj);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nfunction normalizePeople(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry=>{\r\n    if(!entry) return null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      return tag ? { tag } : null;\r\n    }\r\n    if(typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\r\n      if(tag){ return { ...entry, tag }; }\r\n      return { ...entry };\r\n    }\r\n    return null;\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction cloneDetail(detail){\r\n  if(detail === null || detail === undefined) return detail;\r\n  try{ return structuredClone(detail); }catch{}\r\n  try{ return JSON.parse(JSON.stringify(detail)); }catch{}\r\n  return detail;\r\n}\r\n", "import { getState } from './state.js';\r\n\r\nexport function getGenreNames(genres){\r\n  const seen = new Set();\r\n  const names = [];\r\n  (genres || []).forEach(entry=>{\r\n    let name = '';\r\n    if(typeof entry === 'string'){\r\n      name = entry;\r\n    }else if(entry && typeof entry === 'object'){\r\n      name = entry.tag || entry.title || entry.name || '';\r\n    }\r\n    const str = String(name || '').trim();\r\n    if(str && !seen.has(str)){\r\n      seen.add(str);\r\n      names.push(str);\r\n    }\r\n  });\r\n  return names;\r\n}\r\n\r\nexport function renderChipsLimited(container, values, limit=3){\r\n  if(!container) return;\r\n  const vals = (values||[]).filter(Boolean);\r\n\r\n  // If we have more values than the limit, show limit chips + aggregator\r\n  if(vals.length > limit){\r\n    const head = vals.slice(0, limit);\r\n    const rest = vals.slice(limit);\r\n    const chips = head.map(text=>chip(text));\r\n\r\n    const more = chip(`+ ${rest.length}`);\r\n    more.classList.add('more', 'card__chip--more');\r\n    more.setAttribute('data-more', rest.length);\r\n    more.setAttribute('title', `${rest.length} weitere Genres: ${rest.join(', ')}`);\r\n    // store extra chips to reveal on click\r\n    more._extraChips = rest.map(text=>chip(text));\r\n    chips.push(more);\r\n\r\n    container.replaceChildren(...chips);\r\n  } else {\r\n    // Show all chips if we have limit or fewer\r\n    const chips = vals.map(text=>chip(text));\r\n    container.replaceChildren(...chips);\r\n  }\r\n\r\n  enableMoreChipBehavior(container);\r\n}\r\n\r\nexport function enableMoreChipBehavior(root = document){\r\n  try{\r\n    root.querySelectorAll('.chip.more, .card__chip--more').forEach(btn=>{\r\n      if(btn.dataset.bound) return;\r\n      btn.dataset.bound = '1';\r\n      btn.addEventListener('click', (e)=>{\r\n        // Stop propagation to prevent card click from opening modal\r\n        e.stopPropagation();\r\n\r\n        // Find the parent card element\r\n        const card = btn.closest('.card');\r\n        if(card) {\r\n          // Trigger the card's click event to open the modal\r\n          card.click();\r\n        } else {\r\n          // Fallback: expand inline if not in a card context\r\n          const hidden = btn._extraChips || [];\r\n          try{ hidden.forEach(ch => btn.before(ch)); }catch{}\r\n          btn.remove();\r\n        }\r\n      });\r\n    });\r\n  }catch{}\r\n}\r\n\r\nexport function humanYear(item){\r\n  if(item?.year) return item.year;\r\n  if(item?.originallyAvailableAt) return String(item.originallyAvailableAt).slice(0,4);\r\n  return '';\r\n}\r\n\r\nexport function formatRating(val){\r\n  if(val instanceof Number){\r\n    return formatRating(val.valueOf());\r\n  }\r\n\r\n  if(typeof val === 'number'){\r\n    return Number.isFinite(val) ? val.toFixed(1) : '0.0';\r\n  }\r\n\r\n  if(typeof val === 'string'){\r\n    const trimmed = val.trim();\r\n    if(!trimmed) return '0.0';\r\n    const num = Number(trimmed);\r\n    return Number.isFinite(num) ? num.toFixed(1) : '0.0';\r\n  }\r\n\r\n  return '0.0';\r\n}\r\n\r\nfunction chip(text){ const s=document.createElement('span'); s.className='chip'; s.textContent=String(text||''); return s; }\r\n\r\nexport function isNew(item){\r\n  if(!item?.addedAt) return false;\r\n  const added = new Date(item.addedAt).getTime();\r\n  if(!Number.isFinite(added)) return false;\r\n  const cfg = getState().cfg || {};\r\n  const days = Number(cfg.newDays || 30);\r\n  return Date.now() - added <= days * 24*60*60*1000;\r\n}\r\n\r\nexport function useTmdbOn(){ try{ return localStorage.getItem('useTmdb')==='1'; }catch{ return false; } }\r\n", "import { getState } from './state.js';\r\n\r\nconst STORAGE_KEY = 'watchlist:v1';\r\nlet saved = new Set();\r\n\r\nfunction load(){\r\n  try{ saved = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')); }catch{ saved = new Set(); }\r\n}\r\nfunction persist(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(saved.values()))); }catch{} }\r\n\r\nfunction idFor(item){\r\n  if(!item) return '';\r\n  const kind = (item.type==='tv' || item.libraryType==='show') ? 'show' : 'movie';\r\n  const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\r\n  return id ? `${kind}:${id}` : '';\r\n}\r\n\r\nexport function isSaved(item){ return saved.has(idFor(item)); }\r\nexport function count(){ return saved.size; }\r\nexport function toggle(item){\r\n  const k=idFor(item);\r\n  if(!k) return;\r\n  if(saved.has(k)) saved.delete(k); else saved.add(k);\r\n  persist();\r\n  renderCount();\r\n  const panel=document.getElementById('watchlistPanel');\r\n  if(panel && !panel.hidden) renderPanel();\r\n}\r\n\r\nexport function renderCount(){ const el=document.getElementById('watchlistCount'); if(el) el.textContent = String(count()); }\r\n\r\nexport function openPanel(){\r\n  const p=document.getElementById('watchlistPanel');\r\n  if(p) {\r\n    p.hidden=false;\r\n    p.setAttribute('aria-hidden','false');\r\n    renderPanel();\r\n    // Dispatch event for filter bar auto-hide\r\n    document.dispatchEvent(new CustomEvent('watchlist:open'));\r\n  }\r\n}\r\n\r\nexport function closePanel(){\r\n  const p=document.getElementById('watchlistPanel');\r\n  if(p){\r\n    p.hidden=true;\r\n    p.setAttribute('aria-hidden','true');\r\n    // Dispatch event for filter bar auto-hide\r\n    document.dispatchEvent(new CustomEvent('watchlist:close'));\r\n  }\r\n  setExpanded(false);\r\n}\r\n\r\nexport function clear(){ saved.clear(); persist(); renderCount(); renderPanel(); }\r\n\r\nexport function exportJson(){\r\n  const items = listItems();\r\n  const data = JSON.stringify(items, null, 2);\r\n  const blob = new Blob([data], { type:'application/json' });\r\n  const a = document.createElement('a');\r\n  a.href = URL.createObjectURL(blob);\r\n  a.download = 'watchlist.json';\r\n  document.body.append(a); a.click(); a.remove();\r\n  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);\r\n}\r\n\r\nfunction listItems(){\r\n  const s = getState();\r\n  const pool = (s.movies||[]).concat(s.shows||[]);\r\n  const map = new Map(pool.map(it=>[idFor(it), it]));\r\n  return Array.from(saved.values()).map(k=>map.get(k)).filter(Boolean);\r\n}\r\n\r\nexport function renderPanel(){\r\n  const list = document.getElementById('watchlistItems');\r\n  const empty = document.getElementById('watchlistEmpty');\r\n  if(!list || !empty) return;\r\n  const items = listItems();\r\n  if(items.length===0){ list.replaceChildren(); empty.hidden=false; return; }\r\n  empty.hidden=true;\r\n  const frag = document.createDocumentFragment();\r\n  items.forEach(item=>{\r\n    const li = document.createElement('li');\r\n    li.className = 'watchlist-item';\r\n    const t = document.createElement('span');\r\n    t.className='title';\r\n    t.textContent = item.title || '';\r\n    const rm = document.createElement('button');\r\n    rm.textContent = 'Entfernen';\r\n    rm.addEventListener('click', ()=>{ toggle(item); renderPanel(); });\r\n    const open = document.createElement('button');\r\n    open.textContent = '\u00D6ffnen';\r\n    open.addEventListener('click', ()=>{\r\n      const kind = (item.type==='tv') ? 'show' : 'movie';\r\n      const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\r\n      if(id) location.hash = `#/${kind}/${id}`;\r\n    });\r\n    li.append(t, open, rm);\r\n    frag.append(li);\r\n  });\r\n  list.replaceChildren(frag);\r\n}\r\n\r\nexport function initUi(){\r\n  load();\r\n  renderCount();\r\n  const openBtn = document.getElementById('openWatchlist');\r\n  const toggleBtn = document.getElementById('watchlistToggle');\r\n  const closeBtn = document.getElementById('closeWatchlist');\r\n  const clearBtn = document.getElementById('clearWatchlist');\r\n  const exportBtn = document.getElementById('exportWatchlist');\r\n  openBtn && openBtn.addEventListener('click', ()=>{ openPanel(); setExpanded(true); });\r\n  toggleBtn && toggleBtn.addEventListener('click', ()=>{ const p=document.getElementById('watchlistPanel'); if(p && !p.hidden){ closePanel(); } else { openPanel(); setExpanded(true); } });\r\n  closeBtn && closeBtn.addEventListener('click', ()=>{ closePanel(); });\r\n  clearBtn && clearBtn.addEventListener('click', ()=>{ clear(); });\r\n  exportBtn && exportBtn.addEventListener('click', ()=>{ exportJson(); });\r\n}\r\n\r\nfunction setExpanded(on){ const t=document.getElementById('watchlistToggle'); if(t) t.setAttribute('aria-expanded', on?'true':'false'); }\r\n", "import { prefixShowThumb } from '../data.js';\r\n\r\nexport function renderSeasonsAccordion(targetOrSeasons, maybeSeasons){\r\n  const root = resolveTarget(targetOrSeasons, maybeSeasons);\r\n  if(!root) return;\r\n  const seasons = Array.isArray(targetOrSeasons) && !isTarget(targetOrSeasons)\r\n    ? (targetOrSeasons || [])\r\n    : (Array.isArray(maybeSeasons) ? maybeSeasons : []);\r\n  root.replaceChildren();\r\n  (seasons||[]).forEach((s, idx)=> root.append(seasonCardEl(s, idx)));\r\n}\r\n\r\nfunction isTarget(value){\r\n  return value instanceof Element || typeof value === 'string';\r\n}\r\n\r\nfunction resolveTarget(targetOrSeasons, maybeSeasons){\r\n  if(isTarget(targetOrSeasons)){\r\n    if(targetOrSeasons instanceof Element) return targetOrSeasons;\r\n    if(typeof targetOrSeasons === 'string') return document.querySelector(targetOrSeasons);\r\n  }\r\n  if(isTarget(maybeSeasons)){\r\n    if(maybeSeasons instanceof Element) return maybeSeasons;\r\n    if(typeof maybeSeasons === 'string') return document.querySelector(maybeSeasons);\r\n  }\r\n  return document.getElementById('seasonsAccordion');\r\n}\r\n\r\nfunction seasonCardEl(season, idx){\r\n  prefixShowThumb(season);\r\n  const card = document.createElement('article'); card.className='season-card';\r\n  const head = document.createElement('div'); head.className='season-head';\r\n  const th = document.createElement('div'); th.className='season-thumb';\r\n  const img = new Image(); img.loading='lazy'; img.decoding='async';\r\n  img.src = season.thumbFile || '';\r\n  img.alt = season.title || `Staffel ${season.seasonNumber||idx+1}`;\r\n  th.append(img);\r\n  const txt = document.createElement('div');\r\n  const title = document.createElement('div'); title.className='season-title'; title.textContent = season.title || `Staffel ${season.seasonNumber||idx+1}`;\r\n  const sub = document.createElement('div'); sub.className='season-sub';\r\n  const year = season.year || season.releaseYear || '';\r\n  const epCount = Array.isArray(season.episodes) ? season.episodes.length : (season.episodeCount || 0);\r\n  sub.textContent = [year, epCount ? `${epCount} Episoden` : ''].filter(Boolean).join(' \u2022 ');\r\n  txt.append(title, sub);\r\n  const chev = document.createElement('div'); chev.className='chev'; chev.textContent = '\u203A';\r\n  head.append(th, txt, chev);\r\n  const body = document.createElement('div'); body.className='season-body';\r\n  (season.episodes||[]).forEach(ep => { prefixShowThumb(ep); body.append(episodeRowEl(ep)); });\r\n  head.addEventListener('click', ()=> card.classList.toggle('open'));\r\n  card.append(head, body);\r\n  return card;\r\n}\r\n\r\nfunction episodeRowEl(ep){\r\n  const row = document.createElement('div'); row.className='episode';\r\n  const title = document.createElement('div'); title.className='ep-title';\r\n  const sNum = ep.seasonNumber != null ? Number(ep.seasonNumber) : null;\r\n  const eNum = ep.episodeNumber != null ? Number(ep.episodeNumber) : null;\r\n  const code = (ep.seasonEpisode && String(ep.seasonEpisode).toUpperCase()) || (Number.isFinite(sNum) && Number.isFinite(eNum) ? `S${String(sNum).padStart(2,'0')}E${String(eNum).padStart(2,'0')}` : '');\r\n  title.textContent = `${code ? code + ' \u2022 ' : ''}${ep.title || ''}`;\r\n  const right = document.createElement('div'); right.className='badges';\r\n  const r = Number(ep.audienceRating ?? ep.rating);\r\n  if(Number.isFinite(r)){ const b=document.createElement('span'); b.className='badge'; b.textContent = `${r.toFixed(1)}`; right.append(b); }\r\n  const meta = document.createElement('div'); meta.className='ep-meta';\r\n  const durMin = ep.durationMin || (ep.duration ? Math.round(Number(ep.duration)/60000) : null);\r\n  const durText = ep.durationHuman || (durMin ? `${durMin} min` : null);\r\n  const dateText = ep.originallyAvailableAt || ep.date || '';\r\n  meta.textContent = [durText, dateText].filter(Boolean).join(' \u2022 ');\r\n  row.append(title, right, meta);\r\n  return row;\r\n}\r\n\r\n", "import { prefixShowThumb } from '../data.js';\r\n\r\nfunction deepClone(value){\r\n  if(value == null || typeof value !== 'object') return value;\r\n  if(typeof structuredClone === 'function'){\r\n    try{ return structuredClone(value); }\r\n    catch{}\r\n  }\r\n  try{ return JSON.parse(JSON.stringify(value)); }\r\n  catch{}\r\n  if(Array.isArray(value)) return value.map(entry => deepClone(entry));\r\n  const out = {};\r\n  for(const key of Object.keys(value)){\r\n    out[key] = deepClone(value[key]);\r\n  }\r\n  return out;\r\n}\r\n\r\nexport function mapMovie(item){\r\n  if(!item || typeof item !== 'object') return null;\r\n  const clone = deepClone(item);\r\n  if(clone.type === 'show') clone.type = 'tv';\r\n  if(!clone.type) clone.type = 'movie';\r\n  return clone;\r\n}\r\n\r\nexport function mapShow(item){\r\n  if(!item || typeof item !== 'object') return null;\r\n  const clone = deepClone(item);\r\n  if(clone.type !== 'tv') clone.type = 'tv';\r\n  normalizeShow(clone);\r\n  return clone;\r\n}\r\n\r\nexport function mapDetail(detail){\r\n  if(!detail || typeof detail !== 'object') return null;\r\n  const clone = deepClone(detail);\r\n  normalizeShow(clone);\r\n  return clone;\r\n}\r\n\r\nexport function needsShowDetail(item){\r\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\r\n  const hasEpisodes = seasons.some(season => Array.isArray(season?.episodes) && season.episodes.length);\r\n  const cast = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\r\n  return !seasons.length || !hasEpisodes || !cast.length;\r\n}\r\n\r\nexport function mergeShowDetail(target, detail){\r\n  if(!target) return target;\r\n  if(detail && typeof detail === 'object'){\r\n    const mapped = mapDetail(detail);\r\n    Object.assign(target, mapped);\r\n  }\r\n  normalizeShow(target);\r\n  return target;\r\n}\r\n\r\nexport function normalizeShow(show){\r\n  if(!show || typeof show !== 'object') return;\r\n  normalizeThumbField(show);\r\n  show.genres = normalizeGenresList(show.genres);\r\n  const cast = normalizePeopleList(show.cast || show.roles || []);\r\n  show.cast = cast;\r\n  show.roles = cast;\r\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeasonEntry).filter(Boolean) : [];\r\n  const sc = Number(show.seasonCount);\r\n  show.seasonCount = Number.isFinite(sc) && sc > 0 ? sc : show.seasons.length;\r\n}\r\n\r\nfunction normalizeSeasonEntry(season){\r\n  if(!season || typeof season !== 'object') return null;\r\n  const out = { ...season };\r\n  normalizeThumbField(out);\r\n  out.genres = normalizeGenresList(out.genres);\r\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisodeEntry).filter(Boolean) : [];\r\n  return out;\r\n}\r\n\r\nfunction normalizeEpisodeEntry(ep){\r\n  if(!ep || typeof ep !== 'object') return null;\r\n  const out = { ...ep };\r\n  normalizeThumbField(out);\r\n  out.genres = normalizeGenresList(out.genres);\r\n  return out;\r\n}\r\n\r\nfunction normalizeThumbField(obj){\r\n  prefixShowThumb(obj);\r\n}\r\n\r\nexport function normalizeGenresList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const seen = new Set();\r\n  const result = [];\r\n  list.forEach(entry => {\r\n    let item = null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      if(tag) item = { tag };\r\n    }else if(entry && typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\r\n      if(tag){ item = { ...entry, tag }; }\r\n    }\r\n    if(item && !seen.has(item.tag)){\r\n      seen.add(item.tag);\r\n      result.push(item);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nexport function normalizePeopleList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry => {\r\n    if(!entry) return null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      return tag ? { tag } : null;\r\n    }\r\n    if(typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\r\n      return tag ? { ...entry, tag } : { ...entry };\r\n    }\r\n    return null;\r\n  }).filter(Boolean);\r\n}\r\n", "import { renderSeasonsAccordion } from './modal/seasonsAccordion.js';\r\nimport { formatRating, humanYear, isNew, useTmdbOn } from './utils.js';\r\nimport { getState } from './state.js';\r\nimport { loadShowDetail } from './data.js';\r\nimport { mapMovie, mapShow, mergeShowDetail, needsShowDetail } from './modal/shared.js';\r\n\r\nconst TMDB_PROFILE_BASE = 'https://image.tmdb.org/t/p/';\r\nconst TMDB_PROFILE_SIZE = 'w185';\r\n\r\nlet overlayContainer = null;\r\nlet dialogEl = null;\r\nlet scrollContainer = null;\r\nlet rootEl = null;\r\nlet lastActiveElement = null;\r\nlet focusTrapHandler = null;\r\nlet escapeHandler = null;\r\nlet renderToken = 0;\r\nlet currentKind = null;\r\nlet currentItem = null;\r\n\r\nconst DEMO_MOVIE = {\r\n  type: 'movie',\r\n  title: 'Lumen: Der Aufbruch',\r\n  tagline: 'Eine cineastische Demo f\u00FCr das neue Modal',\r\n  overview: 'Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\u00FCllt dabei eine Energiequelle, die alles ver\u00E4ndern k\u00F6nnte. Zwischen Loyalit\u00E4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\u00FCr das Cinematic-Layout entworfen wurde.',\r\n  summary: 'Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\u00E4ndern k\u00F6nnte.',\r\n  runtimeMin: 142,\r\n  contentRating: 'FSK 12',\r\n  studio: 'Aurora Pictures',\r\n  rating: 8.4,\r\n  audienceRating: 8.0,\r\n  userRating: 8.7,\r\n  originallyAvailableAt: '2024-05-17',\r\n  countries: [{ tag: 'Deutschland' }, { tag: 'Kanada' }],\r\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }, { tag: 'Abenteuer' }],\r\n  cast: [\r\n    { name: 'Mara Lenz', role: 'Captain Alys Vega', tmdbProfile: '/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg' },\r\n    { name: 'Tariq Benassi', role: 'Navigator Elian Soh', tmdbProfile: '/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg' },\r\n    { name: 'Hannah Ko', role: 'Wissenschaftlerin Dr. Mira Han', tmdbProfile: '/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg' },\r\n  ],\r\n  directors: [{ tag: 'Jonas Falk' }],\r\n  writers: [{ tag: 'Lea Winter' }],\r\n  producers: [{ tag: 'Studio Atlas' }],\r\n  labels: [{ tag: 'Dolby Atmos' }, { tag: '4K' }],\r\n  collections: [{ tag: 'Aurora-Saga' }],\r\n  trailer: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',\r\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg',\r\n  ids: { tmdb: 'demo-lumen', imdb: 'tt0000001' },\r\n  addedAt: '2024-06-01T12:00:00Z',\r\n};\r\n\r\nconst DEMO_SERIES = {\r\n  type: 'tv',\r\n  title: 'Aurora Station',\r\n  tagline: 'Neue Horizonte in Serie',\r\n  overview: 'Die Besatzung der Aurora Station sch\u00FCtzt eine Au\u00DFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\u00E4tsel mit pers\u00F6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.',\r\n  summary: 'Ein orbitaler Au\u00DFenposten ringt um Hoffnung und Zusammenhalt, w\u00E4hrend eine fremde Macht erwacht.',\r\n  contentRating: 'TV-14',\r\n  studio: 'Nebula Network',\r\n  originallyAvailableAt: '2023-09-14',\r\n  seasonCount: 2,\r\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }],\r\n  countries: [{ tag: 'USA' }, { tag: 'Island' }],\r\n  creators: [{ tag: 'Elina S\u00F8rensen' }],\r\n  cast: [\r\n    { name: 'Noah Adler', role: 'Commander Ivar Hale', tmdbProfile: '/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg' },\r\n    { name: 'Sofia Idris', role: 'Ingenieurin Kaia Rhee', tmdbProfile: '/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg' },\r\n    { name: 'Helena Ruiz', role: 'Strategin Tala Voss', tmdbProfile: '/ziEuG1ESSofxDCspotYlrwz3Tq.png' },\r\n  ],\r\n  seasons: [\r\n    {\r\n      title: 'Staffel 1',\r\n      seasonNumber: 1,\r\n      year: 2023,\r\n      thumbFile: 'https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg',\r\n      episodes: [\r\n        {\r\n          title: 'Kapitel Eins: Erwachen',\r\n          seasonNumber: 1,\r\n          episodeNumber: 1,\r\n          durationMin: 54,\r\n          originallyAvailableAt: '2023-09-14',\r\n          audienceRating: 8.6,\r\n        },\r\n        {\r\n          title: 'Kapitel Zwei: Grenzwelten',\r\n          seasonNumber: 1,\r\n          episodeNumber: 2,\r\n          durationMin: 52,\r\n          originallyAvailableAt: '2023-09-21',\r\n          audienceRating: 8.2,\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      title: 'Staffel 2',\r\n      seasonNumber: 2,\r\n      year: 2024,\r\n      thumbFile: 'https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg',\r\n      episodes: [\r\n        {\r\n          title: 'Kapitel Dreizehn: Resonanz',\r\n          seasonNumber: 2,\r\n          episodeNumber: 1,\r\n          durationMin: 56,\r\n          originallyAvailableAt: '2024-02-08',\r\n          audienceRating: 8.9,\r\n        },\r\n        {\r\n          title: 'Kapitel Vierzehn: Echo',\r\n          seasonNumber: 2,\r\n          episodeNumber: 2,\r\n          durationMin: 55,\r\n          originallyAvailableAt: '2024-02-15',\r\n          audienceRating: 8.7,\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg',\r\n  ids: { tmdb: 'demo-aurora-station', imdb: 'tt0000002' },\r\n};\r\n\r\nfunction resolveRoot(){\r\n  if(rootEl) return rootEl;\r\n  const container = document.getElementById('modal-root-v2');\r\n  if(!container) return null;\r\n  overlayContainer = container;\r\n  container.classList.add('modalv2-overlay');\r\n  if(!container.hasAttribute('hidden')) container.setAttribute('hidden', '');\r\n  if(!container.dataset.modalv2Ready){\r\n    container.innerHTML = `\r\n      <div class=\"modalv2-backdrop\" data-modalv2-backdrop=\"1\"></div>\r\n      <div class=\"modalv2-dialog\" role=\"dialog\" aria-modal=\"true\">\r\n        <div class=\"modalv2-scroll\" data-modalv2-scroll></div>\r\n      </div>\r\n    `;\r\n    container.dataset.modalv2Ready = '1';\r\n    container.addEventListener('click', onOverlayClick);\r\n  }\r\n  dialogEl = container.querySelector('.modalv2-dialog');\r\n  if(dialogEl && !dialogEl.hasAttribute('tabindex')) dialogEl.setAttribute('tabindex', '-1');\r\n  scrollContainer = container.querySelector('[data-modalv2-scroll]');\r\n  if(scrollContainer && !rootEl){\r\n    const existing = scrollContainer.querySelector('.modalv2');\r\n    if(existing) rootEl = existing;\r\n    else {\r\n      rootEl = document.createElement('div');\r\n      rootEl.className = 'modalv2';\r\n      rootEl.setAttribute('hidden', '');\r\n      scrollContainer.appendChild(rootEl);\r\n    }\r\n  }\r\n  return rootEl;\r\n}\r\n\r\nfunction onOverlayClick(ev){\r\n  if(!overlayContainer) return;\r\n  const target = ev.target;\r\n  if(target === overlayContainer || (target && target.dataset && target.dataset.modalv2Backdrop)){ closeModalV2(); }\r\n}\r\n\r\nfunction getFocusableElements(){\r\n  if(!dialogEl) return [];\r\n  const selectors = 'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex=\"-1\"])';\r\n  return Array.from(dialogEl.querySelectorAll(selectors)).filter(el=>{\r\n    if(el.hasAttribute('disabled')) return false;\r\n    if(el.getAttribute('aria-hidden') === 'true') return false;\r\n    if(el.hasAttribute('hidden')) return false;\r\n    return el.offsetParent !== null;\r\n  });\r\n}\r\n\r\nfunction bindFocusTrap(){\r\n  if(!dialogEl) return;\r\n  if(focusTrapHandler){ dialogEl.removeEventListener('keydown', focusTrapHandler); }\r\n  focusTrapHandler = (ev)=>{\r\n    if(ev.key !== 'Tab') return;\r\n    const focusables = getFocusableElements();\r\n    if(!focusables.length) return;\r\n    const first = focusables[0];\r\n    const last = focusables[focusables.length - 1];\r\n    if(ev.shiftKey){\r\n      if(document.activeElement === first){ ev.preventDefault(); last.focus(); }\r\n    }else if(document.activeElement === last){\r\n      ev.preventDefault(); first.focus();\r\n    }\r\n  };\r\n  dialogEl.addEventListener('keydown', focusTrapHandler);\r\n}\r\n\r\nfunction unbindFocusTrap(){\r\n  if(!dialogEl || !focusTrapHandler) return;\r\n  dialogEl.removeEventListener('keydown', focusTrapHandler);\r\n  focusTrapHandler = null;\r\n}\r\n\r\nfunction bindEscape(){\r\n  if(escapeHandler) return;\r\n  escapeHandler = (ev)=>{\r\n    if(ev.key === 'Escape'){ ev.preventDefault(); closeModalV2(); }\r\n  };\r\n  window.addEventListener('keydown', escapeHandler);\r\n}\r\n\r\nfunction unbindEscape(){\r\n  if(!escapeHandler) return;\r\n  window.removeEventListener('keydown', escapeHandler);\r\n  escapeHandler = null;\r\n}\r\n\r\nfunction showOverlay(){\r\n  const root = resolveRoot();\r\n  if(!root || !overlayContainer) return null;\r\n  overlayContainer.hidden = false;\r\n  overlayContainer.setAttribute('aria-hidden', 'false');\r\n  document.body.classList.add('modalv2-open');\r\n  if(scrollContainer) scrollContainer.scrollTop = 0;\r\n  bindFocusTrap();\r\n  bindEscape();\r\n\r\n  // Dispatch event for filter bar auto-hide\r\n  document.dispatchEvent(new CustomEvent('modal:open'));\r\n\r\n  return root;\r\n}\r\n\r\nfunction focusInitial(){\r\n  if(!dialogEl) return;\r\n  const closeBtn = dialogEl.querySelector('#v2Close');\r\n  const focusables = getFocusableElements();\r\n  let target = (closeBtn && !closeBtn.hasAttribute('hidden')) ? closeBtn : focusables[0];\r\n  if(!target) target = dialogEl;\r\n  if(target){\r\n    const focus = ()=>{ try{ target.focus(); }catch{} };\r\n    (window.requestAnimationFrame || setTimeout)(focus, 0);\r\n  }\r\n}\r\n\r\nfunction resolvePoster(item){\r\n  const tmdbPoster = item?.tmdb?.poster || item?.tmdbPoster;\r\n  const localPoster = item?.poster || item?.thumbFile || item?.art || '';\r\n  return (useTmdbOn() && tmdbPoster) ? tmdbPoster : localPoster;\r\n}\r\n\r\nfunction runtimeText(item){\r\n  const minutes = item?.runtimeMin || item?.durationMin || (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  if(!Number.isFinite(minutes)) return '';\r\n  if(item?.type === 'tv'){ return `~${minutes} min/Ep`; }\r\n  return `${minutes} min`;\r\n}\r\n\r\nfunction ratingText(item){\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(!Number.isFinite(rating)) return '';\r\n  return `\u2605 ${formatRating(rating)}`;\r\n}\r\n\r\nfunction studioText(item){\r\n  return item?.studio || item?.network || item?.studioName || '';\r\n}\r\n\r\nfunction releaseDateText(item){\r\n  const candidates = [\r\n    item?.originallyAvailableAt,\r\n    item?.releaseDate,\r\n    item?.premiereDate,\r\n    item?.firstAired,\r\n    item?.airDate,\r\n  ];\r\n  for(const raw of candidates){\r\n    const str = raw == null ? '' : String(raw).trim();\r\n    if(!str) continue;\r\n    const parsed = new Date(str);\r\n    if(Number.isFinite(parsed.getTime())){\r\n      try{\r\n        return parsed.toLocaleDateString('de-DE', { year:'numeric', month:'2-digit', day:'2-digit' });\r\n      }catch{}\r\n    }\r\n    const iso = str.match(/^\\d{4}-\\d{2}-\\d{2}/);\r\n    if(iso && iso[0]) return iso[0];\r\n    if(str.length >= 4) return str.slice(0, 10);\r\n  }\r\n  const year = humanYear(item);\r\n  return year ? String(year) : '';\r\n}\r\n\r\nfunction namesFromList(source){\r\n  if(!Array.isArray(source)) return [];\r\n  return source.map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction genresFromItem(item){\r\n  const arr = Array.isArray(item?.genres) ? item.genres : [];\r\n  const mapped = arr.map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n  return Array.from(new Set(mapped));\r\n}\r\n\r\nfunction buildChips(item){\r\n  const chips = [];\r\n  if(isNew(item)) chips.push('Neu');\r\n  if(item?.type === 'tv' && Number.isFinite(Number(item?.seasonCount))){\r\n    chips.push(`Staffeln: ${item.seasonCount}`);\r\n  }\r\n  const genres = (item?.genres || []).map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n  genres.forEach(genre=> chips.push(genre));\r\n  return chips;\r\n}\r\n\r\nfunction buildCastList(item){\r\n  const source = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\r\n  return source.map(person=>{\r\n    if(!person) return null;\r\n    if(typeof person === 'string'){\r\n      const name = String(person).trim();\r\n      if(!name) return null;\r\n      return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\r\n    }\r\n    const name = String(person.tag || person.name || person.role || '').trim();\r\n    if(!name) return null;\r\n    const role = (()=>{\r\n      const rawRole = String(person.role || '').trim();\r\n      if(!rawRole) return '';\r\n      return rawRole.toLowerCase() === name.toLowerCase() ? '' : rawRole;\r\n    })();\r\n    const tmdbProfile = [\r\n      person?.tmdb?.profile,\r\n      person?.tmdb?.profile_path,\r\n      person?.tmdb?.profilePath,\r\n      person?.tmdbProfile,\r\n      person?.profile,\r\n      person?.profile_path,\r\n      person?.profilePath,\r\n    ].find(val => typeof val === 'string' && val.trim());\r\n    const thumb = [person?.thumb, person?.photo, person?.image].find(val => typeof val === 'string' && val.trim()) || '';\r\n    return {\r\n      name,\r\n      role,\r\n      thumb,\r\n      tmdbProfile: tmdbProfile ? String(tmdbProfile).trim() : '',\r\n      raw: person,\r\n    };\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction normalizeTmdbProfile(path){\r\n  const str = String(path || '').trim();\r\n  if(!str) return '';\r\n  if(/^https?:\\/\\//i.test(str)) return str;\r\n  if(str.startsWith('//')) return `https:${str}`;\r\n  const suffix = str.startsWith('/') ? str : `/${str}`;\r\n  return `${TMDB_PROFILE_BASE}${TMDB_PROFILE_SIZE}${suffix}`;\r\n}\r\n\r\nfunction normalizeLocalImage(path){\r\n  const str = String(path || '').trim();\r\n  if(!str) return '';\r\n  if(/^https?:\\/\\//i.test(str) || str.startsWith('data:')) return str;\r\n  if(str.startsWith('//')) return `https:${str}`;\r\n  return str;\r\n}\r\n\r\nfunction resolveCastImage(entry, tmdbEnabled){\r\n  if(!entry) return '';\r\n  const raw = entry.raw || {};\r\n  if(tmdbEnabled){\r\n    const tmdbCandidates = [\r\n      entry.tmdbProfile,\r\n      raw?.tmdb?.profile,\r\n      raw?.tmdb?.profile_path,\r\n      raw?.tmdb?.profilePath,\r\n      raw?.tmdbProfile,\r\n      raw?.profile,\r\n      raw?.profile_path,\r\n      raw?.profilePath,\r\n    ];\r\n    for(const candidate of tmdbCandidates){\r\n      const url = normalizeTmdbProfile(candidate);\r\n      if(url) return url;\r\n    }\r\n  }\r\n  const localCandidates = [entry.thumb, raw?.thumb, raw?.photo, raw?.image];\r\n  for(const candidate of localCandidates){\r\n    const url = normalizeLocalImage(candidate);\r\n    if(url) return url;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction castInitials(name){\r\n  const str = String(name || '').trim();\r\n  if(!str) return '?';\r\n  const parts = str.split(/\\s+/).slice(0, 2);\r\n  const chars = parts.map(part => part.charAt(0)).filter(Boolean);\r\n  return chars.length ? chars.join('').toUpperCase() : str.charAt(0).toUpperCase();\r\n}\r\n\r\nfunction applyTabs(root){\r\n  const tabs = root.querySelector('.v2-tabs');\r\n  if(!tabs) return;\r\n  const buttons = Array.from(tabs.querySelectorAll('button[data-t]'));\r\n  const select = (target)=>{\r\n    buttons.forEach(btn=>{\r\n      const isActive = btn.dataset.t === target;\r\n      btn.classList.toggle('active', isActive);\r\n      btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\r\n      btn.tabIndex = isActive ? 0 : -1;\r\n      const pane = root.querySelector(`.v2-pane[data-pane=\"${btn.dataset.t}\"]`);\r\n      if(pane){\r\n        pane.hidden = !isActive;\r\n        pane.setAttribute('aria-hidden', pane.hidden ? 'true' : 'false');\r\n      }\r\n    });\r\n  };\r\n  const moveFocus = (current, delta)=>{\r\n    if(!buttons.length) return;\r\n    const currentIndex = buttons.indexOf(current);\r\n    const fallbackIndex = delta > 0 ? 0 : buttons.length - 1;\r\n    const index = currentIndex === -1 ? fallbackIndex : (currentIndex + delta + buttons.length) % buttons.length;\r\n    const next = buttons[index];\r\n    if(next){\r\n      next.focus();\r\n      select(next.dataset.t);\r\n    }\r\n  };\r\n  tabs.addEventListener('click', ev=>{\r\n    const btn = ev.target.closest('button[data-t]');\r\n    if(!btn) return;\r\n    ev.preventDefault();\r\n    select(btn.dataset.t);\r\n  });\r\n  tabs.addEventListener('keydown', ev=>{\r\n    const btn = ev.target.closest('button[data-t]');\r\n    if(!btn) return;\r\n    switch(ev.key){\r\n      case 'ArrowLeft':\r\n      case 'ArrowUp':\r\n        ev.preventDefault();\r\n        moveFocus(btn, -1);\r\n        break;\r\n      case 'ArrowRight':\r\n      case 'ArrowDown':\r\n        ev.preventDefault();\r\n        moveFocus(btn, 1);\r\n        break;\r\n      case 'Home':\r\n        ev.preventDefault();\r\n        if(buttons[0]){\r\n          buttons[0].focus();\r\n          select(buttons[0].dataset.t);\r\n        }\r\n        break;\r\n      case 'End':\r\n        ev.preventDefault();\r\n        if(buttons.length){\r\n          const last = buttons[buttons.length - 1];\r\n          last.focus();\r\n          select(last.dataset.t);\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n  const initial = buttons.find(btn=> btn.classList.contains('active')) || buttons[0];\r\n  if(initial) select(initial.dataset.t);\r\n}\r\n\r\nfunction updateCast(root, cast){\r\n  const pane = root.querySelector('.v2-cast');\r\n  if(!pane) return;\r\n  pane.innerHTML = '<div class=\"v2-cast-scroll\"></div>';\r\n  const scroll = pane.querySelector('.v2-cast-scroll');\r\n  if(!scroll) return;\r\n  const limited = Array.isArray(cast) ? cast.slice(0, 12) : [];\r\n  if(!limited.length){\r\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\r\n    scroll.removeAttribute('role');\r\n    return;\r\n  }\r\n  scroll.setAttribute('role', 'list');\r\n  const tmdbEnabled = useTmdbOn();\r\n  limited.forEach(entry=>{\r\n    const data = (entry && typeof entry === 'object' && 'name' in entry)\r\n      ? entry\r\n      : (()=>{\r\n          const name = String(entry || '').trim();\r\n          if(!name) return null;\r\n          return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\r\n        })();\r\n    if(!data || !data.name) return;\r\n\r\n    const card = document.createElement('article');\r\n    card.className = 'v2-cast-card';\r\n    card.tabIndex = 0;\r\n    card.setAttribute('role', 'listitem');\r\n\r\n    const roleText = String(data.role || '').trim();\r\n    card.setAttribute('aria-label', roleText ? `${data.name} \u2013 ${roleText}` : data.name);\r\n\r\n    const avatar = document.createElement('div');\r\n    avatar.className = 'v2-cast-avatar';\r\n    const imageSrc = resolveCastImage(data, tmdbEnabled);\r\n    if(imageSrc){\r\n      avatar.classList.add('has-image');\r\n      const img = document.createElement('img');\r\n      img.src = imageSrc;\r\n      img.alt = data.name;\r\n      img.loading = 'lazy';\r\n      img.decoding = 'async';\r\n      avatar.appendChild(img);\r\n    }else{\r\n      const initials = document.createElement('span');\r\n      initials.className = 'v2-cast-initials';\r\n      initials.textContent = castInitials(data.name);\r\n      initials.setAttribute('aria-hidden', 'true');\r\n      avatar.appendChild(initials);\r\n    }\r\n\r\n    const nameLine = document.createElement('p');\r\n    nameLine.className = 'v2-cast-name';\r\n    nameLine.textContent = data.name;\r\n\r\n    card.append(avatar, nameLine);\r\n\r\n    if(roleText){\r\n      const roleLine = document.createElement('p');\r\n      roleLine.className = 'v2-cast-role';\r\n      roleLine.textContent = roleText;\r\n      card.append(roleLine);\r\n    }else{\r\n      card.classList.add('v2-cast-card--no-role');\r\n    }\r\n    scroll.appendChild(card);\r\n  });\r\n\r\n  if(!scroll.children.length){\r\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\r\n    scroll.removeAttribute('role');\r\n  }\r\n}\r\n\r\nfunction updateOverview(root, text){\r\n  const pane = root.querySelector('.v2-overview');\r\n  if(!pane) return;\r\n\r\n  const overview = typeof text === 'string' ? text : '';\r\n\r\n  if(!overview){\r\n    pane.textContent = '';\r\n    return;\r\n  }\r\n\r\n  const paragraph = document.createElement('p');\r\n  paragraph.className = 'v2-overview-text line-clamp line-clamp-5';\r\n  paragraph.textContent = overview;\r\n\r\n  const toggle = document.createElement('button');\r\n  toggle.type = 'button';\r\n  toggle.className = 'v2-overview-toggle';\r\n\r\n  const setExpanded = (expanded)=>{\r\n    paragraph.classList.toggle('is-expanded', expanded);\r\n    toggle.setAttribute('aria-expanded', String(expanded));\r\n    toggle.textContent = expanded ? 'Weniger anzeigen' : 'Mehr anzeigen';\r\n  };\r\n\r\n  toggle.addEventListener('click', ()=>{\r\n    const expanded = toggle.getAttribute('aria-expanded') === 'true';\r\n    setExpanded(!expanded);\r\n  });\r\n\r\n  pane.replaceChildren(paragraph, toggle);\r\n  setExpanded(false);\r\n\r\n  const measure = ()=>{\r\n    const overflowing = paragraph.scrollHeight > paragraph.clientHeight + 1;\r\n    if(!overflowing){\r\n      paragraph.classList.add('is-expanded');\r\n      toggle.hidden = true;\r\n    }\r\n  };\r\n  const schedule = typeof requestAnimationFrame === 'function' ? requestAnimationFrame : (cb)=>setTimeout(cb, 0);\r\n  schedule(measure);\r\n}\r\n\r\nfunction updateDetails(root, item){\r\n  const pane = root.querySelector('.v2-details');\r\n  if(!pane) return;\r\n  pane.replaceChildren();\r\n\r\n  const grid = document.createElement('div');\r\n  grid.className = 'v2-details-grid';\r\n\r\n  const general = [];\r\n  const release = releaseDateText(item);\r\n  if(release) general.push(['Ver\u00F6ffentlichung', release]);\r\n  const runtime = runtimeText(item);\r\n  if(runtime) general.push(['Laufzeit', runtime]);\r\n  const studio = studioText(item);\r\n  if(studio) general.push(['Studio', studio]);\r\n  const certification = (item?.contentRating || '').trim();\r\n  if(certification) general.push(['Freigabe', certification]);\r\n  const formatOptionalRating = (value)=>{\r\n    if(value instanceof Number){\r\n      return formatOptionalRating(value.valueOf());\r\n    }\r\n    if(typeof value === 'number'){\r\n      return Number.isFinite(value) ? formatRating(value) : '';\r\n    }\r\n    if(typeof value === 'string'){\r\n      const trimmed = value.trim();\r\n      if(!trimmed) return '';\r\n      const num = Number(trimmed);\r\n      return Number.isFinite(num) ? formatRating(num) : '';\r\n    }\r\n    return '';\r\n  };\r\n\r\n  const critic = formatOptionalRating(item?.rating);\r\n  const audience = formatOptionalRating(item?.audienceRating);\r\n  const user = formatOptionalRating(item?.userRating);\r\n  if(critic){\r\n    general.push(['Bewertung', `\u2605 ${critic}`]);\r\n    if(audience && audience !== critic) general.push(['Publikum', `\u2605 ${audience}`]);\r\n  }else if(audience){\r\n    general.push(['Bewertung', `\u2605 ${audience}`]);\r\n  }\r\n  if(user) general.push(['Eigene Wertung', `\u2605 ${user}`]);\r\n\r\n  if(item?.type === 'tv'){\r\n    const numericSeasons = Number(item?.seasonCount);\r\n    const seasonCount = Number.isFinite(numericSeasons) ? numericSeasons : (Array.isArray(item?.seasons) ? item.seasons.length : null);\r\n    if(Number.isFinite(seasonCount) && seasonCount > 0){\r\n      general.push(['Staffeln', String(seasonCount)]);\r\n    }\r\n    const episodeCount = Array.isArray(item?.seasons) ? item.seasons.reduce((sum, season)=>{\r\n      if(!season) return sum;\r\n      const eps = Array.isArray(season.episodes) ? season.episodes.length : 0;\r\n      return sum + (Number.isFinite(eps) ? eps : 0);\r\n    }, 0) : null;\r\n    if(Number.isFinite(episodeCount) && episodeCount > 0){\r\n      general.push(['Episoden', String(episodeCount)]);\r\n    }\r\n  }\r\n\r\n  const countries = namesFromList(item?.countries);\r\n  if(countries.length) general.push(['L\u00E4nder', countries.join(', ')]);\r\n  const collections = namesFromList(item?.collections);\r\n  if(collections.length) general.push(['Sammlungen', collections.join(', ')]);\r\n  const labels = namesFromList(item?.labels);\r\n  if(labels.length) general.push(['Labels', labels.join(', ')]);\r\n  if(item?.editionTitle) general.push(['Edition', item.editionTitle]);\r\n  if(item?.originalTitle && item.originalTitle !== item.title) general.push(['Originaltitel', item.originalTitle]);\r\n\r\n  if(general.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'general';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Allgemein';\r\n    const list = document.createElement('dl');\r\n    list.className = 'v2-details-list';\r\n    general.forEach(([label, value])=>{\r\n      if(!label || !value) return;\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      list.append(dt, dd);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  const genres = genresFromItem(item);\r\n  if(genres.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'genres';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Genres';\r\n    const chips = document.createElement('div');\r\n    chips.className = 'v2-chip-group';\r\n    genres.forEach(name=>{\r\n      const span = document.createElement('span');\r\n      span.className = 'chip';\r\n      span.textContent = name;\r\n      chips.appendChild(span);\r\n    });\r\n    section.append(heading, chips);\r\n    grid.append(section);\r\n  }\r\n\r\n  const crew = [];\r\n  const directors = namesFromList(item?.directors);\r\n  if(directors.length) crew.push(['Regie', directors.join(', ')]);\r\n  const writers = namesFromList(item?.writers);\r\n  if(writers.length) crew.push(['Drehbuch', writers.join(', ')]);\r\n  const producers = namesFromList(item?.producers);\r\n  if(producers.length) crew.push(['Produktion', producers.join(', ')]);\r\n  const creators = namesFromList(item?.creators || item?.showrunners);\r\n  if(item?.type === 'tv' && creators.length) crew.push(['Creator', creators.join(', ')]);\r\n\r\n  if(crew.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'crew';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Credits';\r\n    const list = document.createElement('dl');\r\n    list.className = 'v2-details-list';\r\n    crew.forEach(([label, value])=>{\r\n      if(!label || !value) return;\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      list.append(dt, dd);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  if(grid.childElementCount){\r\n    pane.appendChild(grid);\r\n  }else{\r\n    const fallback = document.createElement('p');\r\n    fallback.className = 'v2-details-empty';\r\n    fallback.textContent = 'Keine zus\u00E4tzlichen Details verf\u00FCgbar.';\r\n    pane.appendChild(fallback);\r\n  }\r\n}\r\n\r\nfunction updateSeasons(root, item){\r\n  const pane = root.querySelector('.v2-seasons');\r\n  if(!pane) return;\r\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\r\n  if(!seasons.length){\r\n    pane.innerHTML = '<p class=\"modalv2-loading\">Keine Staffel-Informationen verf\u00FCgbar.</p>';\r\n    return;\r\n  }\r\n  pane.innerHTML = '';\r\n  renderSeasonsAccordion(pane, seasons);\r\n}\r\n\r\nfunction setExternalLinks(root, item){\r\n  const tmdbBtn = root.querySelector('#v2Tmdb');\r\n  const imdbBtn = root.querySelector('#v2Imdb');\r\n  const trailerBtn = root.querySelector('#v2Trailer');\r\n  const tmdbId = item?.ids?.tmdb || item?.tmdbId;\r\n  const imdbId = item?.ids?.imdb || item?.imdbId;\r\n  const trailer = item?.trailer || item?.trailerUrl;\r\n  const type = item?.type === 'tv' ? 'tv' : 'movie';\r\n  if(tmdbBtn){\r\n    if(tmdbId){\r\n      tmdbBtn.hidden = false;\r\n      tmdbBtn.href = `https://www.themoviedb.org/${type}/${tmdbId}`;\r\n    }else{\r\n      tmdbBtn.hidden = true;\r\n      tmdbBtn.removeAttribute('href');\r\n    }\r\n  }\r\n  if(imdbBtn){\r\n    if(imdbId){\r\n      imdbBtn.hidden = false;\r\n      imdbBtn.href = `https://www.imdb.com/title/${imdbId}/`;\r\n    }else{\r\n      imdbBtn.hidden = true;\r\n      imdbBtn.removeAttribute('href');\r\n    }\r\n  }\r\n  if(trailerBtn){\r\n    if(trailer){\r\n      trailerBtn.hidden = false;\r\n      trailerBtn.onclick = ()=> window.open(trailer, '_blank', 'noopener');\r\n    }else{\r\n      trailerBtn.hidden = true;\r\n      trailerBtn.onclick = null;\r\n    }\r\n  }\r\n}\r\n\r\nfunction populateHead(root, item){\r\n  const titleEl = root.querySelector('.v2-title');\r\n  if(titleEl) titleEl.textContent = item?.title || item?.name || '';\r\n  const tagline = (item?.tagline || '').trim();\r\n  const metaEl = root.querySelector('.v2-meta');\r\n  const subEl = root.querySelector('.v2-subline');\r\n  const year = humanYear(item);\r\n  const runtime = runtimeText(item);\r\n  const rating = ratingText(item);\r\n  const studio = studioText(item);\r\n  const metaParts = [year, runtime, rating, studio].filter(Boolean);\r\n  if(subEl){\r\n    const fallback = metaParts.join(' \u2022 ');\r\n    subEl.textContent = tagline || fallback;\r\n    subEl.hidden = !(tagline || fallback);\r\n  }\r\n  if(metaEl){\r\n    metaEl.textContent = tagline && metaParts.length ? metaParts.join(' \u2022 ') : '';\r\n    metaEl.hidden = !(tagline && metaParts.length);\r\n  }\r\n  const chipsRoot = root.querySelector('.v2-chips');\r\n  if(chipsRoot){\r\n    chipsRoot.replaceChildren();\r\n    buildChips(item).forEach(text=>{\r\n      const span = document.createElement('span');\r\n      span.className = 'chip';\r\n      span.textContent = text;\r\n      chipsRoot.appendChild(span);\r\n    });\r\n    chipsRoot.hidden = !chipsRoot.childElementCount;\r\n  }\r\n  const quickFacts = root.querySelector('.v2-facts');\r\n  const quickList = root.querySelector('.v2-facts-list');\r\n  if(quickFacts && quickList){\r\n    const facts = [];\r\n    if(year) facts.push(['Jahr', year]);\r\n    const contentRating = (item?.contentRating || '').trim();\r\n    if(contentRating) facts.push(['Freigabe', contentRating]);\r\n    if(runtime) facts.push(['Laufzeit', runtime]);\r\n    if(rating) facts.push(['Bewertung', rating]);\r\n    if(studio) facts.push(['Studio', studio]);\r\n    quickList.replaceChildren();\r\n    facts.forEach(([label, value])=>{\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      quickList.append(dt, dd);\r\n    });\r\n    quickFacts.hidden = !facts.length;\r\n  }\r\n  const img = root.querySelector('.v2-poster img');\r\n  if(img){\r\n    const src = resolvePoster(item);\r\n    img.src = src || '';\r\n    img.alt = item?.title ? `Poster: ${item.title}` : '';\r\n    img.loading = 'lazy';\r\n    img.decoding = 'async';\r\n    img.classList.remove('is-ready');\r\n    if(src){\r\n      img.addEventListener('load', onPosterReady, { once:true });\r\n      img.addEventListener('error', onPosterReady, { once:true });\r\n    }else{\r\n      img.classList.add('is-ready');\r\n    }\r\n  }\r\n}\r\n\r\nfunction onPosterReady(ev){\r\n  ev.currentTarget?.classList.add('is-ready');\r\n}\r\n\r\nexport function showModalV2Loading(message='Details werden geladen \u2026'){\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  root.hidden = false;\r\n  const loadingDiv = document.createElement('div');\r\n  loadingDiv.className = 'modalv2-loading';\r\n  loadingDiv.textContent = String(message || 'Details werden geladen \u2026');\r\n  root.replaceChildren(loadingDiv);\r\n}\r\n\r\nexport function renderModalV2(item){\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  root.hidden = false;\r\n  const hasSeasons = item?.type === 'tv';\r\n  root.innerHTML = `\r\n    <section class=\"v2-layout\">\r\n      <aside class=\"v2-side\">\r\n        <div class=\"v2-poster\"><img alt=\"\"></div>\r\n        <div class=\"v2-facts\" aria-label=\"Schnellinfos\" hidden>\r\n          <h3 class=\"v2-facts-title\">Schnellinfos</h3>\r\n          <dl class=\"v2-facts-list\"></dl>\r\n        </div>\r\n      </aside>\r\n      <div class=\"v2-info\">\r\n        <header class=\"v2-head\">\r\n          <div class=\"v2-titlebar\">\r\n            <div class=\"v2-title-wrap\">\r\n              <h2 class=\"v2-title\" id=\"modalV2Title\"></h2>\r\n              <div class=\"v2-subline\"></div>\r\n              <div class=\"v2-meta\"></div>\r\n            </div>\r\n            <div class=\"v2-actions\" aria-label=\"Externe Aktionen\">\r\n              <button class=\"v2-icon-btn\" id=\"v2Close\" type=\"button\" aria-label=\"Schlie\u00DFen\">\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M6 6l12 12M6 18L18 6\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\r\n                </svg>\r\n              </button>\r\n              <a class=\"v2-icon-btn\" id=\"v2Tmdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf TMDB \u00F6ffnen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\r\n                  <path d=\"M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\r\n                </svg>\r\n              </a>\r\n              <a class=\"v2-icon-btn\" id=\"v2Imdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf IMDb \u00F6ffnen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\r\n                </svg>\r\n              </a>\r\n              <button class=\"v2-icon-btn\" id=\"v2Trailer\" type=\"button\" aria-label=\"Trailer abspielen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M9 6l8 6-8 6V6z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\" stroke-linecap=\"round\"></path>\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"v2-chips\" aria-label=\"Attribute\"></div>\r\n        </header>\r\n        <nav class=\"v2-tabs\" aria-label=\"Details Navigation\" role=\"tablist\">\r\n          <button type=\"button\" data-t=\"overview\" class=\"active\" id=\"v2TabOverview\" role=\"tab\" aria-controls=\"v2PaneOverview\" aria-selected=\"true\">\u00DCberblick</button>\r\n          <button type=\"button\" data-t=\"details\" id=\"v2TabDetails\" role=\"tab\" aria-controls=\"v2PaneDetails\" aria-selected=\"false\">Details</button>\r\n          ${hasSeasons ? '<button type=\"button\" data-t=\"seasons\" id=\"v2TabSeasons\" role=\"tab\" aria-controls=\"v2PaneSeasons\" aria-selected=\"false\">Staffeln</button>' : ''}\r\n          <button type=\"button\" data-t=\"cast\" id=\"v2TabCast\" role=\"tab\" aria-controls=\"v2PaneCast\" aria-selected=\"false\">Cast</button>\r\n        </nav>\r\n        <section class=\"v2-body\">\r\n          <div class=\"v2-pane v2-overview\" data-pane=\"overview\" id=\"v2PaneOverview\" role=\"tabpanel\" aria-labelledby=\"v2TabOverview\"></div>\r\n          <div class=\"v2-pane v2-details\" data-pane=\"details\" id=\"v2PaneDetails\" role=\"tabpanel\" aria-labelledby=\"v2TabDetails\" hidden></div>\r\n          ${hasSeasons ? '<div class=\"v2-pane v2-seasons\" data-pane=\"seasons\" id=\"v2PaneSeasons\" role=\"tabpanel\" aria-labelledby=\"v2TabSeasons\" hidden></div>' : ''}\r\n          <div class=\"v2-pane v2-cast\" data-pane=\"cast\" id=\"v2PaneCast\" role=\"tabpanel\" aria-labelledby=\"v2TabCast\" hidden></div>\r\n        </section>\r\n      </div>\r\n    </section>\r\n  `;\r\n\r\n  populateHead(root, item);\r\n  setExternalLinks(root, item);\r\n  updateOverview(root, item?.overview || item?.summary || '');\r\n  updateDetails(root, item);\r\n  if(item?.type === 'tv'){ updateSeasons(root, item); }\r\n  updateCast(root, buildCastList(item));\r\n  applyTabs(root);\r\n  const closeBtn = root.querySelector('#v2Close');\r\n  if(closeBtn){\r\n    closeBtn.addEventListener('click', closeModalV2);\r\n  }\r\n  if(dialogEl) dialogEl.setAttribute('aria-labelledby', 'modalV2Title');\r\n  focusInitial();\r\n}\r\n\r\nexport async function openMovieModalV2(idOrData){\r\n  const token = ++renderToken;\r\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  const data = resolveMovieData(idOrData);\r\n  if(token !== renderToken) return;\r\n  if(!data){\r\n    root.hidden = false;\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'modalv2-loading';\r\n    errorDiv.textContent = 'Film konnte nicht geladen werden.';\r\n    root.replaceChildren(errorDiv);\r\n    currentItem = null;\r\n    currentKind = null;\r\n    focusInitial();\r\n    return;\r\n  }\r\n  currentItem = data;\r\n  currentKind = 'movie';\r\n  renderModalV2(data);\r\n}\r\n\r\nexport async function openSeriesModalV2(idOrData){\r\n  const token = ++renderToken;\r\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n  const base = resolveSeriesData(idOrData);\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  if(token !== renderToken) return;\r\n  if(!base){\r\n    root.hidden = false;\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'modalv2-loading';\r\n    errorDiv.textContent = 'Seriendetails konnten nicht geladen werden.';\r\n    root.replaceChildren(errorDiv);\r\n    currentItem = null;\r\n    currentKind = null;\r\n    focusInitial();\r\n    return;\r\n  }\r\n  currentItem = base;\r\n  currentKind = 'show';\r\n  let working = base;\r\n  if(needsShowDetail(working)){\r\n    showModalV2Loading();\r\n    if(token !== renderToken) return;\r\n    let detail = null;\r\n    try{ detail = await loadShowDetail(working); }\r\n    catch{ detail = null; }\r\n    if(token !== renderToken) return;\r\n    if(detail){ mergeShowDetail(working, detail); currentItem = working; }\r\n  }\r\n  if(token !== renderToken) return;\r\n  renderModalV2(working);\r\n}\r\n\r\nexport function closeModalV2(){\r\n  renderToken++;\r\n  if(!overlayContainer) return;\r\n  overlayContainer.hidden = true;\r\n  overlayContainer.setAttribute('aria-hidden', 'true');\r\n  document.body.classList.remove('modalv2-open');\r\n  unbindFocusTrap();\r\n  unbindEscape();\r\n  if(rootEl){\r\n    rootEl.innerHTML = '';\r\n    rootEl.setAttribute('hidden', '');\r\n  }\r\n  if(scrollContainer) scrollContainer.scrollTop = 0;\r\n  if(lastActiveElement && typeof lastActiveElement.focus === 'function'){\r\n    try{ lastActiveElement.focus(); }\r\n    catch{}\r\n  }\r\n  lastActiveElement = null;\r\n  currentItem = null;\r\n  currentKind = null;\r\n\r\n  // Dispatch event for filter bar auto-hide\r\n  document.dispatchEvent(new CustomEvent('modal:close'));\r\n}\r\n\r\nexport function isModalV2Open(){\r\n  return Boolean(overlayContainer && !overlayContainer.hidden);\r\n}\r\n\r\nexport function getModalV2Context(){\r\n  return currentItem ? { item: currentItem, kind: currentKind } : { item: null, kind: null };\r\n}\r\n\r\nfunction resolveMovieData(idOrData){\r\n  if(idOrData === 'demo') return mapMovie(DEMO_MOVIE);\r\n  if(idOrData && typeof idOrData === 'object') return mapMovie(idOrData);\r\n  const str = idOrData == null ? '' : String(idOrData).trim();\r\n  if(!str) return null;\r\n  const state = getState();\r\n  const movies = Array.isArray(state?.movies) ? state.movies : [];\r\n  const match = movies.find(movie => matchesIdentifier(movie, str));\r\n  return match ? mapMovie(match) : null;\r\n}\r\n\r\nfunction resolveSeriesData(idOrData){\r\n  if(idOrData === 'demo') return mapShow(DEMO_SERIES);\r\n  if(idOrData && typeof idOrData === 'object') return mapShow(idOrData);\r\n  const str = idOrData == null ? '' : String(idOrData).trim();\r\n  if(!str) return null;\r\n  const state = getState();\r\n  const shows = Array.isArray(state?.shows) ? state.shows : [];\r\n  const match = shows.find(show => matchesIdentifier(show, str));\r\n  return match ? mapShow(match) : null;\r\n}\r\n\r\nfunction matchesIdentifier(item, id){\r\n  if(!item) return false;\r\n  const str = String(id || '').trim();\r\n  if(!str) return false;\r\n  if(item?.ids?.imdb && String(item.ids.imdb) === str) return true;\r\n  if(item?.ids?.tmdb && String(item.ids.tmdb) === str) return true;\r\n  if(item?.ratingKey != null && String(item.ratingKey) === str) return true;\r\n  return false;\r\n}\r\n", "import { getState } from './state.js';\r\nimport * as Filter from './filter.js';\r\nimport { el } from './dom.js';\r\nimport { humanYear, formatRating, renderChipsLimited, useTmdbOn, isNew, getGenreNames } from './utils.js';\r\nimport * as Watch from './watchlist.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\n\r\nfunction cardEl(item){\r\n  const card = el('article','card');\r\n  card.style.contentVisibility = 'auto';\r\n  card.dataset.kind = (item?.type === 'tv') ? 'show' : 'movie';\r\n  card.tabIndex = 0;\r\n  card.setAttribute('role', 'button');\r\n  if(item?.title) card.setAttribute('aria-label', item.title);\r\n\r\n  // 1) Media Block\r\n  const media = el('div','card__media');\r\n  const img = new Image();\r\n  img.loading = 'lazy';\r\n  img.decoding = 'async';\r\n  img.className = 'card__img';\r\n  img.alt = item?.title || '';\r\n  const src = resolvePoster(item);\r\n  if(src) img.src = src;\r\n\r\n  const gradient = el('div','card__media-gradient');\r\n  gradient.setAttribute('aria-hidden','true');\r\n\r\n  const badges = buildItemBadges(item);\r\n  const badgeContainer = el('div','card__badges');\r\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\r\n\r\n  media.append(img, gradient);\r\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\r\n\r\n  const pct = progressPercent(item);\r\n  if(pct > 0){\r\n    const track = el('div','card__progress');\r\n    const fill = document.createElement('span');\r\n    fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;\r\n    track.append(fill);\r\n    media.append(track);\r\n  }\r\n\r\n  // 2) Info Block\r\n  const body = el('div','card__body');\r\n  const title = document.createElement('h3');\r\n  title.className = 'card__title';\r\n  title.textContent = item?.title || '';\r\n  if(item?.title) title.setAttribute('title', item.title);\r\n\r\n  const sub = el('div','card__meta');\r\n  const metaPieces = buildMetaPieces(item);\r\n  sub.textContent = metaPieces.join(' \u2022 ');\r\n\r\n  body.append(title, sub);\r\n\r\n  // 3) Actions Block\r\n  const actions = el('div','card__actions');\r\n\r\n  const chips = el('div','card__chips');\r\n  const genres = getGenreNames(item?.genres);\r\n  renderChipsLimited(chips, genres, 3);\r\n\r\n  const watchBtn = document.createElement('button');\r\n  watchBtn.type = 'button';\r\n  watchBtn.className = 'card__primary';\r\n  updateWatchButtonState(watchBtn, item);\r\n  watchBtn.addEventListener('click', ev=>{\r\n    ev.stopPropagation();\r\n    Watch.toggle(item);\r\n    updateWatchButtonState(watchBtn, item);\r\n  });\r\n\r\n  actions.append(chips, watchBtn);\r\n\r\n  card.append(media, body, actions);\r\n\r\n  card.addEventListener('click', ()=> openDetail(item));\r\n  card.addEventListener('keydown', ev=>{\r\n    if(ev.target !== card) return;\r\n    if(ev.key === 'Enter' || ev.key === ' '){\r\n      ev.preventDefault();\r\n      openDetail(item);\r\n    }\r\n  });\r\n\r\n  return card;\r\n}\r\n\r\nfunction collectionTags(item){\r\n  return ((item && item.collections) || [])\r\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\r\n    .filter(Boolean);\r\n}\r\n\r\nfunction createCollectionGroup(name, members){\r\n  const list = (members||[]).slice().sort((a,b)=>{\r\n    const ay = Number(humanYear(a)) || 0;\r\n    const by = Number(humanYear(b)) || 0;\r\n    if(ay !== by) return ay - by;\r\n    return (a.title||'').localeCompare(b.title||'', 'de');\r\n  });\r\n  const years = list.map(item=>Number(humanYear(item))||0).filter(Boolean);\r\n  const year = years.length ? Math.min(...years) : '';\r\n  const addedTimestamps = list.map(item=> new Date(item.addedAt||0).getTime()).filter(Number.isFinite);\r\n  const latestAdded = addedTimestamps.length ? new Date(Math.max(...addedTimestamps)).toISOString() : null;\r\n  const ratings = list.map(item=>Number(item.rating ?? item.audienceRating)).filter(Number.isFinite);\r\n  const rating = ratings.length ? ratings.reduce((sum,val)=>sum+val,0) / ratings.length : null;\r\n  const posterItem = list.find(entry=>entry.thumbFile) || list[0] || null;\r\n  const genres = Array.from(new Set(list.flatMap(entry=>getGenreNames(entry.genres)))).slice(0,4);\r\n  return { isCollectionGroup:true, type:'collection', title:name, collectionName:name, items:list, itemCount:list.length, year: year || '', addedAt: latestAdded, rating, posterItem, genres };\r\n}\r\n\r\nfunction groupCollectionsIfEnabled(items){\r\n  const togg = document.getElementById('groupCollections');\r\n  const colSel = document.getElementById('collectionFilter');\r\n  const selected = colSel && colSel.value;\r\n  if(!togg || !togg.checked) return items;\r\n  if(selected) return items; // drilling into a single collection -> show items, not groups\r\n  const membership = new Map();\r\n  items.forEach(item=>{\r\n    collectionTags(item).forEach(name=>{\r\n      if(!membership.has(name)) membership.set(name, []);\r\n      membership.get(name).push(item);\r\n    });\r\n  });\r\n  const groups = [];\r\n  membership.forEach((members, name)=>{ groups.push(createCollectionGroup(name, members)); });\r\n  // preserve stable order by title\r\n  groups.sort((a,b)=> a.title.localeCompare(b.title,'de'));\r\n  return groups;\r\n}\r\n\r\nfunction collectionCardEl(entry){\r\n  const card = el('article','card card--collection');\r\n  card.style.contentVisibility='auto';\r\n  card.dataset.kind = 'collection';\r\n  card.tabIndex = 0;\r\n  card.setAttribute('role', 'button');\r\n  if(entry?.title) card.setAttribute('aria-label', entry.title);\r\n\r\n  // 1) Media Block\r\n  const media = el('div','card__media');\r\n  const baseItem = entry.posterItem || {};\r\n  const img = new Image();\r\n  img.loading = 'lazy';\r\n  img.decoding = 'async';\r\n  img.className = 'card__img';\r\n  img.alt = entry?.title || '';\r\n  const src = resolvePoster(baseItem);\r\n  if(src) img.src = src;\r\n\r\n  const gradient = el('div','card__media-gradient');\r\n  gradient.setAttribute('aria-hidden','true');\r\n\r\n  const badges = buildCollectionBadges(entry);\r\n  const badgeContainer = el('div','card__badges');\r\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\r\n\r\n  media.append(img, gradient);\r\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\r\n\r\n  // 2) Info Block\r\n  const body = el('div','card__body');\r\n  const title = document.createElement('h3');\r\n  title.className = 'card__title';\r\n  title.textContent = entry.title || '';\r\n  if(entry?.title) title.setAttribute('title', entry.title);\r\n\r\n  const sub = el('div','card__meta');\r\n  const pieces = [entry.year, `${entry.itemCount} Titel`];\r\n  if(Number.isFinite(entry.rating)) pieces.push(`\u2605 ${formatRating(entry.rating)}`);\r\n  sub.textContent = pieces.filter(Boolean).join(' \u2022 ');\r\n\r\n  body.append(title, sub);\r\n\r\n  // 3) Actions Block\r\n  const actions = el('div','card__actions');\r\n  const chips = el('div','card__chips');\r\n  renderChipsLimited(chips, entry.genres||[], 3);\r\n  actions.append(chips);\r\n\r\n  card.append(media, body, actions);\r\n\r\n  card.addEventListener('click', ()=>{\r\n    const sel = document.getElementById('collectionFilter');\r\n    if(sel){\r\n      sel.value = entry.collectionName || entry.title || '';\r\n      sel.dispatchEvent(new Event('change', { bubbles:true }));\r\n    }\r\n  });\r\n\r\n  card.addEventListener('keydown', ev=>{\r\n    if(ev.target !== card) return;\r\n    if(ev.key === 'Enter' || ev.key === ' '){\r\n      ev.preventDefault();\r\n      const sel = document.getElementById('collectionFilter');\r\n      if(sel){\r\n        sel.value = entry.collectionName || entry.title || '';\r\n        sel.dispatchEvent(new Event('change', { bubbles:true }));\r\n      }\r\n    }\r\n  });\r\n\r\n  return card;\r\n}\r\n\r\nexport function renderGrid(view){\r\n  const { movies, shows, filtered } = getState();\r\n  const base = (view==='shows' ? shows : movies) || [];\r\n  const list = Array.isArray(filtered) ? filtered : base;\r\n  const items = groupCollectionsIfEnabled(list);\r\n  const grid = document.getElementById('grid');\r\n  if(!grid) return;\r\n  beginGridTransition(grid);\r\n  const frag = document.createDocumentFragment();\r\n  items.forEach(x=>frag.append(x.isCollectionGroup ? collectionCardEl(x) : cardEl(x)));\r\n  grid.replaceChildren(frag);\r\n  finishGridTransition(grid);\r\n  const empty = document.getElementById('empty');\r\n  if(empty) empty.hidden = items.length > 0;\r\n}\r\n\r\nfunction beginGridTransition(grid){\r\n  if(!grid) return;\r\n  grid.classList.remove('is-entering','is-ready');\r\n  grid.classList.add('is-leaving');\r\n}\r\n\r\nfunction finishGridTransition(grid){\r\n  if(!grid) return;\r\n  grid.classList.remove('is-leaving');\r\n  grid.classList.add('is-entering');\r\n  requestAnimationFrame(()=>{\r\n    grid.classList.add('is-ready');\r\n    setTimeout(()=>grid.classList.remove('is-entering','is-ready'), 240);\r\n  });\r\n}\r\n\r\n\r\nfunction resolvePoster(item){\r\n  if(!item) return '';\r\n  const tmdbPoster = useTmdbOn() && (item?.tmdb?.poster || item?.tmdbPoster);\r\n  const fallback = item?.thumbFile || item?.poster || item?.art || item?.thumb || '';\r\n  return tmdbPoster || fallback || '';\r\n}\r\n\r\nfunction buildItemBadges(item){\r\n  const badges = [];\r\n  if(isNew(item)) badges.push(createBadge('Neu'));\r\n  const contentRating = String(item?.contentRating || '').trim();\r\n  if(contentRating) badges.push(createBadge(contentRating));\r\n  const ratingNum = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(ratingNum)) badges.push(createBadge(`\u2605 ${formatRating(ratingNum)}`));\r\n  return badges.slice(0, 3);\r\n}\r\n\r\nfunction buildCollectionBadges(entry){\r\n  const badges = [];\r\n  if(Number.isFinite(entry?.itemCount) && entry.itemCount > 0) badges.push(createBadge(`${entry.itemCount} Titel`));\r\n  if(entry?.year) badges.push(createBadge(String(entry.year)));\r\n  return badges;\r\n}\r\n\r\nfunction createBadge(text){\r\n  const badge = document.createElement('span');\r\n  badge.className = 'badge';\r\n  badge.textContent = String(text || '');\r\n  return badge;\r\n}\r\n\r\nfunction updateWatchButtonState(button, item){\r\n  if(!button) return;\r\n  const saved = Watch.isSaved(item);\r\n  button.textContent = saved ? 'Gemerkt' : 'Merken';\r\n  button.classList.toggle('active', saved);\r\n  button.setAttribute('aria-pressed', saved ? 'true' : 'false');\r\n}\r\n\r\nfunction buildMetaPieces(item){\r\n  const pieces = [];\r\n  const year = humanYear(item);\r\n  if(year) pieces.push(String(year));\r\n  const runtime = formatRuntime(item);\r\n  if(runtime) pieces.push(runtime);\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\r\n  const studio = item?.studio || item?.network || '';\r\n  if(studio) pieces.push(studio);\r\n  return pieces;\r\n}\r\n\r\nfunction formatRuntime(item){\r\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  const minutes = Number(raw);\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\r\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\r\n  return `${minutes} min`;\r\n}\r\n\r\nfunction progressPercent(item){\r\n  const offset = Number(item?.viewOffset ?? item?.viewoffset);\r\n  const duration = Number(item?.duration);\r\n  if(!Number.isFinite(offset) || !Number.isFinite(duration) || duration <= 0) return 0;\r\n  return Math.max(1, Math.min(100, Math.round((offset / duration) * 100)));\r\n}\r\n\r\nfunction resolveItemId(item){\r\n  if(!item) return '';\r\n  const preferred = item?.ids?.imdb || item?.ids?.tmdb;\r\n  if(preferred) return String(preferred);\r\n  if(item?.ratingKey) return String(item.ratingKey);\r\n  return '';\r\n}\r\n\r\nfunction updateHash(kind, id){\r\n  if(!kind || !id) return;\r\n  const hash = `#/${kind}/${id}`;\r\n  try{\r\n    if(history && typeof history.pushState === 'function'){\r\n      if(location.hash === hash && typeof history.replaceState === 'function') history.replaceState(null, '', hash);\r\n      else history.pushState(null, '', hash);\r\n      return;\r\n    }\r\n  }catch{}\r\n  try{ window.__skipNextHashNavigation = true; }\r\n  catch{}\r\n  location.hash = hash;\r\n}\r\n\r\nfunction openDetail(item){\r\n  if(!item) return;\r\n  const kind = item?.type === 'tv' ? 'show' : 'movie';\r\n  const id = resolveItemId(item);\r\n  if(id) updateHash(kind, id);\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n}\r\n", "import { getState, setState } from './state.js';\r\nimport { qs } from './dom.js';\r\nimport { getGenreNames } from './utils.js';\r\n\r\nfunction humanYear(item){\r\n  if(item.year) return item.year;\r\n  if(item.originallyAvailableAt) return String(item.originallyAvailableAt).slice(0,4);\r\n  return '';\r\n}\r\n\r\nfunction collectionTags(item){\r\n  return ((item && item.collections) || [])\r\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\r\n    .filter(Boolean);\r\n}\r\n\r\nfunction isNew(item){\r\n  if(!item?.addedAt) return false;\r\n  const added = new Date(item.addedAt).getTime();\r\n  if(!Number.isFinite(added)) return false;\r\n  const cfg = getState().cfg || {};\r\n  const days = Number(cfg.newDays || 30);\r\n  return Date.now() - added <= days * 24*60*60*1000;\r\n}\r\n\r\nfunction norm(s){ return String(s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\r\n\r\nfunction matches(item, opts){\r\n  const query = norm(opts.query||'');\r\n  const onlyNew = !!opts.onlyNew;\r\n  const yearFrom = Number(opts.yearFrom)||null;\r\n  const yearTo = Number(opts.yearTo)||null;\r\n  const genresActive = opts.genres || new Set();\r\n  const selectedCollection = opts.collection || '';\r\n\r\n  if(query){\r\n    const haystack = norm([\r\n      item.title,\r\n      item.originalTitle,\r\n      item.summary,\r\n      item.studio,\r\n      getGenreNames(item.genres).join(' '),\r\n      (item.roles||[]).map(r=>r && (r.tag||r.role||r.name)).join(' '),\r\n      collectionTags(item).join(' '),\r\n    ].filter(Boolean).join(' '));\r\n    if(!haystack.includes(query)) return false;\r\n  }\r\n\r\n  if(onlyNew && !isNew(item)) return false;\r\n\r\n  const year = Number(humanYear(item)) || null;\r\n  if(yearFrom && (!year || year < yearFrom)) return false;\r\n  if(yearTo && (!year || year > yearTo)) return false;\r\n\r\n  if(genresActive.size){\r\n    const itemGenres = new Set(getGenreNames(item.genres));\r\n    for(const g of genresActive){ if(!itemGenres.has(g)) return false; }\r\n  }\r\n\r\n  if(selectedCollection){\r\n    const tags = new Set(collectionTags(item));\r\n    if(!tags.has(selectedCollection)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction sortItems(items, key){\r\n  const arr = items.slice();\r\n  switch(key){\r\n    case 'year-desc':\r\n      arr.sort((a,b)=> (Number(humanYear(b))||0) - (Number(humanYear(a))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\r\n    case 'year-asc':\r\n      arr.sort((a,b)=> (Number(humanYear(a))||0) - (Number(humanYear(b))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\r\n    case 'title-desc':\r\n      arr.sort((a,b)=> String(b.title||'').localeCompare(String(a.title||''),'de')); break;\r\n    case 'added-desc':\r\n      arr.sort((a,b)=> new Date(b.addedAt||0)-new Date(a.addedAt||0)); break;\r\n    case 'title-asc':\r\n    default:\r\n      arr.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||''),'de'));\r\n  }\r\n  return arr;\r\n}\r\n\r\nexport function computeFacets(movies, shows){\r\n  const genres = new Set();\r\n  const years = new Set();\r\n  const collections = new Set();\r\n  const add = (arr)=> (arr||[]).forEach(x=>{\r\n    getGenreNames(x.genres).forEach(name=>genres.add(name));\r\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\r\n    if(y) years.add(Number(y));\r\n    collectionTags(x).forEach(c=>collections.add(c));\r\n  });\r\n  add(movies); add(shows);\r\n  const ys = [...years].sort((a,b)=>a-b);\r\n  return { genres:[...genres].sort(), years:ys, collections:[...collections].sort((a,b)=>a.localeCompare(b,'de')) };\r\n}\r\n\r\nexport function renderFacets(f){\r\n  // years\r\n  const yFrom = qs('#yearFrom'); const yTo = qs('#yearTo');\r\n  if(yFrom){ yFrom.replaceChildren(new Option('Ab Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\r\n  if(yTo){ yTo.replaceChildren(new Option('Bis Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\r\n  // collections\r\n  const col = qs('#collectionFilter');\r\n  if(col){ col.replaceChildren(new Option('Alle Collections',''), ...f.collections.map(c=>new Option(c,c))); }\r\n  // genres\r\n  const gRoot = qs('#genreFilters');\r\n  if(gRoot){\r\n    const chips = f.genres.map(name=>{\r\n      const b = document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=name; b.dataset.name=name; return b;\r\n    });\r\n    gRoot.replaceChildren(...chips);\r\n    updateGenreFilterState();\r\n  }\r\n}\r\n\r\nfunction getFilterOpts(){\r\n  const searchInput = document.getElementById('search') || document.getElementById('q');\r\n  const query = (searchInput?.value || '').trim();\r\n  const onlyNew = qs('#onlyNew')?.checked || false;\r\n  const yearFrom = qs('#yearFrom')?.value || '';\r\n  const yearTo = qs('#yearTo')?.value || '';\r\n  const collection = qs('#collectionFilter')?.value || '';\r\n  const sort = qs('#sort')?.value || 'title-asc';\r\n  const genres = new Set();\r\n  document.querySelectorAll('#genreFilters .chip.active').forEach(n=>genres.add(n.dataset.name));\r\n  return { query, onlyNew, yearFrom, yearTo, collection, genres, sort };\r\n}\r\n\r\nexport function applyFilters(){\r\n  const s = getState();\r\n  const view = s.view;\r\n  const pool = view==='shows' ? s.shows : s.movies;\r\n  const opts = getFilterOpts();\r\n  const filtered = (pool||[]).filter(item=>matches(item, opts));\r\n  const ordered = sortItems(filtered, opts.sort);\r\n  setState({ filtered: ordered });\r\n  return ordered;\r\n}\r\n\r\nlet gridModulePromise = null;\r\nfunction renderGridForCurrentView(){\r\n  if(!gridModulePromise){\r\n    gridModulePromise = import('./grid.js');\r\n  }\r\n  gridModulePromise.then(mod=>{\r\n    const fn = mod && mod.renderGrid;\r\n    if(typeof fn === 'function') fn(getState().view);\r\n  }).catch(console.error);\r\n}\r\n\r\nexport function updateFiltersAndGrid(){\r\n  const result = applyFilters();\r\n  renderGridForCurrentView();\r\n  notifyFiltersUpdated(result);\r\n  return result;\r\n}\r\n\r\nfunction notifyFiltersUpdated(items){\r\n  try{\r\n    const payload = Array.isArray(items) ? items.slice() : [];\r\n    const detail = { items: payload, view: getState().view };\r\n    window.dispatchEvent(new CustomEvent('filters:updated', { detail }));\r\n  }catch{}\r\n}\r\n\r\nfunction updateGenreFilterState(){\r\n  const root = document.getElementById('genreFilters');\r\n  if(!root) return;\r\n  const activeCount = root.querySelectorAll('.chip.active').length;\r\n  root.dataset.state = activeCount > 0 ? 'active' : 'empty';\r\n  root.dataset.count = String(activeCount);\r\n}\r\n\r\nexport function initFilters(){\r\n  // populate sort options\r\n  const sortSel = qs('#sort');\r\n  if(sortSel && sortSel.options.length===0){\r\n    [['title-asc','Titel A\u2013Z'],['title-desc','Titel Z\u2013A'],['year-desc','Jahr \u2193'],['year-asc','Jahr \u2191'],['added-desc','Zuletzt hinzugef\u00FCgt']]\r\n      .forEach(([v,l])=> sortSel.add(new Option(l, v)));\r\n  }\r\n\r\n  const bind = (sel, ev='input')=>{\r\n    const n = qs(sel);\r\n    if(!n) return;\r\n    n.addEventListener(ev, ()=>{ updateFiltersAndGrid(); });\r\n    if(ev === 'input' && n instanceof HTMLInputElement && n.type === 'search'){\r\n      n.addEventListener('search', ()=>{ updateFiltersAndGrid(); });\r\n    }\r\n  };\r\n  bind('#search');\r\n  bind('#q');\r\n  bind('#onlyNew','change'); bind('#yearFrom','change'); bind('#yearTo','change'); bind('#collectionFilter','change'); bind('#sort','change'); bind('#groupCollections','change');\r\n  const yrReset = qs('#yearReset'); if(yrReset){ yrReset.addEventListener('click',()=>{ const a=qs('#yearFrom'); const b=qs('#yearTo'); if(a) a.value=''; if(b) b.value=''; updateFiltersAndGrid(); }); }\r\n  const gRoot = qs('#genreFilters');\r\n  if(gRoot){\r\n    gRoot.addEventListener('click', ev=>{\r\n      const t = ev.target;\r\n      if(!(t instanceof HTMLElement)) return;\r\n      if(!t.classList.contains('chip')) return;\r\n      t.classList.toggle('active');\r\n      updateGenreFilterState();\r\n      updateFiltersAndGrid();\r\n    });\r\n    updateGenreFilterState();\r\n  }\r\n}\r\n\r\n", "// Optional TMDB enrichment. Supports v4 Bearer token or v3 API key.\n\nconst API_V3 = 'https://api.themoviedb.org/3';\nconst IMG = 'https://image.tmdb.org/t/p/';\nconst POSTER_W = 'w342';\nconst BACKDROP_W = 'w780';\n\nlet cache;\n\nfunction loadCache(){\n  try{ return new Map(JSON.parse(localStorage.getItem('tmdbCache')||'[]')); }catch{ return new Map(); }\n}\nfunction persist(){ try{ localStorage.setItem('tmdbCache', JSON.stringify(Array.from(cache.entries()))); }catch{} }\nexport function clearCache(){ try{ localStorage.removeItem('tmdbCache'); cache = new Map(); }catch{} }\n\nfunction tokenFromEnv(cfg){\n  try{\n    const t = localStorage.getItem('tmdbToken');\n    if(t) return { kind:'bearer', value: t };\n  }catch{}\n  if(cfg?.tmdbApiKey) return { kind:'apikey', value: String(cfg.tmdbApiKey) };\n  return { kind:'none', value: '' };\n}\n\nfunction keyFor(item){\n  const t = (item.type==='tv') ? 'tv' : 'movie';\n  const imdb = item?.ids?.imdb || '';\n  const tmdb = item?.ids?.tmdb || '';\n  const title = (item.title||'').toLowerCase();\n  const year = String(item.year || '').slice(0,4);\n  return [t, imdb, tmdb, title, year].filter(Boolean).join('|');\n}\n\nfunction withAuth(url, auth){\n  if(!auth || auth.kind==='none') return { url, init:{} };\n  if(auth.kind==='bearer') return { url, init: { headers: { 'Authorization': `Bearer ${auth.value}`, 'Accept':'application/json' } } };\n  // v3 api key via query param\n  const sep = url.includes('?') ? '&' : '?';\n  return { url: `${url}${sep}api_key=${encodeURIComponent(auth.value)}`, init: { headers: { 'Accept':'application/json' } } };\n}\n\nasync function getJson(url, auth){\n  const { url: u, init } = withAuth(url, auth);\n  const res = await fetch(u, init);\n  if(!res.ok) throw new Error('HTTP '+res.status);\n  return res.json();\n}\n\nfunction pickBestPoster(p){ return p?.file_path ? IMG+POSTER_W+p.file_path : ''; }\nfunction pickBestBackdrop(p){ return p?.file_path ? IMG+BACKDROP_W+p.file_path : ''; }\n\nasync function byId(type, id, lang, auth){\n  const inf = await getJson(`${API_V3}/${type}/${id}?language=${encodeURIComponent(lang||'de-DE')}`, auth);\n  const images = await getJson(`${API_V3}/${type}/${id}/images`, auth).catch(()=>({ posters:[], backdrops:[] }));\n  const poster = pickBestPoster((images.posters||[])[0]) || (inf.poster_path ? IMG+POSTER_W+inf.poster_path : '');\n  const backdrop = pickBestBackdrop((images.backdrops||[])[0]) || (inf.backdrop_path ? IMG+BACKDROP_W+inf.backdrop_path : '');\n  return { id: inf.id, poster, backdrop, url: `https://www.themoviedb.org/${type}/${inf.id}` };\n}\n\nasync function bySearch(type, title, year, lang, auth){\n  const q = encodeURIComponent(title||'');\n  const yParam = year ? `&year=${encodeURIComponent(String(year))}` : '';\n  const res = await getJson(`${API_V3}/search/${type}?query=${q}${yParam}&language=${encodeURIComponent(lang||'de-DE')}`, auth);\n  const first = (res.results||[])[0];\n  if(!first) throw new Error('not found');\n  return byId(type, first.id, lang, auth);\n}\n\nasync function hydrateItem(item, cfg, auth){\n  const type = (item.type==='tv') ? 'tv' : 'movie';\n  const k = keyFor(item);\n  if(cache.has(k)) return cache.get(k);\n  let out;\n  try{\n    if(item?.ids?.tmdb){ out = await byId(type, item.ids.tmdb, cfg.lang, auth); }\n    else if(item?.ids?.imdb){\n      // find by external id\n      const json = await getJson(`${API_V3}/find/${item.ids.imdb}?external_source=imdb_id&language=${encodeURIComponent(cfg.lang||'de-DE')}`, auth);\n      const hit = (type==='movie' ? (json.movie_results||[])[0] : (json.tv_results||[])[0]);\n      if(hit) out = await byId(type, hit.id, cfg.lang, auth); else throw new Error('not found');\n    }else{\n      out = await bySearch(type, item.title, item.year, cfg.lang, auth);\n    }\n  }catch(e){ out = null; }\n  cache.set(k, out);\n  persist();\n  return out;\n}\n\nexport async function hydrateOptional(movies, shows, cfg={}){\n  try{\n    cache = cache || loadCache();\n    const auth = tokenFromEnv(cfg);\n    if(!auth.value) return;\n    const work = (movies||[]).concat(shows||[]);\n    let i = 0; const limit = 40; // keep it light\n    const next = async()=>{\n      const chunk = work.slice(i, i+4); i += 4;\n      await Promise.all(chunk.map(async (it)=>{\n        const data = await hydrateItem(it, cfg, auth);\n        if(data){\n          it.tmdb = { id:data.id, poster:data.poster, backdrop:data.backdrop, url:data.url };\n          it.ids = it.ids||{}; if(!it.ids.tmdb && data.id) it.ids.tmdb = String(data.id);\n        }\n      }));\n      try{ window.dispatchEvent(new CustomEvent('tmdb:chunk', { detail: { updated: chunk.length, index: i } })); }catch{}\n      if(i < Math.min(work.length, limit)) (window.requestIdleCallback||setTimeout)(next, 250);\n      else{ try{ window.dispatchEvent(new CustomEvent('tmdb:done', { detail: { total: Math.min(work.length, limit) } })); }catch{} }\n    };\n    next();\n  }catch{}\n}\n\n// Lightweight token validation used by settings UI\nexport async function validateToken(raw){\n  const token = String(raw||'').trim();\n  if(!token) throw new Error('empty');\n  const looksLikeV3 = /^[a-f0-9]{32}$/i.test(token);\n  const looksLikeJwt = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$/.test(token);\n  const decodeJwtPayload = (t)=>{\n    try{\n      const part = t.split('.')[1];\n      const pad = (s)=> s + '='.repeat((4 - (s.length % 4)) % 4);\n      const json = atob(pad(part.replace(/-/g,'+').replace(/_/g,'/')));\n      return JSON.parse(json);\n    }catch{ return null; }\n  };\n\n  // If it looks like a v3 API key, validate it against a protected v3 config endpoint\n  if(looksLikeV3){\n    const { url, init } = withAuth(`${API_V3}/configuration`, { kind:'apikey', value: token });\n    const res = await fetch(url, init);\n    if(res.ok) return { ok:true, as:'apikey', hint:'v3Key' };\n    return { ok:false, as:'apikey', hint:'looksV3' };\n  }\n\n  // Heuristic validation for v4 Bearer tokens (API Read Access Token):\n  // - Check JWT shape and issuer claim if present\n  // - Perform a benign v3 request with Bearer header to confirm CORS/connectivity\n  if(looksLikeJwt){\n    const payload = decodeJwtPayload(token);\n    if(payload && typeof payload === 'object'){\n      const iss = String(payload.iss||'');\n      if(iss && !/themoviedb\\.org/i.test(iss)){\n        return { ok:false, as:'bearer', hint:'issMismatch' };\n      }\n    }\n    const { url, init } = withAuth(`${API_V3}/trending/movie/day`, { kind:'bearer', value: token });\n    try{\n      const res = await fetch(url, init);\n      if(res.ok) return { ok:true, as:'bearer', hint:null };\n    }catch{}\n    // Some public endpoints ignore invalid Authorization headers; fall back to structural pass\n    return { ok:true, as:'bearer', hint:'structOnly' };\n  }\n\n  return { ok:false, as:'bearer', hint:null };\n}\n", "import { setState, getState } from './state.js';\r\nimport { showLoader, setLoader, hideLoader, showSkeleton, clearSkeleton } from './loader.js';\r\nimport * as Data from './data.js';\r\nimport * as Filter from './filter.js';\r\nimport { renderGrid } from './grid.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { hydrateOptional } from './services/tmdb.js';\r\nimport * as Watch from './watchlist.js';\r\nimport * as Debug from './debug.js';\r\nimport { humanYear, formatRating, useTmdbOn } from './utils.js';\r\nimport { initErrorHandler, showError, showRetryableError } from './errorHandler.js';\r\n// Scroll orchestration now handled by pure CSS - see animations.css\r\n\r\nlet currentHeroItem = null;\r\nlet heroDefaults = null;\r\n\r\nfunction setFooterStatus(message, busy=true){\r\n  const footer = document.getElementById('footerMeta');\r\n  if(footer){\r\n    const status = footer.querySelector('#footerStatus');\r\n    if(status) status.textContent = message;\r\n    else footer.textContent = message;\r\n    footer.dataset.state = busy ? 'loading' : 'ready';\r\n  }\r\n  const grid = document.getElementById('grid');\r\n  if(grid){\r\n    grid.setAttribute('aria-busy', busy ? 'true' : 'false');\r\n  }\r\n}\r\n\r\nasync function boot(){\r\n  initErrorHandler();\r\n  applyReduceMotionPref();\r\n  showLoader();\r\n  setFooterStatus('Initialisiere \u2026', true);\r\n  setLoader('Initialisiere \u2026', 8);\r\n  showSkeleton(18);\r\n\r\n  const cfg = await fetch('config.json').then(r=>r.json()).catch((err)=>{\r\n    console.warn('[main] Failed to load config.json, using defaults:', err.message);\r\n    showError('Konfiguration konnte nicht geladen werden', 'Verwende Standardeinstellungen');\r\n    return { startView:'movies', tmdbEnabled:false };\r\n  });\r\n  setState({ cfg, view: cfg.startView || 'movies' });\r\n\r\n  try {\r\n    setFooterStatus('Filme laden \u2026', true);\r\n    setLoader('Filme laden \u2026', 25);\r\n    const movies = await Data.loadMovies();\r\n    setFooterStatus('Serien laden \u2026', true);\r\n    setLoader('Serien laden \u2026', 45);\r\n    const shows  = await Data.loadShows();\r\n\r\n    setFooterStatus('Filter vorbereiten \u2026', true);\r\n    setLoader('Filter vorbereiten \u2026', 60);\r\n    // build facets (richer set via Filter)\r\n    const facets = Filter.computeFacets(movies, shows);\r\n    setState({ movies, shows, facets });\r\n\r\n    setFooterStatus('Ansicht aufbauen \u2026', true);\r\n    setLoader('Ansicht aufbauen \u2026', 85);\r\n    clearSkeleton();\r\n    renderSwitch();\r\n    Filter.renderFacets(facets);\r\n    Filter.initFilters();\r\n    Filter.applyFilters();\r\n    renderStats(true);\r\n    renderGrid(getState().view);\r\n    renderFooterMeta();\r\n\r\n    hideLoader();\r\n\r\n    if(cfg.tmdbEnabled) (window.requestIdleCallback || setTimeout)(()=> hydrateOptional?.(movies, shows, cfg), 400);\r\n\r\n    Watch.initUi();\r\n    initSettingsOverlay(cfg);\r\n    initAdvancedToggle();\r\n    initHeaderInteractions();\r\n    initScrollProgress();\r\n    initScrollTop();\r\n    // Scroll orchestrator temporarily disabled for pure CSS approach\r\n    // initFilterBarAutoHide();\r\n    // initScrollOrchestratorWithSettings();\r\n    renderHeroHighlight();\r\n    Debug.initDebugUi();\r\n  } catch (error) {\r\n    console.error('[main] Boot failed:', error);\r\n    hideLoader();\r\n    clearSkeleton();\r\n    showRetryableError('Fehler beim Laden der Daten', () => window.location.reload());\r\n    throw error;\r\n  }\r\n  // Re-render grid on TMDB hydration progress to reveal new posters\r\n  let tmdbRaf;\r\n  window.addEventListener('tmdb:chunk', ()=>{\r\n    if(tmdbRaf) return; // throttle to animation frame\r\n    tmdbRaf = requestAnimationFrame(()=>{\r\n      tmdbRaf = null;\r\n      try{\r\n        if(localStorage.getItem('useTmdb')==='1'){\r\n          renderGrid(getState().view);\r\n          renderHeroHighlight();\r\n        }\r\n      }catch(err){\r\n        console.warn('[main] TMDB chunk render failed:', err.message);\r\n      }\r\n    });\r\n  });\r\n  window.addEventListener('tmdb:done', ()=>{\r\n    try{\r\n      if(localStorage.getItem('useTmdb')==='1'){\r\n        renderGrid(getState().view);\r\n        renderHeroHighlight();\r\n      }\r\n    }catch(err){\r\n      console.warn('[main] TMDB done render failed:', err.message);\r\n    }\r\n  });\r\n}\r\n\r\n// Debounced hashchange handler to prevent race conditions\r\nlet hashchangeTimeout = null;\r\nlet lastProcessedHash = '';\r\n\r\nwindow.addEventListener('hashchange', ()=>{\r\n  if(window.__skipNextHashNavigation){\r\n    try{\r\n      window.__skipNextHashNavigation = false;\r\n      lastProcessedHash = location.hash || '';\r\n    }\r\n    catch(err){\r\n      console.warn('[main] Failed to reset skip navigation flag:', err.message);\r\n    }\r\n    return;\r\n  }\r\n\r\n  const currentHash = location.hash || '';\r\n\r\n  // Debounce rapid hash changes\r\n  if(hashchangeTimeout){\r\n    clearTimeout(hashchangeTimeout);\r\n  }\r\n\r\n  hashchangeTimeout = setTimeout(()=>{\r\n    // Skip if we already processed this hash\r\n    if(currentHash === lastProcessedHash) return;\r\n    lastProcessedHash = currentHash;\r\n\r\n    const hash = currentHash;\r\n    // deep link to views\r\n    if(/^#\\/(movies|shows)$/.test(hash)){\r\n      const view = hash.includes('shows') ? 'shows' : 'movies';\r\n      setState({ view });\r\n      const result = Filter.applyFilters();\r\n      renderSwitch();\r\n      renderGrid(view);\r\n      renderHeroHighlight(result);\r\n      return;\r\n    }\r\n    // item details\r\n    const m = hash.match(/^#\\/(movie|show)\\/(.+)/);\r\n    if(!m) return;\r\n    const [ , kind, id ] = m;\r\n    const pool = kind==='movie' ? getState().movies : getState().shows;\r\n    const item = (pool||[]).find(x => (x?.ids?.imdb===id || x?.ids?.tmdb===id || String(x?.ratingKey)===id));\r\n    if(!item) return;\r\n    if(kind === 'show') openSeriesModalV2(item);\r\n    else openMovieModalV2(item);\r\n  }, 50);\r\n});\r\n\r\nfunction renderSwitch(){\r\n  const root = document.getElementById('libraryTabs');\r\n  if(!root) return;\r\n  const buttons = Array.from(root.querySelectorAll('[data-lib]'));\r\n  const current = getState().view === 'shows' ? 'shows' : 'movies';\r\n  buttons.forEach(btn => {\r\n    const target = btn.dataset.lib === 'series' ? 'shows' : 'movies';\r\n    const isActive = current === target;\r\n    btn.classList.toggle('is-active', isActive);\r\n    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n    if(btn.dataset.bound === 'true') return;\r\n    btn.addEventListener('click', () => {\r\n      const view = btn.dataset.lib === 'series' ? 'shows' : 'movies';\r\n      if(getState().view === view) return;\r\n      setState({ view });\r\n      try{\r\n        window.__skipNextHashNavigation = true;\r\n      }catch(err){\r\n        console.warn('[main] Failed to set skip navigation flag:', err.message);\r\n      }\r\n      location.hash = view === 'movies' ? '#/movies' : '#/shows';\r\n      renderSwitch();\r\n      const result = Filter.applyFilters();\r\n      renderGrid(view);\r\n      renderHeroHighlight(result);\r\n    });\r\n    btn.dataset.bound = 'true';\r\n  });\r\n}\r\n\r\nfunction renderStats(animate=false){\r\n  const root = document.getElementById('heroStats');\r\n  if(!root) return;\r\n  const s = getState();\r\n  const movies = (s.movies||[]).length;\r\n  const shows = (s.shows||[]).length;\r\n  const elM = root.querySelector('[data-stat=\"movies\"]');\r\n  const elS = root.querySelector('[data-stat=\"shows\"]');\r\n  if(!elM || !elS) return;\r\n  if(animate){ countTo(elM, movies); countTo(elS, shows); }\r\n  else { elM.textContent=String(movies); elS.textContent=String(shows); }\r\n}\r\n\r\nfunction countTo(el, target){\r\n  if(!el) return;\r\n  const start = Number(el.textContent)||0;\r\n  const end = Number(target)||0;\r\n  if(start===end){ el.textContent = String(end); return; }\r\n  const dur = 480; // ms\r\n  const t0 = performance.now();\r\n  function step(t){\r\n    const p = Math.min(1, (t - t0) / dur);\r\n    const val = Math.round(start + (end - start) * (p<0.5 ? 2*p*p : -1 + (4 - 2*p) * p));\r\n    el.textContent = String(val);\r\n    if(p < 1) requestAnimationFrame(step); else el.textContent = String(end);\r\n  }\r\n  requestAnimationFrame(step);\r\n}\r\n\r\nfunction renderFooterMeta(){\r\n  const el = document.getElementById('footerMeta');\r\n  if(!el) return;\r\n  const status = document.getElementById('footerStatus');\r\n  const s = getState();\r\n  const movies = (s.movies||[]); const shows=(s.shows||[]);\r\n  const times = movies.concat(shows).map(x=> new Date(x.addedAt||0).getTime()).filter(Number.isFinite);\r\n  const latest = times.length ? new Date(Math.max(...times)) : new Date();\r\n  const date = latest.toISOString().slice(0,10);\r\n  if(status){\r\n    status.textContent = `Stand: ${date}`;\r\n  }\r\n  el.dataset.state = 'ready';\r\n  const grid = document.getElementById('grid');\r\n  if(grid){ grid.setAttribute('aria-busy', 'false'); }\r\n}\r\n\r\nfunction renderHeroHighlight(listOverride){\r\n  const hero = document.getElementById('hero');\r\n  const title = document.getElementById('heroTitle');\r\n  const subtitle = document.getElementById('heroSubtitle');\r\n  const cta = document.getElementById('heroCta');\r\n  if(!hero || !title || !subtitle || !cta) return;\r\n\r\n  ensureHeroDefaults();\r\n  const candidate = selectHeroItem(listOverride);\r\n\r\n  if(!candidate){\r\n    currentHeroItem = null;\r\n    title.textContent = heroDefaults.title;\r\n    subtitle.textContent = heroDefaults.subtitle;\r\n    subtitle.dataset.taglinePaused = '0';\r\n    delete subtitle.dataset.heroBound;\r\n    subtitle.classList.remove('is-fading');\r\n    cta.textContent = heroDefaults.cta;\r\n    cta.disabled = true;\r\n    cta.setAttribute('aria-disabled', 'true');\r\n    cta.removeAttribute('aria-label');\r\n    cta.onclick = null;\r\n    hero.style.backgroundImage = '';\r\n    hero.classList.remove('has-poster');\r\n    hero.dataset.heroKind = '';\r\n    hero.dataset.heroId = '';\r\n    return;\r\n  }\r\n\r\n  currentHeroItem = candidate;\r\n  const kind = candidate.type === 'tv' ? 'show' : 'movie';\r\n  const heroId = resolveHeroId(candidate);\r\n\r\n  title.textContent = candidate.title || heroDefaults.title;\r\n  subtitle.textContent = heroSubtitleText(candidate);\r\n  subtitle.dataset.taglinePaused = '1';\r\n  subtitle.dataset.heroBound = '1';\r\n  subtitle.classList.remove('is-fading');\r\n\r\n  const ctaLabel = kind === 'show' ? 'Serien-Details \u00F6ffnen' : 'Film-Details \u00F6ffnen';\r\n  cta.textContent = ctaLabel;\r\n  cta.disabled = false;\r\n  cta.setAttribute('aria-disabled', 'false');\r\n  cta.setAttribute('aria-label', candidate.title ? `${ctaLabel}: ${candidate.title}` : ctaLabel);\r\n  cta.onclick = ()=> openHeroModal(candidate, kind, heroId);\r\n\r\n  hero.dataset.heroKind = kind;\r\n  hero.dataset.heroId = heroId || '';\r\n\r\n  const background = resolveHeroBackdrop(candidate);\r\n  if(background){\r\n    hero.style.backgroundImage = `url(${background})`;\r\n    hero.classList.add('has-poster');\r\n  }else{\r\n    hero.style.backgroundImage = '';\r\n    hero.classList.remove('has-poster');\r\n  }\r\n}\r\n\r\n// Expose for hero autoplay timer\r\nwindow.__heroRefresh = renderHeroHighlight;\r\n\r\nfunction ensureHeroDefaults(){\r\n  if(heroDefaults) return;\r\n  heroDefaults = {\r\n    title: document.getElementById('heroTitle')?.textContent || '',\r\n    subtitle: document.getElementById('heroSubtitle')?.textContent || '',\r\n    cta: document.getElementById('heroCta')?.textContent || '',\r\n  };\r\n}\r\n\r\nfunction selectHeroItem(listOverride){\r\n  if(Array.isArray(listOverride)){\r\n    const playableOverride = listOverride.filter(isPlayableHeroItem);\r\n    if(!playableOverride.length) return null;\r\n    return chooseHeroCandidate(playableOverride);\r\n  }\r\n  const source = heroCandidatesFromState();\r\n  const playable = source.filter(isPlayableHeroItem);\r\n  if(!playable.length) return null;\r\n  return chooseHeroCandidate(playable);\r\n}\r\n\r\nfunction chooseHeroCandidate(list){\r\n  if(list.length === 1) return list[0];\r\n  const index = Math.floor(Math.random() * list.length);\r\n  const candidate = list[index];\r\n  if(currentHeroItem && list.length > 1 && candidate === currentHeroItem){\r\n    const alt = list.find(item=> item !== currentHeroItem);\r\n    return alt || candidate;\r\n  }\r\n  return candidate;\r\n}\r\n\r\nfunction heroCandidatesFromState(){\r\n  const state = getState();\r\n  const view = state.view === 'shows' ? 'shows' : 'movies';\r\n  const filtered = Array.isArray(state.filtered) && state.filtered.length ? state.filtered : null;\r\n  const list = filtered || (view === 'shows' ? state.shows : state.movies) || [];\r\n  return Array.isArray(list) ? list : [];\r\n}\r\n\r\nfunction isPlayableHeroItem(item){\r\n  return Boolean(item) && typeof item === 'object' && !item.isCollectionGroup && item.type !== 'collection';\r\n}\r\n\r\nfunction heroSubtitleText(item){\r\n  const meta = [];\r\n  const year = humanYear(item);\r\n  if(year) meta.push(String(year));\r\n  const runtime = heroRuntimeText(item);\r\n  if(runtime) meta.push(runtime);\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(rating)) meta.push(`\u2605 ${formatRating(rating)}`);\r\n  const genres = heroGenres(item, 2);\r\n  if(genres.length) meta.push(genres.join(', '));\r\n  const summary = heroSummaryText(item);\r\n  if(summary) return meta.length ? `${meta.join(' \u2022 ')} \u2014 ${summary}` : summary;\r\n  return meta.length ? meta.join(' \u2022 ') : heroDefaults?.subtitle || '';\r\n}\r\n\r\nfunction heroRuntimeText(item){\r\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  const minutes = Number(raw);\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\r\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\r\n  return `${minutes} min`;\r\n}\r\n\r\nfunction heroGenres(item, limit=3){\r\n  const list = Array.isArray(item?.genres) ? item.genres : [];\r\n  const names = [];\r\n  list.forEach(entry=>{\r\n    if(!entry) return;\r\n    if(typeof entry === 'string'){ names.push(entry); return; }\r\n    const name = entry.tag || entry.title || entry.name || entry.label || '';\r\n    if(name) names.push(name);\r\n  });\r\n  const unique = Array.from(new Set(names));\r\n  return unique.slice(0, Math.max(0, limit));\r\n}\r\n\r\nfunction heroSummaryText(item){\r\n  const sources = [item?.tagline, item?.summary, item?.plot, item?.overview];\r\n  for(const raw of sources){\r\n    if(typeof raw !== 'string') continue;\r\n    const text = raw.trim();\r\n    if(text) return truncateText(text, 220);\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction truncateText(text, maxLength){\r\n  const str = String(text || '').trim();\r\n  if(!str) return '';\r\n  if(str.length <= maxLength) return str;\r\n  return `${str.slice(0, Math.max(0, maxLength - 1)).trimEnd()}\u2026`;\r\n}\r\n\r\nfunction resolveHeroId(item){\r\n  if(!item) return '';\r\n  if(item?.ids?.imdb) return String(item.ids.imdb);\r\n  if(item?.ids?.tmdb) return String(item.ids.tmdb);\r\n  if(item?.ratingKey != null) return String(item.ratingKey);\r\n  return '';\r\n}\r\n\r\nfunction openHeroModal(item, kind, heroId){\r\n  if(heroId) navigateToItemHash(kind, heroId);\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n}\r\n\r\nfunction navigateToItemHash(kind, id){\r\n  if(!kind || !id) return;\r\n  const hash = `#/${kind}/${id}`;\r\n  try{\r\n    if(history && typeof history.pushState === 'function'){\r\n      if(location.hash === hash && typeof history.replaceState === 'function') history.replaceState(null, '', hash);\r\n      else history.pushState(null, '', hash);\r\n      return;\r\n    }\r\n  }catch(err){\r\n    console.warn('[main] Failed to navigate hash (pushState):', err.message);\r\n  }\r\n  try{\r\n    window.__skipNextHashNavigation = true;\r\n  }catch(err){\r\n    console.warn('[main] Failed to set skip navigation flag:', err.message);\r\n  }\r\n  location.hash = hash;\r\n}\r\n\r\nfunction resolveHeroBackdrop(item){\r\n  if(!item) return '';\r\n  const tmdbEnabled = useTmdbOn();\r\n  const tmdbCandidates = [\r\n    item?.tmdb?.backdrop,\r\n    item?.tmdb?.backdrop_path,\r\n    item?.tmdb?.backdropPath,\r\n    item?.tmdb?.background,\r\n    item?.tmdb?.art,\r\n  ];\r\n  const localCandidates = [\r\n    item?.art,\r\n    item?.background,\r\n    item?.thumbBackground,\r\n    item?.coverArt,\r\n    item?.thumb,\r\n    item?.thumbFile,\r\n  ];\r\n  if(tmdbEnabled){\r\n    const tmdb = tmdbCandidates.find(isValidMediaPath);\r\n    if(tmdb) return tmdb;\r\n  }\r\n  const local = localCandidates.find(isValidMediaPath);\r\n  return local || '';\r\n}\r\n\r\nfunction isValidMediaPath(value){\r\n  return typeof value === 'string' && value.trim().length > 0;\r\n}\r\n\r\nwindow.addEventListener('filters:updated', ev=>{\r\n  const detail = ev?.detail;\r\n  const items = Array.isArray(detail?.items) ? detail.items : null;\r\n  renderHeroHighlight(items);\r\n});\r\n\r\nboot();\r\n\r\n// Fallback: ensure the loading overlay is not left visible\r\n// in case an error interrupts the boot sequence.\r\nwindow.addEventListener('load', ()=>{\r\n  try{\r\n    hideLoader();\r\n  }catch(err){\r\n    console.warn('[main] Failed to hide loader on load event:', err.message);\r\n  }\r\n});\r\n\r\nfunction initSettingsOverlay(cfg){\r\n  const overlay = document.getElementById('settingsOverlay');\r\n  const dialog = overlay?.querySelector('.settings-dialog');\r\n  const open1 = document.getElementById('settingsBtn');\r\n  const open2 = document.getElementById('openSettings');\r\n  const headerSettingsBtn = document.getElementById('headerSettingsBtn');\r\n  const close2 = document.getElementById('settingsClose2');\r\n  const tmdbInput = document.getElementById('tmdbTokenInput');\r\n  const tmdbSave = document.getElementById('tmdbSave');\r\n  const tmdbTest = document.getElementById('tmdbTest');\r\n  const tmdbStatus = document.getElementById('tmdbStatus');\r\n  const tmdbClear = document.getElementById('tmdbClearCache');\r\n  const tmdbBadge = document.getElementById('tmdbStatusBadge');\r\n  const reduce = document.getElementById('prefReduceMotion');\r\n  const useTmdb = document.getElementById('useTmdbSetting');\r\n  const resetFilters = document.getElementById('resetFilters');\r\n\r\n  if(overlay && overlay.hidden) overlay.setAttribute('aria-hidden', 'true');\r\n\r\n  let restoreFocus = null;\r\n  let previousOverflow = '';\r\n  let isOpen = false;\r\n  const backgroundState = new Map();\r\n  const focusSelector = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])';\r\n\r\n  function getFocusable(){\r\n    if(!overlay) return [];\r\n    return Array.from(overlay.querySelectorAll(focusSelector)).filter(el=> !el.hasAttribute('disabled') && el.getAttribute('aria-hidden') !== 'true');\r\n  }\r\n\r\n  function focusDialog(){\r\n    if(dialog && typeof dialog.focus === 'function') dialog.focus({ preventScroll:true });\r\n    else if(overlay && typeof overlay.focus === 'function') overlay.focus({ preventScroll:true });\r\n  }\r\n\r\n  function setBackgroundInert(active){\r\n    if(!overlay) return;\r\n    const nodes = Array.from(document.body.children).filter(node=> node !== overlay);\r\n    if(active){\r\n      nodes.forEach(node=>{\r\n        if(!backgroundState.has(node)){\r\n          backgroundState.set(node, {\r\n            ariaHidden: node.hasAttribute('aria-hidden') ? node.getAttribute('aria-hidden') : null,\r\n            inert: node.hasAttribute('inert')\r\n          });\r\n        }\r\n        node.setAttribute('aria-hidden', 'true');\r\n        node.setAttribute('inert', '');\r\n      });\r\n    }else{\r\n      nodes.forEach(node=>{\r\n        const state = backgroundState.get(node);\r\n        if(state){\r\n          if(state.ariaHidden === null || state.ariaHidden === undefined) node.removeAttribute('aria-hidden');\r\n          else node.setAttribute('aria-hidden', state.ariaHidden);\r\n          if(state.inert) node.setAttribute('inert', '');\r\n          else node.removeAttribute('inert');\r\n          backgroundState.delete(node);\r\n        }else{\r\n          node.removeAttribute('aria-hidden');\r\n          node.removeAttribute('inert');\r\n        }\r\n      });\r\n      backgroundState.clear();\r\n    }\r\n  }\r\n\r\n  function openOverlay(){\r\n    if(!overlay || isOpen) return;\r\n    isOpen = true;\r\n    overlay.hidden = false;\r\n    overlay.setAttribute('aria-hidden', 'false');\r\n    restoreFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n    previousOverflow = document.body.style.overflow;\r\n    document.body.style.overflow = 'hidden';\r\n    setBackgroundInert(true);\r\n    syncSettingsUi();\r\n    requestAnimationFrame(focusDialog);\r\n\r\n    // Dispatch event for filter bar auto-hide\r\n    document.dispatchEvent(new CustomEvent('settings:open'));\r\n  }\r\n\r\n  function closeOverlay(){\r\n    if(!overlay || !isOpen) return;\r\n    isOpen = false;\r\n    overlay.hidden = true;\r\n    overlay.setAttribute('aria-hidden', 'true');\r\n    setBackgroundInert(false);\r\n    document.body.style.overflow = previousOverflow;\r\n    if(restoreFocus && typeof restoreFocus.focus === 'function'){ restoreFocus.focus(); }\r\n    restoreFocus = null;\r\n\r\n    // Dispatch event for filter bar auto-hide\r\n    document.dispatchEvent(new CustomEvent('settings:close'));\r\n  }\r\n\r\n  function handleKeydown(ev){\r\n    if(!isOpen) return;\r\n    if(ev.key === 'Escape'){\r\n      ev.preventDefault();\r\n      closeOverlay();\r\n      return;\r\n    }\r\n    if(ev.key !== 'Tab') return;\r\n    const focusable = getFocusable();\r\n    if(!focusable.length){\r\n      ev.preventDefault();\r\n      focusDialog();\r\n      return;\r\n    }\r\n    const first = focusable[0];\r\n    const last = focusable[focusable.length - 1];\r\n    const active = document.activeElement;\r\n    if(ev.shiftKey){\r\n      if(active === first || !overlay.contains(active)){\r\n        ev.preventDefault();\r\n        last.focus();\r\n      }\r\n    }else if(active === last){\r\n      ev.preventDefault();\r\n      first.focus();\r\n    }\r\n  }\r\n\r\n  open1 && open1.addEventListener('click', openOverlay);\r\n  open2 && open2.addEventListener('click', ()=>{ openOverlay(); });\r\n  headerSettingsBtn && headerSettingsBtn.addEventListener('click', openOverlay);\r\n  close2 && close2.addEventListener('click', closeOverlay);\r\n  overlay && overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closeOverlay(); });\r\n  overlay && overlay.addEventListener('keydown', handleKeydown);\r\n\r\n  function setTmdbStatus(msg='', kind=''){\r\n    if(!tmdbStatus) return;\r\n    tmdbStatus.textContent = msg;\r\n    tmdbStatus.dataset.kind = kind; // kind: success|error|info|pending\r\n    if(tmdbBadge){ tmdbBadge.dataset.kind = kind || ''; tmdbBadge.title = msg || ''; }\r\n    // Auto-Fallback: Bei Fehler und vorhandenem v3 API Key, gespeicherten ung\u00FCltigen Token entfernen\r\n    try{\r\n      if(kind==='error' && cfg && cfg.tmdbApiKey){\r\n        const stored = String(localStorage.getItem('tmdbToken')||'').trim();\r\n        const currentInput = String(tmdbInput?.value||'').trim();\r\n        if(stored && currentInput){\r\n          try{ localStorage.removeItem('tmdbToken'); }catch{}\r\n          if(tmdbInput) tmdbInput.value = '';\r\n          setUseTmdbAvailability(true);\r\n          const m = 'Ung\u00FCltiger Token entfernt. Verwende API Key aus config.json.';\r\n          tmdbStatus.textContent = m;\r\n          tmdbStatus.dataset.kind = 'info';\r\n          if(tmdbBadge){ tmdbBadge.dataset.kind = 'info'; tmdbBadge.title = m; }\r\n        }\r\n      }\r\n    }catch{}\r\n  }\r\n\r\n  function setUseTmdbAvailability(allowed){\r\n    if(!useTmdb) return;\r\n    useTmdb.disabled = !allowed;\r\n    useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token oder API Key.' : '';\r\n    if(!allowed && useTmdb.checked){\r\n      try{ localStorage.setItem('useTmdb', '0'); }catch{}\r\n      useTmdb.checked = false;\r\n      renderGrid(getState().view);\r\n    }\r\n  }\r\n\r\n  function syncSettingsUi(){\r\n    let token = '';\r\n    try{ tmdbInput && (tmdbInput.value = token = (localStorage.getItem('tmdbToken')||'')); }catch{}\r\n    try{ reduce && (reduce.checked = localStorage.getItem('prefReduceMotion')==='1'); }catch{}\r\n    try{ if(useTmdb){\r\n      useTmdb.checked = localStorage.getItem('useTmdb')==='1';\r\n      useTmdb.disabled = !token;\r\n      useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token.' : '';\r\n    } }catch{}\r\n    try{ setUseTmdbAvailability(!!token || !!(cfg&&cfg.tmdbApiKey)); }catch{}\r\n    setTmdbStatus('', '');\r\n    if(!token){ setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info'); }\r\n    if(!cfg?.tmdbEnabled){ setTmdbStatus('Hinweis: TMDB in config.json deaktiviert (tmdbEnabled=false).', 'info'); }\r\n    // Optional: Auto-Check bei ge\u00F6ffnetem Dialog\r\n    if(token){\r\n      (async()=>{\r\n        setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n        try{\r\n          const svc = await import('./services/tmdb.js');\r\n          const res = await svc.validateToken?.(token);\r\n          if(res && res.ok){\r\n            setUseTmdbAvailability(true);\r\n            if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n            else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n          }else{\r\n            setUseTmdbAvailability(false);\r\n            if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n            else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n          }\r\n        }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n      })();\r\n    } else { setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); }\r\n  }\r\n\r\n  tmdbSave && tmdbSave.addEventListener('click', async ()=>{\r\n    const raw = String(tmdbInput?.value||'').trim();\r\n    try{ localStorage.setItem('tmdbToken', raw); }catch{}\r\n    if(!raw){ setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info'); setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); return; }\r\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n    try{\r\n      const svc = await import('./services/tmdb.js');\r\n      const res = await svc.validateToken?.(raw);\r\n      if(res && res.ok){\r\n        setUseTmdbAvailability(true);\r\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n      }else{\r\n        setUseTmdbAvailability(false);\r\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n      }\r\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n  });\r\n\r\n  tmdbTest && tmdbTest.addEventListener('click', async ()=>{\r\n    const raw = String(tmdbInput?.value||'').trim();\r\n    if(!raw){ setTmdbStatus('Bitte Token eingeben.', 'error'); return; }\r\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n    try{\r\n      const svc = await import('./services/tmdb.js');\r\n      const res = await svc.validateToken?.(raw);\r\n      if(res && res.ok){\r\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n      }else{\r\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n      }\r\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n  });\r\n  tmdbClear && tmdbClear.addEventListener('click', ()=>{ import('./services/tmdb.js').then(m=>m.clearCache?.()); });\r\n  reduce && reduce.addEventListener('change', ()=>{\r\n    try{ localStorage.setItem('prefReduceMotion', reduce.checked ? '1' : '0'); }catch{}\r\n    setReduceMotionClass(reduce.checked);\r\n  });\r\n  useTmdb && useTmdb.addEventListener('change', ()=>{\r\n    try{ localStorage.setItem('useTmdb', useTmdb.checked ? '1' : '0'); }catch{}\r\n    // Start TMDB hydration when enabling the toggle (if not already started)\r\n    if(useTmdb.checked && !window.__tmdbHydrationStarted){\r\n      window.__tmdbHydrationStarted = 1;\r\n      import('./services/tmdb.js').then(m=>{\r\n        const s = getState();\r\n        m.hydrateOptional?.(s.movies, s.shows, s.cfg);\r\n      }).catch(()=>{});\r\n      // Re-render a bit later to reflect incoming posters\r\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 1200);\r\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 3000);\r\n    }\r\n    renderGrid(getState().view);\r\n    renderHeroHighlight();\r\n  });\r\n  resetFilters && resetFilters.addEventListener('click', ()=>{\r\n    const search = document.getElementById('search'); if(search) search.value='';\r\n    const q = document.getElementById('q'); if(q) q.value='';\r\n    const onlyNew = document.getElementById('onlyNew'); if(onlyNew) onlyNew.checked=false;\r\n    const yf = document.getElementById('yearFrom'); const yt = document.getElementById('yearTo'); if(yf) yf.value=''; if(yt) yt.value='';\r\n    const col = document.getElementById('collectionFilter'); if(col) col.value='';\r\n    document.querySelectorAll('#genreFilters .chip.active').forEach(n=>n.classList.remove('active'));\r\n    const genreRoot = document.getElementById('genreFilters');\r\n    if(genreRoot){\r\n      genreRoot.dataset.state = 'empty';\r\n      genreRoot.dataset.count = '0';\r\n    }\r\n    import('./filter.js').then(F=>{\r\n      const result = F.applyFilters();\r\n      renderGrid(getState().view);\r\n      renderHeroHighlight(result);\r\n    });\r\n  });\r\n\r\n}\r\n\r\nfunction setReduceMotionClass(pref){\r\n  try{\r\n    const body = document.body;\r\n    if(body){\r\n      document.documentElement?.classList.remove('reduce-motion', 'reduced-motion');\r\n      body.classList.remove('reduced-motion');\r\n      body.classList.toggle('reduce-motion', pref);\r\n    } else {\r\n      document.documentElement?.classList.toggle('reduce-motion', pref);\r\n      window.addEventListener('DOMContentLoaded', ()=> setReduceMotionClass(pref), { once: true });\r\n    }\r\n  }catch(err){\r\n    console.warn('[main] Failed to update reduce motion class:', err.message);\r\n  }\r\n}\r\n\r\nfunction applyReduceMotionPref(){\r\n  try{\r\n    const pref = localStorage.getItem('prefReduceMotion')==='1';\r\n    setReduceMotionClass(pref);\r\n  }catch(err){\r\n    console.warn('[main] Failed to apply reduce motion preference:', err.message);\r\n  }\r\n}\r\n\r\nfunction initAdvancedToggle(){\r\n  const btn = document.getElementById('toggleAdvanced');\r\n  const panel = document.getElementById('advancedFilters');\r\n  if(!btn || !panel) return;\r\n  let animating = false;\r\n  let fallbackTimer = 0;\r\n\r\n  const finishAnimation = ()=>{\r\n    animating = false;\r\n    if(fallbackTimer){\r\n      clearTimeout(fallbackTimer);\r\n      fallbackTimer = 0;\r\n    }\r\n    if(panel.dataset.state === 'closing'){\r\n      panel.dataset.state = 'closed';\r\n      panel.hidden = true;\r\n      panel.style.removeProperty('--advanced-max');\r\n    }else if(panel.dataset.state === 'open'){\r\n      panel.style.removeProperty('--advanced-max');\r\n    }else if(panel.dataset.state === 'expanding'){\r\n      panel.dataset.state = 'open';\r\n      panel.style.removeProperty('--advanced-max');\r\n    }\r\n  };\r\n\r\n  const queueFinish = ()=>{\r\n    if(fallbackTimer){\r\n      clearTimeout(fallbackTimer);\r\n    }\r\n    fallbackTimer = window.setTimeout(finishAnimation, 320);\r\n  };\r\n\r\n  panel.addEventListener('transitionend', event=>{\r\n    if(event.target !== panel || event.propertyName !== 'max-height') return;\r\n    finishAnimation();\r\n  });\r\n\r\n  const openPanel = ()=>{\r\n    if(animating) return;\r\n    animating = true;\r\n    panel.hidden = false;\r\n    panel.dataset.state = 'expanding';\r\n    panel.setAttribute('aria-hidden', 'false');\r\n    panel.style.setProperty('--advanced-max', '0px');\r\n    requestAnimationFrame(()=>{\r\n      const height = panel.scrollHeight;\r\n      panel.style.setProperty('--advanced-max', height + 'px');\r\n      panel.dataset.state = 'open';\r\n      queueFinish();\r\n    });\r\n  };\r\n\r\n  const closePanel = ()=>{\r\n    if(animating) return;\r\n    animating = true;\r\n    const height = panel.scrollHeight;\r\n    panel.style.setProperty('--advanced-max', height + 'px');\r\n    panel.dataset.state = 'closing';\r\n    panel.setAttribute('aria-hidden', 'true');\r\n    requestAnimationFrame(()=>{\r\n      panel.style.setProperty('--advanced-max', '0px');\r\n      queueFinish();\r\n    });\r\n  };\r\n\r\n  btn.addEventListener('click', ()=>{\r\n    const expanded = btn.getAttribute('aria-expanded') === 'true';\r\n    if(expanded){\r\n      btn.setAttribute('aria-expanded', 'false');\r\n      closePanel();\r\n    }else{\r\n      btn.setAttribute('aria-expanded', 'true');\r\n      openPanel();\r\n    }\r\n  });\r\n}\r\n\r\nfunction initHeaderInteractions(){\r\n  const siteLogo = document.getElementById('siteLogo');\r\n  if(siteLogo){\r\n    siteLogo.addEventListener('error', ()=>{\r\n      siteLogo.classList.add('logo-missing');\r\n      const titleEl = document.querySelector('.site-header__brand-text .site-header__label');\r\n      if(titleEl) titleEl.classList.remove('sr-only');\r\n    });\r\n  }\r\n  const subtitle = document.getElementById('heroSubtitle');\r\n  const TAGLINES = [\r\n    'Offline st\u00F6bern & Wunschlisten teilen',\r\n    'Filter. Finden. Freuen.',\r\n    'Filme & Serien \u2013 stressfrei sichtbar',\r\n    'Schneller als jeder SMB-Share',\r\n    'Merkliste zuerst, Streit sp\u00E4ter'\r\n  ];\r\n  let idx = 0; if(subtitle) subtitle.textContent = TAGLINES[idx];\r\n  function rotate(){\r\n    if(!subtitle || subtitle.dataset.taglinePaused==='1') return;\r\n    subtitle.classList.add('is-fading');\r\n    setTimeout(()=>{\r\n      if(!subtitle || subtitle.dataset.taglinePaused==='1'){ subtitle && subtitle.classList.remove('is-fading'); return; }\r\n      idx = (idx+1)%TAGLINES.length; subtitle.textContent = TAGLINES[idx]; subtitle.classList.remove('is-fading');\r\n    }, 280);\r\n  }\r\n  if(subtitle){ subtitle.dataset.taglinePaused='0'; if(!window.__taglineTicker){ window.__taglineTicker = setInterval(rotate, 6000); setTimeout(rotate, 3000); } }\r\n}\r\n\r\nfunction initScrollProgress(){\r\n  const bar = document.getElementById('scrollProgress');\r\n  if(!bar) return;\r\n  const update = ()=>{\r\n    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop || 0;\r\n    const height = (document.documentElement.scrollHeight - document.documentElement.clientHeight) || 1;\r\n    const pct = Math.max(0, Math.min(100, (scrollTop/height)*100));\r\n    bar.style.width = pct + '%';\r\n  };\r\n  addEventListener('scroll', update, { passive:true });\r\n  update();\r\n}\r\n\r\nfunction initScrollTop(){\r\n  const btn = document.getElementById('scrollTop');\r\n  if(!btn) return;\r\n  const toggle = ()=>{ const y = window.scrollY||0; btn.style.display = y>300 ? 'block' : 'none'; };\r\n  addEventListener('scroll', toggle, { passive:true });\r\n  toggle();\r\n  btn.addEventListener('click', ()=> window.scrollTo({ top:0, behavior:'smooth' }));\r\n}\r\n\r\n// Scroll orchestrator removed - using pure CSS scroll-driven animations instead\r\n// See animations.css for the new implementation\r\n", "import { qs, el } from './dom.js';\n\nlet overlay;\nlet bar;\nlet msgEl;\nlet skeletonRoot;\n\nfunction ensure(){\n  if(overlay) return;\n  overlay = qs('#loaderOverlay');\n  if(!overlay){\n    overlay = el('div','loader-overlay');\n    overlay.id = 'loaderOverlay';\n    // Start hidden by default so a partially executed boot sequence\n    // does not leave a dark overlay on screen.\n    overlay.hidden = true;\n    const box = el('div','loader');\n    msgEl = el('div','msg','');\n    bar = el('div','bar');\n    box.append(msgEl, bar);\n    overlay.append(box);\n    document.body.append(overlay);\n  }\n}\n\nexport function showLoader(){ ensure(); overlay.hidden = false; }\nexport function setLoader(msg, p){ ensure(); if(msgEl) msgEl.textContent = msg||''; if(bar) bar.style.width = (p||0)+\"%\"; }\nexport function hideLoader(){ ensure(); overlay.hidden = true; }\n\nexport function showSkeleton(count=18){\n  const grid = qs('#grid');\n  if(!grid) return;\n  skeletonRoot = el('div','skeleton');\n  for(let i=0;i<count;i++){ skeletonRoot.append(el('div','skel')); }\n  grid.replaceChildren(skeletonRoot);\n}\nexport function clearSkeleton(){\n  if(skeletonRoot && skeletonRoot.parentElement){ skeletonRoot.parentElement.removeChild(skeletonRoot); }\n  skeletonRoot = null;\n}\n", "import { getState } from './state.js';\r\nimport { getSources } from './data.js';\r\nimport { getCacheStats, clearAllCache, clearExpiredCache } from './cache.js';\r\n\r\nexport function initDebugUi(){\r\n  const open = document.getElementById('openDebug');\r\n  if(open){ open.addEventListener('click', ()=>{ openPanel(); }); }\r\n}\r\n\r\nfunction openPanel(){\r\n  let overlay = document.getElementById('debugOverlay');\r\n  if(!overlay){ overlay = document.createElement('div'); overlay.id='debugOverlay'; overlay.className='debug-overlay';\r\n    overlay.innerHTML = `\r\n      <div class=\"debug-dialog\">\r\n        <div class=\"debug-header\"><h2>Debug</h2></div>\r\n        <div class=\"debug-body\">\r\n          <pre id=\"debugPre\" class=\"debug-pre\"></pre>\r\n          <div class=\"debug-cache-controls\">\r\n            <h3>Cache-Verwaltung</h3>\r\n            <div id=\"cacheStats\" class=\"cache-stats\"></div>\r\n            <div class=\"cache-buttons\">\r\n              <button id=\"debugClearExpired\" class=\"btn\">Abgelaufene l\u00F6schen</button>\r\n              <button id=\"debugClearAll\" class=\"btn\">Alles l\u00F6schen</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"debug-actions\">\r\n          <button id=\"debugCopy\" class=\"btn\">Copy report</button>\r\n          <button id=\"debugClose\" class=\"btn\">Schlie\u00DFen</button>\r\n        </div>\r\n      </div>`;\r\n    document.body.append(overlay);\r\n  }\r\n  overlay.hidden = false;\r\n  render();\r\n  overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closePanel(); });\r\n  document.getElementById('debugClose')?.addEventListener('click', closePanel, { once:true });\r\n  document.getElementById('debugCopy')?.addEventListener('click', copyReport, { once:true });\r\n  document.getElementById('debugClearExpired')?.addEventListener('click', ()=>{\r\n    clearExpiredCache();\r\n    render();\r\n  }, { once:true });\r\n  document.getElementById('debugClearAll')?.addEventListener('click', ()=>{\r\n    if(confirm('Wirklich den gesamten Cache l\u00F6schen?')){\r\n      clearAllCache();\r\n      render();\r\n    }\r\n  }, { once:true });\r\n}\r\n\r\nfunction closePanel(){ const overlay = document.getElementById('debugOverlay'); if(overlay) overlay.hidden = true; }\r\n\r\nfunction render(){\r\n  const pre = document.getElementById('debugPre'); if(!pre) return;\r\n  const s = getState();\r\n  const src = getSources();\r\n  const cfg = s.cfg||{};\r\n  const cacheStats = getCacheStats();\r\n\r\n  const report = {\r\n    view: s.view,\r\n    counts: { movies: (s.movies||[]).length, shows: (s.shows||[]).length, filtered: (s.filtered||[]).length },\r\n    dataSources: src,\r\n    cache: cacheStats,\r\n    tmdb: { enabled: !!cfg.tmdbEnabled, lang: cfg.lang, tokenPresent: !!(localStorage.getItem('tmdbToken')||cfg.tmdbApiKey) },\r\n    useTmdbImages: localStorage.getItem('useTmdb')==='1',\r\n    reduceMotion: localStorage.getItem('prefReduceMotion')==='1',\r\n    locationHash: location.hash,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n  pre.textContent = JSON.stringify(report, null, 2);\r\n\r\n  // Update cache stats display\r\n  const statsEl = document.getElementById('cacheStats');\r\n  if(statsEl && cacheStats){\r\n    statsEl.innerHTML = `\r\n      <p>Eintr\u00E4ge gesamt: <strong>${cacheStats.totalEntries}</strong></p>\r\n      <p>G\u00FCltig: <strong>${cacheStats.validEntries}</strong> | Abgelaufen: <strong>${cacheStats.expiredEntries}</strong></p>\r\n      <p>Gr\u00F6\u00DFe: <strong>${cacheStats.totalSizeMB} MB</strong></p>\r\n    `;\r\n  }\r\n}\r\n\r\nfunction copyReport(){\r\n  const pre = document.getElementById('debugPre'); if(!pre) return;\r\n  const txt = pre.textContent || '';\r\n  navigator.clipboard?.writeText(txt).catch(()=>{\r\n    try{ const ta=document.createElement('textarea'); ta.value=txt; document.body.append(ta); ta.select(); document.execCommand('copy'); ta.remove(); }catch{}\r\n  });\r\n}\r\n\r\n", "/**\r\n * Global Error Handler\r\n * Provides centralized error handling and user feedback\r\n */\r\n\r\nlet errorContainer = null;\r\n\r\n/**\r\n * Initialize the error handler\r\n */\r\nexport function initErrorHandler() {\r\n  // Create error container if it doesn't exist\r\n  if (!errorContainer) {\r\n    errorContainer = document.createElement('div');\r\n    errorContainer.id = 'errorContainer';\r\n    errorContainer.className = 'error-container';\r\n    errorContainer.setAttribute('role', 'alert');\r\n    errorContainer.setAttribute('aria-live', 'polite');\r\n    document.body.appendChild(errorContainer);\r\n  }\r\n\r\n  // Global error handler for unhandled promise rejections\r\n  window.addEventListener('unhandledrejection', (event) => {\r\n    console.error('Unhandled promise rejection:', event.reason);\r\n    showError('Ein unerwarteter Fehler ist aufgetreten', event.reason?.message);\r\n    event.preventDefault();\r\n  });\r\n\r\n  // Global error handler for runtime errors\r\n  window.addEventListener('error', (event) => {\r\n    console.error('Runtime error:', event.error);\r\n    showError('Ein Fehler ist aufgetreten', event.error?.message);\r\n  });\r\n}\r\n\r\n/**\r\n * Show an error message to the user\r\n * @param {string} title - Error title\r\n * @param {string} message - Error message\r\n * @param {number} duration - Duration in ms (0 = permanent)\r\n */\r\nexport function showError(title, message = '', duration = 5000) {\r\n  if (!errorContainer) initErrorHandler();\r\n\r\n  const errorEl = document.createElement('div');\r\n  errorEl.className = 'error-toast';\r\n  errorEl.innerHTML = `\r\n    <div class=\"error-toast-content\">\r\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\r\n      <div class=\"error-toast-text\">\r\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\r\n        ${message ? `<div class=\"error-toast-message\">${escapeHtml(message)}</div>` : ''}\r\n      </div>\r\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\r\n    </div>\r\n  `;\r\n\r\n  const closeBtn = errorEl.querySelector('.error-toast-close');\r\n  closeBtn.addEventListener('click', () => {\r\n    errorEl.classList.add('error-toast-exit');\r\n    setTimeout(() => errorEl.remove(), 300);\r\n  });\r\n\r\n  errorContainer.appendChild(errorEl);\r\n\r\n  // Auto-remove after duration\r\n  if (duration > 0) {\r\n    setTimeout(() => {\r\n      if (errorEl.parentNode) {\r\n        errorEl.classList.add('error-toast-exit');\r\n        setTimeout(() => errorEl.remove(), 300);\r\n      }\r\n    }, duration);\r\n  }\r\n\r\n  // Animate in\r\n  requestAnimationFrame(() => {\r\n    errorEl.classList.add('error-toast-show');\r\n  });\r\n\r\n  return errorEl;\r\n}\r\n\r\n/**\r\n * Wrap an async function with error handling\r\n * @param {Function} fn - Async function to wrap\r\n * @param {string} errorTitle - Error title to show on failure\r\n * @returns {Function} Wrapped function\r\n */\r\nexport function withErrorHandling(fn, errorTitle = 'Ein Fehler ist aufgetreten') {\r\n  return async (...args) => {\r\n    try {\r\n      return await fn(...args);\r\n    } catch (error) {\r\n      console.error(`[${errorTitle}]`, error);\r\n      showError(errorTitle, error.message);\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Show a loading error with retry option\r\n * @param {string} title - Error title\r\n * @param {Function} retryFn - Function to call on retry\r\n */\r\nexport function showRetryableError(title, retryFn) {\r\n  if (!errorContainer) initErrorHandler();\r\n\r\n  const errorEl = document.createElement('div');\r\n  errorEl.className = 'error-toast error-toast-retryable';\r\n  errorEl.innerHTML = `\r\n    <div class=\"error-toast-content\">\r\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\r\n      <div class=\"error-toast-text\">\r\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\r\n      </div>\r\n      <button class=\"error-toast-retry\">Erneut versuchen</button>\r\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\r\n    </div>\r\n  `;\r\n\r\n  const retryBtn = errorEl.querySelector('.error-toast-retry');\r\n  const closeBtn = errorEl.querySelector('.error-toast-close');\r\n\r\n  retryBtn.addEventListener('click', async () => {\r\n    errorEl.remove();\r\n    try {\r\n      await retryFn();\r\n    } catch (err) {\r\n      console.error('Retry failed:', err);\r\n    }\r\n  });\r\n\r\n  closeBtn.addEventListener('click', () => {\r\n    errorEl.classList.add('error-toast-exit');\r\n    setTimeout(() => errorEl.remove(), 300);\r\n  });\r\n\r\n  errorContainer.appendChild(errorEl);\r\n\r\n  requestAnimationFrame(() => {\r\n    errorEl.classList.add('error-toast-show');\r\n  });\r\n\r\n  return errorEl;\r\n}\r\n\r\n/**\r\n * Clear all error messages\r\n */\r\nexport function clearErrors() {\r\n  if (errorContainer) {\r\n    errorContainer.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n * @param {string} str - String to escape\r\n * @returns {string} Escaped string\r\n */\r\nfunction escapeHtml(str) {\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n"],
  "mappings": "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",
  "names": ["setState", "patch", "S", "listeners", "fn", "getState", "init_state", "__esmMin", "el", "tag", "cls", "content", "n", "qs", "init_dom", "__esmMin", "s", "r", "setCache", "key", "value", "ttl", "cacheKey", "CACHE_PREFIX", "item", "checkCacheSize", "error", "cleanOldestEntries", "getCache", "cached", "now", "clearAllCache", "clearExpiredCache", "keys", "cleared", "getCacheStats", "cacheKeys", "k", "totalSize", "validEntries", "expiredEntries", "stats", "percentage", "cacheEntries", "a", "b", "toRemove", "i", "cleanupInterval", "init_cache", "__esmMin", "fetchJson", "url", "retries", "useCache", "cached", "getCache", "lastError", "attempt", "r", "data", "setCache", "DATA_CACHE_TTL", "err", "delay", "resolve", "embeddedJsonById", "id", "n", "fromGlobalBag", "key", "bag", "fromWindow", "varName", "loadWithCompat", "primaryUrl", "opts", "markSource", "emb", "win", "alt", "j", "prefixThumbValue", "value", "base", "raw", "SCHEME_RE", "normalizedRaw", "normalizedBase", "encodePath", "path", "segment", "segments", "normalizedSegments", "normalizedPath", "relativeSegments", "baseDir", "cleaned", "encoded", "prefixThumb", "obj", "_a", "_b", "current", "prefixed", "str", "prefixMovieThumb", "MOVIE_THUMB_BASE", "prefixShowThumb", "SHOW_THUMB_BASE", "prefixShowTree", "show", "prefixSeasonTree", "season", "ep", "normalizeMovieThumbs", "list", "item", "normalizeShowThumbs", "loadMovies", "movies", "loadRetryCount", "error", "MAX_RETRIES", "loadShows", "shows", "loadShowDetail", "keys", "cacheKeys", "getCachedDetail", "urls", "detailUrlCandidates", "normalized", "normalizeShowDetail", "storeDetail", "cloneDetail", "label", "src", "lastSources", "getSources", "href", "normalizeHrefKey", "showDetailCache", "val", "rk", "detailKey", "detailHref", "hrefKey", "withoutData", "idPart", "normalizeGenres", "castList", "normalizePeople", "normalizeSeason", "out", "normalizeEpisode", "seen", "result", "entry", "tag", "detail", "init_data", "__esmMin", "init_cache", "getGenreNames", "genres", "seen", "names", "entry", "name", "str", "renderChipsLimited", "container", "values", "limit", "vals", "head", "rest", "chips", "text", "chip", "more", "enableMoreChipBehavior", "root", "btn", "e", "card", "hidden", "ch", "humanYear", "item", "formatRating", "val", "trimmed", "num", "s", "isNew", "added", "cfg", "getState", "days", "useTmdbOn", "init_utils", "__esmMin", "init_state", "load", "saved", "STORAGE_KEY", "persist", "idFor", "item", "_a", "_b", "kind", "id", "isSaved", "count", "toggle", "k", "renderCount", "panel", "renderPanel", "el", "openPanel", "p", "closePanel", "setExpanded", "clear", "exportJson", "items", "listItems", "data", "blob", "a", "s", "getState", "pool", "map", "it", "list", "empty", "frag", "li", "t", "rm", "open", "initUi", "openBtn", "toggleBtn", "closeBtn", "clearBtn", "exportBtn", "on", "init_watchlist", "__esmMin", "init_state", "renderSeasonsAccordion", "targetOrSeasons", "maybeSeasons", "root", "resolveTarget", "seasons", "isTarget", "s", "idx", "seasonCardEl", "value", "season", "prefixShowThumb", "card", "head", "th", "img", "txt", "title", "sub", "year", "epCount", "chev", "body", "ep", "episodeRowEl", "_a", "row", "sNum", "eNum", "code", "right", "r", "b", "meta", "durMin", "durText", "dateText", "init_seasonsAccordion", "__esmMin", "init_data", "deepClone", "value", "entry", "out", "key", "mapMovie", "item", "clone", "mapShow", "normalizeShow", "mapDetail", "detail", "needsShowDetail", "seasons", "hasEpisodes", "season", "cast", "mergeShowDetail", "target", "mapped", "show", "normalizeThumbField", "normalizeGenresList", "normalizePeopleList", "normalizeSeasonEntry", "sc", "normalizeEpisodeEntry", "ep", "obj", "prefixShowThumb", "list", "seen", "result", "tag", "init_shared", "__esmMin", "init_data", "resolveRoot", "rootEl", "container", "overlayContainer", "onOverlayClick", "dialogEl", "scrollContainer", "existing", "ev", "target", "closeModalV2", "getFocusableElements", "el", "bindFocusTrap", "focusTrapHandler", "focusables", "first", "last", "unbindFocusTrap", "bindEscape", "escapeHandler", "unbindEscape", "showOverlay", "root", "focusInitial", "closeBtn", "focus", "resolvePoster", "item", "_a", "tmdbPoster", "localPoster", "useTmdbOn", "runtimeText", "minutes", "ratingText", "rating", "formatRating", "studioText", "releaseDateText", "candidates", "raw", "str", "parsed", "iso", "year", "humanYear", "namesFromList", "source", "entry", "genresFromItem", "mapped", "buildChips", "chips", "isNew", "genre", "buildCastList", "person", "_b", "_c", "name", "role", "rawRole", "tmdbProfile", "val", "thumb", "normalizeTmdbProfile", "path", "suffix", "TMDB_PROFILE_BASE", "TMDB_PROFILE_SIZE", "normalizeLocalImage", "resolveCastImage", "tmdbEnabled", "tmdbCandidates", "candidate", "url", "localCandidates", "castInitials", "chars", "part", "applyTabs", "tabs", "buttons", "select", "btn", "isActive", "pane", "moveFocus", "current", "delta", "currentIndex", "fallbackIndex", "index", "next", "initial", "updateCast", "cast", "scroll", "limited", "data", "card", "roleText", "avatar", "imageSrc", "img", "initials", "nameLine", "roleLine", "updateOverview", "text", "overview", "paragraph", "toggle", "setExpanded", "expanded", "cb", "updateDetails", "grid", "general", "release", "runtime", "studio", "certification", "formatOptionalRating", "value", "trimmed", "num", "critic", "audience", "user", "numericSeasons", "seasonCount", "episodeCount", "sum", "season", "eps", "countries", "collections", "labels", "section", "heading", "list", "label", "dt", "dd", "genres", "span", "crew", "directors", "writers", "producers", "creators", "fallback", "updateSeasons", "seasons", "renderSeasonsAccordion", "setExternalLinks", "tmdbBtn", "imdbBtn", "trailerBtn", "tmdbId", "imdbId", "trailer", "type", "populateHead", "titleEl", "tagline", "metaEl", "subEl", "metaParts", "chipsRoot", "quickFacts", "quickList", "facts", "contentRating", "src", "onPosterReady", "showModalV2Loading", "message", "loadingDiv", "renderModalV2", "hasSeasons", "openMovieModalV2", "idOrData", "token", "renderToken", "lastActiveElement", "resolveMovieData", "errorDiv", "currentItem", "currentKind", "openSeriesModalV2", "base", "resolveSeriesData", "working", "needsShowDetail", "detail", "loadShowDetail", "mergeShowDetail", "mapMovie", "DEMO_MOVIE", "state", "getState", "match", "movie", "matchesIdentifier", "mapShow", "DEMO_SERIES", "show", "id", "init_modalV2", "__esmMin", "init_seasonsAccordion", "init_utils", "init_state", "init_data", "init_shared", "grid_exports", "__export", "renderGrid", "cardEl", "item", "card", "el", "media", "img", "src", "resolvePoster", "gradient", "badges", "buildItemBadges", "badgeContainer", "badge", "pct", "progressPercent", "track", "fill", "body", "title", "sub", "metaPieces", "buildMetaPieces", "actions", "chips", "genres", "getGenreNames", "renderChipsLimited", "watchBtn", "updateWatchButtonState", "ev", "toggle", "openDetail", "collectionTags", "entry", "createCollectionGroup", "name", "members", "list", "a", "b", "ay", "humanYear", "by", "years", "year", "addedTimestamps", "latestAdded", "ratings", "_a", "rating", "sum", "val", "posterItem", "groupCollectionsIfEnabled", "items", "togg", "colSel", "selected", "membership", "groups", "collectionCardEl", "baseItem", "buildCollectionBadges", "pieces", "formatRating", "sel", "view", "movies", "shows", "filtered", "getState", "base", "grid", "beginGridTransition", "frag", "x", "finishGridTransition", "empty", "tmdbPoster", "useTmdbOn", "fallback", "isNew", "createBadge", "contentRating", "ratingNum", "text", "button", "saved", "isSaved", "runtime", "formatRuntime", "studio", "_b", "raw", "minutes", "offset", "duration", "resolveItemId", "preferred", "updateHash", "kind", "id", "hash", "openSeriesModalV2", "openMovieModalV2", "init_grid", "__esmMin", "init_state", "init_filter", "init_dom", "init_utils", "init_watchlist", "init_modalV2", "filter_exports", "__export", "applyFilters", "computeFacets", "initFilters", "renderFacets", "updateFiltersAndGrid", "humanYear", "item", "collectionTags", "entry", "isNew", "added", "cfg", "getState", "days", "norm", "s", "matches", "opts", "query", "onlyNew", "yearFrom", "yearTo", "genresActive", "selectedCollection", "getGenreNames", "r", "year", "itemGenres", "g", "sortItems", "items", "key", "arr", "a", "b", "movies", "shows", "genres", "years", "collections", "add", "x", "name", "y", "c", "ys", "f", "yFrom", "qs", "yTo", "col", "gRoot", "chips", "updateGenreFilterState", "getFilterOpts", "_a", "_b", "_c", "_d", "_e", "searchInput", "collection", "sort", "n", "pool", "filtered", "ordered", "setState", "renderGridForCurrentView", "gridModulePromise", "mod", "fn", "result", "notifyFiltersUpdated", "detail", "root", "activeCount", "sortSel", "v", "l", "bind", "sel", "ev", "yrReset", "t", "init_filter", "__esmMin", "init_state", "init_dom", "init_utils", "tmdb_exports", "__export", "clearCache", "hydrateOptional", "validateToken", "loadCache", "persist", "cache", "tokenFromEnv", "cfg", "keyFor", "item", "_a", "_b", "imdb", "tmdb", "title", "year", "withAuth", "url", "auth", "sep", "getJson", "u", "init", "res", "pickBestPoster", "p", "IMG", "POSTER_W", "pickBestBackdrop", "BACKDROP_W", "byId", "type", "id", "lang", "inf", "API_V3", "images", "poster", "backdrop", "bySearch", "q", "yParam", "first", "hydrateItem", "k", "out", "json", "hit", "movies", "shows", "work", "i", "limit", "next", "chunk", "it", "data", "raw", "token", "looksLikeV3", "looksLikeJwt", "decodeJwtPayload", "t", "part", "s", "payload", "iss", "init_tmdb", "__esmMin", "init_state", "init_dom", "overlay", "bar", "msgEl", "skeletonRoot", "ensure", "qs", "el", "box", "showLoader", "setLoader", "msg", "p", "hideLoader", "showSkeleton", "count", "grid", "i", "clearSkeleton", "init_data", "init_filter", "init_grid", "init_modalV2", "init_tmdb", "init_watchlist", "init_state", "init_data", "init_cache", "initDebugUi", "open", "openPanel", "_a", "_b", "_c", "_d", "overlay", "render", "ev", "closePanel", "copyReport", "clearExpiredCache", "clearAllCache", "pre", "s", "getState", "src", "getSources", "cfg", "cacheStats", "getCacheStats", "report", "statsEl", "txt", "ta", "init_utils", "errorContainer", "initErrorHandler", "event", "_a", "showError", "title", "message", "duration", "errorEl", "escapeHtml", "showRetryableError", "title", "retryFn", "errorContainer", "initErrorHandler", "errorEl", "escapeHtml", "retryBtn", "closeBtn", "escapeHtml", "str", "div", "currentHeroItem", "heroDefaults", "setFooterStatus", "message", "busy", "footer", "status", "grid", "boot", "initErrorHandler", "applyReduceMotionPref", "showLoader", "setLoader", "showSkeleton", "cfg", "r", "err", "showError", "setState", "movies", "loadMovies", "shows", "loadShows", "facets", "computeFacets", "clearSkeleton", "renderSwitch", "renderFacets", "initFilters", "applyFilters", "renderStats", "renderGrid", "getState", "renderFooterMeta", "hideLoader", "_a", "hydrateOptional", "initUi", "initSettingsOverlay", "initAdvancedToggle", "initHeaderInteractions", "initScrollProgress", "initScrollTop", "renderHeroHighlight", "initDebugUi", "error", "showRetryableError", "tmdbRaf", "hashchangeTimeout", "lastProcessedHash", "currentHash", "hash", "view", "result", "m", "kind", "id", "item", "x", "_b", "openSeriesModalV2", "openMovieModalV2", "root", "buttons", "current", "btn", "target", "isActive", "animate", "s", "elM", "elS", "countTo", "el", "start", "end", "dur", "t0", "step", "t", "p", "val", "times", "date", "listOverride", "hero", "title", "subtitle", "cta", "ensureHeroDefaults", "candidate", "selectHeroItem", "heroId", "resolveHeroId", "heroSubtitleText", "ctaLabel", "openHeroModal", "background", "resolveHeroBackdrop", "_c", "playableOverride", "isPlayableHeroItem", "chooseHeroCandidate", "playable", "heroCandidatesFromState", "list", "index", "state", "meta", "year", "humanYear", "runtime", "heroRuntimeText", "rating", "formatRating", "genres", "heroGenres", "summary", "heroSummaryText", "raw", "minutes", "limit", "names", "entry", "name", "sources", "text", "truncateText", "maxLength", "str", "navigateToItemHash", "_d", "_e", "tmdbEnabled", "useTmdbOn", "tmdbCandidates", "localCandidates", "tmdb", "isValidMediaPath", "value", "ev", "detail", "items", "overlay", "dialog", "open1", "open2", "headerSettingsBtn", "close2", "tmdbInput", "tmdbSave", "tmdbTest", "tmdbStatus", "tmdbClear", "tmdbBadge", "reduce", "useTmdb", "resetFilters", "restoreFocus", "previousOverflow", "isOpen", "backgroundState", "focusSelector", "getFocusable", "focusDialog", "setBackgroundInert", "active", "nodes", "node", "openOverlay", "syncSettingsUi", "closeOverlay", "handleKeydown", "focusable", "first", "last", "setTmdbStatus", "msg", "stored", "currentInput", "setUseTmdbAvailability", "allowed", "token", "svc", "res", "setReduceMotionClass", "search", "q", "onlyNew", "yf", "yt", "col", "n", "genreRoot", "F", "pref", "body", "panel", "animating", "fallbackTimer", "finishAnimation", "queueFinish", "event", "openPanel", "height", "closePanel", "siteLogo", "titleEl", "TAGLINES", "idx", "rotate", "bar", "update", "scrollTop", "pct", "toggle", "y"]
}
