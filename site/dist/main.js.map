{
  "version": 3,
  "sources": ["../js/state.js", "../js/dom.js", "../js/loader.js", "../js/cache.js", "../js/data/validators.js", "../js/errorHandler.js", "../js/data.js", "../js/utils.js", "../js/watchlist.js", "../js/modal/tabs.js", "../js/modal/headerSection.js", "../js/modal/overviewSection.js", "../js/modal/detailsSection.js", "../js/modal/seasonsAccordion.js", "../js/modal/seasonsSection.js", "../js/modal/externalLinks.js", "../js/modal/castSection.js", "../js/modal/shared.js", "../js/modal/demoData.js", "../js/modalV2.js", "../js/grid/virtualList.js", "../js/grid.js", "../js/filter.js", "../js/services/tmdb.js", "../js/debug.js", "../js/settingsOverlay.js", "../js/hero.js", "../js/hero-autoplay.js", "../js/main.js"],
  "sourcesContent": ["const S = { view: 'movies', movies: [], shows: [], facets: {}, filtered: [], cfg: {} };\nconst listeners = new Set();\n\nexport const getState = () => S;\nexport function setState(patch){ Object.assign(S, patch); listeners.forEach(fn=>fn(S)); }\nexport function subscribe(fn){ listeners.add(fn); return ()=>listeners.delete(fn); }\n", "export const qs  = (s, r=document) => r.querySelector(s);\nexport const qsa = (s, r=document) => [...r.querySelectorAll(s)];\nexport function el(tag, cls, content){\n  const n=document.createElement(tag);\n  if(cls) n.className=cls;\n  if(content!=null) n.textContent = content;\n  return n;\n}\n\n", "import { qs, el } from './dom.js';\n\nlet overlay;\nlet bar;\nlet msgEl;\nlet skeletonRoot;\n\nfunction ensure(){\n  if(overlay) return;\n  overlay = qs('#loaderOverlay');\n  if(!overlay){\n    overlay = el('div','loader-overlay');\n    overlay.id = 'loaderOverlay';\n    // Start hidden by default so a partially executed boot sequence\n    // does not leave a dark overlay on screen.\n    overlay.hidden = true;\n    const box = el('div','loader');\n    msgEl = el('div','msg','');\n    bar = el('div','bar');\n    box.append(msgEl, bar);\n    overlay.append(box);\n    document.body.append(overlay);\n  }\n}\n\nexport function showLoader(){ ensure(); overlay.hidden = false; }\nexport function setLoader(msg, p){ ensure(); if(msgEl) msgEl.textContent = msg||''; if(bar) bar.style.width = (p||0)+\"%\"; }\nexport function hideLoader(){ ensure(); overlay.hidden = true; }\n\nexport function showSkeleton(count=18){\n  const grid = qs('#grid');\n  if(!grid) return;\n  skeletonRoot = el('div','skeleton');\n  for(let i=0;i<count;i++){ skeletonRoot.append(el('div','skel')); }\n  grid.replaceChildren(skeletonRoot);\n}\nexport function clearSkeleton(){\n  if(skeletonRoot && skeletonRoot.parentElement){ skeletonRoot.parentElement.removeChild(skeletonRoot); }\n  skeletonRoot = null;\n}\n", "/**\r\n * Enhanced Caching System with TTL and Storage Management\r\n */\r\n\r\nconst CACHE_PREFIX = 'plex_cache_';\r\nconst DEFAULT_TTL = 1000 * 60 * 60 * 24; // 24 hours\r\nconst MAX_CACHE_SIZE = 5 * 1024 * 1024; // 5MB\r\n\r\n/**\r\n * Set an item in cache with TTL\r\n * @param {string} key - Cache key\r\n * @param {any} value - Value to cache\r\n * @param {number} ttl - Time to live in milliseconds\r\n */\r\nexport function setCache(key, value, ttl = DEFAULT_TTL) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    const item = {\r\n      value,\r\n      timestamp: Date.now(),\r\n      ttl\r\n    };\r\n    localStorage.setItem(cacheKey, JSON.stringify(item));\r\n\r\n    // Check if we're approaching storage limits\r\n    checkCacheSize();\r\n  } catch (error) {\r\n    if (error.name === 'QuotaExceededError') {\r\n      console.warn('[cache] Storage quota exceeded, cleaning old entries');\r\n      cleanOldestEntries();\r\n      // Try again after cleanup\r\n      try {\r\n        const cacheKey = CACHE_PREFIX + key;\r\n        const item = { value, timestamp: Date.now(), ttl };\r\n        localStorage.setItem(cacheKey, JSON.stringify(item));\r\n      } catch (retryError) {\r\n        console.error('[cache] Failed to cache after cleanup:', retryError);\r\n      }\r\n    } else {\r\n      console.error('[cache] Failed to set cache:', error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get an item from cache\r\n * @param {string} key - Cache key\r\n * @returns {any|null} Cached value or null if expired/not found\r\n */\r\nexport function getCache(key) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    const cached = localStorage.getItem(cacheKey);\r\n\r\n    if (!cached) return null;\r\n\r\n    const item = JSON.parse(cached);\r\n    if(typeof item.timestamp !== 'number' || typeof item.ttl !== 'number'){\r\n      localStorage.removeItem(cacheKey);\r\n      return null;\r\n    }\r\n    const now = Date.now();\r\n\r\n    // Check if expired\r\n    if (item.timestamp + item.ttl < now) {\r\n      localStorage.removeItem(cacheKey);\r\n      return null;\r\n    }\r\n\r\n    return item.value;\r\n  } catch (error) {\r\n    console.error('[cache] Failed to get cache:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove an item from cache\r\n * @param {string} key - Cache key\r\n */\r\nexport function removeCache(key) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    localStorage.removeItem(cacheKey);\r\n  } catch (error) {\r\n    console.error('[cache] Failed to remove cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all cache entries\r\n */\r\nexport function clearAllCache() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n    console.log('[cache] All cache cleared');\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clear cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear expired cache entries\r\n */\r\nexport function clearExpiredCache() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const now = Date.now();\r\n    let cleared = 0;\r\n\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        try {\r\n          const item = JSON.parse(localStorage.getItem(key));\r\n          if (item.timestamp + item.ttl < now) {\r\n            localStorage.removeItem(key);\r\n            cleared++;\r\n          }\r\n        } catch (e) {\r\n          // Invalid cache entry, remove it\r\n          localStorage.removeItem(key);\r\n          cleared++;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (cleared > 0) {\r\n      console.log(`[cache] Cleared ${cleared} expired entries`);\r\n    }\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clear expired cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nexport function getCacheStats() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const cacheKeys = keys.filter(k => k.startsWith(CACHE_PREFIX));\r\n    const now = Date.now();\r\n\r\n    let totalSize = 0;\r\n    let validEntries = 0;\r\n    let expiredEntries = 0;\r\n\r\n    cacheKeys.forEach(key => {\r\n      const value = localStorage.getItem(key);\r\n      totalSize += value.length * 2; // Approximate size in bytes (UTF-16)\r\n\r\n      try {\r\n        const item = JSON.parse(value);\r\n        if (item.timestamp + item.ttl >= now) {\r\n          validEntries++;\r\n        } else {\r\n          expiredEntries++;\r\n        }\r\n      } catch (e) {\r\n        expiredEntries++;\r\n      }\r\n    });\r\n\r\n    return {\r\n      totalEntries: cacheKeys.length,\r\n      validEntries,\r\n      expiredEntries,\r\n      totalSize,\r\n      totalSizeMB: (totalSize / 1024 / 1024).toFixed(2)\r\n    };\r\n  } catch (error) {\r\n    console.error('[cache] Failed to get cache stats:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Check cache size and clean if necessary\r\n */\r\nfunction checkCacheSize() {\r\n  try {\r\n    const stats = getCacheStats();\r\n    if (stats && stats.totalSize > MAX_CACHE_SIZE) {\r\n      console.warn('[cache] Cache size exceeded limit, cleaning...');\r\n      cleanOldestEntries(0.3); // Remove 30% of entries\r\n    }\r\n  } catch (error) {\r\n    console.error('[cache] Failed to check cache size:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clean oldest cache entries\r\n * @param {number} percentage - Percentage of entries to remove (0-1)\r\n */\r\nfunction cleanOldestEntries(percentage = 0.3) {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const cacheEntries = [];\r\n\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        try {\r\n          const item = JSON.parse(localStorage.getItem(key));\r\n          cacheEntries.push({ key, timestamp: item.timestamp });\r\n        } catch (e) {\r\n          // Invalid entry, mark for removal\r\n          cacheEntries.push({ key, timestamp: 0 });\r\n        }\r\n      }\r\n    });\r\n\r\n    // Sort by timestamp (oldest first)\r\n    cacheEntries.sort((a, b) => a.timestamp - b.timestamp);\r\n\r\n    // Remove oldest percentage\r\n    const toRemove = Math.ceil(cacheEntries.length * percentage);\r\n    for (let i = 0; i < toRemove; i++) {\r\n      localStorage.removeItem(cacheEntries[i].key);\r\n    }\r\n\r\n    console.log(`[cache] Removed ${toRemove} oldest entries`);\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clean oldest entries:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Cached fetch wrapper\r\n * @param {string} url - URL to fetch\r\n * @param {object} options - Fetch options\r\n * @param {number} ttl - Cache TTL in milliseconds\r\n */\r\nexport async function cachedFetch(url, options = {}, ttl = DEFAULT_TTL) {\r\n  const cacheKey = `fetch_${url}`;\r\n\r\n  // Try to get from cache first\r\n  const cached = getCache(cacheKey);\r\n  if (cached !== null) {\r\n    return cached;\r\n  }\r\n\r\n  // Fetch and cache\r\n  try {\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    setCache(cacheKey, data, ttl);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`[cache] Fetch failed for ${url}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Auto-cleanup on page load (only in real browser environments)\r\nlet cleanupInterval = null;\r\n\r\nif (typeof window !== 'undefined' && typeof window.document !== 'undefined' && window === globalThis) {\r\n  // Clear expired entries on load\r\n  clearExpiredCache();\r\n\r\n  // Periodic cleanup every 5 minutes\r\n  cleanupInterval = setInterval(clearExpiredCache, 5 * 60 * 1000);\r\n}\r\n\r\n/**\r\n * Stop the periodic cleanup interval (useful for testing)\r\n */\r\nexport function stopCleanupInterval() {\r\n  if (cleanupInterval) {\r\n    clearInterval(cleanupInterval);\r\n    cleanupInterval = null;\r\n  }\r\n}\r\n", "const LOG_PREFIX = '[data/validators]';\r\n\r\nconst MOVIE_DEFAULTS = Object.freeze({\r\n  thumb: '',\r\n  thumbFile: '',\r\n  summary: '',\r\n  href: '',\r\n  tagline: '',\r\n  genres: [],\r\n});\r\n\r\nconst SHOW_DEFAULTS = Object.freeze({\r\n  thumb: '',\r\n  thumbFile: '',\r\n  summary: '',\r\n  href: '',\r\n  tagline: '',\r\n  genres: [],\r\n  seasons: [],\r\n});\r\n\r\nconst MOVIE_ITEM_SCHEMA = Object.freeze({\r\n  type: 'object',\r\n  required: ['title', 'ratingKey'],\r\n  properties: {\r\n    title: { type: 'string' },\r\n    ratingKey: { type: ['string', 'number'] },\r\n    thumb: { type: 'string', nullable: true },\r\n    thumbFile: { type: 'string', nullable: true },\r\n    summary: { type: 'string', nullable: true },\r\n    href: { type: 'string', nullable: true },\r\n    tagline: { type: 'string', nullable: true },\r\n    genres: { type: 'array', items: { type: ['string', 'object'] }, nullable: true },\r\n  },\r\n});\r\n\r\nconst SEASON_SCHEMA = Object.freeze({\r\n  type: 'object',\r\n  properties: {\r\n    episodes: { type: 'array', items: { type: 'object' }, nullable: true },\r\n    thumb: { type: 'string', nullable: true },\r\n    thumbFile: { type: 'string', nullable: true },\r\n  },\r\n});\r\n\r\nconst SHOW_ITEM_SCHEMA = Object.freeze({\r\n  type: 'object',\r\n  required: ['title', 'ratingKey'],\r\n  properties: {\r\n    title: { type: 'string' },\r\n    ratingKey: { type: ['string', 'number'] },\r\n    thumb: { type: 'string', nullable: true },\r\n    thumbFile: { type: 'string', nullable: true },\r\n    summary: { type: 'string', nullable: true },\r\n    href: { type: 'string', nullable: true },\r\n    tagline: { type: 'string', nullable: true },\r\n    genres: { type: 'array', items: { type: ['string', 'object'] }, nullable: true },\r\n    seasons: { type: 'array', items: SEASON_SCHEMA, nullable: true },\r\n  },\r\n});\r\n\r\nconst MOVIE_LIST_SCHEMA = Object.freeze({ type: 'array', items: MOVIE_ITEM_SCHEMA });\r\nconst SHOW_LIST_SCHEMA = Object.freeze({ type: 'array', items: SHOW_ITEM_SCHEMA });\r\n\r\nfunction isPlainObject(value){\r\n  return value !== null && typeof value === 'object' && !Array.isArray(value);\r\n}\r\n\r\nfunction matchesType(value, type){\r\n  switch(type){\r\n    case 'string': return typeof value === 'string';\r\n    case 'number': return typeof value === 'number' && Number.isFinite(value);\r\n    case 'boolean': return typeof value === 'boolean';\r\n    case 'array': return Array.isArray(value);\r\n    case 'object': return isPlainObject(value);\r\n    default: return false;\r\n  }\r\n}\r\n\r\nfunction validateAgainstSchema(value, schema, path = 'value'){\r\n  if(!schema) return;\r\n  if(value == null){\r\n    if(schema.nullable) return;\r\n    throw new Error(`${path} darf nicht null oder undefined sein.`);\r\n  }\r\n  const expectedTypes = Array.isArray(schema.type) ? schema.type : [schema.type];\r\n  if(expectedTypes && expectedTypes.length){\r\n    const typeOk = expectedTypes.some(type => matchesType(value, type));\r\n    if(!typeOk){\r\n      const expected = expectedTypes.join(' oder ');\r\n      throw new Error(`${path} erwartet Typ ${expected}, erhielt ${typeof value}.`);\r\n    }\r\n  }\r\n  if(expectedTypes.includes('array')){\r\n    if(!Array.isArray(value)){\r\n      throw new Error(`${path} erwartet eine Liste.`);\r\n    }\r\n    if(schema.items){\r\n      value.forEach((item, index) => {\r\n        // Skip validation for genre items - they can be string or object with tag\r\n        if(path.includes('.genres') || path.includes('List') && schema.items.type &&\r\n           Array.isArray(schema.items.type) && schema.items.type.includes('string') && schema.items.type.includes('object')) {\r\n          return;\r\n        }\r\n        validateAgainstSchema(item, schema.items, `${path}[${index}]`);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  if(expectedTypes.includes('object')){\r\n    if(!isPlainObject(value)){\r\n      throw new Error(`${path} erwartet ein Objekt.`);\r\n    }\r\n    const required = schema.required || [];\r\n    for(const key of required){\r\n      const prop = value[key];\r\n      if(prop == null || (typeof prop === 'string' && !prop.trim())){\r\n        throw new Error(`${path}.${key} ist ein Pflichtfeld.`);\r\n      }\r\n    }\r\n    const properties = schema.properties || {};\r\n    for(const [key, definition] of Object.entries(properties)){\r\n      if(value[key] == null){\r\n        continue;\r\n      }\r\n      validateAgainstSchema(value[key], definition, `${path}.${key}`);\r\n    }\r\n  }\r\n}\r\n\r\nfunction ensureArrayOfStrings(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list\r\n    .map(item => {\r\n      if(typeof item === 'string') return item.trim();\r\n      if(item && typeof item === 'object' && typeof item.tag === 'string') return item.tag.trim();\r\n      return null;\r\n    })\r\n    .filter(item => item && item.length > 0);\r\n}\r\n\r\nfunction cloneWithDefaults(entry, defaults){\r\n  const result = { ...entry };\r\n  for(const [key, defaultValue] of Object.entries(defaults)){\r\n    if(result[key] == null){\r\n      result[key] = Array.isArray(defaultValue) ? [...defaultValue] : defaultValue;\r\n    }else if(Array.isArray(defaultValue)){\r\n      result[key] = Array.isArray(result[key]) ? [...result[key]] : [...defaultValue];\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function isMovieEntry(value){\r\n  if(!isPlainObject(value)) return false;\r\n  if(typeof value.title !== 'string' || !value.title.trim()) return false;\r\n  const ratingKey = value.ratingKey;\r\n  if(!(typeof ratingKey === 'string' || typeof ratingKey === 'number')) return false;\r\n  return true;\r\n}\r\n\r\nexport function isShowEntry(value){\r\n  if(!isMovieEntry(value)) return false;\r\n  if(value.seasons == null) return true;\r\n  if(!Array.isArray(value.seasons)) return false;\r\n  return value.seasons.every(season => isPlainObject(season));\r\n}\r\n\r\nfunction sanitizeMovieEntry(entry){\r\n  const result = cloneWithDefaults(entry, MOVIE_DEFAULTS);\r\n  result.title = result.title.trim();\r\n  result.ratingKey = String(entry.ratingKey).trim();\r\n  const thumbValue = typeof result.thumb === 'string' ? result.thumb : '';\r\n  const thumbFileValue = typeof result.thumbFile === 'string' ? result.thumbFile : '';\r\n  result.thumb = thumbValue;\r\n  result.thumbFile = thumbFileValue || thumbValue;\r\n  result.summary = typeof result.summary === 'string' ? result.summary : '';\r\n  result.href = typeof result.href === 'string' ? result.href : '';\r\n  result.tagline = typeof result.tagline === 'string' ? result.tagline : '';\r\n  result.genres = ensureArrayOfStrings(result.genres);\r\n  return result;\r\n}\r\n\r\nfunction sanitizeShowEntry(entry){\r\n  const result = cloneWithDefaults(entry, SHOW_DEFAULTS);\r\n  result.title = result.title.trim();\r\n  result.ratingKey = String(entry.ratingKey).trim();\r\n  const thumbValue = typeof result.thumb === 'string' ? result.thumb : '';\r\n  const thumbFileValue = typeof result.thumbFile === 'string' ? result.thumbFile : '';\r\n  result.thumb = thumbValue;\r\n  result.thumbFile = thumbFileValue || thumbValue;\r\n  result.summary = typeof result.summary === 'string' ? result.summary : '';\r\n  result.href = typeof result.href === 'string' ? result.href : '';\r\n  result.tagline = typeof result.tagline === 'string' ? result.tagline : '';\r\n  result.genres = ensureArrayOfStrings(result.genres);\r\n  if(Array.isArray(entry.seasons)){\r\n    result.seasons = entry.seasons\r\n      .filter(isPlainObject)\r\n      .map(season => {\r\n        const seasonCopy = { ...season };\r\n        seasonCopy.episodes = Array.isArray(season.episodes)\r\n          ? season.episodes.filter(isPlainObject).map(episode => ({ ...episode }))\r\n          : [];\r\n        if(typeof seasonCopy.thumb !== 'string') seasonCopy.thumb = '';\r\n        if(typeof seasonCopy.thumbFile !== 'string') seasonCopy.thumbFile = '';\r\n        return seasonCopy;\r\n      });\r\n  }else{\r\n    result.seasons = [];\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function validateLibraryList(data, kind = 'movie'){\r\n  const schema = kind === 'show' ? SHOW_LIST_SCHEMA : MOVIE_LIST_SCHEMA;\r\n  validateAgainstSchema(data, schema, `${kind}List`);\r\n  if(!Array.isArray(data)){\r\n    throw new Error('Datensatz ist keine Liste.');\r\n  }\r\n  const guard = kind === 'show' ? isShowEntry : isMovieEntry;\r\n  const sanitizer = kind === 'show' ? sanitizeShowEntry : sanitizeMovieEntry;\r\n  return data.map((entry, index) => {\r\n    if(!guard(entry)){\r\n      console.warn(`${LOG_PREFIX} Ung\u00FCltiger ${kind}-Eintrag an Index ${index}:`, entry);\r\n      throw new Error(`Ung\u00FCltiger ${kind}-Eintrag an Index ${index}.`);\r\n    }\r\n    return sanitizer(entry);\r\n  });\r\n}\r\n\r\nexport const __TEST_INTERNALS__ = {\r\n  MOVIE_DEFAULTS,\r\n  SHOW_DEFAULTS,\r\n  MOVIE_ITEM_SCHEMA,\r\n  SHOW_ITEM_SCHEMA,\r\n  MOVIE_LIST_SCHEMA,\r\n  SHOW_LIST_SCHEMA,\r\n  validateAgainstSchema,\r\n};\r\n", "/**\r\n * Global Error Handler\r\n * Provides centralized error handling and user feedback\r\n */\r\n\r\nlet errorContainer = null;\r\n\r\n/**\r\n * Initialize the error handler\r\n */\r\nexport function initErrorHandler() {\r\n  // Create error container if it doesn't exist\r\n  if (!errorContainer) {\r\n    errorContainer = document.createElement('div');\r\n    errorContainer.id = 'errorContainer';\r\n    errorContainer.className = 'error-container';\r\n    errorContainer.setAttribute('role', 'alert');\r\n    errorContainer.setAttribute('aria-live', 'polite');\r\n    document.body.appendChild(errorContainer);\r\n  }\r\n\r\n  // Global error handler for unhandled promise rejections\r\n  window.addEventListener('unhandledrejection', (event) => {\r\n    console.error('Unhandled promise rejection:', event.reason);\r\n    showError('Ein unerwarteter Fehler ist aufgetreten', event.reason?.message);\r\n    event.preventDefault();\r\n  });\r\n\r\n  // Global error handler for runtime errors\r\n  window.addEventListener('error', (event) => {\r\n    console.error('Runtime error:', event.error);\r\n    showError('Ein Fehler ist aufgetreten', event.error?.message);\r\n  });\r\n}\r\n\r\n/**\r\n * Show an error message to the user\r\n * @param {string} title - Error title\r\n * @param {string} message - Error message\r\n * @param {number} duration - Duration in ms (0 = permanent)\r\n */\r\nexport function showError(title, message = '', duration = 5000) {\r\n  if (!errorContainer) initErrorHandler();\r\n\r\n  const errorEl = document.createElement('div');\r\n  errorEl.className = 'error-toast';\r\n  errorEl.innerHTML = `\r\n    <div class=\"error-toast-content\">\r\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\r\n      <div class=\"error-toast-text\">\r\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\r\n        ${message ? `<div class=\"error-toast-message\">${escapeHtml(message)}</div>` : ''}\r\n      </div>\r\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\r\n    </div>\r\n  `;\r\n\r\n  const closeBtn = errorEl.querySelector('.error-toast-close');\r\n  closeBtn.addEventListener('click', () => {\r\n    errorEl.classList.add('error-toast-exit');\r\n    setTimeout(() => errorEl.remove(), 300);\r\n  });\r\n\r\n  errorContainer.appendChild(errorEl);\r\n\r\n  // Auto-remove after duration\r\n  if (duration > 0) {\r\n    setTimeout(() => {\r\n      if (errorEl.parentNode) {\r\n        errorEl.classList.add('error-toast-exit');\r\n        setTimeout(() => errorEl.remove(), 300);\r\n      }\r\n    }, duration);\r\n  }\r\n\r\n  // Animate in\r\n  requestAnimationFrame(() => {\r\n    errorEl.classList.add('error-toast-show');\r\n  });\r\n\r\n  return errorEl;\r\n}\r\n\r\n/**\r\n * Wrap an async function with error handling\r\n * @param {Function} fn - Async function to wrap\r\n * @param {string} errorTitle - Error title to show on failure\r\n * @returns {Function} Wrapped function\r\n */\r\nexport function withErrorHandling(fn, errorTitle = 'Ein Fehler ist aufgetreten') {\r\n  return async (...args) => {\r\n    try {\r\n      return await fn(...args);\r\n    } catch (error) {\r\n      console.error(`[${errorTitle}]`, error);\r\n      showError(errorTitle, error.message);\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Show a loading error with retry option\r\n * @param {string} title - Error title\r\n * @param {Function} retryFn - Function to call on retry\r\n */\r\nexport function showRetryableError(title, retryFn) {\r\n  if (!errorContainer) initErrorHandler();\r\n\r\n  const errorEl = document.createElement('div');\r\n  errorEl.className = 'error-toast error-toast-retryable';\r\n  errorEl.innerHTML = `\r\n    <div class=\"error-toast-content\">\r\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\r\n      <div class=\"error-toast-text\">\r\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\r\n      </div>\r\n      <button class=\"error-toast-retry\">Erneut versuchen</button>\r\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\r\n    </div>\r\n  `;\r\n\r\n  const retryBtn = errorEl.querySelector('.error-toast-retry');\r\n  const closeBtn = errorEl.querySelector('.error-toast-close');\r\n\r\n  retryBtn.addEventListener('click', async () => {\r\n    errorEl.remove();\r\n    try {\r\n      await retryFn();\r\n    } catch (err) {\r\n      console.error('Retry failed:', err);\r\n    }\r\n  });\r\n\r\n  closeBtn.addEventListener('click', () => {\r\n    errorEl.classList.add('error-toast-exit');\r\n    setTimeout(() => errorEl.remove(), 300);\r\n  });\r\n\r\n  errorContainer.appendChild(errorEl);\r\n\r\n  requestAnimationFrame(() => {\r\n    errorEl.classList.add('error-toast-show');\r\n  });\r\n\r\n  return errorEl;\r\n}\r\n\r\n/**\r\n * Clear all error messages\r\n */\r\nexport function clearErrors() {\r\n  if (errorContainer) {\r\n    errorContainer.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n * @param {string} str - String to escape\r\n * @returns {string} Escaped string\r\n */\r\nfunction escapeHtml(str) {\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n", "import { getCache, setCache } from './cache.js';\r\nimport { validateLibraryList } from './data/validators.js';\r\n\r\nconst LOG_PREFIX = '[data]';\r\n\r\nlet lastSources = { movies: null, shows: null };\r\nconst showDetailCache = new Map();\r\nconst DATA_CACHE_TTL = 1000 * 60 * 30; // 30 minutes for data files\r\n\r\nconst EXPORTER_BAG_KEY = '__PLEX_EXPORTER__';\r\n\r\nconst globalExporterBag = (()=>{\r\n  try{\r\n    if(typeof globalThis !== 'undefined'){\r\n      if(globalThis[EXPORTER_BAG_KEY]) return globalThis[EXPORTER_BAG_KEY];\r\n      if(globalThis.window && globalThis.window[EXPORTER_BAG_KEY]){\r\n        return globalThis.window[EXPORTER_BAG_KEY];\r\n      }\r\n    }\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to resolve global exporter bag:`, err?.message || err);\r\n  }\r\n  return null;\r\n})();\r\n\r\nconst MOVIE_THUMB_BASE = 'data/movies/';\r\nconst SHOW_THUMB_BASE = 'data/series/';\r\nconst SCHEME_RE = /^[a-z][a-z0-9+.-]*:/i;\r\n\r\nexport async function fetchJson(url, retries = 2, useCache = true){\r\n  // Try cache first if enabled\r\n  if(useCache){\r\n    const cached = getCache(url);\r\n    if(cached !== null) {\r\n      console.log(`${LOG_PREFIX} Cache hit for ${url}`);\r\n      return cached;\r\n    }\r\n  }\r\n\r\n  let lastError = null;\r\n  for(let attempt = 0; attempt <= retries; attempt++){\r\n    try{\r\n      const r = await fetch(url, { cache:'no-store' });\r\n      if(r && r.ok) {\r\n        const data = await r.json();\r\n        // Cache successful responses\r\n        if(useCache && data) {\r\n          setCache(url, data, DATA_CACHE_TTL);\r\n        }\r\n        return data;\r\n      }\r\n      if(r && r.status === 404) return null; // Don't retry 404s\r\n      lastError = new Error(`HTTP ${r.status}: ${r.statusText}`);\r\n    }\r\n    catch(err){\r\n      lastError = err;\r\n      console.warn(`${LOG_PREFIX} Fetch attempt ${attempt + 1}/${retries + 1} failed for ${url}:`, err.message);\r\n    }\r\n    if(attempt < retries){\r\n      // Exponential backoff\r\n      const delay = Math.min(1000 * Math.pow(2, attempt), 5000);\r\n      await new Promise(resolve => setTimeout(resolve, delay));\r\n    }\r\n  }\r\n  const message = lastError?.message || 'Unbekannter Fehler';\r\n  console.error(`${LOG_PREFIX} All fetch attempts failed for ${url}:`, message);\r\n  const error = new Error(`Daten konnten nicht geladen werden: ${url} (${message})`);\r\n  if(lastError && typeof lastError === 'object'){\r\n    error.cause = lastError;\r\n  }\r\n  throw error;\r\n}\r\n\r\nfunction embeddedJsonById(id){\r\n  try{\r\n    const n = document.getElementById(id);\r\n    if(n && n.textContent) return JSON.parse(n.textContent);\r\n  }\r\n  catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to parse embedded JSON #${id}:`, err.message);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction fromGlobalBag(key){\r\n  try{\r\n    const bag = globalExporterBag;\r\n    const arr = bag && Array.isArray(bag[key]) ? bag[key] : null;\r\n    return arr || null;\r\n  }\r\n  catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to access global bag[${key}]:`, err.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction fromWindow(varName){\r\n  try{\r\n    const arr = Array.isArray(window[varName]) ? window[varName] : null;\r\n    return arr || null;\r\n  }\r\n  catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to access window.${varName}:`, err.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function loadWithCompat(primaryUrl, opts){\r\n  // default: try site/data first\r\n  let data = null;\r\n  try{\r\n    data = await fetchJson(primaryUrl);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Primary source failed for ${primaryUrl}:`, err.message);\r\n    data = null;\r\n  }\r\n  if(Array.isArray(data) && data.length){ markSource(opts?.label, `primary:${primaryUrl}`); return data; }\r\n  // fallback: embedded <script id=\"...\"> JSON\r\n  if(opts?.embedId){ const emb = embeddedJsonById(opts.embedId); if(Array.isArray(emb) && emb.length){ markSource(opts?.label, `embedded:${opts.embedId}`); return emb; } }\r\n  // fallback: global exporter bag\r\n  if(opts?.exportKey){ const bag = fromGlobalBag(opts.exportKey); if(Array.isArray(bag) && bag.length){ markSource(opts?.label, `globalBag:${opts.exportKey}`); return bag; } }\r\n  // fallback: window variable\r\n  if(opts?.globalVar){ const win = fromWindow(opts.globalVar); if(Array.isArray(win) && win.length){ markSource(opts?.label, `window:${opts.globalVar}`); return win; } }\r\n  // alt paths (legacy)\r\n  for(const alt of (opts?.altUrls||[])){\r\n    let altData = null;\r\n    try{\r\n      altData = await fetchJson(alt);\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Alternate source failed for ${alt}:`, err.message);\r\n      altData = null;\r\n    }\r\n    if(Array.isArray(altData) && altData.length){ markSource(opts?.label, `alt:${alt}`); return altData; }\r\n  }\r\n  // last resort: empty array\r\n  markSource(opts?.label, 'empty');\r\n  return Array.isArray(data) ? data : [];\r\n}\r\n\r\nfunction notifyUiError(title, message){\r\n  if(typeof window === 'undefined' || typeof document === 'undefined' || typeof document.createElement !== 'function'){\r\n    console.warn(`${LOG_PREFIX} Skipping UI error feedback (environment missing DOM APIs): ${title} - ${message}`);\r\n    return;\r\n  }\r\n  import('./errorHandler.js').then(mod=>{\r\n    try{\r\n      mod.showError?.(title, message, 8000);\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Failed to display UI error message:`, err?.message || err);\r\n    }\r\n  }).catch(err=>{\r\n    console.warn(`${LOG_PREFIX} Failed to load error handler for UI feedback:`, err?.message || err);\r\n  });\r\n}\r\n\r\nexport function prefixThumbValue(value, base){\r\n  const raw = value == null ? '' : String(value).trim();\r\n  if(!raw) return '';\r\n  if(raw.startsWith('//') || raw.startsWith('/') || SCHEME_RE.test(raw)) return raw;\r\n  const normalizedRaw = raw.replace(/\\\\/g, '/');\r\n  const normalizedBase = base ? (base.endsWith('/') ? base : `${base}/`) : '';\r\n  let decodeWarned = false;\r\n  const encodePath = path => path.split('/').map(segment => {\r\n    if(!segment) return '';\r\n    try{\r\n      return encodeURIComponent(decodeURIComponent(segment));\r\n    }catch(err){\r\n      if(!decodeWarned){\r\n        decodeWarned = true;\r\n        console.warn(`${LOG_PREFIX} Failed to normalize thumb segment \"${segment}\":`, err);\r\n      }\r\n      return encodeURIComponent(segment);\r\n    }\r\n  }).join('/');\r\n  const trimmed = normalizedRaw.replace(/^\\/+/, '');\r\n  const segments = trimmed.split('/');\r\n  const normalizedSegments = [];\r\n  for(const segment of segments){\r\n    if(!segment || segment === '.') continue;\r\n    if(segment === '..'){\r\n      if(normalizedSegments.length) normalizedSegments.pop();\r\n      continue;\r\n    }\r\n    normalizedSegments.push(segment);\r\n  }\r\n  const normalizedPath = normalizedSegments.join('/');\r\n  if(normalizedPath.startsWith('data/')) return encodePath(normalizedPath);\r\n  let relativeSegments = normalizedSegments;\r\n  if(normalizedBase && relativeSegments.length){\r\n    const baseDir = normalizedBase.replace(/\\/+$/, '').split('/').pop();\r\n    if(baseDir && relativeSegments[0] === baseDir){\r\n      relativeSegments = relativeSegments.slice(1);\r\n    }\r\n  }\r\n  const cleaned = relativeSegments.join('/');\r\n  const encoded = encodePath(cleaned);\r\n  return `${normalizedBase}${encoded}`;\r\n}\r\n\r\n\r\nexport function prefixThumb(obj, base){\r\n  if(!obj || typeof obj !== 'object') return obj;\r\n  const current = obj.thumbFile ?? obj.thumb ?? '';\r\n  const prefixed = prefixThumbValue(current, base);\r\n  if(prefixed){\r\n    obj.thumbFile = prefixed;\r\n    obj.thumb = prefixed;\r\n  }else if(current){\r\n    const str = String(current);\r\n    obj.thumbFile = str;\r\n    if(obj.thumb == null) obj.thumb = str;\r\n  }\r\n  return obj;\r\n}\r\n\r\nexport function prefixMovieThumb(obj){\r\n  return prefixThumb(obj, MOVIE_THUMB_BASE);\r\n}\r\n\r\nexport function prefixShowThumb(obj){\r\n  return prefixThumb(obj, SHOW_THUMB_BASE);\r\n}\r\n\r\nexport function prefixShowTree(show){\r\n  if(!show || typeof show !== 'object') return show;\r\n  prefixShowThumb(show);\r\n  if(Array.isArray(show.seasons)) show.seasons.forEach(prefixSeasonTree);\r\n  return show;\r\n}\r\n\r\nfunction prefixSeasonTree(season){\r\n  if(!season || typeof season !== 'object') return season;\r\n  prefixShowThumb(season);\r\n  if(Array.isArray(season.episodes)) season.episodes.forEach(ep=>prefixShowThumb(ep));\r\n  return season;\r\n}\r\n\r\nfunction normalizeMovieThumbs(list){\r\n  if(!Array.isArray(list)) return [];\r\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixMovieThumb(item); });\r\n  return list;\r\n}\r\n\r\nfunction normalizeShowThumbs(list){\r\n  if(!Array.isArray(list)) return [];\r\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixShowTree(item); });\r\n  return list;\r\n}\r\n\r\nexport async function loadMovies(){\r\n  try {\r\n    const rawMovies = await loadWithCompat('data/movies/movies.json', {\r\n      label: 'movies',\r\n      embedId: 'movies-json',\r\n      exportKey: 'movies',\r\n      globalVar: '__PLEX_MOVIES__',\r\n      altUrls: [\r\n        'movies/movies.json',\r\n        'data/movies.json',\r\n        'Filme/movies.json',\r\n        'movies.json',\r\n      ],\r\n    });\r\n    let movies;\r\n    try{\r\n      movies = validateLibraryList(rawMovies, 'movie');\r\n    }catch(validationError){\r\n      const message = validationError?.message || 'Unbekannte Validierungsfehler';\r\n      console.warn(`${LOG_PREFIX} Movie validation failed:`, validationError);\r\n      const error = new Error(`Ung\u00FCltige Filmdaten: ${message}`);\r\n      if(validationError instanceof Error){\r\n        error.cause = validationError;\r\n      }\r\n      throw error;\r\n    }\r\n    return normalizeMovieThumbs(movies);\r\n  } catch (error) {\r\n    console.error(`${LOG_PREFIX} loadMovies failed:`, error);\r\n    notifyUiError('Filme konnten nicht geladen werden', error?.message || 'Unbekannter Fehler');\r\n    return [];\r\n  }\r\n}\r\nexport async function loadShows(){\r\n  try {\r\n    const rawShows = await loadWithCompat('data/series/series_index.json', {\r\n      label: 'shows',\r\n      embedId: 'series-json',\r\n      exportKey: 'shows',\r\n      globalVar: '__PLEX_SHOWS__',\r\n      altUrls: [\r\n        'series/series_index.json',\r\n        'data/shows.json',\r\n        'data/series.json',\r\n        'Serien/series.json',\r\n        'series/series.json',\r\n        'series.json',\r\n        'shows.json',\r\n      ],\r\n    });\r\n    let shows;\r\n    try{\r\n      shows = validateLibraryList(rawShows, 'show');\r\n    }catch(validationError){\r\n      const message = validationError?.message || 'Unbekannte Validierungsfehler';\r\n      console.warn(`${LOG_PREFIX} Show validation failed:`, validationError);\r\n      const error = new Error(`Ung\u00FCltige Seriendaten: ${message}`);\r\n      if(validationError instanceof Error){\r\n        error.cause = validationError;\r\n      }\r\n      throw error;\r\n    }\r\n    return normalizeShowThumbs(shows);\r\n  } catch (error) {\r\n    console.error(`${LOG_PREFIX} loadShows failed:`, error);\r\n    notifyUiError('Serien konnten nicht geladen werden', error?.message || 'Unbekannter Fehler');\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function loadShowDetail(item){\r\n  if(!item) return null;\r\n  const keys = cacheKeys(item);\r\n  const cached = getCachedDetail(keys);\r\n  if(cached !== undefined) return cached;\r\n\r\n  const urls = detailUrlCandidates(item);\r\n  let lastError = null;\r\n\r\n  for(const url of urls){\r\n    try {\r\n      const data = await fetchJson(url);\r\n      if(data && typeof data === 'object'){\r\n        const normalized = normalizeShowDetail(data);\r\n        storeDetail(keys, normalized, item);\r\n        return cloneDetail(normalized);\r\n      }\r\n    } catch (error) {\r\n      lastError = error;\r\n      console.warn(`${LOG_PREFIX} Failed to load show detail from ${url}:`, error.message);\r\n    }\r\n  }\r\n\r\n  if(lastError) {\r\n    console.error(`${LOG_PREFIX} Could not load show detail for ${item.title || 'unknown'}`, lastError);\r\n    notifyUiError('Details konnten nicht geladen werden', lastError?.message || 'Bitte sp\u00E4ter erneut versuchen.');\r\n  }\r\n\r\n  storeDetail(keys, null, item);\r\n  return null;\r\n}\r\n\r\nfunction markSource(label, src){\r\n  if(!label) return;\r\n  try{\r\n    lastSources[label] = src;\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to record source for ${label}:`, err);\r\n  }\r\n}\r\n\r\nexport function getSources(){ return { ...lastSources }; }\r\nfunction cacheKeys(item){\r\n  const keys = [];\r\n  if(item?.ratingKey !== undefined && item?.ratingKey !== null && item?.ratingKey !== ''){\r\n    keys.push(`rk:${String(item.ratingKey)}`);\r\n  }\r\n  const href = normalizeHrefKey(item?.href);\r\n  if(href) keys.push(`href:${href}`);\r\n  return keys;\r\n}\r\n\r\nfunction normalizeHrefKey(href){\r\n  if(!href) return '';\r\n  return String(href).trim().replace(/^\\.\\//,'').replace(/^\\/+/, '');\r\n}\r\n\r\nfunction getCachedDetail(keys){\r\n  for(const key of keys){\r\n    if(showDetailCache.has(key)){\r\n      const cached = showDetailCache.get(key);\r\n      return cached ? cloneDetail(cached) : null;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction storeDetail(keys, value, item){\r\n  const val = value;\r\n  keys.forEach(key=>{ showDetailCache.set(key, val); });\r\n  const rk = item?.ratingKey;\r\n  if(rk !== undefined && rk !== null){\r\n    showDetailCache.set(`rk:${String(rk)}`, val);\r\n  }\r\n  const detailKey = value && typeof value === 'object' ? value.ratingKey : undefined;\r\n  if(detailKey !== undefined && detailKey !== null){\r\n    showDetailCache.set(`rk:${String(detailKey)}`, val);\r\n  }\r\n  const href = normalizeHrefKey(item?.href);\r\n  if(href){\r\n    showDetailCache.set(`href:${href}`, val);\r\n  }\r\n  const detailHref = value && typeof value === 'object' ? normalizeHrefKey(value.href) : '';\r\n  if(detailHref){\r\n    showDetailCache.set(`href:${detailHref}`, val);\r\n  }\r\n}\r\n\r\nfunction detailUrlCandidates(item){\r\n  const urls = new Set();\r\n  const hrefKey = normalizeHrefKey(item?.href);\r\n  if(hrefKey){\r\n    if(/^https?:/i.test(hrefKey)){ urls.add(hrefKey); }\r\n    else{\r\n      if(hrefKey.startsWith('data/')) urls.add(hrefKey);\r\n      else urls.add(`data/${hrefKey}`);\r\n      const withoutData = hrefKey.replace(/^data\\//,'');\r\n      if(!withoutData.startsWith('series/')) urls.add(`data/series/${withoutData}`);\r\n      const idPart = withoutData.replace(/^series\\//,'').replace(/^details\\//,'').replace(/\\.json$/,'');\r\n      if(idPart) urls.add(`data/series/details/${idPart}.json`);\r\n    }\r\n  }\r\n  const rk = item?.ratingKey;\r\n  if(rk !== undefined && rk !== null){\r\n    urls.add(`data/series/details/${String(rk)}.json`);\r\n  }\r\n  return Array.from(urls);\r\n}\r\n\r\nfunction normalizeShowDetail(data){\r\n  if(!data || typeof data !== 'object') return null;\r\n  const show = { ...data };\r\n  prefixShowThumb(show);\r\n  show.genres = normalizeGenres(show.genres);\r\n  const castList = normalizePeople(show.cast || show.roles || []);\r\n  show.cast = castList;\r\n  show.roles = castList;\r\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeason).filter(Boolean) : [];\r\n  show.seasonCount = Number.isFinite(show.seasonCount) ? show.seasonCount : show.seasons.length;\r\n  prefixShowTree(show);\r\n  return show;\r\n}\r\n\r\nfunction normalizeSeason(season){\r\n  if(!season || typeof season !== 'object') return null;\r\n  const out = { ...season };\r\n  prefixShowThumb(out);\r\n  out.genres = normalizeGenres(out.genres);\r\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisode).filter(Boolean) : [];\r\n  prefixSeasonTree(out);\r\n  return out;\r\n}\r\n\r\nfunction normalizeEpisode(ep){\r\n  if(!ep || typeof ep !== 'object') return null;\r\n  const out = { ...ep };\r\n  prefixShowThumb(out);\r\n  out.genres = normalizeGenres(out.genres);\r\n  return out;\r\n}\r\n\r\nfunction normalizeGenres(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const seen = new Set();\r\n  const result = [];\r\n  list.forEach(entry=>{\r\n    let obj = null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      if(tag) obj = { tag };\r\n    }else if(entry && typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\r\n      if(tag){ obj = { ...entry, tag }; }\r\n    }\r\n    if(obj && !seen.has(obj.tag)){\r\n      seen.add(obj.tag);\r\n      result.push(obj);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nfunction normalizePeople(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry=>{\r\n    if(!entry) return null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      return tag ? { tag } : null;\r\n    }\r\n    if(typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\r\n      if(tag){ return { ...entry, tag }; }\r\n      return { ...entry };\r\n    }\r\n    return null;\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction cloneDetail(detail){\r\n  if(detail === null || detail === undefined) return detail;\r\n  try{\r\n    return structuredClone(detail);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} structuredClone failed for show detail:`, err);\r\n  }\r\n  try{\r\n    return JSON.parse(JSON.stringify(detail));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} JSON clone failed for show detail:`, err);\r\n  }\r\n  return detail;\r\n}\r\n", "import { getState } from './state.js';\r\n\r\nconst LOG_PREFIX = '[utils]';\r\n\r\nexport function getGenreNames(genres){\r\n  const seen = new Set();\r\n  const names = [];\r\n  (genres || []).forEach(entry=>{\r\n    let name = '';\r\n    if(typeof entry === 'string'){\r\n      name = entry;\r\n    }else if(entry && typeof entry === 'object'){\r\n      name = entry.tag || entry.title || entry.name || '';\r\n    }\r\n    const str = String(name || '').trim();\r\n    if(str && !seen.has(str)){\r\n      seen.add(str);\r\n      names.push(str);\r\n    }\r\n  });\r\n  return names;\r\n}\r\n\r\nexport function renderChipsLimited(container, values, limit=3){\r\n  if(!container) return;\r\n  const vals = (values||[]).filter(Boolean);\r\n\r\n  // If we have more values than the limit, show limit chips + aggregator\r\n  if(vals.length > limit){\r\n    const head = vals.slice(0, limit);\r\n    const rest = vals.slice(limit);\r\n    const chips = head.map(text=>chip(text));\r\n\r\n    const more = chip(`+ ${rest.length}`);\r\n    more.classList.add('more', 'card__chip--more');\r\n    more.setAttribute('data-more', rest.length);\r\n    more.setAttribute('title', `${rest.length} weitere Genres: ${rest.join(', ')}`);\r\n    // store extra chips to reveal on click\r\n    more._extraChips = rest.map(text=>chip(text));\r\n    chips.push(more);\r\n\r\n    container.replaceChildren(...chips);\r\n  } else {\r\n    // Show all chips if we have limit or fewer\r\n    const chips = vals.map(text=>chip(text));\r\n    container.replaceChildren(...chips);\r\n  }\r\n\r\n  enableMoreChipBehavior(container);\r\n}\r\n\r\nexport function enableMoreChipBehavior(root = document){\r\n  try{\r\n    root.querySelectorAll('.chip.more, .card__chip--more').forEach(btn=>{\r\n      if(btn.dataset.bound) return;\r\n      btn.dataset.bound = '1';\r\n      btn.addEventListener('click', (e)=>{\r\n        // Stop propagation to prevent card click from opening modal\r\n        e.stopPropagation();\r\n\r\n        // Find the parent card element\r\n        const card = btn.closest('.card');\r\n        if(card) {\r\n          // Trigger the card's click event to open the modal\r\n          card.click();\r\n        } else {\r\n          // Fallback: expand inline if not in a card context\r\n          const hidden = btn._extraChips || [];\r\n          try{\r\n            hidden.forEach(ch => btn.before(ch));\r\n          }catch(err){\r\n            console.warn(`${LOG_PREFIX} Failed to expand inline chips:`, err);\r\n          }\r\n          btn.remove();\r\n        }\r\n      });\r\n    });\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to enable more chip behaviour:`, err);\r\n  }\r\n}\r\n\r\nexport function collectionTags(item){\r\n  return ((item && item.collections) || [])\r\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\r\n    .filter(Boolean);\r\n}\r\n\r\nexport function humanYear(item){\r\n  if(!item) return '';\r\n  const candidates = [\r\n    item.originallyAvailableAt,\r\n    item.year,\r\n    item.releaseDate,\r\n    item.premiereDate,\r\n  ];\r\n\r\n  for(const value of candidates){\r\n    if(value === undefined || value === null) continue;\r\n    const str = String(value);\r\n    if(!str) continue;\r\n    const match = str.match(/\\d{4}/);\r\n    if(match) return match[0];\r\n  }\r\n\r\n  return '';\r\n}\r\n\r\nexport function formatRating(val){\r\n  if(val instanceof Number){\r\n    return formatRating(val.valueOf());\r\n  }\r\n\r\n  if(typeof val === 'number'){\r\n    return Number.isFinite(val) ? val.toFixed(1) : '0.0';\r\n  }\r\n\r\n  if(typeof val === 'string'){\r\n    const trimmed = val.trim();\r\n    if(!trimmed) return '0.0';\r\n    const num = Number(trimmed);\r\n    return Number.isFinite(num) ? num.toFixed(1) : '0.0';\r\n  }\r\n\r\n  return '0.0';\r\n}\r\n\r\nfunction chip(text){ const s=document.createElement('span'); s.className='chip'; s.textContent=String(text||''); return s; }\r\n\r\nexport function isNew(item){\r\n  if(!item?.addedAt) return false;\r\n  const added = new Date(item.addedAt).getTime();\r\n  if(!Number.isFinite(added)) return false;\r\n  const cfg = getState().cfg || {};\r\n  const days = Number(cfg.newDays || 30);\r\n  return Date.now() - added <= days * 24*60*60*1000;\r\n}\r\n\r\nexport function useTmdbOn(){\r\n  try{\r\n    return localStorage.getItem('useTmdb')==='1';\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Unable to read TMDB preference from storage:`, err);\r\n    return false;\r\n  }\r\n}\r\n", "import { getState } from './state.js';\r\n\r\nconst STORAGE_KEY = 'watchlist:v1';\r\nconst LOG_PREFIX = '[watchlist]';\r\nlet saved = new Set();\r\n\r\nfunction load(){\r\n  try{\r\n    saved = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to load entries from storage:`, err?.message || err);\r\n    saved = new Set();\r\n  }\r\n}\r\nfunction persist(){\r\n  try{\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(saved.values())));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to persist entries to storage:`, err?.message || err);\r\n  }\r\n}\r\n\r\nfunction idFor(item){\r\n  if(!item) return '';\r\n  const kind = (item.type==='tv' || item.libraryType==='show') ? 'show' : 'movie';\r\n  const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\r\n  return id ? `${kind}:${id}` : '';\r\n}\r\n\r\nexport function isSaved(item){ return saved.has(idFor(item)); }\r\nexport function count(){ return saved.size; }\r\nexport function toggle(item){\r\n  const k=idFor(item);\r\n  if(!k) return;\r\n  if(saved.has(k)) saved.delete(k); else saved.add(k);\r\n  persist();\r\n  renderCount();\r\n  const panel=document.getElementById('watchlistPanel');\r\n  if(panel && !panel.hidden) renderPanel();\r\n}\r\n\r\nexport function renderCount(){ const el=document.getElementById('watchlistCount'); if(el) el.textContent = String(count()); }\r\n\r\nexport function openPanel(){\r\n  const p=document.getElementById('watchlistPanel');\r\n  if(p) {\r\n    p.hidden=false;\r\n    p.setAttribute('aria-hidden','false');\r\n    renderPanel();\r\n  }\r\n}\r\n\r\nexport function closePanel(){\r\n  const p=document.getElementById('watchlistPanel');\r\n  if(p){\r\n    p.hidden=true;\r\n    p.setAttribute('aria-hidden','true');\r\n  }\r\n  setExpanded(false);\r\n}\r\n\r\nexport function clear(){ saved.clear(); persist(); renderCount(); renderPanel(); }\r\n\r\nexport function exportJson(){\r\n  const items = listItems();\r\n  const data = JSON.stringify(items, null, 2);\r\n  const blob = new Blob([data], { type:'application/json' });\r\n  const a = document.createElement('a');\r\n  a.href = URL.createObjectURL(blob);\r\n  a.download = 'watchlist.json';\r\n  document.body.append(a); a.click(); a.remove();\r\n  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);\r\n}\r\n\r\nfunction listItems(){\r\n  const s = getState();\r\n  const pool = (s.movies||[]).concat(s.shows||[]);\r\n  const map = new Map(pool.map(it=>[idFor(it), it]));\r\n  return Array.from(saved.values()).map(k=>map.get(k)).filter(Boolean);\r\n}\r\n\r\nexport function renderPanel(){\r\n  const list = document.getElementById('watchlistItems');\r\n  const empty = document.getElementById('watchlistEmpty');\r\n  if(!list || !empty) return;\r\n  const items = listItems();\r\n  if(items.length===0){ list.replaceChildren(); empty.hidden=false; return; }\r\n  empty.hidden=true;\r\n  const frag = document.createDocumentFragment();\r\n  items.forEach(item=>{\r\n    const li = document.createElement('li');\r\n    li.className = 'watchlist-item';\r\n    const t = document.createElement('span');\r\n    t.className='title';\r\n    t.textContent = item.title || '';\r\n    const rm = document.createElement('button');\r\n    rm.textContent = 'Entfernen';\r\n    rm.addEventListener('click', ()=>{ toggle(item); renderPanel(); });\r\n    const open = document.createElement('button');\r\n    open.textContent = '\u00D6ffnen';\r\n    open.addEventListener('click', ()=>{\r\n      const kind = (item.type==='tv') ? 'show' : 'movie';\r\n      const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\r\n      if(id) location.hash = `#/${kind}/${id}`;\r\n    });\r\n    li.append(t, open, rm);\r\n    frag.append(li);\r\n  });\r\n  list.replaceChildren(frag);\r\n}\r\n\r\nexport function initUi(){\r\n  load();\r\n  renderCount();\r\n  const openBtn = document.getElementById('openWatchlist');\r\n  const toggleBtn = document.getElementById('watchlistToggle');\r\n  const closeBtn = document.getElementById('closeWatchlist');\r\n  const clearBtn = document.getElementById('clearWatchlist');\r\n  const exportBtn = document.getElementById('exportWatchlist');\r\n  openBtn && openBtn.addEventListener('click', ()=>{ openPanel(); setExpanded(true); });\r\n  toggleBtn && toggleBtn.addEventListener('click', ()=>{ const p=document.getElementById('watchlistPanel'); if(p && !p.hidden){ closePanel(); } else { openPanel(); setExpanded(true); } });\r\n  closeBtn && closeBtn.addEventListener('click', ()=>{ closePanel(); });\r\n  clearBtn && clearBtn.addEventListener('click', ()=>{ clear(); });\r\n  exportBtn && exportBtn.addEventListener('click', ()=>{ exportJson(); });\r\n}\r\n\r\nfunction setExpanded(on){ const t=document.getElementById('watchlistToggle'); if(t) t.setAttribute('aria-expanded', on?'true':'false'); }\r\n", "export function applyTabs(root){\r\n  const tabs = root.querySelector('.v2-tabs');\r\n  if(!tabs) return;\r\n  const buttons = Array.from(tabs.querySelectorAll('button[data-t]'));\r\n  const select = (target)=>{\r\n    buttons.forEach(btn=>{\r\n      const isActive = btn.dataset.t === target;\r\n      btn.classList.toggle('active', isActive);\r\n      btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\r\n      btn.tabIndex = isActive ? 0 : -1;\r\n      const pane = root.querySelector(`.v2-pane[data-pane=\"${btn.dataset.t}\"]`);\r\n      if(pane){\r\n        pane.hidden = !isActive;\r\n        pane.setAttribute('aria-hidden', pane.hidden ? 'true' : 'false');\r\n      }\r\n    });\r\n  };\r\n  const moveFocus = (current, delta)=>{\r\n    if(!buttons.length) return;\r\n    const currentIndex = buttons.indexOf(current);\r\n    const fallbackIndex = delta > 0 ? 0 : buttons.length - 1;\r\n    const index = currentIndex === -1 ? fallbackIndex : (currentIndex + delta + buttons.length) % buttons.length;\r\n    const next = buttons[index];\r\n    if(next){\r\n      next.focus();\r\n      select(next.dataset.t);\r\n    }\r\n  };\r\n  tabs.addEventListener('click', ev=>{\r\n    const btn = ev.target.closest('button[data-t]');\r\n    if(!btn) return;\r\n    ev.preventDefault();\r\n    select(btn.dataset.t);\r\n  });\r\n  tabs.addEventListener('keydown', ev=>{\r\n    const btn = ev.target.closest('button[data-t]');\r\n    if(!btn) return;\r\n    switch(ev.key){\r\n      case 'ArrowLeft':\r\n      case 'ArrowUp':\r\n        ev.preventDefault();\r\n        moveFocus(btn, -1);\r\n        break;\r\n      case 'ArrowRight':\r\n      case 'ArrowDown':\r\n        ev.preventDefault();\r\n        moveFocus(btn, 1);\r\n        break;\r\n      case 'Home':\r\n        ev.preventDefault();\r\n        if(buttons[0]){\r\n          buttons[0].focus();\r\n          select(buttons[0].dataset.t);\r\n        }\r\n        break;\r\n      case 'End':\r\n        ev.preventDefault();\r\n        if(buttons.length){\r\n          const last = buttons[buttons.length - 1];\r\n          last.focus();\r\n          select(last.dataset.t);\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n  const initial = buttons.find(btn=> btn.classList.contains('active')) || buttons[0];\r\n  if(initial) select(initial.dataset.t);\r\n}\r\n", "import { formatRating, humanYear, isNew, useTmdbOn } from '../utils.js';\r\n\r\nfunction resolvePoster(item){\r\n  const tmdbPoster = item?.tmdb?.poster || item?.tmdbPoster;\r\n  const localPoster = item?.poster || item?.thumbFile || item?.art || '';\r\n  return (useTmdbOn() && tmdbPoster) ? tmdbPoster : localPoster;\r\n}\r\n\r\nexport function runtimeText(item){\r\n  const minutes = item?.runtimeMin || item?.durationMin || (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  if(!Number.isFinite(minutes)) return '';\r\n  if(item?.type === 'tv'){ return `~${minutes} min/Ep`; }\r\n  return `${minutes} min`;\r\n}\r\n\r\nexport function ratingText(item){\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(!Number.isFinite(rating)) return '';\r\n  return `\u2605 ${formatRating(rating)}`;\r\n}\r\n\r\nexport function studioText(item){\r\n  return item?.studio || item?.network || item?.studioName || '';\r\n}\r\n\r\nfunction buildChips(item){\r\n  const chips = [];\r\n  if(isNew(item)) chips.push('Neu');\r\n  if(item?.type === 'tv' && Number.isFinite(Number(item?.seasonCount))){\r\n    chips.push(`Staffeln: ${item.seasonCount}`);\r\n  }\r\n  const genres = (item?.genres || []).map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n  genres.forEach(genre=> chips.push(genre));\r\n  return chips;\r\n}\r\n\r\nexport function populateHead(root, item){\r\n  const titleEl = root.querySelector('.v2-title');\r\n  if(titleEl) titleEl.textContent = item?.title || item?.name || '';\r\n  const tagline = (item?.tagline || '').trim();\r\n  const metaEl = root.querySelector('.v2-meta');\r\n  const subEl = root.querySelector('.v2-subline');\r\n  const year = humanYear(item);\r\n  const runtime = runtimeText(item);\r\n  const rating = ratingText(item);\r\n  const studio = studioText(item);\r\n  const metaParts = [year, runtime, rating, studio].filter(Boolean);\r\n  if(subEl){\r\n    const fallback = metaParts.join(' \u2022 ');\r\n    subEl.textContent = tagline || fallback;\r\n    subEl.hidden = !(tagline || fallback);\r\n  }\r\n  if(metaEl){\r\n    metaEl.textContent = tagline && metaParts.length ? metaParts.join(' \u2022 ') : '';\r\n    metaEl.hidden = !(tagline && metaParts.length);\r\n  }\r\n  const chipsRoot = root.querySelector('.v2-chips');\r\n  if(chipsRoot){\r\n    chipsRoot.replaceChildren();\r\n    buildChips(item).forEach(text=>{\r\n      const span = document.createElement('span');\r\n      span.className = 'chip';\r\n      span.textContent = text;\r\n      chipsRoot.appendChild(span);\r\n    });\r\n    chipsRoot.hidden = !chipsRoot.childElementCount;\r\n  }\r\n  const quickFacts = root.querySelector('.v2-facts');\r\n  const quickList = root.querySelector('.v2-facts-list');\r\n  if(quickFacts && quickList){\r\n    const facts = [];\r\n    if(year) facts.push(['Jahr', year]);\r\n    const contentRating = (item?.contentRating || '').trim();\r\n    if(contentRating) facts.push(['Freigabe', contentRating]);\r\n    if(runtime) facts.push(['Laufzeit', runtime]);\r\n    if(rating) facts.push(['Bewertung', rating]);\r\n    if(studio) facts.push(['Studio', studio]);\r\n    quickList.replaceChildren();\r\n    facts.forEach(([label, value])=>{\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      quickList.append(dt, dd);\r\n    });\r\n    quickFacts.hidden = !facts.length;\r\n  }\r\n  const img = root.querySelector('.v2-poster img');\r\n  if(img){\r\n    const src = resolvePoster(item);\r\n    img.src = src || '';\r\n    img.alt = item?.title ? `Poster: ${item.title}` : '';\r\n    img.loading = 'lazy';\r\n    img.decoding = 'async';\r\n    img.classList.remove('is-ready');\r\n    if(src){\r\n      img.addEventListener('load', onPosterReady, { once:true });\r\n      img.addEventListener('error', onPosterReady, { once:true });\r\n    }else{\r\n      img.classList.add('is-ready');\r\n    }\r\n  }\r\n}\r\n\r\nfunction onPosterReady(ev){\r\n  ev.currentTarget?.classList.add('is-ready');\r\n}\r\n", "export function updateOverview(root, text){\r\n  const pane = root.querySelector('.v2-overview');\r\n  if(!pane) return;\r\n\r\n  const overview = typeof text === 'string' ? text : '';\r\n\r\n  if(!overview){\r\n    pane.textContent = '';\r\n    return;\r\n  }\r\n\r\n  const paragraph = document.createElement('p');\r\n  paragraph.className = 'v2-overview-text line-clamp line-clamp-5';\r\n  paragraph.textContent = overview;\r\n\r\n  const toggle = document.createElement('button');\r\n  toggle.type = 'button';\r\n  toggle.className = 'v2-overview-toggle';\r\n\r\n  const setExpanded = (expanded)=>{\r\n    paragraph.classList.toggle('is-expanded', expanded);\r\n    toggle.setAttribute('aria-expanded', String(expanded));\r\n    toggle.textContent = expanded ? 'Weniger anzeigen' : 'Mehr anzeigen';\r\n  };\r\n\r\n  toggle.addEventListener('click', ()=>{\r\n    const expanded = toggle.getAttribute('aria-expanded') === 'true';\r\n    setExpanded(!expanded);\r\n  });\r\n\r\n  pane.replaceChildren(paragraph, toggle);\r\n  setExpanded(false);\r\n\r\n  const measure = ()=>{\r\n    const overflowing = paragraph.scrollHeight > paragraph.clientHeight + 1;\r\n    if(!overflowing){\r\n      paragraph.classList.add('is-expanded');\r\n      toggle.hidden = true;\r\n    }\r\n  };\r\n  const schedule = typeof requestAnimationFrame === 'function' ? requestAnimationFrame : (cb)=>setTimeout(cb, 0);\r\n  schedule(measure);\r\n}\r\n", "import { formatRating, humanYear } from '../utils.js';\r\nimport { runtimeText, studioText } from './headerSection.js';\r\n\r\nfunction releaseDateText(item){\r\n  const candidates = [\r\n    item?.originallyAvailableAt,\r\n    item?.releaseDate,\r\n    item?.premiereDate,\r\n    item?.firstAired,\r\n    item?.airDate,\r\n  ];\r\n  for(const raw of candidates){\r\n    const str = raw == null ? '' : String(raw).trim();\r\n    if(!str) continue;\r\n    const parsed = new Date(str);\r\n    if(Number.isFinite(parsed.getTime())){\r\n      try{\r\n        return parsed.toLocaleDateString('de-DE', { year:'numeric', month:'2-digit', day:'2-digit' });\r\n      }catch(err){\r\n        console.warn('[modal/detailsSection] Failed to format release date:', err?.message || err);\r\n      }\r\n    }\r\n    const iso = str.match(/^\\d{4}-\\d{2}-\\d{2}/);\r\n    if(iso && iso[0]) return iso[0];\r\n    if(str.length >= 4) return str.slice(0, 10);\r\n  }\r\n  const year = humanYear(item);\r\n  return year ? String(year) : '';\r\n}\r\n\r\nfunction namesFromList(source){\r\n  if(!Array.isArray(source)) return [];\r\n  return source.map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction genresFromItem(item){\r\n  const arr = Array.isArray(item?.genres) ? item.genres : [];\r\n  const mapped = arr.map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n  return Array.from(new Set(mapped));\r\n}\r\n\r\nfunction formatOptionalRating(value){\r\n  if(value instanceof Number){\r\n    return formatOptionalRating(value.valueOf());\r\n  }\r\n  if(typeof value === 'number'){\r\n    return Number.isFinite(value) ? formatRating(value) : '';\r\n  }\r\n  if(typeof value === 'string'){\r\n    const trimmed = value.trim();\r\n    if(!trimmed) return '';\r\n    const num = Number(trimmed);\r\n    return Number.isFinite(num) ? formatRating(num) : '';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function updateDetails(root, item){\r\n  const pane = root.querySelector('.v2-details');\r\n  if(!pane) return;\r\n  pane.replaceChildren();\r\n\r\n  const grid = document.createElement('div');\r\n  grid.className = 'v2-details-grid';\r\n\r\n  const general = [];\r\n  const release = releaseDateText(item);\r\n  if(release) general.push(['Ver\u00F6ffentlichung', release]);\r\n  const runtime = runtimeText(item);\r\n  if(runtime) general.push(['Laufzeit', runtime]);\r\n  const studio = studioText(item);\r\n  if(studio) general.push(['Studio', studio]);\r\n  const certification = (item?.contentRating || '').trim();\r\n  if(certification) general.push(['Freigabe', certification]);\r\n\r\n  const critic = formatOptionalRating(item?.rating);\r\n  const audience = formatOptionalRating(item?.audienceRating);\r\n  const user = formatOptionalRating(item?.userRating);\r\n  if(critic){\r\n    general.push(['Bewertung', `\u2605 ${critic}`]);\r\n    if(audience && audience !== critic) general.push(['Publikum', `\u2605 ${audience}`]);\r\n  }else if(audience){\r\n    general.push(['Bewertung', `\u2605 ${audience}`]);\r\n  }\r\n  if(user) general.push(['Eigene Wertung', `\u2605 ${user}`]);\r\n\r\n  if(item?.type === 'tv'){\r\n    const numericSeasons = Number(item?.seasonCount);\r\n    const seasonCount = Number.isFinite(numericSeasons) ? numericSeasons : (Array.isArray(item?.seasons) ? item.seasons.length : null);\r\n    if(Number.isFinite(seasonCount) && seasonCount > 0){\r\n      general.push(['Staffeln', String(seasonCount)]);\r\n    }\r\n    const episodeCount = Array.isArray(item?.seasons) ? item.seasons.reduce((sum, season)=>{\r\n      if(!season) return sum;\r\n      const eps = Array.isArray(season.episodes) ? season.episodes.length : 0;\r\n      return sum + (Number.isFinite(eps) ? eps : 0);\r\n    }, 0) : null;\r\n    if(Number.isFinite(episodeCount) && episodeCount > 0){\r\n      general.push(['Episoden', String(episodeCount)]);\r\n    }\r\n  }\r\n\r\n  const countries = namesFromList(item?.countries);\r\n  if(countries.length) general.push(['L\u00E4nder', countries.join(', ')]);\r\n  const collections = namesFromList(item?.collections);\r\n  if(collections.length) general.push(['Sammlungen', collections.join(', ')]);\r\n  const labels = namesFromList(item?.labels);\r\n  if(labels.length) general.push(['Labels', labels.join(', ')]);\r\n  if(item?.editionTitle) general.push(['Edition', item.editionTitle]);\r\n  if(item?.originalTitle && item.originalTitle !== item.title) general.push(['Originaltitel', item.originalTitle]);\r\n\r\n  if(general.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'general';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Allgemein';\r\n    const list = document.createElement('dl');\r\n    list.className = 'v2-details-list';\r\n    general.forEach(([label, value])=>{\r\n      if(!label || !value) return;\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      list.append(dt, dd);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  const genres = genresFromItem(item);\r\n  if(genres.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'genres';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Genres';\r\n    const chips = document.createElement('div');\r\n    chips.className = 'v2-chip-group';\r\n    genres.forEach(name=>{\r\n      const span = document.createElement('span');\r\n      span.className = 'chip';\r\n      span.textContent = name;\r\n      chips.appendChild(span);\r\n    });\r\n    section.append(heading, chips);\r\n    grid.append(section);\r\n  }\r\n\r\n  const crew = [];\r\n  const directors = namesFromList(item?.directors);\r\n  if(directors.length) crew.push(['Regie', directors.join(', ')]);\r\n  const writers = namesFromList(item?.writers);\r\n  if(writers.length) crew.push(['Drehbuch', writers.join(', ')]);\r\n  const producers = namesFromList(item?.producers);\r\n  if(producers.length) crew.push(['Produktion', producers.join(', ')]);\r\n  const creators = namesFromList(item?.creators || item?.showrunners);\r\n  if(item?.type === 'tv' && creators.length) crew.push(['Creator', creators.join(', ')]);\r\n\r\n  if(crew.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'crew';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Credits';\r\n    const list = document.createElement('dl');\r\n    list.className = 'v2-details-list';\r\n    crew.forEach(([label, value])=>{\r\n      if(!label || !value) return;\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      list.append(dt, dd);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  if(grid.childElementCount){\r\n    pane.appendChild(grid);\r\n  }else{\r\n    const fallback = document.createElement('p');\r\n    fallback.className = 'v2-details-empty';\r\n    fallback.textContent = 'Keine zus\u00E4tzlichen Details verf\u00FCgbar.';\r\n    pane.appendChild(fallback);\r\n  }\r\n}\r\n", "import { prefixShowThumb } from '../data.js';\r\n\r\nexport function renderSeasonsAccordion(targetOrSeasons, maybeSeasons){\r\n  const root = resolveTarget(targetOrSeasons, maybeSeasons);\r\n  if(!root) return;\r\n  const seasons = Array.isArray(targetOrSeasons) && !isTarget(targetOrSeasons)\r\n    ? (targetOrSeasons || [])\r\n    : (Array.isArray(maybeSeasons) ? maybeSeasons : []);\r\n  root.replaceChildren();\r\n  (seasons||[]).forEach((s, idx)=> root.append(seasonCardEl(s, idx)));\r\n}\r\n\r\nfunction isTarget(value){\r\n  return value instanceof Element || typeof value === 'string';\r\n}\r\n\r\nfunction resolveTarget(targetOrSeasons, maybeSeasons){\r\n  if(isTarget(targetOrSeasons)){\r\n    if(targetOrSeasons instanceof Element) return targetOrSeasons;\r\n    if(typeof targetOrSeasons === 'string') return document.querySelector(targetOrSeasons);\r\n  }\r\n  if(isTarget(maybeSeasons)){\r\n    if(maybeSeasons instanceof Element) return maybeSeasons;\r\n    if(typeof maybeSeasons === 'string') return document.querySelector(maybeSeasons);\r\n  }\r\n  return document.getElementById('seasonsAccordion');\r\n}\r\n\r\nfunction seasonCardEl(season, idx){\r\n  prefixShowThumb(season);\r\n  const card = document.createElement('article'); card.className='season-card';\r\n  const head = document.createElement('div'); head.className='season-head';\r\n  const th = document.createElement('div'); th.className='season-thumb';\r\n  const img = new Image(); img.loading='lazy'; img.decoding='async';\r\n  img.src = season.thumbFile || '';\r\n  img.alt = season.title || `Staffel ${season.seasonNumber||idx+1}`;\r\n  th.append(img);\r\n  const txt = document.createElement('div');\r\n  const title = document.createElement('div'); title.className='season-title'; title.textContent = season.title || `Staffel ${season.seasonNumber||idx+1}`;\r\n  const sub = document.createElement('div'); sub.className='season-sub';\r\n  const year = season.year || season.releaseYear || '';\r\n  const epCount = Array.isArray(season.episodes) ? season.episodes.length : (season.episodeCount || 0);\r\n  sub.textContent = [year, epCount ? `${epCount} Episoden` : ''].filter(Boolean).join(' \u2022 ');\r\n  txt.append(title, sub);\r\n  const chev = document.createElement('div'); chev.className='chev'; chev.textContent = '\u203A';\r\n  head.append(th, txt, chev);\r\n  const body = document.createElement('div'); body.className='season-body';\r\n  (season.episodes||[]).forEach(ep => { prefixShowThumb(ep); body.append(episodeRowEl(ep)); });\r\n  head.addEventListener('click', ()=> card.classList.toggle('open'));\r\n  card.append(head, body);\r\n  return card;\r\n}\r\n\r\nfunction episodeRowEl(ep){\r\n  const row = document.createElement('div'); row.className='episode';\r\n  const title = document.createElement('div'); title.className='ep-title';\r\n  const sNum = ep.seasonNumber != null ? Number(ep.seasonNumber) : null;\r\n  const eNum = ep.episodeNumber != null ? Number(ep.episodeNumber) : null;\r\n  const code = (ep.seasonEpisode && String(ep.seasonEpisode).toUpperCase()) || (Number.isFinite(sNum) && Number.isFinite(eNum) ? `S${String(sNum).padStart(2,'0')}E${String(eNum).padStart(2,'0')}` : '');\r\n  title.textContent = `${code ? code + ' \u2022 ' : ''}${ep.title || ''}`;\r\n  const right = document.createElement('div'); right.className='badges';\r\n  const r = Number(ep.audienceRating ?? ep.rating);\r\n  if(Number.isFinite(r)){ const b=document.createElement('span'); b.className='badge'; b.textContent = `${r.toFixed(1)}`; right.append(b); }\r\n  const meta = document.createElement('div'); meta.className='ep-meta';\r\n  const durMin = ep.durationMin || (ep.duration ? Math.round(Number(ep.duration)/60000) : null);\r\n  const durText = ep.durationHuman || (durMin ? `${durMin} min` : null);\r\n  const dateText = ep.originallyAvailableAt || ep.date || '';\r\n  meta.textContent = [durText, dateText].filter(Boolean).join(' \u2022 ');\r\n  row.append(title, right, meta);\r\n  return row;\r\n}\r\n\r\n", "import { renderSeasonsAccordion } from './seasonsAccordion.js';\r\n\r\nexport function updateSeasons(root, item){\r\n  const pane = root.querySelector('.v2-seasons');\r\n  if(!pane) return;\r\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\r\n  if(!seasons.length){\r\n    pane.innerHTML = '<p class=\"modalv2-loading\">Keine Staffel-Informationen verf\u00FCgbar.</p>';\r\n    return;\r\n  }\r\n  pane.innerHTML = '';\r\n  renderSeasonsAccordion(pane, seasons);\r\n}\r\n", "export function setExternalLinks(root, item){\r\n  const tmdbBtn = root.querySelector('#v2Tmdb');\r\n  const imdbBtn = root.querySelector('#v2Imdb');\r\n  const trailerBtn = root.querySelector('#v2Trailer');\r\n  const tmdbId = item?.ids?.tmdb || item?.tmdbId;\r\n  const imdbId = item?.ids?.imdb || item?.imdbId;\r\n  const trailer = item?.trailer || item?.trailerUrl;\r\n  const type = item?.type === 'tv' ? 'tv' : 'movie';\r\n  if(tmdbBtn){\r\n    if(tmdbId){\r\n      tmdbBtn.hidden = false;\r\n      tmdbBtn.href = `https://www.themoviedb.org/${type}/${tmdbId}`;\r\n    }else{\r\n      tmdbBtn.hidden = true;\r\n      tmdbBtn.removeAttribute('href');\r\n    }\r\n  }\r\n  if(imdbBtn){\r\n    if(imdbId){\r\n      imdbBtn.hidden = false;\r\n      imdbBtn.href = `https://www.imdb.com/title/${imdbId}/`;\r\n    }else{\r\n      imdbBtn.hidden = true;\r\n      imdbBtn.removeAttribute('href');\r\n    }\r\n  }\r\n  if(trailerBtn){\r\n    if(trailer){\r\n      trailerBtn.hidden = false;\r\n      trailerBtn.onclick = ()=> window.open(trailer, '_blank', 'noopener');\r\n    }else{\r\n      trailerBtn.hidden = true;\r\n      trailerBtn.onclick = null;\r\n    }\r\n  }\r\n}\r\n", "import { useTmdbOn } from '../utils.js';\r\n\r\nconst TMDB_PROFILE_BASE = 'https://image.tmdb.org/t/p/';\r\nconst TMDB_PROFILE_SIZE = 'w185';\r\n\r\nexport function buildCastList(item){\r\n  const source = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\r\n  return source.map(person=>{\r\n    if(!person) return null;\r\n    if(typeof person === 'string'){\r\n      const name = String(person).trim();\r\n      if(!name) return null;\r\n      return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\r\n    }\r\n    const name = String(person.tag || person.name || person.role || '').trim();\r\n    if(!name) return null;\r\n    const role = (()=>{\r\n      const rawRole = String(person.role || '').trim();\r\n      if(!rawRole) return '';\r\n      return rawRole.toLowerCase() === name.toLowerCase() ? '' : rawRole;\r\n    })();\r\n    const tmdbProfile = [\r\n      person?.tmdb?.profile,\r\n      person?.tmdb?.profile_path,\r\n      person?.tmdb?.profilePath,\r\n      person?.tmdbProfile,\r\n      person?.profile,\r\n      person?.profile_path,\r\n      person?.profilePath,\r\n    ].find(val => typeof val === 'string' && val.trim());\r\n    const thumb = [person?.thumb, person?.photo, person?.image].find(val => typeof val === 'string' && val.trim()) || '';\r\n    return {\r\n      name,\r\n      role,\r\n      thumb,\r\n      tmdbProfile: tmdbProfile ? String(tmdbProfile).trim() : '',\r\n      raw: person,\r\n    };\r\n  }).filter(Boolean);\r\n}\r\n\r\nexport function updateCast(root, cast){\r\n  const pane = root.querySelector('.v2-cast');\r\n  if(!pane) return;\r\n  pane.innerHTML = '<div class=\"v2-cast-scroll\"></div>';\r\n  const scroll = pane.querySelector('.v2-cast-scroll');\r\n  if(!scroll) return;\r\n  const limited = Array.isArray(cast) ? cast.slice(0, 12) : [];\r\n  if(!limited.length){\r\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\r\n    scroll.removeAttribute('role');\r\n    return;\r\n  }\r\n  scroll.setAttribute('role', 'list');\r\n  const tmdbEnabled = useTmdbOn();\r\n  limited.forEach(entry=>{\r\n    const data = (entry && typeof entry === 'object' && 'name' in entry)\r\n      ? entry\r\n      : (()=>{\r\n          const name = String(entry || '').trim();\r\n          if(!name) return null;\r\n          return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\r\n        })();\r\n    if(!data || !data.name) return;\r\n\r\n    const card = document.createElement('article');\r\n    card.className = 'v2-cast-card';\r\n    card.tabIndex = 0;\r\n    card.setAttribute('role', 'listitem');\r\n\r\n    const roleText = String(data.role || '').trim();\r\n    card.setAttribute('aria-label', roleText ? `${data.name} \u2013 ${roleText}` : data.name);\r\n\r\n    const avatar = document.createElement('div');\r\n    avatar.className = 'v2-cast-avatar';\r\n    const imageSrc = resolveCastImage(data, tmdbEnabled);\r\n    if(imageSrc){\r\n      avatar.classList.add('has-image');\r\n      const img = document.createElement('img');\r\n      img.src = imageSrc;\r\n      img.alt = data.name;\r\n      img.loading = 'lazy';\r\n      img.decoding = 'async';\r\n      avatar.appendChild(img);\r\n    }else{\r\n      const initials = document.createElement('span');\r\n      initials.className = 'v2-cast-initials';\r\n      initials.textContent = castInitials(data.name);\r\n      initials.setAttribute('aria-hidden', 'true');\r\n      avatar.appendChild(initials);\r\n    }\r\n\r\n    const nameLine = document.createElement('p');\r\n    nameLine.className = 'v2-cast-name';\r\n    nameLine.textContent = data.name;\r\n\r\n    card.append(avatar, nameLine);\r\n\r\n    if(roleText){\r\n      const roleLine = document.createElement('p');\r\n      roleLine.className = 'v2-cast-role';\r\n      roleLine.textContent = roleText;\r\n      card.append(roleLine);\r\n    }else{\r\n      card.classList.add('v2-cast-card--no-role');\r\n    }\r\n    scroll.appendChild(card);\r\n  });\r\n\r\n  if(!scroll.children.length){\r\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\r\n    scroll.removeAttribute('role');\r\n  }\r\n}\r\n\r\nfunction normalizeTmdbProfile(path){\r\n  const str = String(path || '').trim();\r\n  if(!str) return '';\r\n  if(/^https?:\\/\\//i.test(str)) return str;\r\n  if(str.startsWith('//')) return `https:${str}`;\r\n  const suffix = str.startsWith('/') ? str : `/${str}`;\r\n  return `${TMDB_PROFILE_BASE}${TMDB_PROFILE_SIZE}${suffix}`;\r\n}\r\n\r\nfunction normalizeLocalImage(path){\r\n  const str = String(path || '').trim();\r\n  if(!str) return '';\r\n  if(/^https?:\\/\\//i.test(str) || str.startsWith('data:')) return str;\r\n  if(str.startsWith('//')) return `https:${str}`;\r\n  return str;\r\n}\r\n\r\nfunction resolveCastImage(entry, tmdbEnabled){\r\n  if(!entry) return '';\r\n  const raw = entry.raw || {};\r\n  if(tmdbEnabled){\r\n    const tmdbCandidates = [\r\n      entry.tmdbProfile,\r\n      raw?.tmdb?.profile,\r\n      raw?.tmdb?.profile_path,\r\n      raw?.tmdb?.profilePath,\r\n      raw?.tmdbProfile,\r\n      raw?.profile,\r\n      raw?.profile_path,\r\n      raw?.profilePath,\r\n    ];\r\n    for(const candidate of tmdbCandidates){\r\n      const url = normalizeTmdbProfile(candidate);\r\n      if(url) return url;\r\n    }\r\n  }\r\n  const localCandidates = [entry.thumb, raw?.thumb, raw?.photo, raw?.image];\r\n  for(const candidate of localCandidates){\r\n    const url = normalizeLocalImage(candidate);\r\n    if(url) return url;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction castInitials(name){\r\n  const str = String(name || '').trim();\r\n  if(!str) return '?';\r\n  const parts = str.split(/\\s+/).slice(0, 2);\r\n  const chars = parts.map(part => part.charAt(0)).filter(Boolean);\r\n  return chars.length ? chars.join('').toUpperCase() : str.charAt(0).toUpperCase();\r\n}\r\n", "import { prefixShowThumb } from '../data.js';\r\n\r\nfunction deepClone(value){\r\n  if(value == null || typeof value !== 'object') return value;\r\n  if(typeof structuredClone === 'function'){\r\n    try{ return structuredClone(value); }\r\n    catch(err){ console.warn('[modal/shared] structuredClone failed, falling back to JSON clone:', err?.message || err); }\r\n  }\r\n  try{ return JSON.parse(JSON.stringify(value)); }\r\n  catch(err){ console.warn('[modal/shared] JSON clone failed, falling back to manual clone:', err?.message || err); }\r\n  if(Array.isArray(value)) return value.map(entry => deepClone(entry));\r\n  const out = {};\r\n  for(const key of Object.keys(value)){\r\n    out[key] = deepClone(value[key]);\r\n  }\r\n  return out;\r\n}\r\n\r\nexport function mapMovie(item){\r\n  if(!item || typeof item !== 'object') return null;\r\n  const clone = deepClone(item);\r\n  if(clone.type === 'show') clone.type = 'tv';\r\n  if(!clone.type) clone.type = 'movie';\r\n  return clone;\r\n}\r\n\r\nexport function mapShow(item){\r\n  if(!item || typeof item !== 'object') return null;\r\n  const clone = deepClone(item);\r\n  if(clone.type !== 'tv') clone.type = 'tv';\r\n  normalizeShow(clone);\r\n  return clone;\r\n}\r\n\r\nexport function mapDetail(detail){\r\n  if(!detail || typeof detail !== 'object') return null;\r\n  const clone = deepClone(detail);\r\n  normalizeShow(clone);\r\n  return clone;\r\n}\r\n\r\nexport function needsShowDetail(item){\r\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\r\n  const hasEpisodes = seasons.some(season => Array.isArray(season?.episodes) && season.episodes.length);\r\n  const cast = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\r\n  return !seasons.length || !hasEpisodes || !cast.length;\r\n}\r\n\r\nexport function mergeShowDetail(target, detail){\r\n  if(!target) return target;\r\n  if(detail && typeof detail === 'object'){\r\n    const mapped = mapDetail(detail);\r\n    Object.assign(target, mapped);\r\n  }\r\n  normalizeShow(target);\r\n  return target;\r\n}\r\n\r\nexport function normalizeShow(show){\r\n  if(!show || typeof show !== 'object') return;\r\n  normalizeThumbField(show);\r\n  show.genres = normalizeGenresList(show.genres);\r\n  const cast = normalizePeopleList(show.cast || show.roles || []);\r\n  show.cast = cast;\r\n  show.roles = cast;\r\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeasonEntry).filter(Boolean) : [];\r\n  const sc = Number(show.seasonCount);\r\n  show.seasonCount = Number.isFinite(sc) && sc > 0 ? sc : show.seasons.length;\r\n}\r\n\r\nfunction normalizeSeasonEntry(season){\r\n  if(!season || typeof season !== 'object') return null;\r\n  const out = { ...season };\r\n  normalizeThumbField(out);\r\n  out.genres = normalizeGenresList(out.genres);\r\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisodeEntry).filter(Boolean) : [];\r\n  return out;\r\n}\r\n\r\nfunction normalizeEpisodeEntry(ep){\r\n  if(!ep || typeof ep !== 'object') return null;\r\n  const out = { ...ep };\r\n  normalizeThumbField(out);\r\n  out.genres = normalizeGenresList(out.genres);\r\n  return out;\r\n}\r\n\r\nfunction normalizeThumbField(obj){\r\n  prefixShowThumb(obj);\r\n}\r\n\r\nexport function normalizeGenresList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const seen = new Set();\r\n  const result = [];\r\n  list.forEach(entry => {\r\n    let item = null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      if(tag) item = { tag };\r\n    }else if(entry && typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\r\n      if(tag){ item = { ...entry, tag }; }\r\n    }\r\n    if(item && !seen.has(item.tag)){\r\n      seen.add(item.tag);\r\n      result.push(item);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nexport function normalizePeopleList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry => {\r\n    if(!entry) return null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      return tag ? { tag } : null;\r\n    }\r\n    if(typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\r\n      return tag ? { ...entry, tag } : { ...entry };\r\n    }\r\n    return null;\r\n  }).filter(Boolean);\r\n}\r\n", "export const DEMO_MOVIE = {\r\n  type: 'movie',\r\n  title: 'Lumen: Der Aufbruch',\r\n  tagline: 'Eine cineastische Demo f\u00FCr das neue Modal',\r\n  overview: 'Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\u00FCllt dabei eine Energiequelle, die alles ver\u00E4ndern k\u00F6nnte. Zwischen Loyalit\u00E4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\u00FCr das Cinematic-Layout entworfen wurde.',\r\n  summary: 'Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\u00E4ndern k\u00F6nnte.',\r\n  runtimeMin: 142,\r\n  contentRating: 'FSK 12',\r\n  studio: 'Aurora Pictures',\r\n  rating: 8.4,\r\n  audienceRating: 8.0,\r\n  userRating: 8.7,\r\n  originallyAvailableAt: '2024-05-17',\r\n  countries: [{ tag: 'Deutschland' }, { tag: 'Kanada' }],\r\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }, { tag: 'Abenteuer' }],\r\n  cast: [\r\n    { name: 'Mara Lenz', role: 'Captain Alys Vega', tmdbProfile: '/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg' },\r\n    { name: 'Tariq Benassi', role: 'Navigator Elian Soh', tmdbProfile: '/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg' },\r\n    { name: 'Hannah Ko', role: 'Wissenschaftlerin Dr. Mira Han', tmdbProfile: '/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg' },\r\n  ],\r\n  directors: [{ tag: 'Jonas Falk' }],\r\n  writers: [{ tag: 'Lea Winter' }],\r\n  producers: [{ tag: 'Studio Atlas' }],\r\n  labels: [{ tag: 'Dolby Atmos' }, { tag: '4K' }],\r\n  collections: [{ tag: 'Aurora-Saga' }],\r\n  trailer: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',\r\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg',\r\n  ids: { tmdb: 'demo-lumen', imdb: 'tt0000001' },\r\n  addedAt: '2024-06-01T12:00:00Z',\r\n};\r\n\r\nexport const DEMO_SERIES = {\r\n  type: 'tv',\r\n  title: 'Aurora Station',\r\n  tagline: 'Neue Horizonte in Serie',\r\n  overview: 'Die Besatzung der Aurora Station sch\u00FCtzt eine Au\u00DFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\u00E4tsel mit pers\u00F6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.',\r\n  summary: 'Ein orbitaler Au\u00DFenposten ringt um Hoffnung und Zusammenhalt, w\u00E4hrend eine fremde Macht erwacht.',\r\n  contentRating: 'TV-14',\r\n  studio: 'Nebula Network',\r\n  originallyAvailableAt: '2023-09-14',\r\n  seasonCount: 2,\r\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }],\r\n  countries: [{ tag: 'USA' }, { tag: 'Island' }],\r\n  creators: [{ tag: 'Elina S\u00F8rensen' }],\r\n  cast: [\r\n    { name: 'Noah Adler', role: 'Commander Ivar Hale', tmdbProfile: '/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg' },\r\n    { name: 'Sofia Idris', role: 'Ingenieurin Kaia Rhee', tmdbProfile: '/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg' },\r\n    { name: 'Helena Ruiz', role: 'Strategin Tala Voss', tmdbProfile: '/ziEuG1ESSofxDCspotYlrwz3Tq.png' },\r\n  ],\r\n  seasons: [\r\n    {\r\n      title: 'Staffel 1',\r\n      seasonNumber: 1,\r\n      year: 2023,\r\n      thumbFile: 'https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg',\r\n      episodes: [\r\n        {\r\n          title: 'Kapitel Eins: Erwachen',\r\n          seasonNumber: 1,\r\n          episodeNumber: 1,\r\n          durationMin: 54,\r\n          originallyAvailableAt: '2023-09-14',\r\n          audienceRating: 8.6,\r\n        },\r\n        {\r\n          title: 'Kapitel Zwei: Grenzwelten',\r\n          seasonNumber: 1,\r\n          episodeNumber: 2,\r\n          durationMin: 52,\r\n          originallyAvailableAt: '2023-09-21',\r\n          audienceRating: 8.2,\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      title: 'Staffel 2',\r\n      seasonNumber: 2,\r\n      year: 2024,\r\n      thumbFile: 'https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg',\r\n      episodes: [\r\n        {\r\n          title: 'Kapitel Dreizehn: Resonanz',\r\n          seasonNumber: 2,\r\n          episodeNumber: 1,\r\n          durationMin: 56,\r\n          originallyAvailableAt: '2024-02-08',\r\n          audienceRating: 8.9,\r\n        },\r\n        {\r\n          title: 'Kapitel Vierzehn: Echo',\r\n          seasonNumber: 2,\r\n          episodeNumber: 2,\r\n          durationMin: 55,\r\n          originallyAvailableAt: '2024-02-15',\r\n          audienceRating: 8.7,\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg',\r\n  ids: { tmdb: 'demo-aurora-station', imdb: 'tt0000002' },\r\n};\r\n", "import { applyTabs } from './modal/tabs.js';\r\nimport { populateHead } from './modal/headerSection.js';\r\nimport { updateOverview } from './modal/overviewSection.js';\r\nimport { updateDetails } from './modal/detailsSection.js';\r\nimport { updateSeasons } from './modal/seasonsSection.js';\r\nimport { setExternalLinks } from './modal/externalLinks.js';\r\nimport { updateCast, buildCastList } from './modal/castSection.js';\r\nimport { getState } from './state.js';\r\nimport { loadShowDetail } from './data.js';\r\nimport { mapMovie, mapShow, mergeShowDetail, needsShowDetail } from './modal/shared.js';\r\n\r\nlet overlayContainer = null;\r\nlet dialogEl = null;\r\nlet scrollContainer = null;\r\nlet rootEl = null;\r\nlet lastActiveElement = null;\r\nlet focusTrapHandler = null;\r\nlet escapeHandler = null;\r\nlet renderToken = 0;\r\nlet currentKind = null;\r\nlet currentItem = null;\r\n\r\nlet demoDataModulePromise = null;\r\nfunction loadDemoDataModule(){\r\n  if(!demoDataModulePromise){\r\n    demoDataModulePromise = import('./modal/demoData.js').catch(err=>{\r\n      console.warn('[modalV2] Demo-Daten konnten nicht geladen werden.', err);\r\n      return { DEMO_MOVIE: null, DEMO_SERIES: null };\r\n    });\r\n  }\r\n  return demoDataModulePromise;\r\n}\r\n\r\nfunction resolveRoot(){\r\n  if(rootEl) return rootEl;\r\n  const container = document.getElementById('modal-root-v2');\r\n  if(!container) return null;\r\n  overlayContainer = container;\r\n  container.classList.add('modalv2-overlay');\r\n  if(!container.hasAttribute('hidden')) container.setAttribute('hidden', '');\r\n  if(!container.dataset.modalv2Ready){\r\n    container.innerHTML = `\r\n      <div class=\"modalv2-backdrop\" data-modalv2-backdrop=\"1\"></div>\r\n      <div class=\"modalv2-dialog\" role=\"dialog\" aria-modal=\"true\">\r\n        <div class=\"modalv2-scroll\" data-modalv2-scroll></div>\r\n      </div>\r\n    `;\r\n    container.dataset.modalv2Ready = '1';\r\n    container.addEventListener('click', onOverlayClick);\r\n  }\r\n  dialogEl = container.querySelector('.modalv2-dialog');\r\n  if(dialogEl && !dialogEl.hasAttribute('tabindex')) dialogEl.setAttribute('tabindex', '-1');\r\n  scrollContainer = container.querySelector('[data-modalv2-scroll]');\r\n  if(scrollContainer && !rootEl){\r\n    const existing = scrollContainer.querySelector('.modalv2');\r\n    if(existing) rootEl = existing;\r\n    else {\r\n      rootEl = document.createElement('div');\r\n      rootEl.className = 'modalv2';\r\n      rootEl.setAttribute('hidden', '');\r\n      scrollContainer.appendChild(rootEl);\r\n    }\r\n  }\r\n  return rootEl;\r\n}\r\n\r\nfunction onOverlayClick(ev){\r\n  if(!overlayContainer) return;\r\n  const target = ev.target;\r\n  if(target === overlayContainer || (target && target.dataset && target.dataset.modalv2Backdrop)){ closeModalV2(); }\r\n}\r\n\r\nfunction getFocusableElements(){\r\n  if(!dialogEl) return [];\r\n  const selectors = 'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex=\"-1\"])';\r\n  return Array.from(dialogEl.querySelectorAll(selectors)).filter(el=>{\r\n    if(el.hasAttribute('disabled')) return false;\r\n    if(el.getAttribute('aria-hidden') === 'true') return false;\r\n    if(el.hasAttribute('hidden')) return false;\r\n    return el.offsetParent !== null;\r\n  });\r\n}\r\n\r\nfunction bindFocusTrap(){\r\n  if(!dialogEl) return;\r\n  if(focusTrapHandler){ dialogEl.removeEventListener('keydown', focusTrapHandler); }\r\n  focusTrapHandler = (ev)=>{\r\n    if(ev.key !== 'Tab') return;\r\n    const focusables = getFocusableElements();\r\n    if(!focusables.length) return;\r\n    const first = focusables[0];\r\n    const last = focusables[focusables.length - 1];\r\n    if(ev.shiftKey){\r\n      if(document.activeElement === first){ ev.preventDefault(); last.focus(); }\r\n    }else if(document.activeElement === last){\r\n      ev.preventDefault(); first.focus();\r\n    }\r\n  };\r\n  dialogEl.addEventListener('keydown', focusTrapHandler);\r\n}\r\n\r\nfunction unbindFocusTrap(){\r\n  if(!dialogEl || !focusTrapHandler) return;\r\n  dialogEl.removeEventListener('keydown', focusTrapHandler);\r\n  focusTrapHandler = null;\r\n}\r\n\r\nfunction bindEscape(){\r\n  if(escapeHandler) return;\r\n  escapeHandler = (ev)=>{\r\n    if(ev.key === 'Escape'){ ev.preventDefault(); closeModalV2(); }\r\n  };\r\n  window.addEventListener('keydown', escapeHandler);\r\n}\r\n\r\nfunction unbindEscape(){\r\n  if(!escapeHandler) return;\r\n  window.removeEventListener('keydown', escapeHandler);\r\n  escapeHandler = null;\r\n}\r\n\r\nfunction showOverlay(){\r\n  const root = resolveRoot();\r\n  if(!root || !overlayContainer) return null;\r\n  overlayContainer.hidden = false;\r\n  overlayContainer.setAttribute('aria-hidden', 'false');\r\n  document.body.classList.add('modalv2-open');\r\n  if(scrollContainer) scrollContainer.scrollTop = 0;\r\n  bindFocusTrap();\r\n  bindEscape();\r\n\r\n  return root;\r\n}\r\n\r\nfunction focusInitial(){\r\n  if(!dialogEl) return;\r\n  const closeBtn = dialogEl.querySelector('#v2Close');\r\n  const focusables = getFocusableElements();\r\n  let target = (closeBtn && !closeBtn.hasAttribute('hidden')) ? closeBtn : focusables[0];\r\n  if(!target) target = dialogEl;\r\n  if(target){\r\n    const focus = ()=>{\r\n      try{ target.focus(); }\r\n      catch(err){ console.warn('[modalV2] Failed to focus target element:', err?.message || err); }\r\n    };\r\n    (window.requestAnimationFrame || setTimeout)(focus, 0);\r\n  }\r\n}\r\n\r\nexport function showModalV2Loading(message='Details werden geladen \u2026'){\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  root.hidden = false;\r\n  const loadingDiv = document.createElement('div');\r\n  loadingDiv.className = 'modalv2-loading';\r\n  loadingDiv.textContent = String(message || 'Details werden geladen \u2026');\r\n  root.replaceChildren(loadingDiv);\r\n}\r\n\r\nexport function renderModalV2(item){\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  root.hidden = false;\r\n  const hasSeasons = item?.type === 'tv';\r\n  root.innerHTML = `\r\n    <section class=\"v2-layout\">\r\n      <aside class=\"v2-side\">\r\n        <div class=\"v2-poster\"><img alt=\"\"></div>\r\n        <div class=\"v2-facts\" aria-label=\"Schnellinfos\" hidden>\r\n          <h3 class=\"v2-facts-title\">Schnellinfos</h3>\r\n          <dl class=\"v2-facts-list\"></dl>\r\n        </div>\r\n      </aside>\r\n      <div class=\"v2-info\">\r\n        <header class=\"v2-head\">\r\n          <div class=\"v2-titlebar\">\r\n            <div class=\"v2-title-wrap\">\r\n              <h2 class=\"v2-title\" id=\"modalV2Title\"></h2>\r\n              <div class=\"v2-subline\"></div>\r\n              <div class=\"v2-meta\"></div>\r\n            </div>\r\n            <div class=\"v2-actions\" aria-label=\"Externe Aktionen\">\r\n              <button class=\"v2-icon-btn\" id=\"v2Close\" type=\"button\" aria-label=\"Schlie\u00DFen\">\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M6 6l12 12M6 18L18 6\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\r\n                </svg>\r\n              </button>\r\n              <a class=\"v2-icon-btn\" id=\"v2Tmdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf TMDB \u00F6ffnen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\r\n                  <path d=\"M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\r\n                </svg>\r\n              </a>\r\n              <a class=\"v2-icon-btn\" id=\"v2Imdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf IMDb \u00F6ffnen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\r\n                </svg>\r\n              </a>\r\n              <button class=\"v2-icon-btn\" id=\"v2Trailer\" type=\"button\" aria-label=\"Trailer abspielen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M9 6l8 6-8 6V6z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\" stroke-linecap=\"round\"></path>\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"v2-chips\" aria-label=\"Attribute\"></div>\r\n        </header>\r\n        <nav class=\"v2-tabs\" aria-label=\"Details Navigation\" role=\"tablist\">\r\n          <button type=\"button\" data-t=\"overview\" class=\"active\" id=\"v2TabOverview\" role=\"tab\" aria-controls=\"v2PaneOverview\" aria-selected=\"true\">\u00DCberblick</button>\r\n          <button type=\"button\" data-t=\"details\" id=\"v2TabDetails\" role=\"tab\" aria-controls=\"v2PaneDetails\" aria-selected=\"false\">Details</button>\r\n          ${hasSeasons ? '<button type=\"button\" data-t=\"seasons\" id=\"v2TabSeasons\" role=\"tab\" aria-controls=\"v2PaneSeasons\" aria-selected=\"false\">Staffeln</button>' : ''}\r\n          <button type=\"button\" data-t=\"cast\" id=\"v2TabCast\" role=\"tab\" aria-controls=\"v2PaneCast\" aria-selected=\"false\">Cast</button>\r\n        </nav>\r\n        <section class=\"v2-body\">\r\n          <div class=\"v2-pane v2-overview\" data-pane=\"overview\" id=\"v2PaneOverview\" role=\"tabpanel\" aria-labelledby=\"v2TabOverview\"></div>\r\n          <div class=\"v2-pane v2-details\" data-pane=\"details\" id=\"v2PaneDetails\" role=\"tabpanel\" aria-labelledby=\"v2TabDetails\" hidden></div>\r\n          ${hasSeasons ? '<div class=\"v2-pane v2-seasons\" data-pane=\"seasons\" id=\"v2PaneSeasons\" role=\"tabpanel\" aria-labelledby=\"v2TabSeasons\" hidden></div>' : ''}\r\n          <div class=\"v2-pane v2-cast\" data-pane=\"cast\" id=\"v2PaneCast\" role=\"tabpanel\" aria-labelledby=\"v2TabCast\" hidden></div>\r\n        </section>\r\n      </div>\r\n    </section>\r\n  `;\r\n\r\n  populateHead(root, item);\r\n  setExternalLinks(root, item);\r\n  updateOverview(root, item?.overview || item?.summary || '');\r\n  updateDetails(root, item);\r\n  if(item?.type === 'tv'){ updateSeasons(root, item); }\r\n  updateCast(root, buildCastList(item));\r\n  applyTabs(root);\r\n  const closeBtn = root.querySelector('#v2Close');\r\n  if(closeBtn){\r\n    closeBtn.addEventListener('click', closeModalV2);\r\n  }\r\n  if(dialogEl) dialogEl.setAttribute('aria-labelledby', 'modalV2Title');\r\n  focusInitial();\r\n}\r\n\r\nexport async function openMovieModalV2(idOrData){\r\n  const token = ++renderToken;\r\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  const data = await resolveMovieData(idOrData);\r\n  if(token !== renderToken) return;\r\n  if(!data){\r\n    root.hidden = false;\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'modalv2-loading';\r\n    errorDiv.textContent = 'Film konnte nicht geladen werden.';\r\n    root.replaceChildren(errorDiv);\r\n    currentItem = null;\r\n    currentKind = null;\r\n    focusInitial();\r\n    return;\r\n  }\r\n  currentItem = data;\r\n  currentKind = 'movie';\r\n  renderModalV2(data);\r\n}\r\n\r\nexport async function openSeriesModalV2(idOrData){\r\n  const token = ++renderToken;\r\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n  const base = await resolveSeriesData(idOrData);\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  if(token !== renderToken) return;\r\n  if(!base){\r\n    root.hidden = false;\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'modalv2-loading';\r\n    errorDiv.textContent = 'Seriendetails konnten nicht geladen werden.';\r\n    root.replaceChildren(errorDiv);\r\n    currentItem = null;\r\n    currentKind = null;\r\n    focusInitial();\r\n    return;\r\n  }\r\n  currentItem = base;\r\n  currentKind = 'show';\r\n  let working = base;\r\n  if(needsShowDetail(working)){\r\n    showModalV2Loading();\r\n    if(token !== renderToken) return;\r\n    let detail = null;\r\n    try{ detail = await loadShowDetail(working); }\r\n    catch(err){\r\n      detail = null;\r\n      console.warn('[modalV2] Failed to load show detail in modal:', err?.message || err);\r\n    }\r\n    if(token !== renderToken) return;\r\n    if(detail){ mergeShowDetail(working, detail); currentItem = working; }\r\n  }\r\n  if(token !== renderToken) return;\r\n  renderModalV2(working);\r\n}\r\n\r\nexport function closeModalV2(){\r\n  renderToken++;\r\n  if(!overlayContainer) return;\r\n  overlayContainer.hidden = true;\r\n  overlayContainer.setAttribute('aria-hidden', 'true');\r\n  document.body.classList.remove('modalv2-open');\r\n  unbindFocusTrap();\r\n  unbindEscape();\r\n  if(rootEl){\r\n    rootEl.innerHTML = '';\r\n    rootEl.setAttribute('hidden', '');\r\n  }\r\n  if(scrollContainer) scrollContainer.scrollTop = 0;\r\n  if(lastActiveElement && typeof lastActiveElement.focus === 'function'){\r\n    try{ lastActiveElement.focus(); }\r\n    catch(err){ console.warn('[modalV2] Failed to restore focus to last active element:', err?.message || err); }\r\n  }\r\n  lastActiveElement = null;\r\n  currentItem = null;\r\n  currentKind = null;\r\n}\r\n\r\nexport function isModalV2Open(){\r\n  return Boolean(overlayContainer && !overlayContainer.hidden);\r\n}\r\n\r\nexport function getModalV2Context(){\r\n  return currentItem ? { item: currentItem, kind: currentKind } : { item: null, kind: null };\r\n}\r\n\r\nasync function resolveMovieData(idOrData){\r\n  if(idOrData === 'demo'){\r\n    const { DEMO_MOVIE } = await loadDemoDataModule();\r\n    return mapMovie(DEMO_MOVIE);\r\n  }\r\n  if(idOrData && typeof idOrData === 'object') return mapMovie(idOrData);\r\n  const str = idOrData == null ? '' : String(idOrData).trim();\r\n  if(!str) return null;\r\n  const state = getState();\r\n  const movies = Array.isArray(state?.movies) ? state.movies : [];\r\n  const match = movies.find(movie => matchesIdentifier(movie, str));\r\n  return match ? mapMovie(match) : null;\r\n}\r\n\r\nasync function resolveSeriesData(idOrData){\r\n  if(idOrData === 'demo'){\r\n    const { DEMO_SERIES } = await loadDemoDataModule();\r\n    return mapShow(DEMO_SERIES);\r\n  }\r\n  if(idOrData && typeof idOrData === 'object') return mapShow(idOrData);\r\n  const str = idOrData == null ? '' : String(idOrData).trim();\r\n  if(!str) return null;\r\n  const state = getState();\r\n  const shows = Array.isArray(state?.shows) ? state.shows : [];\r\n  const match = shows.find(show => matchesIdentifier(show, str));\r\n  return match ? mapShow(match) : null;\r\n}\r\n\r\nfunction matchesIdentifier(item, id){\r\n  if(!item) return false;\r\n  const str = String(id || '').trim();\r\n  if(!str) return false;\r\n  if(item?.ids?.imdb && String(item.ids.imdb) === str) return true;\r\n  if(item?.ids?.tmdb && String(item.ids.tmdb) === str) return true;\r\n  if(item?.ratingKey != null && String(item.ratingKey) === str) return true;\r\n  return false;\r\n}\r\n", "const DEFAULT_ESTIMATED_HEIGHT = 420;\r\nconst DEFAULT_MIN_WIDTH = 190;\r\n\r\nconst raf = typeof requestAnimationFrame === 'function'\r\n  ? requestAnimationFrame\r\n  : (cb)=> setTimeout(cb, 16);\r\nconst caf = typeof cancelAnimationFrame === 'function'\r\n  ? cancelAnimationFrame\r\n  : (id)=> clearTimeout(id);\r\n\r\nfunction noop(){}\r\n\r\nfunction parsePx(value){\r\n  const num = parseFloat(value);\r\n  return Number.isFinite(num) ? num : 0;\r\n}\r\n\r\nexport class VirtualList {\r\n  constructor({\r\n    container,\r\n    renderItem,\r\n    getKey = noop,\r\n    updateItem = null,\r\n    getSignature = null,\r\n    overscan = 2,\r\n    estimatedItemHeight = DEFAULT_ESTIMATED_HEIGHT,\r\n    minItemWidth = DEFAULT_MIN_WIDTH\r\n  }){\r\n    if(!container) throw new Error('VirtualList requires a container element');\r\n    if(typeof renderItem !== 'function') throw new Error('VirtualList requires a renderItem function');\r\n\r\n    this.container = container;\r\n    this.renderItem = renderItem;\r\n    this.getKey = getKey;\r\n    this.updateItem = typeof updateItem === 'function' ? updateItem : null;\r\n    this.getSignature = typeof getSignature === 'function' ? getSignature : null;\r\n    this.overscan = Math.max(0, overscan|0);\r\n    this.estimatedItemHeight = estimatedItemHeight;\r\n    this.minItemWidth = minItemWidth;\r\n\r\n    this.items = [];\r\n    this.range = { start: 0, end: 0 };\r\n    this.columns = 1;\r\n    this.rowCount = 0;\r\n    this.rowHeight = this.estimatedItemHeight;\r\n    this.totalHeight = 0;\r\n    this.itemHeight = this.estimatedItemHeight;\r\n    this.containerTop = 0;\r\n    this.paddingTop = 0;\r\n    this.paddingBottom = 0;\r\n    this.gapY = 0;\r\n    this.gapX = 0;\r\n    this.metricsDirty = true;\r\n    this.pendingFrame = 0;\r\n    this.lastWidth = 0;\r\n\r\n    this.nodeCache = new Map();\r\n    this.renderedKeys = new Set();\r\n    this.itemSignatures = new Map();\r\n    this.scrollTicking = false;\r\n\r\n    this.spacer = document.createElement('div');\r\n    this.spacer.className = 'grid-virtual__spacer';\r\n    this.windowEl = document.createElement('div');\r\n    this.windowEl.className = 'grid-virtual__window';\r\n    this.itemsHost = document.createElement('div');\r\n    this.itemsHost.className = 'grid-virtual__items';\r\n\r\n    this.container.textContent = '';\r\n    this.windowEl.append(this.itemsHost);\r\n    this.container.append(this.spacer, this.windowEl);\r\n\r\n    this.measureRoot = document.createElement('div');\r\n    this.measureRoot.className = 'grid-virtual__measure';\r\n    this.measureRoot.setAttribute('aria-hidden', 'true');\r\n    Object.assign(this.measureRoot.style, {\r\n      position: 'absolute',\r\n      visibility: 'hidden',\r\n      pointerEvents: 'none',\r\n      inset: '0 auto auto 0',\r\n      zIndex: '-1'\r\n    });\r\n    this.container.append(this.measureRoot);\r\n\r\n    this.handleScroll = this.handleScroll.bind(this);\r\n    this.handleResize = this.handleResize.bind(this);\r\n    this.update = this.update.bind(this);\r\n\r\n    window.addEventListener('scroll', this.handleScroll, { passive: true });\r\n    window.addEventListener('resize', this.handleResize);\r\n\r\n    if(typeof ResizeObserver === 'function'){\r\n      this.resizeObserver = new ResizeObserver(this.handleResize);\r\n      this.resizeObserver.observe(this.container);\r\n    } else {\r\n      this.resizeObserver = null;\r\n    }\r\n  }\r\n\r\n  destroy(){\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n    window.removeEventListener('resize', this.handleResize);\r\n    if(this.resizeObserver){\r\n      this.resizeObserver.disconnect();\r\n    }\r\n    if(this.pendingFrame){\r\n      caf(this.pendingFrame);\r\n      this.pendingFrame = 0;\r\n    }\r\n    this.nodeCache.clear();\r\n    this.renderedKeys.clear();\r\n    this.itemSignatures.clear();\r\n    this.items = [];\r\n    this.spacer.remove();\r\n    this.windowEl.remove();\r\n    this.measureRoot.remove();\r\n  }\r\n\r\n  schedule(force = false){\r\n    if(force) this.metricsDirty = true;\r\n    if(this.pendingFrame) return;\r\n    this.pendingFrame = raf(()=>{\r\n      this.pendingFrame = 0;\r\n      this.update();\r\n    });\r\n  }\r\n\r\n  handleScroll(){\r\n    if(this.scrollTicking) return;\r\n    this.scrollTicking = true;\r\n    this.schedule(false);\r\n    raf(()=>{\r\n      this.scrollTicking = false;\r\n    });\r\n  }\r\n\r\n  handleResize(){\r\n    const width = this.container.clientWidth;\r\n    if(width !== this.lastWidth){\r\n      this.metricsDirty = true;\r\n      this.lastWidth = width;\r\n    }\r\n    this.schedule(true);\r\n  }\r\n\r\n  setItems(list){\r\n    this.items = Array.isArray(list) ? list.slice() : [];\r\n    this.metricsDirty = true;\r\n    this.pruneCache();\r\n    this.measureItems();\r\n    this.update();\r\n  }\r\n\r\n  measureItems(){\r\n    if(!this.items.length){\r\n      this.itemHeight = this.estimatedItemHeight;\r\n      return;\r\n    }\r\n    const sampleItem = this.items[0];\r\n    this.measureRoot.textContent = '';\r\n    const sample = this.renderItem(sampleItem, 0);\r\n    if(sample instanceof HTMLElement){\r\n      this.measureRoot.append(sample);\r\n      if(typeof sample.getBoundingClientRect === 'function'){\r\n        const rect = sample.getBoundingClientRect();\r\n        if(rect && rect.height > 0){\r\n          this.itemHeight = rect.height;\r\n        }\r\n      } else if(sample.offsetHeight){\r\n        this.itemHeight = sample.offsetHeight;\r\n      }\r\n    }\r\n    this.measureRoot.textContent = '';\r\n  }\r\n\r\n  pruneCache(){\r\n    if(!this.items.length){\r\n      this.nodeCache.forEach(node=> node.remove());\r\n      this.nodeCache.clear();\r\n      this.itemSignatures.clear();\r\n      this.renderedKeys.clear();\r\n      return;\r\n    }\r\n    const allowed = new Set();\r\n    const nextSignatures = this.getSignature ? new Map() : null;\r\n\r\n    this.items.forEach((item, idx)=>{\r\n      const key = this.keyFor(item, idx);\r\n      allowed.add(key);\r\n      if(nextSignatures){\r\n        const signature = this.signatureFor(item, idx);\r\n        nextSignatures.set(key, signature);\r\n        const prev = this.itemSignatures.get(key);\r\n        if(prev !== undefined && prev !== signature){\r\n          const node = this.nodeCache.get(key);\r\n          if(node){\r\n            if(node.parentNode) node.parentNode.removeChild(node);\r\n            this.nodeCache.delete(key);\r\n            this.renderedKeys.delete(key);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    this.nodeCache.forEach((node, key)=>{\r\n      if(!allowed.has(key)){\r\n        if(node.parentNode) node.parentNode.removeChild(node);\r\n        this.nodeCache.delete(key);\r\n        this.renderedKeys.delete(key);\r\n      }\r\n    });\r\n\r\n    if(nextSignatures){\r\n      this.itemSignatures = nextSignatures;\r\n    } else {\r\n      this.itemSignatures.clear();\r\n    }\r\n  }\r\n\r\n  keyFor(item, index){\r\n    const raw = this.getKey ? this.getKey(item, index) : null;\r\n    if(raw === undefined || raw === null || raw === ''){\r\n      return `index-${index}`;\r\n    }\r\n    return String(raw);\r\n  }\r\n\r\n  signatureFor(item, index){\r\n    if(!this.getSignature) return undefined;\r\n    try {\r\n      return this.getSignature(item, index);\r\n    } catch (err) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  refreshMetrics(){\r\n    const containerStyle = getComputedStyle(this.container);\r\n    this.paddingTop = parsePx(containerStyle.paddingTop);\r\n    this.paddingBottom = parsePx(containerStyle.paddingBottom);\r\n\r\n    const hostStyle = getComputedStyle(this.itemsHost);\r\n    const rowGap = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('row-gap') : hostStyle.rowGap;\r\n    const colGap = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('column-gap') : hostStyle.columnGap;\r\n    const gapFallback = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('gap') : hostStyle.gap;\r\n\r\n    this.gapY = parsePx(rowGap || gapFallback);\r\n    this.gapX = parsePx(colGap || gapFallback);\r\n\r\n    const rawColumns = Math.floor((this.container.clientWidth + this.gapX) / (this.minItemWidth + this.gapX));\r\n    this.columns = Math.max(1, rawColumns || 1);\r\n    this.rowHeight = this.itemHeight + this.gapY;\r\n    if(this.rowHeight <= 0) this.rowHeight = this.itemHeight || this.estimatedItemHeight;\r\n    this.rowCount = this.columns > 0 ? Math.ceil(this.items.length / this.columns) : this.items.length;\r\n    this.totalHeight = Math.max(0, this.rowCount * this.rowHeight);\r\n\r\n    this.updateContainerPosition();\r\n\r\n    this.spacer.style.height = `${this.totalHeight}px`;\r\n    this.windowEl.style.top = `${this.paddingTop}px`;\r\n    this.windowEl.style.paddingBottom = `${this.paddingBottom}px`;\r\n    this.metricsDirty = false;\r\n  }\r\n\r\n  updateContainerPosition(){\r\n    let el = this.container;\r\n    let top = 0;\r\n    while(el && el !== document.body){\r\n      top += el.offsetTop;\r\n      el = el.offsetParent;\r\n    }\r\n    this.containerTop = top;\r\n  }\r\n\r\n  update(){\r\n    if(this.metricsDirty){\r\n      this.refreshMetrics();\r\n    }\r\n    this.syncVisibleRange();\r\n  }\r\n\r\n  syncVisibleRange(){\r\n    if(!this.items.length){\r\n      this.windowEl.style.transform = 'translate3d(0, 0, 0)';\r\n      this.itemsHost.replaceChildren();\r\n      this.range = { start: 0, end: 0 };\r\n      return;\r\n    }\r\n\r\n    const viewportTop = window.scrollY;\r\n    const viewportBottom = viewportTop + window.innerHeight;\r\n    const listStart = this.containerTop + this.paddingTop;\r\n    const listEnd = listStart + this.totalHeight;\r\n\r\n    if(window.__VLIST_DEBUG){\r\n      console.log('\uD83D\uDCCA VirtualList Debug:', {\r\n        'Scroll-Position': Math.round(window.scrollY) + 'px',\r\n        'Grid startet bei': Math.round(this.containerTop) + 'px',\r\n        'Zeilen-H\u00F6he': Math.round(this.rowHeight) + 'px',\r\n        'Spalten': this.columns,\r\n        'Gesamt-H\u00F6he': Math.round(this.totalHeight) + 'px',\r\n        'Sichtbarer Bereich': `Row ${Math.floor((viewportTop - listStart) / this.rowHeight)} - ${Math.ceil((viewportBottom - listStart) / this.rowHeight)}`\r\n      });\r\n    }\r\n\r\n    let startRow;\r\n    if(viewportTop <= listStart){\r\n      startRow = 0;\r\n    } else if(viewportTop >= listEnd){\r\n      startRow = Math.max(0, this.rowCount - 1);\r\n    } else {\r\n      startRow = Math.floor((viewportTop - listStart) / this.rowHeight);\r\n    }\r\n\r\n    let endRow;\r\n    if(viewportBottom >= listEnd){\r\n      endRow = Math.max(0, this.rowCount - 1);\r\n    } else if(viewportBottom <= listStart){\r\n      endRow = 0;\r\n    } else {\r\n      endRow = Math.ceil((viewportBottom - listStart) / this.rowHeight);\r\n    }\r\n\r\n    startRow = Math.max(0, Math.min(startRow, Math.max(0, this.rowCount - 1)) - this.overscan);\r\n    endRow = Math.min(Math.max(0, this.rowCount - 1), endRow + this.overscan);\r\n\r\n    const start = Math.max(0, Math.min(this.items.length, startRow * this.columns));\r\n    const end = Math.max(start, Math.min(this.items.length, (endRow + 1) * this.columns));\r\n\r\n    if(start === this.range.start && end === this.range.end){\r\n      let needsRefresh = false;\r\n      for(let i=start; i<end; i++){\r\n        const key = this.keyFor(this.items[i], i);\r\n        if(!this.renderedKeys.has(key)){\r\n          needsRefresh = true;\r\n          break;\r\n        }\r\n      }\r\n      if(!needsRefresh){\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.range = { start, end };\r\n    const offsetRow = Math.floor(start / this.columns);\r\n    const offsetY = offsetRow * this.rowHeight;\r\n    this.windowEl.style.transform = `translate3d(0, ${offsetY}px, 0)`;\r\n\r\n    const nextRendered = new Set();\r\n    const toRender = [];\r\n\r\n    for(let i=start; i<end; i++){\r\n      const item = this.items[i];\r\n      const key = this.keyFor(item, i);\r\n      let node = this.nodeCache.get(key);\r\n      if(node){\r\n        if(this.updateItem){\r\n          const updated = this.updateItem(node, item, i);\r\n          if(updated instanceof HTMLElement && updated !== node){\r\n            node = updated;\r\n            this.nodeCache.set(key, node);\r\n          } else if(!(updated instanceof HTMLElement)){\r\n            continue;\r\n          }\r\n        }\r\n      } else {\r\n        node = this.renderItem(item, i);\r\n        if(!(node instanceof HTMLElement)) continue;\r\n        this.nodeCache.set(key, node);\r\n      }\r\n      nextRendered.add(key);\r\n      toRender.push(node);\r\n    }\r\n\r\n    // Reconcile DOM with minimal operations\r\n    const currentChildren = this.itemsHost.children;\r\n\r\n    // Quick path: exact same content\r\n    if(currentChildren.length === toRender.length){\r\n      let same = true;\r\n      for(let i = 0; i < toRender.length; i++){\r\n        if(currentChildren[i] !== toRender[i]){\r\n          same = false;\r\n          break;\r\n        }\r\n      }\r\n      if(same){\r\n        this.renderedKeys = nextRendered;\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Build a map of current positions\r\n    const currentMap = new Map();\r\n    for(let i = 0; i < currentChildren.length; i++){\r\n      currentMap.set(currentChildren[i], i);\r\n    }\r\n\r\n    // Update nodes position by position\r\n    for(let i = 0; i < toRender.length; i++){\r\n      const desired = toRender[i];\r\n      const current = currentChildren[i];\r\n\r\n      if(current !== desired){\r\n        if(currentMap.has(desired)){\r\n          // Node exists somewhere - move it\r\n          this.itemsHost.insertBefore(desired, current || null);\r\n        } else {\r\n          // New node - insert it\r\n          this.itemsHost.insertBefore(desired, current || null);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Remove any extra nodes at the end\r\n    while(this.itemsHost.children.length > toRender.length){\r\n      this.itemsHost.lastChild.remove();\r\n    }\r\n\r\n    this.renderedKeys = nextRendered;\r\n  }\r\n}\r\n", "import { getState } from './state.js';\r\nimport { el } from './dom.js';\r\nimport { humanYear, formatRating, renderChipsLimited, useTmdbOn, isNew, getGenreNames, collectionTags } from './utils.js';\r\nimport * as Watch from './watchlist.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { navigateToHash } from './main.js';\r\nimport { VirtualList } from './grid/virtualList.js';\r\n\r\nconst CARD_SIGNATURE_PROP = '__gridVirtualSignature';\r\n\r\nfunction cardEl(item){\r\n  const card = el('article','card');\r\n  card.dataset.kind = (item?.type === 'tv') ? 'show' : 'movie';\r\n  card.tabIndex = 0;\r\n  card.setAttribute('role', 'button');\r\n  if(item?.title) card.setAttribute('aria-label', item.title);\r\n\r\n  // 1) Media Block\r\n  const media = el('div','card__media');\r\n  const img = new Image();\r\n  img.loading = 'lazy';\r\n  img.decoding = 'async';\r\n  img.className = 'card__img';\r\n  img.alt = item?.title || '';\r\n  img.style.aspectRatio = '2 / 3';\r\n  const src = resolvePoster(item);\r\n  if(src) img.src = src;\r\n\r\n  const gradient = el('div','card__media-gradient');\r\n  gradient.setAttribute('aria-hidden','true');\r\n\r\n  const badges = buildItemBadges(item);\r\n  const badgeContainer = el('div','card__badges');\r\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\r\n\r\n  media.append(img, gradient);\r\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\r\n\r\n  const pct = progressPercent(item);\r\n  if(pct > 0){\r\n    const track = el('div','card__progress');\r\n    const fill = document.createElement('span');\r\n    fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;\r\n    track.append(fill);\r\n    media.append(track);\r\n  }\r\n\r\n  // 2) Info Block\r\n  const body = el('div','card__body');\r\n  const title = document.createElement('h3');\r\n  title.className = 'card__title';\r\n  title.textContent = item?.title || '';\r\n  if(item?.title) title.setAttribute('title', item.title);\r\n\r\n  const sub = el('div','card__meta');\r\n  const metaPieces = buildMetaPieces(item);\r\n  sub.textContent = metaPieces.join(' \u2022 ');\r\n\r\n  body.append(title, sub);\r\n\r\n  // 3) Actions Block\r\n  const actions = el('div','card__actions');\r\n\r\n  const chips = el('div','card__chips');\r\n  const genres = getGenreNames(item?.genres);\r\n  renderChipsLimited(chips, genres, 3);\r\n\r\n  const watchBtn = document.createElement('button');\r\n  watchBtn.type = 'button';\r\n  watchBtn.className = 'card__primary';\r\n  updateWatchButtonState(watchBtn, item);\r\n  watchBtn.addEventListener('click', ev=>{\r\n    ev.stopPropagation();\r\n    Watch.toggle(item);\r\n    updateWatchButtonState(watchBtn, item);\r\n  });\r\n\r\n  actions.append(chips, watchBtn);\r\n\r\n  card.append(media, body, actions);\r\n\r\n  card.addEventListener('click', ()=> openDetail(item));\r\n  card.addEventListener('keydown', ev=>{\r\n    if(ev.target !== card) return;\r\n    if(ev.key === 'Enter' || ev.key === ' '){\r\n      ev.preventDefault();\r\n      openDetail(item);\r\n    }\r\n  });\r\n\r\n  return card;\r\n}\r\n\r\nfunction createCollectionGroup(name, members){\r\n  const list = (members||[]).slice().sort((a,b)=>{\r\n    const ay = Number(humanYear(a)) || 0;\r\n    const by = Number(humanYear(b)) || 0;\r\n    if(ay !== by) return ay - by;\r\n    return (a.title||'').localeCompare(b.title||'', 'de');\r\n  });\r\n  const years = list.map(item=>Number(humanYear(item))||0).filter(Boolean);\r\n  const year = years.length ? Math.min(...years) : '';\r\n  const addedTimestamps = list.map(item=> new Date(item.addedAt||0).getTime()).filter(Number.isFinite);\r\n  const latestAdded = addedTimestamps.length ? new Date(Math.max(...addedTimestamps)).toISOString() : null;\r\n  const ratings = list.map(item=>Number(item.rating ?? item.audienceRating)).filter(Number.isFinite);\r\n  const rating = ratings.length ? ratings.reduce((sum,val)=>sum+val,0) / ratings.length : null;\r\n  const posterItem = list.find(entry=>entry.thumbFile) || list[0] || null;\r\n  const genres = Array.from(new Set(list.flatMap(entry=>getGenreNames(entry.genres)))).slice(0,4);\r\n  return { isCollectionGroup:true, type:'collection', title:name, collectionName:name, items:list, itemCount:list.length, year: year || '', addedAt: latestAdded, rating, posterItem, genres };\r\n}\r\n\r\nfunction groupCollectionsIfEnabled(items){\r\n  const togg = document.getElementById('groupCollections');\r\n  const colSel = document.getElementById('collectionFilter');\r\n  const selected = colSel && colSel.value;\r\n  if(!togg || !togg.checked) return items;\r\n  if(selected) return items; // drilling into a single collection -> show items, not groups\r\n  const membership = new Map();\r\n  items.forEach(item=>{\r\n    collectionTags(item).forEach(name=>{\r\n      if(!membership.has(name)) membership.set(name, []);\r\n      membership.get(name).push(item);\r\n    });\r\n  });\r\n  const groups = [];\r\n  membership.forEach((members, name)=>{ groups.push(createCollectionGroup(name, members)); });\r\n  // preserve stable order by title\r\n  groups.sort((a,b)=> a.title.localeCompare(b.title,'de'));\r\n  return groups;\r\n}\r\n\r\nfunction collectionCardEl(entry){\r\n  const card = el('article','card card--collection');\r\n  card.dataset.kind = 'collection';\r\n  card.tabIndex = 0;\r\n  card.setAttribute('role', 'button');\r\n  if(entry?.title) card.setAttribute('aria-label', entry.title);\r\n\r\n  // 1) Media Block\r\n  const media = el('div','card__media');\r\n  const baseItem = entry.posterItem || {};\r\n  const img = new Image();\r\n  img.loading = 'lazy';\r\n  img.decoding = 'async';\r\n  img.className = 'card__img';\r\n  img.alt = entry?.title || '';\r\n  img.style.aspectRatio = '2 / 3';\r\n  const src = resolvePoster(baseItem);\r\n  if(src) img.src = src;\r\n\r\n  const gradient = el('div','card__media-gradient');\r\n  gradient.setAttribute('aria-hidden','true');\r\n\r\n  const badges = buildCollectionBadges(entry);\r\n  const badgeContainer = el('div','card__badges');\r\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\r\n\r\n  media.append(img, gradient);\r\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\r\n\r\n  // 2) Info Block\r\n  const body = el('div','card__body');\r\n  const title = document.createElement('h3');\r\n  title.className = 'card__title';\r\n  title.textContent = entry.title || '';\r\n  if(entry?.title) title.setAttribute('title', entry.title);\r\n\r\n  const sub = el('div','card__meta');\r\n  const pieces = collectionMetaPieces(entry);\r\n  sub.textContent = pieces.filter(Boolean).join(' \u2022 ');\r\n\r\n  body.append(title, sub);\r\n\r\n  // 3) Actions Block\r\n  const actions = el('div','card__actions');\r\n  const chips = el('div','card__chips');\r\n  renderChipsLimited(chips, entry.genres||[], 3);\r\n  actions.append(chips);\r\n\r\n  card.append(media, body, actions);\r\n\r\n  card.addEventListener('click', ()=>{\r\n    const sel = document.getElementById('collectionFilter');\r\n    if(sel){\r\n      sel.value = entry.collectionName || entry.title || '';\r\n      sel.dispatchEvent(new Event('change', { bubbles:true }));\r\n    }\r\n  });\r\n\r\n  card.addEventListener('keydown', ev=>{\r\n    if(ev.target !== card) return;\r\n    if(ev.key === 'Enter' || ev.key === ' '){\r\n      ev.preventDefault();\r\n      const sel = document.getElementById('collectionFilter');\r\n      if(sel){\r\n        sel.value = entry.collectionName || entry.title || '';\r\n        sel.dispatchEvent(new Event('change', { bubbles:true }));\r\n      }\r\n    }\r\n  });\r\n\r\n  return card;\r\n}\r\n\r\nlet virtualListInstance = null;\r\n\r\nfunction ensureVirtualList(grid){\r\n  if(virtualListInstance) return virtualListInstance;\r\n  virtualListInstance = new VirtualList({\r\n    container: grid,\r\n    overscan: 1,\r\n    estimatedItemHeight: 460,\r\n    minItemWidth: 190,\r\n    getKey: itemKey,\r\n    getSignature: gridItemSignature,\r\n    renderItem(item){\r\n      const node = renderGridItemNode(item);\r\n      return node;\r\n    },\r\n    updateItem(node, item){\r\n      return refreshGridItemNode(node, item);\r\n    }\r\n  });\r\n  return virtualListInstance;\r\n}\r\n\r\nfunction itemKey(item, index){\r\n  if(item?.isCollectionGroup){\r\n    const key = item.collectionName || item.title || '';\r\n    return key ? `collection:${key}` : `collection-index-${index}`;\r\n  }\r\n  const id = resolveItemId(item);\r\n  return id ? `item:${id}` : `item-index-${index}`;\r\n}\r\n\r\nfunction renderGridItemNode(item){\r\n  const node = item?.isCollectionGroup ? collectionCardEl(item) : cardEl(item);\r\n  if(node instanceof HTMLElement){\r\n    node[CARD_SIGNATURE_PROP] = gridItemSignature(item);\r\n  }\r\n  return node;\r\n}\r\n\r\nfunction refreshGridItemNode(current, item){\r\n  if(current instanceof HTMLElement){\r\n    const signature = gridItemSignature(item);\r\n    if(current[CARD_SIGNATURE_PROP] === signature){\r\n      current[CARD_SIGNATURE_PROP] = signature;\r\n      return current;\r\n    }\r\n  }\r\n  const replacement = renderGridItemNode(item);\r\n  if(!(replacement instanceof HTMLElement)) return current;\r\n  return replaceCardNode(current, replacement);\r\n}\r\n\r\nlet lastRenderedView = null;\r\n\r\nexport function renderGrid(view){\r\n  const { movies, shows, filtered } = getState();\r\n  const base = (view==='shows' ? shows : movies) || [];\r\n  const list = Array.isArray(filtered) ? filtered : base;\r\n  const items = groupCollectionsIfEnabled(list);\r\n  const grid = document.getElementById('grid');\r\n  if(!grid) return;\r\n\r\n  const shouldAnimate = lastRenderedView !== view;\r\n  lastRenderedView = view;\r\n\r\n  if(shouldAnimate) beginGridTransition(grid);\r\n  const vlist = ensureVirtualList(grid);\r\n  vlist.setItems(items);\r\n  if(shouldAnimate) finishGridTransition(grid);\r\n  const empty = document.getElementById('empty');\r\n  if(empty) empty.hidden = items.length > 0;\r\n  grid.setAttribute('aria-busy', 'false');\r\n}\r\n\r\nfunction beginGridTransition(grid){\r\n  if(!grid) return;\r\n  grid.classList.remove('is-entering','is-ready');\r\n  grid.classList.add('is-leaving');\r\n}\r\n\r\nfunction finishGridTransition(grid){\r\n  if(!grid) return;\r\n  grid.classList.remove('is-leaving');\r\n  grid.classList.add('is-entering');\r\n  requestAnimationFrame(()=>{\r\n    grid.classList.add('is-ready');\r\n    setTimeout(()=>grid.classList.remove('is-entering','is-ready'), 240);\r\n  });\r\n}\r\n\r\n\r\nfunction resolvePoster(item){\r\n  if(!item) return '';\r\n  const tmdbPoster = useTmdbOn() && (item?.tmdb?.poster || item?.tmdbPoster);\r\n  const fallback = item?.thumbFile || item?.poster || item?.art || item?.thumb || '';\r\n  return tmdbPoster || fallback || '';\r\n}\r\n\r\nfunction itemBadgeTexts(item){\r\n  const badges = [];\r\n  if(isNew(item)) badges.push('Neu');\r\n  const contentRating = String(item?.contentRating || '').trim();\r\n  if(contentRating) badges.push(contentRating);\r\n  const ratingNum = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(ratingNum)) badges.push(`\u2605 ${formatRating(ratingNum)}`);\r\n  return badges.slice(0, 3);\r\n}\r\n\r\nfunction buildItemBadges(item){\r\n  return itemBadgeTexts(item).map(createBadge);\r\n}\r\n\r\nfunction collectionBadgeTexts(entry){\r\n  const badges = [];\r\n  if(Number.isFinite(entry?.itemCount) && entry.itemCount > 0) badges.push(`${entry.itemCount} Titel`);\r\n  if(entry?.year) badges.push(String(entry.year));\r\n  return badges;\r\n}\r\n\r\nfunction buildCollectionBadges(entry){\r\n  return collectionBadgeTexts(entry).map(createBadge);\r\n}\r\n\r\nfunction createBadge(text){\r\n  const badge = document.createElement('span');\r\n  badge.className = 'badge';\r\n  badge.textContent = String(text || '');\r\n  return badge;\r\n}\r\n\r\nfunction updateWatchButtonState(button, item){\r\n  if(!button) return;\r\n  const saved = Watch.isSaved(item);\r\n  button.textContent = saved ? 'Gemerkt' : 'Merken';\r\n  button.classList.toggle('active', saved);\r\n  button.setAttribute('aria-pressed', saved ? 'true' : 'false');\r\n}\r\n\r\nfunction buildMetaPieces(item){\r\n  const pieces = [];\r\n  const year = humanYear(item);\r\n  if(year) pieces.push(String(year));\r\n  const runtime = formatRuntime(item);\r\n  if(runtime) pieces.push(runtime);\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\r\n  const studio = item?.studio || item?.network || '';\r\n  if(studio) pieces.push(studio);\r\n  return pieces;\r\n}\r\n\r\nfunction collectionMetaPieces(entry){\r\n  const pieces = [];\r\n  if(entry?.year) pieces.push(String(entry.year));\r\n  const count = Number(entry?.itemCount);\r\n  if(Number.isFinite(count)) pieces.push(`${count} Titel`);\r\n  const rating = Number(entry?.rating);\r\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\r\n  return pieces;\r\n}\r\n\r\nfunction formatRuntime(item){\r\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  const minutes = Number(raw);\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\r\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\r\n  return `${minutes} min`;\r\n}\r\n\r\nfunction progressPercent(item){\r\n  const offset = Number(item?.viewOffset ?? item?.viewoffset);\r\n  const duration = Number(item?.duration);\r\n  if(!Number.isFinite(offset) || !Number.isFinite(duration) || duration <= 0) return 0;\r\n  return Math.max(1, Math.min(100, Math.round((offset / duration) * 100)));\r\n}\r\n\r\nfunction resolveItemId(item){\r\n  if(!item) return '';\r\n  const preferred = item?.ids?.imdb || item?.ids?.tmdb;\r\n  if(preferred) return String(preferred);\r\n  if(item?.ratingKey) return String(item.ratingKey);\r\n  return '';\r\n}\r\n\r\nfunction gridItemSignature(entry){\r\n  if(entry?.isCollectionGroup) return collectionSignature(entry);\r\n  return itemSignature(entry);\r\n}\r\n\r\nfunction itemSignature(item){\r\n  const genres = getGenreNames(item?.genres).slice(0, 3);\r\n  const badges = itemBadgeTexts(item);\r\n  const meta = buildMetaPieces(item);\r\n  return JSON.stringify({\r\n    id: resolveItemId(item),\r\n    title: item?.title || '',\r\n    poster: resolvePoster(item),\r\n    badges,\r\n    meta,\r\n    progress: progressPercent(item),\r\n    watch: Watch.isSaved(item),\r\n    genres\r\n  });\r\n}\r\n\r\nfunction collectionSignature(entry){\r\n  const baseItem = entry?.posterItem || null;\r\n  const genres = Array.isArray(entry?.genres) ? entry.genres.slice(0, 3).map(String) : [];\r\n  const badges = collectionBadgeTexts(entry);\r\n  const meta = collectionMetaPieces(entry);\r\n  const count = Number(entry?.itemCount);\r\n  const ratingValue = Number(entry?.rating);\r\n  return JSON.stringify({\r\n    name: entry?.collectionName || entry?.title || '',\r\n    title: entry?.title || '',\r\n    itemCount: Number.isFinite(count) ? count : null,\r\n    year: entry?.year || '',\r\n    rating: Number.isFinite(ratingValue) ? ratingValue : null,\r\n    poster: resolvePoster(baseItem),\r\n    badges,\r\n    meta,\r\n    genres\r\n  });\r\n}\r\n\r\nfunction replaceCardNode(current, replacement){\r\n  if(!(replacement instanceof HTMLElement)) return current;\r\n  if(!(current instanceof HTMLElement)) return replacement;\r\n  const parent = current.parentNode;\r\n  const hadFocus = document.activeElement === current;\r\n  if(parent){\r\n    parent.replaceChild(replacement, current);\r\n  }\r\n  if(hadFocus && typeof replacement.focus === 'function'){\r\n    requestAnimationFrame(()=>{\r\n      try {\r\n        replacement.focus({ preventScroll: true });\r\n      } catch (err) {\r\n        replacement.focus();\r\n      }\r\n    });\r\n  }\r\n  return replacement;\r\n}\r\n\r\nfunction updateHash(kind, id){\r\n  if(!kind || !id) return;\r\n  const hash = `#/${kind}/${id}`;\r\n  const replace = (window.location.hash || '') === hash;\r\n  navigateToHash(hash, { silent: true, replace });\r\n}\r\n\r\nfunction openDetail(item){\r\n  if(!item) return;\r\n  const kind = item?.type === 'tv' ? 'show' : 'movie';\r\n  const id = resolveItemId(item);\r\n  if(id) updateHash(kind, id);\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n}\r\n", "import { getState, setState } from './state.js';\r\nimport { qs } from './dom.js';\r\nimport { getGenreNames, humanYear, collectionTags, isNew } from './utils.js';\r\n\r\nfunction norm(s){ return String(s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\r\n\r\nfunction matches(item, opts){\r\n  const query = norm(opts.query||'');\r\n  const onlyNew = !!opts.onlyNew;\r\n  const yearFrom = Number(opts.yearFrom)||null;\r\n  const yearTo = Number(opts.yearTo)||null;\r\n  const genresActive = opts.genres || new Set();\r\n  const selectedCollection = opts.collection || '';\r\n\r\n  if(query){\r\n    const haystack = norm([\r\n      item.title,\r\n      item.originalTitle,\r\n      item.summary,\r\n      item.studio,\r\n      getGenreNames(item.genres).join(' '),\r\n      (item.roles||[]).map(r=>r && (r.tag||r.role||r.name)).join(' '),\r\n      collectionTags(item).join(' '),\r\n    ].filter(Boolean).join(' '));\r\n    if(!haystack.includes(query)) return false;\r\n  }\r\n\r\n  if(onlyNew && !isNew(item)) return false;\r\n\r\n  const year = Number(humanYear(item)) || null;\r\n  if(yearFrom && (!year || year < yearFrom)) return false;\r\n  if(yearTo && (!year || year > yearTo)) return false;\r\n\r\n  if(genresActive.size){\r\n    const itemGenres = new Set(getGenreNames(item.genres));\r\n    for(const g of genresActive){ if(!itemGenres.has(g)) return false; }\r\n  }\r\n\r\n  if(selectedCollection){\r\n    const tags = new Set(collectionTags(item));\r\n    if(!tags.has(selectedCollection)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction sortItems(items, key){\r\n  const arr = items.slice();\r\n  switch(key){\r\n    case 'year-desc':\r\n      arr.sort((a,b)=> (Number(humanYear(b))||0) - (Number(humanYear(a))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\r\n    case 'year-asc':\r\n      arr.sort((a,b)=> (Number(humanYear(a))||0) - (Number(humanYear(b))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\r\n    case 'title-desc':\r\n      arr.sort((a,b)=> String(b.title||'').localeCompare(String(a.title||''),'de')); break;\r\n    case 'added-desc':\r\n      arr.sort((a,b)=> new Date(b.addedAt||0)-new Date(a.addedAt||0)); break;\r\n    case 'title-asc':\r\n    default:\r\n      arr.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||''),'de'));\r\n  }\r\n  return arr;\r\n}\r\n\r\nexport function computeFacets(movies, shows){\r\n  const genres = new Set();\r\n  const years = new Set();\r\n  const collections = new Set();\r\n  const add = (arr)=> (arr||[]).forEach(x=>{\r\n    getGenreNames(x.genres).forEach(name=>genres.add(name));\r\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\r\n    if(y) years.add(Number(y));\r\n    collectionTags(x).forEach(c=>collections.add(c));\r\n  });\r\n  add(movies); add(shows);\r\n  const ys = [...years].sort((a,b)=>a-b);\r\n  return { genres:[...genres].sort(), years:ys, collections:[...collections].sort((a,b)=>a.localeCompare(b,'de')) };\r\n}\r\n\r\nexport function renderFacets(f){\r\n  // years\r\n  const yFrom = qs('#yearFrom'); const yTo = qs('#yearTo');\r\n  if(yFrom){ yFrom.replaceChildren(new Option('Ab Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\r\n  if(yTo){ yTo.replaceChildren(new Option('Bis Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\r\n  // collections\r\n  const col = qs('#collectionFilter');\r\n  if(col){ col.replaceChildren(new Option('Alle Collections',''), ...f.collections.map(c=>new Option(c,c))); }\r\n  // genres\r\n  const gRoot = qs('#genreFilters');\r\n  if(gRoot){\r\n    const chips = f.genres.map(name=>{\r\n      const b = document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=name; b.dataset.name=name; return b;\r\n    });\r\n    gRoot.replaceChildren(...chips);\r\n    updateGenreFilterState();\r\n  }\r\n}\r\n\r\nfunction getFilterOpts(){\r\n  const searchInput = document.getElementById('search') || document.getElementById('q');\r\n  const query = (searchInput?.value || '').trim();\r\n  const onlyNew = qs('#onlyNew')?.checked || false;\r\n  const yearFrom = qs('#yearFrom')?.value || '';\r\n  const yearTo = qs('#yearTo')?.value || '';\r\n  const collection = qs('#collectionFilter')?.value || '';\r\n  const sort = qs('#sort')?.value || 'title-asc';\r\n  const genres = new Set();\r\n  document.querySelectorAll('#genreFilters .chip.active').forEach(n=>genres.add(n.dataset.name));\r\n  return { query, onlyNew, yearFrom, yearTo, collection, genres, sort };\r\n}\r\n\r\nexport function applyFilters(){\r\n  const s = getState();\r\n  const view = s.view;\r\n  const pool = view==='shows' ? s.shows : s.movies;\r\n  const opts = getFilterOpts();\r\n  const filtered = (pool||[]).filter(item=>matches(item, opts));\r\n  const ordered = sortItems(filtered, opts.sort);\r\n  setState({ filtered: ordered });\r\n  return ordered;\r\n}\r\n\r\nlet gridModulePromise = null;\r\nfunction renderGridForCurrentView(){\r\n  if(!gridModulePromise){\r\n    gridModulePromise = import('./grid.js');\r\n  }\r\n  gridModulePromise.then(mod=>{\r\n    const fn = mod && mod.renderGrid;\r\n    if(typeof fn === 'function') fn(getState().view);\r\n  }).catch(console.error);\r\n}\r\n\r\nlet filtersUpdatedHandler = null;\r\n\r\nexport function setFiltersUpdatedHandler(handler){\r\n  filtersUpdatedHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nexport function updateFiltersAndGrid(){\r\n  const result = applyFilters();\r\n  renderGridForCurrentView();\r\n  if(filtersUpdatedHandler){\r\n    try{\r\n      const payload = Array.isArray(result) ? result.slice() : [];\r\n      filtersUpdatedHandler(payload, getState().view);\r\n    }catch(err){\r\n      console.warn('[filter] Failed to notify filters handler:', err?.message);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction updateGenreFilterState(){\r\n  const root = document.getElementById('genreFilters');\r\n  if(!root) return;\r\n  const activeCount = root.querySelectorAll('.chip.active').length;\r\n  root.dataset.state = activeCount > 0 ? 'active' : 'empty';\r\n  root.dataset.count = String(activeCount);\r\n}\r\n\r\nexport function initFilters(){\r\n  // populate sort options\r\n  const sortSel = qs('#sort');\r\n  if(sortSel && sortSel.options.length===0){\r\n    [['title-asc','Titel A\u2013Z'],['title-desc','Titel Z\u2013A'],['year-desc','Jahr \u2193'],['year-asc','Jahr \u2191'],['added-desc','Zuletzt hinzugef\u00FCgt']]\r\n      .forEach(([v,l])=> sortSel.add(new Option(l, v)));\r\n  }\r\n\r\n  const bind = (sel, ev='input')=>{\r\n    const n = qs(sel);\r\n    if(!n) return;\r\n    n.addEventListener(ev, ()=>{ updateFiltersAndGrid(); });\r\n    if(ev === 'input' && n instanceof HTMLInputElement && n.type === 'search'){\r\n      n.addEventListener('search', ()=>{ updateFiltersAndGrid(); });\r\n    }\r\n  };\r\n  bind('#search');\r\n  bind('#q');\r\n  bind('#onlyNew','change'); bind('#yearFrom','change'); bind('#yearTo','change'); bind('#collectionFilter','change'); bind('#sort','change'); bind('#groupCollections','change');\r\n  const yrReset = qs('#yearReset'); if(yrReset){ yrReset.addEventListener('click',()=>{ const a=qs('#yearFrom'); const b=qs('#yearTo'); if(a) a.value=''; if(b) b.value=''; updateFiltersAndGrid(); }); }\r\n  const gRoot = qs('#genreFilters');\r\n  if(gRoot){\r\n    gRoot.addEventListener('click', ev=>{\r\n      const t = ev.target;\r\n      if(!(t instanceof HTMLElement)) return;\r\n      if(!t.classList.contains('chip')) return;\r\n      t.classList.toggle('active');\r\n      updateGenreFilterState();\r\n      updateFiltersAndGrid();\r\n    });\r\n    updateGenreFilterState();\r\n  }\r\n}\r\n\r\n", "// Optional TMDB enrichment. Supports v4 Bearer token or v3 API key.\r\n\r\nconst API_V3 = 'https://api.themoviedb.org/3';\r\nconst IMG = 'https://image.tmdb.org/t/p/';\r\nconst POSTER_W = 'w342';\r\nconst BACKDROP_W = 'w780';\r\n\r\nconst LOG_PREFIX = '[tmdb]';\r\n\r\nlet cache;\r\n\r\nfunction loadCache(){\r\n  try{\r\n    return new Map(JSON.parse(localStorage.getItem('tmdbCache')||'[]'));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to load persisted TMDB cache:`, err);\r\n    return new Map();\r\n  }\r\n}\r\nfunction persist(){\r\n  try{\r\n    localStorage.setItem('tmdbCache', JSON.stringify(Array.from(cache.entries())));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to persist TMDB cache:`, err);\r\n  }\r\n}\r\nexport function clearCache(){\r\n  try{\r\n    localStorage.removeItem('tmdbCache');\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to clear TMDB cache from storage:`, err);\r\n  }\r\n  cache = new Map();\r\n}\r\n\r\nfunction tokenFromEnv(cfg){\r\n  try{\r\n    const t = localStorage.getItem('tmdbToken');\r\n    if(t) return { kind:'bearer', value: t };\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to read TMDB token from storage:`, err);\r\n  }\r\n  if(cfg?.tmdbApiKey) return { kind:'apikey', value: String(cfg.tmdbApiKey) };\r\n  return { kind:'none', value: '' };\r\n}\r\n\r\nfunction keyFor(item){\r\n  const t = (item.type==='tv') ? 'tv' : 'movie';\r\n  const imdb = item?.ids?.imdb || '';\r\n  const tmdb = item?.ids?.tmdb || '';\r\n  const title = (item.title||'').toLowerCase();\r\n  const year = String(item.year || '').slice(0,4);\r\n  return [t, imdb, tmdb, title, year].filter(Boolean).join('|');\r\n}\r\n\r\nfunction withAuth(url, auth){\r\n  if(!auth || auth.kind==='none') return { url, init:{} };\r\n  if(auth.kind==='bearer') return { url, init: { headers: { 'Authorization': `Bearer ${auth.value}`, 'Accept':'application/json' } } };\r\n  // v3 api key via query param\r\n  const sep = url.includes('?') ? '&' : '?';\r\n  return { url: `${url}${sep}api_key=${encodeURIComponent(auth.value)}`, init: { headers: { 'Accept':'application/json' } } };\r\n}\r\n\r\nasync function getJson(url, auth){\r\n  const { url: u, init } = withAuth(url, auth);\r\n  const res = await fetch(u, init);\r\n  if(!res.ok) throw new Error('HTTP '+res.status);\r\n  return res.json();\r\n}\r\n\r\nfunction pickBestPoster(p){ return p?.file_path ? IMG+POSTER_W+p.file_path : ''; }\r\nfunction pickBestBackdrop(p){ return p?.file_path ? IMG+BACKDROP_W+p.file_path : ''; }\r\n\r\nasync function byId(type, id, lang, auth){\r\n  const inf = await getJson(`${API_V3}/${type}/${id}?language=${encodeURIComponent(lang||'de-DE')}`, auth);\r\n  const images = await getJson(`${API_V3}/${type}/${id}/images`, auth).catch((err)=>{\r\n    console.warn(`${LOG_PREFIX} Failed to fetch TMDB images for ${type}#${id}:`, err);\r\n    return { posters:[], backdrops:[] };\r\n  });\r\n  const poster = pickBestPoster((images.posters||[])[0]) || (inf.poster_path ? IMG+POSTER_W+inf.poster_path : '');\r\n  const backdrop = pickBestBackdrop((images.backdrops||[])[0]) || (inf.backdrop_path ? IMG+BACKDROP_W+inf.backdrop_path : '');\r\n  return { id: inf.id, poster, backdrop, url: `https://www.themoviedb.org/${type}/${inf.id}` };\r\n}\r\n\r\nasync function bySearch(type, title, year, lang, auth){\r\n  const q = encodeURIComponent(title||'');\r\n  const yParam = year ? `&year=${encodeURIComponent(String(year))}` : '';\r\n  const res = await getJson(`${API_V3}/search/${type}?query=${q}${yParam}&language=${encodeURIComponent(lang||'de-DE')}`, auth);\r\n  const first = (res.results||[])[0];\r\n  if(!first) throw new Error('not found');\r\n  return byId(type, first.id, lang, auth);\r\n}\r\n\r\nasync function hydrateItem(item, cfg, auth){\r\n  const type = (item.type==='tv') ? 'tv' : 'movie';\r\n  const k = keyFor(item);\r\n  if(cache.has(k)) return cache.get(k);\r\n  let out;\r\n  try{\r\n    if(item?.ids?.tmdb){ out = await byId(type, item.ids.tmdb, cfg.lang, auth); }\r\n    else if(item?.ids?.imdb){\r\n      // find by external id\r\n      const json = await getJson(`${API_V3}/find/${item.ids.imdb}?external_source=imdb_id&language=${encodeURIComponent(cfg.lang||'de-DE')}`, auth);\r\n      const hit = (type==='movie' ? (json.movie_results||[])[0] : (json.tv_results||[])[0]);\r\n      if(hit) out = await byId(type, hit.id, cfg.lang, auth); else throw new Error('not found');\r\n    }else{\r\n      out = await bySearch(type, item.title, item.year, cfg.lang, auth);\r\n    }\r\n  }catch(e){\r\n    console.warn(`${LOG_PREFIX} Hydration failed for ${type} ${item?.title || item?.ids?.tmdb || 'unknown'}:`, e);\r\n    out = null;\r\n  }\r\n  cache.set(k, out);\r\n  persist();\r\n  return out;\r\n}\r\n\r\nexport async function hydrateOptional(movies, shows, cfg={}){\r\n  try{\r\n    cache = cache || loadCache();\r\n    const auth = tokenFromEnv(cfg);\r\n    if(!auth.value) return;\r\n    const work = (movies||[]).concat(shows||[]);\r\n    let i = 0; const limit = 40; // keep it light\r\n    const next = async()=>{\r\n      const chunk = work.slice(i, i+4); i += 4;\r\n      await Promise.all(chunk.map(async (it)=>{\r\n        const data = await hydrateItem(it, cfg, auth);\r\n        if(data){\r\n          it.tmdb = { id:data.id, poster:data.poster, backdrop:data.backdrop, url:data.url };\r\n          it.ids = it.ids||{}; if(!it.ids.tmdb && data.id) it.ids.tmdb = String(data.id);\r\n        }\r\n      }));\r\n      try{\r\n        window.dispatchEvent(new CustomEvent('tmdb:chunk', { detail: { updated: chunk.length, index: i } }));\r\n      }catch(err){\r\n        console.warn(`${LOG_PREFIX} Failed to dispatch tmdb:chunk event:`, err);\r\n      }\r\n      if(i < Math.min(work.length, limit)) (window.requestIdleCallback||setTimeout)(next, 250);\r\n      else{\r\n        try{\r\n          window.dispatchEvent(new CustomEvent('tmdb:done', { detail: { total: Math.min(work.length, limit) } }));\r\n        }catch(err){\r\n          console.warn(`${LOG_PREFIX} Failed to dispatch tmdb:done event:`, err);\r\n        }\r\n      }\r\n    };\r\n    next();\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} hydrateOptional failed to start:`, err);\r\n  }\r\n}\r\n\r\n// Lightweight token validation used by settings UI\r\nexport async function validateToken(raw){\r\n  const token = String(raw||'').trim();\r\n  if(!token) throw new Error('empty');\r\n  const looksLikeV3 = /^[a-f0-9]{32}$/i.test(token);\r\n  const looksLikeJwt = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$/.test(token);\r\n  const decodeJwtPayload = (t)=>{\r\n    try{\r\n      const part = t.split('.')[1];\r\n      const pad = (s)=> s + '='.repeat((4 - (s.length % 4)) % 4);\r\n      const json = atob(pad(part.replace(/-/g,'+').replace(/_/g,'/')));\r\n      return JSON.parse(json);\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Failed to decode TMDB JWT payload:`, err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // If it looks like a v3 API key, validate it against a protected v3 config endpoint\r\n  if(looksLikeV3){\r\n    const { url, init } = withAuth(`${API_V3}/configuration`, { kind:'apikey', value: token });\r\n    const res = await fetch(url, init);\r\n    if(res.ok) return { ok:true, as:'apikey', hint:'v3Key' };\r\n    return { ok:false, as:'apikey', hint:'looksV3' };\r\n  }\r\n\r\n  // Heuristic validation for v4 Bearer tokens (API Read Access Token):\r\n  // - Check JWT shape and issuer claim if present\r\n  // - Perform a benign v3 request with Bearer header to confirm CORS/connectivity\r\n  if(looksLikeJwt){\r\n    const payload = decodeJwtPayload(token);\r\n    if(payload && typeof payload === 'object'){\r\n      const iss = String(payload.iss||'');\r\n      if(iss && !/themoviedb\\.org/i.test(iss)){\r\n        return { ok:false, as:'bearer', hint:'issMismatch' };\r\n      }\r\n    }\r\n    const { url, init } = withAuth(`${API_V3}/trending/movie/day`, { kind:'bearer', value: token });\r\n    try{\r\n      const res = await fetch(url, init);\r\n      if(res.ok) return { ok:true, as:'bearer', hint:null };\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Bearer token validation request failed:`, err);\r\n    }\r\n    // Some public endpoints ignore invalid Authorization headers; fall back to structural pass\r\n    return { ok:true, as:'bearer', hint:'structOnly' };\r\n  }\r\n\r\n  return { ok:false, as:'bearer', hint:null };\r\n}\r\n", "import { getState } from './state.js';\r\nimport { getSources } from './data.js';\r\nimport { getCacheStats, clearAllCache, clearExpiredCache } from './cache.js';\r\n\r\nexport function initDebugUi(){\r\n  const open = document.getElementById('openDebug');\r\n  if(open){ open.addEventListener('click', ()=>{ openPanel(); }); }\r\n}\r\n\r\nfunction openPanel(){\r\n  let overlay = document.getElementById('debugOverlay');\r\n  if(!overlay){ overlay = document.createElement('div'); overlay.id='debugOverlay'; overlay.className='debug-overlay';\r\n    overlay.innerHTML = `\r\n      <div class=\"debug-dialog\">\r\n        <div class=\"debug-header\"><h2>Debug</h2></div>\r\n        <div class=\"debug-body\">\r\n          <pre id=\"debugPre\" class=\"debug-pre\"></pre>\r\n          <div class=\"debug-cache-controls\">\r\n            <h3>Cache-Verwaltung</h3>\r\n            <div id=\"cacheStats\" class=\"cache-stats\"></div>\r\n            <div class=\"cache-buttons\">\r\n              <button id=\"debugClearExpired\" class=\"btn\">Abgelaufene l\u00F6schen</button>\r\n              <button id=\"debugClearAll\" class=\"btn\">Alles l\u00F6schen</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"debug-actions\">\r\n          <button id=\"debugCopy\" class=\"btn\">Copy report</button>\r\n          <button id=\"debugClose\" class=\"btn\">Schlie\u00DFen</button>\r\n        </div>\r\n      </div>`;\r\n    document.body.append(overlay);\r\n  }\r\n  overlay.hidden = false;\r\n  render();\r\n  overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closePanel(); });\r\n  document.getElementById('debugClose')?.addEventListener('click', closePanel, { once:true });\r\n  document.getElementById('debugCopy')?.addEventListener('click', copyReport, { once:true });\r\n  document.getElementById('debugClearExpired')?.addEventListener('click', ()=>{\r\n    clearExpiredCache();\r\n    render();\r\n  }, { once:true });\r\n  document.getElementById('debugClearAll')?.addEventListener('click', ()=>{\r\n    if(confirm('Wirklich den gesamten Cache l\u00F6schen?')){\r\n      clearAllCache();\r\n      render();\r\n    }\r\n  }, { once:true });\r\n}\r\n\r\nfunction closePanel(){ const overlay = document.getElementById('debugOverlay'); if(overlay) overlay.hidden = true; }\r\n\r\nfunction render(){\r\n  const pre = document.getElementById('debugPre'); if(!pre) return;\r\n  const s = getState();\r\n  const src = getSources();\r\n  const cfg = s.cfg||{};\r\n  const cacheStats = getCacheStats();\r\n\r\n  const report = {\r\n    view: s.view,\r\n    counts: { movies: (s.movies||[]).length, shows: (s.shows||[]).length, filtered: (s.filtered||[]).length },\r\n    dataSources: src,\r\n    cache: cacheStats,\r\n    tmdb: { enabled: !!cfg.tmdbEnabled, lang: cfg.lang, tokenPresent: !!(localStorage.getItem('tmdbToken')||cfg.tmdbApiKey) },\r\n    useTmdbImages: localStorage.getItem('useTmdb')==='1',\r\n    reduceMotion: localStorage.getItem('prefReduceMotion')==='1',\r\n    locationHash: location.hash,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n  pre.textContent = JSON.stringify(report, null, 2);\r\n\r\n  // Update cache stats display\r\n  const statsEl = document.getElementById('cacheStats');\r\n  if(statsEl && cacheStats){\r\n    statsEl.innerHTML = `\r\n      <p>Eintr\u00E4ge gesamt: <strong>${cacheStats.totalEntries}</strong></p>\r\n      <p>G\u00FCltig: <strong>${cacheStats.validEntries}</strong> | Abgelaufen: <strong>${cacheStats.expiredEntries}</strong></p>\r\n      <p>Gr\u00F6\u00DFe: <strong>${cacheStats.totalSizeMB} MB</strong></p>\r\n    `;\r\n  }\r\n}\r\n\r\nfunction copyReport(){\r\n  const pre = document.getElementById('debugPre'); if(!pre) return;\r\n  const txt = pre.textContent || '';\r\n  navigator.clipboard?.writeText(txt).catch(err=>{\r\n    console.warn('[debug] Clipboard API write failed, using fallback:', err?.message || err);\r\n    try{\r\n      const ta=document.createElement('textarea');\r\n      ta.value=txt;\r\n      document.body.append(ta);\r\n      ta.select();\r\n      document.execCommand('copy');\r\n      ta.remove();\r\n    }catch(fallbackErr){\r\n      console.warn('[debug] Fallback clipboard copy failed:', fallbackErr?.message || fallbackErr);\r\n    }\r\n  });\r\n}\r\n\r\n", "import { getState } from './state.js';\r\nimport { renderGrid } from './grid.js';\r\n\r\nlet heroRefreshHandler = null;\r\nlet reduceMotionHandler = null;\r\nlet tmdbHydrationStarted = false;\r\n\r\nexport function setHeroRefreshHandler(handler){\r\n  heroRefreshHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nexport function setReduceMotionHandler(handler){\r\n  reduceMotionHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nfunction notifyHeroRefresh(items){\r\n  if(heroRefreshHandler){\r\n    try{\r\n      heroRefreshHandler(items);\r\n    }catch(err){\r\n      console.warn('[settingsOverlay] Failed to trigger hero refresh handler:', err?.message);\r\n    }\r\n  }\r\n}\r\n\r\nfunction notifyReduceMotion(enabled){\r\n  if(reduceMotionHandler){\r\n    try{\r\n      reduceMotionHandler(enabled);\r\n    }catch(err){\r\n      console.warn('[settingsOverlay] Failed to trigger reduce motion handler:', err?.message);\r\n    }\r\n  }\r\n}\r\n\r\nexport function initSettingsOverlay(cfg){\r\n  const overlay = document.getElementById('settingsOverlay');\r\n  const dialog = overlay?.querySelector('.settings-dialog');\r\n  const open1 = document.getElementById('settingsBtn');\r\n  const open2 = document.getElementById('openSettings');\r\n  const headerSettingsBtn = document.getElementById('headerSettingsBtn');\r\n  const close2 = document.getElementById('settingsClose2');\r\n  const tmdbInput = document.getElementById('tmdbTokenInput');\r\n  const tmdbSave = document.getElementById('tmdbSave');\r\n  const tmdbTest = document.getElementById('tmdbTest');\r\n  const tmdbStatus = document.getElementById('tmdbStatus');\r\n  const tmdbClear = document.getElementById('tmdbClearCache');\r\n  const tmdbBadge = document.getElementById('tmdbStatusBadge');\r\n  const reduce = document.getElementById('prefReduceMotion');\r\n  const useTmdb = document.getElementById('useTmdbSetting');\r\n  const resetFilters = document.getElementById('resetFilters');\r\n\r\n  if(overlay && overlay.hidden) overlay.setAttribute('aria-hidden', 'true');\r\n\r\n  let restoreFocus = null;\r\n  let previousOverflow = '';\r\n  let isOpen = false;\r\n  const backgroundState = new Map();\r\n  const focusSelector = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])';\r\n\r\n  function getFocusable(){\r\n    if(!overlay) return [];\r\n    return Array.from(overlay.querySelectorAll(focusSelector)).filter(el=> !el.hasAttribute('disabled') && el.getAttribute('aria-hidden') !== 'true');\r\n  }\r\n\r\n  function focusDialog(){\r\n    if(dialog && typeof dialog.focus === 'function') dialog.focus({ preventScroll:true });\r\n    else if(overlay && typeof overlay.focus === 'function') overlay.focus({ preventScroll:true });\r\n  }\r\n\r\n  function setBackgroundInert(active){\r\n    if(!overlay) return;\r\n    const nodes = Array.from(document.body.children).filter(node=> node !== overlay);\r\n    if(active){\r\n      nodes.forEach(node=>{\r\n        if(!backgroundState.has(node)){\r\n          backgroundState.set(node, {\r\n            ariaHidden: node.hasAttribute('aria-hidden') ? node.getAttribute('aria-hidden') : null,\r\n            inert: node.hasAttribute('inert')\r\n          });\r\n        }\r\n        node.setAttribute('aria-hidden', 'true');\r\n        node.setAttribute('inert', '');\r\n      });\r\n    }else{\r\n      nodes.forEach(node=>{\r\n        const state = backgroundState.get(node);\r\n        if(state){\r\n          if(state.ariaHidden === null || state.ariaHidden === undefined) node.removeAttribute('aria-hidden');\r\n          else node.setAttribute('aria-hidden', state.ariaHidden);\r\n          if(state.inert) node.setAttribute('inert', '');\r\n          else node.removeAttribute('inert');\r\n          backgroundState.delete(node);\r\n        }else{\r\n          node.removeAttribute('aria-hidden');\r\n          node.removeAttribute('inert');\r\n        }\r\n      });\r\n      backgroundState.clear();\r\n    }\r\n  }\r\n\r\n  function openOverlay(){\r\n    if(!overlay || isOpen) return;\r\n    isOpen = true;\r\n    overlay.hidden = false;\r\n    overlay.setAttribute('aria-hidden', 'false');\r\n    restoreFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n    previousOverflow = document.body.style.overflow;\r\n    document.body.style.overflow = 'hidden';\r\n    setBackgroundInert(true);\r\n    syncSettingsUi();\r\n    requestAnimationFrame(focusDialog);\r\n  }\r\n\r\n  function closeOverlay(){\r\n    if(!overlay || !isOpen) return;\r\n    isOpen = false;\r\n    overlay.hidden = true;\r\n    overlay.setAttribute('aria-hidden', 'true');\r\n    setBackgroundInert(false);\r\n    document.body.style.overflow = previousOverflow;\r\n    if(restoreFocus && typeof restoreFocus.focus === 'function'){ restoreFocus.focus(); }\r\n    restoreFocus = null;\r\n  }\r\n\r\n  function handleKeydown(ev){\r\n    if(!isOpen) return;\r\n    if(ev.key === 'Escape'){\r\n      ev.preventDefault();\r\n      closeOverlay();\r\n      return;\r\n    }\r\n    if(ev.key !== 'Tab') return;\r\n    const focusable = getFocusable();\r\n    if(!focusable.length){\r\n      ev.preventDefault();\r\n      focusDialog();\r\n      return;\r\n    }\r\n    const first = focusable[0];\r\n    const last = focusable[focusable.length - 1];\r\n    const active = document.activeElement;\r\n    if(ev.shiftKey){\r\n      if(active === first || !overlay.contains(active)){\r\n        ev.preventDefault();\r\n        last.focus();\r\n      }\r\n    }else if(active === last){\r\n      ev.preventDefault();\r\n      first.focus();\r\n    }\r\n  }\r\n\r\n  open1 && open1.addEventListener('click', openOverlay);\r\n  open2 && open2.addEventListener('click', ()=>{ openOverlay(); });\r\n  headerSettingsBtn && headerSettingsBtn.addEventListener('click', openOverlay);\r\n  close2 && close2.addEventListener('click', closeOverlay);\r\n  overlay && overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closeOverlay(); });\r\n  overlay && overlay.addEventListener('keydown', handleKeydown);\r\n\r\n  function setTmdbStatus(msg='', kind=''){\r\n    if(!tmdbStatus) return;\r\n    tmdbStatus.textContent = msg;\r\n    tmdbStatus.dataset.kind = kind; // kind: success|error|info|pending\r\n    if(tmdbBadge){ tmdbBadge.dataset.kind = kind || ''; tmdbBadge.title = msg || ''; }\r\n    // Auto-Fallback: Bei Fehler und vorhandenem v3 API Key, gespeicherten ung\u00FCltigen Token entfernen\r\n    try{\r\n      if(kind==='error' && cfg && cfg.tmdbApiKey){\r\n        const stored = String(localStorage.getItem('tmdbToken')||'').trim();\r\n        const currentInput = String(tmdbInput?.value||'').trim();\r\n        if(stored && currentInput){\r\n          try{ localStorage.removeItem('tmdbToken'); }\r\n          catch(err){ console.warn('[settingsOverlay] Failed to remove tmdbToken from storage:', err?.message || err); }\r\n          if(tmdbInput) tmdbInput.value = '';\r\n          setUseTmdbAvailability(true);\r\n          const m = 'Ung\u00FCltiger Token entfernt. Verwende API Key aus config.json.';\r\n          tmdbStatus.textContent = m;\r\n          tmdbStatus.dataset.kind = 'info';\r\n          if(tmdbBadge){ tmdbBadge.dataset.kind = 'info'; tmdbBadge.title = m; }\r\n        }\r\n      }\r\n    }catch(err){ console.warn('[settingsOverlay] Failed to reset TMDB status state:', err?.message || err); }\r\n  }\r\n\r\n  function setUseTmdbAvailability(allowed){\r\n    if(!useTmdb) return;\r\n    useTmdb.disabled = !allowed;\r\n    useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token oder API Key.' : '';\r\n    if(!allowed && useTmdb.checked){\r\n      try{ localStorage.setItem('useTmdb', '0'); }\r\n      catch(err){ console.warn('[settingsOverlay] Failed to persist TMDB toggle state:', err?.message || err); }\r\n      useTmdb.checked = false;\r\n      renderGrid(getState().view);\r\n      notifyHeroRefresh();\r\n    }\r\n  }\r\n\r\n  function syncSettingsUi(){\r\n    let token = '';\r\n    try{ tmdbInput && (tmdbInput.value = token = (localStorage.getItem('tmdbToken')||'')); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to read stored tmdbToken:', err?.message || err); }\r\n    try{ reduce && (reduce.checked = localStorage.getItem('prefReduceMotion')==='1'); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to read reduce-motion preference:', err?.message || err); }\r\n    try{ if(useTmdb){\r\n      useTmdb.checked = localStorage.getItem('useTmdb')==='1';\r\n      useTmdb.disabled = !token;\r\n      useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token.' : '';\r\n    } }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to sync TMDB toggle from storage:', err?.message || err); }\r\n    try{ setUseTmdbAvailability(!!token || !!(cfg&&cfg.tmdbApiKey)); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to update TMDB availability:', err?.message || err); }\r\n    setTmdbStatus('', '');\r\n    if(!token){ setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info'); }\r\n    if(!cfg?.tmdbEnabled){ setTmdbStatus('Hinweis: TMDB in config.json deaktiviert (tmdbEnabled=false).', 'info'); }\r\n    // Optional: Auto-Check bei ge\u00F6ffnetem Dialog\r\n    if(token){\r\n      (async()=>{\r\n        setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n        try{\r\n          const svc = await import('./services/tmdb.js');\r\n          const res = await svc.validateToken?.(token);\r\n          if(res && res.ok){\r\n            setUseTmdbAvailability(true);\r\n            if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n            else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n          }else{\r\n            setUseTmdbAvailability(false);\r\n            if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n            else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n          }\r\n        }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n      })();\r\n    } else { setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); }\r\n  }\r\n\r\n  tmdbSave && tmdbSave.addEventListener('click', async ()=>{\r\n    const raw = String(tmdbInput?.value||'').trim();\r\n    try{ localStorage.setItem('tmdbToken', raw); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to persist tmdbToken:', err?.message || err); }\r\n    if(!raw){ setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info'); setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); return; }\r\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n    try{\r\n      const svc = await import('./services/tmdb.js');\r\n      const res = await svc.validateToken?.(raw);\r\n      if(res && res.ok){\r\n        setUseTmdbAvailability(true);\r\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n      }else{\r\n        setUseTmdbAvailability(false);\r\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n      }\r\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n  });\r\n\r\n  tmdbTest && tmdbTest.addEventListener('click', async ()=>{\r\n    const raw = String(tmdbInput?.value||'').trim();\r\n    if(!raw){ setTmdbStatus('Bitte Token eingeben.', 'error'); return; }\r\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n    try{\r\n      const svc = await import('./services/tmdb.js');\r\n      const res = await svc.validateToken?.(raw);\r\n      if(res && res.ok){\r\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n      }else{\r\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n      }\r\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n  });\r\n  tmdbClear && tmdbClear.addEventListener('click', ()=>{ import('./services/tmdb.js').then(m=>m.clearCache?.()); });\r\n  reduce && reduce.addEventListener('change', ()=>{\r\n    try{ localStorage.setItem('prefReduceMotion', reduce.checked ? '1' : '0'); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to store reduce-motion preference:', err?.message || err); }\r\n    notifyReduceMotion(reduce.checked);\r\n  });\r\n  useTmdb && useTmdb.addEventListener('change', ()=>{\r\n    try{ localStorage.setItem('useTmdb', useTmdb.checked ? '1' : '0'); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to store TMDB usage preference:', err?.message || err); }\r\n    // Start TMDB hydration when enabling the toggle (if not already started)\r\n    if(useTmdb.checked && !tmdbHydrationStarted){\r\n      tmdbHydrationStarted = true;\r\n      import('./services/tmdb.js').then(m=>{\r\n        const s = getState();\r\n        m.hydrateOptional?.(s.movies, s.shows, s.cfg);\r\n      }).catch(err=>{ console.warn('[settingsOverlay] Failed to hydrate TMDB data:', err?.message || err); });\r\n      // Re-render a bit later to reflect incoming posters\r\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 1200);\r\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 3000);\r\n    }\r\n    renderGrid(getState().view);\r\n    notifyHeroRefresh();\r\n  });\r\n  resetFilters && resetFilters.addEventListener('click', ()=>{\r\n    const search = document.getElementById('search'); if(search) search.value='';\r\n    const q = document.getElementById('q'); if(q) q.value='';\r\n    const onlyNew = document.getElementById('onlyNew'); if(onlyNew) onlyNew.checked=false;\r\n    const yf = document.getElementById('yearFrom'); const yt = document.getElementById('yearTo'); if(yf) yf.value=''; if(yt) yt.value='';\r\n    const col = document.getElementById('collectionFilter'); if(col) col.value='';\r\n    document.querySelectorAll('#genreFilters .chip.active').forEach(n=>n.classList.remove('active'));\r\n    const genreRoot = document.getElementById('genreFilters');\r\n    if(genreRoot){\r\n      genreRoot.dataset.state = 'empty';\r\n      genreRoot.dataset.count = '0';\r\n    }\r\n    import('./filter.js').then(F=>{\r\n      const result = F.applyFilters();\r\n      renderGrid(getState().view);\r\n      notifyHeroRefresh(result);\r\n    });\r\n  });\r\n}\r\n\r\n", "import { getState } from './state.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { humanYear, formatRating, useTmdbOn } from './utils.js';\r\n\r\nlet currentHeroItem = null;\r\nlet heroDefaults = null;\r\nlet navigateToHashHandler = null;\r\n\r\nexport function setCurrentHeroItem(item){\r\n  currentHeroItem = item || null;\r\n  return currentHeroItem;\r\n}\r\n\r\nexport function getCurrentHeroItem(){\r\n  return currentHeroItem;\r\n}\r\n\r\nexport function setHeroDefaults(defaults){\r\n  heroDefaults = defaults ? { ...defaults } : null;\r\n  return heroDefaults;\r\n}\r\n\r\nexport function getHeroDefaults(){\r\n  return heroDefaults;\r\n}\r\n\r\nexport function ensureHeroDefaults(){\r\n  if(heroDefaults) return heroDefaults;\r\n  const defaults = {\r\n    title: document.getElementById('heroTitle')?.textContent || '',\r\n    subtitle: document.getElementById('heroSubtitle')?.textContent || '',\r\n    cta: document.getElementById('heroCta')?.textContent || '',\r\n  };\r\n  heroDefaults = defaults;\r\n  return defaults;\r\n}\r\n\r\nexport function setHeroNavigation(handler){\r\n  navigateToHashHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nexport function refreshHero(listOverride){\r\n  const hero = document.getElementById('hero');\r\n  const title = document.getElementById('heroTitle');\r\n  const subtitle = document.getElementById('heroSubtitle');\r\n  const cta = document.getElementById('heroCta');\r\n  if(!hero || !title || !subtitle || !cta) return;\r\n\r\n  const defaults = ensureHeroDefaults();\r\n  const candidate = selectHeroItem(listOverride);\r\n\r\n  if(!candidate){\r\n    setCurrentHeroItem(null);\r\n    title.textContent = defaults.title;\r\n    subtitle.textContent = defaults.subtitle;\r\n    subtitle.dataset.taglinePaused = '0';\r\n    delete subtitle.dataset.heroBound;\r\n    subtitle.classList.remove('is-fading');\r\n    cta.textContent = defaults.cta;\r\n    cta.disabled = true;\r\n    cta.setAttribute('aria-disabled', 'true');\r\n    cta.removeAttribute('aria-label');\r\n    cta.onclick = null;\r\n    hero.style.backgroundImage = '';\r\n    hero.classList.remove('has-poster');\r\n    hero.dataset.heroKind = '';\r\n    hero.dataset.heroId = '';\r\n    return;\r\n  }\r\n\r\n  setCurrentHeroItem(candidate);\r\n  const kind = candidate.type === 'tv' ? 'show' : 'movie';\r\n  const heroId = resolveHeroId(candidate);\r\n\r\n  title.textContent = candidate.title || defaults.title;\r\n  subtitle.textContent = heroSubtitleText(candidate);\r\n  subtitle.dataset.taglinePaused = '1';\r\n  subtitle.dataset.heroBound = '1';\r\n  subtitle.classList.remove('is-fading');\r\n\r\n  const ctaLabel = kind === 'show' ? 'Serien-Details \u00F6ffnen' : 'Film-Details \u00F6ffnen';\r\n  cta.textContent = ctaLabel;\r\n  cta.disabled = false;\r\n  cta.setAttribute('aria-disabled', 'false');\r\n  cta.setAttribute('aria-label', candidate.title ? `${ctaLabel}: ${candidate.title}` : ctaLabel);\r\n  cta.onclick = ()=> openHeroModal(candidate, kind, heroId);\r\n\r\n  hero.dataset.heroKind = kind;\r\n  hero.dataset.heroId = heroId || '';\r\n\r\n  const background = resolveHeroBackdrop(candidate);\r\n  if(background){\r\n    hero.style.backgroundImage = `url(${background})`;\r\n    hero.classList.add('has-poster');\r\n  }else{\r\n    hero.style.backgroundImage = '';\r\n    hero.classList.remove('has-poster');\r\n  }\r\n}\r\n\r\nfunction selectHeroItem(listOverride){\r\n  if(Array.isArray(listOverride)){\r\n    const playableOverride = listOverride.filter(isPlayableHeroItem);\r\n    if(!playableOverride.length) return null;\r\n    return chooseHeroCandidate(playableOverride);\r\n  }\r\n  const source = heroCandidatesFromState();\r\n  const playable = source.filter(isPlayableHeroItem);\r\n  if(!playable.length) return null;\r\n  return chooseHeroCandidate(playable);\r\n}\r\n\r\nfunction chooseHeroCandidate(list){\r\n  if(list.length === 1) return list[0];\r\n  const index = Math.floor(Math.random() * list.length);\r\n  const candidate = list[index];\r\n  if(currentHeroItem && list.length > 1 && candidate === currentHeroItem){\r\n    const alt = list.find(item=> item !== currentHeroItem);\r\n    return alt || candidate;\r\n  }\r\n  return candidate;\r\n}\r\n\r\nfunction heroCandidatesFromState(){\r\n  const state = getState();\r\n  const view = state.view === 'shows' ? 'shows' : 'movies';\r\n  const filtered = Array.isArray(state.filtered) && state.filtered.length ? state.filtered : null;\r\n  const list = filtered || (view === 'shows' ? state.shows : state.movies) || [];\r\n  return Array.isArray(list) ? list : [];\r\n}\r\n\r\nfunction isPlayableHeroItem(item){\r\n  return Boolean(item) && typeof item === 'object' && !item.isCollectionGroup && item.type !== 'collection';\r\n}\r\n\r\nfunction heroSubtitleText(item){\r\n  const meta = [];\r\n  const year = humanYear(item);\r\n  if(year) meta.push(String(year));\r\n  const runtime = heroRuntimeText(item);\r\n  if(runtime) meta.push(runtime);\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(rating)) meta.push(`\u2605 ${formatRating(rating)}`);\r\n  const genres = heroGenres(item, 2);\r\n  if(genres.length) meta.push(genres.join(', '));\r\n  const summary = heroSummaryText(item);\r\n  if(summary) return meta.length ? `${meta.join(' \u2022 ')} \u2014 ${summary}` : summary;\r\n  const defaults = getHeroDefaults();\r\n  return meta.length ? meta.join(' \u2022 ') : defaults?.subtitle || '';\r\n}\r\n\r\nfunction heroRuntimeText(item){\r\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  const minutes = Number(raw);\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\r\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\r\n  return `${minutes} min`;\r\n}\r\n\r\nfunction heroGenres(item, limit=3){\r\n  const list = Array.isArray(item?.genres) ? item.genres : [];\r\n  const names = [];\r\n  list.forEach(entry=>{\r\n    if(!entry) return;\r\n    if(typeof entry === 'string'){ names.push(entry); return; }\r\n    const name = entry.tag || entry.title || entry.name || entry.label || '';\r\n    if(name) names.push(name);\r\n  });\r\n  const unique = Array.from(new Set(names));\r\n  return unique.slice(0, Math.max(0, limit));\r\n}\r\n\r\nfunction heroSummaryText(item){\r\n  const sources = [item?.tagline, item?.summary, item?.plot, item?.overview];\r\n  for(const raw of sources){\r\n    if(typeof raw !== 'string') continue;\r\n    const text = raw.trim();\r\n    if(text) return truncateText(text, 220);\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction truncateText(text, maxLength){\r\n  const str = String(text || '').trim();\r\n  if(!str) return '';\r\n  if(str.length <= maxLength) return str;\r\n  return `${str.slice(0, Math.max(0, maxLength - 1)).trimEnd()}\u2026`;\r\n}\r\n\r\nfunction resolveHeroId(item){\r\n  if(!item) return '';\r\n  if(item?.ids?.imdb) return String(item.ids.imdb);\r\n  if(item?.ids?.tmdb) return String(item.ids.tmdb);\r\n  if(item?.ratingKey != null) return String(item.ratingKey);\r\n  return '';\r\n}\r\n\r\nfunction openHeroModal(item, kind, heroId){\r\n  if(heroId) navigateToItemHash(kind, heroId);\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n}\r\n\r\nfunction navigateToItemHash(kind, id){\r\n  if(!kind || !id) return;\r\n  const hash = `#/${kind}/${id}`;\r\n  const replace = (window.location.hash || '') === hash;\r\n  if(typeof navigateToHashHandler === 'function'){\r\n    try{\r\n      navigateToHashHandler(hash, { silent: true, replace });\r\n      return;\r\n    }catch(err){\r\n      console.warn('[hero] Failed to navigate via handler:', err?.message);\r\n    }\r\n  }\r\n  try{\r\n    window.location.hash = hash;\r\n  }catch(err){\r\n    console.warn('[hero] Failed to update hash directly:', err?.message);\r\n  }\r\n}\r\n\r\nfunction resolveHeroBackdrop(item){\r\n  if(!item) return '';\r\n  const tmdbEnabled = useTmdbOn();\r\n  const tmdbCandidates = [\r\n    item?.tmdb?.backdrop,\r\n    item?.tmdb?.backdrop_path,\r\n    item?.tmdb?.backdropPath,\r\n    item?.tmdb?.background,\r\n    item?.tmdb?.art,\r\n  ];\r\n  const localCandidates = [\r\n    item?.art,\r\n    item?.background,\r\n    item?.thumbBackground,\r\n    item?.coverArt,\r\n    item?.thumb,\r\n    item?.thumbFile,\r\n  ];\r\n  if(tmdbEnabled){\r\n    const tmdb = tmdbCandidates.find(isValidMediaPath);\r\n    if(tmdb) return tmdb;\r\n  }\r\n  const local = localCandidates.find(isValidMediaPath);\r\n  return local || '';\r\n}\r\n\r\nfunction isValidMediaPath(value){\r\n  return typeof value === 'string' && value.trim().length > 0;\r\n}\r\n", "import { refreshHero } from './hero.js';\r\n\r\nexport function initHeroAutoplay({ onRefresh = refreshHero } = {}){\r\n  const hero = document.getElementById('hero');\r\n  const timer = document.getElementById('heroTimer');\r\n  const bar = timer ? timer.querySelector('.hero-timer__bar') : null;\r\n  if(!hero || !timer || !bar) return null;\r\n  const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  if(reduce) { timer.hidden = true; return null; }\r\n  timer.removeAttribute('aria-hidden');\r\n  timer.dataset.state = 'running';\r\n\r\n  const DURATION = 15000; // 15s\r\n  const pauseReasons = new Set();\r\n  let wasPaused = false;\r\n  let elapsed = 0; // ms accumulated when not paused\r\n  let raf = null;\r\n  let lastTs = 0;\r\n\r\n  function isPaused(){\r\n    return pauseReasons.size > 0;\r\n  }\r\n\r\n  function updatePausedState(){\r\n    const pausedNow = isPaused();\r\n    timer.dataset.state = pausedNow ? 'paused' : 'running';\r\n    if(wasPaused && !pausedNow){\r\n      lastTs = 0;\r\n    }\r\n    wasPaused = pausedNow;\r\n  }\r\n\r\n  function setPaused(reason, value){\r\n    if(value){\r\n      pauseReasons.add(reason);\r\n    }else{\r\n      pauseReasons.delete(reason);\r\n    }\r\n    updatePausedState();\r\n  }\r\n\r\n  function step(ts){\r\n    if(isPaused()){ lastTs = ts; raf = requestAnimationFrame(step); return; }\r\n    if(!lastTs) lastTs = ts;\r\n    const dt = Math.max(0, ts - lastTs);\r\n    lastTs = ts;\r\n    elapsed += dt;\r\n    const prog = Math.max(0, Math.min(1, elapsed / DURATION));\r\n    bar.style.setProperty('--p', String(prog));\r\n    if(prog >= 1){\r\n      // reset and ask app to refresh hero gently\r\n      elapsed = 0; lastTs = ts; bar.style.setProperty('--p','0');\r\n      try {\r\n        onRefresh?.();\r\n      } catch(_e) {\r\n        // no-op\r\n      }\r\n    }\r\n    raf = requestAnimationFrame(step);\r\n  }\r\n\r\n  function start(){ if(!raf) raf = requestAnimationFrame(step); }\r\n  // Pause on hover (without affecting layout)\r\n  hero.addEventListener('mouseenter', () => { setPaused('hover', true); });\r\n  hero.addEventListener('mouseleave', () => { setPaused('hover', false); });\r\n  document.addEventListener('visibilitychange', () => {\r\n    setPaused('hidden', document.hidden);\r\n  });\r\n\r\n  if(document.hidden){\r\n    setPaused('hidden', true);\r\n  } else {\r\n    updatePausedState();\r\n  }\r\n\r\n  start();\r\n\r\n  return {\r\n    pause(){ setPaused('manual', true); },\r\n    resume(){ setPaused('manual', false); },\r\n    reset(){ elapsed = 0; bar.style.setProperty('--p','0'); }\r\n  };\r\n}\r\n", "import { setState, getState } from './state.js';\r\nimport { showLoader, setLoader, hideLoader, showSkeleton, clearSkeleton } from './loader.js';\r\nimport * as Data from './data.js';\r\nimport * as Filter from './filter.js';\r\nimport { renderGrid } from './grid.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { hydrateOptional } from './services/tmdb.js';\r\nimport * as Watch from './watchlist.js';\r\nimport * as Debug from './debug.js';\r\nimport { initErrorHandler, showError, showRetryableError } from './errorHandler.js';\r\nimport { initSettingsOverlay, setHeroRefreshHandler, setReduceMotionHandler } from './settingsOverlay.js';\r\nimport { refreshHero, setHeroNavigation } from './hero.js';\r\nimport { initHeroAutoplay } from './hero-autoplay.js';\r\n\r\nlet taglineTicker = null;\r\n\r\nconst hashNavigation = (() => {\r\n  let lastHash = window.location.hash || '';\r\n  let suppressedHash = null;\r\n\r\n  function normalizeHash(raw){\r\n    if(typeof raw !== 'string') return '';\r\n    const trimmed = raw.trim();\r\n    if(!trimmed) return '';\r\n    return trimmed.startsWith('#') ? trimmed : `#${trimmed}`;\r\n  }\r\n\r\n  function updateHash(targetHash, options={}){\r\n    const { replace=false, silent=false } = options;\r\n    const hash = normalizeHash(targetHash);\r\n    if(!hash) return;\r\n\r\n    const current = window.location.hash || '';\r\n    if(hash === current){\r\n      if(replace && history && typeof history.replaceState === 'function'){\r\n        try{\r\n          history.replaceState(null, '', hash);\r\n        }catch(err){\r\n          console.warn('[main] Failed to replace hash via history:', err.message);\r\n        }\r\n      }\r\n      if(silent){\r\n        suppressedHash = hash;\r\n        lastHash = hash;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const method = replace ? 'replaceState' : 'pushState';\r\n    let usedHistory = false;\r\n    try{\r\n      if(history && typeof history[method] === 'function'){\r\n        history[method](null, '', hash);\r\n        usedHistory = true;\r\n      }\r\n    }catch(err){\r\n      console.warn(`[main] Failed to ${replace ? 'replace' : 'push'} hash via history:`, err.message);\r\n    }\r\n\r\n    if(!usedHistory){\r\n      window.location.hash = hash;\r\n      if(silent){\r\n        suppressedHash = hash;\r\n        lastHash = hash;\r\n      }\r\n      return;\r\n    }\r\n\r\n    if(silent){\r\n      suppressedHash = hash;\r\n      lastHash = hash;\r\n      return;\r\n    }\r\n\r\n    try{\r\n      const event = typeof HashChangeEvent === 'function' ? new HashChangeEvent('hashchange') : new Event('hashchange');\r\n      window.dispatchEvent(event);\r\n    }catch(err){\r\n      console.warn('[main] Failed to dispatch hashchange event:', err.message);\r\n    }\r\n  }\r\n\r\n  function shouldHandle(hash){\r\n    const current = typeof hash === 'string' ? hash : '';\r\n    if(suppressedHash && current === suppressedHash){\r\n      suppressedHash = null;\r\n      return false;\r\n    }\r\n    suppressedHash = null;\r\n    if(current === lastHash) return false;\r\n    lastHash = current;\r\n    return true;\r\n  }\r\n\r\n  function markProcessed(hash){\r\n    lastHash = typeof hash === 'string' ? hash : '';\r\n    suppressedHash = null;\r\n  }\r\n\r\n  return { navigate: updateHash, shouldHandle, markProcessed };\r\n})();\r\n\r\nexport const navigateToHash = (hash, options) => hashNavigation.navigate(hash, options);\r\n\r\nsetHeroNavigation(navigateToHash);\r\n\r\nfunction setFooterStatus(message, busy=true){\r\n  const footer = document.getElementById('footerMeta');\r\n  if(footer){\r\n    const status = footer.querySelector('#footerStatus');\r\n    if(status) status.textContent = message;\r\n    else footer.textContent = message;\r\n    footer.dataset.state = busy ? 'loading' : 'ready';\r\n  }\r\n  const grid = document.getElementById('grid');\r\n  if(grid){\r\n    grid.setAttribute('aria-busy', busy ? 'true' : 'false');\r\n  }\r\n}\r\n\r\nexport async function boot(){\r\n  const isTestEnv = !!globalThis.__PLEX_TEST_MODE__;\r\n  initErrorHandler();\r\n  applyReduceMotionPref();\r\n  showLoader();\r\n  setFooterStatus('Initialisiere \u2026', true);\r\n  setLoader('Initialisiere \u2026', 8);\r\n  showSkeleton(18);\r\n\r\n  const cfg = await fetch('config.json').then(r=>r.json()).catch((err)=>{\r\n    console.warn('[main] Failed to load config.json, using defaults:', err.message);\r\n    showError('Konfiguration konnte nicht geladen werden', 'Verwende Standardeinstellungen');\r\n    return { startView:'movies', tmdbEnabled:false };\r\n  });\r\n  setState({ cfg, view: cfg.startView || 'movies' });\r\n\r\n  try {\r\n    setFooterStatus('Filme laden \u2026', true);\r\n    setLoader('Filme laden \u2026', 25);\r\n    const movies = await Data.loadMovies();\r\n    setFooterStatus('Serien laden \u2026', true);\r\n    setLoader('Serien laden \u2026', 45);\r\n    const shows  = await Data.loadShows();\r\n\r\n    setFooterStatus('Filter vorbereiten \u2026', true);\r\n    setLoader('Filter vorbereiten \u2026', 60);\r\n    // build facets (richer set via Filter)\r\n    const facets = Filter.computeFacets(movies, shows);\r\n    setState({ movies, shows, facets });\r\n\r\n    setFooterStatus('Ansicht aufbauen \u2026', true);\r\n    setLoader('Ansicht aufbauen \u2026', 85);\r\n    clearSkeleton();\r\n    renderSwitch();\r\n    Filter.renderFacets(facets);\r\n    Filter.initFilters();\r\n    Filter.applyFilters();\r\n    renderStats(true);\r\n    renderGrid(getState().view);\r\n    renderFooterMeta();\r\n\r\n    hideLoader();\r\n\r\n    if(cfg.tmdbEnabled) (window.requestIdleCallback || setTimeout)(()=> hydrateOptional?.(movies, shows, cfg), 400);\r\n\r\n    if(!isTestEnv){\r\n      Watch.initUi();\r\n      initSettingsOverlay(cfg);\r\n      initAdvancedToggle();\r\n      initHeaderInteractions();\r\n      initScrollProgress();\r\n      initScrollTop();\r\n      initFilterBarAutoHideFallback();\r\n      refreshHero();\r\n      initHeroAutoplay();\r\n      Debug.initDebugUi();\r\n    }else{\r\n      try{\r\n        refreshHero();\r\n      }catch(err){\r\n        console.warn('[main] Test env hero refresh skipped:', err?.message || err);\r\n      }\r\n    }\r\n    handleHashChange(true);\r\n  } catch (error) {\r\n    console.error('[main] Boot failed:', error);\r\n    hideLoader();\r\n    clearSkeleton();\r\n    showRetryableError('Fehler beim Laden der Daten', () => window.location.reload());\r\n    throw error;\r\n  }\r\n  // Re-render grid on TMDB hydration progress to reveal new posters\r\n  let tmdbRaf;\r\n  window.addEventListener('tmdb:chunk', ()=>{\r\n    if(tmdbRaf) return; // throttle to animation frame\r\n    tmdbRaf = requestAnimationFrame(()=>{\r\n      tmdbRaf = null;\r\n      try{\r\n        if(localStorage.getItem('useTmdb')==='1'){\r\n          renderGrid(getState().view);\r\n          refreshHero();\r\n        }\r\n      }catch(err){\r\n        console.warn('[main] TMDB chunk render failed:', err.message);\r\n      }\r\n    });\r\n  });\r\n  window.addEventListener('tmdb:done', ()=>{\r\n    try{\r\n      if(localStorage.getItem('useTmdb')==='1'){\r\n        renderGrid(getState().view);\r\n        refreshHero();\r\n      }\r\n    }catch(err){\r\n      console.warn('[main] TMDB done render failed:', err.message);\r\n    }\r\n  });\r\n}\r\n\r\n// Debounced hashchange handler to prevent race conditions\r\nlet hashchangeTimeout = null;\r\n\r\nfunction applyHashNavigation(hash){\r\n  if(/^#\\/(movies|shows)$/.test(hash)){\r\n    const view = hash.includes('shows') ? 'shows' : 'movies';\r\n    setState({ view });\r\n    const result = Filter.applyFilters();\r\n    renderSwitch();\r\n    renderGrid(view);\r\n    refreshHero(result);\r\n    return true;\r\n  }\r\n  const match = hash.match(/^#\\/(movie|show)\\/(.+)/);\r\n  if(!match) return false;\r\n  const [, kind, id ] = match;\r\n  const pool = kind === 'movie' ? getState().movies : getState().shows;\r\n  const item = (pool||[]).find(x => (x?.ids?.imdb===id || x?.ids?.tmdb===id || String(x?.ratingKey)===id));\r\n  if(!item) return false;\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n  return true;\r\n}\r\n\r\nfunction handleHashChange(force=false){\r\n  const currentHash = window.location.hash || '';\r\n  if(!force && !hashNavigation.shouldHandle(currentHash)) return;\r\n  if(force) hashNavigation.markProcessed(currentHash);\r\n  applyHashNavigation(currentHash);\r\n}\r\n\r\nwindow.addEventListener('hashchange', ()=>{\r\n  if(hashchangeTimeout){\r\n    clearTimeout(hashchangeTimeout);\r\n  }\r\n  hashchangeTimeout = setTimeout(()=>{\r\n    handleHashChange(false);\r\n  }, 50);\r\n});\r\n\r\nfunction renderSwitch(){\r\n  const root = document.getElementById('libraryTabs');\r\n  if(!root) return;\r\n  const buttons = Array.from(root.querySelectorAll('[data-lib]'));\r\n  const current = getState().view === 'shows' ? 'shows' : 'movies';\r\n  buttons.forEach(btn => {\r\n    const target = btn.dataset.lib === 'series' ? 'shows' : 'movies';\r\n    const isActive = current === target;\r\n    btn.classList.toggle('is-active', isActive);\r\n    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n    if(btn.dataset.bound === 'true') return;\r\n    btn.addEventListener('click', () => {\r\n      const view = btn.dataset.lib === 'series' ? 'shows' : 'movies';\r\n      if(getState().view === view) return;\r\n      setState({ view });\r\n      const target = view === 'movies' ? '#/movies' : '#/shows';\r\n      navigateToHash(target, { silent: true });\r\n      renderSwitch();\r\n      const result = Filter.applyFilters();\r\n      renderGrid(view);\r\n      refreshHero(result);\r\n    });\r\n    btn.dataset.bound = 'true';\r\n  });\r\n}\r\n\r\nfunction renderStats(animate=false){\r\n  const root = document.getElementById('heroStats');\r\n  if(!root) return;\r\n  const s = getState();\r\n  const movies = (s.movies||[]).length;\r\n  const shows = (s.shows||[]).length;\r\n  const elM = root.querySelector('[data-stat=\"movies\"]');\r\n  const elS = root.querySelector('[data-stat=\"shows\"]');\r\n  if(!elM || !elS) return;\r\n  if(animate){ countTo(elM, movies); countTo(elS, shows); }\r\n  else { elM.textContent=String(movies); elS.textContent=String(shows); }\r\n}\r\n\r\nfunction countTo(el, target){\r\n  if(!el) return;\r\n  const start = Number(el.textContent)||0;\r\n  const end = Number(target)||0;\r\n  if(start===end){ el.textContent = String(end); return; }\r\n  const dur = 480; // ms\r\n  const t0 = performance.now();\r\n  function step(t){\r\n    const p = Math.min(1, (t - t0) / dur);\r\n    const val = Math.round(start + (end - start) * (p<0.5 ? 2*p*p : -1 + (4 - 2*p) * p));\r\n    el.textContent = String(val);\r\n    if(p < 1) requestAnimationFrame(step); else el.textContent = String(end);\r\n  }\r\n  requestAnimationFrame(step);\r\n}\r\n\r\nfunction renderFooterMeta(){\r\n  const el = document.getElementById('footerMeta');\r\n  if(!el) return;\r\n  const status = document.getElementById('footerStatus');\r\n  const s = getState();\r\n  const movies = (s.movies||[]); const shows=(s.shows||[]);\r\n  const times = movies.concat(shows).map(x=> new Date(x.addedAt||0).getTime()).filter(Number.isFinite);\r\n  const latest = times.length ? new Date(Math.max(...times)) : new Date();\r\n  const date = latest.toISOString().slice(0,10);\r\n  if(status){\r\n    status.textContent = `Stand: ${date}`;\r\n  }\r\n  el.dataset.state = 'ready';\r\n  const grid = document.getElementById('grid');\r\n  if(grid){ grid.setAttribute('aria-busy', 'false'); }\r\n}\r\n\r\nFilter.setFiltersUpdatedHandler(items => {\r\n  try{\r\n    refreshHero(items);\r\n  }catch(err){\r\n    console.warn('[main] Failed to refresh hero from filters handler:', err?.message);\r\n  }\r\n});\r\n\r\nsetHeroRefreshHandler(items => {\r\n  try{\r\n    refreshHero(items);\r\n  }catch(err){\r\n    console.warn('[main] Failed to refresh hero from settings handler:', err?.message);\r\n  }\r\n});\r\n\r\nsetReduceMotionHandler(enabled => {\r\n  try{\r\n    setReduceMotionClass(!!enabled);\r\n  }catch(err){\r\n    console.warn('[main] Failed to apply reduce motion setting from handler:', err?.message);\r\n  }\r\n});\r\n\r\nif(!globalThis.__PLEX_TEST_MODE__){\r\n  boot();\r\n}\r\n\r\n// Fallback: ensure the loading overlay is not left visible\r\n// in case an error interrupts the boot sequence.\r\nwindow.addEventListener('load', ()=>{\r\n  try{\r\n    hideLoader();\r\n  }catch(err){\r\n    console.warn('[main] Failed to hide loader on load event:', err.message);\r\n  }\r\n});\r\n\r\nfunction setReduceMotionClass(pref){\r\n  try{\r\n    const body = document.body;\r\n    if(body){\r\n      document.documentElement?.classList.remove('reduce-motion', 'reduced-motion');\r\n      body.classList.remove('reduced-motion');\r\n      body.classList.toggle('reduce-motion', pref);\r\n    } else {\r\n      document.documentElement?.classList.toggle('reduce-motion', pref);\r\n      window.addEventListener('DOMContentLoaded', ()=> setReduceMotionClass(pref), { once: true });\r\n    }\r\n  }catch(err){\r\n    console.warn('[main] Failed to update reduce motion class:', err.message);\r\n  }\r\n}\r\n\r\nfunction applyReduceMotionPref(){\r\n  try{\r\n    const pref = localStorage.getItem('prefReduceMotion')==='1';\r\n    setReduceMotionClass(pref);\r\n  }catch(err){\r\n    console.warn('[main] Failed to apply reduce motion preference:', err.message);\r\n  }\r\n}\r\n\r\nfunction initAdvancedToggle(){\r\n  const btn = document.getElementById('toggleAdvanced');\r\n  const panel = document.getElementById('advancedFilters');\r\n  if(!btn || !panel) return;\r\n  let animating = false;\r\n  let fallbackTimer = 0;\r\n\r\n  const finishAnimation = ()=>{\r\n    animating = false;\r\n    if(fallbackTimer){\r\n      clearTimeout(fallbackTimer);\r\n      fallbackTimer = 0;\r\n    }\r\n    if(panel.dataset.state === 'closing'){\r\n      panel.dataset.state = 'closed';\r\n      panel.hidden = true;\r\n      panel.style.removeProperty('--advanced-max');\r\n    }else if(panel.dataset.state === 'open'){\r\n      panel.style.removeProperty('--advanced-max');\r\n    }else if(panel.dataset.state === 'expanding'){\r\n      panel.dataset.state = 'open';\r\n      panel.style.removeProperty('--advanced-max');\r\n    }\r\n  };\r\n\r\n  const queueFinish = ()=>{\r\n    if(fallbackTimer){\r\n      clearTimeout(fallbackTimer);\r\n    }\r\n    fallbackTimer = window.setTimeout(finishAnimation, 320);\r\n  };\r\n\r\n  panel.addEventListener('transitionend', event=>{\r\n    if(event.target !== panel || event.propertyName !== 'max-height') return;\r\n    finishAnimation();\r\n  });\r\n\r\n  const openPanel = ()=>{\r\n    if(animating) return;\r\n    animating = true;\r\n    panel.hidden = false;\r\n    panel.dataset.state = 'expanding';\r\n    panel.setAttribute('aria-hidden', 'false');\r\n    panel.style.setProperty('--advanced-max', '0px');\r\n    requestAnimationFrame(()=>{\r\n      const height = panel.scrollHeight;\r\n      panel.style.setProperty('--advanced-max', height + 'px');\r\n      panel.dataset.state = 'open';\r\n      queueFinish();\r\n    });\r\n  };\r\n\r\n  const closePanel = ()=>{\r\n    if(animating) return;\r\n    animating = true;\r\n    const height = panel.scrollHeight;\r\n    panel.style.setProperty('--advanced-max', height + 'px');\r\n    panel.dataset.state = 'closing';\r\n    panel.setAttribute('aria-hidden', 'true');\r\n    requestAnimationFrame(()=>{\r\n      panel.style.setProperty('--advanced-max', '0px');\r\n      queueFinish();\r\n    });\r\n  };\r\n\r\n  btn.addEventListener('click', ()=>{\r\n    const expanded = btn.getAttribute('aria-expanded') === 'true';\r\n    if(expanded){\r\n      btn.setAttribute('aria-expanded', 'false');\r\n      closePanel();\r\n    }else{\r\n      btn.setAttribute('aria-expanded', 'true');\r\n      openPanel();\r\n    }\r\n  });\r\n}\r\n\r\nfunction initHeaderInteractions(){\r\n  const siteLogo = document.getElementById('siteLogo');\r\n  if(siteLogo){\r\n    siteLogo.addEventListener('error', ()=>{\r\n      siteLogo.classList.add('logo-missing');\r\n      const titleEl = document.querySelector('.site-header__brand-text .site-header__label');\r\n      if(titleEl) titleEl.classList.remove('sr-only');\r\n    });\r\n  }\r\n  const subtitle = document.getElementById('heroSubtitle');\r\n  const TAGLINES = [\r\n    'Offline st\u00F6bern & Wunschlisten teilen',\r\n    'Filter. Finden. Freuen.',\r\n    'Filme & Serien \u2013 stressfrei sichtbar',\r\n    'Schneller als jeder SMB-Share',\r\n    'Merkliste zuerst, Streit sp\u00E4ter'\r\n  ];\r\n  let idx = 0; if(subtitle) subtitle.textContent = TAGLINES[idx];\r\n  function rotate(){\r\n    if(!subtitle || subtitle.dataset.taglinePaused==='1') return;\r\n    subtitle.classList.add('is-fading');\r\n    setTimeout(()=>{\r\n      if(!subtitle || subtitle.dataset.taglinePaused==='1'){ subtitle && subtitle.classList.remove('is-fading'); return; }\r\n      idx = (idx+1)%TAGLINES.length; subtitle.textContent = TAGLINES[idx]; subtitle.classList.remove('is-fading');\r\n    }, 280);\r\n  }\r\n  if(subtitle){\r\n    subtitle.dataset.taglinePaused='0';\r\n    if(taglineTicker){\r\n      clearInterval(taglineTicker);\r\n    }\r\n    taglineTicker = setInterval(rotate, 6000);\r\n    setTimeout(rotate, 3000);\r\n  }else if(taglineTicker){\r\n    clearInterval(taglineTicker);\r\n    taglineTicker = null;\r\n  }\r\n}\r\n\r\nfunction initScrollProgress(){\r\n  const bar = document.getElementById('scrollProgress');\r\n  if(!bar) return;\r\n  const update = ()=>{\r\n    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop || 0;\r\n    const height = (document.documentElement.scrollHeight - document.documentElement.clientHeight) || 1;\r\n    const pct = Math.max(0, Math.min(100, (scrollTop/height)*100));\r\n    bar.style.width = pct + '%';\r\n  };\r\n  addEventListener('scroll', update, { passive:true });\r\n  update();\r\n}\r\n\r\nfunction initScrollTop(){\r\n  const btn = document.getElementById('scrollTop');\r\n  if(!btn) return;\r\n  const toggle = ()=>{ const y = window.scrollY||0; btn.style.display = y>300 ? 'block' : 'none'; };\r\n  addEventListener('scroll', toggle, { passive:true });\r\n  toggle();\r\n  btn.addEventListener('click', ()=> window.scrollTo({ top:0, behavior:'smooth' }));\r\n}\r\n\r\nfunction initFilterBarAutoHideFallback(){\r\n  const filters = document.querySelector('.filters');\r\n  if(!filters) return;\r\n\r\n  const supportsScrollTimeline = typeof CSS !== 'undefined'\r\n    && typeof CSS.supports === 'function'\r\n    && CSS.supports('animation-timeline: scroll()');\r\n\r\n  if(supportsScrollTimeline) return;\r\n\r\n  let lastY = window.scrollY || window.pageYOffset || 0;\r\n  let isHidden = false;\r\n  let ticking = false;\r\n  const MIN_SCROLL = 120;\r\n  const DELTA_HIDE = 8;\r\n\r\n  const setHidden = (nextHidden)=>{\r\n    if(isHidden === nextHidden) return;\r\n    isHidden = nextHidden;\r\n    filters.classList.toggle('is-hidden', isHidden);\r\n  };\r\n\r\n  const update = ()=>{\r\n    ticking = false;\r\n    const currentY = window.scrollY || window.pageYOffset || 0;\r\n\r\n    if(currentY <= MIN_SCROLL){\r\n      setHidden(false);\r\n      lastY = currentY;\r\n      return;\r\n    }\r\n\r\n    const delta = currentY - lastY;\r\n    lastY = currentY;\r\n\r\n    if(delta > DELTA_HIDE){\r\n      setHidden(true);\r\n    }else if(delta < -DELTA_HIDE){\r\n      setHidden(false);\r\n    }\r\n  };\r\n\r\n  const onScroll = ()=>{\r\n    if(ticking) return;\r\n    ticking = true;\r\n    requestAnimationFrame(update);\r\n  };\r\n\r\n  window.addEventListener('scroll', onScroll, { passive:true });\r\n  window.addEventListener('resize', update);\r\n\r\n  const reveal = ()=> setHidden(false);\r\n  filters.addEventListener('focusin', reveal);\r\n  filters.addEventListener('pointerenter', reveal, { passive:true });\r\n  filters.addEventListener('pointerdown', reveal, { passive:true });\r\n\r\n  update();\r\n}\r\n"],
  "mappings": "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",
  "names": ["setState", "patch", "S", "listeners", "fn", "getState", "init_state", "__esmMin", "el", "tag", "cls", "content", "n", "qs", "init_dom", "__esmMin", "s", "r", "ensure", "overlay", "qs", "el", "box", "msgEl", "bar", "showLoader", "setLoader", "msg", "p", "hideLoader", "showSkeleton", "count", "grid", "skeletonRoot", "i", "clearSkeleton", "init_loader", "__esmMin", "init_dom", "setCache", "key", "value", "ttl", "cacheKey", "CACHE_PREFIX", "item", "checkCacheSize", "error", "cleanOldestEntries", "getCache", "cached", "now", "clearAllCache", "clearExpiredCache", "keys", "cleared", "getCacheStats", "cacheKeys", "k", "totalSize", "validEntries", "expiredEntries", "stats", "percentage", "cacheEntries", "a", "b", "toRemove", "i", "cleanupInterval", "init_cache", "__esmMin", "isPlainObject", "value", "matchesType", "type", "validateAgainstSchema", "schema", "path", "expectedTypes", "expected", "item", "index", "required", "key", "prop", "properties", "definition", "ensureArrayOfStrings", "list", "cloneWithDefaults", "entry", "defaults", "result", "defaultValue", "isMovieEntry", "ratingKey", "isShowEntry", "season", "sanitizeMovieEntry", "MOVIE_DEFAULTS", "thumbValue", "thumbFileValue", "sanitizeShowEntry", "SHOW_DEFAULTS", "seasonCopy", "episode", "validateLibraryList", "data", "kind", "SHOW_LIST_SCHEMA", "MOVIE_LIST_SCHEMA", "guard", "sanitizer", "MOVIE_ITEM_SCHEMA", "SEASON_SCHEMA", "SHOW_ITEM_SCHEMA", "init_validators", "__esmMin", "errorHandler_exports", "__export", "clearErrors", "initErrorHandler", "showError", "showRetryableError", "withErrorHandling", "errorContainer", "event", "_a", "title", "message", "duration", "errorEl", "escapeHtml", "fn", "errorTitle", "args", "error", "retryFn", "retryBtn", "closeBtn", "str", "div", "init_errorHandler", "__esmMin", "fetchJson", "url", "retries", "useCache", "cached", "getCache", "lastError", "attempt", "r", "data", "setCache", "DATA_CACHE_TTL", "err", "delay", "resolve", "message", "error", "embeddedJsonById", "id", "n", "fromGlobalBag", "key", "bag", "globalExporterBag", "fromWindow", "varName", "loadWithCompat", "primaryUrl", "opts", "markSource", "emb", "win", "alt", "altData", "notifyUiError", "title", "mod", "_a", "prefixThumbValue", "value", "base", "raw", "SCHEME_RE", "normalizedRaw", "normalizedBase", "decodeWarned", "encodePath", "path", "segment", "segments", "normalizedSegments", "normalizedPath", "relativeSegments", "baseDir", "cleaned", "encoded", "prefixThumb", "obj", "_b", "current", "prefixed", "str", "prefixMovieThumb", "MOVIE_THUMB_BASE", "prefixShowThumb", "SHOW_THUMB_BASE", "prefixShowTree", "show", "prefixSeasonTree", "season", "ep", "normalizeMovieThumbs", "list", "item", "normalizeShowThumbs", "loadMovies", "rawMovies", "movies", "validateLibraryList", "validationError", "loadShows", "rawShows", "shows", "loadShowDetail", "keys", "cacheKeys", "getCachedDetail", "urls", "detailUrlCandidates", "normalized", "normalizeShowDetail", "storeDetail", "cloneDetail", "label", "src", "lastSources", "getSources", "href", "normalizeHrefKey", "showDetailCache", "val", "rk", "detailKey", "detailHref", "hrefKey", "withoutData", "idPart", "normalizeGenres", "castList", "normalizePeople", "normalizeSeason", "out", "normalizeEpisode", "seen", "result", "entry", "tag", "detail", "EXPORTER_BAG_KEY", "init_data", "__esmMin", "init_cache", "init_validators", "getGenreNames", "genres", "seen", "names", "entry", "name", "str", "renderChipsLimited", "container", "values", "limit", "vals", "head", "rest", "chips", "text", "chip", "more", "enableMoreChipBehavior", "root", "btn", "e", "card", "hidden", "ch", "collectionTags", "item", "humanYear", "candidates", "value", "match", "formatRating", "val", "trimmed", "num", "s", "isNew", "added", "cfg", "getState", "days", "useTmdbOn", "init_utils", "__esmMin", "init_state", "load", "saved", "STORAGE_KEY", "persist", "idFor", "item", "_a", "_b", "kind", "id", "isSaved", "count", "toggle", "k", "renderCount", "panel", "renderPanel", "el", "openPanel", "p", "closePanel", "setExpanded", "clear", "exportJson", "items", "listItems", "data", "blob", "a", "s", "getState", "pool", "map", "it", "list", "empty", "frag", "li", "t", "rm", "open", "initUi", "openBtn", "toggleBtn", "closeBtn", "clearBtn", "exportBtn", "on", "init_watchlist", "__esmMin", "init_state", "applyTabs", "root", "tabs", "buttons", "select", "target", "btn", "isActive", "pane", "moveFocus", "current", "delta", "currentIndex", "fallbackIndex", "index", "next", "ev", "last", "initial", "init_tabs", "__esmMin", "resolvePoster", "item", "_a", "tmdbPoster", "localPoster", "useTmdbOn", "runtimeText", "minutes", "ratingText", "rating", "formatRating", "studioText", "buildChips", "chips", "isNew", "entry", "genre", "populateHead", "root", "titleEl", "tagline", "metaEl", "subEl", "year", "humanYear", "runtime", "studio", "metaParts", "fallback", "chipsRoot", "text", "span", "quickFacts", "quickList", "facts", "contentRating", "label", "value", "dt", "dd", "img", "src", "onPosterReady", "ev", "init_headerSection", "__esmMin", "init_utils", "updateOverview", "root", "text", "pane", "overview", "paragraph", "toggle", "setExpanded", "expanded", "cb", "init_overviewSection", "__esmMin", "releaseDateText", "item", "candidates", "raw", "str", "parsed", "iso", "year", "humanYear", "namesFromList", "source", "entry", "genresFromItem", "mapped", "formatOptionalRating", "value", "formatRating", "trimmed", "num", "updateDetails", "root", "pane", "grid", "general", "release", "runtime", "runtimeText", "studio", "studioText", "certification", "critic", "audience", "user", "numericSeasons", "seasonCount", "episodeCount", "sum", "season", "eps", "countries", "collections", "labels", "section", "heading", "list", "label", "dt", "dd", "genres", "chips", "name", "span", "crew", "directors", "writers", "producers", "creators", "fallback", "init_detailsSection", "__esmMin", "init_utils", "init_headerSection", "renderSeasonsAccordion", "targetOrSeasons", "maybeSeasons", "root", "resolveTarget", "seasons", "isTarget", "s", "idx", "seasonCardEl", "value", "season", "prefixShowThumb", "card", "head", "th", "img", "txt", "title", "sub", "year", "epCount", "chev", "body", "ep", "episodeRowEl", "_a", "row", "sNum", "eNum", "code", "right", "r", "b", "meta", "durMin", "durText", "dateText", "init_seasonsAccordion", "__esmMin", "init_data", "updateSeasons", "root", "item", "pane", "seasons", "renderSeasonsAccordion", "init_seasonsSection", "__esmMin", "init_seasonsAccordion", "setExternalLinks", "root", "item", "_a", "_b", "tmdbBtn", "imdbBtn", "trailerBtn", "tmdbId", "imdbId", "trailer", "type", "init_externalLinks", "__esmMin", "buildCastList", "item", "person", "_a", "_b", "_c", "name", "role", "rawRole", "tmdbProfile", "val", "thumb", "updateCast", "root", "cast", "pane", "scroll", "limited", "tmdbEnabled", "useTmdbOn", "entry", "data", "card", "roleText", "avatar", "imageSrc", "resolveCastImage", "img", "initials", "castInitials", "nameLine", "roleLine", "normalizeTmdbProfile", "path", "str", "suffix", "TMDB_PROFILE_BASE", "TMDB_PROFILE_SIZE", "normalizeLocalImage", "raw", "tmdbCandidates", "candidate", "url", "localCandidates", "chars", "part", "init_castSection", "__esmMin", "init_utils", "deepClone", "value", "entry", "out", "key", "mapMovie", "item", "clone", "mapShow", "normalizeShow", "mapDetail", "detail", "needsShowDetail", "seasons", "hasEpisodes", "season", "cast", "mergeShowDetail", "target", "mapped", "show", "normalizeThumbField", "normalizeGenresList", "normalizePeopleList", "normalizeSeasonEntry", "sc", "normalizeEpisodeEntry", "ep", "obj", "prefixShowThumb", "list", "seen", "result", "tag", "init_shared", "__esmMin", "init_data", "demoData_exports", "__export", "DEMO_MOVIE", "DEMO_SERIES", "init_demoData", "__esmMin", "loadDemoDataModule", "demoDataModulePromise", "err", "resolveRoot", "rootEl", "container", "overlayContainer", "onOverlayClick", "dialogEl", "scrollContainer", "existing", "ev", "target", "closeModalV2", "getFocusableElements", "el", "bindFocusTrap", "focusTrapHandler", "focusables", "first", "last", "unbindFocusTrap", "bindEscape", "escapeHandler", "unbindEscape", "showOverlay", "root", "focusInitial", "closeBtn", "focus", "showModalV2Loading", "message", "loadingDiv", "renderModalV2", "item", "hasSeasons", "populateHead", "setExternalLinks", "updateOverview", "updateDetails", "updateSeasons", "updateCast", "buildCastList", "applyTabs", "openMovieModalV2", "idOrData", "token", "renderToken", "lastActiveElement", "data", "resolveMovieData", "errorDiv", "currentItem", "currentKind", "openSeriesModalV2", "base", "resolveSeriesData", "working", "needsShowDetail", "detail", "loadShowDetail", "mergeShowDetail", "DEMO_MOVIE", "mapMovie", "str", "state", "getState", "match", "movie", "matchesIdentifier", "DEMO_SERIES", "mapShow", "show", "id", "_a", "_b", "init_modalV2", "__esmMin", "init_tabs", "init_headerSection", "init_overviewSection", "init_detailsSection", "init_seasonsSection", "init_externalLinks", "init_castSection", "init_state", "init_data", "init_shared", "noop", "parsePx", "value", "num", "raf", "caf", "VirtualList", "init_virtualList", "__esmMin", "cb", "id", "container", "renderItem", "getKey", "updateItem", "getSignature", "overscan", "estimatedItemHeight", "minItemWidth", "force", "width", "list", "sampleItem", "sample", "rect", "node", "allowed", "nextSignatures", "item", "idx", "key", "signature", "prev", "index", "raw", "containerStyle", "hostStyle", "rowGap", "colGap", "gapFallback", "rawColumns", "el", "top", "viewportTop", "viewportBottom", "listStart", "listEnd", "startRow", "endRow", "start", "end", "needsRefresh", "i", "offsetY", "nextRendered", "toRender", "updated", "currentChildren", "same", "currentMap", "desired", "current", "grid_exports", "__export", "renderGrid", "cardEl", "item", "card", "el", "media", "img", "src", "resolvePoster", "gradient", "badges", "buildItemBadges", "badgeContainer", "badge", "pct", "progressPercent", "track", "fill", "body", "title", "sub", "metaPieces", "buildMetaPieces", "actions", "chips", "genres", "getGenreNames", "renderChipsLimited", "watchBtn", "updateWatchButtonState", "ev", "toggle", "openDetail", "createCollectionGroup", "name", "members", "list", "a", "b", "ay", "humanYear", "by", "years", "year", "addedTimestamps", "latestAdded", "ratings", "_a", "rating", "sum", "val", "posterItem", "entry", "groupCollectionsIfEnabled", "items", "togg", "colSel", "selected", "membership", "collectionTags", "groups", "collectionCardEl", "baseItem", "buildCollectionBadges", "pieces", "collectionMetaPieces", "sel", "ensureVirtualList", "grid", "virtualListInstance", "VirtualList", "itemKey", "gridItemSignature", "renderGridItemNode", "node", "refreshGridItemNode", "index", "key", "id", "resolveItemId", "CARD_SIGNATURE_PROP", "current", "signature", "replacement", "replaceCardNode", "view", "movies", "shows", "filtered", "getState", "base", "shouldAnimate", "lastRenderedView", "beginGridTransition", "finishGridTransition", "empty", "tmdbPoster", "useTmdbOn", "fallback", "itemBadgeTexts", "isNew", "contentRating", "ratingNum", "formatRating", "createBadge", "collectionBadgeTexts", "text", "button", "saved", "isSaved", "runtime", "formatRuntime", "studio", "count", "_b", "raw", "minutes", "offset", "duration", "preferred", "collectionSignature", "itemSignature", "meta", "ratingValue", "parent", "hadFocus", "updateHash", "kind", "hash", "replace", "navigateToHash", "openSeriesModalV2", "openMovieModalV2", "init_grid", "__esmMin", "init_state", "init_dom", "init_utils", "init_watchlist", "init_modalV2", "init_main", "init_virtualList", "filter_exports", "__export", "applyFilters", "computeFacets", "initFilters", "renderFacets", "setFiltersUpdatedHandler", "updateFiltersAndGrid", "norm", "s", "matches", "item", "opts", "query", "onlyNew", "yearFrom", "yearTo", "genresActive", "selectedCollection", "getGenreNames", "r", "collectionTags", "isNew", "year", "humanYear", "itemGenres", "g", "sortItems", "items", "key", "arr", "a", "b", "movies", "shows", "genres", "years", "collections", "add", "x", "name", "y", "ys", "f", "yFrom", "qs", "yTo", "col", "c", "gRoot", "chips", "updateGenreFilterState", "getFilterOpts", "_a", "_b", "_c", "_d", "_e", "searchInput", "collection", "sort", "n", "getState", "pool", "filtered", "ordered", "setState", "renderGridForCurrentView", "gridModulePromise", "mod", "fn", "handler", "filtersUpdatedHandler", "result", "payload", "root", "activeCount", "sortSel", "v", "l", "bind", "sel", "ev", "yrReset", "t", "init_filter", "__esmMin", "init_state", "init_dom", "init_utils", "tmdb_exports", "__export", "clearCache", "hydrateOptional", "validateToken", "loadCache", "persist", "cache", "tokenFromEnv", "cfg", "keyFor", "item", "_a", "_b", "imdb", "tmdb", "title", "year", "withAuth", "url", "auth", "sep", "getJson", "u", "init", "res", "pickBestPoster", "p", "IMG", "POSTER_W", "pickBestBackdrop", "BACKDROP_W", "byId", "type", "id", "lang", "inf", "API_V3", "images", "err", "poster", "backdrop", "bySearch", "q", "yParam", "first", "hydrateItem", "k", "out", "json", "hit", "movies", "shows", "work", "i", "limit", "next", "chunk", "it", "data", "raw", "token", "looksLikeV3", "looksLikeJwt", "decodeJwtPayload", "t", "part", "s", "payload", "iss", "init_tmdb", "__esmMin", "initDebugUi", "open", "openPanel", "_a", "_b", "_c", "_d", "overlay", "render", "ev", "closePanel", "copyReport", "clearExpiredCache", "clearAllCache", "pre", "s", "getState", "src", "getSources", "cfg", "cacheStats", "getCacheStats", "report", "statsEl", "txt", "err", "ta", "init_debug", "__esmMin", "init_state", "init_data", "init_cache", "setHeroRefreshHandler", "handler", "heroRefreshHandler", "setReduceMotionHandler", "reduceMotionHandler", "notifyHeroRefresh", "items", "notifyReduceMotion", "enabled", "initSettingsOverlay", "cfg", "overlay", "dialog", "open1", "open2", "headerSettingsBtn", "close2", "tmdbInput", "tmdbSave", "tmdbTest", "tmdbStatus", "tmdbClear", "tmdbBadge", "reduce", "useTmdb", "resetFilters", "restoreFocus", "previousOverflow", "isOpen", "backgroundState", "focusSelector", "getFocusable", "el", "focusDialog", "setBackgroundInert", "active", "nodes", "node", "state", "openOverlay", "syncSettingsUi", "closeOverlay", "handleKeydown", "ev", "focusable", "first", "last", "setTmdbStatus", "msg", "kind", "stored", "currentInput", "setUseTmdbAvailability", "m", "allowed", "renderGrid", "getState", "token", "_a", "svc", "res", "raw", "tmdbHydrationStarted", "s", "err", "search", "q", "onlyNew", "yf", "yt", "col", "n", "genreRoot", "F", "result", "init_settingsOverlay", "__esmMin", "init_state", "init_grid", "setCurrentHeroItem", "item", "currentHeroItem", "getHeroDefaults", "heroDefaults", "ensureHeroDefaults", "_a", "_b", "_c", "defaults", "setHeroNavigation", "handler", "navigateToHashHandler", "refreshHero", "listOverride", "hero", "title", "subtitle", "cta", "candidate", "selectHeroItem", "kind", "heroId", "resolveHeroId", "heroSubtitleText", "ctaLabel", "openHeroModal", "background", "resolveHeroBackdrop", "playableOverride", "isPlayableHeroItem", "chooseHeroCandidate", "playable", "heroCandidatesFromState", "list", "index", "state", "getState", "view", "meta", "year", "humanYear", "runtime", "heroRuntimeText", "rating", "formatRating", "genres", "heroGenres", "summary", "heroSummaryText", "raw", "minutes", "limit", "names", "entry", "name", "sources", "text", "truncateText", "maxLength", "str", "navigateToItemHash", "openSeriesModalV2", "openMovieModalV2", "id", "hash", "replace", "_d", "_e", "tmdbEnabled", "useTmdbOn", "tmdbCandidates", "localCandidates", "tmdb", "isValidMediaPath", "value", "init_hero", "__esmMin", "init_state", "init_modalV2", "init_utils", "initHeroAutoplay", "onRefresh", "refreshHero", "hero", "timer", "bar", "DURATION", "pauseReasons", "wasPaused", "elapsed", "raf", "lastTs", "isPaused", "updatePausedState", "pausedNow", "setPaused", "reason", "value", "step", "ts", "dt", "prog", "start", "init_hero_autoplay", "__esmMin", "init_hero", "setFooterStatus", "message", "busy", "footer", "status", "grid", "boot", "isTestEnv", "initErrorHandler", "applyReduceMotionPref", "showLoader", "setLoader", "showSkeleton", "cfg", "err", "showError", "setState", "movies", "loadMovies", "shows", "loadShows", "facets", "computeFacets", "clearSkeleton", "renderSwitch", "renderFacets", "initFilters", "applyFilters", "renderStats", "renderGrid", "getState", "renderFooterMeta", "hideLoader", "_a", "hydrateOptional", "initUi", "initSettingsOverlay", "initAdvancedToggle", "initHeaderInteractions", "initScrollProgress", "initScrollTop", "initFilterBarAutoHideFallback", "refreshHero", "initHeroAutoplay", "initDebugUi", "handleHashChange", "error", "showRetryableError", "tmdbRaf", "applyHashNavigation", "hash", "view", "result", "match", "kind", "id", "item", "x", "_b", "openSeriesModalV2", "openMovieModalV2", "force", "currentHash", "hashNavigation", "root", "buttons", "current", "btn", "target", "isActive", "navigateToHash", "animate", "s", "elM", "elS", "countTo", "el", "start", "end", "dur", "t0", "step", "t", "p", "val", "times", "date", "setReduceMotionClass", "pref", "body", "panel", "animating", "fallbackTimer", "finishAnimation", "queueFinish", "event", "openPanel", "height", "closePanel", "siteLogo", "titleEl", "subtitle", "TAGLINES", "idx", "rotate", "taglineTicker", "bar", "update", "scrollTop", "pct", "toggle", "y", "filters", "lastY", "isHidden", "ticking", "MIN_SCROLL", "DELTA_HIDE", "setHidden", "nextHidden", "currentY", "delta", "onScroll", "reveal", "hashchangeTimeout", "init_main", "__esmMin", "init_state", "init_loader", "init_data", "init_filter", "init_grid", "init_modalV2", "init_tmdb", "init_watchlist", "init_debug", "init_errorHandler", "init_settingsOverlay", "init_hero", "init_hero_autoplay", "lastHash", "suppressedHash", "normalizeHash", "raw", "trimmed", "updateHash", "targetHash", "options", "replace", "silent", "method", "usedHistory", "shouldHandle", "markProcessed", "setHeroNavigation", "setFiltersUpdatedHandler", "items", "setHeroRefreshHandler", "setReduceMotionHandler", "enabled"]
}
