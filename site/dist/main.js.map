{
  "version": 3,
  "sources": ["../js/state.js", "../js/dom.js", "../js/loader.js", "../js/cache.js", "../js/data/validators.js", "../js/errorHandler.js", "../js/data.js", "../js/utils.js", "../js/watchlist.js", "../js/modal/tabs.js", "../js/modal/headerSection.js", "../js/modal/overviewSection.js", "../js/modal/detailsSection.js", "../js/cacheStore.js", "../js/tmdbClient.js", "../js/imageHelper.js", "../js/tmdbMapper.js", "../js/metadataService.js", "../js/modal/seasonsAccordion.js", "../js/modal/seasonsSection.js", "../js/modal/externalLinks.js", "../js/modal/castSection.js", "../js/modal/shared.js", "../js/modal/demoData.js", "../js/modalV2.js", "../js/grid/virtualList.js", "../js/grid.js", "../js/filter.js", "../js/services/tmdb.js", "../js/hero/policy.js", "../js/hero/tmdbClient.js", "../js/hero/normalizer.js", "../js/hero/storage.js", "../js/hero/pool.js", "../js/hero/pipeline.js", "../js/debug.js", "../js/settingsOverlay.js", "../js/hero.js", "../js/hero-autoplay.js", "../js/main.js"],
  "sourcesContent": ["const S = { view: 'movies', movies: [], shows: [], facets: {}, filtered: [], cfg: {}, heroPolicy: null, heroPolicyIssues: [] };\r\nconst listeners = new Set();\r\n\r\nexport const getState = () => S;\r\nexport function setState(patch){ Object.assign(S, patch); listeners.forEach(fn=>fn(S)); }\r\nexport function subscribe(fn){ listeners.add(fn); return ()=>listeners.delete(fn); }\r\n", "export const qs  = (s, r=document) => r.querySelector(s);\nexport const qsa = (s, r=document) => [...r.querySelectorAll(s)];\nexport function el(tag, cls, content){\n  const n=document.createElement(tag);\n  if(cls) n.className=cls;\n  if(content!=null) n.textContent = content;\n  return n;\n}\n\n", "import { qs, el } from './dom.js';\n\nlet overlay;\nlet bar;\nlet msgEl;\nlet skeletonRoot;\n\nfunction ensure(){\n  if(overlay) return;\n  overlay = qs('#loaderOverlay');\n  if(!overlay){\n    overlay = el('div','loader-overlay');\n    overlay.id = 'loaderOverlay';\n    // Start hidden by default so a partially executed boot sequence\n    // does not leave a dark overlay on screen.\n    overlay.hidden = true;\n    const box = el('div','loader');\n    msgEl = el('div','msg','');\n    bar = el('div','bar');\n    box.append(msgEl, bar);\n    overlay.append(box);\n    document.body.append(overlay);\n  }\n}\n\nexport function showLoader(){ ensure(); overlay.hidden = false; }\nexport function setLoader(msg, p){ ensure(); if(msgEl) msgEl.textContent = msg||''; if(bar) bar.style.width = (p||0)+\"%\"; }\nexport function hideLoader(){ ensure(); overlay.hidden = true; }\n\nexport function showSkeleton(count=18){\n  const grid = qs('#grid');\n  if(!grid) return;\n  skeletonRoot = el('div','skeleton');\n  for(let i=0;i<count;i++){ skeletonRoot.append(el('div','skel')); }\n  grid.replaceChildren(skeletonRoot);\n}\nexport function clearSkeleton(){\n  if(skeletonRoot && skeletonRoot.parentElement){ skeletonRoot.parentElement.removeChild(skeletonRoot); }\n  skeletonRoot = null;\n}\n", "/**\r\n * Enhanced Caching System with TTL and Storage Management\r\n */\r\n\r\nconst CACHE_PREFIX = 'plex_cache_';\r\nconst DEFAULT_TTL = 1000 * 60 * 60 * 24; // 24 hours\r\nconst MAX_CACHE_SIZE = 5 * 1024 * 1024; // 5MB\r\n\r\n/**\r\n * Set an item in cache with TTL\r\n * @param {string} key - Cache key\r\n * @param {any} value - Value to cache\r\n * @param {number} ttl - Time to live in milliseconds\r\n */\r\nexport function setCache(key, value, ttl = DEFAULT_TTL) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    const item = {\r\n      value,\r\n      timestamp: Date.now(),\r\n      ttl\r\n    };\r\n    localStorage.setItem(cacheKey, JSON.stringify(item));\r\n\r\n    // Check if we're approaching storage limits\r\n    checkCacheSize();\r\n  } catch (error) {\r\n    if (error.name === 'QuotaExceededError') {\r\n      console.warn('[cache] Storage quota exceeded, cleaning old entries');\r\n      cleanOldestEntries();\r\n      // Try again after cleanup\r\n      try {\r\n        const cacheKey = CACHE_PREFIX + key;\r\n        const item = { value, timestamp: Date.now(), ttl };\r\n        localStorage.setItem(cacheKey, JSON.stringify(item));\r\n      } catch (retryError) {\r\n        console.error('[cache] Failed to cache after cleanup:', retryError);\r\n      }\r\n    } else {\r\n      console.error('[cache] Failed to set cache:', error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get an item from cache\r\n * @param {string} key - Cache key\r\n * @returns {any|null} Cached value or null if expired/not found\r\n */\r\nexport function getCache(key) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    const cached = localStorage.getItem(cacheKey);\r\n\r\n    if (!cached) return null;\r\n\r\n    const item = JSON.parse(cached);\r\n    if(typeof item.timestamp !== 'number' || typeof item.ttl !== 'number'){\r\n      localStorage.removeItem(cacheKey);\r\n      return null;\r\n    }\r\n    const now = Date.now();\r\n\r\n    // Check if expired\r\n    if (item.timestamp + item.ttl < now) {\r\n      localStorage.removeItem(cacheKey);\r\n      return null;\r\n    }\r\n\r\n    return item.value;\r\n  } catch (error) {\r\n    console.error('[cache] Failed to get cache:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove an item from cache\r\n * @param {string} key - Cache key\r\n */\r\nexport function removeCache(key) {\r\n  try {\r\n    const cacheKey = CACHE_PREFIX + key;\r\n    localStorage.removeItem(cacheKey);\r\n  } catch (error) {\r\n    console.error('[cache] Failed to remove cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all cache entries\r\n */\r\nexport function clearAllCache() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n    console.log('[cache] All cache cleared');\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clear cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear expired cache entries\r\n */\r\nexport function clearExpiredCache() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const now = Date.now();\r\n    let cleared = 0;\r\n\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        try {\r\n          const item = JSON.parse(localStorage.getItem(key));\r\n          if (item.timestamp + item.ttl < now) {\r\n            localStorage.removeItem(key);\r\n            cleared++;\r\n          }\r\n        } catch (e) {\r\n          // Invalid cache entry, remove it\r\n          localStorage.removeItem(key);\r\n          cleared++;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (cleared > 0) {\r\n      console.log(`[cache] Cleared ${cleared} expired entries`);\r\n    }\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clear expired cache:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nexport function getCacheStats() {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const cacheKeys = keys.filter(k => k.startsWith(CACHE_PREFIX));\r\n    const now = Date.now();\r\n\r\n    let totalSize = 0;\r\n    let validEntries = 0;\r\n    let expiredEntries = 0;\r\n\r\n    cacheKeys.forEach(key => {\r\n      const value = localStorage.getItem(key);\r\n      totalSize += value.length * 2; // Approximate size in bytes (UTF-16)\r\n\r\n      try {\r\n        const item = JSON.parse(value);\r\n        if (item.timestamp + item.ttl >= now) {\r\n          validEntries++;\r\n        } else {\r\n          expiredEntries++;\r\n        }\r\n      } catch (e) {\r\n        expiredEntries++;\r\n      }\r\n    });\r\n\r\n    return {\r\n      totalEntries: cacheKeys.length,\r\n      validEntries,\r\n      expiredEntries,\r\n      totalSize,\r\n      totalSizeMB: (totalSize / 1024 / 1024).toFixed(2)\r\n    };\r\n  } catch (error) {\r\n    console.error('[cache] Failed to get cache stats:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Check cache size and clean if necessary\r\n */\r\nfunction checkCacheSize() {\r\n  try {\r\n    const stats = getCacheStats();\r\n    if (stats && stats.totalSize > MAX_CACHE_SIZE) {\r\n      console.warn('[cache] Cache size exceeded limit, cleaning...');\r\n      cleanOldestEntries(0.3); // Remove 30% of entries\r\n    }\r\n  } catch (error) {\r\n    console.error('[cache] Failed to check cache size:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clean oldest cache entries\r\n * @param {number} percentage - Percentage of entries to remove (0-1)\r\n */\r\nfunction cleanOldestEntries(percentage = 0.3) {\r\n  try {\r\n    const keys = Object.keys(localStorage);\r\n    const cacheEntries = [];\r\n\r\n    keys.forEach(key => {\r\n      if (key.startsWith(CACHE_PREFIX)) {\r\n        try {\r\n          const item = JSON.parse(localStorage.getItem(key));\r\n          cacheEntries.push({ key, timestamp: item.timestamp });\r\n        } catch (e) {\r\n          // Invalid entry, mark for removal\r\n          cacheEntries.push({ key, timestamp: 0 });\r\n        }\r\n      }\r\n    });\r\n\r\n    // Sort by timestamp (oldest first)\r\n    cacheEntries.sort((a, b) => a.timestamp - b.timestamp);\r\n\r\n    // Remove oldest percentage\r\n    const toRemove = Math.ceil(cacheEntries.length * percentage);\r\n    for (let i = 0; i < toRemove; i++) {\r\n      localStorage.removeItem(cacheEntries[i].key);\r\n    }\r\n\r\n    console.log(`[cache] Removed ${toRemove} oldest entries`);\r\n  } catch (error) {\r\n    console.error('[cache] Failed to clean oldest entries:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Cached fetch wrapper\r\n * @param {string} url - URL to fetch\r\n * @param {object} options - Fetch options\r\n * @param {number} ttl - Cache TTL in milliseconds\r\n */\r\nexport async function cachedFetch(url, options = {}, ttl = DEFAULT_TTL) {\r\n  const cacheKey = `fetch_${url}`;\r\n\r\n  // Try to get from cache first\r\n  const cached = getCache(cacheKey);\r\n  if (cached !== null) {\r\n    return cached;\r\n  }\r\n\r\n  // Fetch and cache\r\n  try {\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    setCache(cacheKey, data, ttl);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`[cache] Fetch failed for ${url}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Auto-cleanup on page load (only in real browser environments)\r\nlet cleanupInterval = null;\r\n\r\nif (typeof window !== 'undefined' && typeof window.document !== 'undefined' && window === globalThis) {\r\n  // Clear expired entries on load\r\n  clearExpiredCache();\r\n\r\n  // Periodic cleanup every 5 minutes\r\n  cleanupInterval = setInterval(clearExpiredCache, 5 * 60 * 1000);\r\n}\r\n\r\n/**\r\n * Stop the periodic cleanup interval (useful for testing)\r\n */\r\nexport function stopCleanupInterval() {\r\n  if (cleanupInterval) {\r\n    clearInterval(cleanupInterval);\r\n    cleanupInterval = null;\r\n  }\r\n}\r\n", "const LOG_PREFIX = '[data/validators]';\r\n\r\nconst MOVIE_DEFAULTS = Object.freeze({\r\n  thumb: '',\r\n  thumbFile: '',\r\n  summary: '',\r\n  href: '',\r\n  tagline: '',\r\n  genres: [],\r\n});\r\n\r\nconst SHOW_DEFAULTS = Object.freeze({\r\n  thumb: '',\r\n  thumbFile: '',\r\n  summary: '',\r\n  href: '',\r\n  tagline: '',\r\n  genres: [],\r\n  seasons: [],\r\n});\r\n\r\nconst MOVIE_ITEM_SCHEMA = Object.freeze({\r\n  type: 'object',\r\n  required: ['title', 'ratingKey'],\r\n  properties: {\r\n    title: { type: 'string' },\r\n    ratingKey: { type: ['string', 'number'] },\r\n    thumb: { type: 'string', nullable: true },\r\n    thumbFile: { type: 'string', nullable: true },\r\n    summary: { type: 'string', nullable: true },\r\n    href: { type: 'string', nullable: true },\r\n    tagline: { type: 'string', nullable: true },\r\n    genres: { type: 'array', items: { type: ['string', 'object'] }, nullable: true },\r\n  },\r\n});\r\n\r\nconst SEASON_SCHEMA = Object.freeze({\r\n  type: 'object',\r\n  properties: {\r\n    episodes: { type: 'array', items: { type: 'object' }, nullable: true },\r\n    thumb: { type: 'string', nullable: true },\r\n    thumbFile: { type: 'string', nullable: true },\r\n  },\r\n});\r\n\r\nconst SHOW_ITEM_SCHEMA = Object.freeze({\r\n  type: 'object',\r\n  required: ['title', 'ratingKey'],\r\n  properties: {\r\n    title: { type: 'string' },\r\n    ratingKey: { type: ['string', 'number'] },\r\n    thumb: { type: 'string', nullable: true },\r\n    thumbFile: { type: 'string', nullable: true },\r\n    summary: { type: 'string', nullable: true },\r\n    href: { type: 'string', nullable: true },\r\n    tagline: { type: 'string', nullable: true },\r\n    genres: { type: 'array', items: { type: ['string', 'object'] }, nullable: true },\r\n    seasons: { type: 'array', items: SEASON_SCHEMA, nullable: true },\r\n  },\r\n});\r\n\r\nconst MOVIE_LIST_SCHEMA = Object.freeze({ type: 'array', items: MOVIE_ITEM_SCHEMA });\r\nconst SHOW_LIST_SCHEMA = Object.freeze({ type: 'array', items: SHOW_ITEM_SCHEMA });\r\n\r\nfunction isPlainObject(value){\r\n  return value !== null && typeof value === 'object' && !Array.isArray(value);\r\n}\r\n\r\nfunction matchesType(value, type){\r\n  switch(type){\r\n    case 'string': return typeof value === 'string';\r\n    case 'number': return typeof value === 'number' && Number.isFinite(value);\r\n    case 'boolean': return typeof value === 'boolean';\r\n    case 'array': return Array.isArray(value);\r\n    case 'object': return isPlainObject(value);\r\n    default: return false;\r\n  }\r\n}\r\n\r\nfunction validateAgainstSchema(value, schema, path = 'value'){\r\n  if(!schema) return;\r\n  if(value == null){\r\n    if(schema.nullable) return;\r\n    throw new Error(`${path} darf nicht null oder undefined sein.`);\r\n  }\r\n  const expectedTypes = Array.isArray(schema.type) ? schema.type : [schema.type];\r\n  if(expectedTypes && expectedTypes.length){\r\n    const typeOk = expectedTypes.some(type => matchesType(value, type));\r\n    if(!typeOk){\r\n      const expected = expectedTypes.join(' oder ');\r\n      throw new Error(`${path} erwartet Typ ${expected}, erhielt ${typeof value}.`);\r\n    }\r\n  }\r\n  if(expectedTypes.includes('array')){\r\n    if(!Array.isArray(value)){\r\n      throw new Error(`${path} erwartet eine Liste.`);\r\n    }\r\n    if(schema.items){\r\n      value.forEach((item, index) => {\r\n        // Skip validation for genre items - they can be string or object with tag\r\n        if(path.includes('.genres') || path.includes('List') && schema.items.type &&\r\n           Array.isArray(schema.items.type) && schema.items.type.includes('string') && schema.items.type.includes('object')) {\r\n          return;\r\n        }\r\n        validateAgainstSchema(item, schema.items, `${path}[${index}]`);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  if(expectedTypes.includes('object')){\r\n    if(!isPlainObject(value)){\r\n      throw new Error(`${path} erwartet ein Objekt.`);\r\n    }\r\n    const required = schema.required || [];\r\n    for(const key of required){\r\n      const prop = value[key];\r\n      if(prop == null || (typeof prop === 'string' && !prop.trim())){\r\n        throw new Error(`${path}.${key} ist ein Pflichtfeld.`);\r\n      }\r\n    }\r\n    const properties = schema.properties || {};\r\n    for(const [key, definition] of Object.entries(properties)){\r\n      if(value[key] == null){\r\n        continue;\r\n      }\r\n      validateAgainstSchema(value[key], definition, `${path}.${key}`);\r\n    }\r\n  }\r\n}\r\n\r\nfunction ensureArrayOfStrings(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list\r\n    .map(item => {\r\n      if(typeof item === 'string') return item.trim();\r\n      if(item && typeof item === 'object' && typeof item.tag === 'string') return item.tag.trim();\r\n      return null;\r\n    })\r\n    .filter(item => item && item.length > 0);\r\n}\r\n\r\nfunction cloneWithDefaults(entry, defaults){\r\n  const result = { ...entry };\r\n  for(const [key, defaultValue] of Object.entries(defaults)){\r\n    if(result[key] == null){\r\n      result[key] = Array.isArray(defaultValue) ? [...defaultValue] : defaultValue;\r\n    }else if(Array.isArray(defaultValue)){\r\n      result[key] = Array.isArray(result[key]) ? [...result[key]] : [...defaultValue];\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function isMovieEntry(value){\r\n  if(!isPlainObject(value)) return false;\r\n  if(typeof value.title !== 'string' || !value.title.trim()) return false;\r\n  const ratingKey = value.ratingKey;\r\n  if(!(typeof ratingKey === 'string' || typeof ratingKey === 'number')) return false;\r\n  return true;\r\n}\r\n\r\nexport function isShowEntry(value){\r\n  if(!isMovieEntry(value)) return false;\r\n  if(value.seasons == null) return true;\r\n  if(!Array.isArray(value.seasons)) return false;\r\n  return value.seasons.every(season => isPlainObject(season));\r\n}\r\n\r\nfunction sanitizeMovieEntry(entry){\r\n  const result = cloneWithDefaults(entry, MOVIE_DEFAULTS);\r\n  result.title = result.title.trim();\r\n  result.ratingKey = String(entry.ratingKey).trim();\r\n  const thumbValue = typeof result.thumb === 'string' ? result.thumb : '';\r\n  const thumbFileValue = typeof result.thumbFile === 'string' ? result.thumbFile : '';\r\n  result.thumb = thumbValue;\r\n  result.thumbFile = thumbFileValue || thumbValue;\r\n  result.summary = typeof result.summary === 'string' ? result.summary : '';\r\n  result.href = typeof result.href === 'string' ? result.href : '';\r\n  result.tagline = typeof result.tagline === 'string' ? result.tagline : '';\r\n  result.genres = ensureArrayOfStrings(result.genres);\r\n  return result;\r\n}\r\n\r\nfunction sanitizeShowEntry(entry){\r\n  const result = cloneWithDefaults(entry, SHOW_DEFAULTS);\r\n  result.title = result.title.trim();\r\n  result.ratingKey = String(entry.ratingKey).trim();\r\n  const thumbValue = typeof result.thumb === 'string' ? result.thumb : '';\r\n  const thumbFileValue = typeof result.thumbFile === 'string' ? result.thumbFile : '';\r\n  result.thumb = thumbValue;\r\n  result.thumbFile = thumbFileValue || thumbValue;\r\n  result.summary = typeof result.summary === 'string' ? result.summary : '';\r\n  result.href = typeof result.href === 'string' ? result.href : '';\r\n  result.tagline = typeof result.tagline === 'string' ? result.tagline : '';\r\n  result.genres = ensureArrayOfStrings(result.genres);\r\n  if(Array.isArray(entry.seasons)){\r\n    result.seasons = entry.seasons\r\n      .filter(isPlainObject)\r\n      .map(season => {\r\n        const seasonCopy = { ...season };\r\n        seasonCopy.episodes = Array.isArray(season.episodes)\r\n          ? season.episodes.filter(isPlainObject).map(episode => ({ ...episode }))\r\n          : [];\r\n        if(typeof seasonCopy.thumb !== 'string') seasonCopy.thumb = '';\r\n        if(typeof seasonCopy.thumbFile !== 'string') seasonCopy.thumbFile = '';\r\n        return seasonCopy;\r\n      });\r\n  }else{\r\n    result.seasons = [];\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function validateLibraryList(data, kind = 'movie'){\r\n  const schema = kind === 'show' ? SHOW_LIST_SCHEMA : MOVIE_LIST_SCHEMA;\r\n  validateAgainstSchema(data, schema, `${kind}List`);\r\n  if(!Array.isArray(data)){\r\n    throw new Error('Datensatz ist keine Liste.');\r\n  }\r\n  const guard = kind === 'show' ? isShowEntry : isMovieEntry;\r\n  const sanitizer = kind === 'show' ? sanitizeShowEntry : sanitizeMovieEntry;\r\n  return data.map((entry, index) => {\r\n    if(!guard(entry)){\r\n      console.warn(`${LOG_PREFIX} Ung\u00FCltiger ${kind}-Eintrag an Index ${index}:`, entry);\r\n      throw new Error(`Ung\u00FCltiger ${kind}-Eintrag an Index ${index}.`);\r\n    }\r\n    return sanitizer(entry);\r\n  });\r\n}\r\n\r\nexport const __TEST_INTERNALS__ = {\r\n  MOVIE_DEFAULTS,\r\n  SHOW_DEFAULTS,\r\n  MOVIE_ITEM_SCHEMA,\r\n  SHOW_ITEM_SCHEMA,\r\n  MOVIE_LIST_SCHEMA,\r\n  SHOW_LIST_SCHEMA,\r\n  validateAgainstSchema,\r\n};\r\n", "/**\r\n * Global Error Handler\r\n * Provides centralized error handling and user feedback\r\n */\r\n\r\nlet errorContainer = null;\r\n\r\n/**\r\n * Initialize the error handler\r\n */\r\nexport function initErrorHandler() {\r\n  // Create error container if it doesn't exist\r\n  if (!errorContainer) {\r\n    errorContainer = document.createElement('div');\r\n    errorContainer.id = 'errorContainer';\r\n    errorContainer.className = 'error-container';\r\n    errorContainer.setAttribute('role', 'alert');\r\n    errorContainer.setAttribute('aria-live', 'polite');\r\n    document.body.appendChild(errorContainer);\r\n  }\r\n\r\n  // Global error handler for unhandled promise rejections\r\n  window.addEventListener('unhandledrejection', (event) => {\r\n    console.error('Unhandled promise rejection:', event.reason);\r\n    showError('Ein unerwarteter Fehler ist aufgetreten', event.reason?.message);\r\n    event.preventDefault();\r\n  });\r\n\r\n  // Global error handler for runtime errors\r\n  window.addEventListener('error', (event) => {\r\n    console.error('Runtime error:', event.error);\r\n    showError('Ein Fehler ist aufgetreten', event.error?.message);\r\n  });\r\n}\r\n\r\n/**\r\n * Show an error message to the user\r\n * @param {string} title - Error title\r\n * @param {string} message - Error message\r\n * @param {number} duration - Duration in ms (0 = permanent)\r\n */\r\nexport function showError(title, message = '', duration = 5000) {\r\n  if (!errorContainer) initErrorHandler();\r\n\r\n  const errorEl = document.createElement('div');\r\n  errorEl.className = 'error-toast';\r\n  errorEl.innerHTML = `\r\n    <div class=\"error-toast-content\">\r\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\r\n      <div class=\"error-toast-text\">\r\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\r\n        ${message ? `<div class=\"error-toast-message\">${escapeHtml(message)}</div>` : ''}\r\n      </div>\r\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\r\n    </div>\r\n  `;\r\n\r\n  const closeBtn = errorEl.querySelector('.error-toast-close');\r\n  closeBtn.addEventListener('click', () => {\r\n    errorEl.classList.add('error-toast-exit');\r\n    setTimeout(() => errorEl.remove(), 300);\r\n  });\r\n\r\n  errorContainer.appendChild(errorEl);\r\n\r\n  // Auto-remove after duration\r\n  if (duration > 0) {\r\n    setTimeout(() => {\r\n      if (errorEl.parentNode) {\r\n        errorEl.classList.add('error-toast-exit');\r\n        setTimeout(() => errorEl.remove(), 300);\r\n      }\r\n    }, duration);\r\n  }\r\n\r\n  // Animate in\r\n  requestAnimationFrame(() => {\r\n    errorEl.classList.add('error-toast-show');\r\n  });\r\n\r\n  return errorEl;\r\n}\r\n\r\n/**\r\n * Wrap an async function with error handling\r\n * @param {Function} fn - Async function to wrap\r\n * @param {string} errorTitle - Error title to show on failure\r\n * @returns {Function} Wrapped function\r\n */\r\nexport function withErrorHandling(fn, errorTitle = 'Ein Fehler ist aufgetreten') {\r\n  return async (...args) => {\r\n    try {\r\n      return await fn(...args);\r\n    } catch (error) {\r\n      console.error(`[${errorTitle}]`, error);\r\n      showError(errorTitle, error.message);\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Show a loading error with retry option\r\n * @param {string} title - Error title\r\n * @param {Function} retryFn - Function to call on retry\r\n */\r\nexport function showRetryableError(title, retryFn) {\r\n  if (!errorContainer) initErrorHandler();\r\n\r\n  const errorEl = document.createElement('div');\r\n  errorEl.className = 'error-toast error-toast-retryable';\r\n  errorEl.innerHTML = `\r\n    <div class=\"error-toast-content\">\r\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\r\n      <div class=\"error-toast-text\">\r\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\r\n      </div>\r\n      <button class=\"error-toast-retry\">Erneut versuchen</button>\r\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\r\n    </div>\r\n  `;\r\n\r\n  const retryBtn = errorEl.querySelector('.error-toast-retry');\r\n  const closeBtn = errorEl.querySelector('.error-toast-close');\r\n\r\n  retryBtn.addEventListener('click', async () => {\r\n    errorEl.remove();\r\n    try {\r\n      await retryFn();\r\n    } catch (err) {\r\n      console.error('Retry failed:', err);\r\n    }\r\n  });\r\n\r\n  closeBtn.addEventListener('click', () => {\r\n    errorEl.classList.add('error-toast-exit');\r\n    setTimeout(() => errorEl.remove(), 300);\r\n  });\r\n\r\n  errorContainer.appendChild(errorEl);\r\n\r\n  requestAnimationFrame(() => {\r\n    errorEl.classList.add('error-toast-show');\r\n  });\r\n\r\n  return errorEl;\r\n}\r\n\r\n/**\r\n * Clear all error messages\r\n */\r\nexport function clearErrors() {\r\n  if (errorContainer) {\r\n    errorContainer.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n * @param {string} str - String to escape\r\n * @returns {string} Escaped string\r\n */\r\nfunction escapeHtml(str) {\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n", "import { getCache, setCache } from './cache.js';\r\nimport { validateLibraryList } from './data/validators.js';\r\n\r\nconst LOG_PREFIX = '[data]';\r\n\r\nlet lastSources = { movies: null, shows: null };\r\nconst showDetailCache = new Map();\r\nconst DATA_CACHE_TTL = 1000 * 60 * 30; // 30 minutes for data files\r\n\r\nconst EXPORTER_BAG_KEY = '__PLEX_EXPORTER__';\r\n\r\nconst globalExporterBag = (()=>{\r\n  try{\r\n    if(typeof globalThis !== 'undefined'){\r\n      if(globalThis[EXPORTER_BAG_KEY]) return globalThis[EXPORTER_BAG_KEY];\r\n      if(globalThis.window && globalThis.window[EXPORTER_BAG_KEY]){\r\n        return globalThis.window[EXPORTER_BAG_KEY];\r\n      }\r\n    }\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to resolve global exporter bag:`, err?.message || err);\r\n  }\r\n  return null;\r\n})();\r\n\r\nconst MOVIE_THUMB_BASE = 'data/movies/';\r\nconst SHOW_THUMB_BASE = 'data/series/';\r\nconst SCHEME_RE = /^[a-z][a-z0-9+.-]*:/i;\r\n\r\nexport async function fetchJson(url, retries = 2, useCache = true){\r\n  // Try cache first if enabled\r\n  if(useCache){\r\n    const cached = getCache(url);\r\n    if(cached !== null) {\r\n      console.log(`${LOG_PREFIX} Cache hit for ${url}`);\r\n      return cached;\r\n    }\r\n  }\r\n\r\n  let lastError = null;\r\n  for(let attempt = 0; attempt <= retries; attempt++){\r\n    try{\r\n      const r = await fetch(url, { cache:'no-store' });\r\n      if(r && r.ok) {\r\n        const data = await r.json();\r\n        // Cache successful responses\r\n        if(useCache && data) {\r\n          setCache(url, data, DATA_CACHE_TTL);\r\n        }\r\n        return data;\r\n      }\r\n      if(r && r.status === 404) return null; // Don't retry 404s\r\n      lastError = new Error(`HTTP ${r.status}: ${r.statusText}`);\r\n    }\r\n    catch(err){\r\n      lastError = err;\r\n      console.warn(`${LOG_PREFIX} Fetch attempt ${attempt + 1}/${retries + 1} failed for ${url}:`, err.message);\r\n    }\r\n    if(attempt < retries){\r\n      // Exponential backoff\r\n      const delay = Math.min(1000 * Math.pow(2, attempt), 5000);\r\n      await new Promise(resolve => setTimeout(resolve, delay));\r\n    }\r\n  }\r\n  const message = lastError?.message || 'Unbekannter Fehler';\r\n  console.error(`${LOG_PREFIX} All fetch attempts failed for ${url}:`, message);\r\n  const error = new Error(`Daten konnten nicht geladen werden: ${url} (${message})`);\r\n  if(lastError && typeof lastError === 'object'){\r\n    error.cause = lastError;\r\n  }\r\n  throw error;\r\n}\r\n\r\nfunction embeddedJsonById(id){\r\n  try{\r\n    const n = document.getElementById(id);\r\n    if(n && n.textContent) return JSON.parse(n.textContent);\r\n  }\r\n  catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to parse embedded JSON #${id}:`, err.message);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction fromGlobalBag(key){\r\n  try{\r\n    const bag = globalExporterBag;\r\n    const arr = bag && Array.isArray(bag[key]) ? bag[key] : null;\r\n    return arr || null;\r\n  }\r\n  catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to access global bag[${key}]:`, err.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction fromWindow(varName){\r\n  try{\r\n    const arr = Array.isArray(window[varName]) ? window[varName] : null;\r\n    return arr || null;\r\n  }\r\n  catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to access window.${varName}:`, err.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function loadWithCompat(primaryUrl, opts){\r\n  // default: try site/data first\r\n  let data = null;\r\n  try{\r\n    data = await fetchJson(primaryUrl);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Primary source failed for ${primaryUrl}:`, err.message);\r\n    data = null;\r\n  }\r\n  if(Array.isArray(data) && data.length){ markSource(opts?.label, `primary:${primaryUrl}`); return data; }\r\n  // fallback: embedded <script id=\"...\"> JSON\r\n  if(opts?.embedId){ const emb = embeddedJsonById(opts.embedId); if(Array.isArray(emb) && emb.length){ markSource(opts?.label, `embedded:${opts.embedId}`); return emb; } }\r\n  // fallback: global exporter bag\r\n  if(opts?.exportKey){ const bag = fromGlobalBag(opts.exportKey); if(Array.isArray(bag) && bag.length){ markSource(opts?.label, `globalBag:${opts.exportKey}`); return bag; } }\r\n  // fallback: window variable\r\n  if(opts?.globalVar){ const win = fromWindow(opts.globalVar); if(Array.isArray(win) && win.length){ markSource(opts?.label, `window:${opts.globalVar}`); return win; } }\r\n  // alt paths (legacy)\r\n  for(const alt of (opts?.altUrls||[])){\r\n    let altData = null;\r\n    try{\r\n      altData = await fetchJson(alt);\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Alternate source failed for ${alt}:`, err.message);\r\n      altData = null;\r\n    }\r\n    if(Array.isArray(altData) && altData.length){ markSource(opts?.label, `alt:${alt}`); return altData; }\r\n  }\r\n  // last resort: empty array\r\n  markSource(opts?.label, 'empty');\r\n  return Array.isArray(data) ? data : [];\r\n}\r\n\r\nfunction notifyUiError(title, message){\r\n  if(typeof window === 'undefined' || typeof document === 'undefined' || typeof document.createElement !== 'function'){\r\n    console.warn(`${LOG_PREFIX} Skipping UI error feedback (environment missing DOM APIs): ${title} - ${message}`);\r\n    return;\r\n  }\r\n  import('./errorHandler.js').then(mod=>{\r\n    try{\r\n      mod.showError?.(title, message, 8000);\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Failed to display UI error message:`, err?.message || err);\r\n    }\r\n  }).catch(err=>{\r\n    console.warn(`${LOG_PREFIX} Failed to load error handler for UI feedback:`, err?.message || err);\r\n  });\r\n}\r\n\r\nexport function prefixThumbValue(value, base){\r\n  const raw = value == null ? '' : String(value).trim();\r\n  if(!raw) return '';\r\n  if(raw.startsWith('//') || raw.startsWith('/') || SCHEME_RE.test(raw)) return raw;\r\n  const normalizedRaw = raw.replace(/\\\\/g, '/');\r\n  const normalizedBase = base ? (base.endsWith('/') ? base : `${base}/`) : '';\r\n  let decodeWarned = false;\r\n  const encodePath = path => path.split('/').map(segment => {\r\n    if(!segment) return '';\r\n    try{\r\n      return encodeURIComponent(decodeURIComponent(segment));\r\n    }catch(err){\r\n      if(!decodeWarned){\r\n        decodeWarned = true;\r\n        console.warn(`${LOG_PREFIX} Failed to normalize thumb segment \"${segment}\":`, err);\r\n      }\r\n      return encodeURIComponent(segment);\r\n    }\r\n  }).join('/');\r\n  const trimmed = normalizedRaw.replace(/^\\/+/, '');\r\n  const segments = trimmed.split('/');\r\n  const normalizedSegments = [];\r\n  for(const segment of segments){\r\n    if(!segment || segment === '.') continue;\r\n    if(segment === '..'){\r\n      if(normalizedSegments.length) normalizedSegments.pop();\r\n      continue;\r\n    }\r\n    normalizedSegments.push(segment);\r\n  }\r\n  const normalizedPath = normalizedSegments.join('/');\r\n  if(normalizedPath.startsWith('data/')) return encodePath(normalizedPath);\r\n  let relativeSegments = normalizedSegments;\r\n  if(normalizedBase && relativeSegments.length){\r\n    const baseDir = normalizedBase.replace(/\\/+$/, '').split('/').pop();\r\n    if(baseDir && relativeSegments[0] === baseDir){\r\n      relativeSegments = relativeSegments.slice(1);\r\n    }\r\n  }\r\n  const cleaned = relativeSegments.join('/');\r\n  const encoded = encodePath(cleaned);\r\n  return `${normalizedBase}${encoded}`;\r\n}\r\n\r\n\r\nexport function prefixThumb(obj, base){\r\n  if(!obj || typeof obj !== 'object') return obj;\r\n  const current = obj.thumbFile ?? obj.thumb ?? '';\r\n  const prefixed = prefixThumbValue(current, base);\r\n  if(prefixed){\r\n    obj.thumbFile = prefixed;\r\n    obj.thumb = prefixed;\r\n  }else if(current){\r\n    const str = String(current);\r\n    obj.thumbFile = str;\r\n    if(obj.thumb == null) obj.thumb = str;\r\n  }\r\n  return obj;\r\n}\r\n\r\nexport function prefixMovieThumb(obj){\r\n  return prefixThumb(obj, MOVIE_THUMB_BASE);\r\n}\r\n\r\nexport function prefixShowThumb(obj){\r\n  return prefixThumb(obj, SHOW_THUMB_BASE);\r\n}\r\n\r\nexport function prefixShowTree(show){\r\n  if(!show || typeof show !== 'object') return show;\r\n  prefixShowThumb(show);\r\n  if(Array.isArray(show.seasons)) show.seasons.forEach(prefixSeasonTree);\r\n  return show;\r\n}\r\n\r\nfunction prefixSeasonTree(season){\r\n  if(!season || typeof season !== 'object') return season;\r\n  prefixShowThumb(season);\r\n  if(Array.isArray(season.episodes)) season.episodes.forEach(ep=>prefixShowThumb(ep));\r\n  return season;\r\n}\r\n\r\nfunction normalizeMovieThumbs(list){\r\n  if(!Array.isArray(list)) return [];\r\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixMovieThumb(item); });\r\n  return list;\r\n}\r\n\r\nfunction normalizeShowThumbs(list){\r\n  if(!Array.isArray(list)) return [];\r\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixShowTree(item); });\r\n  return list;\r\n}\r\n\r\nexport async function loadMovies(){\r\n  try {\r\n    const rawMovies = await loadWithCompat('data/movies/movies.json', {\r\n      label: 'movies',\r\n      embedId: 'movies-json',\r\n      exportKey: 'movies',\r\n      globalVar: '__PLEX_MOVIES__',\r\n      altUrls: [\r\n        'movies/movies.json',\r\n        'data/movies.json',\r\n        'Filme/movies.json',\r\n        'movies.json',\r\n      ],\r\n    });\r\n    let movies;\r\n    try{\r\n      movies = validateLibraryList(rawMovies, 'movie');\r\n    }catch(validationError){\r\n      const message = validationError?.message || 'Unbekannte Validierungsfehler';\r\n      console.warn(`${LOG_PREFIX} Movie validation failed:`, validationError);\r\n      const error = new Error(`Ung\u00FCltige Filmdaten: ${message}`);\r\n      if(validationError instanceof Error){\r\n        error.cause = validationError;\r\n      }\r\n      throw error;\r\n    }\r\n    return normalizeMovieThumbs(movies);\r\n  } catch (error) {\r\n    console.error(`${LOG_PREFIX} loadMovies failed:`, error);\r\n    notifyUiError('Filme konnten nicht geladen werden', error?.message || 'Unbekannter Fehler');\r\n    return [];\r\n  }\r\n}\r\nexport async function loadShows(){\r\n  try {\r\n    const rawShows = await loadWithCompat('data/series/series_index.json', {\r\n      label: 'shows',\r\n      embedId: 'series-json',\r\n      exportKey: 'shows',\r\n      globalVar: '__PLEX_SHOWS__',\r\n      altUrls: [\r\n        'series/series_index.json',\r\n        'data/shows.json',\r\n        'data/series.json',\r\n        'Serien/series.json',\r\n        'series/series.json',\r\n        'series.json',\r\n        'shows.json',\r\n      ],\r\n    });\r\n    let shows;\r\n    try{\r\n      shows = validateLibraryList(rawShows, 'show');\r\n    }catch(validationError){\r\n      const message = validationError?.message || 'Unbekannte Validierungsfehler';\r\n      console.warn(`${LOG_PREFIX} Show validation failed:`, validationError);\r\n      const error = new Error(`Ung\u00FCltige Seriendaten: ${message}`);\r\n      if(validationError instanceof Error){\r\n        error.cause = validationError;\r\n      }\r\n      throw error;\r\n    }\r\n    return normalizeShowThumbs(shows);\r\n  } catch (error) {\r\n    console.error(`${LOG_PREFIX} loadShows failed:`, error);\r\n    notifyUiError('Serien konnten nicht geladen werden', error?.message || 'Unbekannter Fehler');\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function loadShowDetail(item){\r\n  if(!item) return null;\r\n  const keys = cacheKeys(item);\r\n  const cached = getCachedDetail(keys);\r\n  if(cached !== undefined) return cached;\r\n\r\n  const urls = detailUrlCandidates(item);\r\n  let lastError = null;\r\n\r\n  for(const url of urls){\r\n    try {\r\n      const data = await fetchJson(url);\r\n      if(data && typeof data === 'object'){\r\n        const normalized = normalizeShowDetail(data);\r\n        storeDetail(keys, normalized, item);\r\n        return cloneDetail(normalized);\r\n      }\r\n    } catch (error) {\r\n      lastError = error;\r\n      console.warn(`${LOG_PREFIX} Failed to load show detail from ${url}:`, error.message);\r\n    }\r\n  }\r\n\r\n  if(lastError) {\r\n    console.error(`${LOG_PREFIX} Could not load show detail for ${item.title || 'unknown'}`, lastError);\r\n    notifyUiError('Details konnten nicht geladen werden', lastError?.message || 'Bitte sp\u00E4ter erneut versuchen.');\r\n  }\r\n\r\n  storeDetail(keys, null, item);\r\n  return null;\r\n}\r\n\r\nfunction markSource(label, src){\r\n  if(!label) return;\r\n  try{\r\n    lastSources[label] = src;\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to record source for ${label}:`, err);\r\n  }\r\n}\r\n\r\nexport function getSources(){ return { ...lastSources }; }\r\nfunction cacheKeys(item){\r\n  const keys = [];\r\n  if(item?.ratingKey !== undefined && item?.ratingKey !== null && item?.ratingKey !== ''){\r\n    keys.push(`rk:${String(item.ratingKey)}`);\r\n  }\r\n  const href = normalizeHrefKey(item?.href);\r\n  if(href) keys.push(`href:${href}`);\r\n  return keys;\r\n}\r\n\r\nfunction normalizeHrefKey(href){\r\n  if(!href) return '';\r\n  return String(href).trim().replace(/^\\.\\//,'').replace(/^\\/+/, '');\r\n}\r\n\r\nfunction getCachedDetail(keys){\r\n  for(const key of keys){\r\n    if(showDetailCache.has(key)){\r\n      const cached = showDetailCache.get(key);\r\n      return cached ? cloneDetail(cached) : null;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nfunction storeDetail(keys, value, item){\r\n  const val = value;\r\n  keys.forEach(key=>{ showDetailCache.set(key, val); });\r\n  const rk = item?.ratingKey;\r\n  if(rk !== undefined && rk !== null){\r\n    showDetailCache.set(`rk:${String(rk)}`, val);\r\n  }\r\n  const detailKey = value && typeof value === 'object' ? value.ratingKey : undefined;\r\n  if(detailKey !== undefined && detailKey !== null){\r\n    showDetailCache.set(`rk:${String(detailKey)}`, val);\r\n  }\r\n  const href = normalizeHrefKey(item?.href);\r\n  if(href){\r\n    showDetailCache.set(`href:${href}`, val);\r\n  }\r\n  const detailHref = value && typeof value === 'object' ? normalizeHrefKey(value.href) : '';\r\n  if(detailHref){\r\n    showDetailCache.set(`href:${detailHref}`, val);\r\n  }\r\n}\r\n\r\nfunction detailUrlCandidates(item){\r\n  const urls = new Set();\r\n  const hrefKey = normalizeHrefKey(item?.href);\r\n  if(hrefKey){\r\n    if(/^https?:/i.test(hrefKey)){ urls.add(hrefKey); }\r\n    else{\r\n      if(hrefKey.startsWith('data/')) urls.add(hrefKey);\r\n      else urls.add(`data/${hrefKey}`);\r\n      const withoutData = hrefKey.replace(/^data\\//,'');\r\n      if(!withoutData.startsWith('series/')) urls.add(`data/series/${withoutData}`);\r\n      const idPart = withoutData.replace(/^series\\//,'').replace(/^details\\//,'').replace(/\\.json$/,'');\r\n      if(idPart) urls.add(`data/series/details/${idPart}.json`);\r\n    }\r\n  }\r\n  const rk = item?.ratingKey;\r\n  if(rk !== undefined && rk !== null){\r\n    urls.add(`data/series/details/${String(rk)}.json`);\r\n  }\r\n  return Array.from(urls);\r\n}\r\n\r\nfunction normalizeShowDetail(data){\r\n  if(!data || typeof data !== 'object') return null;\r\n  const show = { ...data };\r\n  prefixShowThumb(show);\r\n  show.genres = normalizeGenres(show.genres);\r\n  const castList = normalizePeople(show.cast || show.roles || []);\r\n  show.cast = castList;\r\n  show.roles = castList;\r\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeason).filter(Boolean) : [];\r\n  show.seasonCount = Number.isFinite(show.seasonCount) ? show.seasonCount : show.seasons.length;\r\n  prefixShowTree(show);\r\n  return show;\r\n}\r\n\r\nfunction normalizeSeason(season){\r\n  if(!season || typeof season !== 'object') return null;\r\n  const out = { ...season };\r\n  prefixShowThumb(out);\r\n  out.genres = normalizeGenres(out.genres);\r\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisode).filter(Boolean) : [];\r\n  prefixSeasonTree(out);\r\n  return out;\r\n}\r\n\r\nfunction normalizeEpisode(ep){\r\n  if(!ep || typeof ep !== 'object') return null;\r\n  const out = { ...ep };\r\n  prefixShowThumb(out);\r\n  out.genres = normalizeGenres(out.genres);\r\n  return out;\r\n}\r\n\r\nfunction normalizeGenres(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const seen = new Set();\r\n  const result = [];\r\n  list.forEach(entry=>{\r\n    let obj = null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      if(tag) obj = { tag };\r\n    }else if(entry && typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\r\n      if(tag){ obj = { ...entry, tag }; }\r\n    }\r\n    if(obj && !seen.has(obj.tag)){\r\n      seen.add(obj.tag);\r\n      result.push(obj);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nfunction normalizePeople(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry=>{\r\n    if(!entry) return null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      return tag ? { tag } : null;\r\n    }\r\n    if(typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\r\n      if(tag){ return { ...entry, tag }; }\r\n      return { ...entry };\r\n    }\r\n    return null;\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction cloneDetail(detail){\r\n  if(detail === null || detail === undefined) return detail;\r\n  try{\r\n    return structuredClone(detail);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} structuredClone failed for show detail:`, err);\r\n  }\r\n  try{\r\n    return JSON.parse(JSON.stringify(detail));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} JSON clone failed for show detail:`, err);\r\n  }\r\n  return detail;\r\n}\r\n", "import { getState } from './state.js';\r\n\r\nconst LOG_PREFIX = '[utils]';\r\n\r\nexport function getGenreNames(genres){\r\n  const seen = new Set();\r\n  const names = [];\r\n  (genres || []).forEach(entry=>{\r\n    let name = '';\r\n    if(typeof entry === 'string'){\r\n      name = entry;\r\n    }else if(entry && typeof entry === 'object'){\r\n      name = entry.tag || entry.title || entry.name || '';\r\n    }\r\n    const str = String(name || '').trim();\r\n    if(str && !seen.has(str)){\r\n      seen.add(str);\r\n      names.push(str);\r\n    }\r\n  });\r\n  return names;\r\n}\r\n\r\nexport function renderChipsLimited(container, values, limit=3){\r\n  if(!container) return;\r\n  const vals = (values||[]).filter(Boolean);\r\n\r\n  // If we have more values than the limit, show limit chips + aggregator\r\n  if(vals.length > limit){\r\n    const head = vals.slice(0, limit);\r\n    const rest = vals.slice(limit);\r\n    const chips = head.map(text=>chip(text));\r\n\r\n    const more = chip(`+ ${rest.length}`);\r\n    more.classList.add('more', 'card__chip--more');\r\n    more.setAttribute('data-more', rest.length);\r\n    more.setAttribute('title', `${rest.length} weitere Genres: ${rest.join(', ')}`);\r\n    // store extra chips to reveal on click\r\n    more._extraChips = rest.map(text=>chip(text));\r\n    chips.push(more);\r\n\r\n    container.replaceChildren(...chips);\r\n  } else {\r\n    // Show all chips if we have limit or fewer\r\n    const chips = vals.map(text=>chip(text));\r\n    container.replaceChildren(...chips);\r\n  }\r\n\r\n  enableMoreChipBehavior(container);\r\n}\r\n\r\nexport function enableMoreChipBehavior(root = document){\r\n  try{\r\n    root.querySelectorAll('.chip.more, .card__chip--more').forEach(btn=>{\r\n      if(btn.dataset.bound) return;\r\n      btn.dataset.bound = '1';\r\n      btn.addEventListener('click', (e)=>{\r\n        // Stop propagation to prevent card click from opening modal\r\n        e.stopPropagation();\r\n\r\n        // Find the parent card element\r\n        const card = btn.closest('.card');\r\n        if(card) {\r\n          // Trigger the card's click event to open the modal\r\n          card.click();\r\n        } else {\r\n          // Fallback: expand inline if not in a card context\r\n          const hidden = btn._extraChips || [];\r\n          try{\r\n            hidden.forEach(ch => btn.before(ch));\r\n          }catch(err){\r\n            console.warn(`${LOG_PREFIX} Failed to expand inline chips:`, err);\r\n          }\r\n          btn.remove();\r\n        }\r\n      });\r\n    });\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to enable more chip behaviour:`, err);\r\n  }\r\n}\r\n\r\nexport function collectionTags(item){\r\n  return ((item && item.collections) || [])\r\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\r\n    .filter(Boolean);\r\n}\r\n\r\nexport function humanYear(item){\r\n  if(!item) return '';\r\n  const candidates = [\r\n    item.originallyAvailableAt,\r\n    item.year,\r\n    item.releaseDate,\r\n    item.premiereDate,\r\n  ];\r\n\r\n  for(const value of candidates){\r\n    if(value === undefined || value === null) continue;\r\n    const str = String(value);\r\n    if(!str) continue;\r\n    const match = str.match(/\\d{4}/);\r\n    if(match) return match[0];\r\n  }\r\n\r\n  return '';\r\n}\r\n\r\nexport function formatRating(val){\r\n  if(val instanceof Number){\r\n    return formatRating(val.valueOf());\r\n  }\r\n\r\n  if(typeof val === 'number'){\r\n    return Number.isFinite(val) ? val.toFixed(1) : '0.0';\r\n  }\r\n\r\n  if(typeof val === 'string'){\r\n    const trimmed = val.trim();\r\n    if(!trimmed) return '0.0';\r\n    const num = Number(trimmed);\r\n    return Number.isFinite(num) ? num.toFixed(1) : '0.0';\r\n  }\r\n\r\n  return '0.0';\r\n}\r\n\r\nfunction chip(text){ const s=document.createElement('span'); s.className='chip'; s.textContent=String(text||''); return s; }\r\n\r\nexport function isNew(item){\r\n  if(!item?.addedAt) return false;\r\n  const added = new Date(item.addedAt).getTime();\r\n  if(!Number.isFinite(added)) return false;\r\n  const cfg = getState().cfg || {};\r\n  const days = Number(cfg.newDays || 30);\r\n  return Date.now() - added <= days * 24*60*60*1000;\r\n}\r\n\r\n/**\r\n * Check if TMDB credentials are available\r\n * @returns {boolean}\r\n */\r\nfunction hasTmdbCredentials(){\r\n  try{\r\n    const token = localStorage.getItem('tmdbToken');\r\n    if(token && token.trim()) return true;\r\n    const state = getState();\r\n    if(state.cfg?.tmdbToken || state.cfg?.tmdbApiKey) return true;\r\n    return false;\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Unable to check TMDB credentials:`, err);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if TMDB images should be used for grid cards\r\n * User-controlled toggle (default: off)\r\n * @returns {boolean}\r\n */\r\nexport function useTmdbForCards(){\r\n  try{\r\n    return localStorage.getItem('useTmdb')==='1';\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Unable to read TMDB card preference from storage:`, err);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if TMDB should be used for Hero banner\r\n * Always enabled when credentials are available\r\n * @returns {boolean}\r\n */\r\nexport function useTmdbForHero(){\r\n  return hasTmdbCredentials();\r\n}\r\n\r\n/**\r\n * Legacy alias for backwards compatibility\r\n * @deprecated Use useTmdbForCards() instead\r\n */\r\nexport function useTmdbOn(){\r\n  return useTmdbForCards();\r\n}\r\n\r\n/**\r\n * Safely clear hero cache while preserving user settings\r\n * @returns {Object} Summary of cleared items\r\n */\r\nexport function clearHeroCache(){\r\n  try{\r\n    // Backup important user data\r\n    const backup = {\r\n      tmdbToken: localStorage.getItem('tmdbToken'),\r\n      useTmdb: localStorage.getItem('useTmdb'),\r\n      prefReduceMotion: localStorage.getItem('prefReduceMotion'),\r\n      watchlist: localStorage.getItem('watchlist:v1'),\r\n      modalLayout: localStorage.getItem('modalLayout'),\r\n      scrollOrchestratorEnabled: localStorage.getItem('scrollOrchestratorEnabled')\r\n    };\r\n\r\n    // Count items before clearing\r\n    const heroKeys = Object.keys(localStorage).filter(k =>\r\n      k.startsWith('hero') || k.startsWith('Hero')\r\n    );\r\n    const tmdbCacheKeys = Object.keys(localStorage).filter(k =>\r\n      k.includes('tmdbCache') || k === 'hero.tmdbCache.v1'\r\n    );\r\n\r\n    // Clear hero-related data\r\n    heroKeys.forEach(key => localStorage.removeItem(key));\r\n    tmdbCacheKeys.forEach(key => localStorage.removeItem(key));\r\n\r\n    // Restore user settings\r\n    Object.entries(backup).forEach(([key, value]) => {\r\n      if(value !== null) localStorage.setItem(key, value);\r\n    });\r\n\r\n    console.log(`${LOG_PREFIX} Cleared ${heroKeys.length} hero entries and ${tmdbCacheKeys.length} TMDB cache entries`);\r\n\r\n    return {\r\n      heroEntries: heroKeys.length,\r\n      tmdbCacheEntries: tmdbCacheKeys.length,\r\n      preserved: Object.keys(backup).filter(k => backup[k] !== null)\r\n    };\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to clear hero cache:`, err);\r\n    return { error: err.message };\r\n  }\r\n}\r\n", "import { getState } from './state.js';\r\n\r\nconst STORAGE_KEY = 'watchlist:v1';\r\nconst LOG_PREFIX = '[watchlist]';\r\nlet saved = new Set();\r\n\r\nfunction load(){\r\n  try{\r\n    saved = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to load entries from storage:`, err?.message || err);\r\n    saved = new Set();\r\n  }\r\n}\r\nfunction persist(){\r\n  try{\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(saved.values())));\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to persist entries to storage:`, err?.message || err);\r\n  }\r\n}\r\n\r\nfunction idFor(item){\r\n  if(!item) return '';\r\n  const kind = (item.type==='tv' || item.libraryType==='show') ? 'show' : 'movie';\r\n  const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\r\n  return id ? `${kind}:${id}` : '';\r\n}\r\n\r\nexport function isSaved(item){ return saved.has(idFor(item)); }\r\nexport function count(){ return saved.size; }\r\nexport function toggle(item){\r\n  const k=idFor(item);\r\n  if(!k) return;\r\n  if(saved.has(k)) saved.delete(k); else saved.add(k);\r\n  persist();\r\n  renderCount();\r\n  const panel=document.getElementById('watchlistPanel');\r\n  if(panel && !panel.hidden) renderPanel();\r\n}\r\n\r\nexport function renderCount(){ const el=document.getElementById('watchlistCount'); if(el) el.textContent = String(count()); }\r\n\r\nexport function openPanel(){\r\n  const p=document.getElementById('watchlistPanel');\r\n  if(p) {\r\n    p.hidden=false;\r\n    p.setAttribute('aria-hidden','false');\r\n    renderPanel();\r\n  }\r\n}\r\n\r\nexport function closePanel(){\r\n  const p=document.getElementById('watchlistPanel');\r\n  if(p){\r\n    p.hidden=true;\r\n    p.setAttribute('aria-hidden','true');\r\n  }\r\n  setExpanded(false);\r\n}\r\n\r\nexport function clear(){ saved.clear(); persist(); renderCount(); renderPanel(); }\r\n\r\nexport function exportJson(){\r\n  const items = listItems();\r\n  const data = JSON.stringify(items, null, 2);\r\n  const blob = new Blob([data], { type:'application/json' });\r\n  const a = document.createElement('a');\r\n  a.href = URL.createObjectURL(blob);\r\n  a.download = 'watchlist.json';\r\n  document.body.append(a); a.click(); a.remove();\r\n  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);\r\n}\r\n\r\nfunction listItems(){\r\n  const s = getState();\r\n  const pool = (s.movies||[]).concat(s.shows||[]);\r\n  const map = new Map(pool.map(it=>[idFor(it), it]));\r\n  return Array.from(saved.values()).map(k=>map.get(k)).filter(Boolean);\r\n}\r\n\r\nexport function renderPanel(){\r\n  const list = document.getElementById('watchlistItems');\r\n  const empty = document.getElementById('watchlistEmpty');\r\n  if(!list || !empty) return;\r\n  const items = listItems();\r\n  if(items.length===0){ list.replaceChildren(); empty.hidden=false; return; }\r\n  empty.hidden=true;\r\n  const frag = document.createDocumentFragment();\r\n  items.forEach(item=>{\r\n    const li = document.createElement('li');\r\n    li.className = 'watchlist-item';\r\n    const t = document.createElement('span');\r\n    t.className='title';\r\n    t.textContent = item.title || '';\r\n    const rm = document.createElement('button');\r\n    rm.textContent = 'Entfernen';\r\n    rm.addEventListener('click', ()=>{ toggle(item); renderPanel(); });\r\n    const open = document.createElement('button');\r\n    open.textContent = '\u00D6ffnen';\r\n    open.addEventListener('click', ()=>{\r\n      const kind = (item.type==='tv') ? 'show' : 'movie';\r\n      const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\r\n      if(id) location.hash = `#/${kind}/${id}`;\r\n    });\r\n    li.append(t, open, rm);\r\n    frag.append(li);\r\n  });\r\n  list.replaceChildren(frag);\r\n}\r\n\r\nexport function initUi(){\r\n  load();\r\n  renderCount();\r\n  const openBtn = document.getElementById('openWatchlist');\r\n  const toggleBtn = document.getElementById('watchlistToggle');\r\n  const closeBtn = document.getElementById('closeWatchlist');\r\n  const clearBtn = document.getElementById('clearWatchlist');\r\n  const exportBtn = document.getElementById('exportWatchlist');\r\n  openBtn && openBtn.addEventListener('click', ()=>{ openPanel(); setExpanded(true); });\r\n  toggleBtn && toggleBtn.addEventListener('click', ()=>{ const p=document.getElementById('watchlistPanel'); if(p && !p.hidden){ closePanel(); } else { openPanel(); setExpanded(true); } });\r\n  closeBtn && closeBtn.addEventListener('click', ()=>{ closePanel(); });\r\n  clearBtn && clearBtn.addEventListener('click', ()=>{ clear(); });\r\n  exportBtn && exportBtn.addEventListener('click', ()=>{ exportJson(); });\r\n}\r\n\r\nfunction setExpanded(on){ const t=document.getElementById('watchlistToggle'); if(t) t.setAttribute('aria-expanded', on?'true':'false'); }\r\n", "export function applyTabs(root){\r\n  const tabs = root.querySelector('.v2-tabs');\r\n  if(!tabs) return;\r\n  const buttons = Array.from(tabs.querySelectorAll('button[data-t]'));\r\n  const select = (target)=>{\r\n    buttons.forEach(btn=>{\r\n      const isActive = btn.dataset.t === target;\r\n      btn.classList.toggle('active', isActive);\r\n      btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\r\n      btn.tabIndex = isActive ? 0 : -1;\r\n      const pane = root.querySelector(`.v2-pane[data-pane=\"${btn.dataset.t}\"]`);\r\n      if(pane){\r\n        pane.hidden = !isActive;\r\n        pane.setAttribute('aria-hidden', pane.hidden ? 'true' : 'false');\r\n      }\r\n    });\r\n  };\r\n  const moveFocus = (current, delta)=>{\r\n    if(!buttons.length) return;\r\n    const currentIndex = buttons.indexOf(current);\r\n    const fallbackIndex = delta > 0 ? 0 : buttons.length - 1;\r\n    const index = currentIndex === -1 ? fallbackIndex : (currentIndex + delta + buttons.length) % buttons.length;\r\n    const next = buttons[index];\r\n    if(next){\r\n      next.focus();\r\n      select(next.dataset.t);\r\n    }\r\n  };\r\n  tabs.addEventListener('click', ev=>{\r\n    const btn = ev.target.closest('button[data-t]');\r\n    if(!btn) return;\r\n    ev.preventDefault();\r\n    select(btn.dataset.t);\r\n  });\r\n  tabs.addEventListener('keydown', ev=>{\r\n    const btn = ev.target.closest('button[data-t]');\r\n    if(!btn) return;\r\n    switch(ev.key){\r\n      case 'ArrowLeft':\r\n      case 'ArrowUp':\r\n        ev.preventDefault();\r\n        moveFocus(btn, -1);\r\n        break;\r\n      case 'ArrowRight':\r\n      case 'ArrowDown':\r\n        ev.preventDefault();\r\n        moveFocus(btn, 1);\r\n        break;\r\n      case 'Home':\r\n        ev.preventDefault();\r\n        if(buttons[0]){\r\n          buttons[0].focus();\r\n          select(buttons[0].dataset.t);\r\n        }\r\n        break;\r\n      case 'End':\r\n        ev.preventDefault();\r\n        if(buttons.length){\r\n          const last = buttons[buttons.length - 1];\r\n          last.focus();\r\n          select(last.dataset.t);\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n  const initial = buttons.find(btn=> btn.classList.contains('active')) || buttons[0];\r\n  if(initial) select(initial.dataset.t);\r\n}\r\n", "import { formatRating, humanYear, isNew, useTmdbOn } from '../utils.js';\r\n\r\nconst TMDB_BASE_URL = 'https://www.themoviedb.org';\r\nconst FOOTER_TYPE_CONFIG = {\r\n  network: { path: 'network', label: 'Netzwerk' },\r\n  company: { path: 'company', label: 'Produktionsfirma' },\r\n  collection: { path: 'collection', label: 'Sammlung' },\r\n};\r\n\r\nfunction resolvePoster(item){\r\n  const tmdbPoster = item?.tmdbDetail?.poster || item?.tmdb?.poster || item?.tmdbPoster;\r\n  const localPoster = item?.poster || item?.thumbFile || item?.art || '';\r\n  return (useTmdbOn() && tmdbPoster) ? tmdbPoster : localPoster;\r\n}\r\n\r\nexport function runtimeText(item){\r\n  const sources = [\r\n    item?.runtimeMin,\r\n    item?.durationMin,\r\n    item?.tmdbDetail?.runtime,\r\n    item?.duration ? Math.round(Number(item.duration) / 60000) : null,\r\n  ];\r\n\r\n  let minutes = null;\r\n  for(const value of sources){\r\n    const parsed = Number(value);\r\n    if(Number.isFinite(parsed) && parsed > 0){\r\n      minutes = parsed;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if(minutes === null) return '';\r\n  if(item?.type === 'tv'){ return `~${minutes} min/Ep`; }\r\n  return `${minutes} min`;\r\n}\r\n\r\nexport function ratingText(item){\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(!Number.isFinite(rating)) return '';\r\n  return `\u2605 ${formatRating(rating)}`;\r\n}\r\n\r\nexport function studioText(item){\r\n  if(item?.studio) return item.studio;\r\n  if(item?.network) return item.network;\r\n  if(item?.studioName) return item.studioName;\r\n  if(item?.tmdbDetail?.productionCompanies){\r\n    const first = item.tmdbDetail.productionCompanies.find(company => company?.name);\r\n    if(first && first.name) return first.name;\r\n  }\r\n  if(item?.tmdbDetail?.networks){\r\n    const net = item.tmdbDetail.networks.find(entry => entry?.name);\r\n    if(net && net.name) return net.name;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction buildChips(item){\r\n  const chips = [];\r\n  if(isNew(item)) chips.push('Neu');\r\n  if(item?.type === 'tv' && Number.isFinite(Number(item?.seasonCount))){\r\n    chips.push(`Staffeln: ${item.seasonCount}`);\r\n  }\r\n  const baseGenres = item?.genres || [];\r\n  const tmdbGenres = Array.isArray(item?.tmdbDetail?.genres) ? item.tmdbDetail.genres : [];\r\n  const genres = [...baseGenres, ...tmdbGenres].map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n  const seen = new Set();\r\n  genres.forEach(genre=>{\r\n    if(seen.has(genre.toLowerCase())) return;\r\n    seen.add(genre.toLowerCase());\r\n    chips.push(genre);\r\n  });\r\n  return chips;\r\n}\r\n\r\nfunction pickTagline(item){\r\n  const tmdb = (item?.tmdbDetail?.tagline || '').trim();\r\n  if(tmdb) return tmdb;\r\n  return (item?.tagline || '').trim();\r\n}\r\n\r\nfunction pickContentRating(item){\r\n  const tmdb = (item?.tmdbDetail?.contentRating || '').trim();\r\n  if(tmdb) return tmdb;\r\n  return (item?.contentRating || '').trim();\r\n}\r\n\r\nfunction pickBackdrop(item){\r\n  if(item?.tmdbDetail?.backdrop) return item.tmdbDetail.backdrop;\r\n  if(item?.tmdb?.backdrop) return item.tmdb.backdrop;\r\n  return item?.art || item?.background || '';\r\n}\r\n\r\nfunction logoEntryToUrl(entry){\r\n  if(!entry) return '';\r\n  if(typeof entry === 'string') return entry;\r\n  return entry.url || entry.file_path || entry.filePath || entry.path || entry.logo || '';\r\n}\r\n\r\nfunction logoEntryLanguage(entry){\r\n  if(!entry || typeof entry !== 'object') return '';\r\n  const lang = entry.iso6391 || entry.iso_639_1 || entry.language || '';\r\n  return typeof lang === 'string' ? lang.toLowerCase() : '';\r\n}\r\n\r\nfunction pickHeroLogo(item){\r\n  const detail = item?.tmdbDetail;\r\n  const logos = Array.isArray(detail?.images?.logos) ? detail.images.logos : [];\r\n  if(!logos.length) return '';\r\n  const preferences = ['de', 'en', ''];\r\n  for(const pref of preferences){\r\n    const match = logos.find(entry => {\r\n      const lang = logoEntryLanguage(entry);\r\n      if(pref){ return lang === pref; }\r\n      return !lang;\r\n    });\r\n    const url = logoEntryToUrl(match);\r\n    const sanitized = sanitizeUrl(url);\r\n    if(sanitized) return sanitized;\r\n  }\r\n  for(const entry of logos){\r\n    const sanitized = sanitizeUrl(logoEntryToUrl(entry));\r\n    if(sanitized) return sanitized;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction pickLogo(item, excludeUrl=''){\r\n  const seen = new Set();\r\n  const exclude = sanitizeUrl(excludeUrl);\r\n  if(exclude) seen.add(exclude);\r\n  const candidates = [];\r\n  const detail = item?.tmdbDetail;\r\n  const push = (value)=>{\r\n    const sanitized = sanitizeUrl(logoEntryToUrl(value));\r\n    if(!sanitized || seen.has(sanitized)) return;\r\n    seen.add(sanitized);\r\n    candidates.push(sanitized);\r\n  };\r\n  if(detail?.images?.logos){\r\n    detail.images.logos.forEach(push);\r\n  }\r\n  if(detail?.networks){\r\n    detail.networks.forEach(push);\r\n  }\r\n  if(detail?.productionCompanies){\r\n    detail.productionCompanies.forEach(push);\r\n  }\r\n  return candidates[0] || '';\r\n}\r\n\r\nfunction sanitizeUrl(url){\r\n  if(!url) return '';\r\n  const str = String(url).trim();\r\n  if(!str) return '';\r\n  // Only allow http(s) and data URLs\r\n  if(/^https?:\\/\\//i.test(str) || /^data:image\\//i.test(str)) return str;\r\n  // For relative paths, ensure they don't contain quotes or special chars\r\n  return str.replace(/[\"'()]/g, '');\r\n}\r\n\r\nfunction applyBackdrop(root, item){\r\n  const container = root.querySelector('[data-head-backdrop]');\r\n  if(!container) return;\r\n  const url = pickBackdrop(item);\r\n  const sanitized = sanitizeUrl(url);\r\n  const reset = ()=>{\r\n    container.style.backgroundImage = '';\r\n    container.dataset.state = '';\r\n    container.dataset.src = '';\r\n  };\r\n  if(!sanitized){\r\n    reset();\r\n    return;\r\n  }\r\n  if(typeof Image === 'undefined'){\r\n    container.dataset.src = sanitized;\r\n    container.dataset.state = 'ready';\r\n    container.style.backgroundImage = `url(\"${sanitized}\")`;\r\n    return;\r\n  }\r\n  container.dataset.state = 'loading';\r\n  container.style.backgroundImage = '';\r\n  container.dataset.src = sanitized;\r\n  const img = new Image();\r\n  img.decoding = 'async';\r\n  img.referrerPolicy = 'no-referrer';\r\n  const onLoad = ()=>{\r\n    if(container.dataset.src !== sanitized) return;\r\n    container.style.backgroundImage = `url(\"${sanitized}\")`;\r\n    container.dataset.state = 'ready';\r\n  };\r\n  const onError = ()=>{\r\n    if(container.dataset.src !== sanitized) return;\r\n    reset();\r\n  };\r\n  img.addEventListener('load', onLoad, { once: true });\r\n  img.addEventListener('error', onError, { once: true });\r\n  img.src = sanitized;\r\n}\r\n\r\nfunction applyLogo(root, item, excludeUrl=''){\r\n  const slot = root.querySelector('[data-head-logo]');\r\n  if(!slot) return;\r\n  const logoUrl = pickLogo(item, excludeUrl);\r\n  if(logoUrl){\r\n    let img = slot.querySelector('img');\r\n    if(!img){\r\n      img = document.createElement('img');\r\n      img.alt = item?.title || item?.name || 'Logo';\r\n      img.decoding = 'async';\r\n      img.loading = 'lazy';\r\n      img.referrerPolicy = 'no-referrer';\r\n      slot.replaceChildren(img);\r\n    }\r\n    img.src = logoUrl;\r\n    img.alt = item?.title ? `Logo: ${item.title}` : img.alt;\r\n    slot.hidden = false;\r\n  }else{\r\n    slot.hidden = true;\r\n    slot.replaceChildren();\r\n  }\r\n}\r\n\r\nfunction applyHeroLogo(root, item){\r\n  const slot = root.querySelector('[data-head-overlay-logo]');\r\n  if(!slot) return '';\r\n  const logoUrl = pickHeroLogo(item);\r\n  slot.dataset.src = '';\r\n  if(!logoUrl){\r\n    slot.hidden = true;\r\n    slot.dataset.state = '';\r\n    slot.replaceChildren();\r\n    return '';\r\n  }\r\n  const img = document.createElement('img');\r\n  img.alt = item?.title ? `Hero Logo: ${item.title}` : 'Hero Logo';\r\n  img.decoding = 'async';\r\n  img.loading = 'lazy';\r\n  img.referrerPolicy = 'no-referrer';\r\n  slot.replaceChildren(img);\r\n  slot.dataset.src = logoUrl;\r\n  if(typeof Image === 'undefined'){\r\n    img.src = logoUrl;\r\n    slot.hidden = false;\r\n    slot.dataset.state = 'ready';\r\n    return logoUrl;\r\n  }\r\n  slot.hidden = true;\r\n  slot.dataset.state = 'loading';\r\n  const onReady = ()=>{\r\n    if(slot.dataset.src !== logoUrl) return;\r\n    slot.hidden = false;\r\n    slot.dataset.state = 'ready';\r\n  };\r\n  const onError = ()=>{\r\n    if(slot.dataset.src !== logoUrl) return;\r\n    slot.hidden = true;\r\n    slot.dataset.state = '';\r\n    slot.dataset.src = '';\r\n    slot.replaceChildren();\r\n    applyLogo(root, item, '');\r\n  };\r\n  img.addEventListener('load', onReady, { once: true });\r\n  img.addEventListener('error', onError, { once: true });\r\n  img.src = logoUrl;\r\n  return logoUrl;\r\n}\r\n\r\nfunction ratingBucket(value){\r\n  if(!Number.isFinite(value)) return '';\r\n  if(value >= 7.5) return 'high';\r\n  if(value >= 5.5) return 'medium';\r\n  if(value > 0) return 'low';\r\n  return '';\r\n}\r\n\r\nfunction pickRatingInfo(item){\r\n  const detail = item?.tmdbDetail || {};\r\n  const tmdbVote = Number(detail.voteAverage ?? detail.vote_average);\r\n  if(Number.isFinite(tmdbVote) && tmdbVote > 0){\r\n    return {\r\n      label: 'TMDB',\r\n      value: tmdbVote,\r\n      text: formatRating(tmdbVote),\r\n      bucket: ratingBucket(tmdbVote),\r\n    };\r\n  }\r\n  const fallback = Number(item?.rating ?? item?.audienceRating ?? item?.userRating);\r\n  if(Number.isFinite(fallback) && fallback > 0){\r\n    return {\r\n      label: 'Bewertung',\r\n      value: fallback,\r\n      text: formatRating(fallback),\r\n      bucket: ratingBucket(fallback),\r\n    };\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction applyHeroMeta(root, item){\r\n  const slot = root.querySelector('[data-head-overlay-meta]');\r\n  if(!slot) return;\r\n  slot.replaceChildren();\r\n  const info = pickRatingInfo(item);\r\n  if(!info){\r\n    slot.hidden = true;\r\n    return;\r\n  }\r\n  const chip = document.createElement('span');\r\n  chip.className = 'v2-chip--rating';\r\n  if(info.bucket) chip.dataset.score = info.bucket;\r\n  const label = document.createElement('span');\r\n  label.textContent = info.label;\r\n  const value = document.createElement('strong');\r\n  value.textContent = info.text;\r\n  chip.append(label, value);\r\n  chip.setAttribute('aria-label', `${info.label} Bewertung ${info.text} von 10`);\r\n  slot.appendChild(chip);\r\n  slot.hidden = false;\r\n}\r\n\r\nexport function populateHead(root, item){\r\n  const titleEl = root.querySelector('.v2-title');\r\n  if(titleEl) titleEl.textContent = item?.title || item?.name || '';\r\n  const tagline = pickTagline(item);\r\n  const metaEl = root.querySelector('.v2-meta');\r\n  const subEl = root.querySelector('.v2-subline');\r\n  const year = humanYear(item);\r\n  const runtime = runtimeText(item);\r\n  const rating = ratingText(item);\r\n  const studio = studioText(item);\r\n  const metaParts = [year, runtime, rating, studio].filter(Boolean);\r\n  if(subEl){\r\n    const fallback = metaParts.join(' \u2022 ');\r\n    subEl.textContent = tagline || fallback;\r\n    subEl.hidden = !(tagline || fallback);\r\n  }\r\n  if(metaEl){\r\n    metaEl.textContent = tagline && metaParts.length ? metaParts.join(' \u2022 ') : '';\r\n    metaEl.hidden = !(tagline && metaParts.length);\r\n  }\r\n  const chipsRoot = root.querySelector('.v2-chips');\r\n  if(chipsRoot){\r\n    chipsRoot.replaceChildren();\r\n    buildChips(item).forEach(text=>{\r\n      const span = document.createElement('span');\r\n      span.className = 'chip';\r\n      span.textContent = text;\r\n      chipsRoot.appendChild(span);\r\n    });\r\n    chipsRoot.hidden = !chipsRoot.childElementCount;\r\n  }\r\n  const quickFacts = root.querySelector('.v2-facts');\r\n  const quickList = root.querySelector('.v2-facts-list');\r\n  if(quickFacts && quickList){\r\n    const facts = [];\r\n    if(year) facts.push(['Jahr', year]);\r\n    const contentRating = pickContentRating(item);\r\n    if(contentRating) facts.push(['Freigabe', contentRating]);\r\n    if(runtime) facts.push(['Laufzeit', runtime]);\r\n    if(rating) facts.push(['Bewertung', rating]);\r\n    if(studio) facts.push(['Studio', studio]);\r\n    quickList.replaceChildren();\r\n    facts.forEach(([label, value])=>{\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      quickList.append(dt, dd);\r\n    });\r\n    quickFacts.hidden = !facts.length;\r\n  }\r\n  const img = root.querySelector('.v2-poster img');\r\n  if(img){\r\n    const src = resolvePoster(item);\r\n    img.src = src || '';\r\n    img.alt = item?.title ? `Poster: ${item.title}` : '';\r\n    img.loading = 'lazy';\r\n    img.decoding = 'async';\r\n    img.classList.remove('is-ready');\r\n    if(src){\r\n      img.addEventListener('load', onPosterReady, { once:true });\r\n      img.addEventListener('error', onPosterReady, { once:true });\r\n    }else{\r\n      img.classList.add('is-ready');\r\n    }\r\n  }\r\n  applyBackdrop(root, item);\r\n  const heroLogo = applyHeroLogo(root, item);\r\n  applyHeroMeta(root, item);\r\n  applyLogo(root, item, heroLogo);\r\n  populateFooter(root, item);\r\n}\r\n\r\nfunction onPosterReady(ev){\r\n  ev.currentTarget?.classList.add('is-ready');\r\n}\r\n\r\nfunction buildFooterInitials(name=''){\r\n  const trimmed = String(name || '').trim();\r\n  if(!trimmed) return 'TMDB';\r\n  const initials = trimmed\r\n    .split(/\\s+/)\r\n    .map(part => part[0])\r\n    .filter(Boolean)\r\n    .join('')\r\n    .slice(0, 3)\r\n    .toUpperCase();\r\n  return initials || 'TMDB';\r\n}\r\n\r\nfunction createFallbackLogo(name=''){\r\n  const initials = buildFooterInitials(name);\r\n  const ns = 'http://www.w3.org/2000/svg';\r\n  const svg = document.createElementNS(ns, 'svg');\r\n  svg.setAttribute('viewBox', '0 0 160 60');\r\n  svg.setAttribute('aria-hidden', 'true');\r\n  svg.setAttribute('focusable', 'false');\r\n  const rect = document.createElementNS(ns, 'rect');\r\n  rect.setAttribute('x', '2');\r\n  rect.setAttribute('y', '2');\r\n  rect.setAttribute('width', '156');\r\n  rect.setAttribute('height', '56');\r\n  rect.setAttribute('rx', '14');\r\n  rect.setAttribute('fill', '#15243b');\r\n  rect.setAttribute('stroke', 'rgba(87, 116, 164, 0.6)');\r\n  rect.setAttribute('stroke-width', '2');\r\n  const text = document.createElementNS(ns, 'text');\r\n  text.setAttribute('x', '80');\r\n  text.setAttribute('y', '38');\r\n  text.setAttribute('fill', '#b8c7e6');\r\n  text.setAttribute('font-size', '28');\r\n  text.setAttribute('font-weight', '600');\r\n  text.setAttribute('text-anchor', 'middle');\r\n  text.setAttribute('font-family', 'Inter, system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif');\r\n  text.textContent = initials;\r\n  svg.append(rect, text);\r\n  return svg;\r\n}\r\n\r\nfunction createFooterLogoNode(entry){\r\n  const config = FOOTER_TYPE_CONFIG[entry.type] || { label: 'TMDB' };\r\n  const baseLabel = entry.name ? `${entry.name} (${config.label})` : config.label;\r\n  const anchor = document.createElement('a');\r\n  anchor.className = 'v2-footer-logo';\r\n  anchor.href = entry.link || TMDB_BASE_URL;\r\n  anchor.target = '_blank';\r\n  anchor.rel = 'noopener noreferrer';\r\n  anchor.title = entry.name ? `${entry.name} \u2013 TMDB` : 'TMDB';\r\n  const ariaSuffix = entry.hasSpecificLink ? ' \u2013 \u00F6ffnet externes TMDB-Profil' : ' \u2013 \u00F6ffnet externe TMDB-Seite';\r\n  anchor.setAttribute('aria-label', `${baseLabel}${ariaSuffix}`);\r\n  if(entry.logo){\r\n    const img = document.createElement('img');\r\n    img.src = entry.logo;\r\n    img.alt = entry.name ? `${entry.name} Logo` : 'TMDB Logo';\r\n    img.loading = 'lazy';\r\n    img.decoding = 'async';\r\n    img.referrerPolicy = 'no-referrer';\r\n    anchor.appendChild(img);\r\n  }else{\r\n    anchor.appendChild(createFallbackLogo(entry.name || config.label));\r\n  }\r\n  return anchor;\r\n}\r\n\r\nfunction buildFooterEntries(item){\r\n  const detail = item?.tmdbDetail;\r\n  if(!detail) return [];\r\n  const entries = [];\r\n  const seen = new Set();\r\n  const pushEntry = (source, type)=>{\r\n    if(!source) return;\r\n    const config = FOOTER_TYPE_CONFIG[type];\r\n    if(!config) return;\r\n    const rawId = source.id ?? source.tmdbId ?? source.tmdb_id ?? '';\r\n    const id = rawId == null ? '' : String(rawId).trim();\r\n    const name = String(source.name || source.title || '').trim();\r\n    const logoCandidates = [source.logo, source.logoPath, source.poster, source.backdrop];\r\n    let logoUrl = '';\r\n    for(const candidate of logoCandidates){\r\n      const sanitized = sanitizeUrl(candidate);\r\n      if(sanitized){ logoUrl = sanitized; break; }\r\n    }\r\n    if(!logoUrl && !name) return;\r\n    const keyParts = [type];\r\n    if(id) keyParts.push(id);\r\n    else if(name) keyParts.push(name.toLowerCase());\r\n    else if(logoUrl) keyParts.push(logoUrl);\r\n    const key = keyParts.join(':');\r\n    if(seen.has(key)) return;\r\n    seen.add(key);\r\n    const path = config.path;\r\n    const link = id ? `${TMDB_BASE_URL}/${path}/${encodeURIComponent(id)}` : TMDB_BASE_URL;\r\n    entries.push({\r\n      type,\r\n      name,\r\n      logo: logoUrl,\r\n      link,\r\n      hasSpecificLink: Boolean(id),\r\n    });\r\n  };\r\n  const networks = Array.isArray(detail?.networks) ? detail.networks : [];\r\n  networks.forEach(entry => pushEntry(entry, 'network'));\r\n  const companies = Array.isArray(detail?.productionCompanies) ? detail.productionCompanies : [];\r\n  companies.forEach(entry => pushEntry(entry, 'company'));\r\n  if(detail?.collection){\r\n    const collectionSource = {\r\n      ...detail.collection,\r\n      logo: detail.collection?.logo,\r\n      poster: detail.collection?.poster,\r\n      backdrop: detail.collection?.backdrop,\r\n    };\r\n    pushEntry(collectionSource, 'collection');\r\n  }\r\n  return entries;\r\n}\r\n\r\nfunction populateFooter(root, item){\r\n  const footer = root.querySelector('.v2-footer');\r\n  if(!footer) return;\r\n  const logosRoot = footer.querySelector('.v2-footer-logos');\r\n  const note = footer.querySelector('.v2-footer-note');\r\n  if(!logosRoot || !note){\r\n    footer.hidden = true;\r\n    return;\r\n  }\r\n  logosRoot.replaceChildren();\r\n  note.replaceChildren();\r\n  const entries = buildFooterEntries(item);\r\n  if(!entries.length){\r\n    footer.hidden = true;\r\n    return;\r\n  }\r\n  const fragment = document.createDocumentFragment();\r\n  entries.forEach(entry => fragment.appendChild(createFooterLogoNode(entry)));\r\n  logosRoot.appendChild(fragment);\r\n  const tmdbLink = document.createElement('a');\r\n  tmdbLink.href = TMDB_BASE_URL;\r\n  tmdbLink.target = '_blank';\r\n  tmdbLink.rel = 'noopener noreferrer';\r\n  tmdbLink.textContent = 'TMDB';\r\n  tmdbLink.setAttribute('aria-label', 'The Movie Database (TMDB) \u2013 externe Seite');\r\n  const strong = document.createElement('strong');\r\n  strong.appendChild(tmdbLink);\r\n  note.append(\r\n    'Logos & Daten bereitgestellt von ',\r\n    strong,\r\n    '. Dieses Produkt nutzt die TMDB API, ist jedoch nicht von TMDB zertifiziert oder unterst\u00FCtzt.'\r\n  );\r\n  footer.hidden = false;\r\n}\r\n", "import { getState } from '../state.js';\r\n\r\nexport function updateOverview(root, item){\r\n  const pane = root.querySelector('.v2-overview');\r\n  if(!pane) return;\r\n\r\n  const tmdb = (item?.tmdbDetail?.overview || '').trim();\r\n  const local = (item?.summary || item?.overview || '').trim();\r\n  const overview = tmdb || local;\r\n\r\n  if(!overview){\r\n    pane.textContent = '';\r\n    return;\r\n  }\r\n\r\n  const previousParagraph = pane.querySelector('.v2-overview-text');\r\n  const wasExpanded = previousParagraph?.classList.contains('is-expanded')\r\n    || pane.querySelector('.v2-overview-toggle')?.getAttribute('aria-expanded') === 'true';\r\n\r\n  const paragraph = document.createElement('p');\r\n  paragraph.className = 'v2-overview-text line-clamp line-clamp-5';\r\n  paragraph.textContent = overview;\r\n\r\n  const toggle = document.createElement('button');\r\n  toggle.type = 'button';\r\n  toggle.className = 'v2-overview-toggle';\r\n\r\n  const setExpanded = (expanded)=>{\r\n    paragraph.classList.toggle('is-expanded', expanded);\r\n    toggle.setAttribute('aria-expanded', String(expanded));\r\n    toggle.textContent = expanded ? 'Weniger anzeigen' : 'Mehr anzeigen';\r\n  };\r\n\r\n  toggle.addEventListener('click', ()=>{\r\n    const expanded = toggle.getAttribute('aria-expanded') === 'true';\r\n    setExpanded(!expanded);\r\n  });\r\n\r\n  const badgeText = determineLanguageBadge(item, tmdb ? 'tmdb' : 'local');\r\n  let badge = null;\r\n  if(badgeText){\r\n    badge = document.createElement('span');\r\n    badge.className = 'v2-lang-badge';\r\n    badge.textContent = badgeText;\r\n  }\r\n\r\n  const children = [];\r\n  if(badge) children.push(badge);\r\n  children.push(paragraph, toggle);\r\n  pane.replaceChildren(...children);\r\n  setExpanded(Boolean(wasExpanded));\r\n\r\n  const measure = ()=>{\r\n    const overflowing = paragraph.scrollHeight > paragraph.clientHeight + 1;\r\n    if(!overflowing){\r\n      paragraph.classList.add('is-expanded');\r\n      toggle.hidden = true;\r\n    }else{\r\n      toggle.hidden = false;\r\n    }\r\n  };\r\n  const schedule = typeof requestAnimationFrame === 'function' ? requestAnimationFrame : (cb)=>setTimeout(cb, 0);\r\n  schedule(measure);\r\n}\r\n\r\nfunction determineLanguageBadge(item, source){\r\n  if(source !== 'tmdb') return '';\r\n  const cfgLang = String(item?.tmdbDetail?.raw?.spoken_languages?.[0]?.iso_639_1 || '').toLowerCase();\r\n  const original = String(item?.tmdbDetail?.raw?.original_language || '').toLowerCase();\r\n  const stateLang = String(getPreferredLanguage()).toLowerCase();\r\n  const effective = original || cfgLang;\r\n  if(effective === 'en' && stateLang && !stateLang.startsWith('en')){\r\n    return 'EN';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getPreferredLanguage(){\r\n  const state = getState();\r\n  if(state?.cfg?.lang) return state.cfg.lang;\r\n  return 'de-DE';\r\n}\r\n", "import { formatRating, humanYear } from '../utils.js';\r\nimport { runtimeText, studioText } from './headerSection.js';\r\nimport { getState } from '../state.js';\r\n\r\nfunction releaseDateText(item){\r\n  const tmdb = item?.tmdbDetail;\r\n  const candidates = [\r\n    tmdb?.releaseDate,\r\n    tmdb?.firstAirDate,\r\n    tmdb?.lastAirDate,\r\n    item?.originallyAvailableAt,\r\n    item?.releaseDate,\r\n    item?.premiereDate,\r\n    item?.firstAired,\r\n    item?.airDate,\r\n  ];\r\n  for(const raw of candidates){\r\n    const str = raw == null ? '' : String(raw).trim();\r\n    if(!str) continue;\r\n    const parsed = new Date(str);\r\n    if(Number.isFinite(parsed.getTime())){\r\n      try{\r\n        return parsed.toLocaleDateString('de-DE', { year:'numeric', month:'2-digit', day:'2-digit' });\r\n      }catch(err){\r\n        console.warn('[modal/detailsSection] Failed to format release date:', err?.message || err);\r\n      }\r\n    }\r\n    const iso = str.match(/^\\d{4}-\\d{2}-\\d{2}/);\r\n    if(iso && iso[0]) return iso[0];\r\n    if(str.length >= 4) return str.slice(0, 10);\r\n  }\r\n  const year = humanYear(item);\r\n  return year ? String(year) : '';\r\n}\r\n\r\nfunction namesFromList(source){\r\n  if(!Array.isArray(source)) return [];\r\n  return source.map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n}\r\n\r\nfunction genresFromItem(item){\r\n  const arr = Array.isArray(item?.genres) ? item.genres : [];\r\n  const tmdb = Array.isArray(item?.tmdbDetail?.genres) ? item.tmdbDetail.genres : [];\r\n  const mapped = [...arr, ...tmdb].map(entry=>{\r\n    if(!entry) return '';\r\n    if(typeof entry === 'string') return entry;\r\n    return entry.tag || entry.title || entry.name || '';\r\n  }).filter(Boolean);\r\n  return Array.from(new Set(mapped));\r\n}\r\n\r\nfunction tmdbCrew(detail, jobs){\r\n  if(!detail?.credits || !Array.isArray(detail.credits.crew)) return [];\r\n  const jobSet = Array.isArray(jobs) ? new Set(jobs) : new Set([jobs]);\r\n  const names = detail.credits.crew\r\n    .filter(member => member && jobSet.has(member.job))\r\n    .map(member => member.name || member.originalName || member.tag)\r\n    .filter(Boolean);\r\n  return Array.from(new Set(names));\r\n}\r\n\r\nfunction mergeNameLists(primary, secondary){\r\n  const seen = new Set();\r\n  const result = [];\r\n  [...primary, ...secondary].forEach(name => {\r\n    const trimmed = String(name || '').trim();\r\n    if(!trimmed || seen.has(trimmed.toLowerCase())) return;\r\n    seen.add(trimmed.toLowerCase());\r\n    result.push(trimmed);\r\n  });\r\n  return result;\r\n}\r\n\r\nfunction contentRatingFromItem(item){\r\n  const tmdb = (item?.tmdbDetail?.contentRating || '').trim();\r\n  if(tmdb) return tmdb;\r\n  return (item?.contentRating || '').trim();\r\n}\r\n\r\nfunction aggregateRatings(item){\r\n  const ratings = [];\r\n  const tmdb = item?.tmdbDetail;\r\n  if(tmdb?.voteAverage){\r\n    ratings.push(['TMDB', `\u2605 ${formatOptionalRating(tmdb.voteAverage)}`]);\r\n  }\r\n  if(item?.rating){\r\n    ratings.push(['Bewertung', `\u2605 ${formatOptionalRating(item.rating)}`]);\r\n  }\r\n  if(item?.audienceRating){\r\n    ratings.push(['Publikum', `\u2605 ${formatOptionalRating(item.audienceRating)}`]);\r\n  }\r\n  if(item?.userRating){\r\n    ratings.push(['Eigene Wertung', `\u2605 ${formatOptionalRating(item.userRating)}`]);\r\n  }\r\n  return ratings;\r\n}\r\n\r\nfunction watchProviderGroups(item){\r\n  const detail = item?.tmdbDetail;\r\n  if(!detail?.watchProviders) return [];\r\n  const region = (getState().cfg?.iso || getState().cfg?.region || 'DE').toUpperCase();\r\n  const source = detail.watchProviders?.[region] || detail.watchProviders?.DE || detail.watchProviders?.default || null;\r\n  if(!source) return [];\r\n  const map = [\r\n    ['flatrate', 'Streaming'],\r\n    ['rent', 'Leihen'],\r\n    ['buy', 'Kaufen'],\r\n    ['free', 'Kostenlos'],\r\n    ['ads', 'Mit Werbung'],\r\n  ];\r\n  const groups = [];\r\n  for(const [key, label] of map){\r\n    const list = Array.isArray(source[key]) ? source[key] : [];\r\n    const providers = list.map(entry => ({\r\n      id: entry?.id || entry?.provider_id || entry?.providerId || '',\r\n      name: entry?.provider_name || entry?.name || '',\r\n      logo: entry?.logo || entry?.logo_path || entry?.logoPath || '',\r\n    })).filter(entry => entry.name);\r\n    if(providers.length){\r\n      groups.push({ label, providers });\r\n    }\r\n  }\r\n  return groups;\r\n}\r\n\r\nfunction formatOptionalRating(value){\r\n  if(value instanceof Number){\r\n    return formatOptionalRating(value.valueOf());\r\n  }\r\n  if(typeof value === 'number'){\r\n    return Number.isFinite(value) ? formatRating(value) : '';\r\n  }\r\n  if(typeof value === 'string'){\r\n    const trimmed = value.trim();\r\n    if(!trimmed) return '';\r\n    const num = Number(trimmed);\r\n    return Number.isFinite(num) ? formatRating(num) : '';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function updateDetails(root, item){\r\n  const pane = root.querySelector('.v2-details');\r\n  if(!pane) return;\r\n  pane.replaceChildren();\r\n\r\n  const grid = document.createElement('div');\r\n  grid.className = 'v2-details-grid';\r\n\r\n  const general = [];\r\n  const release = releaseDateText(item);\r\n  if(release) general.push(['Ver\u00F6ffentlichung', release]);\r\n  const runtime = runtimeText(item);\r\n  if(runtime) general.push(['Laufzeit', runtime]);\r\n  const studio = studioText(item);\r\n  if(studio) general.push(['Studio', studio]);\r\n  const certification = contentRatingFromItem(item);\r\n  if(certification) general.push(['Freigabe', certification]);\r\n\r\n  aggregateRatings(item).forEach(entry => {\r\n    const [label, value] = entry;\r\n    if(label && value) general.push([label, value]);\r\n  });\r\n\r\n  if(item?.type === 'tv'){\r\n    const numericSeasons = Number(item?.seasonCount);\r\n    const seasonCount = Number.isFinite(numericSeasons) ? numericSeasons : (Array.isArray(item?.seasons) ? item.seasons.length : null);\r\n    if(Number.isFinite(seasonCount) && seasonCount > 0){\r\n      general.push(['Staffeln', String(seasonCount)]);\r\n    }\r\n    const episodeCount = Array.isArray(item?.seasons) ? item.seasons.reduce((sum, season)=>{\r\n      if(!season) return sum;\r\n      const eps = Array.isArray(season.episodes) ? season.episodes.length : 0;\r\n      return sum + (Number.isFinite(eps) ? eps : 0);\r\n    }, 0) : null;\r\n    if(Number.isFinite(episodeCount) && episodeCount > 0){\r\n      general.push(['Episoden', String(episodeCount)]);\r\n    }\r\n  }\r\n\r\n  const countries = mergeNameLists(\r\n    namesFromList(item?.countries),\r\n    Array.isArray(item?.tmdbDetail?.productionCountries) ? item.tmdbDetail.productionCountries : []\r\n  );\r\n  if(countries.length) general.push(['L\u00E4nder', countries.join(', ')]);\r\n  const collections = mergeNameLists(\r\n    namesFromList(item?.collections),\r\n    item?.tmdbDetail?.collection?.name ? [item.tmdbDetail.collection.name] : []\r\n  );\r\n  if(collections.length) general.push(['Sammlungen', collections.join(', ')]);\r\n  const labels = namesFromList(item?.labels);\r\n  if(labels.length) general.push(['Labels', labels.join(', ')]);\r\n  if(item?.editionTitle) general.push(['Edition', item.editionTitle]);\r\n  if(item?.originalTitle && item.originalTitle !== item.title) general.push(['Originaltitel', item.originalTitle]);\r\n\r\n  if(general.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'general';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Allgemein';\r\n    const list = document.createElement('dl');\r\n    list.className = 'v2-details-list';\r\n    general.forEach(([label, value])=>{\r\n      if(!label || !value) return;\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      list.append(dt, dd);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  const genres = genresFromItem(item);\r\n  if(genres.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'genres';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Genres';\r\n    const chips = document.createElement('div');\r\n    chips.className = 'v2-chip-group';\r\n    genres.forEach(name=>{\r\n      const span = document.createElement('span');\r\n      span.className = 'chip';\r\n      span.textContent = name;\r\n      chips.appendChild(span);\r\n    });\r\n    section.append(heading, chips);\r\n    grid.append(section);\r\n  }\r\n\r\n  const crew = [];\r\n  const directors = mergeNameLists(\r\n    namesFromList(item?.directors),\r\n    tmdbCrew(item?.tmdbDetail, ['Director'])\r\n  );\r\n  if(directors.length) crew.push(['Regie', directors.join(', ')]);\r\n  const writers = mergeNameLists(\r\n    namesFromList(item?.writers),\r\n    tmdbCrew(item?.tmdbDetail, ['Writer', 'Screenplay', 'Story'])\r\n  );\r\n  if(writers.length) crew.push(['Drehbuch', writers.join(', ')]);\r\n  const producers = mergeNameLists(\r\n    namesFromList(item?.producers),\r\n    tmdbCrew(item?.tmdbDetail, ['Producer', 'Executive Producer'])\r\n  );\r\n  if(producers.length) crew.push(['Produktion', producers.join(', ')]);\r\n  const creators = mergeNameLists(\r\n    namesFromList(item?.creators || item?.showrunners),\r\n    Array.isArray(item?.tmdbDetail?.createdBy) ? item.tmdbDetail.createdBy.map(entry => entry?.name || '') : []\r\n  );\r\n  if(item?.type === 'tv' && creators.length) crew.push(['Creator', creators.join(', ')]);\r\n\r\n  if(crew.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'crew';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Credits';\r\n    const list = document.createElement('dl');\r\n    list.className = 'v2-details-list';\r\n    crew.forEach(([label, value])=>{\r\n      if(!label || !value) return;\r\n      const dt = document.createElement('dt');\r\n      dt.textContent = label;\r\n      const dd = document.createElement('dd');\r\n      dd.textContent = value;\r\n      list.append(dt, dd);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  const providers = watchProviderGroups(item);\r\n  if(providers.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'providers';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Verf\u00FCgbarkeit';\r\n    const groupsWrap = document.createElement('div');\r\n    groupsWrap.className = 'v2-provider-groups';\r\n    providers.forEach(group => {\r\n      const groupEl = document.createElement('div');\r\n      groupEl.className = 'v2-provider-group';\r\n      const labelEl = document.createElement('p');\r\n      labelEl.className = 'v2-provider-label';\r\n      labelEl.textContent = group.label;\r\n      const listEl = document.createElement('div');\r\n      listEl.className = 'v2-provider-list';\r\n      group.providers.forEach(provider => {\r\n        const itemEl = document.createElement('span');\r\n        itemEl.className = 'v2-provider';\r\n        itemEl.setAttribute('data-provider', provider.id || provider.name);\r\n        if(provider.logo){\r\n          const logo = document.createElement('img');\r\n          logo.src = provider.logo;\r\n          logo.alt = provider.name;\r\n          logo.loading = 'lazy';\r\n          logo.decoding = 'async';\r\n          itemEl.appendChild(logo);\r\n        }\r\n        const name = document.createElement('span');\r\n        name.className = 'v2-provider-name';\r\n        name.textContent = provider.name;\r\n        itemEl.appendChild(name);\r\n        listEl.appendChild(itemEl);\r\n      });\r\n      groupEl.append(labelEl, listEl);\r\n      groupsWrap.appendChild(groupEl);\r\n    });\r\n    section.append(heading, groupsWrap);\r\n    grid.append(section);\r\n  }\r\n\r\n  const networks = Array.isArray(item?.tmdbDetail?.networks)\r\n    ? item.tmdbDetail.networks.map(entry => ({\r\n      name: String(entry?.name || '').trim(),\r\n      logo: String(entry?.logo || entry?.logoPath || entry?.logo_path || '').trim(),\r\n    })).filter(entry => entry.name || entry.logo)\r\n    : [];\r\n  if(networks.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'networks';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Netzwerke';\r\n    const list = document.createElement('div');\r\n    list.className = 'v2-chip-group network-chip-group';\r\n    networks.forEach(network => {\r\n      const chip = document.createElement('span');\r\n      chip.className = 'network-chip';\r\n      const label = network.name || 'Unbekanntes Netzwerk';\r\n      if(network.logo){\r\n        const img = document.createElement('img');\r\n        img.src = network.logo;\r\n        img.alt = label;\r\n        img.loading = 'lazy';\r\n        img.decoding = 'async';\r\n        chip.appendChild(img);\r\n      }\r\n      const name = document.createElement('span');\r\n      name.textContent = label;\r\n      chip.appendChild(name);\r\n      chip.title = label;\r\n      list.appendChild(chip);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  const spokenLanguages = Array.isArray(item?.tmdbDetail?.spokenLanguages)\r\n    ? item.tmdbDetail.spokenLanguages.map(entry => ({\r\n      code: String(entry?.code || entry?.iso6391 || '').trim(),\r\n      name: String(entry?.name || '').trim(),\r\n    })).filter(entry => entry.name || entry.code)\r\n    : [];\r\n  if(spokenLanguages.length){\r\n    const section = document.createElement('section');\r\n    section.className = 'v2-details-section';\r\n    section.dataset.section = 'languages';\r\n    const heading = document.createElement('h3');\r\n    heading.className = 'v2-details-heading';\r\n    heading.textContent = 'Sprachen';\r\n    const list = document.createElement('div');\r\n    list.className = 'v2-chip-group network-chip-group';\r\n    spokenLanguages.forEach(lang => {\r\n      const chip = document.createElement('span');\r\n      chip.className = 'network-chip';\r\n      const labelParts = [];\r\n      if(lang.name) labelParts.push(lang.name);\r\n      const upperCode = lang.code ? lang.code.toUpperCase() : '';\r\n      if(upperCode && (!lang.name || upperCode !== lang.name.toUpperCase())){\r\n        labelParts.push(upperCode);\r\n      }\r\n      const label = labelParts.join(' \u2022 ') || 'Unbekannte Sprache';\r\n      chip.textContent = label;\r\n      chip.title = label;\r\n      list.appendChild(chip);\r\n    });\r\n    if(list.childElementCount){\r\n      section.append(heading, list);\r\n      grid.append(section);\r\n    }\r\n  }\r\n\r\n  if(grid.childElementCount){\r\n    pane.appendChild(grid);\r\n  }else{\r\n    const fallback = document.createElement('p');\r\n    fallback.className = 'v2-details-empty';\r\n    fallback.textContent = 'Keine zus\u00E4tzlichen Details verf\u00FCgbar.';\r\n    pane.appendChild(fallback);\r\n  }\r\n}\r\n", "const DEFAULT_TTL_HOURS = 24;\r\nconst STORAGE_KEY = 'tmdb.metadata.cache.v1';\r\nconst LOG_PREFIX = '[cacheStore]';\r\n\r\nfunction now(){\r\n  return Date.now();\r\n}\r\n\r\nfunction hoursToMs(hours){\r\n  const num = Number(hours);\r\n  const h = Number.isFinite(num) ? num : DEFAULT_TTL_HOURS;\r\n  return Math.max(0.01, h) * 60 * 60 * 1000;\r\n}\r\n\r\nfunction safeParse(raw){\r\n  try{\r\n    return JSON.parse(raw);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to parse persisted cache payload:`, err);\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction safeStringify(payload){\r\n  try{\r\n    return JSON.stringify(payload);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to serialise cache payload:`, err);\r\n    return '[]';\r\n  }\r\n}\r\n\r\nfunction createStore({ storageKey = STORAGE_KEY } = {}){\r\n  let memory = new Map();\r\n  let loaded = false;\r\n\r\n  function load(){\r\n    if(loaded) return;\r\n    loaded = true;\r\n    if(typeof localStorage === 'undefined') return;\r\n    let raw;\r\n    try{\r\n      raw = localStorage.getItem(storageKey);\r\n      if(!raw){\r\n        memory = new Map();\r\n        return;\r\n      }\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Failed to read persisted cache:`, err);\r\n      memory = new Map();\r\n      return;\r\n    }\r\n    const parsed = safeParse(raw);\r\n    const next = new Map();\r\n    const nowTs = now();\r\n    if(Array.isArray(parsed)){\r\n      for(const entry of parsed){\r\n        if(!Array.isArray(entry) || entry.length < 2) continue;\r\n        const [key, payload] = entry;\r\n        if(!key || !payload) continue;\r\n        const expiresAt = Number(payload.expiresAt);\r\n        if(Number.isFinite(expiresAt) && expiresAt > nowTs){\r\n          next.set(String(key), { value: payload.value, expiresAt });\r\n        }\r\n      }\r\n    }\r\n    memory = next;\r\n  }\r\n\r\n  function persist(){\r\n    if(typeof localStorage === 'undefined') return;\r\n    const serialisable = Array.from(memory.entries()).map(([key, entry])=>[\r\n      key,\r\n      { value: entry.value, expiresAt: entry.expiresAt }\r\n    ]);\r\n    try{\r\n      localStorage.setItem(storageKey, safeStringify(serialisable));\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Failed to persist cache:`, err);\r\n    }\r\n  }\r\n\r\n  function get(key){\r\n    if(!key) return null;\r\n    load();\r\n    const entry = memory.get(String(key));\r\n    if(!entry) return null;\r\n    if(Number.isFinite(entry.expiresAt) && entry.expiresAt <= now()){\r\n      memory.delete(String(key));\r\n      persist();\r\n      return null;\r\n    }\r\n    return entry.value;\r\n  }\r\n\r\n  function set(key, value, ttlHours = DEFAULT_TTL_HOURS){\r\n    if(!key) return value;\r\n    load();\r\n    const expiresAt = now() + hoursToMs(ttlHours);\r\n    memory.set(String(key), { value, expiresAt });\r\n    persist();\r\n    return value;\r\n  }\r\n\r\n  function clear(prefix){\r\n    load();\r\n    if(!prefix){\r\n      memory.clear();\r\n      persist();\r\n      return;\r\n    }\r\n    const target = String(prefix);\r\n    let changed = false;\r\n    for(const key of memory.keys()){\r\n      if(key.startsWith(target)){\r\n        memory.delete(key);\r\n        changed = true;\r\n      }\r\n    }\r\n    if(changed) persist();\r\n  }\r\n\r\n  function clearExpired(){\r\n    load();\r\n    const nowTs = now();\r\n    let changed = false;\r\n    for(const [key, entry] of memory.entries()){\r\n      if(Number.isFinite(entry.expiresAt) && entry.expiresAt <= nowTs){\r\n        memory.delete(key);\r\n        changed = true;\r\n      }\r\n    }\r\n    if(changed) persist();\r\n    return changed;\r\n  }\r\n\r\n  function size(){\r\n    load();\r\n    return memory.size;\r\n  }\r\n\r\n  return { get, set, clear, clearExpired, size };\r\n}\r\n\r\nconst defaultStore = createStore();\r\n\r\nexport function get(key){\r\n  return defaultStore.get(key);\r\n}\r\n\r\nexport function set(key, value, ttlHours){\r\n  return defaultStore.set(key, value, ttlHours);\r\n}\r\n\r\nexport function clear(prefix){\r\n  return defaultStore.clear(prefix);\r\n}\r\n\r\nexport function clearExpired(){\r\n  return defaultStore.clearExpired();\r\n}\r\n\r\nexport function size(){\r\n  return defaultStore.size();\r\n}\r\n\r\nexport function createCacheStore(options){\r\n  return createStore(options);\r\n}\r\n\r\nexport default {\r\n  get,\r\n  set,\r\n  clear,\r\n  clearExpired,\r\n  size,\r\n  createCacheStore,\r\n};\r\n", "import { createCacheStore } from './cacheStore.js';\r\n\r\nconst DEFAULT_API_BASE = 'https://api.themoviedb.org/3';\r\nconst DEFAULT_LANGUAGE = 'de-DE';\r\nconst DEFAULT_REGION = 'DE';\r\nconst LOG_PREFIX = '[tmdbClient]';\r\nconst MAX_RETRIES = 4;\r\nconst BASE_DELAY = 500;\r\nconst DELAY_CAP = 10_000;\r\n\r\nfunction delay(ms){\r\n  return new Promise(resolve => setTimeout(resolve, Math.max(0, ms || 0)));\r\n}\r\n\r\nfunction parseRetryAfter(value){\r\n  if(!value) return null;\r\n  const num = Number(value);\r\n  if(Number.isFinite(num)) return num * 1000;\r\n  const date = Date.parse(value);\r\n  if(Number.isFinite(date)) return Math.max(0, date - Date.now());\r\n  return null;\r\n}\r\n\r\nfunction computeRetryDelay(attempt, retryAfter){\r\n  if(Number.isFinite(retryAfter) && retryAfter > 0) return Math.min(retryAfter, DELAY_CAP);\r\n  const factor = Math.pow(2, Math.max(0, attempt));\r\n  return Math.min(DELAY_CAP, BASE_DELAY * factor);\r\n}\r\n\r\nfunction normaliseAppend(append){\r\n  if(!append) return '';\r\n  if(Array.isArray(append)) return append.filter(Boolean).join(',');\r\n  if(typeof append === 'string') return append.split(',').map(str => str.trim()).filter(Boolean).join(',');\r\n  return '';\r\n}\r\n\r\nfunction resolveCredential(options = {}){\r\n  const preferred = [\r\n    options.token,\r\n    options.tmdbToken,\r\n    options?.credentials?.token,\r\n    options?.settings?.tmdbToken,\r\n  ].find(value => typeof value === 'string' && value.trim());\r\n  if(preferred){\r\n    return { kind: 'bearer', value: preferred.trim() };\r\n  }\r\n\r\n  const key = [\r\n    options.apiKey,\r\n    options.tmdbApiKey,\r\n    options?.credentials?.apiKey,\r\n    options?.settings?.tmdbApiKey,\r\n  ].find(value => typeof value === 'string' && value.trim());\r\n  if(key){\r\n    return { kind: 'apikey', value: key.trim() };\r\n  }\r\n\r\n  if(typeof localStorage !== 'undefined'){\r\n    try{\r\n      const token = localStorage.getItem('tmdbToken');\r\n      if(token && token.trim()) return { kind: 'bearer', value: token.trim() };\r\n    }catch(err){\r\n      console.warn(`${LOG_PREFIX} Unable to read tmdbToken from storage:`, err);\r\n    }\r\n  }\r\n\r\n  return { kind: 'none', value: '' };\r\n}\r\n\r\nfunction createRequestInit(credential){\r\n  const headers = { Accept: 'application/json;charset=utf-8' };\r\n  if(credential?.kind === 'bearer' && credential.value){\r\n    headers.Authorization = `Bearer ${credential.value}`;\r\n  }\r\n  return { headers };\r\n}\r\n\r\nfunction applyCredentialToUrl(url, credential){\r\n  if(credential?.kind !== 'apikey' || !credential.value) return url;\r\n  const u = new URL(url);\r\n  u.searchParams.set('api_key', credential.value);\r\n  return u.toString();\r\n}\r\n\r\nfunction buildUrl(path, params, config){\r\n  const base = String(config.apiBase || DEFAULT_API_BASE).replace(/\\/$/, '');\r\n  const cleanPath = path.startsWith('/') ? path : `/${path}`;\r\n  const url = new URL(`${base}${cleanPath}`);\r\n  const search = url.searchParams;\r\n\r\n  const append = normaliseAppend(params.append_to_response);\r\n  if(append){\r\n    search.set('append_to_response', append);\r\n  }\r\n\r\n  const language = params.language || config.language || DEFAULT_LANGUAGE;\r\n  if(language) search.set('language', language);\r\n\r\n  const region = params.region || config.region || DEFAULT_REGION;\r\n  if(region) search.set('region', region);\r\n\r\n  for(const [key, value] of Object.entries(params)){\r\n    if(value === undefined || value === null) continue;\r\n    if(key === 'append_to_response' || key === 'language' || key === 'region') continue;\r\n    if(Array.isArray(value)){\r\n      if(value.length) search.set(key, value.join(','));\r\n      continue;\r\n    }\r\n    search.set(key, String(value));\r\n  }\r\n\r\n  return url.toString();\r\n}\r\n\r\nasync function fetchJson(url, init, { retries = MAX_RETRIES } = {}){\r\n  let attempt = 0;\r\n  let lastError = null;\r\n  while(attempt <= retries){\r\n    try{\r\n      const response = await fetch(url, init);\r\n      if(response.status === 204) return null;\r\n      if(response.status === 429 && attempt < retries){\r\n        const retryAfter = parseRetryAfter(response.headers.get('Retry-After'));\r\n        await delay(computeRetryDelay(attempt, retryAfter));\r\n        attempt += 1;\r\n        continue;\r\n      }\r\n      if(!response.ok){\r\n        const error = new Error(`TMDB request failed with status ${response.status}`);\r\n        error.status = response.status;\r\n        error.url = url;\r\n        try{\r\n          error.body = await response.text();\r\n        }catch(_err){\r\n          error.body = null;\r\n        }\r\n        throw error;\r\n      }\r\n      const data = await response.json();\r\n      return data;\r\n    }catch(err){\r\n      lastError = err;\r\n      if(attempt >= retries){\r\n        break;\r\n      }\r\n      await delay(computeRetryDelay(attempt, null));\r\n      attempt += 1;\r\n    }\r\n  }\r\n  throw lastError || new Error('TMDB request failed');\r\n}\r\n\r\n/**\r\n * Creates a TMDB API client with caching and retry logic\r\n * @param {Object} [options] - Configuration options\r\n * @param {string} [options.apiBase] - TMDB API base URL\r\n * @param {string} [options.language] - Default language (e.g., 'de-DE')\r\n * @param {string} [options.region] - Default region (e.g., 'DE')\r\n * @param {string} [options.token] - TMDB v4 Bearer token\r\n * @param {string} [options.apiKey] - TMDB v3 API key\r\n * @param {number} [options.ttlHours] - Cache TTL in hours\r\n * @param {boolean} [options.useCache] - Enable caching\r\n * @param {Object} [options.cacheStore] - Custom cache store instance\r\n * @returns {Object} TMDB client with get method\r\n */\r\nexport function createTmdbClient(options = {}){\r\n  const cache = options.cache instanceof Map ? options.cache : null;\r\n  const config = {\r\n    apiBase: options.apiBase || DEFAULT_API_BASE,\r\n    language: options.language || DEFAULT_LANGUAGE,\r\n    region: options.region || DEFAULT_REGION,\r\n    ttlHours: options.ttlHours || options.ttl || 0,\r\n  };\r\n  const credential = resolveCredential(options);\r\n  const store = options.cacheStore || (options.useCache ? createCacheStore() : null);\r\n\r\n  function getCacheKey(method, params){\r\n    if(!cache && !store) return '';\r\n    const sorted = Object.keys(params).sort().map(key => `${key}=${JSON.stringify(params[key])}`).join('&');\r\n    return `${method}?${sorted}`;\r\n  }\r\n\r\n  async function get(path, params = {}, opts = {}){\r\n    const requestParams = { ...params };\r\n    if(opts.append){\r\n      const baseAppend = normaliseAppend(requestParams.append_to_response);\r\n      const nextAppend = normaliseAppend(opts.append);\r\n      const combined = [baseAppend, nextAppend].filter(Boolean).join(',');\r\n      if(combined){\r\n        requestParams.append_to_response = combined;\r\n      }\r\n    }\r\n    if(opts.language) requestParams.language = opts.language;\r\n    if(opts.region) requestParams.region = opts.region;\r\n    const url = buildUrl(path, requestParams, config);\r\n    const authedUrl = applyCredentialToUrl(url, credential);\r\n    const init = createRequestInit(credential);\r\n    const cacheKey = getCacheKey(path, requestParams);\r\n    if(cacheKey){\r\n      if(cache && cache.has(cacheKey)) return cache.get(cacheKey);\r\n      if(store){\r\n        const cached = store.get(cacheKey);\r\n        if(cached) return cached;\r\n      }\r\n    }\r\n    const data = await fetchJson(authedUrl, init, { retries: opts.retries ?? MAX_RETRIES });\r\n    if(cacheKey){\r\n      if(cache) cache.set(cacheKey, data);\r\n      if(store){\r\n        try{\r\n          store.set(cacheKey, data, options.ttlHours || 0);\r\n        }catch(err){\r\n          console.warn(`${LOG_PREFIX} Failed to persist response cache:`, err);\r\n        }\r\n      }\r\n    }\r\n    return data;\r\n  }\r\n\r\n  return {\r\n    get,\r\n    get credential(){ return credential; },\r\n    get config(){ return { ...config }; },\r\n  };\r\n}\r\n\r\nconst defaultClient = createTmdbClient();\r\n\r\nexport async function get(path, params){\r\n  return defaultClient.get(path, params);\r\n}\r\n\r\nexport default defaultClient;\r\n", "const DEFAULT_IMAGE_BASE = 'https://image.tmdb.org/t/p';\r\nconst DEFAULT_SIZES = {\r\n  poster: 'w500',\r\n  backdrop: 'w780',\r\n  profile: 'h632',\r\n  logo: 'w500',\r\n  episode: 'w780',\r\n};\r\n\r\nfunction normaliseBase(base){\r\n  const raw = String(base || DEFAULT_IMAGE_BASE).trim();\r\n  if(!raw) return DEFAULT_IMAGE_BASE;\r\n  return raw.replace(/\\/$/, '');\r\n}\r\n\r\nfunction ensurePath(path){\r\n  if(!path) return '';\r\n  const str = String(path);\r\n  if(!str) return '';\r\n  return str.startsWith('/') ? str : `/${str}`;\r\n}\r\n\r\nfunction buildUrl(path, size, base){\r\n  const cleaned = ensurePath(path);\r\n  if(!cleaned) return '';\r\n  const root = normaliseBase(base);\r\n  return `${root}/${size}${cleaned}`;\r\n}\r\n\r\nfunction encodeSvg(svg){\r\n  return `data:image/svg+xml,${encodeURIComponent(svg)}`;\r\n}\r\n\r\nfunction pickBackground(type){\r\n  switch(type){\r\n    case 'poster':\r\n      return '#1f2933';\r\n    case 'profile':\r\n      return '#111827';\r\n    case 'logo':\r\n      return '#0f172a';\r\n    case 'episode':\r\n      return '#0b1120';\r\n    default:\r\n      return '#101827';\r\n  }\r\n}\r\n\r\nfunction pickForeground(type){\r\n  return type === 'logo' ? '#e5e7eb' : '#f9fafb';\r\n}\r\n\r\nexport function makeInitials(text, limit = 2){\r\n  const str = String(text || '').trim();\r\n  if(!str){\r\n    return '';\r\n  }\r\n  const parts = str.split(/\\s+/u).filter(Boolean);\r\n  if(!parts.length){\r\n    return str.slice(0, limit).toUpperCase();\r\n  }\r\n  const selected = parts.slice(0, limit).map(part => part.charAt(0));\r\n  return selected.join('').toUpperCase();\r\n}\r\n\r\nfunction fallbackSvg({\r\n  type,\r\n  text = '',\r\n  width,\r\n  height,\r\n  fontSize,\r\n  fontWeight = '600',\r\n  radius = 0,\r\n}){\r\n  const background = pickBackground(type);\r\n  const foreground = pickForeground(type);\r\n  const content = makeInitials(text, 2) || '\u2205';\r\n  const svg = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\\n  <rect x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\" rx=\"${radius}\" ry=\"${radius}\" fill=\"${background}\"/>\\n  <text x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\" fill=\"${foreground}\" font-family=\"'Inter', 'Segoe UI', sans-serif\" font-size=\"${fontSize}\" font-weight=\"${fontWeight}\" letter-spacing=\"0.08em\">${content}</text>\\n</svg>`;\r\n  return encodeSvg(svg);\r\n}\r\n\r\nfunction fallbackPoster(title){\r\n  return fallbackSvg({ type: 'poster', text: title, width: 500, height: 750, fontSize: 140, radius: 24 });\r\n}\r\n\r\nfunction fallbackBackdrop(title){\r\n  return fallbackSvg({ type: 'backdrop', text: title, width: 780, height: 439, fontSize: 120, radius: 16 });\r\n}\r\n\r\nfunction fallbackProfile(name){\r\n  return fallbackSvg({ type: 'profile', text: name, width: 400, height: 600, fontSize: 140, radius: 32 });\r\n}\r\n\r\nfunction fallbackLogo(title){\r\n  return fallbackSvg({ type: 'logo', text: title, width: 500, height: 281, fontSize: 96, radius: 24 });\r\n}\r\n\r\nfunction fallbackEpisode(title){\r\n  return fallbackSvg({ type: 'episode', text: title, width: 780, height: 439, fontSize: 110, radius: 24 });\r\n}\r\n\r\nfunction normaliseOptions(options){\r\n  return {\r\n    imageBase: options?.imageBase ?? options?.base ?? DEFAULT_IMAGE_BASE,\r\n    title: options?.title ?? options?.fallbackTitle ?? '',\r\n    size: options?.size,\r\n  };\r\n}\r\n\r\nexport function urlPoster(path, options = {}){\r\n  const { imageBase, title, size } = normaliseOptions(options);\r\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.poster, imageBase);\r\n  return candidate || fallbackPoster(title);\r\n}\r\n\r\nexport function urlBackdrop(path, options = {}){\r\n  const { imageBase, title, size } = normaliseOptions(options);\r\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.backdrop, imageBase);\r\n  return candidate || fallbackBackdrop(title);\r\n}\r\n\r\nexport function urlProfile(path, options = {}){\r\n  const { imageBase, title, size } = normaliseOptions(options);\r\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.profile, imageBase);\r\n  return candidate || fallbackProfile(title);\r\n}\r\n\r\nexport function urlLogo(path, options = {}){\r\n  const { imageBase, title, size } = normaliseOptions(options);\r\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.logo, imageBase);\r\n  return candidate || fallbackLogo(title);\r\n}\r\n\r\nexport function urlEpisode(path, options = {}){\r\n  const { imageBase, title, size } = normaliseOptions(options);\r\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.episode, imageBase);\r\n  return candidate || fallbackEpisode(title);\r\n}\r\n\r\nexport function buildFallbackPoster(title){\r\n  return fallbackPoster(title);\r\n}\r\n\r\nexport function buildFallbackBackdrop(title){\r\n  return fallbackBackdrop(title);\r\n}\r\n\r\nexport function buildFallbackProfile(name){\r\n  return fallbackProfile(name);\r\n}\r\n\r\nexport function buildFallbackLogo(title){\r\n  return fallbackLogo(title);\r\n}\r\n\r\nexport function buildFallbackEpisode(title){\r\n  return fallbackEpisode(title);\r\n}\r\n\r\nexport default {\r\n  urlPoster,\r\n  urlBackdrop,\r\n  urlProfile,\r\n  urlLogo,\r\n  urlEpisode,\r\n  makeInitials,\r\n  buildFallbackPoster,\r\n  buildFallbackBackdrop,\r\n  buildFallbackProfile,\r\n  buildFallbackLogo,\r\n  buildFallbackEpisode,\r\n};\r\n", "import {\r\n  urlPoster,\r\n  urlBackdrop,\r\n  urlProfile,\r\n  urlLogo,\r\n  urlEpisode,\r\n  makeInitials,\r\n} from './imageHelper.js';\r\n\r\nconst DEFAULT_OPTIONS = {\r\n  imageBase: 'https://image.tmdb.org/t/p',\r\n  posterSize: 'w500',\r\n  backdropSize: 'w780',\r\n  profileSize: 'h632',\r\n  logoSize: 'w500',\r\n  stillSize: 'w780',\r\n  castLimit: 20,\r\n  crewLimit: 40,\r\n  region: 'DE',\r\n};\r\n\r\nfunction normaliseOptions(options = {}){\r\n  return {\r\n    ...DEFAULT_OPTIONS,\r\n    ...options,\r\n  };\r\n}\r\n\r\nfunction normaliseId(id){\r\n  if(id == null) return '';\r\n  const num = Number(id);\r\n  if(Number.isFinite(num) && num > 0) return String(Math.floor(num));\r\n  // Only accept valid numeric strings\r\n  const str = String(id).trim();\r\n  if(/^\\d+$/.test(str)){\r\n    const parsed = parseInt(str, 10);\r\n    if(parsed > 0) return String(parsed);\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction scoreImage(entry){\r\n  const votes = Number(entry.vote_count || entry.voteCount || 0);\r\n  const rating = Number(entry.vote_average || entry.voteAverage || 0);\r\n  return (rating * 10) + votes;\r\n}\r\n\r\nfunction normaliseLanguage(lang){\r\n  if(!lang) return 'any';\r\n  const str = String(lang).toLowerCase();\r\n  if(str === 'xx' || str === 'null') return 'any';\r\n  return str;\r\n}\r\n\r\nexport function pickBestImage(images = [], { preferredLanguages = ['de', 'en', 'any'], fallbackPath = '' } = {}){\r\n  if(!Array.isArray(images) || images.length === 0){\r\n    return fallbackPath || '';\r\n  }\r\n  const sorted = images\r\n    .filter(entry => entry && entry.file_path)\r\n    .map(entry => ({\r\n      ...entry,\r\n      language: normaliseLanguage(entry.iso_639_1 || entry.language || ''),\r\n      score: scoreImage(entry),\r\n    }))\r\n    .sort((a, b) => b.score - a.score);\r\n\r\n  for(const language of preferredLanguages){\r\n    const candidate = sorted.find(entry => entry.language === normaliseLanguage(language));\r\n    if(candidate) return candidate.file_path || fallbackPath || '';\r\n  }\r\n\r\n  return sorted.length ? sorted[0].file_path || fallbackPath || '' : fallbackPath || '';\r\n}\r\n\r\nfunction extractCollection(detail, options){\r\n  if(!detail?.belongs_to_collection) return null;\r\n  const collection = detail.belongs_to_collection;\r\n  return {\r\n    id: normaliseId(collection.id),\r\n    name: collection.name || '',\r\n    poster: urlPoster(collection.poster_path, { imageBase: options.imageBase, size: options.posterSize, title: collection.name }),\r\n    backdrop: urlBackdrop(collection.backdrop_path, { imageBase: options.imageBase, size: options.backdropSize, title: collection.name }),\r\n  };\r\n}\r\n\r\nfunction mapGenres(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry => entry && (entry.name || entry.title || entry.tag)).filter(Boolean).map(String);\r\n}\r\n\r\nfunction mapProductionCompanies(list, options){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(company => ({\r\n    id: normaliseId(company?.id),\r\n    name: company?.name || '',\r\n    originCountry: company?.origin_country || '',\r\n    logo: urlLogo(company?.logo_path, { imageBase: options.imageBase, size: options.logoSize, title: company?.name }),\r\n  }));\r\n}\r\n\r\nfunction mapProvider(entry, options){\r\n  if(!entry) return null;\r\n  const cfg = normaliseOptions(options);\r\n  const id = normaliseId(entry.provider_id ?? entry.id);\r\n  const name = entry.provider_name || entry.name || '';\r\n  if(!name) return null;\r\n  return {\r\n    id,\r\n    providerId: id,\r\n    name,\r\n    logoPath: entry.logo_path || '',\r\n    logo: urlLogo(entry.logo_path, { imageBase: cfg.imageBase, size: cfg.logoSize, title: name }),\r\n    displayPriority: entry.display_priority ?? entry.displayPriority ?? null,\r\n  };\r\n}\r\n\r\nfunction mapWatchProviderRegion(regionData, options){\r\n  if(!regionData) return null;\r\n  const cfg = normaliseOptions(options);\r\n  const types = ['flatrate', 'rent', 'buy', 'free', 'ads'];\r\n  const mapped = { link: regionData.link || '' };\r\n  for(const type of types){\r\n    const list = Array.isArray(regionData[type]) ? regionData[type] : [];\r\n    mapped[type] = list\r\n      .map(entry => mapProvider(entry, cfg))\r\n      .filter(Boolean);\r\n  }\r\n  return mapped;\r\n}\r\n\r\nfunction mapWatchProviders(payload, options = {}){\r\n  const cfg = normaliseOptions(options);\r\n  const results = payload?.results;\r\n  if(!results || typeof results !== 'object') return {};\r\n  const mapped = {};\r\n  for(const [region, data] of Object.entries(results)){\r\n    const regionKey = String(region || '').toUpperCase();\r\n    if(!regionKey) continue;\r\n    const mappedRegion = mapWatchProviderRegion(data, cfg);\r\n    if(mappedRegion) mapped[regionKey] = mappedRegion;\r\n  }\r\n  const defaultRegion = String(options.region || cfg.region || '').toUpperCase();\r\n  if(defaultRegion && mapped[defaultRegion]){\r\n    mapped.default = mapped[defaultRegion];\r\n  }\r\n  return mapped;\r\n}\r\n\r\nfunction mapNetworks(list, options){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(network => ({\r\n    id: normaliseId(network?.id),\r\n    name: network?.name || '',\r\n    logo: urlLogo(network?.logo_path, { imageBase: options.imageBase, size: options.logoSize, title: network?.name }),\r\n    originCountry: network?.origin_country || '',\r\n  }));\r\n}\r\n\r\nfunction mapSeasons(list, options){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(season => ({\r\n    id: normaliseId(season?.id),\r\n    name: season?.name || '',\r\n    seasonNumber: season?.season_number ?? null,\r\n    episodeCount: season?.episode_count ?? null,\r\n    airDate: season?.air_date || '',\r\n    poster: urlPoster(season?.poster_path, { imageBase: options.imageBase, size: options.posterSize, title: season?.name }),\r\n  }));\r\n}\r\n\r\nfunction mapSpokenLanguages(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry => ({\r\n    code: entry?.iso_639_1 || '',\r\n    name: entry?.english_name || entry?.name || '',\r\n  }));\r\n}\r\n\r\nfunction pickCharacter(entry){\r\n  if(entry?.character) return entry.character;\r\n  if(Array.isArray(entry?.roles) && entry.roles.length){\r\n    const role = entry.roles.find(r => r?.character) || entry.roles[0];\r\n    return role?.character || '';\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction pickJob(entry){\r\n  if(entry?.job) return entry.job;\r\n  if(Array.isArray(entry?.jobs) && entry.jobs.length){\r\n    const job = entry.jobs.find(j => j?.job) || entry.jobs[0];\r\n    return job?.job || '';\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function mapCredits(rawCredits, options = {}){\r\n  const cfg = normaliseOptions(options);\r\n  if(!rawCredits) return { cast: [], crew: [] };\r\n  const castSource = Array.isArray(rawCredits.cast) && rawCredits.cast.length\r\n    ? rawCredits.cast\r\n    : Array.isArray(rawCredits?.aggregate?.cast) ? rawCredits.aggregate.cast : [];\r\n  const crewSource = Array.isArray(rawCredits.crew) && rawCredits.crew.length\r\n    ? rawCredits.crew\r\n    : Array.isArray(rawCredits?.aggregate?.crew) ? rawCredits.aggregate.crew : [];\r\n\r\n  const cast = castSource.slice(0, cfg.castLimit).map(person => ({\r\n    id: normaliseId(person?.id),\r\n    name: person?.name || person?.original_name || '',\r\n    character: pickCharacter(person),\r\n    order: person?.order ?? 0,\r\n    profile: urlProfile(person?.profile_path, { imageBase: cfg.imageBase, size: cfg.profileSize, title: person?.name }),\r\n    initials: makeInitials(person?.name || person?.original_name || ''),\r\n    knownForDepartment: person?.known_for_department || '',\r\n  }));\r\n\r\n  const crew = crewSource.slice(0, cfg.crewLimit).map(person => ({\r\n    id: normaliseId(person?.id),\r\n    name: person?.name || person?.original_name || '',\r\n    job: pickJob(person),\r\n    department: person?.department || '',\r\n    profile: urlProfile(person?.profile_path, { imageBase: cfg.imageBase, size: cfg.profileSize, title: person?.name }),\r\n    initials: makeInitials(person?.name || person?.original_name || ''),\r\n  }));\r\n\r\n  return { cast, crew };\r\n}\r\n\r\nfunction selectReleaseCertification(results = []){\r\n  const priorityCountries = ['DE', 'AT', 'CH', 'US'];\r\n  for(const country of priorityCountries){\r\n    const entry = results.find(item => item?.iso_3166_1 === country);\r\n    if(!entry) continue;\r\n    const releases = Array.isArray(entry.release_dates) ? entry.release_dates : [];\r\n    const candidates = releases\r\n      .filter(release => release && typeof release.certification === 'string' && release.certification.trim())\r\n      .sort((a, b) => {\r\n        const typeA = a.type ?? 0;\r\n        const typeB = b.type ?? 0;\r\n        if(typeA !== typeB) return typeA - typeB;\r\n        const dateA = Date.parse(a.release_date || '') || 0;\r\n        const dateB = Date.parse(b.release_date || '') || 0;\r\n        return dateA - dateB;\r\n      });\r\n    if(candidates.length) return candidates[0].certification.trim();\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function getContentRatingDE(payload = {}){\r\n  if(payload.release_dates?.results){\r\n    const cert = selectReleaseCertification(payload.release_dates.results);\r\n    if(cert) return cert;\r\n  }\r\n  if(payload.content_ratings?.results){\r\n    const results = Array.isArray(payload.content_ratings.results) ? payload.content_ratings.results : [];\r\n    const german = results.find(entry => entry?.iso_3166_1 === 'DE' && entry?.rating);\r\n    if(german) return String(german.rating).trim();\r\n    const us = results.find(entry => entry?.iso_3166_1 === 'US' && entry?.rating);\r\n    if(us) return String(us.rating).trim();\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction buildImageCollection(images = [], mapper){\r\n  if(!Array.isArray(images)) return [];\r\n  return images\r\n    .filter(entry => entry && entry.file_path)\r\n    .map(mapper);\r\n}\r\n\r\nexport function mapMovieDetail(detail, options = {}){\r\n  if(!detail) return null;\r\n  const cfg = normaliseOptions(options);\r\n  const posterPath = pickBestImage(detail.images?.posters, { fallbackPath: detail.poster_path });\r\n  const backdropPath = pickBestImage(detail.images?.backdrops, { fallbackPath: detail.backdrop_path, preferredLanguages: ['de', 'en', 'any'] });\r\n\r\n  return {\r\n    type: 'movie',\r\n    id: normaliseId(detail.id),\r\n    title: detail.title || detail.original_title || '',\r\n    originalTitle: detail.original_title || '',\r\n    overview: detail.overview || '',\r\n    tagline: detail.tagline || '',\r\n    releaseDate: detail.release_date || '',\r\n    runtime: Number(detail.runtime) || null,\r\n    status: detail.status || '',\r\n    homepage: detail.homepage || '',\r\n    imdbId: detail.imdb_id || '',\r\n    collection: extractCollection(detail, cfg),\r\n    poster: urlPoster(posterPath, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.title }),\r\n    posterPath,\r\n    backdrop: urlBackdrop(backdropPath, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.title }),\r\n    backdropPath,\r\n    genres: mapGenres(detail.genres),\r\n    voteAverage: Number(detail.vote_average) || 0,\r\n    voteCount: Number(detail.vote_count) || 0,\r\n    popularity: Number(detail.popularity) || 0,\r\n    productionCountries: Array.isArray(detail.production_countries) ? detail.production_countries.map(entry => entry?.iso_3166_1 || entry?.name || '').filter(Boolean) : [],\r\n    productionCompanies: mapProductionCompanies(detail.production_companies, cfg),\r\n    spokenLanguages: mapSpokenLanguages(detail.spoken_languages),\r\n    contentRating: getContentRatingDE(detail),\r\n    credits: mapCredits(detail.credits, cfg),\r\n    images: {\r\n      posters: buildImageCollection(detail.images?.posters, entry => ({\r\n        path: entry.file_path,\r\n        url: urlPoster(entry.file_path, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.title }),\r\n        width: entry.width,\r\n        height: entry.height,\r\n        voteAverage: entry.vote_average,\r\n        voteCount: entry.vote_count,\r\n        language: entry.iso_639_1 || '',\r\n      })),\r\n      backdrops: buildImageCollection(detail.images?.backdrops, entry => ({\r\n        path: entry.file_path,\r\n        url: urlBackdrop(entry.file_path, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.title }),\r\n        width: entry.width,\r\n        height: entry.height,\r\n        voteAverage: entry.vote_average,\r\n        voteCount: entry.vote_count,\r\n        language: entry.iso_639_1 || '',\r\n      })),\r\n    },\r\n    watchProviders: mapWatchProviders(detail['watch/providers'], cfg),\r\n    url: detail.id ? `https://www.themoviedb.org/movie/${detail.id}` : '',\r\n    raw: detail,\r\n  };\r\n}\r\n\r\nexport function mapTvDetail(detail, options = {}){\r\n  if(!detail) return null;\r\n  const cfg = normaliseOptions(options);\r\n  const posterPath = pickBestImage(detail.images?.posters, { fallbackPath: detail.poster_path });\r\n  const backdropPath = pickBestImage(detail.images?.backdrops, { fallbackPath: detail.backdrop_path, preferredLanguages: ['de', 'en', 'any'] });\r\n\r\n  return {\r\n    type: 'tv',\r\n    id: normaliseId(detail.id),\r\n    name: detail.name || detail.original_name || '',\r\n    originalName: detail.original_name || '',\r\n    overview: detail.overview || '',\r\n    tagline: detail.tagline || '',\r\n    firstAirDate: detail.first_air_date || '',\r\n    lastAirDate: detail.last_air_date || '',\r\n    numberOfEpisodes: Number(detail.number_of_episodes) || 0,\r\n    numberOfSeasons: Number(detail.number_of_seasons) || 0,\r\n    status: detail.status || '',\r\n    homepage: detail.homepage || '',\r\n    inProduction: !!detail.in_production,\r\n    poster: urlPoster(posterPath, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.name }),\r\n    posterPath,\r\n    backdrop: urlBackdrop(backdropPath, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.name }),\r\n    backdropPath,\r\n    genres: mapGenres(detail.genres),\r\n    voteAverage: Number(detail.vote_average) || 0,\r\n    voteCount: Number(detail.vote_count) || 0,\r\n    popularity: Number(detail.popularity) || 0,\r\n    createdBy: Array.isArray(detail.created_by) ? detail.created_by.map(person => ({\r\n      id: normaliseId(person?.id),\r\n      name: person?.name || '',\r\n      profile: urlProfile(person?.profile_path, { imageBase: cfg.imageBase, size: cfg.profileSize, title: person?.name }),\r\n      initials: makeInitials(person?.name || ''),\r\n    })) : [],\r\n    networks: mapNetworks(detail.networks, cfg),\r\n    productionCompanies: mapProductionCompanies(detail.production_companies, cfg),\r\n    seasons: mapSeasons(detail.seasons, cfg),\r\n    contentRating: getContentRatingDE(detail),\r\n    credits: mapCredits(detail.aggregate_credits || detail.credits, cfg),\r\n    images: {\r\n      posters: buildImageCollection(detail.images?.posters, entry => ({\r\n        path: entry.file_path,\r\n        url: urlPoster(entry.file_path, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.name }),\r\n        width: entry.width,\r\n        height: entry.height,\r\n        voteAverage: entry.vote_average,\r\n        voteCount: entry.vote_count,\r\n        language: entry.iso_639_1 || '',\r\n      })),\r\n      backdrops: buildImageCollection(detail.images?.backdrops, entry => ({\r\n        path: entry.file_path,\r\n        url: urlBackdrop(entry.file_path, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.name }),\r\n        width: entry.width,\r\n        height: entry.height,\r\n        voteAverage: entry.vote_average,\r\n        voteCount: entry.vote_count,\r\n        language: entry.iso_639_1 || '',\r\n      })),\r\n      logos: buildImageCollection(detail.images?.logos, entry => ({\r\n        path: entry.file_path,\r\n        url: urlLogo(entry.file_path, { imageBase: cfg.imageBase, size: cfg.logoSize, title: detail.name }),\r\n        width: entry.width,\r\n        height: entry.height,\r\n        language: entry.iso_639_1 || '',\r\n      })),\r\n    },\r\n    watchProviders: mapWatchProviders(detail['watch/providers'], cfg),\r\n    url: detail.id ? `https://www.themoviedb.org/tv/${detail.id}` : '',\r\n    raw: detail,\r\n  };\r\n}\r\n\r\nexport function mapSeasonDetail(seasonDetail, options = {}){\r\n  if(!seasonDetail) return null;\r\n  const cfg = normaliseOptions(options);\r\n  const show = options.show || {};\r\n  const posterPath = pickBestImage(seasonDetail.images?.posters, { fallbackPath: seasonDetail.poster_path });\r\n\r\n  const episodes = Array.isArray(seasonDetail.episodes) ? seasonDetail.episodes.map(episode => {\r\n    const stillPath = pickBestImage(episode?.images?.stills, { fallbackPath: episode?.still_path });\r\n    return {\r\n      id: normaliseId(episode?.id),\r\n      episodeNumber: episode?.episode_number ?? null,\r\n      seasonNumber: episode?.season_number ?? seasonDetail.season_number ?? null,\r\n      name: episode?.name || '',\r\n      overview: episode?.overview || '',\r\n      airDate: episode?.air_date || '',\r\n      runtime: Number(episode?.runtime) || null,\r\n      voteAverage: Number(episode?.vote_average) || 0,\r\n      voteCount: Number(episode?.vote_count) || 0,\r\n      still: urlEpisode(stillPath, { imageBase: cfg.imageBase, size: cfg.stillSize, title: episode?.name || seasonDetail.name }),\r\n      stillPath,\r\n      crew: mapCredits({ crew: episode?.crew || [] }, cfg).crew,\r\n      guestStars: mapCredits({ cast: episode?.guest_stars || [] }, { ...cfg, castLimit: 10 }).cast,\r\n    };\r\n  }) : [];\r\n\r\n  return {\r\n    type: 'season',\r\n    id: normaliseId(seasonDetail.id),\r\n    showId: normaliseId(show.id || seasonDetail.show_id || ''),\r\n    name: seasonDetail.name || '',\r\n    overview: seasonDetail.overview || '',\r\n    airDate: seasonDetail.air_date || '',\r\n    seasonNumber: seasonDetail.season_number ?? null,\r\n    episodeCount: seasonDetail.episodes ? seasonDetail.episodes.length : seasonDetail.episode_count || 0,\r\n    poster: urlPoster(posterPath, { imageBase: cfg.imageBase, size: cfg.posterSize, title: seasonDetail.name || show.name }),\r\n    posterPath,\r\n    episodes,\r\n    credits: mapCredits(seasonDetail.credits, cfg),\r\n    url: show.id ? `https://www.themoviedb.org/tv/${show.id}/season/${seasonDetail.season_number ?? ''}` : '',\r\n    raw: seasonDetail,\r\n  };\r\n}\r\n\r\nexport default {\r\n  mapMovieDetail,\r\n  mapTvDetail,\r\n  mapSeasonDetail,\r\n  mapCredits,\r\n  pickBestImage,\r\n  getContentRatingDE,\r\n};\r\n", "import { createCacheStore } from './cacheStore.js';\r\nimport { createTmdbClient } from './tmdbClient.js';\r\nimport {\r\n  mapMovieDetail,\r\n  mapTvDetail,\r\n  mapSeasonDetail,\r\n} from './tmdbMapper.js';\r\n\r\nconst LOG_PREFIX = '[metadataService]';\r\nconst DEFAULT_TTL_HOURS = 24;\r\nconst DEFAULT_IMAGE_BASE = 'https://image.tmdb.org/t/p';\r\n\r\nfunction normaliseConfig(input = {}){\r\n  return {\r\n    apiKey: input.apiKey || input.tmdbApiKey || '',\r\n    token: input.token || input.tmdbToken || '',\r\n    language: input.language || input.lang || 'de-DE',\r\n    region: input.region || input.iso || 'DE',\r\n    imageBase: input.imageBase || DEFAULT_IMAGE_BASE,\r\n    ttlHours: Number(input.ttlHours || input.ttl || DEFAULT_TTL_HOURS) || DEFAULT_TTL_HOURS,\r\n  };\r\n}\r\n\r\nfunction createLogger(){\r\n  return {\r\n    warn(...args){\r\n      try {\r\n        console.warn(LOG_PREFIX, ...args);\r\n      } catch (_err) {\r\n        // ignore\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nfunction ensureArray(value){\r\n  if(!value) return [];\r\n  if(Array.isArray(value)) return value;\r\n  return String(value).split(',').map(part => part.trim()).filter(Boolean);\r\n}\r\n\r\nfunction combineAppend(base, extras){\r\n  const values = new Set([...ensureArray(base), ...ensureArray(extras)]);\r\n  if(!values.size) return '';\r\n  return Array.from(values).join(',');\r\n}\r\n\r\nfunction createFetcher(client, cache, config, log){\r\n  const defaultAppend = {\r\n    movie: 'images,credits,release_dates,watch/providers',\r\n    tv: 'images,content_ratings,aggregate_credits,credits,watch/providers',\r\n    season: 'images,credits',\r\n  };\r\n\r\n  async function fetchWithCache(key, ttlHours, loader){\r\n    try{\r\n      const cached = cache.get(key);\r\n      if(cached) return cached;\r\n    }catch(err){\r\n      log.warn('Cache read failed for', key, err?.message || err);\r\n    }\r\n    let data = null;\r\n    try{\r\n      data = await loader();\r\n    }catch(err){\r\n      log.warn('Request failed for', key, err?.message || err);\r\n      throw err;\r\n    }\r\n    try{\r\n      if(data != null) cache.set(key, data, ttlHours);\r\n    }catch(err){\r\n      log.warn('Cache write failed for', key, err?.message || err);\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Fetches enriched movie details from TMDB with caching\r\n   * @param {string|number} id - TMDB movie ID\r\n   * @param {Object} [options] - Configuration options\r\n   * @param {number} [options.ttlHours] - Cache TTL in hours\r\n   * @param {string} [options.language] - Language code (e.g., 'de-DE')\r\n   * @param {string} [options.region] - Region code (e.g., 'DE')\r\n   * @param {string|string[]} [options.append] - Additional TMDB endpoints to append\r\n   * @param {string} [options.posterSize] - Poster image size\r\n   * @param {string} [options.backdropSize] - Backdrop image size\r\n   * @param {string} [options.profileSize] - Profile image size\r\n   * @param {string} [options.logoSize] - Logo image size\r\n   * @returns {Promise<Object|null>} Enriched movie data or null\r\n   */\r\n  async function getMovieEnriched(id, options = {}){\r\n    const movieId = id ?? options.id;\r\n    if(movieId == null) return null;\r\n    const cacheKey = `tmdb:movie:${movieId}:v1`;\r\n    const ttl = options.ttlHours ?? config.ttlHours;\r\n    return fetchWithCache(cacheKey, ttl, async ()=>{\r\n      const append = combineAppend(defaultAppend.movie, options.append);\r\n      const detail = await client.get(`/movie/${movieId}`, {\r\n        append_to_response: append,\r\n      }, {\r\n        language: options.language ?? config.language,\r\n        region: options.region ?? config.region,\r\n      });\r\n      return mapMovieDetail(detail, {\r\n        imageBase: config.imageBase,\r\n        posterSize: options.posterSize,\r\n        backdropSize: options.backdropSize,\r\n        profileSize: options.profileSize,\r\n        logoSize: options.logoSize,\r\n        region: options.region ?? config.region,\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetches enriched TV series details from TMDB with caching\r\n   * @param {string|number} id - TMDB TV series ID\r\n   * @param {Object} [options] - Configuration options (same as getMovieEnriched)\r\n   * @returns {Promise<Object|null>} Enriched TV series data or null\r\n   */\r\n  async function getTvEnriched(id, options = {}){\r\n    const tvId = id ?? options.id;\r\n    if(tvId == null) return null;\r\n    const cacheKey = `tmdb:tv:${tvId}:v1`;\r\n    const ttl = options.ttlHours ?? config.ttlHours;\r\n    return fetchWithCache(cacheKey, ttl, async ()=>{\r\n      const append = combineAppend(defaultAppend.tv, options.append);\r\n      const detail = await client.get(`/tv/${tvId}`, {\r\n        append_to_response: append,\r\n      }, {\r\n        language: options.language ?? config.language,\r\n        region: options.region ?? config.region,\r\n      });\r\n      return mapTvDetail(detail, {\r\n        imageBase: config.imageBase,\r\n        posterSize: options.posterSize,\r\n        backdropSize: options.backdropSize,\r\n        profileSize: options.profileSize,\r\n        logoSize: options.logoSize,\r\n        region: options.region ?? config.region,\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetches enriched season details from TMDB with caching\r\n   * @param {string|number} tvId - TMDB TV series ID\r\n   * @param {number} seasonNumber - Season number\r\n   * @param {Object} [options] - Configuration options\r\n   * @param {Object} [options.show] - Parent show object to attach to season\r\n   * @param {boolean} [options.skipShowLookup] - Skip automatic show lookup\r\n   * @param {string} [options.stillSize] - Episode still image size\r\n   * @returns {Promise<Object|null>} Enriched season data or null\r\n   */\r\n  async function getSeasonEnriched(tvId, seasonNumber, options = {}){\r\n    if(tvId == null || seasonNumber == null) return null;\r\n    const cacheKey = `tmdb:tv:${tvId}:season:${seasonNumber}:v1`;\r\n    const ttl = options.ttlHours ?? config.ttlHours;\r\n    return fetchWithCache(cacheKey, ttl, async ()=>{\r\n      const append = combineAppend(defaultAppend.season, options.append);\r\n      const detail = await client.get(`/tv/${tvId}/season/${seasonNumber}`, {\r\n        append_to_response: append,\r\n      }, {\r\n        language: options.language ?? config.language,\r\n        region: options.region ?? config.region,\r\n      });\r\n      let show = options.show || null;\r\n      if(!show && !options.skipShowLookup){\r\n        try{\r\n          show = await getTvEnriched(tvId, { ttlHours: ttl });\r\n        }catch(err){\r\n          log.warn('Failed to load parent show for season', tvId, seasonNumber, err?.message || err);\r\n          // Provide minimal show object as fallback\r\n          show = { id: tvId, name: '', type: 'tv' };\r\n        }\r\n      }\r\n      // Ensure show has at least minimal structure\r\n      if(!show){\r\n        show = { id: tvId, name: '', type: 'tv' };\r\n      }\r\n      return mapSeasonDetail(detail, {\r\n        imageBase: config.imageBase,\r\n        posterSize: options.posterSize,\r\n        backdropSize: options.backdropSize,\r\n        profileSize: options.profileSize,\r\n        logoSize: options.logoSize,\r\n        show,\r\n      });\r\n    });\r\n  }\r\n\r\n  return {\r\n    getMovieEnriched,\r\n    getTvEnriched,\r\n    getSeasonEnriched,\r\n  };\r\n}\r\n\r\nexport function createMetadataService(inputOptions = {}){\r\n  const config = normaliseConfig(inputOptions);\r\n  const cache = inputOptions.cacheStore || createCacheStore({ storageKey: inputOptions.storageKey });\r\n  const client = createTmdbClient({\r\n    apiBase: inputOptions.apiBase || config.apiBase,\r\n    apiKey: config.apiKey,\r\n    token: config.token,\r\n    language: config.language,\r\n    region: config.region,\r\n    ttlHours: config.ttlHours,\r\n  });\r\n  const log = createLogger();\r\n  const fetcher = createFetcher(client, cache, config, log);\r\n\r\n  return {\r\n    getMovieEnriched: fetcher.getMovieEnriched,\r\n    getTvEnriched: fetcher.getTvEnriched,\r\n    getSeasonEnriched: fetcher.getSeasonEnriched,\r\n    get client(){ return client; },\r\n    get cache(){ return cache; },\r\n    get config(){ return { ...config }; },\r\n    clear(prefix){ cache.clear(prefix); },\r\n  };\r\n}\r\n\r\nlet defaultCacheStore = null;\r\nlet defaultService = null;\r\n\r\nfunction ensureDefaultCache(){\r\n  if(!defaultCacheStore){\r\n    defaultCacheStore = createCacheStore();\r\n  }\r\n  return defaultCacheStore;\r\n}\r\n\r\nfunction ensureDefaultService(){\r\n  if(!defaultService){\r\n    defaultService = createMetadataService({ cacheStore: ensureDefaultCache() });\r\n  }\r\n  return defaultService;\r\n}\r\n\r\nexport function configureMetadataServiceDefaults(options = {}){\r\n  const merged = { ...options };\r\n  if(!merged.cacheStore){\r\n    merged.cacheStore = ensureDefaultCache();\r\n  }\r\n  defaultService = createMetadataService(merged);\r\n  return defaultService;\r\n}\r\n\r\nfunction readStoredToken(){\r\n  try{\r\n    const token = localStorage.getItem('tmdbToken');\r\n    if(token && token.trim()){\r\n      return token.trim();\r\n    }\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to read tmdbToken from storage:`, err?.message || err);\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function syncDefaultMetadataService(cfg = {}, overrides = {}){\r\n  try{\r\n    const {\r\n      preferStoredToken = true,\r\n      token: overrideToken,\r\n      apiKey: overrideApiKey,\r\n      language: overrideLanguage,\r\n      region: overrideRegion,\r\n      ttlHours: overrideTtl,\r\n      imageBase: overrideImageBase,\r\n    } = overrides || {};\r\n\r\n    const options = {};\r\n    const lang = overrideLanguage || cfg.lang || cfg.language;\r\n    if(lang) options.language = lang;\r\n    const region = overrideRegion || cfg.region || cfg.iso;\r\n    if(region) options.region = region;\r\n    const ttlCandidates = [overrideTtl, cfg.ttlHours, cfg.tmdbTtlHours];\r\n    for(const candidate of ttlCandidates){\r\n      if(candidate === undefined || candidate === null) continue;\r\n      if(typeof candidate === 'string' && candidate.trim() === '') continue;\r\n      const ttlNum = Number(candidate);\r\n      if(Number.isFinite(ttlNum)){\r\n        options.ttlHours = ttlNum;\r\n        break;\r\n      }\r\n    }\r\n    const imageBase = overrideImageBase || cfg.imageBase || cfg.tmdbImageBase;\r\n    if(imageBase) options.imageBase = imageBase;\r\n\r\n    let token = typeof overrideToken === 'string' ? overrideToken.trim() : (overrideToken ?? '');\r\n    if(typeof token !== 'string') token = '';\r\n    if(!token && preferStoredToken){\r\n      token = readStoredToken();\r\n    }\r\n    if(!token && typeof cfg.tmdbToken === 'string'){\r\n      token = cfg.tmdbToken.trim();\r\n    }\r\n\r\n    let apiKey = typeof overrideApiKey === 'string' ? overrideApiKey.trim() : (overrideApiKey ?? '');\r\n    if(typeof apiKey !== 'string') apiKey = '';\r\n    if(!apiKey && typeof cfg.tmdbApiKey === 'string'){\r\n      apiKey = cfg.tmdbApiKey.trim();\r\n    }\r\n\r\n    if(token){\r\n      options.token = token;\r\n    }else if(apiKey){\r\n      options.apiKey = apiKey;\r\n    }\r\n\r\n    configureMetadataServiceDefaults(options);\r\n  }catch(err){\r\n    console.warn(`${LOG_PREFIX} Failed to sync default metadata service:`, err?.message || err);\r\n  }\r\n}\r\n\r\nexport const getMovieEnriched = (...args) => ensureDefaultService().getMovieEnriched(...args);\r\nexport const getTvEnriched = (...args) => ensureDefaultService().getTvEnriched(...args);\r\nexport const getSeasonEnriched = (...args) => ensureDefaultService().getSeasonEnriched(...args);\r\n\r\nconst metadataServiceFacade = {\r\n  getMovieEnriched: (...args) => ensureDefaultService().getMovieEnriched(...args),\r\n  getTvEnriched: (...args) => ensureDefaultService().getTvEnriched(...args),\r\n  getSeasonEnriched: (...args) => ensureDefaultService().getSeasonEnriched(...args),\r\n  clear(prefix){\r\n    return ensureDefaultService().clear(prefix);\r\n  },\r\n  configure: configureMetadataServiceDefaults,\r\n  sync: syncDefaultMetadataService,\r\n};\r\n\r\nObject.defineProperties(metadataServiceFacade, {\r\n  client: {\r\n    get(){\r\n      return ensureDefaultService().client;\r\n    },\r\n  },\r\n  cache: {\r\n    get(){\r\n      return ensureDefaultService().cache;\r\n    },\r\n  },\r\n  config: {\r\n    get(){\r\n      return ensureDefaultService().config;\r\n    },\r\n  },\r\n});\r\n\r\nexport default metadataServiceFacade;\r\n", "import { prefixShowThumb } from '../data.js';\r\nimport metadataService from '../metadataService.js';\r\nimport { urlEpisode, makeInitials } from '../imageHelper.js';\r\n\r\nconst LOG_PREFIX = '[seasonsAccordion]';\r\n\r\nexport function renderSeasonsAccordion(targetOrSeasons, maybeSeasons, maybeOptions){\r\n  const { root, seasons, options } = resolveContext(targetOrSeasons, maybeSeasons, maybeOptions);\r\n  if(!root) return;\r\n\r\n  // Cleanup existing cards before replacing\r\n  const existingCards = root.querySelectorAll('.season-card');\r\n  existingCards.forEach(card => {\r\n    if(typeof card._cleanup === 'function'){\r\n      card._cleanup();\r\n    }\r\n  });\r\n\r\n  root.replaceChildren();\r\n  (seasons || []).forEach((s, idx) => root.append(seasonCardEl(s, idx, options)));\r\n}\r\n\r\nfunction isTarget(value){\r\n  return value instanceof Element || typeof value === 'string';\r\n}\r\n\r\nfunction resolveTarget(value){\r\n  if(value instanceof Element) return value;\r\n  if(typeof value === 'string') return document.querySelector(value);\r\n  return null;\r\n}\r\n\r\nfunction resolveContext(targetOrSeasons, maybeSeasons, maybeOptions){\r\n  let target = null;\r\n  let seasons = [];\r\n  let options = {};\r\n\r\n  if(isTarget(targetOrSeasons)){\r\n    target = resolveTarget(targetOrSeasons);\r\n    if(Array.isArray(maybeSeasons)){\r\n      seasons = maybeSeasons;\r\n      options = isPlainObject(maybeOptions) ? maybeOptions : {};\r\n    }else{\r\n      seasons = Array.isArray(targetOrSeasons) ? targetOrSeasons : [];\r\n      options = isPlainObject(maybeSeasons) ? maybeSeasons : {};\r\n    }\r\n  }else if(Array.isArray(targetOrSeasons)){\r\n    seasons = targetOrSeasons;\r\n    if(isTarget(maybeSeasons)){\r\n      target = resolveTarget(maybeSeasons);\r\n      options = isPlainObject(maybeOptions) ? maybeOptions : {};\r\n    }else{\r\n      options = isPlainObject(maybeSeasons) ? maybeSeasons : {};\r\n    }\r\n  }else{\r\n    target = resolveTarget(targetOrSeasons);\r\n    seasons = Array.isArray(maybeSeasons) ? maybeSeasons : [];\r\n    options = isPlainObject(maybeOptions) ? maybeOptions : {};\r\n  }\r\n\r\n  if(!target) target = document.getElementById('seasonsAccordion');\r\n  return { root: target, seasons, options };\r\n}\r\n\r\nfunction isPlainObject(value){\r\n  return value != null && typeof value === 'object' && !Array.isArray(value);\r\n}\r\n\r\nfunction seasonCardEl(season, idx, options = {}){\r\n  prefixShowThumb(season);\r\n  const card = document.createElement('article'); card.className='season-card';\r\n  const head = document.createElement('div'); head.className='season-head';\r\n  const th = document.createElement('div'); th.className='season-thumb';\r\n  const img = new Image(); img.loading='lazy'; img.decoding='async';\r\n  img.src = season.thumbFile || '';\r\n  img.alt = season.title || `Staffel ${season.seasonNumber||idx+1}`;\r\n  th.append(img);\r\n  const txt = document.createElement('div');\r\n  const title = document.createElement('div'); title.className='season-title'; title.textContent = season.title || `Staffel ${season.seasonNumber||idx+1}`;\r\n  const sub = document.createElement('div'); sub.className='season-sub';\r\n  const year = season.year || season.releaseYear || '';\r\n  const epCount = Array.isArray(season.episodes) ? season.episodes.length : (season.episodeCount || 0);\r\n  sub.textContent = [year, epCount ? `${epCount} Episoden` : ''].filter(Boolean).join(' \u2022 ');\r\n  txt.append(title, sub);\r\n  const chev = document.createElement('div'); chev.className='chev'; chev.textContent = '\u203A';\r\n  head.append(th, txt, chev);\r\n  const body = document.createElement('div'); body.className='season-body';\r\n  renderEpisodeRows(body, season.episodes || [], { show: options.show });\r\n\r\n  const seasonNumber = resolveSeasonNumber(season, idx);\r\n  const tvId = resolveShowTmdbId(season, options.show);\r\n  let loaded = false;\r\n  let loading = false;\r\n  let abortController = null;\r\n\r\n  const handleClick = ()=>{\r\n    const isOpen = card.classList.toggle('open');\r\n    if(!isOpen || loaded || loading) return;\r\n    if(!shouldEnrichSeason(tvId, seasonNumber)){\r\n      loaded = true;\r\n      return;\r\n    }\r\n    loading = true;\r\n    abortController = new AbortController();\r\n\r\n    metadataService.getSeasonEnriched(tvId, seasonNumber, { stillSize: 'w300', show: options.show || null })\r\n      .then(detail => {\r\n        if(abortController?.signal.aborted) return;\r\n        if(!detail || !Array.isArray(detail.episodes)) return;\r\n        mergeSeasonEpisodes(season, detail.episodes);\r\n        renderEpisodeRows(body, season.episodes || [], { show: options.show });\r\n        loaded = true;\r\n      })\r\n      .catch(err => {\r\n        if(abortController?.signal.aborted) return;\r\n        logWarn('Failed to enrich season', tvId, seasonNumber, err?.message || err);\r\n      })\r\n      .finally(()=>{\r\n        loading = false;\r\n        abortController = null;\r\n      });\r\n  };\r\n\r\n  head.addEventListener('click', handleClick);\r\n\r\n  // Cleanup function for potential future use\r\n  card._cleanup = () => {\r\n    head.removeEventListener('click', handleClick);\r\n    if(abortController && !abortController.signal.aborted){\r\n      abortController.abort();\r\n    }\r\n  };\r\n\r\n  card.append(head, body);\r\n  return card;\r\n}\r\n\r\nfunction renderEpisodeRows(body, episodes, options = {}){\r\n  body.replaceChildren();\r\n  const list = Array.isArray(episodes) ? episodes : [];\r\n  if(!list.length){\r\n    const empty = document.createElement('p');\r\n    empty.className = 'episode-empty';\r\n    empty.textContent = 'Keine Episoden verf\u00FCgbar.';\r\n    body.append(empty);\r\n    return;\r\n  }\r\n  list.forEach(ep => {\r\n    prefixShowThumb(ep);\r\n    body.append(episodeRowEl(ep, options));\r\n  });\r\n}\r\n\r\nfunction episodeRowEl(ep, options = {}){\r\n  const data = combineEpisodeData(ep);\r\n  const row = document.createElement('div'); row.className='episode';\r\n\r\n  const media = document.createElement('div'); media.className='ep-media';\r\n  media.append(createEpisodeStill(data, options));\r\n\r\n  const content = document.createElement('div'); content.className='ep-content';\r\n\r\n  const header = document.createElement('div'); header.className='ep-header';\r\n  const title = document.createElement('div'); title.className='ep-title';\r\n  title.textContent = buildEpisodeTitle(data);\r\n  header.append(title);\r\n\r\n  const right = document.createElement('div'); right.className='badges';\r\n  const rating = Number(data.rating);\r\n  if(Number.isFinite(rating)){\r\n    const badge = document.createElement('span');\r\n    badge.className = 'badge';\r\n    badge.textContent = rating.toFixed(1);\r\n    right.append(badge);\r\n  }\r\n  if(right.childElementCount){\r\n    header.append(right);\r\n  }\r\n\r\n  const meta = document.createElement('div'); meta.className='ep-meta';\r\n  const metaParts = [];\r\n  if(data.runtimeText) metaParts.push(data.runtimeText);\r\n  if(data.airDate) metaParts.push(data.airDate);\r\n  meta.textContent = metaParts.join(' \u2022 ');\r\n\r\n  const overview = document.createElement('p'); overview.className='ep-overview';\r\n  overview.textContent = data.overview || 'Keine Beschreibung verf\u00FCgbar.';\r\n\r\n  content.append(header, meta, overview);\r\n  row.append(media, content);\r\n  return row;\r\n}\r\n\r\nfunction buildEpisodeTitle(data){\r\n  const parts = [];\r\n  if(data.code) parts.push(data.code);\r\n  if(data.title) parts.push(data.title);\r\n  return parts.join(' \u2022 ');\r\n}\r\n\r\nfunction createEpisodeStill(data, options = {}){\r\n  const wrapper = document.createElement('div');\r\n  wrapper.className = 'ep-still';\r\n  const stillPath = data.tmdbStillPath;\r\n  const stillUrl = data.tmdbStill || data.localStill;\r\n  const alt = data.title || options?.show?.title || 'Episode';\r\n  if(stillPath || stillUrl){\r\n    const img = new Image();\r\n    img.loading = 'lazy';\r\n    img.decoding = 'async';\r\n    if(stillPath){\r\n      const small = urlEpisode(stillPath, { size: 'w300', title: alt });\r\n      const medium = urlEpisode(stillPath, { size: 'w780', title: alt });\r\n      img.src = small;\r\n      img.srcset = `${small} 300w, ${medium} 780w`;\r\n    }else{\r\n      img.src = stillUrl;\r\n    }\r\n    img.alt = alt;\r\n    wrapper.append(img);\r\n    return wrapper;\r\n  }\r\n  wrapper.dataset.state = 'empty';\r\n  const placeholder = document.createElement('div');\r\n  placeholder.className = 'ep-still-initials';\r\n  placeholder.textContent = makeInitials(data.title || options?.show?.title || '', 2) || '\u2205';\r\n  wrapper.append(placeholder);\r\n  return wrapper;\r\n}\r\n\r\nfunction combineEpisodeData(ep){\r\n  const tmdb = ep?.tmdb || {};\r\n  const seasonNumber = resolveNumeric(ep?.seasonNumber, tmdb?.seasonNumber);\r\n  const episodeNumber = resolveNumeric(ep?.episodeNumber, tmdb?.episodeNumber, ep?.index);\r\n  const code = (ep?.seasonEpisode && String(ep.seasonEpisode).toUpperCase())\r\n    || (Number.isFinite(seasonNumber) && Number.isFinite(episodeNumber)\r\n      ? `S${String(seasonNumber).padStart(2,'0')}E${String(episodeNumber).padStart(2,'0')}`\r\n      : '');\r\n  const durationMin = ep?.durationMin\r\n    || (Number.isFinite(ep?.duration) ? Math.round(Number(ep.duration)/60000) : null)\r\n    || (Number.isFinite(tmdb?.runtime) ? Number(tmdb.runtime) : null);\r\n  const runtimeText = ep?.durationHuman\r\n    || (Number.isFinite(durationMin) && durationMin > 0 ? `${durationMin} min` : '');\r\n  const rating = Number.isFinite(tmdb?.voteAverage)\r\n    ? Number(tmdb.voteAverage)\r\n    : Number(ep?.audienceRating ?? ep?.rating ?? ep?.score ?? NaN);\r\n  const overview = tmdb?.overview\r\n    || ep?.summary || ep?.overview || ep?.description || ep?.plot || '';\r\n  const airDate = tmdb?.airDate || ep?.originallyAvailableAt || ep?.date || ep?.airDate || '';\r\n  const stillPath = tmdb?.stillPath || ep?.stillPath || '';\r\n  const still = tmdb?.still || ep?.still || ep?.thumbFile || ep?.thumb || '';\r\n  return {\r\n    title: tmdb?.name || ep?.title || ep?.name || '',\r\n    code,\r\n    runtimeText,\r\n    rating,\r\n    overview,\r\n    airDate,\r\n    tmdbStillPath: stillPath,\r\n    tmdbStill: tmdb?.still || '',\r\n    localStill: still,\r\n  };\r\n}\r\n\r\nfunction mergeSeasonEpisodes(season, enrichedEpisodes){\r\n  if(!season || typeof season !== 'object') return;\r\n  const localEpisodes = Array.isArray(season.episodes) ? season.episodes : [];\r\n  const lookup = new Map();\r\n  localEpisodes.forEach(ep => {\r\n    const key = buildEpisodeKey(ep);\r\n    if(key) lookup.set(key, ep);\r\n  });\r\n  enrichedEpisodes.forEach(entry => {\r\n    const key = buildEpisodeKey(entry);\r\n    if(!key || !lookup.has(key)) return;\r\n    const target = lookup.get(key);\r\n    target.tmdb = {\r\n      id: entry.id || '',\r\n      seasonNumber: resolveNumeric(entry.seasonNumber),\r\n      episodeNumber: resolveNumeric(entry.episodeNumber),\r\n      name: entry.name || '',\r\n      overview: entry.overview || '',\r\n      airDate: entry.airDate || '',\r\n      runtime: resolveNumeric(entry.runtime),\r\n      voteAverage: Number(entry.voteAverage ?? entry.vote_average ?? NaN),\r\n      voteCount: resolveNumeric(entry.voteCount ?? entry.vote_count),\r\n      still: entry.still || '',\r\n      stillPath: entry.stillPath || '',\r\n    };\r\n  });\r\n}\r\n\r\nfunction buildEpisodeKey(ep){\r\n  if(!ep) return '';\r\n  const seasonNumber = resolveNumeric(ep.seasonNumber, ep.parentIndex, ep.parentSeason, ep.season);\r\n  const episodeNumber = resolveNumeric(ep.episodeNumber, ep.index, ep.episode, ep.indexNumber);\r\n  if(!Number.isFinite(seasonNumber) || !Number.isFinite(episodeNumber)) return '';\r\n  return `${seasonNumber}:${episodeNumber}`;\r\n}\r\n\r\nfunction resolveNumeric(...values){\r\n  for(const value of values){\r\n    const num = Number(value);\r\n    if(Number.isFinite(num)) return num;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction resolveSeasonNumber(season, idx){\r\n  const num = resolveNumeric(season?.seasonNumber, season?.index, season?.indexNumber);\r\n  if(Number.isFinite(num)) return num;\r\n  return (idx ?? 0) + 1;\r\n}\r\n\r\nfunction resolveShowTmdbId(season, show){\r\n  const showIds = show?.ids || {};\r\n  const direct = showIds?.tmdb || show?.tmdbId || show?.tmdb?.id || show?.id;\r\n  const seasonId = season?.tmdbShowId\r\n    || season?.parent?.ids?.tmdb\r\n    || season?.parent?.tmdbId\r\n    || season?.ids?.tmdbShow;\r\n  const value = direct || seasonId;\r\n  if(value == null) return null;\r\n  const str = String(value).trim();\r\n  return str ? str : null;\r\n}\r\n\r\nfunction hasTmdbCredentials(){\r\n  try{\r\n    const config = metadataService?.config || {};\r\n    if(typeof config.token === 'string' && config.token.trim()) return true;\r\n    if(typeof config.apiKey === 'string' && config.apiKey.trim()) return true;\r\n  }catch(err){\r\n    logWarn('Failed to inspect metadata service config for credentials', err?.message || err);\r\n  }\r\n\r\n  try{\r\n    const stored = typeof localStorage?.getItem === 'function' ? localStorage.getItem('tmdbToken') : '';\r\n    if(typeof stored === 'string' && stored.trim()) return true;\r\n  }catch(err){\r\n    logWarn('Failed to read TMDB credentials from storage', err?.message || err);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction shouldEnrichSeason(tvId, seasonNumber){\r\n  if(!window?.FEATURES?.tmdbEnrichment) return false;\r\n  if(!hasTmdbCredentials()) return false;\r\n  if(!tvId || seasonNumber == null) return false;\r\n  return true;\r\n}\r\n\r\nfunction logWarn(...args){\r\n  try {\r\n    console.warn(LOG_PREFIX, ...args);\r\n  } catch (_err) {\r\n    // ignore\r\n  }\r\n}\r\n\r\n", "import { renderSeasonsAccordion } from './seasonsAccordion.js';\r\n\r\nexport function updateSeasons(root, item){\r\n  const pane = root.querySelector('.v2-seasons');\r\n  if(!pane) return;\r\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\r\n  if(!seasons.length){\r\n    pane.innerHTML = '<p class=\"modalv2-loading\">Keine Staffel-Informationen verf\u00FCgbar.</p>';\r\n    return;\r\n  }\r\n  pane.innerHTML = '';\r\n  renderSeasonsAccordion(pane, seasons, { show: item });\r\n}\r\n", "export function setExternalLinks(root, item){\r\n  const tmdbBtn = root.querySelector('#v2Tmdb');\r\n  const imdbBtn = root.querySelector('#v2Imdb');\r\n  const trailerBtn = root.querySelector('#v2Trailer');\r\n  const tmdbId = item?.ids?.tmdb || item?.tmdbId || item?.tmdbDetail?.id || item?.tmdb?.id;\r\n  const imdbId = item?.ids?.imdb || item?.imdbId || item?.tmdbDetail?.imdbId || item?.tmdbDetail?.raw?.external_ids?.imdb_id;\r\n  const trailer = item?.trailer || item?.trailerUrl || item?.tmdbDetail?.trailer;\r\n  const type = item?.type === 'tv' ? 'tv' : 'movie';\r\n  if(tmdbBtn){\r\n    if(tmdbId){\r\n      tmdbBtn.hidden = false;\r\n      tmdbBtn.href = `https://www.themoviedb.org/${type}/${tmdbId}`;\r\n    }else{\r\n      tmdbBtn.hidden = true;\r\n      tmdbBtn.removeAttribute('href');\r\n    }\r\n  }\r\n  if(imdbBtn){\r\n    if(imdbId){\r\n      imdbBtn.hidden = false;\r\n      imdbBtn.href = `https://www.imdb.com/title/${imdbId}/`;\r\n    }else{\r\n      imdbBtn.hidden = true;\r\n      imdbBtn.removeAttribute('href');\r\n    }\r\n  }\r\n  if(trailerBtn){\r\n    if(trailer){\r\n      trailerBtn.hidden = false;\r\n      trailerBtn.onclick = ()=> window.open(trailer, '_blank', 'noopener');\r\n    }else{\r\n      trailerBtn.hidden = true;\r\n      trailerBtn.onclick = null;\r\n    }\r\n  }\r\n}\r\n", "import { useTmdbOn } from '../utils.js';\r\n\r\nconst TMDB_PROFILE_BASE = 'https://image.tmdb.org/t/p/';\r\nconst TMDB_PROFILE_SIZE = 'w185';\r\n\r\nfunction normalizeLocalCast(person){\r\n  if(!person) return null;\r\n  if(typeof person === 'string'){\r\n    const name = String(person).trim();\r\n    if(!name) return null;\r\n    return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\r\n  }\r\n  const name = String(person.tag || person.name || person.role || '').trim();\r\n  if(!name) return null;\r\n  const role = (()=>{\r\n    const rawRole = String(person.role || '').trim();\r\n    if(!rawRole) return '';\r\n    return rawRole.toLowerCase() === name.toLowerCase() ? '' : rawRole;\r\n  })();\r\n  const tmdbProfile = [\r\n    person?.tmdb?.profile,\r\n    person?.tmdb?.profile_path,\r\n    person?.tmdb?.profilePath,\r\n    person?.tmdbProfile,\r\n    person?.profile,\r\n    person?.profile_path,\r\n    person?.profilePath,\r\n  ].find(val => typeof val === 'string' && val.trim());\r\n  const thumb = [person?.thumb, person?.photo, person?.image].find(val => typeof val === 'string' && val.trim()) || '';\r\n  return {\r\n    name,\r\n    role,\r\n    thumb,\r\n    tmdbProfile: tmdbProfile ? String(tmdbProfile).trim() : '',\r\n    raw: person,\r\n  };\r\n}\r\n\r\nfunction normalizeTmdbCast(person){\r\n  if(!person) return null;\r\n  const name = String(person.name || person.original_name || '').trim();\r\n  if(!name) return null;\r\n  const role = String(person.character || '').trim();\r\n  return {\r\n    name,\r\n    role,\r\n    thumb: '',\r\n    tmdbProfile: person.profile || person.profile_path || person.profilePath || '',\r\n    raw: { tmdb: person },\r\n  };\r\n}\r\n\r\nexport function buildCastList(item){\r\n  const seen = new Map(); // Use Map for case-insensitive deduplication\r\n  const combined = [];\r\n  const localSource = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\r\n\r\n  // Pre-normalize and deduplicate local cast\r\n  localSource.forEach(person => {\r\n    const entry = normalizeLocalCast(person);\r\n    if(!entry) return;\r\n    const lowerName = entry.name.toLowerCase();\r\n    if(!seen.has(lowerName)){\r\n      seen.set(lowerName, true);\r\n      combined.push(entry);\r\n    }\r\n  });\r\n\r\n  // Pre-normalize and deduplicate TMDB cast\r\n  const tmdbSource = Array.isArray(item?.tmdbDetail?.credits?.cast) ? item.tmdbDetail.credits.cast : [];\r\n  tmdbSource.forEach(person => {\r\n    const entry = normalizeTmdbCast(person);\r\n    if(!entry) return;\r\n    const lowerName = entry.name.toLowerCase();\r\n    if(!seen.has(lowerName)){\r\n      seen.set(lowerName, true);\r\n      combined.push(entry);\r\n    }\r\n  });\r\n\r\n  return combined;\r\n}\r\n\r\nexport function updateCast(root, cast){\r\n  const pane = root.querySelector('.v2-cast');\r\n  if(!pane) return;\r\n  let scroll = pane.querySelector('.v2-cast-scroll');\r\n  if(!scroll){\r\n    scroll = document.createElement('div');\r\n    scroll.className = 'v2-cast-scroll';\r\n    pane.prepend(scroll);\r\n  }else{\r\n    scroll.innerHTML = '';\r\n  }\r\n  if(!scroll) return;\r\n  const limited = Array.isArray(cast) ? cast.slice(0, 12) : [];\r\n  if(!limited.length){\r\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\r\n    scroll.removeAttribute('role');\r\n    return;\r\n  }\r\n  scroll.setAttribute('role', 'list');\r\n  const tmdbEnabled = useTmdbOn();\r\n  limited.forEach(entry=>{\r\n    const data = (entry && typeof entry === 'object' && 'name' in entry)\r\n      ? entry\r\n      : (()=>{\r\n          const name = String(entry || '').trim();\r\n          if(!name) return null;\r\n          return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\r\n        })();\r\n    if(!data || !data.name) return;\r\n\r\n    const card = document.createElement('article');\r\n    card.className = 'v2-cast-card';\r\n    card.tabIndex = 0;\r\n    card.setAttribute('role', 'listitem');\r\n\r\n    const roleText = String(data.role || '').trim();\r\n    card.setAttribute('aria-label', roleText ? `${data.name} \u2013 ${roleText}` : data.name);\r\n\r\n    const avatar = document.createElement('div');\r\n    avatar.className = 'v2-cast-avatar';\r\n    const imageSrc = resolveCastImage(data, tmdbEnabled);\r\n    if(imageSrc){\r\n      avatar.classList.add('has-image');\r\n      const img = document.createElement('img');\r\n      img.src = imageSrc;\r\n      img.alt = data.name;\r\n      img.loading = 'lazy';\r\n      img.decoding = 'async';\r\n      avatar.appendChild(img);\r\n    }else{\r\n      const initials = document.createElement('span');\r\n      initials.className = 'v2-cast-initials';\r\n      initials.textContent = castInitials(data.name);\r\n      initials.setAttribute('aria-hidden', 'true');\r\n      avatar.appendChild(initials);\r\n    }\r\n\r\n    const nameLine = document.createElement('p');\r\n    nameLine.className = 'v2-cast-name';\r\n    nameLine.textContent = data.name;\r\n\r\n    card.append(avatar, nameLine);\r\n\r\n    if(roleText){\r\n      const roleLine = document.createElement('p');\r\n      roleLine.className = 'v2-cast-role';\r\n      roleLine.textContent = roleText;\r\n      card.append(roleLine);\r\n    }else{\r\n      card.classList.add('v2-cast-card--no-role');\r\n    }\r\n    scroll.appendChild(card);\r\n  });\r\n\r\n  if(!scroll.children.length){\r\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\r\n    scroll.removeAttribute('role');\r\n  }\r\n  ensureCastStatusPosition(pane);\r\n}\r\n\r\nexport function setCastLoading(root, loading){\r\n  const pane = resolveCastPane(root);\r\n  if(!pane) return;\r\n  pane.dataset.loading = loading ? 'true' : 'false';\r\n  if(loading){\r\n    pane.setAttribute('aria-busy', 'true');\r\n  }else{\r\n    pane.removeAttribute('aria-busy');\r\n  }\r\n}\r\n\r\nexport function setCastStatus(root, status){\r\n  const pane = resolveCastPane(root);\r\n  if(!pane) return;\r\n  let statusEl = pane.querySelector('.v2-cast-status');\r\n  if(!status || !status.message){\r\n    if(statusEl) statusEl.remove();\r\n    pane.dataset.status = '';\r\n    return;\r\n  }\r\n  if(!statusEl){\r\n    statusEl = document.createElement('p');\r\n    statusEl.className = 'v2-cast-status';\r\n    statusEl.setAttribute('aria-live', 'polite');\r\n    statusEl.setAttribute('aria-atomic', 'true');\r\n    pane.appendChild(statusEl);\r\n  }\r\n  statusEl.dataset.state = status.state || '';\r\n  statusEl.textContent = status.message;\r\n  pane.dataset.status = status.state || '';\r\n  ensureCastStatusPosition(pane);\r\n}\r\n\r\nfunction ensureCastStatusPosition(pane){\r\n  const statusEl = pane.querySelector('.v2-cast-status');\r\n  const scroll = pane.querySelector('.v2-cast-scroll');\r\n  if(statusEl && scroll && statusEl.previousElementSibling !== scroll){\r\n    pane.appendChild(statusEl);\r\n  }\r\n}\r\n\r\nfunction resolveCastPane(root){\r\n  if(root instanceof HTMLElement) return root.querySelector('.v2-cast');\r\n  return document.querySelector('.v2-pane.v2-cast');\r\n}\r\n\r\nfunction normalizeTmdbProfile(path){\r\n  const str = String(path || '').trim();\r\n  if(!str) return '';\r\n  if(/^https?:\\/\\//i.test(str)) return str;\r\n  if(str.startsWith('//')) return `https:${str}`;\r\n  const suffix = str.startsWith('/') ? str : `/${str}`;\r\n  return `${TMDB_PROFILE_BASE}${TMDB_PROFILE_SIZE}${suffix}`;\r\n}\r\n\r\nfunction normalizeLocalImage(path){\r\n  const str = String(path || '').trim();\r\n  if(!str) return '';\r\n  if(/^https?:\\/\\//i.test(str) || str.startsWith('data:')) return str;\r\n  if(str.startsWith('//')) return `https:${str}`;\r\n  return str;\r\n}\r\n\r\nfunction resolveCastImage(entry, tmdbEnabled){\r\n  if(!entry) return '';\r\n  const raw = entry.raw || {};\r\n  if(tmdbEnabled){\r\n    const tmdbCandidates = [\r\n      entry.tmdbProfile,\r\n      raw?.tmdb?.profile,\r\n      raw?.tmdb?.profile_path,\r\n      raw?.tmdb?.profilePath,\r\n      raw?.tmdbProfile,\r\n      raw?.profile,\r\n      raw?.profile_path,\r\n      raw?.profilePath,\r\n    ];\r\n    for(const candidate of tmdbCandidates){\r\n      const url = normalizeTmdbProfile(candidate);\r\n      if(url) return url;\r\n    }\r\n  }\r\n  const localCandidates = [entry.thumb, raw?.thumb, raw?.photo, raw?.image];\r\n  for(const candidate of localCandidates){\r\n    const url = normalizeLocalImage(candidate);\r\n    if(url) return url;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction castInitials(name){\r\n  const str = String(name || '').trim();\r\n  if(!str) return '?';\r\n  const parts = str.split(/\\s+/).slice(0, 2);\r\n  const chars = parts.map(part => part.charAt(0)).filter(Boolean);\r\n  return chars.length ? chars.join('').toUpperCase() : str.charAt(0).toUpperCase();\r\n}\r\n", "import { prefixShowThumb } from '../data.js';\n\nconst GUID_PATTERNS = {\n  tmdb: [\n    'tmdb://',\n    'themoviedb://',\n    'com.plexapp.agents.themoviedb://'\n  ],\n  imdb: [\n    'imdb://',\n    'com.plexapp.agents.imdb://'\n  ],\n  tvdb: [\n    'tvdb://',\n    'thetvdb://',\n    'com.plexapp.agents.thetvdb://'\n  ]\n};\n\nfunction isObject(value){\n  return value !== null && typeof value === 'object';\n}\n\nfunction parseGuidEntry(entry){\n  const raw = isObject(entry) ? (entry.id ?? entry.guid ?? '') : entry;\n  const str = typeof raw === 'string' ? raw.trim() : '';\n  if(!str) return {};\n  const lower = str.toLowerCase();\n  const result = {};\n  for(const [key, patterns] of Object.entries(GUID_PATTERNS)){\n    if(result[key]) continue;\n    for(const pattern of patterns){\n      const marker = pattern.toLowerCase();\n      const idx = lower.indexOf(marker);\n      if(idx === -1) continue;\n      const start = idx + marker.length;\n      let value = str.slice(start);\n      value = value.replace(/^\\/+/, '');\n      value = value.split(/[?#]/)[0];\n      if(!value) continue;\n      if(value.includes('/')){\n        const parts = value.split('/');\n        value = parts.find(Boolean) || '';\n      }\n      value = value.trim();\n      if(value){\n        result[key] = value;\n        break;\n      }\n    }\n  }\n  return result;\n}\n\nfunction ensureIds(target){\n  if(!target || typeof target !== 'object') return target;\n  const ids = { ...(target.ids || {}) };\n  const assign = (key, value)=>{\n    if(ids[key]) return;\n    const str = value == null ? '' : String(value).trim();\n    if(str) ids[key] = str;\n  };\n\n  assign('tmdb', target.tmdbId);\n  assign('tmdb', target?.tmdb?.id);\n  assign('imdb', target.imdbId);\n  assign('imdb', target?.tmdb?.imdbId);\n  assign('tvdb', target.tvdbId);\n  assign('tvdb', target?.tmdb?.tvdbId);\n\n  const guidSources = [];\n  if(Array.isArray(target?.guids)) guidSources.push(...target.guids);\n  if(target?.guid) guidSources.push(target.guid);\n\n  guidSources.forEach(source=>{\n    const parsed = parseGuidEntry(source);\n    Object.entries(parsed).forEach(([key, value])=> assign(key, value));\n  });\n\n  if(Object.keys(ids).length){\n    target.ids = ids;\n    if(ids.tmdb && !target.tmdbId){\n      target.tmdbId = ids.tmdb;\n    }\n  }\n  return target;\n}\n\nfunction deepClone(value){\n  if(value == null || typeof value !== 'object') return value;\n  if(typeof structuredClone === 'function'){\n    try{ return structuredClone(value); }\n    catch(err){ console.warn('[modal/shared] structuredClone failed, falling back to JSON clone:', err?.message || err); }\r\n  }\r\n  try{ return JSON.parse(JSON.stringify(value)); }\r\n  catch(err){ console.warn('[modal/shared] JSON clone failed, falling back to manual clone:', err?.message || err); }\r\n  if(Array.isArray(value)) return value.map(entry => deepClone(entry));\r\n  const out = {};\r\n  for(const key of Object.keys(value)){\r\n    out[key] = deepClone(value[key]);\r\n  }\r\n  return out;\r\n}\r\n\nexport function mapMovie(item){\n  if(!item || typeof item !== 'object') return null;\n  const clone = deepClone(item);\n  if(clone.type === 'show') clone.type = 'tv';\n  if(!clone.type) clone.type = 'movie';\n  ensureIds(clone);\n  return clone;\n}\n\nexport function mapShow(item){\n  if(!item || typeof item !== 'object') return null;\n  const clone = deepClone(item);\n  if(clone.type !== 'tv') clone.type = 'tv';\n  ensureIds(clone);\n  normalizeShow(clone);\n  return clone;\n}\n\nexport function mapDetail(detail){\n  if(!detail || typeof detail !== 'object') return null;\n  const clone = deepClone(detail);\n  ensureIds(clone);\n  normalizeShow(clone);\n  return clone;\n}\n\nexport function needsShowDetail(item){\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\r\n  const hasEpisodes = seasons.some(season => Array.isArray(season?.episodes) && season.episodes.length);\r\n  const cast = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\r\n  return !seasons.length || !hasEpisodes || !cast.length;\r\n}\r\n\r\nexport function mergeShowDetail(target, detail){\n  if(!target) return target;\n  if(detail && typeof detail === 'object'){\n    const mapped = mapDetail(detail);\n    Object.assign(target, mapped);\n    ensureIds(target);\n  }\n  normalizeShow(target);\n  return target;\n}\n\nexport function normalizeShow(show){\r\n  if(!show || typeof show !== 'object') return;\r\n  normalizeThumbField(show);\r\n  show.genres = normalizeGenresList(show.genres);\r\n  const cast = normalizePeopleList(show.cast || show.roles || []);\r\n  show.cast = cast;\r\n  show.roles = cast;\r\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeasonEntry).filter(Boolean) : [];\r\n  const sc = Number(show.seasonCount);\r\n  show.seasonCount = Number.isFinite(sc) && sc > 0 ? sc : show.seasons.length;\r\n}\r\n\r\nfunction normalizeSeasonEntry(season){\r\n  if(!season || typeof season !== 'object') return null;\r\n  const out = { ...season };\r\n  normalizeThumbField(out);\r\n  out.genres = normalizeGenresList(out.genres);\r\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisodeEntry).filter(Boolean) : [];\r\n  return out;\r\n}\r\n\r\nfunction normalizeEpisodeEntry(ep){\r\n  if(!ep || typeof ep !== 'object') return null;\r\n  const out = { ...ep };\r\n  normalizeThumbField(out);\r\n  out.genres = normalizeGenresList(out.genres);\r\n  return out;\r\n}\r\n\r\nfunction normalizeThumbField(obj){\r\n  prefixShowThumb(obj);\r\n}\r\n\r\nexport function normalizeGenresList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const seen = new Set();\r\n  const result = [];\r\n  list.forEach(entry => {\r\n    let item = null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      if(tag) item = { tag };\r\n    }else if(entry && typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\r\n      if(tag){ item = { ...entry, tag }; }\r\n    }\r\n    if(item && !seen.has(item.tag)){\r\n      seen.add(item.tag);\r\n      result.push(item);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nexport function normalizePeopleList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  return list.map(entry => {\r\n    if(!entry) return null;\r\n    if(typeof entry === 'string'){\r\n      const tag = entry.trim();\r\n      return tag ? { tag } : null;\r\n    }\r\n    if(typeof entry === 'object'){\r\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\r\n      return tag ? { ...entry, tag } : { ...entry };\r\n    }\r\n    return null;\r\n  }).filter(Boolean);\r\n}\r\n", "export const DEMO_MOVIE = {\r\n  type: 'movie',\r\n  title: 'Lumen: Der Aufbruch',\r\n  tagline: 'Eine cineastische Demo f\u00FCr das neue Modal',\r\n  overview: 'Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\u00FCllt dabei eine Energiequelle, die alles ver\u00E4ndern k\u00F6nnte. Zwischen Loyalit\u00E4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\u00FCr das Cinematic-Layout entworfen wurde.',\r\n  summary: 'Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\u00E4ndern k\u00F6nnte.',\r\n  runtimeMin: 142,\r\n  contentRating: 'FSK 12',\r\n  studio: 'Aurora Pictures',\r\n  rating: 8.4,\r\n  audienceRating: 8.0,\r\n  userRating: 8.7,\r\n  originallyAvailableAt: '2024-05-17',\r\n  countries: [{ tag: 'Deutschland' }, { tag: 'Kanada' }],\r\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }, { tag: 'Abenteuer' }],\r\n  cast: [\r\n    { name: 'Mara Lenz', role: 'Captain Alys Vega', tmdbProfile: '/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg' },\r\n    { name: 'Tariq Benassi', role: 'Navigator Elian Soh', tmdbProfile: '/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg' },\r\n    { name: 'Hannah Ko', role: 'Wissenschaftlerin Dr. Mira Han', tmdbProfile: '/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg' },\r\n  ],\r\n  directors: [{ tag: 'Jonas Falk' }],\r\n  writers: [{ tag: 'Lea Winter' }],\r\n  producers: [{ tag: 'Studio Atlas' }],\r\n  labels: [{ tag: 'Dolby Atmos' }, { tag: '4K' }],\r\n  collections: [{ tag: 'Aurora-Saga' }],\r\n  trailer: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',\r\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg',\r\n  ids: { tmdb: 'demo-lumen', imdb: 'tt0000001' },\r\n  addedAt: '2024-06-01T12:00:00Z',\r\n};\r\n\r\nexport const DEMO_SERIES = {\r\n  type: 'tv',\r\n  title: 'Aurora Station',\r\n  tagline: 'Neue Horizonte in Serie',\r\n  overview: 'Die Besatzung der Aurora Station sch\u00FCtzt eine Au\u00DFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\u00E4tsel mit pers\u00F6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.',\r\n  summary: 'Ein orbitaler Au\u00DFenposten ringt um Hoffnung und Zusammenhalt, w\u00E4hrend eine fremde Macht erwacht.',\r\n  contentRating: 'TV-14',\r\n  studio: 'Nebula Network',\r\n  originallyAvailableAt: '2023-09-14',\r\n  seasonCount: 2,\r\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }],\r\n  countries: [{ tag: 'USA' }, { tag: 'Island' }],\r\n  creators: [{ tag: 'Elina S\u00F8rensen' }],\r\n  cast: [\r\n    { name: 'Noah Adler', role: 'Commander Ivar Hale', tmdbProfile: '/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg' },\r\n    { name: 'Sofia Idris', role: 'Ingenieurin Kaia Rhee', tmdbProfile: '/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg' },\r\n    { name: 'Helena Ruiz', role: 'Strategin Tala Voss', tmdbProfile: '/ziEuG1ESSofxDCspotYlrwz3Tq.png' },\r\n  ],\r\n  seasons: [\r\n    {\r\n      title: 'Staffel 1',\r\n      seasonNumber: 1,\r\n      year: 2023,\r\n      thumbFile: 'https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg',\r\n      episodes: [\r\n        {\r\n          title: 'Kapitel Eins: Erwachen',\r\n          seasonNumber: 1,\r\n          episodeNumber: 1,\r\n          durationMin: 54,\r\n          originallyAvailableAt: '2023-09-14',\r\n          audienceRating: 8.6,\r\n        },\r\n        {\r\n          title: 'Kapitel Zwei: Grenzwelten',\r\n          seasonNumber: 1,\r\n          episodeNumber: 2,\r\n          durationMin: 52,\r\n          originallyAvailableAt: '2023-09-21',\r\n          audienceRating: 8.2,\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      title: 'Staffel 2',\r\n      seasonNumber: 2,\r\n      year: 2024,\r\n      thumbFile: 'https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg',\r\n      episodes: [\r\n        {\r\n          title: 'Kapitel Dreizehn: Resonanz',\r\n          seasonNumber: 2,\r\n          episodeNumber: 1,\r\n          durationMin: 56,\r\n          originallyAvailableAt: '2024-02-08',\r\n          audienceRating: 8.9,\r\n        },\r\n        {\r\n          title: 'Kapitel Vierzehn: Echo',\r\n          seasonNumber: 2,\r\n          episodeNumber: 2,\r\n          durationMin: 55,\r\n          originallyAvailableAt: '2024-02-15',\r\n          audienceRating: 8.7,\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg',\r\n  ids: { tmdb: 'demo-aurora-station', imdb: 'tt0000002' },\r\n};\r\n", "import { applyTabs } from './modal/tabs.js';\r\nimport { populateHead } from './modal/headerSection.js';\r\nimport { updateOverview } from './modal/overviewSection.js';\r\nimport { updateDetails } from './modal/detailsSection.js';\r\nimport { updateSeasons } from './modal/seasonsSection.js';\r\nimport { setExternalLinks } from './modal/externalLinks.js';\r\nimport { updateCast, buildCastList, setCastLoading, setCastStatus } from './modal/castSection.js';\r\nimport { getState } from './state.js';\r\nimport { loadShowDetail } from './data.js';\r\nimport { mapMovie, mapShow, mergeShowDetail, needsShowDetail } from './modal/shared.js';\r\nimport { getMovieEnriched, getTvEnriched } from './metadataService.js';\r\n\r\nlet overlayContainer = null;\r\nlet dialogEl = null;\r\nlet scrollContainer = null;\r\nlet rootEl = null;\r\nlet lastActiveElement = null;\r\nlet focusTrapHandler = null;\r\nlet escapeHandler = null;\r\nlet renderToken = 0;\r\nlet currentKind = null;\r\nlet currentItem = null;\r\n\r\nlet demoDataModulePromise = null;\r\nfunction loadDemoDataModule(){\r\n  if(!demoDataModulePromise){\r\n    demoDataModulePromise = import('./modal/demoData.js').catch(err=>{\r\n      console.warn('[modalV2] Demo-Daten konnten nicht geladen werden.', err);\r\n      return { DEMO_MOVIE: null, DEMO_SERIES: null };\r\n    });\r\n  }\r\n  return demoDataModulePromise;\r\n}\r\n\r\nfunction resolveRoot(){\r\n  if(rootEl) return rootEl;\r\n  const container = document.getElementById('modal-root-v2');\r\n  if(!container) return null;\r\n  overlayContainer = container;\r\n  container.classList.add('modalv2-overlay');\r\n  if(!container.hasAttribute('hidden')) container.setAttribute('hidden', '');\r\n  if(!container.dataset.modalv2Ready){\r\n    container.innerHTML = `\r\n      <div class=\"modalv2-backdrop\" data-modalv2-backdrop=\"1\"></div>\r\n      <div class=\"modalv2-dialog\" role=\"dialog\" aria-modal=\"true\">\r\n        <div class=\"modalv2-scroll\" data-modalv2-scroll></div>\r\n      </div>\r\n    `;\r\n    container.dataset.modalv2Ready = '1';\r\n    container.addEventListener('click', onOverlayClick);\r\n  }\r\n  dialogEl = container.querySelector('.modalv2-dialog');\r\n  if(dialogEl && !dialogEl.hasAttribute('tabindex')) dialogEl.setAttribute('tabindex', '-1');\r\n  scrollContainer = container.querySelector('[data-modalv2-scroll]');\r\n  if(scrollContainer && !rootEl){\r\n    const existing = scrollContainer.querySelector('.modalv2');\r\n    if(existing) rootEl = existing;\r\n    else {\r\n      rootEl = document.createElement('div');\r\n      rootEl.className = 'modalv2';\r\n      rootEl.setAttribute('hidden', '');\r\n      scrollContainer.appendChild(rootEl);\r\n    }\r\n  }\r\n  return rootEl;\r\n}\r\n\r\nfunction onOverlayClick(ev){\r\n  if(!overlayContainer) return;\r\n  const target = ev.target;\r\n  if(target === overlayContainer || (target && target.dataset && target.dataset.modalv2Backdrop)){ closeModalV2(); }\r\n}\r\n\r\nfunction getFocusableElements(){\r\n  if(!dialogEl) return [];\r\n  const selectors = 'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex=\"-1\"])';\r\n  return Array.from(dialogEl.querySelectorAll(selectors)).filter(el=>{\r\n    if(el.hasAttribute('disabled')) return false;\r\n    if(el.getAttribute('aria-hidden') === 'true') return false;\r\n    if(el.hasAttribute('hidden')) return false;\r\n    return el.offsetParent !== null;\r\n  });\r\n}\r\n\r\nfunction bindFocusTrap(){\r\n  if(!dialogEl) return;\r\n  if(focusTrapHandler){ dialogEl.removeEventListener('keydown', focusTrapHandler); }\r\n  focusTrapHandler = (ev)=>{\r\n    if(ev.key !== 'Tab') return;\r\n    const focusables = getFocusableElements();\r\n    if(!focusables.length) return;\r\n    const first = focusables[0];\r\n    const last = focusables[focusables.length - 1];\r\n    if(ev.shiftKey){\r\n      if(document.activeElement === first){ ev.preventDefault(); last.focus(); }\r\n    }else if(document.activeElement === last){\r\n      ev.preventDefault(); first.focus();\r\n    }\r\n  };\r\n  dialogEl.addEventListener('keydown', focusTrapHandler);\r\n}\r\n\r\nfunction unbindFocusTrap(){\r\n  if(!dialogEl || !focusTrapHandler) return;\r\n  dialogEl.removeEventListener('keydown', focusTrapHandler);\r\n  focusTrapHandler = null;\r\n}\r\n\r\nfunction bindEscape(){\r\n  if(escapeHandler) return;\r\n  escapeHandler = (ev)=>{\r\n    if(ev.key === 'Escape'){ ev.preventDefault(); closeModalV2(); }\r\n  };\r\n  window.addEventListener('keydown', escapeHandler);\r\n}\r\n\r\nfunction unbindEscape(){\r\n  if(!escapeHandler) return;\r\n  window.removeEventListener('keydown', escapeHandler);\r\n  escapeHandler = null;\r\n}\r\n\r\nfunction showOverlay(){\r\n  const root = resolveRoot();\r\n  if(!root || !overlayContainer) return null;\r\n  overlayContainer.hidden = false;\r\n  overlayContainer.setAttribute('aria-hidden', 'false');\r\n  document.body.classList.add('modalv2-open');\r\n  if(scrollContainer) scrollContainer.scrollTop = 0;\r\n  bindFocusTrap();\r\n  bindEscape();\r\n\r\n  return root;\r\n}\r\n\r\nfunction focusInitial(){\r\n  if(!dialogEl) return;\r\n  const closeBtn = dialogEl.querySelector('#v2Close');\r\n  const focusables = getFocusableElements();\r\n  let target = (closeBtn && !closeBtn.hasAttribute('hidden')) ? closeBtn : focusables[0];\r\n  if(!target) target = dialogEl;\r\n  if(target){\r\n    const focus = ()=>{\r\n      try{ target.focus(); }\r\n      catch(err){ console.warn('[modalV2] Failed to focus target element:', err?.message || err); }\r\n    };\r\n    (window.requestAnimationFrame || setTimeout)(focus, 0);\r\n  }\r\n}\r\n\r\nfunction setTmdbStatus(rootOrPayload, maybePayload){\r\n  let root = rootOrPayload;\r\n  let payload = maybePayload;\r\n  if(!(root instanceof HTMLElement)){\r\n    payload = rootOrPayload;\r\n    root = null;\r\n  }\r\n  const targetRoot = root instanceof HTMLElement ? root : rootEl;\r\n  if(!targetRoot) return;\r\n  const statusEl = targetRoot.querySelector('[data-head-status]');\r\n  if(!statusEl) return;\r\n  if(!payload){\r\n    statusEl.hidden = true;\r\n    statusEl.textContent = '';\r\n    statusEl.dataset.state = '';\r\n    return;\r\n  }\r\n  const { state='', message='' } = payload;\r\n  statusEl.dataset.state = state || '';\r\n  statusEl.textContent = message || '';\r\n  statusEl.hidden = !message;\r\n}\r\n\r\nexport function showModalV2Loading(message='Details werden geladen \u2026'){\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  root.hidden = false;\r\n  const loadingDiv = document.createElement('div');\r\n  loadingDiv.className = 'modalv2-loading';\r\n  loadingDiv.textContent = String(message || 'Details werden geladen \u2026');\r\n  root.replaceChildren(loadingDiv);\r\n}\r\n\r\nexport function renderModalV2(item){\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  root.hidden = false;\r\n  const hasSeasons = item?.type === 'tv';\r\n  root.innerHTML = `\r\n    <section class=\"v2-layout\">\r\n      <aside class=\"v2-side\">\r\n        <div class=\"v2-poster\"><img alt=\"\"></div>\r\n        <div class=\"v2-facts\" aria-label=\"Schnellinfos\" hidden>\r\n          <h3 class=\"v2-facts-title\">Schnellinfos</h3>\r\n          <dl class=\"v2-facts-list\"></dl>\r\n        </div>\r\n      </aside>\r\n      <div class=\"v2-info\">\r\n        <header class=\"v2-head\" data-tmdb-section>\r\n          <div class=\"v2-head-visual\" data-head-visual>\r\n            <div class=\"v2-head-hero\" data-head-hero>\r\n              <div class=\"v2-head-backdrop\" data-head-backdrop></div>\r\n              <div class=\"v2-head-overlay-logo\" data-head-overlay-logo hidden></div>\r\n              <div class=\"v2-head-overlay-meta\" data-head-overlay-meta hidden></div>\r\n            </div>\r\n            <div class=\"v2-head-logo\" data-head-logo hidden></div>\r\n          </div>\r\n          <p class=\"v2-head-status\" data-head-status hidden aria-live=\"polite\" aria-atomic=\"true\"></p>\r\n          <div class=\"v2-titlebar\">\r\n            <div class=\"v2-title-wrap\">\r\n              <h2 class=\"v2-title\" id=\"modalV2Title\"></h2>\r\n              <div class=\"v2-subline\"></div>\r\n              <div class=\"v2-meta\"></div>\r\n            </div>\r\n            <div class=\"v2-actions\" aria-label=\"Externe Aktionen\">\r\n              <button class=\"v2-icon-btn\" id=\"v2Close\" type=\"button\" aria-label=\"Schlie\u00DFen\">\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M6 6l12 12M6 18L18 6\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\r\n                </svg>\r\n              </button>\r\n              <a class=\"v2-icon-btn\" id=\"v2Tmdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf TMDB \u00F6ffnen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\r\n                  <path d=\"M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\r\n                </svg>\r\n              </a>\r\n              <a class=\"v2-icon-btn\" id=\"v2Imdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf IMDb \u00F6ffnen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\r\n                </svg>\r\n              </a>\r\n              <button class=\"v2-icon-btn\" id=\"v2Trailer\" type=\"button\" aria-label=\"Trailer abspielen\" hidden>\r\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\r\n                  <path d=\"M9 6l8 6-8 6V6z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\" stroke-linecap=\"round\"></path>\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"v2-chips\" aria-label=\"Attribute\"></div>\r\n        </header>\r\n        <nav class=\"v2-tabs\" aria-label=\"Details Navigation\" role=\"tablist\">\r\n          <button type=\"button\" data-t=\"overview\" class=\"active\" id=\"v2TabOverview\" role=\"tab\" aria-controls=\"v2PaneOverview\" aria-selected=\"true\">\u00DCberblick</button>\r\n          <button type=\"button\" data-t=\"details\" id=\"v2TabDetails\" role=\"tab\" aria-controls=\"v2PaneDetails\" aria-selected=\"false\">Details</button>\r\n          ${hasSeasons ? '<button type=\"button\" data-t=\"seasons\" id=\"v2TabSeasons\" role=\"tab\" aria-controls=\"v2PaneSeasons\" aria-selected=\"false\">Staffeln</button>' : ''}\r\n          <button type=\"button\" data-t=\"cast\" id=\"v2TabCast\" role=\"tab\" aria-controls=\"v2PaneCast\" aria-selected=\"false\">Cast</button>\r\n        </nav>\r\n        <section class=\"v2-body\">\r\n          <div class=\"v2-pane v2-overview\" data-pane=\"overview\" id=\"v2PaneOverview\" role=\"tabpanel\" aria-labelledby=\"v2TabOverview\"></div>\r\n          <div class=\"v2-pane v2-details\" data-pane=\"details\" id=\"v2PaneDetails\" role=\"tabpanel\" aria-labelledby=\"v2TabDetails\" hidden></div>\r\n          ${hasSeasons ? '<div class=\"v2-pane v2-seasons\" data-pane=\"seasons\" id=\"v2PaneSeasons\" role=\"tabpanel\" aria-labelledby=\"v2TabSeasons\" hidden></div>' : ''}\r\n          <div class=\"v2-pane v2-cast\" data-pane=\"cast\" id=\"v2PaneCast\" role=\"tabpanel\" aria-labelledby=\"v2TabCast\" hidden></div>\r\n        </section>\r\n        <footer class=\"v2-footer\" aria-label=\"Produktionslogos & Attribution\" hidden>\r\n          <div class=\"v2-footer-logos\" aria-label=\"Produktionsfirmen und Netzwerke\"></div>\r\n          <p class=\"v2-footer-note\"></p>\r\n        </footer>\r\n      </div>\r\n    </section>\r\n  `;\r\n\r\n  populateHead(root, item);\r\n  setExternalLinks(root, item);\r\n  updateOverview(root, item);\r\n  updateDetails(root, item);\r\n  if(item?.type === 'tv'){ updateSeasons(root, item); }\r\n  updateCast(root, buildCastList(item));\r\n  setCastLoading(root, false);\r\n  setCastStatus(root, null);\r\n  setTmdbStatus(root, null);\r\n  applyTabs(root);\r\n  const closeBtn = root.querySelector('#v2Close');\r\n  if(closeBtn){\r\n    closeBtn.addEventListener('click', closeModalV2);\r\n  }\r\n  if(dialogEl) dialogEl.setAttribute('aria-labelledby', 'modalV2Title');\r\n  focusInitial();\r\n}\r\n\r\nfunction refreshModalSections(item){\r\n  const root = rootEl;\r\n  if(!root) return;\r\n  populateHead(root, item);\r\n  setExternalLinks(root, item);\r\n  updateOverview(root, item);\r\n  updateDetails(root, item);\r\n  updateCast(root, buildCastList(item));\r\n}\r\n\r\nfunction maybeStartTmdbEnrichment(kind, item, tokenSnapshot){\r\n  if(!shouldUseTmdbEnrichment(item)) return;\r\n  if(item?.tmdbDetail){\r\n    refreshModalSections(item);\r\n    return;\r\n  }\r\n  const tmdbId = resolveTmdbId(item);\r\n  if(!tmdbId) return;\r\n  const activeToken = tokenSnapshot ?? renderToken;\r\n  setTmdbStatus({ state: 'loading', message: 'TMDB-Daten werden geladen \u2026' });\r\n  setCastLoading(rootEl, true);\r\n  setCastStatus(rootEl, { state: 'loading', message: 'Cast wird angereichert \u2026' });\r\n  const fetcher = kind === 'tv' ? getTvEnriched : getMovieEnriched;\r\n  fetcher(tmdbId).then(detail => {\r\n    if(activeToken !== renderToken) return;\r\n    if(!detail){\r\n      setTmdbStatus({ state: 'error', message: 'Keine zus\u00E4tzlichen TMDB-Daten gefunden.' });\r\n      setCastLoading(rootEl, false);\r\n      setCastStatus(rootEl, null);\r\n      return;\r\n    }\r\n    const enriched = attachTmdbDetail(item, detail);\r\n    if(enriched){\r\n      currentItem = enriched;\r\n      refreshModalSections(enriched);\r\n    }\r\n    setTmdbStatus(null);\r\n    setCastLoading(rootEl, false);\r\n    setCastStatus(rootEl, null);\r\n  }).catch(err => {\r\n    if(activeToken !== renderToken) return;\r\n    console.warn('[modalV2] Failed to enrich modal with TMDB data:', err?.message || err);\r\n    // Provide more specific error messages based on error type\r\n    let errorMessage = 'TMDB-Daten konnten nicht geladen werden.';\r\n    if(err?.status === 429){\r\n      errorMessage = 'TMDB-Rate-Limit erreicht. Bitte versuchen Sie es sp\u00E4ter erneut.';\r\n    }else if(err?.status === 404){\r\n      errorMessage = 'Inhalt nicht in TMDB gefunden.';\r\n    }else if(err?.message?.includes('network') || err?.message?.includes('fetch')){\r\n      errorMessage = 'Netzwerkfehler. Bitte \u00FCberpr\u00FCfen Sie Ihre Verbindung.';\r\n    }\r\n    setTmdbStatus({ state: 'error', message: errorMessage });\r\n    setCastLoading(rootEl, false);\r\n    setCastStatus(rootEl, { state: 'error', message: 'Zus\u00E4tzliche Besetzung konnte nicht geladen werden.' });\r\n  });\r\n}\r\n\r\nfunction shouldUseTmdbEnrichment(item){\r\n  if(!item) return false;\r\n  if(!window?.FEATURES?.tmdbEnrichment) return false;\r\n  if(!hasTmdbCredentials()) return false;\r\n  if(!resolveTmdbId(item)) return false;\r\n  return true;\r\n}\r\n\r\nfunction hasTmdbCredentials(){\r\n  try{\r\n    const stored = localStorage.getItem('tmdbToken');\r\n    if(stored && stored.trim()) return true;\r\n  }catch(err){\r\n    console.warn('[modalV2] Unable to read TMDB credentials from storage:', err?.message || err);\r\n  }\r\n  const cfg = getState().cfg || {};\r\n  return !!(cfg.tmdbToken || cfg.tmdbApiKey);\r\n}\r\n\r\nfunction resolveTmdbId(item){\r\n  if(!item) return '';\r\n  const ids = item.ids || {};\r\n  return ids.tmdb || item.tmdbId || item?.tmdb?.id || '';\r\n}\r\n\r\nfunction attachTmdbDetail(item, detail){\r\n  if(!item || !detail) return item;\r\n  // Create a shallow clone to avoid mutating the original\r\n  const enriched = { ...item };\r\n  enriched.tmdbDetail = detail;\r\n  enriched.tmdb = { ...(item.tmdb || {}) };\r\n  if(detail.poster && !enriched.tmdb.poster) enriched.tmdb.poster = detail.poster;\r\n  if(detail.backdrop && !enriched.tmdb.backdrop) enriched.tmdb.backdrop = detail.backdrop;\r\n  if(detail.url) enriched.tmdb.url = detail.url;\r\n  enriched.ids = { ...(item.ids || {}) };\r\n  if(detail.id) enriched.ids.tmdb = String(detail.id);\r\n  if(detail.imdbId && !enriched.ids.imdb) enriched.ids.imdb = String(detail.imdbId);\r\n  return enriched;\r\n}\r\n\r\nexport async function openMovieModalV2(idOrData){\r\n  const token = ++renderToken;\r\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  const data = await resolveMovieData(idOrData);\r\n  if(token !== renderToken) return;\r\n  if(!data){\r\n    root.hidden = false;\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'modalv2-loading';\r\n    errorDiv.textContent = 'Film konnte nicht geladen werden.';\r\n    root.replaceChildren(errorDiv);\r\n    currentItem = null;\r\n    currentKind = null;\r\n    focusInitial();\r\n    return;\r\n  }\r\n  currentItem = data;\r\n  currentKind = 'movie';\r\n  renderModalV2(data);\r\n  maybeStartTmdbEnrichment('movie', data, token);\r\n}\r\n\r\nexport async function openSeriesModalV2(idOrData){\r\n  const token = ++renderToken;\r\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n  const base = await resolveSeriesData(idOrData);\r\n  const root = showOverlay();\r\n  if(!root) return;\r\n  if(token !== renderToken) return;\r\n  if(!base){\r\n    root.hidden = false;\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.className = 'modalv2-loading';\r\n    errorDiv.textContent = 'Seriendetails konnten nicht geladen werden.';\r\n    root.replaceChildren(errorDiv);\r\n    currentItem = null;\r\n    currentKind = null;\r\n    focusInitial();\r\n    return;\r\n  }\r\n  currentItem = base;\r\n  currentKind = 'show';\r\n  let working = base;\r\n  if(needsShowDetail(working)){\r\n    showModalV2Loading();\r\n    if(token !== renderToken) return;\r\n    let detail = null;\r\n    try{ detail = await loadShowDetail(working); }\r\n    catch(err){\r\n      detail = null;\r\n      console.warn('[modalV2] Failed to load show detail in modal:', err?.message || err);\r\n    }\r\n    if(token !== renderToken) return;\r\n    if(detail){ mergeShowDetail(working, detail); currentItem = working; }\r\n  }\r\n  if(token !== renderToken) return;\r\n  renderModalV2(working);\r\n  maybeStartTmdbEnrichment('tv', working, token);\r\n}\r\n\r\nexport function closeModalV2(){\r\n  renderToken++;\r\n  if(!overlayContainer) return;\r\n  overlayContainer.hidden = true;\r\n  overlayContainer.setAttribute('aria-hidden', 'true');\r\n  document.body.classList.remove('modalv2-open');\r\n  unbindFocusTrap();\r\n  unbindEscape();\r\n  if(rootEl){\r\n    rootEl.innerHTML = '';\r\n    rootEl.setAttribute('hidden', '');\r\n  }\r\n  if(scrollContainer) scrollContainer.scrollTop = 0;\r\n  if(lastActiveElement && typeof lastActiveElement.focus === 'function'){\r\n    try{ lastActiveElement.focus(); }\r\n    catch(err){ console.warn('[modalV2] Failed to restore focus to last active element:', err?.message || err); }\r\n  }\r\n  lastActiveElement = null;\r\n  currentItem = null;\r\n  currentKind = null;\r\n}\r\n\r\nexport function isModalV2Open(){\r\n  return Boolean(overlayContainer && !overlayContainer.hidden);\r\n}\r\n\r\nexport function getModalV2Context(){\r\n  return currentItem ? { item: currentItem, kind: currentKind } : { item: null, kind: null };\r\n}\r\n\r\nasync function resolveMovieData(idOrData){\r\n  if(idOrData === 'demo'){\r\n    const { DEMO_MOVIE } = await loadDemoDataModule();\r\n    return mapMovie(DEMO_MOVIE);\r\n  }\r\n  if(idOrData && typeof idOrData === 'object') return mapMovie(idOrData);\r\n  const str = idOrData == null ? '' : String(idOrData).trim();\r\n  if(!str) return null;\r\n  const state = getState();\r\n  const movies = Array.isArray(state?.movies) ? state.movies : [];\r\n  const match = movies.find(movie => matchesIdentifier(movie, str));\r\n  return match ? mapMovie(match) : null;\r\n}\r\n\r\nasync function resolveSeriesData(idOrData){\r\n  if(idOrData === 'demo'){\r\n    const { DEMO_SERIES } = await loadDemoDataModule();\r\n    return mapShow(DEMO_SERIES);\r\n  }\r\n  if(idOrData && typeof idOrData === 'object') return mapShow(idOrData);\r\n  const str = idOrData == null ? '' : String(idOrData).trim();\r\n  if(!str) return null;\r\n  const state = getState();\r\n  const shows = Array.isArray(state?.shows) ? state.shows : [];\r\n  const match = shows.find(show => matchesIdentifier(show, str));\r\n  return match ? mapShow(match) : null;\r\n}\r\n\r\nfunction matchesIdentifier(item, id){\r\n  if(!item) return false;\r\n  const str = String(id || '').trim();\r\n  if(!str) return false;\r\n  if(item?.ids?.imdb && String(item.ids.imdb) === str) return true;\r\n  if(item?.ids?.tmdb && String(item.ids.tmdb) === str) return true;\r\n  if(item?.ratingKey != null && String(item.ratingKey) === str) return true;\r\n  return false;\r\n}\r\n", "const DEFAULT_ESTIMATED_HEIGHT = 420;\r\nconst DEFAULT_MIN_WIDTH = 190;\r\n\r\nconst raf = typeof requestAnimationFrame === 'function'\r\n  ? requestAnimationFrame\r\n  : (cb)=> setTimeout(cb, 16);\r\nconst caf = typeof cancelAnimationFrame === 'function'\r\n  ? cancelAnimationFrame\r\n  : (id)=> clearTimeout(id);\r\n\r\nfunction noop(){}\r\n\r\nfunction parsePx(value){\r\n  const num = parseFloat(value);\r\n  return Number.isFinite(num) ? num : 0;\r\n}\r\n\r\nexport class VirtualList {\r\n  constructor({\r\n    container,\r\n    renderItem,\r\n    getKey = noop,\r\n    updateItem = null,\r\n    getSignature = null,\r\n    overscan = 2,\r\n    estimatedItemHeight = DEFAULT_ESTIMATED_HEIGHT,\r\n    minItemWidth = DEFAULT_MIN_WIDTH\r\n  }){\r\n    if(!container) throw new Error('VirtualList requires a container element');\r\n    if(typeof renderItem !== 'function') throw new Error('VirtualList requires a renderItem function');\r\n\r\n    this.container = container;\r\n    this.renderItem = renderItem;\r\n    this.getKey = getKey;\r\n    this.updateItem = typeof updateItem === 'function' ? updateItem : null;\r\n    this.getSignature = typeof getSignature === 'function' ? getSignature : null;\r\n    this.overscan = Math.max(0, overscan|0);\r\n    this.estimatedItemHeight = estimatedItemHeight;\r\n    this.minItemWidth = minItemWidth;\r\n\r\n    this.items = [];\r\n    this.range = { start: 0, end: 0 };\r\n    this.columns = 1;\r\n    this.rowCount = 0;\r\n    this.rowHeight = this.estimatedItemHeight;\r\n    this.totalHeight = 0;\r\n    this.itemHeight = this.estimatedItemHeight;\r\n    this.containerTop = 0;\r\n    this.paddingTop = 0;\r\n    this.paddingBottom = 0;\r\n    this.gapY = 0;\r\n    this.gapX = 0;\r\n    this.metricsDirty = true;\r\n    this.pendingFrame = 0;\r\n    this.lastWidth = 0;\r\n\r\n    this.nodeCache = new Map();\r\n    this.renderedKeys = new Set();\r\n    this.itemSignatures = new Map();\r\n    this.scrollTicking = false;\r\n\r\n    this.spacer = document.createElement('div');\r\n    this.spacer.className = 'grid-virtual__spacer';\r\n    this.windowEl = document.createElement('div');\r\n    this.windowEl.className = 'grid-virtual__window';\r\n    this.itemsHost = document.createElement('div');\r\n    this.itemsHost.className = 'grid-virtual__items';\r\n\r\n    this.container.textContent = '';\r\n    this.windowEl.append(this.itemsHost);\r\n    this.container.append(this.spacer, this.windowEl);\r\n\r\n    this.measureRoot = document.createElement('div');\r\n    this.measureRoot.className = 'grid-virtual__measure';\r\n    this.measureRoot.setAttribute('aria-hidden', 'true');\r\n    Object.assign(this.measureRoot.style, {\r\n      position: 'absolute',\r\n      visibility: 'hidden',\r\n      pointerEvents: 'none',\r\n      inset: '0 auto auto 0',\r\n      zIndex: '-1'\r\n    });\r\n    this.container.append(this.measureRoot);\r\n\r\n    this.handleScroll = this.handleScroll.bind(this);\r\n    this.handleResize = this.handleResize.bind(this);\r\n    this.update = this.update.bind(this);\r\n\r\n    window.addEventListener('scroll', this.handleScroll, { passive: true });\r\n    window.addEventListener('resize', this.handleResize);\r\n\r\n    if(typeof ResizeObserver === 'function'){\r\n      this.resizeObserver = new ResizeObserver(this.handleResize);\r\n      this.resizeObserver.observe(this.container);\r\n    } else {\r\n      this.resizeObserver = null;\r\n    }\r\n  }\r\n\r\n  destroy(){\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n    window.removeEventListener('resize', this.handleResize);\r\n    if(this.resizeObserver){\r\n      this.resizeObserver.disconnect();\r\n    }\r\n    if(this.pendingFrame){\r\n      caf(this.pendingFrame);\r\n      this.pendingFrame = 0;\r\n    }\r\n    this.nodeCache.clear();\r\n    this.renderedKeys.clear();\r\n    this.itemSignatures.clear();\r\n    this.items = [];\r\n    this.spacer.remove();\r\n    this.windowEl.remove();\r\n    this.measureRoot.remove();\r\n  }\r\n\r\n  schedule(force = false){\r\n    if(force) this.metricsDirty = true;\r\n    if(this.pendingFrame) return;\r\n    this.pendingFrame = raf(()=>{\r\n      this.pendingFrame = 0;\r\n      this.update();\r\n    });\r\n  }\r\n\r\n  handleScroll(){\r\n    if(this.scrollTicking) return;\r\n    this.scrollTicking = true;\r\n    this.schedule(false);\r\n    raf(()=>{\r\n      this.scrollTicking = false;\r\n    });\r\n  }\r\n\r\n  handleResize(){\r\n    const width = this.container.clientWidth;\r\n    if(width !== this.lastWidth){\r\n      this.metricsDirty = true;\r\n      this.lastWidth = width;\r\n    }\r\n    this.schedule(true);\r\n  }\r\n\r\n  setItems(list){\r\n    this.items = Array.isArray(list) ? list.slice() : [];\r\n    this.metricsDirty = true;\r\n    this.pruneCache();\r\n    this.measureItems();\r\n    this.update();\r\n  }\r\n\r\n  measureItems(){\r\n    if(!this.items.length){\r\n      this.itemHeight = this.estimatedItemHeight;\r\n      return;\r\n    }\r\n    const sampleItem = this.items[0];\r\n    this.measureRoot.textContent = '';\r\n    const sample = this.renderItem(sampleItem, 0);\r\n    if(sample instanceof HTMLElement){\r\n      this.measureRoot.append(sample);\r\n      if(typeof sample.getBoundingClientRect === 'function'){\r\n        const rect = sample.getBoundingClientRect();\r\n        if(rect && rect.height > 0){\r\n          this.itemHeight = rect.height;\r\n        }\r\n      } else if(sample.offsetHeight){\r\n        this.itemHeight = sample.offsetHeight;\r\n      }\r\n    }\r\n    this.measureRoot.textContent = '';\r\n  }\r\n\r\n  pruneCache(){\r\n    if(!this.items.length){\r\n      this.nodeCache.forEach(node=> node.remove());\r\n      this.nodeCache.clear();\r\n      this.itemSignatures.clear();\r\n      this.renderedKeys.clear();\r\n      return;\r\n    }\r\n    const allowed = new Set();\r\n    const nextSignatures = this.getSignature ? new Map() : null;\r\n\r\n    this.items.forEach((item, idx)=>{\r\n      const key = this.keyFor(item, idx);\r\n      allowed.add(key);\r\n      if(nextSignatures){\r\n        const signature = this.signatureFor(item, idx);\r\n        nextSignatures.set(key, signature);\r\n        const prev = this.itemSignatures.get(key);\r\n        if(prev !== undefined && prev !== signature){\r\n          const node = this.nodeCache.get(key);\r\n          if(node){\r\n            if(node.parentNode) node.parentNode.removeChild(node);\r\n            this.nodeCache.delete(key);\r\n            this.renderedKeys.delete(key);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    this.nodeCache.forEach((node, key)=>{\r\n      if(!allowed.has(key)){\r\n        if(node.parentNode) node.parentNode.removeChild(node);\r\n        this.nodeCache.delete(key);\r\n        this.renderedKeys.delete(key);\r\n      }\r\n    });\r\n\r\n    if(nextSignatures){\r\n      this.itemSignatures = nextSignatures;\r\n    } else {\r\n      this.itemSignatures.clear();\r\n    }\r\n  }\r\n\r\n  keyFor(item, index){\r\n    const raw = this.getKey ? this.getKey(item, index) : null;\r\n    if(raw === undefined || raw === null || raw === ''){\r\n      return `index-${index}`;\r\n    }\r\n    return String(raw);\r\n  }\r\n\r\n  signatureFor(item, index){\r\n    if(!this.getSignature) return undefined;\r\n    try {\r\n      return this.getSignature(item, index);\r\n    } catch (err) {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  refreshMetrics(){\r\n    const containerStyle = getComputedStyle(this.container);\r\n    this.paddingTop = parsePx(containerStyle.paddingTop);\r\n    this.paddingBottom = parsePx(containerStyle.paddingBottom);\r\n\r\n    const hostStyle = getComputedStyle(this.itemsHost);\r\n    const rowGap = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('row-gap') : hostStyle.rowGap;\r\n    const colGap = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('column-gap') : hostStyle.columnGap;\r\n    const gapFallback = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('gap') : hostStyle.gap;\r\n\r\n    this.gapY = parsePx(rowGap || gapFallback);\r\n    this.gapX = parsePx(colGap || gapFallback);\r\n\r\n    const rawColumns = Math.floor((this.container.clientWidth + this.gapX) / (this.minItemWidth + this.gapX));\r\n    this.columns = Math.max(1, rawColumns || 1);\r\n    this.rowHeight = this.itemHeight + this.gapY;\r\n    if(this.rowHeight <= 0) this.rowHeight = this.itemHeight || this.estimatedItemHeight;\r\n    this.rowCount = this.columns > 0 ? Math.ceil(this.items.length / this.columns) : this.items.length;\r\n    this.totalHeight = Math.max(0, this.rowCount * this.rowHeight);\r\n\r\n    this.updateContainerPosition();\r\n\r\n    this.spacer.style.height = `${this.totalHeight}px`;\r\n    this.windowEl.style.top = `${this.paddingTop}px`;\r\n    this.windowEl.style.paddingBottom = `${this.paddingBottom}px`;\r\n    this.metricsDirty = false;\r\n  }\r\n\r\n  updateContainerPosition(){\r\n    let el = this.container;\r\n    let top = 0;\r\n    while(el && el !== document.body){\r\n      top += el.offsetTop;\r\n      el = el.offsetParent;\r\n    }\r\n    this.containerTop = top;\r\n  }\r\n\r\n  update(){\r\n    if(this.metricsDirty){\r\n      this.refreshMetrics();\r\n    }\r\n    this.syncVisibleRange();\r\n  }\r\n\r\n  syncVisibleRange(){\r\n    if(!this.items.length){\r\n      this.windowEl.style.transform = 'translate3d(0, 0, 0)';\r\n      this.itemsHost.replaceChildren();\r\n      this.range = { start: 0, end: 0 };\r\n      return;\r\n    }\r\n\r\n    const viewportTop = window.scrollY;\r\n    const viewportBottom = viewportTop + window.innerHeight;\r\n    const listStart = this.containerTop + this.paddingTop;\r\n    const listEnd = listStart + this.totalHeight;\r\n\r\n    if(window.__VLIST_DEBUG){\r\n      console.log('\uD83D\uDCCA VirtualList Debug:', {\r\n        'Scroll-Position': Math.round(window.scrollY) + 'px',\r\n        'Grid startet bei': Math.round(this.containerTop) + 'px',\r\n        'Zeilen-H\u00F6he': Math.round(this.rowHeight) + 'px',\r\n        'Spalten': this.columns,\r\n        'Gesamt-H\u00F6he': Math.round(this.totalHeight) + 'px',\r\n        'Sichtbarer Bereich': `Row ${Math.floor((viewportTop - listStart) / this.rowHeight)} - ${Math.ceil((viewportBottom - listStart) / this.rowHeight)}`\r\n      });\r\n    }\r\n\r\n    let startRow;\r\n    if(viewportTop <= listStart){\r\n      startRow = 0;\r\n    } else if(viewportTop >= listEnd){\r\n      startRow = Math.max(0, this.rowCount - 1);\r\n    } else {\r\n      startRow = Math.floor((viewportTop - listStart) / this.rowHeight);\r\n    }\r\n\r\n    let endRow;\r\n    if(viewportBottom >= listEnd){\r\n      endRow = Math.max(0, this.rowCount - 1);\r\n    } else if(viewportBottom <= listStart){\r\n      endRow = 0;\r\n    } else {\r\n      endRow = Math.ceil((viewportBottom - listStart) / this.rowHeight);\r\n    }\r\n\r\n    startRow = Math.max(0, Math.min(startRow, Math.max(0, this.rowCount - 1)) - this.overscan);\r\n    endRow = Math.min(Math.max(0, this.rowCount - 1), endRow + this.overscan);\r\n\r\n    const start = Math.max(0, Math.min(this.items.length, startRow * this.columns));\r\n    const end = Math.max(start, Math.min(this.items.length, (endRow + 1) * this.columns));\r\n\r\n    if(start === this.range.start && end === this.range.end){\r\n      let needsRefresh = false;\r\n      for(let i=start; i<end; i++){\r\n        const key = this.keyFor(this.items[i], i);\r\n        if(!this.renderedKeys.has(key)){\r\n          needsRefresh = true;\r\n          break;\r\n        }\r\n      }\r\n      if(!needsRefresh){\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.range = { start, end };\r\n    const offsetRow = Math.floor(start / this.columns);\r\n    const offsetY = offsetRow * this.rowHeight;\r\n    this.windowEl.style.transform = `translate3d(0, ${offsetY}px, 0)`;\r\n\r\n    const nextRendered = new Set();\r\n    const toRender = [];\r\n\r\n    for(let i=start; i<end; i++){\r\n      const item = this.items[i];\r\n      const key = this.keyFor(item, i);\r\n      let node = this.nodeCache.get(key);\r\n      if(node){\r\n        if(this.updateItem){\r\n          const updated = this.updateItem(node, item, i);\r\n          if(updated instanceof HTMLElement && updated !== node){\r\n            node = updated;\r\n            this.nodeCache.set(key, node);\r\n          } else if(!(updated instanceof HTMLElement)){\r\n            continue;\r\n          }\r\n        }\r\n      } else {\r\n        node = this.renderItem(item, i);\r\n        if(!(node instanceof HTMLElement)) continue;\r\n        this.nodeCache.set(key, node);\r\n      }\r\n      nextRendered.add(key);\r\n      toRender.push(node);\r\n    }\r\n\r\n    // Reconcile DOM with minimal operations\r\n    const currentChildren = this.itemsHost.children;\r\n\r\n    // Quick path: exact same content\r\n    if(currentChildren.length === toRender.length){\r\n      let same = true;\r\n      for(let i = 0; i < toRender.length; i++){\r\n        if(currentChildren[i] !== toRender[i]){\r\n          same = false;\r\n          break;\r\n        }\r\n      }\r\n      if(same){\r\n        this.renderedKeys = nextRendered;\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Build a map of current positions\r\n    const currentMap = new Map();\r\n    for(let i = 0; i < currentChildren.length; i++){\r\n      currentMap.set(currentChildren[i], i);\r\n    }\r\n\r\n    // Update nodes position by position\r\n    for(let i = 0; i < toRender.length; i++){\r\n      const desired = toRender[i];\r\n      const current = currentChildren[i];\r\n\r\n      if(current !== desired){\r\n        if(currentMap.has(desired)){\r\n          // Node exists somewhere - move it\r\n          this.itemsHost.insertBefore(desired, current || null);\r\n        } else {\r\n          // New node - insert it\r\n          this.itemsHost.insertBefore(desired, current || null);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Remove any extra nodes at the end\r\n    while(this.itemsHost.children.length > toRender.length){\r\n      this.itemsHost.lastChild.remove();\r\n    }\r\n\r\n    this.renderedKeys = nextRendered;\r\n  }\r\n}\r\n", "import { getState } from './state.js';\r\nimport { el } from './dom.js';\r\nimport { humanYear, formatRating, renderChipsLimited, useTmdbForCards, isNew, getGenreNames, collectionTags } from './utils.js';\r\nimport * as Watch from './watchlist.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { navigateToHash } from './main.js';\r\nimport { VirtualList } from './grid/virtualList.js';\r\n\r\nconst CARD_SIGNATURE_PROP = '__gridVirtualSignature';\r\n\r\nfunction cardEl(item){\r\n  const card = el('article','card');\r\n  card.dataset.kind = (item?.type === 'tv') ? 'show' : 'movie';\r\n  card.tabIndex = 0;\r\n  card.setAttribute('role', 'button');\r\n  if(item?.title) card.setAttribute('aria-label', item.title);\r\n\r\n  // 1) Media Block\r\n  const media = el('div','card__media');\r\n  const img = new Image();\r\n  img.loading = 'lazy';\r\n  img.decoding = 'async';\r\n  img.className = 'card__img';\r\n  img.alt = item?.title || '';\r\n  img.style.aspectRatio = '2 / 3';\r\n  const src = resolvePoster(item);\r\n  if(src) img.src = src;\r\n\r\n  const gradient = el('div','card__media-gradient');\r\n  gradient.setAttribute('aria-hidden','true');\r\n\r\n  const badges = buildItemBadges(item);\r\n  const badgeContainer = el('div','card__badges');\r\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\r\n\r\n  media.append(img, gradient);\r\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\r\n\r\n  const pct = progressPercent(item);\r\n  if(pct > 0){\r\n    const track = el('div','card__progress');\r\n    const fill = document.createElement('span');\r\n    fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;\r\n    track.append(fill);\r\n    media.append(track);\r\n  }\r\n\r\n  // 2) Info Block\r\n  const body = el('div','card__body');\r\n  const title = document.createElement('h3');\r\n  title.className = 'card__title';\r\n  title.textContent = item?.title || '';\r\n  if(item?.title) title.setAttribute('title', item.title);\r\n\r\n  const sub = el('div','card__meta');\r\n  const metaPieces = buildMetaPieces(item);\r\n  sub.textContent = metaPieces.join(' \u2022 ');\r\n\r\n  body.append(title, sub);\r\n\r\n  // 3) Actions Block\r\n  const actions = el('div','card__actions');\r\n\r\n  const chips = el('div','card__chips');\r\n  const genres = getGenreNames(item?.genres);\r\n  renderChipsLimited(chips, genres, 3);\r\n\r\n  const watchBtn = document.createElement('button');\r\n  watchBtn.type = 'button';\r\n  watchBtn.className = 'card__primary';\r\n  updateWatchButtonState(watchBtn, item);\r\n  watchBtn.addEventListener('click', ev=>{\r\n    ev.stopPropagation();\r\n    Watch.toggle(item);\r\n    updateWatchButtonState(watchBtn, item);\r\n  });\r\n\r\n  actions.append(chips, watchBtn);\r\n\r\n  card.append(media, body, actions);\r\n\r\n  card.addEventListener('click', ()=> openDetail(item));\r\n  card.addEventListener('keydown', ev=>{\r\n    if(ev.target !== card) return;\r\n    if(ev.key === 'Enter' || ev.key === ' '){\r\n      ev.preventDefault();\r\n      openDetail(item);\r\n    }\r\n  });\r\n\r\n  return card;\r\n}\r\n\r\nfunction createCollectionGroup(name, members){\r\n  const list = (members||[]).slice().sort((a,b)=>{\r\n    const ay = Number(humanYear(a)) || 0;\r\n    const by = Number(humanYear(b)) || 0;\r\n    if(ay !== by) return ay - by;\r\n    return (a.title||'').localeCompare(b.title||'', 'de');\r\n  });\r\n  const years = list.map(item=>Number(humanYear(item))||0).filter(Boolean);\r\n  const year = years.length ? Math.min(...years) : '';\r\n  const addedTimestamps = list.map(item=> new Date(item.addedAt||0).getTime()).filter(Number.isFinite);\r\n  const latestAdded = addedTimestamps.length ? new Date(Math.max(...addedTimestamps)).toISOString() : null;\r\n  const ratings = list.map(item=>Number(item.rating ?? item.audienceRating)).filter(Number.isFinite);\r\n  const rating = ratings.length ? ratings.reduce((sum,val)=>sum+val,0) / ratings.length : null;\r\n  const posterItem = list.find(entry=>entry.thumbFile) || list[0] || null;\r\n  const genres = Array.from(new Set(list.flatMap(entry=>getGenreNames(entry.genres)))).slice(0,4);\r\n  return { isCollectionGroup:true, type:'collection', title:name, collectionName:name, items:list, itemCount:list.length, year: year || '', addedAt: latestAdded, rating, posterItem, genres };\r\n}\r\n\r\nfunction groupCollectionsIfEnabled(items){\r\n  const togg = document.getElementById('groupCollections');\r\n  const colSel = document.getElementById('collectionFilter');\r\n  const selected = colSel && colSel.value;\r\n  if(!togg || !togg.checked) return items;\r\n  if(selected) return items; // drilling into a single collection -> show items, not groups\r\n  const membership = new Map();\r\n  items.forEach(item=>{\r\n    collectionTags(item).forEach(name=>{\r\n      if(!membership.has(name)) membership.set(name, []);\r\n      membership.get(name).push(item);\r\n    });\r\n  });\r\n  const groups = [];\r\n  membership.forEach((members, name)=>{ groups.push(createCollectionGroup(name, members)); });\r\n  // preserve stable order by title\r\n  groups.sort((a,b)=> a.title.localeCompare(b.title,'de'));\r\n  return groups;\r\n}\r\n\r\nfunction collectionCardEl(entry){\r\n  const card = el('article','card card--collection');\r\n  card.dataset.kind = 'collection';\r\n  card.tabIndex = 0;\r\n  card.setAttribute('role', 'button');\r\n  if(entry?.title) card.setAttribute('aria-label', entry.title);\r\n\r\n  // 1) Media Block\r\n  const media = el('div','card__media');\r\n  const baseItem = entry.posterItem || {};\r\n  const img = new Image();\r\n  img.loading = 'lazy';\r\n  img.decoding = 'async';\r\n  img.className = 'card__img';\r\n  img.alt = entry?.title || '';\r\n  img.style.aspectRatio = '2 / 3';\r\n  const src = resolvePoster(baseItem);\r\n  if(src) img.src = src;\r\n\r\n  const gradient = el('div','card__media-gradient');\r\n  gradient.setAttribute('aria-hidden','true');\r\n\r\n  const badges = buildCollectionBadges(entry);\r\n  const badgeContainer = el('div','card__badges');\r\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\r\n\r\n  media.append(img, gradient);\r\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\r\n\r\n  // 2) Info Block\r\n  const body = el('div','card__body');\r\n  const title = document.createElement('h3');\r\n  title.className = 'card__title';\r\n  title.textContent = entry.title || '';\r\n  if(entry?.title) title.setAttribute('title', entry.title);\r\n\r\n  const sub = el('div','card__meta');\r\n  const pieces = collectionMetaPieces(entry);\r\n  sub.textContent = pieces.filter(Boolean).join(' \u2022 ');\r\n\r\n  body.append(title, sub);\r\n\r\n  // 3) Actions Block\r\n  const actions = el('div','card__actions');\r\n  const chips = el('div','card__chips');\r\n  renderChipsLimited(chips, entry.genres||[], 3);\r\n  actions.append(chips);\r\n\r\n  card.append(media, body, actions);\r\n\r\n  card.addEventListener('click', ()=>{\r\n    const sel = document.getElementById('collectionFilter');\r\n    if(sel){\r\n      sel.value = entry.collectionName || entry.title || '';\r\n      sel.dispatchEvent(new Event('change', { bubbles:true }));\r\n    }\r\n  });\r\n\r\n  card.addEventListener('keydown', ev=>{\r\n    if(ev.target !== card) return;\r\n    if(ev.key === 'Enter' || ev.key === ' '){\r\n      ev.preventDefault();\r\n      const sel = document.getElementById('collectionFilter');\r\n      if(sel){\r\n        sel.value = entry.collectionName || entry.title || '';\r\n        sel.dispatchEvent(new Event('change', { bubbles:true }));\r\n      }\r\n    }\r\n  });\r\n\r\n  return card;\r\n}\r\n\r\nlet virtualListInstance = null;\r\n\r\nfunction ensureVirtualList(grid){\r\n  if(virtualListInstance) return virtualListInstance;\r\n  virtualListInstance = new VirtualList({\r\n    container: grid,\r\n    overscan: 1,\r\n    estimatedItemHeight: 460,\r\n    minItemWidth: 190,\r\n    getKey: itemKey,\r\n    getSignature: gridItemSignature,\r\n    renderItem(item){\r\n      const node = renderGridItemNode(item);\r\n      return node;\r\n    },\r\n    updateItem(node, item){\r\n      return refreshGridItemNode(node, item);\r\n    }\r\n  });\r\n  return virtualListInstance;\r\n}\r\n\r\nfunction itemKey(item, index){\r\n  if(item?.isCollectionGroup){\r\n    const key = item.collectionName || item.title || '';\r\n    return key ? `collection:${key}` : `collection-index-${index}`;\r\n  }\r\n  const id = resolveItemId(item);\r\n  return id ? `item:${id}` : `item-index-${index}`;\r\n}\r\n\r\nfunction renderGridItemNode(item){\r\n  const node = item?.isCollectionGroup ? collectionCardEl(item) : cardEl(item);\r\n  if(node instanceof HTMLElement){\r\n    node[CARD_SIGNATURE_PROP] = gridItemSignature(item);\r\n  }\r\n  return node;\r\n}\r\n\r\nfunction refreshGridItemNode(current, item){\r\n  if(current instanceof HTMLElement){\r\n    const signature = gridItemSignature(item);\r\n    if(current[CARD_SIGNATURE_PROP] === signature){\r\n      current[CARD_SIGNATURE_PROP] = signature;\r\n      return current;\r\n    }\r\n  }\r\n  const replacement = renderGridItemNode(item);\r\n  if(!(replacement instanceof HTMLElement)) return current;\r\n  return replaceCardNode(current, replacement);\r\n}\r\n\r\nlet lastRenderedView = null;\r\n\r\nexport function renderGrid(view){\r\n  const { movies, shows, filtered } = getState();\r\n  const base = (view==='shows' ? shows : movies) || [];\r\n  const list = Array.isArray(filtered) ? filtered : base;\r\n  const items = groupCollectionsIfEnabled(list);\r\n  const grid = document.getElementById('grid');\r\n  if(!grid) return;\r\n\r\n  const shouldAnimate = lastRenderedView !== view;\r\n  lastRenderedView = view;\r\n\r\n  if(shouldAnimate) beginGridTransition(grid);\r\n  const vlist = ensureVirtualList(grid);\r\n  vlist.setItems(items);\r\n  if(shouldAnimate) finishGridTransition(grid);\r\n  const empty = document.getElementById('empty');\r\n  if(empty) empty.hidden = items.length > 0;\r\n  grid.setAttribute('aria-busy', 'false');\r\n}\r\n\r\nfunction beginGridTransition(grid){\r\n  if(!grid) return;\r\n  grid.classList.remove('is-entering','is-ready');\r\n  grid.classList.add('is-leaving');\r\n}\r\n\r\nfunction finishGridTransition(grid){\r\n  if(!grid) return;\r\n  grid.classList.remove('is-leaving');\r\n  grid.classList.add('is-entering');\r\n  requestAnimationFrame(()=>{\r\n    grid.classList.add('is-ready');\r\n    setTimeout(()=>grid.classList.remove('is-entering','is-ready'), 240);\r\n  });\r\n}\r\n\r\n\r\nfunction resolvePoster(item){\r\n  if(!item) return '';\r\n  const tmdbPoster = useTmdbForCards() && (item?.tmdb?.poster || item?.tmdbPoster);\r\n  const fallback = item?.thumbFile || item?.poster || item?.art || item?.thumb || '';\r\n  return tmdbPoster || fallback || '';\r\n}\r\n\r\nfunction itemBadgeTexts(item){\r\n  const badges = [];\r\n  if(isNew(item)) badges.push('Neu');\r\n  const contentRating = String(item?.contentRating || '').trim();\r\n  if(contentRating) badges.push(contentRating);\r\n  const ratingNum = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(ratingNum)) badges.push(`\u2605 ${formatRating(ratingNum)}`);\r\n  return badges.slice(0, 3);\r\n}\r\n\r\nfunction buildItemBadges(item){\r\n  return itemBadgeTexts(item).map(createBadge);\r\n}\r\n\r\nfunction collectionBadgeTexts(entry){\r\n  const badges = [];\r\n  if(Number.isFinite(entry?.itemCount) && entry.itemCount > 0) badges.push(`${entry.itemCount} Titel`);\r\n  if(entry?.year) badges.push(String(entry.year));\r\n  return badges;\r\n}\r\n\r\nfunction buildCollectionBadges(entry){\r\n  return collectionBadgeTexts(entry).map(createBadge);\r\n}\r\n\r\nfunction createBadge(text){\r\n  const badge = document.createElement('span');\r\n  badge.className = 'badge';\r\n  badge.textContent = String(text || '');\r\n  return badge;\r\n}\r\n\r\nfunction updateWatchButtonState(button, item){\r\n  if(!button) return;\r\n  const saved = Watch.isSaved(item);\r\n  button.textContent = saved ? 'Gemerkt' : 'Merken';\r\n  button.classList.toggle('active', saved);\r\n  button.setAttribute('aria-pressed', saved ? 'true' : 'false');\r\n}\r\n\r\nfunction buildMetaPieces(item){\r\n  const pieces = [];\r\n  const year = humanYear(item);\r\n  if(year) pieces.push(String(year));\r\n  const runtime = formatRuntime(item);\r\n  if(runtime) pieces.push(runtime);\r\n  const rating = Number(item?.rating ?? item?.audienceRating);\r\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\r\n  const studio = item?.studio || item?.network || '';\r\n  if(studio) pieces.push(studio);\r\n  return pieces;\r\n}\r\n\r\nfunction collectionMetaPieces(entry){\r\n  const pieces = [];\r\n  if(entry?.year) pieces.push(String(entry.year));\r\n  const count = Number(entry?.itemCount);\r\n  if(Number.isFinite(count)) pieces.push(`${count} Titel`);\r\n  const rating = Number(entry?.rating);\r\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\r\n  return pieces;\r\n}\r\n\r\nfunction formatRuntime(item){\r\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\r\n  const minutes = Number(raw);\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\r\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\r\n  return `${minutes} min`;\r\n}\r\n\r\nfunction progressPercent(item){\r\n  const offset = Number(item?.viewOffset ?? item?.viewoffset);\r\n  const duration = Number(item?.duration);\r\n  if(!Number.isFinite(offset) || !Number.isFinite(duration) || duration <= 0) return 0;\r\n  return Math.max(1, Math.min(100, Math.round((offset / duration) * 100)));\r\n}\r\n\r\nfunction resolveItemId(item){\r\n  if(!item) return '';\r\n  const preferred = item?.ids?.imdb || item?.ids?.tmdb;\r\n  if(preferred) return String(preferred);\r\n  if(item?.ratingKey) return String(item.ratingKey);\r\n  return '';\r\n}\r\n\r\nfunction gridItemSignature(entry){\r\n  if(entry?.isCollectionGroup) return collectionSignature(entry);\r\n  return itemSignature(entry);\r\n}\r\n\r\nfunction itemSignature(item){\r\n  const genres = getGenreNames(item?.genres).slice(0, 3);\r\n  const badges = itemBadgeTexts(item);\r\n  const meta = buildMetaPieces(item);\r\n  return JSON.stringify({\r\n    id: resolveItemId(item),\r\n    title: item?.title || '',\r\n    poster: resolvePoster(item),\r\n    badges,\r\n    meta,\r\n    progress: progressPercent(item),\r\n    watch: Watch.isSaved(item),\r\n    genres\r\n  });\r\n}\r\n\r\nfunction collectionSignature(entry){\r\n  const baseItem = entry?.posterItem || null;\r\n  const genres = Array.isArray(entry?.genres) ? entry.genres.slice(0, 3).map(String) : [];\r\n  const badges = collectionBadgeTexts(entry);\r\n  const meta = collectionMetaPieces(entry);\r\n  const count = Number(entry?.itemCount);\r\n  const ratingValue = Number(entry?.rating);\r\n  return JSON.stringify({\r\n    name: entry?.collectionName || entry?.title || '',\r\n    title: entry?.title || '',\r\n    itemCount: Number.isFinite(count) ? count : null,\r\n    year: entry?.year || '',\r\n    rating: Number.isFinite(ratingValue) ? ratingValue : null,\r\n    poster: resolvePoster(baseItem),\r\n    badges,\r\n    meta,\r\n    genres\r\n  });\r\n}\r\n\r\nfunction replaceCardNode(current, replacement){\r\n  if(!(replacement instanceof HTMLElement)) return current;\r\n  if(!(current instanceof HTMLElement)) return replacement;\r\n  const parent = current.parentNode;\r\n  const hadFocus = document.activeElement === current;\r\n  if(parent){\r\n    parent.replaceChild(replacement, current);\r\n  }\r\n  if(hadFocus && typeof replacement.focus === 'function'){\r\n    requestAnimationFrame(()=>{\r\n      try {\r\n        replacement.focus({ preventScroll: true });\r\n      } catch (err) {\r\n        replacement.focus();\r\n      }\r\n    });\r\n  }\r\n  return replacement;\r\n}\r\n\r\nfunction updateHash(kind, id){\r\n  if(!kind || !id) return;\r\n  const hash = `#/${kind}/${id}`;\r\n  const replace = (window.location.hash || '') === hash;\r\n  navigateToHash(hash, { silent: true, replace });\r\n}\r\n\r\nfunction openDetail(item){\r\n  if(!item) return;\r\n  const kind = item?.type === 'tv' ? 'show' : 'movie';\r\n  const id = resolveItemId(item);\r\n  if(id) updateHash(kind, id);\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n}\r\n", "import { getState, setState } from './state.js';\r\nimport { qs } from './dom.js';\r\nimport { getGenreNames, humanYear, collectionTags, isNew } from './utils.js';\r\n\r\nfunction norm(s){ return String(s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\r\n\r\nfunction matches(item, opts){\r\n  const query = norm(opts.query||'');\r\n  const onlyNew = !!opts.onlyNew;\r\n  const yearFrom = Number(opts.yearFrom)||null;\r\n  const yearTo = Number(opts.yearTo)||null;\r\n  const genresActive = opts.genres || new Set();\r\n  const selectedCollection = opts.collection || '';\r\n\r\n  if(query){\r\n    const haystack = norm([\r\n      item.title,\r\n      item.originalTitle,\r\n      item.summary,\r\n      item.studio,\r\n      getGenreNames(item.genres).join(' '),\r\n      (item.roles||[]).map(r=>r && (r.tag||r.role||r.name)).join(' '),\r\n      collectionTags(item).join(' '),\r\n    ].filter(Boolean).join(' '));\r\n    if(!haystack.includes(query)) return false;\r\n  }\r\n\r\n  if(onlyNew && !isNew(item)) return false;\r\n\r\n  const year = Number(humanYear(item)) || null;\r\n  if(yearFrom && (!year || year < yearFrom)) return false;\r\n  if(yearTo && (!year || year > yearTo)) return false;\r\n\r\n  if(genresActive.size){\r\n    const itemGenres = new Set(getGenreNames(item.genres));\r\n    for(const g of genresActive){ if(!itemGenres.has(g)) return false; }\r\n  }\r\n\r\n  if(selectedCollection){\r\n    const tags = new Set(collectionTags(item));\r\n    if(!tags.has(selectedCollection)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction sortItems(items, key){\r\n  const arr = items.slice();\r\n  switch(key){\r\n    case 'year-desc':\r\n      arr.sort((a,b)=> (Number(humanYear(b))||0) - (Number(humanYear(a))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\r\n    case 'year-asc':\r\n      arr.sort((a,b)=> (Number(humanYear(a))||0) - (Number(humanYear(b))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\r\n    case 'title-desc':\r\n      arr.sort((a,b)=> String(b.title||'').localeCompare(String(a.title||''),'de')); break;\r\n    case 'added-desc':\r\n      arr.sort((a,b)=> new Date(b.addedAt||0)-new Date(a.addedAt||0)); break;\r\n    case 'title-asc':\r\n    default:\r\n      arr.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||''),'de'));\r\n  }\r\n  return arr;\r\n}\r\n\r\nexport function computeFacets(movies, shows){\r\n  const genres = new Set();\r\n  const years = new Set();\r\n  const collections = new Set();\r\n  const add = (arr)=> (arr||[]).forEach(x=>{\r\n    getGenreNames(x.genres).forEach(name=>genres.add(name));\r\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\r\n    if(y) years.add(Number(y));\r\n    collectionTags(x).forEach(c=>collections.add(c));\r\n  });\r\n  add(movies); add(shows);\r\n  const ys = [...years].sort((a,b)=>a-b);\r\n  return { genres:[...genres].sort(), years:ys, collections:[...collections].sort((a,b)=>a.localeCompare(b,'de')) };\r\n}\r\n\r\nexport function renderFacets(f){\r\n  // years\r\n  const yFrom = qs('#yearFrom'); const yTo = qs('#yearTo');\r\n  if(yFrom){ yFrom.replaceChildren(new Option('Ab Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\r\n  if(yTo){ yTo.replaceChildren(new Option('Bis Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\r\n  // collections\r\n  const col = qs('#collectionFilter');\r\n  if(col){ col.replaceChildren(new Option('Alle Collections',''), ...f.collections.map(c=>new Option(c,c))); }\r\n  // genres\r\n  const gRoot = qs('#genreFilters');\r\n  if(gRoot){\r\n    const chips = f.genres.map(name=>{\r\n      const b = document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=name; b.dataset.name=name; return b;\r\n    });\r\n    gRoot.replaceChildren(...chips);\r\n    updateGenreFilterState();\r\n  }\r\n}\r\n\r\nfunction getFilterOpts(){\r\n  const searchInput = document.getElementById('search') || document.getElementById('q');\r\n  const query = (searchInput?.value || '').trim();\r\n  const onlyNew = qs('#onlyNew')?.checked || false;\r\n  const yearFrom = qs('#yearFrom')?.value || '';\r\n  const yearTo = qs('#yearTo')?.value || '';\r\n  const collection = qs('#collectionFilter')?.value || '';\r\n  const sort = qs('#sort')?.value || 'title-asc';\r\n  const genres = new Set();\r\n  document.querySelectorAll('#genreFilters .chip.active').forEach(n=>genres.add(n.dataset.name));\r\n  return { query, onlyNew, yearFrom, yearTo, collection, genres, sort };\r\n}\r\n\r\nexport function applyFilters(){\r\n  const s = getState();\r\n  const view = s.view;\r\n  const pool = view==='shows' ? s.shows : s.movies;\r\n  const opts = getFilterOpts();\r\n  const filtered = (pool||[]).filter(item=>matches(item, opts));\r\n  const ordered = sortItems(filtered, opts.sort);\r\n  setState({ filtered: ordered });\r\n  return ordered;\r\n}\r\n\r\nlet gridModulePromise = null;\r\nfunction renderGridForCurrentView(){\r\n  if(!gridModulePromise){\r\n    gridModulePromise = import('./grid.js');\r\n  }\r\n  gridModulePromise.then(mod=>{\r\n    const fn = mod && mod.renderGrid;\r\n    if(typeof fn === 'function') fn(getState().view);\r\n  }).catch(console.error);\r\n}\r\n\r\nlet filtersUpdatedHandler = null;\r\n\r\nexport function setFiltersUpdatedHandler(handler){\r\n  filtersUpdatedHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nexport function updateFiltersAndGrid(){\r\n  const result = applyFilters();\r\n  renderGridForCurrentView();\r\n  if(filtersUpdatedHandler){\r\n    try{\r\n      const payload = Array.isArray(result) ? result.slice() : [];\r\n      filtersUpdatedHandler(payload, getState().view);\r\n    }catch(err){\r\n      console.warn('[filter] Failed to notify filters handler:', err?.message);\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction updateGenreFilterState(){\r\n  const root = document.getElementById('genreFilters');\r\n  if(!root) return;\r\n  const activeCount = root.querySelectorAll('.chip.active').length;\r\n  root.dataset.state = activeCount > 0 ? 'active' : 'empty';\r\n  root.dataset.count = String(activeCount);\r\n}\r\n\r\nexport function initFilters(){\r\n  // populate sort options\r\n  const sortSel = qs('#sort');\r\n  if(sortSel && sortSel.options.length===0){\r\n    [['title-asc','Titel A\u2013Z'],['title-desc','Titel Z\u2013A'],['year-desc','Jahr \u2193'],['year-asc','Jahr \u2191'],['added-desc','Zuletzt hinzugef\u00FCgt']]\r\n      .forEach(([v,l])=> sortSel.add(new Option(l, v)));\r\n  }\r\n\r\n  const bind = (sel, ev='input')=>{\r\n    const n = qs(sel);\r\n    if(!n) return;\r\n    n.addEventListener(ev, ()=>{ updateFiltersAndGrid(); });\r\n    if(ev === 'input' && n instanceof HTMLInputElement && n.type === 'search'){\r\n      n.addEventListener('search', ()=>{ updateFiltersAndGrid(); });\r\n    }\r\n  };\r\n  bind('#search');\r\n  bind('#q');\r\n  bind('#onlyNew','change'); bind('#yearFrom','change'); bind('#yearTo','change'); bind('#collectionFilter','change'); bind('#sort','change'); bind('#groupCollections','change');\r\n  const yrReset = qs('#yearReset'); if(yrReset){ yrReset.addEventListener('click',()=>{ const a=qs('#yearFrom'); const b=qs('#yearTo'); if(a) a.value=''; if(b) b.value=''; updateFiltersAndGrid(); }); }\r\n  const gRoot = qs('#genreFilters');\r\n  if(gRoot){\r\n    gRoot.addEventListener('click', ev=>{\r\n      const t = ev.target;\r\n      if(!(t instanceof HTMLElement)) return;\r\n      if(!t.classList.contains('chip')) return;\r\n      t.classList.toggle('active');\r\n      updateGenreFilterState();\r\n      updateFiltersAndGrid();\r\n    });\r\n    updateGenreFilterState();\r\n  }\r\n}\r\n\r\n", "import cacheStore, { clear as clearCacheStore } from '../cacheStore.js';\r\nimport { createMetadataService } from '../metadataService.js';\r\n\r\nconst API_V3 = 'https://api.themoviedb.org/3';\r\nconst LOG_PREFIX = '[tmdb]';\r\nconst SESSION_CACHE = new Map();\r\n\r\nlet metadataInstance = null;\r\nlet metadataSignature = '';\r\n\r\nfunction logWarn(...args){\r\n  try {\r\n    console.warn(LOG_PREFIX, ...args);\r\n  } catch (_err) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction normalizeConfig(cfg = {}){\r\n  const language = cfg.lang || cfg.language || 'de-DE';\r\n  const region = cfg.region || cfg.iso || 'DE';\r\n  const ttlHours = Number(cfg.ttlHours || cfg.tmdbTtlHours || 24) || 24;\r\n  const imageBase = cfg.imageBase || cfg.tmdbImageBase;\r\n  return { language, region, ttlHours, imageBase };\r\n}\r\n\r\nfunction buildSignature(cfg, auth){\r\n  const { language, region, ttlHours, imageBase } = normalizeConfig(cfg);\r\n  const authSig = auth?.kind ? `${auth.kind}:${auth.value || ''}` : 'none';\r\n  return JSON.stringify({ language, region, ttlHours, imageBase, auth: authSig });\r\n}\r\n\r\nfunction ensureMetadata(cfg = {}, auth){\r\n  const signature = buildSignature(cfg, auth);\r\n  if(metadataInstance && metadataSignature === signature){\r\n    return metadataInstance;\r\n  }\r\n  const { language, region, ttlHours, imageBase } = normalizeConfig(cfg);\r\n  const options = {\r\n    cacheStore,\r\n    language,\r\n    region,\r\n    ttlHours,\r\n  };\r\n  if(imageBase) options.imageBase = imageBase;\r\n  if(auth?.kind === 'bearer' && auth.value){\r\n    options.token = auth.value;\r\n  } else if(auth?.kind === 'apikey' && auth.value){\r\n    options.apiKey = auth.value;\r\n  }\r\n  metadataInstance = createMetadataService(options);\r\n  metadataSignature = signature;\r\n  return metadataInstance;\r\n}\r\n\r\nfunction keyFor(item){\r\n  const type = (item?.type === 'tv') ? 'tv' : 'movie';\r\n  const imdb = item?.ids?.imdb || '';\r\n  const tmdb = item?.ids?.tmdb || '';\r\n  const title = (item?.title || item?.name || '').toLowerCase();\r\n  const year = String(item?.year || '').slice(0, 4);\r\n  return [type, imdb, tmdb, title, year].filter(Boolean).join('|');\r\n}\r\n\r\nexport function clearCache(){\r\n  try{\r\n    localStorage.removeItem('tmdbCache');\r\n  }catch(err){\r\n    logWarn('Failed to clear legacy TMDB cache from storage:', err);\r\n  }\r\n  SESSION_CACHE.clear();\r\n  try{\r\n    clearCacheStore('tmdb:');\r\n  }catch(err){\r\n    logWarn('Failed to clear metadata cache store:', err);\r\n  }\r\n  if(metadataInstance){\r\n    try{\r\n      metadataInstance.clear?.('tmdb:');\r\n    }catch(err){\r\n      logWarn('Failed to clear metadata service cache:', err);\r\n    }\r\n  }\r\n}\r\n\r\nfunction tokenFromEnv(cfg){\r\n  try{\r\n    const token = localStorage.getItem('tmdbToken');\r\n    if(token && token.trim()) return { kind: 'bearer', value: token.trim() };\r\n  }catch(err){\r\n    logWarn('Failed to read TMDB token from storage:', err);\r\n  }\r\n  if(cfg?.tmdbToken){\r\n    const val = String(cfg.tmdbToken).trim();\r\n    if(val) return { kind: 'bearer', value: val };\r\n  }\r\n  if(cfg?.tmdbApiKey){\r\n    const val = String(cfg.tmdbApiKey).trim();\r\n    if(val) return { kind: 'apikey', value: val };\r\n  }\r\n  return { kind: 'none', value: '' };\r\n}\r\n\r\nasync function resolveByExternalId(type, imdbId, cfg, auth){\r\n  if(!imdbId) return null;\r\n  try{\r\n    const service = ensureMetadata(cfg, auth);\r\n    const client = service.client;\r\n    const json = await client.get(`/find/${encodeURIComponent(imdbId)}`, {\r\n      external_source: 'imdb_id',\r\n    });\r\n    if(type === 'movie'){\r\n      return json?.movie_results?.[0]?.id ?? null;\r\n    }\r\n    return json?.tv_results?.[0]?.id ?? null;\r\n  }catch(err){\r\n    logWarn(`Failed to resolve external id ${imdbId}:`, err);\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function resolveBySearch(type, title, year, cfg, auth){\r\n  const name = String(title || '').trim();\r\n  if(!name) return null;\r\n  try{\r\n    const service = ensureMetadata(cfg, auth);\r\n    const client = service.client;\r\n    const params = {\r\n      query: name,\r\n      include_adult: false,\r\n    };\r\n    if(year){\r\n      if(type === 'movie') params.year = year;\r\n      else params.first_air_date_year = year;\r\n    }\r\n    const json = await client.get(`/search/${type}`, params);\r\n    const result = Array.isArray(json?.results) ? json.results[0] : null;\r\n    return result?.id ?? null;\r\n  }catch(err){\r\n    logWarn(`Search failed for ${type} ${title}:`, err);\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function hydrateItem(item, cfg, auth){\r\n  const type = (item?.type === 'tv') ? 'tv' : 'movie';\r\n  const cacheKey = keyFor(item);\r\n  if(SESSION_CACHE.has(cacheKey)){\r\n    return SESSION_CACHE.get(cacheKey);\r\n  }\r\n  const service = ensureMetadata(cfg, auth);\r\n  let tmdbId = item?.ids?.tmdb;\r\n  if(!tmdbId && item?.ids?.imdb){\r\n    tmdbId = await resolveByExternalId(type, item.ids.imdb, cfg, auth);\r\n  }\r\n  if(!tmdbId){\r\n    const year = item?.year ? Number(String(item.year).slice(0, 4)) : undefined;\r\n    tmdbId = await resolveBySearch(type, item?.title || item?.name, year, cfg, auth);\r\n  }\r\n  if(!tmdbId){\r\n    SESSION_CACHE.set(cacheKey, null);\r\n    return null;\r\n  }\r\n  try{\r\n    const detail = type === 'tv'\r\n      ? await service.getTvEnriched(tmdbId)\r\n      : await service.getMovieEnriched(tmdbId);\r\n    if(!detail){\r\n      SESSION_CACHE.set(cacheKey, null);\r\n      return null;\r\n    }\r\n    const enriched = {\r\n      id: detail.id || String(tmdbId),\r\n      poster: detail.poster || '',\r\n      backdrop: detail.backdrop || '',\r\n      url: detail.url || `https://www.themoviedb.org/${type}/${tmdbId}`,\r\n    };\r\n    SESSION_CACHE.set(cacheKey, enriched);\r\n    return enriched;\r\n  }catch(err){\r\n    logWarn(`Hydration failed for ${type} ${tmdbId}:`, err);\r\n    SESSION_CACHE.set(cacheKey, null);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function hydrateOptional(movies, shows, cfg = {}){\r\n  try{\r\n    const auth = tokenFromEnv(cfg);\r\n    if(!auth.value){\r\n      return;\r\n    }\r\n    ensureMetadata(cfg, auth);\r\n    const work = [...(movies || []), ...(shows || [])];\r\n    const limit = 40;\r\n    let index = 0;\r\n    const processChunk = async () => {\r\n      const chunk = work.slice(index, index + 4);\r\n      index += 4;\r\n      await Promise.all(chunk.map(async (it) => {\r\n        const data = await hydrateItem(it, cfg, auth);\r\n        if(data){\r\n          it.tmdb = { id: data.id, poster: data.poster, backdrop: data.backdrop, url: data.url };\r\n          it.ids = it.ids || {};\r\n          if(!it.ids.tmdb && data.id){\r\n            it.ids.tmdb = String(data.id);\r\n          }\r\n        }\r\n      }));\r\n      try{\r\n        window.dispatchEvent(new CustomEvent('tmdb:chunk', { detail: { updated: chunk.length, index } }));\r\n      }catch(err){\r\n        logWarn('Failed to dispatch tmdb:chunk event:', err);\r\n      }\r\n      const hasMore = index < Math.min(work.length, limit);\r\n      if(hasMore){\r\n        if(window.requestIdleCallback){\r\n          window.requestIdleCallback(processChunk, { timeout: 500 });\r\n        }else{\r\n          setTimeout(processChunk, 250);\r\n        }\r\n      }else{\r\n        try{\r\n          window.dispatchEvent(new CustomEvent('tmdb:done', { detail: { total: Math.min(work.length, limit) } }));\r\n        }catch(err){\r\n          logWarn('Failed to dispatch tmdb:done event:', err);\r\n        }\r\n      }\r\n    };\r\n    processChunk();\r\n  }catch(err){\r\n    logWarn('hydrateOptional failed to start:', err);\r\n  }\r\n}\r\n\r\nfunction withAuth(url, auth){\r\n  if(!auth || auth.kind === 'none') return { url, init: {} };\r\n  if(auth.kind === 'bearer'){\r\n    return { url, init: { headers: { Authorization: `Bearer ${auth.value}`, Accept: 'application/json' } } };\r\n  }\r\n  const separator = url.includes('?') ? '&' : '?';\r\n  return { url: `${url}${separator}api_key=${encodeURIComponent(auth.value)}`, init: { headers: { Accept: 'application/json' } } };\r\n}\r\n\r\n// Lightweight token validation used by settings UI\r\nexport async function validateToken(raw){\r\n  const token = String(raw || '').trim();\r\n  if(!token) throw new Error('empty');\r\n  const looksLikeV3 = /^[a-f0-9]{32}$/i.test(token);\r\n  const looksLikeJwt = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$/.test(token);\r\n  const decodeJwtPayload = (t)=>{\r\n    try{\r\n      const part = t.split('.')[1];\r\n      const pad = (s)=> s + '='.repeat((4 - (s.length % 4)) % 4);\r\n      const json = atob(pad(part.replace(/-/g,'+').replace(/_/g,'/')));\r\n      return JSON.parse(json);\r\n    }catch(err){\r\n      logWarn('Failed to decode TMDB JWT payload:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  if(looksLikeV3){\r\n    const { url, init } = withAuth(`${API_V3}/configuration`, { kind:'apikey', value: token });\r\n    const res = await fetch(url, init);\r\n    if(res.ok) return { ok:true, as:'apikey', hint:'v3Key' };\r\n    return { ok:false, as:'apikey', hint:'looksV3' };\r\n  }\r\n\r\n  if(looksLikeJwt){\r\n    const payload = decodeJwtPayload(token);\r\n    if(payload && typeof payload === 'object'){\r\n      const iss = String(payload.iss||'');\r\n      if(iss && !/themoviedb\\.org/i.test(iss)){\r\n        return { ok:false, as:'bearer', hint:'issMismatch' };\r\n      }\r\n    }\r\n    const { url, init } = withAuth(`${API_V3}/trending/movie/day`, { kind:'bearer', value: token });\r\n    try{\r\n      const res = await fetch(url, init);\r\n      if(res.ok) return { ok:true, as:'bearer', hint:null };\r\n    }catch(err){\r\n      logWarn('Bearer token validation request failed:', err);\r\n    }\r\n    return { ok:true, as:'bearer', hint:'structOnly' };\r\n  }\r\n\r\n  return { ok:false, as:'bearer', hint:null };\r\n}\r\n", "import { showError } from '../errorHandler.js';\r\n\r\nconst POLICY_URL = 'hero.policy.json';\r\n\r\nconst DEFAULT_POLICY = Object.freeze({\r\n  poolSizeMovies: 10,\r\n  poolSizeSeries: 10,\r\n  slots: {\r\n    new: { quota: 0.3 },\r\n    topRated: { quota: 0.3 },\r\n    oldButGold: { quota: 0.2 },\r\n    random: { quota: 0.2 }\r\n  },\r\n  diversity: {\r\n    genre: 0.4,\r\n    year: 0.35,\r\n    antiRepeat: 0.25\r\n  },\r\n  rotation: {\r\n    intervalMinutes: 360,\r\n    minPoolSize: 6\r\n  },\r\n  textClamp: {\r\n    title: 96,\r\n    subtitle: 240,\r\n    summary: 220\r\n  },\r\n  fallback: {\r\n    prefer: 'movies',\r\n    allowDuplicates: false\r\n  },\r\n  language: 'en-US',\r\n  cache: {\r\n    ttlHours: 24,\r\n    graceMinutes: 15\r\n  }\r\n});\r\n\r\nconst SLOT_KEYS = ['new', 'topRated', 'oldButGold', 'random'];\r\n\r\nlet activePolicy = clone(DEFAULT_POLICY);\r\nlet policyLoadedAt = 0;\r\nlet validationIssues = [];\r\n\r\nexport async function initHeroPolicy(){\r\n  validationIssues = [];\r\n  let raw = null;\r\n  let loadError = null;\r\n\r\n  try {\r\n    const response = await fetch(POLICY_URL, { cache: 'no-cache' });\r\n    if(!response.ok){\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    raw = await safeJson(response);\r\n  } catch (error) {\r\n    loadError = error;\r\n    addIssue(`Failed to load policy (${error?.message || 'unknown error'})`);\r\n    showError('Hero-Policy konnte nicht geladen werden', error?.message || 'Unbekannter Fehler');\r\n  }\r\n\r\n  activePolicy = sanitizePolicy(raw);\r\n  policyLoadedAt = Date.now();\r\n\r\n  reportValidationIssues(loadError);\r\n\r\n  return activePolicy;\r\n}\r\n\r\nexport function getHeroPolicy(){\r\n  return clone(activePolicy);\r\n}\r\n\r\nexport function getPoolSizes(){\r\n  return {\r\n    movies: activePolicy.poolSizeMovies,\r\n    series: activePolicy.poolSizeSeries\r\n  };\r\n}\r\n\r\nexport function getSlotConfig(){\r\n  const slots = {};\r\n  SLOT_KEYS.forEach((key) => {\r\n    slots[key] = { quota: activePolicy.slots[key].quota };\r\n  });\r\n  return slots;\r\n}\r\n\r\nexport function getDiversityWeights(){\r\n  return { ...activePolicy.diversity };\r\n}\r\n\r\nexport function getRotationConfig(){\r\n  return { ...activePolicy.rotation };\r\n}\r\n\r\nexport function getTextClampConfig(){\r\n  return { ...activePolicy.textClamp };\r\n}\r\n\r\nexport function getFallbackPreference(){\r\n  return { ...activePolicy.fallback };\r\n}\r\n\r\nexport function getPolicyLanguage(){\r\n  return activePolicy.language;\r\n}\r\n\r\nexport function getCacheTtl(){\r\n  const hours = Number(activePolicy.cache.ttlHours);\r\n  const grace = Number(activePolicy.cache.graceMinutes);\r\n  return {\r\n    ttlHours: hours,\r\n    ttlMs: hours * 60 * 60 * 1000,\r\n    graceMinutes: grace,\r\n    graceMs: grace * 60 * 1000\r\n  };\r\n}\r\n\r\nexport function getValidationIssues(){\r\n  return validationIssues.slice();\r\n}\r\n\r\nexport function getPolicyLoadedAt(){\r\n  return policyLoadedAt;\r\n}\r\n\r\nfunction sanitizePolicy(raw){\r\n  const target = clone(DEFAULT_POLICY);\r\n  if(!raw || typeof raw !== 'object'){\r\n    addIssue('Policy payload missing or invalid, using defaults.');\r\n    return target;\r\n  }\r\n\r\n  target.poolSizeMovies = ensurePositiveInt(raw.poolSizeMovies, target.poolSizeMovies, 'poolSizeMovies');\r\n  target.poolSizeSeries = ensurePositiveInt(raw.poolSizeSeries, target.poolSizeSeries, 'poolSizeSeries');\r\n\r\n  const rawSlots = raw.slots && typeof raw.slots === 'object' ? raw.slots : {};\r\n  SLOT_KEYS.forEach((key) => {\r\n    const slot = rawSlots[key];\r\n    const quota = ensureNumberInRange(slot?.quota, 0, 1, target.slots[key].quota, `slots.${key}.quota`);\r\n    target.slots[key] = { quota };\r\n  });\r\n\r\n  const rawDiversity = raw.diversity && typeof raw.diversity === 'object' ? raw.diversity : {};\r\n  target.diversity = {\r\n    genre: ensureNumberInRange(rawDiversity.genre, 0, 1, target.diversity.genre, 'diversity.genre'),\r\n    year: ensureNumberInRange(rawDiversity.year, 0, 1, target.diversity.year, 'diversity.year'),\r\n    antiRepeat: ensureNumberInRange(rawDiversity.antiRepeat, 0, 1, target.diversity.antiRepeat, 'diversity.antiRepeat')\r\n  };\r\n\r\n  const rawRotation = raw.rotation && typeof raw.rotation === 'object' ? raw.rotation : {};\r\n  target.rotation = {\r\n    intervalMinutes: ensurePositiveInt(rawRotation.intervalMinutes, target.rotation.intervalMinutes, 'rotation.intervalMinutes'),\r\n    minPoolSize: ensurePositiveInt(rawRotation.minPoolSize, target.rotation.minPoolSize, 'rotation.minPoolSize')\r\n  };\r\n\r\n  const rawClamp = raw.textClamp && typeof raw.textClamp === 'object' ? raw.textClamp : {};\r\n  target.textClamp = {\r\n    title: ensurePositiveInt(rawClamp.title, target.textClamp.title, 'textClamp.title'),\r\n    subtitle: ensurePositiveInt(rawClamp.subtitle, target.textClamp.subtitle, 'textClamp.subtitle'),\r\n    summary: ensurePositiveInt(rawClamp.summary, target.textClamp.summary, 'textClamp.summary')\r\n  };\r\n\r\n  const rawFallback = raw.fallback && typeof raw.fallback === 'object' ? raw.fallback : {};\r\n  target.fallback = {\r\n    prefer: ensureFallbackPreference(rawFallback.prefer, target.fallback.prefer),\r\n    allowDuplicates: typeof rawFallback.allowDuplicates === 'boolean' ? rawFallback.allowDuplicates : target.fallback.allowDuplicates\r\n  };\r\n\r\n  target.language = typeof raw.language === 'string' && raw.language.trim() ? raw.language.trim() : target.language;\r\n  if(target.language !== (raw.language || '').trim()){\r\n    addIssue('language missing or invalid, defaulted to en-US.');\r\n  }\r\n\r\n  const rawCache = raw.cache && typeof raw.cache === 'object' ? raw.cache : {};\r\n  const ttlHours = ensurePositiveInt(rawCache.ttlHours, target.cache.ttlHours, 'cache.ttlHours');\r\n  const graceMinutes = ensurePositiveInt(rawCache.graceMinutes, target.cache.graceMinutes, 'cache.graceMinutes', true);\r\n  target.cache = { ttlHours, graceMinutes };\r\n\r\n  return target;\r\n}\r\n\r\nfunction ensurePositiveInt(value, fallback, field, allowZero){\r\n  const num = Number(value);\r\n  if(Number.isFinite(num) && (!allowZero ? num > 0 : num >= 0)){\r\n    return Math.floor(num);\r\n  }\r\n  if(value != null){\r\n    addIssue(`${field} invalid (${value}), using default (${fallback}).`);\r\n  }\r\n  return fallback;\r\n}\r\n\r\nfunction ensureNumberInRange(value, min, max, fallback, field){\r\n  const num = Number(value);\r\n  if(Number.isFinite(num) && num >= min && num <= max){\r\n    return num;\r\n  }\r\n  if(value != null){\r\n    addIssue(`${field} invalid (${value}), using default (${fallback}).`);\r\n  }\r\n  return fallback;\r\n}\r\n\r\nfunction ensureFallbackPreference(value, fallback){\r\n  if(value === 'movies' || value === 'series' || value === 'shows'){\r\n    return value === 'shows' ? 'series' : value;\r\n  }\r\n  if(value != null){\r\n    addIssue(`fallback.prefer invalid (${value}), using default (${fallback}).`);\r\n  }\r\n  return fallback;\r\n}\r\n\r\nfunction clone(source){\r\n  return JSON.parse(JSON.stringify(source));\r\n}\r\n\r\nasync function safeJson(response){\r\n  try {\r\n    return await response.json();\r\n  } catch (error) {\r\n    addIssue(`Failed to parse hero policy JSON (${error?.message || error}).`);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction addIssue(message){\r\n  if(!message) return;\r\n  validationIssues.push(message);\r\n}\r\n\r\nfunction reportValidationIssues(loadError){\r\n  if(!validationIssues.length) return;\r\n  if(loadError){\r\n    const followUps = validationIssues.slice(1);\r\n    if(followUps.length){\r\n      showError('Hero-Policy Hinweise', followUps.join(' \u2022 '));\r\n    }\r\n    return;\r\n  }\r\n  showError('Hero-Policy Hinweise', validationIssues.join(' \u2022 '));\r\n}\r\n\r\n", "const API_BASE = 'https://api.themoviedb.org/3';\r\nconst IMG_BASE = 'https://image.tmdb.org/t/p/';\r\nconst APPEND_FIELDS = 'images,release_dates,content_ratings,credits';\r\nconst STORAGE_KEY = 'hero.tmdbCache.v1';\r\nconst CACHE_TTL = 1000 * 60 * 60 * 24; // 24 hours\r\nconst MAX_CACHE_ENTRIES = 60;\r\nconst MIN_REQUEST_INTERVAL = 400; // ms\r\nconst MAX_RETRIES = 4;\r\nconst BASE_RETRY_DELAY = 400; // ms\r\nconst RETRY_DELAY_CAP = 8000; // ms\r\nconst RATE_LIMIT_BASE_DELAY = 1200; // ms\r\nconst RATE_LIMIT_CAP = 60000; // ms\r\nconst MAX_RATE_LIMIT_STRIKES = 5;\r\nconst RATE_LIMIT_RECOVERY_WINDOW = 90_000; // ms\r\nconst PENALTY_DECAY_STEP = 1;\r\nconst LOG_PREFIX = '[hero:tmdbClient]';\r\n\r\nlet memoryCache = new Map();\r\nlet cacheLoaded = false;\r\nlet persistTimer = null;\r\nlet lastRequestAt = 0;\r\nlet configPromise = null;\r\nlet cachedConfig = {};\r\nlet throttlePenaltyUntil = 0;\r\nlet rateLimitState = {\r\n  active: false,\r\n  until: 0,\r\n  retryAfterMs: 0,\r\n  lastStatus: null,\r\n  lastHitAt: 0,\r\n  strikes: 0\r\n};\r\nconst rateLimitListeners = new Set();\r\n\r\nfunction logWarn(...args){\r\n  try {\r\n    console.warn(LOG_PREFIX, ...args);\r\n  } catch (_err) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction now(){ return Date.now(); }\r\n\r\nfunction delay(ms){\r\n  return new Promise(resolve => setTimeout(resolve, Math.max(0, ms || 0)));\r\n}\r\n\r\nfunction shallowEqual(a, b){\r\n  if(a === b) return true;\r\n  if(!a || !b) return false;\r\n  const keysA = Object.keys(a);\r\n  const keysB = Object.keys(b);\r\n  if(keysA.length !== keysB.length) return false;\r\n  for(const key of keysA){\r\n    if(a[key] !== b[key]) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction getRateLimitSnapshot(){\r\n  return {\r\n    active: !!rateLimitState.active,\r\n    until: Number(rateLimitState.until) || 0,\r\n    retryAfterMs: Number(rateLimitState.retryAfterMs) || 0,\r\n    lastStatus: rateLimitState.lastStatus ?? null,\r\n    lastHitAt: Number(rateLimitState.lastHitAt) || 0,\r\n    strikes: Number(rateLimitState.strikes) || 0\r\n  };\r\n}\r\n\r\nfunction notifyRateLimitListeners(){\r\n  const snapshot = getRateLimitSnapshot();\r\n  for(const listener of rateLimitListeners){\r\n    try {\r\n      listener(snapshot);\r\n    } catch (err) {\r\n      logWarn('Rate limit listener failed:', err?.message || err);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateRateLimitState(patch){\r\n  const next = { ...getRateLimitSnapshot(), ...patch };\r\n  if(shallowEqual(rateLimitState, next)) return rateLimitState;\r\n  rateLimitState = next;\r\n  notifyRateLimitListeners();\r\n  return rateLimitState;\r\n}\r\n\r\nfunction computeRetryDelay(attempt){\r\n  return Math.min(RETRY_DELAY_CAP, BASE_RETRY_DELAY * Math.pow(2, Math.max(0, attempt)));\r\n}\r\n\r\nfunction computeRateLimitDelay(strikes, fallback){\r\n  const scaled = RATE_LIMIT_BASE_DELAY * Math.pow(2, Math.max(0, strikes - 1));\r\n  const candidate = Math.max(fallback || 0, scaled);\r\n  return Math.min(RATE_LIMIT_CAP, candidate);\r\n}\r\n\r\nfunction registerRateLimitHit(retryAfterMs, status = 429){\r\n  const nowTs = now();\r\n  const strikes = Math.min(MAX_RATE_LIMIT_STRIKES, (rateLimitState.strikes || 0) + 1);\r\n  const delayMs = computeRateLimitDelay(strikes, retryAfterMs);\r\n  throttlePenaltyUntil = Math.max(throttlePenaltyUntil, nowTs + delayMs);\r\n  updateRateLimitState({\r\n    active: true,\r\n    strikes,\r\n    retryAfterMs: delayMs,\r\n    until: nowTs + delayMs,\r\n    lastStatus: status,\r\n    lastHitAt: nowTs\r\n  });\r\n  return delayMs;\r\n}\r\n\r\nfunction decayRateLimitStrikes(){\r\n  if(!rateLimitState.strikes) return;\r\n  const strikes = Math.max(0, rateLimitState.strikes - PENALTY_DECAY_STEP);\r\n  updateRateLimitState({\r\n    strikes,\r\n    active: rateLimitState.active && rateLimitState.until > now()\r\n  });\r\n}\r\n\r\nfunction refreshRateLimit(){\r\n  const nowTs = now();\r\n  if(rateLimitState.active && nowTs >= rateLimitState.until){\r\n    updateRateLimitState({ active: false, retryAfterMs: 0, until: 0 });\r\n  } else if(!rateLimitState.active && rateLimitState.strikes > 0 && nowTs - rateLimitState.lastHitAt > RATE_LIMIT_RECOVERY_WINDOW){\r\n    updateRateLimitState({ strikes: Math.max(0, rateLimitState.strikes - PENALTY_DECAY_STEP) });\r\n  }\r\n  if(throttlePenaltyUntil && nowTs >= throttlePenaltyUntil){\r\n    throttlePenaltyUntil = 0;\r\n  }\r\n}\r\n\r\nfunction getCacheKey(type, id, language){\r\n  const t = (type === 'tv') ? 'tv' : 'movie';\r\n  const lang = String(language || 'en-US').trim() || 'en-US';\r\n  return `${t}:${String(id || '').trim()}:${lang}`;\r\n}\r\n\r\nfunction ensureCacheLoaded(){\r\n  if(cacheLoaded) return;\r\n  cacheLoaded = true;\r\n  if(typeof localStorage === 'undefined') return;\r\n  let raw;\r\n  try {\r\n    raw = localStorage.getItem(STORAGE_KEY);\r\n    if(!raw) return;\r\n  } catch (err) {\r\n    logWarn('Failed to read TMDB cache from storage:', err?.message || err);\r\n    return;\r\n  }\r\n  let parsed;\r\n  try {\r\n    parsed = JSON.parse(raw);\r\n  } catch (err) {\r\n    logWarn('Stored TMDB cache invalid JSON:', err?.message || err);\r\n    return;\r\n  }\r\n  if(!Array.isArray(parsed)) return;\r\n  const nowTs = now();\r\n  parsed.forEach(([key, entry]) => {\r\n    if(!key || !entry) return;\r\n    const ts = Number(entry.ts ?? entry.timestamp ?? entry.fetchedAt);\r\n    if(!Number.isFinite(ts)) return;\r\n    if(nowTs - ts > CACHE_TTL) return;\r\n    memoryCache.set(String(key), { ts, data: entry.data ?? entry.payload ?? null });\r\n  });\r\n}\r\n\r\nfunction pruneExpired(){\r\n  const nowTs = now();\r\n  let changed = false;\r\n  for(const [key, entry] of memoryCache.entries()){\r\n    if(!entry || typeof entry !== 'object'){ memoryCache.delete(key); changed = true; continue; }\r\n    const ts = Number(entry.ts);\r\n    if(!Number.isFinite(ts) || nowTs - ts > CACHE_TTL){ memoryCache.delete(key); changed = true; }\r\n  }\r\n  if(changed) schedulePersist();\r\n}\r\n\r\nfunction getCacheEntry(key){\r\n  ensureCacheLoaded();\r\n  const entry = memoryCache.get(key);\r\n  if(!entry) return null;\r\n  const ts = Number(entry.ts);\r\n  if(!Number.isFinite(ts) || now() - ts > CACHE_TTL){\r\n    memoryCache.delete(key);\r\n    schedulePersist();\r\n    return null;\r\n  }\r\n  return entry;\r\n}\r\n\r\nfunction setCacheEntry(key, data){\r\n  ensureCacheLoaded();\r\n  memoryCache.set(key, { ts: now(), data });\r\n  pruneOverflow();\r\n  schedulePersist();\r\n}\r\n\r\nfunction pruneOverflow(){\r\n  if(memoryCache.size <= MAX_CACHE_ENTRIES) return;\r\n  const entries = Array.from(memoryCache.entries());\r\n  entries.sort((a, b) => {\r\n    const at = Number(a[1]?.ts || 0);\r\n    const bt = Number(b[1]?.ts || 0);\r\n    return bt - at;\r\n  });\r\n  const trimmed = entries.slice(0, MAX_CACHE_ENTRIES);\r\n  memoryCache = new Map(trimmed);\r\n}\r\n\r\nfunction schedulePersist(){\r\n  if(typeof localStorage === 'undefined') return;\r\n  if(persistTimer) return;\r\n  persistTimer = setTimeout(()=>{\r\n    persistTimer = null;\r\n    persistCache();\r\n  }, 120);\r\n}\r\n\r\nfunction persistCache(){\r\n  if(typeof localStorage === 'undefined') return;\r\n  const entries = Array.from(memoryCache.entries()).map(([key, entry])=>{\r\n    return [key, { ts: entry?.ts ?? now(), data: entry?.data ?? null }];\r\n  });\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));\r\n  } catch (err) {\r\n    logWarn('Failed to persist TMDB cache:', err?.message || err);\r\n  }\r\n}\r\n\r\nfunction parseRetryAfter(value){\r\n  if(!value) return 0;\r\n  const num = Number(value);\r\n  if(Number.isFinite(num)) return Math.max(0, num * 1000);\r\n  const date = Date.parse(value);\r\n  if(Number.isFinite(date)) return Math.max(0, date - now());\r\n  return 0;\r\n}\r\n\r\nfunction shouldRetryStatus(status){\r\n  return status === 429 || (status >= 500 && status < 600);\r\n}\r\n\r\nfunction isAbortError(err){\r\n  return err && (err.name === 'AbortError' || err.code === 'ABORT_ERR');\r\n}\r\n\r\nfunction shouldRetryError(err){\r\n  if(isAbortError(err)) return false;\r\n  if(err && typeof err === 'object'){\r\n    if(err.name === 'TypeError' && /network/i.test(err.message || '')) return true;\r\n    if(/network/i.test(err?.message || '')) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction withAuth(url, auth){\r\n  if(!auth || !auth.value) return { url, init: { headers: { 'Accept': 'application/json' } } };\r\n  if(auth.kind === 'apikey'){\r\n    const sep = url.includes('?') ? '&' : '?';\r\n    return {\r\n      url: `${url}${sep}api_key=${encodeURIComponent(auth.value)}`,\r\n      init: { headers: { 'Accept': 'application/json' } }\r\n    };\r\n  }\r\n  return {\r\n    url,\r\n    init: {\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Authorization': `Bearer ${auth.value}`\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nasync function throttle(){\r\n  refreshRateLimit();\r\n  const nowTs = now();\r\n  const waitInterval = Math.max(0, (lastRequestAt + MIN_REQUEST_INTERVAL) - nowTs);\r\n  const waitPenalty = Math.max(0, throttlePenaltyUntil - nowTs);\r\n  const wait = Math.max(waitInterval, waitPenalty);\r\n  if(wait > 0){\r\n    await delay(wait);\r\n  }\r\n  lastRequestAt = now();\r\n}\r\n\r\nasync function fetchJson(url, auth, { signal } = {}, attempt = 0){\r\n  const { url: finalUrl, init } = withAuth(url, auth);\r\n  const requestInit = { ...init, signal };\r\n  await throttle();\r\n  let response;\r\n  try {\r\n    response = await fetch(finalUrl, requestInit);\r\n  } catch (err) {\r\n    if(attempt < MAX_RETRIES && shouldRetryError(err)){\r\n      const wait = computeRetryDelay(attempt);\r\n      await delay(wait);\r\n      return fetchJson(url, auth, { signal }, attempt + 1);\r\n    }\r\n    throw err;\r\n  }\r\n  if(!response.ok){\r\n    const status = response.status;\r\n    const retryable = shouldRetryStatus(status) && attempt < MAX_RETRIES;\r\n    if(status === 429){\r\n      const retryAfter = parseRetryAfter(response.headers.get('retry-after'));\r\n      const wait = registerRateLimitHit(retryAfter, status);\r\n      if(retryable){\r\n        await delay(wait);\r\n        return fetchJson(url, auth, { signal }, attempt + 1);\r\n      }\r\n    } else if(retryable){\r\n      const wait = computeRetryDelay(attempt);\r\n      await delay(wait);\r\n      return fetchJson(url, auth, { signal }, attempt + 1);\r\n    }\r\n    const text = await response.text().catch(()=> '');\r\n    const err = new Error(`HTTP ${status}${text ? `: ${text}` : ''}`);\r\n    err.status = status;\r\n    if(status === 429) err.code = 'RATE_LIMIT';\r\n    throw err;\r\n  }\r\n  decayRateLimitStrikes();\r\n  refreshRateLimit();\r\n  return response.json();\r\n}\r\n\r\nfunction classifyCredential(raw, forcedKind){\r\n  if(!raw && raw !== 0) return null;\r\n  const value = String(raw || '').trim();\r\n  if(!value) return null;\r\n  const kind = forcedKind || (/^[a-f0-9]{32}$/i.test(value) ? 'apikey' : 'bearer');\r\n  return { kind, value };\r\n}\r\n\r\nfunction readLocalStorageToken(){\r\n  if(typeof localStorage === 'undefined') return '';\r\n  try {\r\n    const token = localStorage.getItem('tmdbToken');\r\n    return token || '';\r\n  } catch (err) {\r\n    logWarn('Failed to read tmdbToken from storage:', err?.message || err);\r\n    return '';\r\n  }\r\n}\r\n\r\nfunction parseCfg(text){\r\n  if(!text) return {};\r\n  const trimmed = text.trim();\r\n  if(!trimmed) return {};\r\n  if(trimmed.startsWith('{') || trimmed.startsWith('[')){\r\n    try {\r\n      const json = JSON.parse(trimmed);\r\n      if(json && typeof json === 'object') return json;\r\n    } catch (err) {\r\n      logWarn('Failed to parse config.cfg JSON:', err?.message || err);\r\n    }\r\n  }\r\n  const out = {};\r\n  trimmed.split(/\\r?\\n/).forEach(line => {\r\n    const clean = line.trim();\r\n    if(!clean || clean.startsWith('#') || clean.startsWith(';')) return;\r\n    const idx = clean.indexOf('=');\r\n    if(idx === -1) return;\r\n    const key = clean.slice(0, idx).trim();\r\n    const value = clean.slice(idx + 1).trim();\r\n    if(key) out[key] = value;\r\n  });\r\n  return out;\r\n}\r\n\r\nasync function loadConfigCfg(){\r\n  if(configPromise) return configPromise;\r\n  configPromise = (async ()=>{\r\n    if(typeof fetch !== 'function') return {};\r\n    try {\r\n      const response = await fetch('config.cfg', { cache: 'no-cache' });\r\n      if(!response.ok){\r\n        if(response.status !== 404){\r\n          logWarn(`Failed to load config.cfg (HTTP ${response.status})`);\r\n        }\r\n        return {};\r\n      }\r\n      const text = await response.text();\r\n      cachedConfig = parseCfg(text);\r\n      return cachedConfig;\r\n    } catch (err) {\r\n      logWarn('Error loading config.cfg:', err?.message || err);\r\n      return {};\r\n    }\r\n  })();\r\n  return configPromise;\r\n}\r\n\r\nfunction extractCredentialFromSettings(settings){\r\n  if(!settings || typeof settings !== 'object') return null;\r\n  if(settings.tmdbToken){\r\n    const token = classifyCredential(settings.tmdbToken, 'bearer');\r\n    if(token) return { ...token, source: 'settings.tmdbToken' };\r\n  }\r\n  if(settings.tmdbApiKey){\r\n    const key = classifyCredential(settings.tmdbApiKey, 'apikey');\r\n    if(key) return { ...key, source: 'settings.tmdbApiKey' };\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction extractCredentialFromLocalStorage(){\r\n  const token = classifyCredential(readLocalStorageToken(), 'bearer');\r\n  if(token) return { ...token, source: 'localStorage.tmdbToken' };\r\n  return null;\r\n}\r\n\r\nfunction extractCredentialFromConfig(cfg){\r\n  if(!cfg || typeof cfg !== 'object') return null;\r\n  if(cfg.tmdbToken){\r\n    const token = classifyCredential(cfg.tmdbToken, 'bearer');\r\n    if(token) return { ...token, source: 'config.cfg.tmdbToken' };\r\n  }\r\n  if(cfg.tmdbApiKey){\r\n    const key = classifyCredential(cfg.tmdbApiKey, 'apikey');\r\n    if(key) return { ...key, source: 'config.cfg.tmdbApiKey' };\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function resolveAuth(settings={}, options={}){\r\n  if(options.credentials){\r\n    if(typeof options.credentials === 'string' || typeof options.credentials === 'number'){\r\n      const classified = classifyCredential(options.credentials);\r\n      if(classified) return { ...classified, source: 'explicit' };\r\n    } else if(options.credentials && typeof options.credentials === 'object' && options.credentials.value){\r\n      const classified = classifyCredential(options.credentials.value, options.credentials.kind);\r\n      if(classified) return { ...classified, source: options.credentials.source || 'explicit' };\r\n    }\r\n  }\r\n  const fromSettings = extractCredentialFromSettings(settings);\r\n  if(fromSettings) return fromSettings;\r\n  const fromLocalStorage = extractCredentialFromLocalStorage();\r\n  if(fromLocalStorage) return fromLocalStorage;\r\n  if(settings && settings.tmdbApiKey){\r\n    const key = classifyCredential(settings.tmdbApiKey, 'apikey');\r\n    if(key) return { ...key, source: 'settings.tmdbApiKey' };\r\n  }\r\n  const cfg = await loadConfigCfg().catch(()=> (cachedConfig || {}));\r\n  const fromCfg = extractCredentialFromConfig(cfg);\r\n  if(fromCfg) return fromCfg;\r\n  if(options.fallbackCredential){\r\n    const fallback = classifyCredential(options.fallbackCredential);\r\n    if(fallback) return { ...fallback, source: 'fallback' };\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getRateLimitState(){\r\n  return getRateLimitSnapshot();\r\n}\r\n\r\nexport function addRateLimitListener(listener){\r\n  if(typeof listener !== 'function') return () => {};\r\n  rateLimitListeners.add(listener);\r\n  try {\r\n    listener(getRateLimitSnapshot());\r\n  } catch (err) {\r\n    logWarn('Rate limit listener threw during init:', err?.message || err);\r\n  }\r\n  return () => rateLimitListeners.delete(listener);\r\n}\r\n\r\nexport function tmdbImageUrl(path, size='original'){\r\n  const raw = typeof path === 'string' ? path : '';\r\n  const trimmed = raw.trim();\r\n  if(!trimmed) return '';\r\n  const normalizedPath = trimmed.startsWith('/') ? trimmed : `/${trimmed}`;\r\n  const variant = String(size || 'original').trim() || 'original';\r\n  return `${IMG_BASE}${variant}${normalizedPath}`;\r\n}\r\n\r\nfunction cleanId(value){\r\n  if(value == null) return '';\r\n  const str = String(value).trim();\r\n  return str;\r\n}\r\n\r\nexport function clearCache(){\r\n  memoryCache.clear();\r\n  cacheLoaded = true;\r\n  if(typeof localStorage !== 'undefined'){\r\n    try {\r\n      localStorage.removeItem(STORAGE_KEY);\r\n    } catch (err) {\r\n      logWarn('Failed to clear TMDB cache from storage:', err?.message || err);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getCached(type, id, language){\r\n  const key = getCacheKey(type, id, language);\r\n  const entry = getCacheEntry(key);\r\n  return entry ? { data: entry.data, fetchedAt: entry.ts } : null;\r\n}\r\n\r\nexport async function fetchDetails(type, id, options = {}){\r\n  const normalizedType = type === 'tv' ? 'tv' : 'movie';\r\n  const normalizedId = cleanId(id);\r\n  if(!normalizedId) return null;\r\n  const language = cleanId(options.language) || 'en-US';\r\n  const key = getCacheKey(normalizedType, normalizedId, language);\r\n  if(!options.forceRefresh){\r\n    const cached = getCacheEntry(key);\r\n    if(cached){\r\n      return {\r\n        id: normalizedId,\r\n        type: normalizedType,\r\n        language,\r\n        data: cached.data,\r\n        fetchedAt: cached.ts,\r\n        source: 'cache'\r\n      };\r\n    }\r\n  }\r\n  const auth = options.auth || await resolveAuth(options.settings, options.authOptions || {});\r\n  if(!auth){\r\n    logWarn('TMDB credentials missing; cannot fetch details.');\r\n    return null;\r\n  }\r\n  const url = `${API_BASE}/${normalizedType}/${encodeURIComponent(normalizedId)}?language=${encodeURIComponent(language)}&append_to_response=${APPEND_FIELDS}`;\r\n  let data;\r\n  try {\r\n    data = await fetchJson(url, auth, { signal: options.signal });\r\n  } catch (err) {\r\n    logWarn(`Failed to fetch TMDB ${normalizedType}#${normalizedId}:`, err?.message || err);\r\n    throw err;\r\n  }\r\n  setCacheEntry(key, data);\r\n  const entry = getCacheEntry(key);\r\n  return {\r\n    id: normalizedId,\r\n    type: normalizedType,\r\n    language,\r\n    data,\r\n    fetchedAt: entry?.ts || now(),\r\n    source: 'network'\r\n  };\r\n}\r\n\r\nfunction extractRawTitle(item){\r\n  if(!item || typeof item !== 'object') return '';\r\n  const candidates = [item.title, item.name, item.originalTitle, item.original_name, item.original_title];\r\n  for(const candidate of candidates){\r\n    const str = typeof candidate === 'string' ? candidate.trim() : '';\r\n    if(str) return str;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction parseYear(value){\r\n  if(value == null) return null;\r\n  const num = Number(value);\r\n  if(Number.isFinite(num) && num > 1800) return Math.trunc(num);\r\n  if(typeof value === 'string'){\r\n    const match = value.match(/(19|20|21)\\d{2}/);\r\n    if(match) return Number(match[0]);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction extractRawYear(item){\r\n  if(!item || typeof item !== 'object') return null;\r\n  const direct = parseYear(item.year ?? item.startYear);\r\n  if(direct) return direct;\r\n  const dateCandidate = item.originallyAvailableAt || item.premieredAt || item.releaseDate || item.firstAirDate;\r\n  const fromDate = parseYear(dateCandidate);\r\n  if(fromDate) return fromDate;\r\n  return null;\r\n}\r\n\r\nasync function fetchByExternalId(type, imdbId, options){\r\n  const language = options.language || 'en-US';\r\n  const url = `${API_BASE}/find/${encodeURIComponent(imdbId)}?external_source=imdb_id&language=${encodeURIComponent(language)}`;\r\n  const json = await fetchJson(url, options.auth, { signal: options.signal });\r\n  const key = type === 'tv' ? 'tv_results' : 'movie_results';\r\n  const results = Array.isArray(json?.[key]) ? json[key] : [];\r\n  const hit = results.find(entry => entry && entry.id != null);\r\n  if(!hit || hit.id == null) return null;\r\n  const resolvedId = String(hit.id);\r\n  const details = await fetchDetails(type, resolvedId, options);\r\n  if(details){\r\n    details.id = resolvedId;\r\n    details.resolvedId = resolvedId;\r\n  }\r\n  return details;\r\n}\r\n\r\nfunction buildSearchUrl(type, title, language, year){\r\n  const encodedTitle = encodeURIComponent(title);\r\n  const lang = encodeURIComponent(language || 'en-US');\r\n  const base = `${API_BASE}/search/${type}?query=${encodedTitle}&language=${lang}`;\r\n  if(!year) return base;\r\n  const param = type === 'tv' ? 'first_air_date_year' : 'year';\r\n  return `${base}&${param}=${encodeURIComponent(String(year))}`;\r\n}\r\n\r\nasync function fetchBySearch(type, title, year, options){\r\n  if(!title) return null;\r\n  const language = options.language || 'en-US';\r\n  const url = buildSearchUrl(type, title, language, year);\r\n  const json = await fetchJson(url, options.auth, { signal: options.signal });\r\n  const results = Array.isArray(json?.results) ? json.results : [];\r\n  if(!results.length) return null;\r\n  const hit = results.find(entry => entry && entry.id != null) || results[0];\r\n  if(!hit || hit.id == null) return null;\r\n  const resolvedId = String(hit.id);\r\n  const details = await fetchDetails(type, resolvedId, options);\r\n  if(details){\r\n    details.id = resolvedId;\r\n    details.resolvedId = resolvedId;\r\n  }\r\n  return details;\r\n}\r\n\r\nfunction extractIds(item){\r\n  const ids = { tmdb: '', imdb: '' };\r\n  if(!item || typeof item !== 'object') return ids;\r\n  const merge = (guid)=>{\r\n    const raw = typeof guid === 'string' ? guid : guid?.id;\r\n    if(!raw) return;\r\n    const str = String(raw).trim();\r\n    if(!str) return;\r\n    const [schemePart, restPart] = str.split('://');\r\n    if(!restPart){\r\n      if(str.startsWith('tt')) ids.imdb = str;\r\n      return;\r\n    }\r\n    const scheme = schemePart.toLowerCase();\r\n    const rest = restPart.split('?')[0].replace(/^\\//, '');\r\n    const tail = rest.split('/').pop();\r\n    if(scheme === 'imdb' || scheme.includes('imdb')){\r\n      ids.imdb = tail || ids.imdb;\r\n      return;\r\n    }\r\n    if(scheme === 'tmdb' || scheme.includes('themoviedb')){\r\n      ids.tmdb = tail || ids.tmdb;\r\n      return;\r\n    }\r\n  };\r\n  if(item.ids && typeof item.ids === 'object'){\r\n    if(item.ids.tmdb) ids.tmdb = cleanId(item.ids.tmdb);\r\n    if(item.ids.imdb) ids.imdb = cleanId(item.ids.imdb);\r\n  }\r\n  merge(item.guid);\r\n  if(Array.isArray(item.guids)) item.guids.forEach(merge);\r\n  return ids;\r\n}\r\n\r\nfunction buildSearchTitleOverride(raw, options){\r\n  const preferred = cleanId(options?.searchTitle);\r\n  if(preferred) return preferred;\r\n  return extractRawTitle(raw);\r\n}\r\n\r\nexport async function fetchDetailsForItem(raw, options = {}){\r\n  if(!raw || typeof raw !== 'object') return null;\r\n  const type = raw.type === 'tv' ? 'tv' : 'movie';\r\n  const language = cleanId(options.language) || 'en-US';\r\n  const auth = options.auth || await resolveAuth(options.settings, options.authOptions || {});\r\n  if(!auth){\r\n    logWarn('Skipping TMDB lookup (missing credentials).');\r\n    return null;\r\n  }\r\n  const baseOptions = { ...options, auth, language };\r\n  const ids = extractIds(raw);\r\n  const attempts = [];\r\n\r\n  if(ids.tmdb){\r\n    attempts.push({ label: 'direct id', fn: ()=> fetchDetails(type, ids.tmdb, baseOptions) });\r\n  }\r\n  if(ids.imdb){\r\n    attempts.push({ label: 'imdb find', fn: ()=> fetchByExternalId(type, ids.imdb, baseOptions) });\r\n  }\r\n  const searchTitle = buildSearchTitleOverride(raw, options);\r\n  if(searchTitle){\r\n    const searchYear = options.searchYear ?? extractRawYear(raw);\r\n    attempts.push({ label: 'search', fn: ()=> fetchBySearch(type, searchTitle, searchYear, baseOptions) });\r\n  }\r\n\r\n  for(const attempt of attempts){\r\n    try {\r\n      const result = await attempt.fn();\r\n      if(result){\r\n        if(!result.resolvedId && result.id) result.resolvedId = result.id;\r\n        return result;\r\n      }\r\n    } catch (err) {\r\n      logWarn(`TMDB ${attempt.label} lookup failed:`, err?.message || err);\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n// Periodically prune expired entries\r\nsetInterval(()=>{ try { pruneExpired(); } catch(_err){} }, CACHE_TTL / 6).unref?.();\r\n\r\nexport default {\r\n  fetchDetails,\r\n  fetchDetailsForItem,\r\n  resolveAuth,\r\n  clearCache,\r\n  getCached,\r\n  tmdbImageUrl,\r\n  getRateLimitState,\r\n  addRateLimitListener\r\n};\r\n", "import { fetchDetailsForItem, tmdbImageUrl } from './tmdbClient.js';\r\n\r\nconst LOG_PREFIX = '[hero:normalizer]';\r\nconst BACKDROP_MIN_WIDTH = 1920;\r\nconst TMDB_BACKDROP_SIZE = 'original';\r\n\r\nfunction logWarn(...args){\r\n  try {\r\n    console.warn(LOG_PREFIX, ...args);\r\n  } catch (_err) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction cleanString(value){\r\n  if(typeof value !== 'string') return '';\r\n  const trimmed = value.trim();\r\n  return trimmed;\r\n}\r\n\r\nfunction nonEmptyString(value){\r\n  const str = cleanString(value);\r\n  return str ? str : '';\r\n}\r\n\r\nfunction parseYear(value){\r\n  if(value == null) return null;\r\n  if(typeof value === 'number' && Number.isFinite(value)){\r\n    if(value > 1800 && value < 9999) return Math.trunc(value);\r\n  }\r\n  if(typeof value === 'string'){\r\n    const match = value.match(/(19|20|21)\\d{2}/);\r\n    if(match) return Number(match[0]);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction parseDateYear(value){\r\n  if(!value) return null;\r\n  try {\r\n    const date = new Date(value);\r\n    if(Number.isNaN(date.getTime())) return null;\r\n    const y = date.getUTCFullYear();\r\n    return y > 1800 && y < 9999 ? y : null;\r\n  } catch (_err) {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction clampRating(value){\r\n  const num = Number(value);\r\n  if(!Number.isFinite(num) || num <= 0) return null;\r\n  return Math.round(num * 10) / 10;\r\n}\r\n\r\nfunction minutesFromDuration(raw){\r\n  if(raw == null) return null;\r\n  const num = Number(raw);\r\n  if(Number.isFinite(num) && num > 0){\r\n    if(num > 1000){\r\n      return Math.max(1, Math.round(num / 60_000));\r\n    }\r\n    return Math.round(num);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction collectGenres(raw, tmdb){\r\n  const names = [];\r\n  if(tmdb && Array.isArray(tmdb.genres)){\r\n    for(const entry of tmdb.genres){\r\n      if(entry && typeof entry === 'object' && entry.name){\r\n        const str = cleanString(entry.name);\r\n        if(str) names.push(str);\r\n      }\r\n    }\r\n  }\r\n  const rawGenres = raw?.genres;\r\n  if(Array.isArray(rawGenres)){\r\n    rawGenres.forEach(entry => {\r\n      if(!entry) return;\r\n      if(typeof entry === 'string'){\r\n        const str = cleanString(entry);\r\n        if(str) names.push(str);\r\n        return;\r\n      }\r\n      const str = cleanString(entry.tag || entry.title || entry.label || entry.name);\r\n      if(str) names.push(str);\r\n    });\r\n  }\r\n  const seen = new Set();\r\n  const result = [];\r\n  for(const name of names){\r\n    const key = name.toLowerCase();\r\n    if(seen.has(key)) continue;\r\n    seen.add(key);\r\n    result.push(name);\r\n  }\r\n  return result.slice(0, 2);\r\n}\r\n\r\nfunction extractIds(raw){\r\n  const ids = {};\r\n  const set = (key, value)=>{\r\n    if(value == null) return;\r\n    const input = typeof value === 'string' ? value : String(value);\r\n    const str = nonEmptyString(input);\r\n    if(str) ids[key] = str;\r\n  };\r\n  if(raw && typeof raw === 'object'){\r\n    if(raw.ratingKey != null) set('ratingKey', raw.ratingKey);\r\n    if(raw.ids && typeof raw.ids === 'object'){\r\n      set('tmdb', raw.ids.tmdb);\r\n      set('imdb', raw.ids.imdb);\r\n    }\r\n    const mergeGuid = (guid)=>{\r\n      const rawGuid = typeof guid === 'string' ? guid : guid?.id;\r\n      const str = nonEmptyString(rawGuid);\r\n      if(!str) return;\r\n      const [schemePart, restPart] = str.split('://');\r\n      if(restPart){\r\n        const scheme = schemePart.toLowerCase();\r\n        const rest = restPart.split('?')[0].replace(/^\\//, '');\r\n        const tail = rest.split('/').pop();\r\n        if(scheme === 'imdb' || scheme.includes('imdb')){ set('imdb', tail); return; }\r\n        if(scheme === 'tmdb' || scheme.includes('themoviedb')){ set('tmdb', tail); return; }\r\n        if(scheme === 'tvdb' || scheme.includes('thetvdb')){ set('tvdb', tail); return; }\r\n      } else if(str.startsWith('tt')){\r\n        set('imdb', str);\r\n      }\r\n    };\r\n    mergeGuid(raw.guid);\r\n    if(Array.isArray(raw.guids)) raw.guids.forEach(mergeGuid);\r\n  }\r\n  return ids;\r\n}\r\n\r\nfunction chooseTitle(raw, tmdb, type){\r\n  if(tmdb){\r\n    if(type === 'tv'){\r\n      const candidates = [tmdb.name, tmdb.original_name];\r\n      for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\r\n    } else {\r\n      const candidates = [tmdb.title, tmdb.original_title];\r\n      for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\r\n    }\r\n  }\r\n  if(raw){\r\n    const candidates = [raw.title, raw.name, raw.originalTitle];\r\n    for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction chooseTagline(raw, tmdb){\r\n  const candidates = [tmdb?.tagline, raw?.tagline];\r\n  for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\r\n  return '';\r\n}\r\n\r\nfunction chooseOverview(raw, tmdb){\r\n  const candidates = [tmdb?.overview, raw?.summary, raw?.plot, raw?.description];\r\n  for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\r\n  return '';\r\n}\r\n\r\nfunction chooseYear(raw, tmdb, type){\r\n  if(tmdb){\r\n    const primary = type === 'tv' ? tmdb.first_air_date : tmdb.release_date;\r\n    const y = parseYear(primary) ?? parseDateYear(primary);\r\n    if(y) return y;\r\n    const secondary = type === 'tv' ? tmdb.last_air_date : tmdb.release_date;\r\n    const y2 = parseYear(secondary) ?? parseDateYear(secondary);\r\n    if(y2) return y2;\r\n  }\r\n  const fromRaw = parseYear(raw?.year) ?? parseDateYear(raw?.originallyAvailableAt);\r\n  if(fromRaw) return fromRaw;\r\n  return null;\r\n}\r\n\r\nfunction chooseRuntime(raw, tmdb, type){\r\n  if(tmdb){\r\n    if(type === 'tv' && Array.isArray(tmdb.episode_run_time) && tmdb.episode_run_time.length){\r\n      const first = minutesFromDuration(tmdb.episode_run_time.find(v => minutesFromDuration(v)));\r\n      if(first) return first;\r\n    }\r\n    if(type === 'movie'){\r\n      const minutes = minutesFromDuration(tmdb.runtime);\r\n      if(minutes) return minutes;\r\n    }\r\n  }\r\n  if(type === 'movie'){\r\n    const fromRaw = minutesFromDuration(raw?.durationMin ?? raw?.duration);\r\n    if(fromRaw) return fromRaw;\r\n  } else if(type === 'tv'){\r\n    if(Array.isArray(raw?.seasons)){\r\n      for(const season of raw.seasons){\r\n        if(!Array.isArray(season?.episodes)) continue;\r\n        for(const ep of season.episodes){\r\n          const minutes = minutesFromDuration(ep?.durationMin ?? ep?.duration);\r\n          if(minutes) return minutes;\r\n        }\r\n      }\r\n    }\r\n    const fallback = minutesFromDuration(raw?.durationMin ?? raw?.duration);\r\n    if(fallback) return fallback;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction chooseRating(raw, tmdb){\r\n  const fromTmdb = clampRating(tmdb?.vote_average);\r\n  if(fromTmdb) return fromTmdb;\r\n  const fromRaw = clampRating(raw?.rating ?? raw?.audienceRating);\r\n  if(fromRaw) return fromRaw;\r\n  return null;\r\n}\r\n\r\nfunction chooseVoteCount(tmdb){\r\n  const num = Number(tmdb?.vote_count);\r\n  if(Number.isFinite(num) && num > 0) return Math.round(num);\r\n  return null;\r\n}\r\n\r\nfunction chooseCertification(raw, tmdb, type){\r\n  if(type === 'movie' && tmdb?.release_dates?.results){\r\n    const releases = Array.isArray(tmdb.release_dates.results) ? tmdb.release_dates.results : [];\r\n    const us = releases.find(entry => entry && entry.iso_3166_1 === 'US');\r\n    const dates = Array.isArray(us?.release_dates) ? us.release_dates : [];\r\n    const sorted = dates.filter(entry => nonEmptyString(entry?.certification)).sort((a, b)=>{\r\n      const at = Number(a?.type ?? 0);\r\n      const bt = Number(b?.type ?? 0);\r\n      return at - bt;\r\n    });\r\n    if(sorted.length){\r\n      const cert = nonEmptyString(sorted.find(entry => entry.type === 3)?.certification || sorted[0].certification);\r\n      if(cert) return cert;\r\n    }\r\n  }\r\n  if(type === 'tv' && Array.isArray(tmdb?.content_ratings?.results)){\r\n    const us = tmdb.content_ratings.results.find(entry => entry && entry.iso_3166_1 === 'US');\r\n    const rating = nonEmptyString(us?.rating);\r\n    if(rating) return rating;\r\n  }\r\n  const rawRating = nonEmptyString(raw?.contentRating);\r\n  if(rawRating){\r\n    const match = rawRating.split('/').pop();\r\n    const cleaned = nonEmptyString(match);\r\n    if(cleaned) return cleaned;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction extractBackdrops(tmdb, raw){\r\n  const urls = [];\r\n\r\n  // Primary: TMDB backdrops (best quality)\r\n  const tmdbList = Array.isArray(tmdb?.images?.backdrops) ? tmdb.images.backdrops : [];\r\n  for(const backdrop of tmdbList){\r\n    if(!backdrop || !backdrop.file_path) continue;\r\n    if(backdrop.width && backdrop.width < BACKDROP_MIN_WIDTH) continue;\r\n    const url = tmdbImageUrl(backdrop.file_path, TMDB_BACKDROP_SIZE);\r\n    if(!url) continue;\r\n    if(!urls.includes(url)) urls.push(url);\r\n  }\r\n\r\n  // Fallback: Plex images if no TMDB backdrops available\r\n  if(urls.length === 0 && raw){\r\n    const plexBackdrop = raw.art || raw.thumb || raw.thumbFile || raw.backdrop;\r\n    if(plexBackdrop && typeof plexBackdrop === 'string'){\r\n      const trimmed = plexBackdrop.trim();\r\n      if(trimmed && !urls.includes(trimmed)){\r\n        urls.push(trimmed);\r\n      }\r\n    }\r\n  }\r\n\r\n  return urls;\r\n}\r\n\r\nfunction computeTvCounts(raw, tmdb){\r\n  const result = { seasons: null, episodes: null };\r\n  if(Number.isFinite(tmdb?.number_of_seasons)) result.seasons = Math.max(0, Math.round(tmdb.number_of_seasons));\r\n  if(Number.isFinite(tmdb?.number_of_episodes)) result.episodes = Math.max(0, Math.round(tmdb.number_of_episodes));\r\n  if(result.seasons == null && Array.isArray(raw?.seasons)) result.seasons = raw.seasons.length;\r\n  if(result.episodes == null && Array.isArray(raw?.seasons)){\r\n    let count = 0;\r\n    raw.seasons.forEach(season => { if(Array.isArray(season?.episodes)) count += season.episodes.length; });\r\n    if(count > 0) result.episodes = count;\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction buildCta(type, ids){\r\n  if(!ids || typeof ids !== 'object') return null;\r\n  const preferred = ids.tmdb || ids.imdb || ids.ratingKey;\r\n  const targetId = nonEmptyString(preferred);\r\n  if(!targetId) return null;\r\n  const kind = type === 'tv' ? 'show' : 'movie';\r\n  const label = kind === 'show' ? 'Show details' : 'Movie details';\r\n  return {\r\n    id: targetId,\r\n    kind,\r\n    label,\r\n    target: `#/${kind}/${targetId}`\r\n  };\r\n}\r\n\r\nfunction finalizeIds(ids){\r\n  const out = {};\r\n  Object.entries(ids || {}).forEach(([key, value]) => {\r\n    const str = nonEmptyString(value);\r\n    if(str) out[key] = str;\r\n  });\r\n  return out;\r\n}\r\n\r\nfunction ensureId(ids, type){\r\n  if(ids.ratingKey) return ids.ratingKey;\r\n  if(ids.tmdb) return `${type}-${ids.tmdb}`;\r\n  if(ids.imdb) return `${type}-${ids.imdb}`;\r\n  return '';\r\n}\r\n\r\nexport async function normalizeItem(raw, options = {}){\r\n  if(!raw || typeof raw !== 'object') return null;\r\n  const type = raw.type === 'tv' ? 'tv' : 'movie';\r\n  const language = nonEmptyString(options.language) || 'en-US';\r\n  let ids = extractIds(raw);\r\n\r\n  let tmdbBundle = null;\r\n  if(options.disableTmdb !== true){\r\n    try {\r\n      tmdbBundle = await fetchDetailsForItem(raw, {\r\n        language,\r\n        settings: options.settings,\r\n        auth: options.auth,\r\n        authOptions: options.authOptions,\r\n        signal: options.signal,\r\n        searchTitle: options.searchTitle,\r\n        searchYear: options.searchYear\r\n      });\r\n    } catch (err) {\r\n      logWarn('TMDB lookup failed:', err?.message || err);\r\n    }\r\n  }\r\n  const tmdbData = tmdbBundle?.data;\r\n  if(tmdbBundle?.resolvedId){\r\n    if(!ids.tmdb) ids.tmdb = String(tmdbBundle.resolvedId);\r\n  }\r\n  if(tmdbData?.id && !ids.tmdb){\r\n    ids.tmdb = String(tmdbData.id);\r\n  }\r\n  if(tmdbData?.imdb_id && !ids.imdb){\r\n    ids.imdb = String(tmdbData.imdb_id).trim();\r\n  }\r\n  ids = finalizeIds(ids);\r\n\r\n  const title = chooseTitle(raw, tmdbData, type);\r\n  if(!title){\r\n    logWarn('Skipping item without title', raw?.ratingKey || raw?.title || raw?.guid || 'unknown');\r\n    return null;\r\n  }\r\n\r\n  const normalized = {\r\n    id: ensureId(ids, type) || String(raw.ratingKey ?? raw.guid ?? title),\r\n    type,\r\n    title\r\n  };\r\n\r\n  const tagline = chooseTagline(raw, tmdbData);\r\n  if(tagline) normalized.tagline = tagline;\r\n\r\n  const overview = chooseOverview(raw, tmdbData);\r\n  if(overview) normalized.overview = overview;\r\n\r\n  const year = chooseYear(raw, tmdbData, type);\r\n  if(year) normalized.year = year;\r\n\r\n  const runtime = chooseRuntime(raw, tmdbData, type);\r\n  if(runtime) normalized.runtime = runtime;\r\n\r\n  const rating = chooseRating(raw, tmdbData);\r\n  if(rating != null) normalized.rating = rating;\r\n\r\n  const voteCount = chooseVoteCount(tmdbData);\r\n  if(voteCount != null) normalized.voteCount = voteCount;\r\n\r\n  const genres = collectGenres(raw, tmdbData);\r\n  if(genres.length) normalized.genres = genres;\r\n\r\n  const certification = chooseCertification(raw, tmdbData, type);\r\n  if(certification) normalized.certification = certification;\r\n\r\n  const backdrops = extractBackdrops(tmdbData, raw);\r\n  if(backdrops.length) normalized.backdrops = backdrops;\r\n\r\n  if(type === 'tv'){\r\n    const counts = computeTvCounts(raw, tmdbData);\r\n    if(counts.seasons != null) normalized.seasons = counts.seasons;\r\n    if(counts.episodes != null) normalized.episodes = counts.episodes;\r\n  }\r\n\r\n  const cta = buildCta(type, ids);\r\n  if(cta) normalized.cta = cta;\r\n\r\n  if(Object.keys(ids).length) normalized.ids = ids;\r\n  normalized.language = language;\r\n\r\n  if(tmdbBundle){\r\n    const tmdbMeta = {\r\n      id: ids.tmdb || (tmdbBundle.id ? String(tmdbBundle.id) : ''),\r\n      fetchedAt: tmdbBundle.fetchedAt || Date.now(),\r\n      source: tmdbBundle.source\r\n    };\r\n    if(!tmdbMeta.id) delete tmdbMeta.id;\r\n    if(!tmdbMeta.source) delete tmdbMeta.source;\r\n    if(options.includeTmdbRaw && tmdbData) tmdbMeta.raw = tmdbData;\r\n    if(Object.keys(tmdbMeta).length) normalized.tmdb = tmdbMeta;\r\n  }\r\n\r\n  if(options.includeSource) normalized.source = raw;\r\n\r\n  return normalized;\r\n}\r\n\r\nexport async function normalizeItems(items, options = {}){\r\n  if(!Array.isArray(items)) return [];\r\n  const out = [];\r\n  for(const item of items){\r\n    const normalized = await normalizeItem(item, options);\r\n    if(normalized) out.push(normalized);\r\n  }\r\n  return out;\r\n}\r\n\r\nexport default {\r\n  normalizeItem,\r\n  normalizeItems\r\n};\r\n", "const LOG_PREFIX = '[hero:storage]';\r\nconst POOL_PREFIX = 'heroPool:';\r\nconst HISTORY_PREFIX = 'heroHistory:';\r\nconst MEMORY_PREFIX = 'heroMemory:';\r\nconst FAILURE_PREFIX = 'heroFailures:';\r\nconst SESSION_SUFFIX = ':session';\r\nconst HISTORY_LIMIT = 80;\r\nconst HISTORY_WINDOW_MS = 1000 * 60 * 60 * 24 * 14; // 14 days\r\nconst MEMORY_LIMIT = 120;\r\nconst FAILURE_LIMIT = 80;\r\n\r\nfunction now(){\r\n  return Date.now();\r\n}\r\n\r\nfunction safeArea(name){\r\n  try {\r\n    if(typeof globalThis !== 'undefined' && globalThis[name]){\r\n      return globalThis[name];\r\n    }\r\n  } catch (err) {\r\n    console.warn(LOG_PREFIX, `Failed to resolve storage area ${name}:`, err?.message || err);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction readRaw(area, key){\r\n  if(!area) return null;\r\n  try {\r\n    return area.getItem(key);\r\n  } catch (err) {\r\n    console.warn(LOG_PREFIX, `Failed to read ${key} from storage:`, err?.message || err);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction writeRaw(area, key, value){\r\n  if(!area) return;\r\n  try {\r\n    if(value == null){\r\n      area.removeItem(key);\r\n    } else {\r\n      area.setItem(key, value);\r\n    }\r\n  } catch (err) {\r\n    console.warn(LOG_PREFIX, `Failed to write ${key} to storage:`, err?.message || err);\r\n  }\r\n}\r\n\r\nfunction parseJson(raw){\r\n  if(!raw) return null;\r\n  try {\r\n    return JSON.parse(raw);\r\n  } catch (err) {\r\n    console.warn(LOG_PREFIX, 'Failed to parse storage JSON:', err?.message || err);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction stringifyJson(value){\r\n  try {\r\n    return JSON.stringify(value);\r\n  } catch (err) {\r\n    console.warn(LOG_PREFIX, 'Failed to stringify storage payload:', err?.message || err);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction normalizeKind(kind){\r\n  if(kind === 'shows' || kind === 'show' || kind === 'series') return 'series';\r\n  return 'movies';\r\n}\r\n\r\nfunction poolKey(kind){\r\n  return `${POOL_PREFIX}${normalizeKind(kind)}`;\r\n}\r\n\r\nfunction sessionPoolKey(kind){\r\n  return `${poolKey(kind)}${SESSION_SUFFIX}`;\r\n}\r\n\r\nfunction historyKey(kind){\r\n  return `${HISTORY_PREFIX}${normalizeKind(kind)}`;\r\n}\r\n\r\nfunction memoryKey(kind){\r\n  return `${MEMORY_PREFIX}${normalizeKind(kind)}`;\r\n}\r\n\r\nfunction failureKey(kind){\r\n  return `${FAILURE_PREFIX}${normalizeKind(kind)}`;\r\n}\r\n\r\nfunction readPoolFrom(area, key){\r\n  const raw = readRaw(area, key);\r\n  if(!raw) return null;\r\n  const parsed = parseJson(raw);\r\n  if(!parsed || typeof parsed !== 'object') return null;\r\n  return parsed;\r\n}\r\n\r\nfunction writePoolTo(area, key, payload){\r\n  const json = stringifyJson(payload);\r\n  if(json == null) return;\r\n  writeRaw(area, key, json);\r\n}\r\n\r\nfunction readMemory(kind){\r\n  const { local } = resolveAreas();\r\n  const key = memoryKey(kind);\r\n  const raw = readPoolFrom(local, key);\r\n  if(!Array.isArray(raw)) return [];\r\n  return raw.map(entry => ({\r\n    id: typeof entry?.id === 'string' ? entry.id : String(entry?.id || ''),\r\n    ts: Number(entry?.ts ?? entry?.timestamp ?? entry?.time ?? 0),\r\n    slot: typeof entry?.slot === 'string' ? entry.slot : (entry?.slot != null ? String(entry.slot) : undefined)\r\n  })).filter(entry => entry.id && Number.isFinite(entry.ts));\r\n}\r\n\r\nfunction writeMemory(kind, entries){\r\n  const payload = Array.isArray(entries) ? entries.map(entry => ({\r\n    id: entry.id,\r\n    ts: entry.ts,\r\n    slot: entry.slot\r\n  })) : [];\r\n  const json = stringifyJson(payload);\r\n  if(json == null) return;\r\n  const { local, session } = resolveAreas();\r\n  const key = memoryKey(kind);\r\n  writeRaw(local, key, json);\r\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, json);\r\n}\r\n\r\nfunction readFailures(kind){\r\n  const { local } = resolveAreas();\r\n  const key = failureKey(kind);\r\n  const raw = readPoolFrom(local, key);\r\n  if(!Array.isArray(raw)) return [];\r\n  return raw.map(entry => ({\r\n    id: typeof entry?.id === 'string' ? entry.id : String(entry?.id || ''),\r\n    ts: Number(entry?.ts ?? entry?.timestamp ?? entry?.time ?? 0),\r\n    reason: typeof entry?.reason === 'string' ? entry.reason : '',\r\n    hits: Number(entry?.hits) || 0\r\n  })).filter(entry => entry.id && Number.isFinite(entry.ts));\r\n}\r\n\r\nfunction writeFailures(kind, entries){\r\n  const payload = Array.isArray(entries) ? entries.map(entry => ({\r\n    id: entry.id,\r\n    ts: entry.ts,\r\n    reason: entry.reason || '',\r\n    hits: Number(entry.hits) || 0\r\n  })) : [];\r\n  const json = stringifyJson(payload);\r\n  if(json == null) return;\r\n  const { local, session } = resolveAreas();\r\n  const key = failureKey(kind);\r\n  writeRaw(local, key, json);\r\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, json);\r\n}\r\n\r\nfunction resolveAreas(){\r\n  return {\r\n    local: safeArea('localStorage'),\r\n    session: safeArea('sessionStorage')\r\n  };\r\n}\r\n\r\nfunction clonePoolData(data){\r\n  if(!data || typeof data !== 'object') return null;\r\n  const copy = {\r\n    kind: normalizeKind(data.kind || data.library || data.type),\r\n    items: Array.isArray(data.items) ? data.items.slice() : [],\r\n    updatedAt: Number(data.updatedAt) || now(),\r\n    expiresAt: Number(data.expiresAt) || 0,\r\n    policyHash: typeof data.policyHash === 'string' ? data.policyHash : '',\r\n    slotSummary: data.slotSummary && typeof data.slotSummary === 'object' ? { ...data.slotSummary } : {},\r\n    meta: data.meta && typeof data.meta === 'object' ? { ...data.meta } : undefined\r\n  };\r\n  if(data.generatedAt && !copy.updatedAt){\r\n    copy.updatedAt = Number(data.generatedAt) || copy.updatedAt;\r\n  }\r\n  return copy;\r\n}\r\n\r\nexport function getStoredPool(kind, { now: nowTs = now(), policyHash = null, allowExpired = false } = {}){\r\n  const { local, session } = resolveAreas();\r\n  const key = poolKey(kind);\r\n  const sessionKey = sessionPoolKey(kind);\r\n  const sessionPool = readPoolFrom(session, sessionKey);\r\n  const localPool = readPoolFrom(local, key);\r\n  const source = sessionPool || localPool || null;\r\n  if(!source) return null;\r\n  const pool = clonePoolData(source);\r\n  if(!pool) return null;\r\n  const expiry = Number(pool.expiresAt) || 0;\r\n  const valid = expiry > nowTs;\r\n  const matchesPolicy = policyHash ? pool.policyHash === policyHash : true;\r\n  if(!allowExpired && !valid) return null;\r\n  if(policyHash && !matchesPolicy) return null;\r\n  pool.isExpired = !valid;\r\n  pool.matchesPolicy = matchesPolicy;\r\n  pool.source = sessionPool ? 'session' : 'local';\r\n  return pool;\r\n}\r\n\r\nexport function storePool(kind, data){\r\n  const { local, session } = resolveAreas();\r\n  if(!data || typeof data !== 'object'){\r\n    invalidatePool(kind);\r\n    return;\r\n  }\r\n  const payload = clonePoolData({ ...data, kind });\r\n  if(!payload) return;\r\n  const key = poolKey(kind);\r\n  const sessionKey = sessionPoolKey(kind);\r\n  const json = stringifyJson(payload);\r\n  if(json == null) return;\r\n  writeRaw(local, key, json);\r\n  writeRaw(session, sessionKey, json);\r\n}\r\n\r\nexport function invalidatePool(kind){\r\n  const { local, session } = resolveAreas();\r\n  const key = poolKey(kind);\r\n  const sessionKey = sessionPoolKey(kind);\r\n  writeRaw(local, key, null);\r\n  writeRaw(session, sessionKey, null);\r\n}\r\n\r\nfunction readHistory(kind){\r\n  const { local } = resolveAreas();\r\n  const key = historyKey(kind);\r\n  const raw = readPoolFrom(local, key);\r\n  if(!Array.isArray(raw)) return [];\r\n  return raw.map(entry => ({\r\n    id: typeof entry?.id === 'string' ? entry.id : String(entry?.id || ''),\r\n    ts: Number(entry?.ts ?? entry?.timestamp ?? entry?.time ?? entry?.at)\r\n  })).filter(entry => entry.id && Number.isFinite(entry.ts));\r\n}\r\n\r\nfunction writeHistory(kind, entries){\r\n  const { local, session } = resolveAreas();\r\n  const key = historyKey(kind);\r\n  const payload = Array.isArray(entries) ? entries.map(entry => ({ id: entry.id, ts: entry.ts })) : [];\r\n  const json = stringifyJson(payload);\r\n  if(json == null) return;\r\n  writeRaw(local, key, json);\r\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, json);\r\n}\r\n\r\nfunction resolveEntryKey(entry){\r\n  if(!entry) return null;\r\n  if(typeof entry === 'string') return entry.trim() || null;\r\n  if(typeof entry === 'number') return `#${entry}`;\r\n  if(entry && typeof entry === 'object'){\r\n    if(entry.poolId != null) return String(entry.poolId);\r\n    if(entry.poolEntryId != null) return String(entry.poolEntryId);\r\n    if(entry.heroId != null) return String(entry.heroId);\r\n    if(entry.cta && entry.cta.id != null) return String(entry.cta.id);\r\n    if(entry.ids && typeof entry.ids === 'object'){\r\n      if(entry.ids.imdb) return `imdb:${entry.ids.imdb}`;\r\n      if(entry.ids.tmdb) return `tmdb:${entry.ids.tmdb}`;\r\n      if(entry.ids.tvdb) return `tvdb:${entry.ids.tvdb}`;\r\n    }\r\n    if(entry.guid) return String(entry.guid);\r\n    if(entry.ratingKey != null) return `rk:${entry.ratingKey}`;\r\n    if(entry.id != null) return String(entry.id);\r\n    if(entry.slug) return String(entry.slug);\r\n    if(entry.key) return String(entry.key);\r\n    if(entry.title){\r\n      const suffix = entry.year ? `:${entry.year}` : '';\r\n      return `title:${entry.title}${suffix}`;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction resolveHistoryId(entry){\r\n  return resolveEntryKey(entry);\r\n}\r\n\r\nexport function recordHeroHistory(kind, entry, { timestamp = now(), limit = HISTORY_LIMIT } = {}){\r\n  const id = resolveHistoryId(entry);\r\n  if(!id) return null;\r\n  const list = readHistory(kind);\r\n  const filtered = list.filter(item => item.id !== id);\r\n  filtered.unshift({ id, ts: timestamp });\r\n  const pruned = filtered\r\n    .filter(item => timestamp - item.ts <= HISTORY_WINDOW_MS)\r\n    .slice(0, Math.max(1, limit));\r\n  writeHistory(kind, pruned);\r\n  return pruned;\r\n}\r\n\r\nexport function getHeroHistory(kind, { now: nowTs = now(), windowMs = HISTORY_WINDOW_MS, limit = HISTORY_LIMIT } = {}){\r\n  const list = readHistory(kind);\r\n  if(!list.length) return { entries: [], set: new Set() };\r\n  const threshold = nowTs - Math.max(0, windowMs);\r\n  const seen = new Set();\r\n  const entries = [];\r\n  for(const item of list){\r\n    if(!item || !item.id) continue;\r\n    if(item.ts < threshold) continue;\r\n    if(seen.has(item.id)) continue;\r\n    seen.add(item.id);\r\n    entries.push({ id: item.id, ts: item.ts });\r\n    if(entries.length >= limit) break;\r\n  }\r\n  return { entries, set: seen };\r\n}\r\n\r\nexport function recordHeroMemory(kind, entries, { timestamp = now(), ttlMs = 0, limit = MEMORY_LIMIT } = {}){\r\n  if(!Array.isArray(entries) || !entries.length) return [];\r\n  const threshold = ttlMs > 0 ? Math.max(0, timestamp - ttlMs) : 0;\r\n  const list = readMemory(kind);\r\n  const seen = new Set();\r\n  const preserved = [];\r\n  for(const item of list){\r\n    if(!item || !item.id) continue;\r\n    if(threshold && item.ts < threshold) continue;\r\n    if(seen.has(item.id)) continue;\r\n    seen.add(item.id);\r\n    preserved.push(item);\r\n  }\r\n  const additions = [];\r\n  const additionIds = new Set();\r\n  for(const entry of entries){\r\n    const id = resolveEntryKey(entry);\r\n    if(!id) continue;\r\n    const slot = typeof entry?.slot === 'string' ? entry.slot : (entry?.poolSlot ? String(entry.poolSlot) : undefined);\r\n    additions.push({ id, ts: timestamp, slot });\r\n    additionIds.add(id);\r\n  }\r\n  const filteredPreserved = preserved.filter(item => !additionIds.has(item.id));\r\n  const merged = [...additions, ...filteredPreserved].filter(item => item && item.id);\r\n  const limited = merged.slice(0, Math.max(1, limit));\r\n  const deduped = [];\r\n  const finalSeen = new Set();\r\n  for(const item of limited){\r\n    if(finalSeen.has(item.id)) continue;\r\n    finalSeen.add(item.id);\r\n    deduped.push(item);\r\n  }\r\n  writeMemory(kind, deduped);\r\n  return deduped;\r\n}\r\n\r\nexport function getHeroMemory(kind, { now: nowTs = now(), windowMs = 0, limit = MEMORY_LIMIT } = {}){\r\n  const list = readMemory(kind);\r\n  if(!list.length) return { entries: [], set: new Set() };\r\n  const threshold = windowMs > 0 ? Math.max(0, nowTs - windowMs) : 0;\r\n  const seen = new Set();\r\n  const entries = [];\r\n  for(const item of list){\r\n    if(!item || !item.id) continue;\r\n    if(threshold && item.ts < threshold) continue;\r\n    if(seen.has(item.id)) continue;\r\n    seen.add(item.id);\r\n    entries.push({ id: item.id, ts: item.ts, slot: item.slot });\r\n    if(entries.length >= limit) break;\r\n  }\r\n  return { entries, set: seen };\r\n}\r\n\r\nexport function clearHeroMemory(kind){\r\n  const { local, session } = resolveAreas();\r\n  const key = memoryKey(kind);\r\n  writeRaw(local, key, null);\r\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, null);\r\n}\r\n\r\nexport function recordHeroFailure(kind, entry, { timestamp = now(), ttlMs = 0, limit = FAILURE_LIMIT, reason = '' } = {}){\r\n  const id = resolveEntryKey(entry);\r\n  if(!id) return null;\r\n  const threshold = ttlMs > 0 ? Math.max(0, timestamp - ttlMs) : 0;\r\n  const list = readFailures(kind);\r\n  const filtered = [];\r\n  let hits = 0;\r\n  for(const item of list){\r\n    if(!item || !item.id) continue;\r\n    if(item.id === id){\r\n      hits = (item.hits || 0) + 1;\r\n      continue;\r\n    }\r\n    if(threshold && item.ts < threshold) continue;\r\n    filtered.push(item);\r\n  }\r\n  const payload = { id, ts: timestamp, reason: reason || '', hits };\r\n  filtered.unshift(payload);\r\n  const limited = filtered.slice(0, Math.max(1, limit));\r\n  writeFailures(kind, limited);\r\n  return payload;\r\n}\r\n\r\nexport function resolveHeroFailure(kind, entry){\r\n  const id = resolveEntryKey(entry);\r\n  if(!id) return;\r\n  const list = readFailures(kind);\r\n  const filtered = list.filter(item => item && item.id !== id);\r\n  if(filtered.length === list.length) return;\r\n  writeFailures(kind, filtered);\r\n}\r\n\r\nexport function getHeroFailures(kind, { now: nowTs = now(), windowMs = 0, limit = FAILURE_LIMIT } = {}){\r\n  const list = readFailures(kind);\r\n  if(!list.length) return { entries: [], set: new Set() };\r\n  const threshold = windowMs > 0 ? Math.max(0, nowTs - windowMs) : 0;\r\n  const seen = new Set();\r\n  const entries = [];\r\n  for(const item of list){\r\n    if(!item || !item.id) continue;\r\n    if(threshold && item.ts < threshold) continue;\r\n    if(seen.has(item.id)) continue;\r\n    seen.add(item.id);\r\n    entries.push({ id: item.id, ts: item.ts, reason: item.reason || '', hits: item.hits || 0 });\r\n    if(entries.length >= limit) break;\r\n  }\r\n  return { entries, set: seen };\r\n}\r\n\r\nexport function clearHeroFailures(kind){\r\n  const { local, session } = resolveAreas();\r\n  const key = failureKey(kind);\r\n  writeRaw(local, key, null);\r\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, null);\r\n}\r\n\r\nexport default {\r\n  getStoredPool,\r\n  storePool,\r\n  invalidatePool,\r\n  recordHeroHistory,\r\n  getHeroHistory,\r\n  recordHeroMemory,\r\n  getHeroMemory,\r\n  clearHeroMemory,\r\n  recordHeroFailure,\r\n  resolveHeroFailure,\r\n  getHeroFailures,\r\n  clearHeroFailures\r\n};\r\n", "import { normalizeItem } from './normalizer.js';\r\nimport { getHeroPolicy, getCacheTtl } from './policy.js';\r\nimport {\r\n  getStoredPool,\r\n  storePool,\r\n  invalidatePool,\r\n  getHeroHistory,\r\n  getHeroMemory,\r\n  recordHeroMemory,\r\n  clearHeroMemory,\r\n  getHeroFailures,\r\n  recordHeroFailure,\r\n  resolveHeroFailure,\r\n  clearHeroFailures\r\n} from './storage.js';\r\n\r\nconst LOG_PREFIX = '[hero:pool]';\r\nconst PROGRESS_EVENT = 'hero:pool-progress';\r\nconst HISTORY_WINDOW_MS = 1000 * 60 * 60 * 24 * 7; // 7 days\r\nconst HISTORY_LIMIT = 60;\r\nconst NEW_WINDOW_MS = 1000 * 60 * 60 * 24 * 90; // 90 days\r\nconst OLD_THRESHOLD_YEARS = 12;\r\nconst FALLBACK_HISTORY_WINDOW_MS = 1000 * 60 * 60 * 24 * 30; // 30 days fallback when pool too small\r\n\r\nconst SLOT_KEYS = ['new', 'topRated', 'oldButGold', 'random'];\r\n\r\nconst listeners = new Set();\r\n\r\nfunction now(){\r\n  return Date.now();\r\n}\r\n\r\nfunction logWarn(...args){\r\n  try {\r\n    console.warn(LOG_PREFIX, ...args);\r\n  } catch (_err) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction normalizeKind(kind){\r\n  if(kind === 'series' || kind === 'show' || kind === 'shows') return 'series';\r\n  return 'movies';\r\n}\r\n\r\nfunction policySignature(policy, kind){\r\n  if(!policy || typeof policy !== 'object') return '';\r\n  try {\r\n    const normalizedKind = normalizeKind(kind);\r\n    const fragment = {\r\n      poolSize: normalizedKind === 'series' ? policy.poolSizeSeries : policy.poolSizeMovies,\r\n      slots: policy.slots,\r\n      diversity: policy.diversity,\r\n      language: policy.language || 'en-US'\r\n    };\r\n    return JSON.stringify(fragment);\r\n  } catch (err) {\r\n    logWarn('Failed to compute policy signature:', err?.message || err);\r\n    return '';\r\n  }\r\n}\r\n\r\nfunction clamp(value, min, max){\r\n  return Math.min(max, Math.max(min, value));\r\n}\r\n\r\nfunction parseDate(value){\r\n  if(!value) return 0;\r\n  if(typeof value === 'number' && Number.isFinite(value)){\r\n    if(value > 1_000_000_000_000) return Math.trunc(value);\r\n    return Math.trunc(value * 1000);\r\n  }\r\n  if(typeof value === 'string'){\r\n    const ts = Date.parse(value);\r\n    if(Number.isFinite(ts)) return ts;\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction parseYear(value){\r\n  if(!value) return null;\r\n  const num = Number(value);\r\n  if(Number.isFinite(num) && num > 1800 && num < 2100) return Math.trunc(num);\r\n  if(typeof value === 'string'){\r\n    const match = value.match(/(19|20|21)\\d{2}/);\r\n    if(match) return Number(match[0]);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction parseGenres(raw){\r\n  const out = [];\r\n  const push = (val)=>{\r\n    if(!val || typeof val !== 'string') return;\r\n    const trimmed = val.trim();\r\n    if(!trimmed) return;\r\n    const normalized = trimmed.replace(/\\s+/g, ' ');\r\n    if(!out.includes(normalized)) out.push(normalized);\r\n  };\r\n  if(Array.isArray(raw?.genres)){\r\n    for(const g of raw.genres){\r\n      if(!g) continue;\r\n      if(typeof g === 'string'){ push(g); continue; }\r\n      if(typeof g === 'object'){ push(g.tag || g.title || g.label || g.name || ''); }\r\n    }\r\n  }\r\n  if(Array.isArray(raw?.Genre)){\r\n    for(const g of raw.Genre){ push(typeof g === 'string' ? g : g?.tag); }\r\n  }\r\n  return out.slice(0, 3);\r\n}\r\n\r\nfunction parseRating(raw){\r\n  const candidates = [raw?.rating, raw?.audienceRating, raw?.userRating];\r\n  for(const candidate of candidates){\r\n    const num = Number(candidate);\r\n    if(Number.isFinite(num) && num > 0) return clamp(Math.round(num * 10) / 10, 0, 10);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction parseVoteCount(raw){\r\n  const candidates = [raw?.ratingCount, raw?.audienceRatingCount, raw?.userRatingCount, raw?.viewCount];\r\n  for(const candidate of candidates){\r\n    const num = Number(candidate);\r\n    if(Number.isFinite(num) && num >= 0) return Math.trunc(num);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction resolveId(raw){\r\n  if(!raw || typeof raw !== 'object') return null;\r\n  if(raw.heroId != null) return String(raw.heroId);\r\n  if(raw.ids && typeof raw.ids === 'object'){\r\n    if(raw.ids.imdb) return `imdb:${raw.ids.imdb}`;\r\n    if(raw.ids.tmdb) return `tmdb:${raw.ids.tmdb}`;\r\n    if(raw.ids.tvdb) return `tvdb:${raw.ids.tvdb}`;\r\n  }\r\n  if(raw.guid) return String(raw.guid);\r\n  if(raw.ratingKey != null) return `rk:${raw.ratingKey}`;\r\n  if(raw.id != null) return String(raw.id);\r\n  if(raw.slug) return String(raw.slug);\r\n  if(raw.key != null){\r\n    const key = typeof raw.key === 'string' ? raw.key.trim() : String(raw.key);\r\n    if(key) return key;\r\n  }\r\n  if(raw.title){\r\n    const suffix = raw.year ? `:${raw.year}` : '';\r\n    return `title:${raw.title}${suffix}`;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction computeSlotPlan(poolSize, slots){\r\n  const plan = { new: 0, topRated: 0, oldButGold: 0, random: 0 };\r\n  let remaining = poolSize;\r\n  const quotas = slots && typeof slots === 'object' ? slots : {};\r\n  SLOT_KEYS.forEach((key, index) => {\r\n    if(index === SLOT_KEYS.length - 1){\r\n      plan[key] = Math.max(0, remaining);\r\n      remaining = 0;\r\n      return;\r\n    }\r\n    const quota = Number(quotas[key]?.quota);\r\n    if(!Number.isFinite(quota) || quota <= 0){\r\n      plan[key] = 0;\r\n      return;\r\n    }\r\n    const count = Math.max(0, Math.round(poolSize * clamp(quota, 0, 1)));\r\n    plan[key] = Math.min(remaining, count);\r\n    remaining -= plan[key];\r\n  });\r\n  let cursor = 0;\r\n  while(remaining > 0){\r\n    const key = SLOT_KEYS[cursor % SLOT_KEYS.length];\r\n    plan[key] += 1;\r\n    remaining -= 1;\r\n    cursor += 1;\r\n  }\r\n  return plan;\r\n}\r\n\r\nfunction computeCaps(poolSize, diversity){\r\n  const genreWeight = clamp(Number(diversity?.genre) || 0.4, 0.1, 0.9);\r\n  const yearWeight = clamp(Number(diversity?.year) || 0.35, 0.1, 0.9);\r\n  const genreCap = Math.max(1, Math.round(poolSize * clamp(genreWeight * 0.5, 0.1, 0.35)));\r\n  const yearCap = Math.max(1, Math.round(poolSize * clamp(yearWeight * 0.5, 0.1, 0.35)));\r\n  return { perGenre: genreCap, perYear: yearCap };\r\n}\r\n\r\nfunction prepareCandidates(items){\r\n  if(!Array.isArray(items) || !items.length) return [];\r\n  const nowTs = now();\r\n  const seen = new Set();\r\n  const prepared = [];\r\n  for(const raw of items){\r\n    if(!raw || typeof raw !== 'object') continue;\r\n    const id = resolveId(raw);\r\n    if(!id) continue;\r\n    if(seen.has(id)) continue;\r\n    seen.add(id);\r\n    const addedAt = parseDate(raw.addedAt || raw.createdAt || raw.added);\r\n    const year = parseYear(raw.year || raw.originallyAvailableAt);\r\n    const rating = parseRating(raw);\r\n    const voteCount = parseVoteCount(raw);\r\n    const genres = parseGenres(raw);\r\n    const candidate = {\r\n      id,\r\n      raw,\r\n      addedAt,\r\n      year,\r\n      rating: rating ?? 0,\r\n      voteCount,\r\n      genres,\r\n      isNew: addedAt && nowTs - addedAt <= NEW_WINDOW_MS,\r\n      isOld: year ? (new Date().getUTCFullYear() - year) >= OLD_THRESHOLD_YEARS : false\r\n    };\r\n    prepared.push(candidate);\r\n  }\r\n  return prepared;\r\n}\r\n\r\nfunction sortNew(list){\r\n  return list.slice().sort((a, b) => (b.addedAt || 0) - (a.addedAt || 0));\r\n}\r\n\r\nfunction sortTopRated(list){\r\n  return list.slice().sort((a, b) => {\r\n    const ra = Number.isFinite(a.rating) ? a.rating : 0;\r\n    const rb = Number.isFinite(b.rating) ? b.rating : 0;\r\n    if(rb !== ra) return rb - ra;\r\n    const vc = (b.voteCount || 0) - (a.voteCount || 0);\r\n    if(vc !== 0) return vc;\r\n    return (b.addedAt || 0) - (a.addedAt || 0);\r\n  });\r\n}\r\n\r\nfunction sortOld(list){\r\n  return list.slice().sort((a, b) => {\r\n    const ya = a.year || 0;\r\n    const yb = b.year || 0;\r\n    if(ya && yb && ya !== yb) return ya - yb;\r\n    const rb = (b.rating || 0) - (a.rating || 0);\r\n    if(rb !== 0) return rb;\r\n    return (b.addedAt || 0) - (a.addedAt || 0);\r\n  });\r\n}\r\n\r\nfunction shuffle(list){\r\n  const arr = list.slice();\r\n  for(let i = arr.length - 1; i > 0; i--){\r\n    const j = Math.floor(Math.random() * (i + 1));\r\n    [arr[i], arr[j]] = [arr[j], arr[i]];\r\n  }\r\n  return arr;\r\n}\r\n\r\nfunction passesCaps(context, candidate){\r\n  const { caps, genreCounts, yearCounts } = context;\r\n  if(caps.perGenre > 0 && candidate.genres && candidate.genres.length){\r\n    for(const genre of candidate.genres){\r\n      const count = genreCounts.get(genre) || 0;\r\n      if(count >= caps.perGenre) return false;\r\n    }\r\n  }\r\n  if(caps.perYear > 0 && candidate.year){\r\n    const count = yearCounts.get(candidate.year) || 0;\r\n    if(count >= caps.perYear) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction applySelection(context, candidate, slot){\r\n  context.selected.push({ ...candidate, slot });\r\n  context.selectedIds.add(candidate.id);\r\n  context.summary[slot] = (context.summary[slot] || 0) + 1;\r\n  if(candidate.genres){\r\n    for(const genre of candidate.genres){\r\n      context.genreCounts.set(genre, (context.genreCounts.get(genre) || 0) + 1);\r\n    }\r\n  }\r\n  if(candidate.year){\r\n    context.yearCounts.set(candidate.year, (context.yearCounts.get(candidate.year) || 0) + 1);\r\n  }\r\n}\r\n\r\nfunction attemptSelection(list, count, slot, context, { allowHistory = false, filter } = {}){\r\n  if(count <= 0) return 0;\r\n  const deferredHistory = [];\r\n  const deferredMemory = [];\r\n  const deferredFailures = [];\r\n  for(const candidate of list){\r\n    if(context.selected.length >= context.poolSize) break;\r\n    if(context.summary[slot] >= count) break;\r\n    if(context.selectedIds.has(candidate.id)) continue;\r\n    if(filter && !filter(candidate)) continue;\r\n    if(!passesCaps(context, candidate)) continue;\r\n    if(context.failureSet && context.failureSet.has(candidate.id)){\r\n      deferredFailures.push(candidate);\r\n      continue;\r\n    }\r\n    if(context.memorySet && context.memorySet.has(candidate.id)){\r\n      deferredMemory.push(candidate);\r\n      continue;\r\n    }\r\n    if(!allowHistory && context.historySet && context.historySet.has(candidate.id)){\r\n      deferredHistory.push(candidate);\r\n      continue;\r\n    }\r\n    applySelection(context, candidate, slot);\r\n  }\r\n  if(context.summary[slot] >= count || context.selected.length >= context.poolSize) return context.summary[slot];\r\n  const applyQueue = (queue)=>{\r\n    for(const candidate of queue){\r\n      if(context.selected.length >= context.poolSize) break;\r\n      if(context.summary[slot] >= count) break;\r\n      if(context.selectedIds.has(candidate.id)) continue;\r\n      if(!passesCaps(context, candidate)) continue;\r\n      applySelection(context, candidate, slot);\r\n    }\r\n  };\r\n  if(deferredMemory.length){\r\n    applyQueue(deferredMemory);\r\n  }\r\n  if(context.summary[slot] < count && deferredHistory.length){\r\n    applyQueue(deferredHistory);\r\n  }\r\n  if(context.summary[slot] < count && deferredFailures.length){\r\n    applyQueue(deferredFailures);\r\n  }\r\n  return context.summary[slot];\r\n}\r\n\r\nfunction ensureMinimum(context, list){\r\n  for(const candidate of list){\r\n    if(context.selected.length >= context.poolSize) break;\r\n    if(context.selectedIds.has(candidate.id)) continue;\r\n    applySelection(context, candidate, 'random');\r\n  }\r\n}\r\n\r\nfunction emitProgress(detail){\r\n  const payload = { ...detail, timestamp: now() };\r\n  for(const listener of listeners){\r\n    try { listener(payload); } catch (err) { logWarn('Progress listener failed:', err?.message || err); }\r\n  }\r\n  try {\r\n    if(typeof window !== 'undefined' && typeof window.dispatchEvent === 'function' && typeof CustomEvent === 'function'){\r\n      window.dispatchEvent(new CustomEvent(PROGRESS_EVENT, { detail: payload }));\r\n    }\r\n  } catch (err) {\r\n    logWarn('Failed to dispatch progress event:', err?.message || err);\r\n  }\r\n}\r\n\r\nasync function normalizeSelection(selection, language, options = {}){\r\n  const normalized = [];\r\n  const total = selection.length;\r\n  const {\r\n    settings,\r\n    auth,\r\n    authOptions,\r\n    signal,\r\n    disableTmdb,\r\n    kind,\r\n    failureTtlMs\r\n  } = options;\r\n  for(let index = 0; index < selection.length; index++){\r\n    const entry = selection[index];\r\n    emitProgress({ stage: 'normalizing', index: index + 1, total, slot: entry.slot, id: entry.id });\r\n    let normalizedItem = null;\r\n    let failureReason = '';\r\n    let rateLimited = false;\r\n    try {\r\n      normalizedItem = await normalizeItem(entry.raw, {\r\n        language,\r\n        settings,\r\n        auth,\r\n        authOptions,\r\n        signal,\r\n        disableTmdb\r\n      });\r\n    } catch (err) {\r\n      logWarn('Failed to normalize hero candidate:', err?.message || err);\r\n      failureReason = err?.message || '';\r\n      if(err?.code === 'RATE_LIMIT') rateLimited = true;\r\n    }\r\n    if(!normalizedItem){\r\n      if(kind && !rateLimited){\r\n        try {\r\n          recordHeroFailure(kind, entry.raw || entry, { timestamp: now(), ttlMs: failureTtlMs, reason: failureReason || 'normalize' });\r\n        } catch (_err){}\r\n      }\r\n      continue;\r\n    }\r\n    if(kind){\r\n      try { resolveHeroFailure(kind, entry.raw || normalizedItem); } catch (_err){}\r\n    }\r\n    normalizedItem.slot = entry.slot;\r\n    normalizedItem.poolSlot = entry.slot;\r\n    normalizedItem.poolId = entry.id;\r\n    normalized.push(normalizedItem);\r\n  }\r\n  return normalized;\r\n}\r\n\r\nfunction classifyCandidates(items, plan, diversity, history, memory, failures){\r\n  const poolSize = Object.values(plan).reduce((sum, value) => sum + value, 0);\r\n  const context = {\r\n    poolSize,\r\n    caps: computeCaps(poolSize, diversity),\r\n    selected: [],\r\n    summary: { new: 0, topRated: 0, oldButGold: 0, random: 0 },\r\n    genreCounts: new Map(),\r\n    yearCounts: new Map(),\r\n    selectedIds: new Set(),\r\n    historySet: history?.set || new Set(),\r\n    memorySet: memory?.set || new Set(),\r\n    failureSet: failures?.set || new Set()\r\n  };\r\n\r\n  const prepared = prepareCandidates(items);\r\n  const newList = sortNew(prepared);\r\n  const topList = sortTopRated(prepared);\r\n  const oldList = sortOld(prepared.filter(entry => entry.isOld));\r\n  const randomList = shuffle(prepared);\r\n\r\n  attemptSelection(newList, plan.new, 'new', context, { allowHistory: false, filter: candidate => candidate.isNew });\r\n  attemptSelection(newList, plan.new, 'new', context, { allowHistory: false });\r\n  attemptSelection(newList, plan.new, 'new', context, { allowHistory: true });\r\n\r\n  attemptSelection(topList, plan.topRated, 'topRated', context, { allowHistory: false });\r\n  attemptSelection(topList, plan.topRated, 'topRated', context, { allowHistory: true });\r\n\r\n  attemptSelection(oldList, plan.oldButGold, 'oldButGold', context, { allowHistory: false });\r\n  attemptSelection(oldList, plan.oldButGold, 'oldButGold', context, { allowHistory: true });\r\n\r\n  const remainingRandom = randomList.filter(candidate => !context.selectedIds.has(candidate.id));\r\n  attemptSelection(remainingRandom, plan.random, 'random', context, { allowHistory: false });\r\n  attemptSelection(remainingRandom, plan.random, 'random', context, { allowHistory: true });\r\n\r\n  if(context.selected.length < poolSize){\r\n    const leftovers = prepared.filter(candidate => !context.selectedIds.has(candidate.id));\r\n    ensureMinimum(context, leftovers);\r\n  }\r\n\r\n  return context;\r\n}\r\n\r\nfunction shouldReusePool(kind, policyHash, options = {}){\r\n  const nowTs = now();\r\n  const cached = getStoredPool(kind, { now: nowTs, policyHash });\r\n  if(!cached || !Array.isArray(cached.items) || !cached.items.length) return null;\r\n  if(cached.isExpired){\r\n    if(options.allowGrace){\r\n      const { graceMs } = getCacheTtl();\r\n      if(graceMs && graceMs > 0 && cached.expiresAt + graceMs > nowTs){\r\n        emitProgress({ stage: 'cache', status: 'grace', kind, size: cached.items.length });\r\n        return { ...cached, fromCache: true };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  emitProgress({ stage: 'cache', status: 'hit', kind, size: cached.items.length });\r\n  return { ...cached, fromCache: true };\r\n}\r\n\r\nasync function buildPool(kind, items, options = {}){\r\n  const policy = options.policy || getHeroPolicy();\r\n  const normalizedKind = normalizeKind(kind);\r\n  const policyHash = policySignature(policy, normalizedKind);\r\n  const reuse = !options.force && shouldReusePool(normalizedKind, policyHash, { allowGrace: true });\r\n  if(reuse) return reuse;\r\n\r\n  if(options.force){\r\n    try { clearHeroMemory(normalizedKind); } catch (_err){}\r\n    try { clearHeroFailures(normalizedKind); } catch (_err){}\r\n  }\r\n\r\n  const poolSize = normalizedKind === 'series' ? policy.poolSizeSeries : policy.poolSizeMovies;\r\n  if(!poolSize || poolSize <= 0){\r\n    return { items: [], summary: {}, fromCache: false, updatedAt: now(), expiresAt: 0 };\r\n  }\r\n\r\n  emitProgress({ stage: 'start', kind: normalizedKind, total: poolSize });\r\n\r\n  const plan = computeSlotPlan(poolSize, policy.slots);\r\n  const ttlInfo = getCacheTtl();\r\n  const nowTs = now();\r\n  const memoryWindow = (()=>{\r\n    const base = Math.max(0, (ttlInfo.ttlMs || 0)) + Math.max(0, ttlInfo.graceMs || 0);\r\n    return base > 0 ? base : HISTORY_WINDOW_MS;\r\n  })();\r\n  const history = getHeroHistory(normalizedKind, { windowMs: HISTORY_WINDOW_MS, limit: HISTORY_LIMIT });\r\n  const memory = getHeroMemory(normalizedKind, { now: nowTs, windowMs: memoryWindow, limit: Math.max(HISTORY_LIMIT * 2, poolSize * 2) });\r\n  const failures = getHeroFailures(normalizedKind, { now: nowTs, windowMs: memoryWindow });\r\n\r\n  let context = classifyCandidates(items, plan, { ...policy.diversity, kind: normalizedKind }, history, memory, failures);\r\n\r\n  if(context.selected.length < poolSize && history.entries.length){\r\n    const fallbackHistory = getHeroHistory(normalizedKind, { windowMs: FALLBACK_HISTORY_WINDOW_MS, limit: HISTORY_LIMIT });\r\n    context = classifyCandidates(items, plan, { ...policy.diversity, kind: normalizedKind }, fallbackHistory, memory, failures);\r\n  }\r\n\r\n  const trimmedSelection = context.selected.slice(0, poolSize);\r\n\r\n  const normalizedItems = await normalizeSelection(trimmedSelection, policy.language || 'en-US', {\r\n    ...options.tmdb,\r\n    kind: normalizedKind,\r\n    failureTtlMs: memoryWindow\r\n  });\r\n  const finalItems = normalizedItems.slice(0, poolSize);\r\n\r\n  const updatedAt = now();\r\n  const expiresAt = updatedAt + (ttlInfo.ttlMs || 0);\r\n\r\n  const payload = {\r\n    kind: normalizedKind,\r\n    items: finalItems,\r\n    updatedAt,\r\n    expiresAt,\r\n    policyHash,\r\n    slotSummary: context.summary,\r\n    meta: {\r\n      plan,\r\n      totalCandidates: items?.length || 0,\r\n      selectionCount: finalItems.length\r\n    }\r\n  };\r\n\r\n  try {\r\n    recordHeroMemory(normalizedKind, finalItems, { timestamp: updatedAt, ttlMs: memoryWindow, limit: Math.max(HISTORY_LIMIT * 2, poolSize * 2) });\r\n  } catch (_err){}\r\n\r\n  storePool(normalizedKind, payload);\r\n  emitProgress({ stage: 'done', kind: normalizedKind, size: finalItems.length, updatedAt });\r\n  return { ...payload, fromCache: false };\r\n}\r\n\r\nexport async function ensureHeroPool(kind, items, options = {}){\r\n  return buildPool(kind, items, options);\r\n}\r\n\r\nexport function forceRegeneratePool(kind, items, options = {}){\r\n  return buildPool(kind, items, { ...options, force: true });\r\n}\r\n\r\nexport function clearHeroPool(kind){\r\n  invalidatePool(kind);\r\n}\r\n\r\nexport function addProgressListener(listener){\r\n  if(typeof listener !== 'function') return () => {};\r\n  listeners.add(listener);\r\n  return () => listeners.delete(listener);\r\n}\r\n\r\nexport { PROGRESS_EVENT };\r\n\r\nexport default {\r\n  ensureHeroPool,\r\n  forceRegeneratePool,\r\n  clearHeroPool,\r\n  addProgressListener,\r\n  PROGRESS_EVENT\r\n};\r\n", "import { ensureHeroPool, forceRegeneratePool } from './pool.js';\r\nimport { getStoredPool } from './storage.js';\r\nimport { useTmdbForHero } from '../utils.js';\r\nimport { addRateLimitListener, getRateLimitState } from './tmdbClient.js';\r\n\r\nconst LOG_PREFIX = '[hero:pipeline]';\r\nconst FEATURE_FLAG_KEY = 'feature.heroPipeline';\r\nconst UPDATE_EVENT = 'hero:pipeline-update';\r\n\r\nconst listeners = new Set();\r\nlet detachRateLimitListener = null;\r\n\r\nconst state = {\r\n  cfg: {},\r\n  policy: null,\r\n  enabled: true,\r\n  featureSource: 'default',\r\n  ready: false,\r\n  sources: { movies: [], series: [] },\r\n  pools: { movies: [], series: [] },\r\n  status: {\r\n    movies: createStatus('movies'),\r\n    series: createStatus('series')\r\n  },\r\n  tmdb: {\r\n    allowed: false,\r\n    active: false,\r\n    rateLimit: {\r\n      active: false,\r\n      until: 0,\r\n      retryAfterMs: 0,\r\n      lastStatus: null,\r\n      strikes: 0\r\n    }\r\n  },\r\n  activeKind: 'movies',\r\n  inFlight: new Map()\r\n};\r\n\r\nfunction logWarn(...args){\r\n  try {\r\n    console.warn(LOG_PREFIX, ...args);\r\n  } catch (_err) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nfunction now(){\r\n  return Date.now();\r\n}\r\n\r\nfunction normalizeKind(kind){\r\n  if(kind === 'show' || kind === 'shows' || kind === 'series') return 'series';\r\n  return 'movies';\r\n}\r\n\r\nfunction rateLimitEquals(a, b){\r\n  if(a === b) return true;\r\n  if(!a || !b) return false;\r\n  return a.active === b.active\r\n    && a.until === b.until\r\n    && a.retryAfterMs === b.retryAfterMs\r\n    && a.lastStatus === b.lastStatus\r\n    && a.strikes === b.strikes;\r\n}\r\n\r\nfunction attachRateLimitListener(){\r\n  if(detachRateLimitListener) return;\r\n  try {\r\n    state.tmdb.rateLimit = { ...getRateLimitState() };\r\n  } catch (_err) {\r\n    state.tmdb.rateLimit = { active: false, until: 0, retryAfterMs: 0, lastStatus: null, strikes: 0 };\r\n  }\r\n  const handler = info => {\r\n    const next = info ? { ...info } : { active: false, until: 0, retryAfterMs: 0, lastStatus: null, strikes: 0 };\r\n    if(rateLimitEquals(state.tmdb.rateLimit, next)) return;\r\n    state.tmdb.rateLimit = next;\r\n    notify();\r\n  };\r\n  detachRateLimitListener = addRateLimitListener(handler);\r\n}\r\n\r\nfunction createStatus(kind){\r\n  return {\r\n    kind,\r\n    state: 'idle',\r\n    regenerating: false,\r\n    size: 0,\r\n    updatedAt: 0,\r\n    expiresAt: 0,\r\n    fromCache: false,\r\n    source: '',\r\n    policyHash: '',\r\n    slotSummary: {},\r\n    matchesPolicy: true,\r\n    isExpired: false,\r\n    lastError: null,\r\n    lastRefresh: 0\r\n  };\r\n}\r\n\r\nfunction cloneStatus(status){\r\n  if(!status) return null;\r\n  const copy = { ...status };\r\n  copy.slotSummary = status.slotSummary ? { ...status.slotSummary } : {};\r\n  return copy;\r\n}\r\n\r\nfunction readFeatureFlag(){\r\n  if(typeof localStorage === 'undefined') return null;\r\n  try {\r\n    const raw = localStorage.getItem(FEATURE_FLAG_KEY);\r\n    if(raw === '1' || raw === '0') return raw;\r\n  } catch (err) {\r\n    logWarn('Failed to read feature flag:', err?.message || err);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction computeFeatureState(cfg){\r\n  const stored = readFeatureFlag();\r\n  if(stored != null){\r\n    return { enabled: stored === '1', source: 'localStorage' };\r\n  }\r\n  if(cfg && typeof cfg.heroPipelineEnabled === 'boolean'){\r\n    return { enabled: !!cfg.heroPipelineEnabled, source: 'config.heroPipelineEnabled' };\r\n  }\r\n  if(cfg && cfg.features && typeof cfg.features.heroPipeline === 'boolean'){\r\n    return { enabled: !!cfg.features.heroPipeline, source: 'config.features.heroPipeline' };\r\n  }\r\n  return { enabled: true, source: 'default' };\r\n}\r\n\r\nfunction buildSnapshot(){\r\n  return {\r\n    enabled: state.enabled,\r\n    featureSource: state.featureSource,\r\n    ready: state.ready,\r\n    activeKind: state.activeKind,\r\n    tmdb: {\r\n      allowed: state.tmdb.allowed,\r\n      active: state.tmdb.active,\r\n      rateLimit: state.tmdb.rateLimit ? { ...state.tmdb.rateLimit } : { active: false, until: 0, retryAfterMs: 0, lastStatus: null, strikes: 0 }\r\n    },\r\n    status: {\r\n      movies: cloneStatus(state.status.movies),\r\n      series: cloneStatus(state.status.series)\r\n    },\r\n    pools: {\r\n      movies: state.pools.movies.slice(),\r\n      series: state.pools.series.slice()\r\n    }\r\n  };\r\n}\r\n\r\nfunction notify(){\r\n  const snapshot = buildSnapshot();\r\n  for(const listener of listeners){\r\n    try {\r\n      listener(snapshot);\r\n    } catch (err) {\r\n      logWarn('Listener failed:', err?.message || err);\r\n    }\r\n  }\r\n  try {\r\n    if(typeof window !== 'undefined' && typeof window.dispatchEvent === 'function' && typeof CustomEvent === 'function'){\r\n      window.dispatchEvent(new CustomEvent(UPDATE_EVENT, { detail: snapshot }));\r\n    }\r\n  } catch (err) {\r\n    logWarn('Failed to dispatch pipeline event:', err?.message || err);\r\n  }\r\n  return snapshot;\r\n}\r\n\r\nfunction updateStatus(kind, patch){\r\n  const normalized = normalizeKind(kind);\r\n  const status = state.status[normalized];\r\n  if(!status) return;\r\n  const next = { ...patch };\r\n  if(next.slotSummary){\r\n    next.slotSummary = { ...next.slotSummary };\r\n  }\r\n  state.status[normalized] = { ...status, ...next };\r\n}\r\n\r\nfunction refreshReadyState(){\r\n  if(!state.enabled){\r\n    state.ready = true;\r\n    return;\r\n  }\r\n  const kinds = ['movies', 'series'];\r\n  const ready = kinds.every(kind => {\r\n    const status = state.status[kind];\r\n    if(!status) return false;\r\n    return status.state === 'ready' || status.state === 'error' || status.state === 'stale';\r\n  });\r\n  state.ready = ready;\r\n}\r\n\r\nfunction loadStored(kind){\r\n  const normalized = normalizeKind(kind);\r\n  const stored = getStoredPool(normalized, { allowExpired: true });\r\n  if(!stored) return;\r\n  state.pools[normalized] = Array.isArray(stored.items) ? stored.items.slice() : [];\r\n  updateStatus(normalized, {\r\n    state: stored.isExpired ? 'stale' : 'ready',\r\n    regenerating: false,\r\n    size: state.pools[normalized].length,\r\n    updatedAt: Number(stored.updatedAt) || 0,\r\n    expiresAt: Number(stored.expiresAt) || 0,\r\n    fromCache: true,\r\n    source: stored.source || 'cache',\r\n    policyHash: stored.policyHash || '',\r\n    slotSummary: stored.slotSummary || {},\r\n    matchesPolicy: stored.matchesPolicy !== false,\r\n    isExpired: !!stored.isExpired\r\n  });\r\n}\r\n\r\nfunction ensureSources(){\r\n  if(!state.sources.movies) state.sources.movies = [];\r\n  if(!state.sources.series) state.sources.series = [];\r\n}\r\n\r\nfunction buildTmdbOptions(){\r\n  // Hero always uses TMDB when credentials are available\r\n  // Re-check in case token was added after initial configure\r\n  const hasCredentials = useTmdbForHero();\r\n  const shouldUseTmdb = state.tmdb.allowed && hasCredentials;\r\n  const disableTmdb = !shouldUseTmdb;\r\n\r\n  const authOptions = {};\r\n  if(state.cfg && typeof state.cfg === 'object'){\r\n    const fallback = state.cfg.tmdbToken || state.cfg.tmdbApiKey;\r\n    if(fallback) authOptions.fallbackCredential = fallback;\r\n  }\r\n  return {\r\n    disableTmdb,\r\n    settings: state.cfg,\r\n    authOptions: Object.keys(authOptions).length ? authOptions : undefined\r\n  };\r\n}\r\n\r\nasync function runPoolBuilder(kind, { force = false } = {}){\r\n  const normalized = normalizeKind(kind);\r\n  if(!state.enabled){\r\n    updateStatus(normalized, { state: 'disabled', regenerating: false });\r\n    refreshReadyState();\r\n    return null;\r\n  }\r\n\r\n  ensureSources();\r\n  if(state.inFlight.has(normalized)){\r\n    return state.inFlight.get(normalized);\r\n  }\r\n\r\n  const items = normalized === 'series' ? state.sources.series : state.sources.movies;\r\n  updateStatus(normalized, {\r\n    state: 'loading',\r\n    regenerating: true,\r\n    lastError: null\r\n  });\r\n  notify();\r\n\r\n  const builder = force ? forceRegeneratePool : ensureHeroPool;\r\n  const options = {\r\n    policy: state.policy || undefined,\r\n    tmdb: buildTmdbOptions()\r\n  };\r\n\r\n  const promise = builder(normalized, items, options)\r\n    .then(result => {\r\n      const payload = result || {};\r\n      const poolItems = Array.isArray(payload.items) ? payload.items.slice() : [];\r\n      state.pools[normalized] = poolItems;\r\n      updateStatus(normalized, {\r\n        state: payload.items ? 'ready' : 'ready',\r\n        regenerating: false,\r\n        size: poolItems.length,\r\n        updatedAt: Number(payload.updatedAt) || now(),\r\n        expiresAt: Number(payload.expiresAt) || 0,\r\n        fromCache: !!payload.fromCache,\r\n        source: payload.source || (payload.fromCache ? 'cache' : 'fresh'),\r\n        policyHash: payload.policyHash || '',\r\n        slotSummary: payload.slotSummary || {},\r\n        matchesPolicy: payload.matchesPolicy !== false,\r\n        isExpired: false,\r\n        lastError: null,\r\n        lastRefresh: now()\r\n      });\r\n      refreshReadyState();\r\n      notify();\r\n      return payload;\r\n    })\r\n    .catch(err => {\r\n      logWarn('Failed to build hero pool for', normalized, err?.message || err);\r\n      updateStatus(normalized, {\r\n        state: 'error',\r\n        regenerating: false,\r\n        lastError: err?.message || String(err)\r\n      });\r\n      refreshReadyState();\r\n      notify();\r\n      throw err;\r\n    })\r\n    .finally(() => {\r\n      state.inFlight.delete(normalized);\r\n    });\r\n\r\n  state.inFlight.set(normalized, promise);\r\n  return promise;\r\n}\r\n\r\nfunction computeDaySeed(){\r\n  const nowDate = new Date();\r\n  const year = nowDate.getUTCFullYear();\r\n  const startOfYear = Date.UTC(year, 0, 1);\r\n  const today = Date.UTC(year, nowDate.getUTCMonth(), nowDate.getUTCDate());\r\n  const diff = Math.max(0, today - startOfYear);\r\n  return Math.floor(diff / (24 * 60 * 60 * 1000));\r\n}\r\n\r\nfunction comparePoolEntries(a, b){\r\n  const ka = String(a?.poolId || a?.id || '').toLowerCase();\r\n  const kb = String(b?.poolId || b?.id || '').toLowerCase();\r\n  if(ka < kb) return -1;\r\n  if(ka > kb) return 1;\r\n  return 0;\r\n}\r\n\r\nfunction computeRotation(kind, snapshot){\r\n  const normalized = normalizeKind(kind);\r\n  const pool = snapshot?.pools?.[normalized] || [];\r\n  if(!Array.isArray(pool) || !pool.length){\r\n    return { items: [], startIndex: 0 };\r\n  }\r\n  const sorted = pool.slice().sort(comparePoolEntries);\r\n  const status = snapshot.status?.[normalized] || {};\r\n  const freshnessSeed = status.updatedAt ? Math.floor(Number(status.updatedAt) / (24 * 60 * 60 * 1000)) : 0;\r\n  const offset = normalized === 'series' ? 7 : 0;\r\n  const seed = computeDaySeed() + freshnessSeed + offset;\r\n  const startIndex = sorted.length ? seed % sorted.length : 0;\r\n  return { items: sorted, startIndex };\r\n}\r\n\r\nexport function configure({ cfg, policy } = {}){\r\n  state.cfg = cfg || {};\r\n  state.policy = policy || null;\r\n  const feature = computeFeatureState(cfg);\r\n  state.enabled = !!feature.enabled;\r\n  state.featureSource = feature.source;\r\n  state.tmdb.allowed = !!cfg?.tmdbEnabled;\r\n  state.tmdb.active = state.tmdb.allowed && useTmdbForHero();\r\n  attachRateLimitListener();\r\n  loadStored('movies');\r\n  loadStored('series');\r\n  refreshReadyState();\r\n  notify();\r\n  return { enabled: state.enabled, source: state.featureSource };\r\n}\r\n\r\nexport function setSources({ movies = [], shows = [] } = {}){\r\n  state.sources = { movies: Array.isArray(movies) ? movies : [], series: Array.isArray(shows) ? shows : [] };\r\n}\r\n\r\nexport function setActiveView(view){\r\n  const normalized = view === 'shows' || view === 'series' ? 'series' : 'movies';\r\n  if(state.activeKind !== normalized){\r\n    state.activeKind = normalized;\r\n    notify();\r\n  }\r\n}\r\n\r\nexport async function primeAll(options = {}){\r\n  if(!state.enabled){\r\n    refreshReadyState();\r\n    return { skipped: true };\r\n  }\r\n  const kinds = options.kinds || ['movies', 'series'];\r\n  const tasks = kinds.map(kind => runPoolBuilder(kind));\r\n  const results = await Promise.allSettled(tasks);\r\n  refreshReadyState();\r\n  notify();\r\n  return results;\r\n}\r\n\r\nexport function ensureKind(kind, options = {}){\r\n  return runPoolBuilder(kind, options);\r\n}\r\n\r\nexport function refreshKind(kind, options = {}){\r\n  return runPoolBuilder(kind, { ...options, force: true });\r\n}\r\n\r\nexport function refreshAll(){\r\n  if(!state.enabled){\r\n    return Promise.resolve({ skipped: true });\r\n  }\r\n  return Promise.all([refreshKind('movies'), refreshKind('series')]);\r\n}\r\n\r\nexport function updateTmdbActive(active){\r\n  // Hero always uses TMDB when credentials are available\r\n  // This function now just checks if credentials exist\r\n  const next = !!(state.tmdb.allowed && useTmdbForHero());\r\n  if(state.tmdb.active === next) return;\r\n  state.tmdb.active = next;\r\n  notify();\r\n}\r\n\r\nexport function isEnabled(){\r\n  return !!state.enabled;\r\n}\r\n\r\nexport function isReady(){\r\n  return !!state.ready;\r\n}\r\n\r\nexport function getSnapshot(){\r\n  return buildSnapshot();\r\n}\r\n\r\nexport function getStatus(kind){\r\n  if(!kind) return { ...buildSnapshot().status };\r\n  const normalized = normalizeKind(kind);\r\n  return cloneStatus(state.status[normalized]);\r\n}\r\n\r\nexport function getPool(kind){\r\n  if(!state.enabled) return [];\r\n  const normalized = normalizeKind(kind);\r\n  return state.pools[normalized]?.slice() || [];\r\n}\r\n\r\nexport function getRotationPlan(kind){\r\n  const snapshot = buildSnapshot();\r\n  const plan = computeRotation(kind, snapshot);\r\n  return { ...plan, snapshot };\r\n}\r\n\r\nexport function subscribe(listener){\r\n  if(typeof listener !== 'function') return () => {};\r\n  listeners.add(listener);\r\n  try {\r\n    listener(buildSnapshot());\r\n  } catch (err) {\r\n    logWarn('Initial listener invocation failed:', err?.message || err);\r\n  }\r\n  return () => listeners.delete(listener);\r\n}\r\n\r\nexport function getDebugSnapshot(){\r\n  const snapshot = buildSnapshot();\r\n  return {\r\n    enabled: snapshot.enabled,\r\n    featureSource: snapshot.featureSource,\r\n    ready: snapshot.ready,\r\n    tmdb: snapshot.tmdb,\r\n    status: snapshot.status,\r\n    poolSizes: {\r\n      movies: snapshot.pools.movies.length,\r\n      series: snapshot.pools.series.length\r\n    }\r\n  };\r\n}\r\n\r\nexport default {\r\n  configure,\r\n  setSources,\r\n  setActiveView,\r\n  primeAll,\r\n  ensureKind,\r\n  refreshKind,\r\n  refreshAll,\r\n  updateTmdbActive,\r\n  isEnabled,\r\n  isReady,\r\n  getSnapshot,\r\n  getStatus,\r\n  getPool,\r\n  getRotationPlan,\r\n  subscribe,\r\n  getDebugSnapshot\r\n};\r\n", "import { getState } from './state.js';\r\nimport { getSources } from './data.js';\r\nimport { getCacheStats, clearAllCache, clearExpiredCache } from './cache.js';\r\nimport * as HeroPolicy from './hero/policy.js';\r\nimport * as HeroPipeline from './hero/pipeline.js';\r\n\r\nexport function initDebugUi(){\r\n  const open = document.getElementById('openDebug');\r\n  if(open){ open.addEventListener('click', ()=>{ openPanel(); }); }\r\n}\r\n\r\nfunction openPanel(){\r\n  let overlay = document.getElementById('debugOverlay');\r\n  if(!overlay){ overlay = document.createElement('div'); overlay.id='debugOverlay'; overlay.className='debug-overlay';\r\n    overlay.innerHTML = `\r\n      <div class=\"debug-dialog\">\r\n        <div class=\"debug-header\"><h2>Debug</h2></div>\r\n        <div class=\"debug-body\">\r\n          <pre id=\"debugPre\" class=\"debug-pre\"></pre>\r\n          <div class=\"debug-cache-controls\">\r\n            <h3>Cache-Verwaltung</h3>\r\n            <div id=\"cacheStats\" class=\"cache-stats\"></div>\r\n            <div class=\"cache-buttons\">\r\n              <button id=\"debugClearExpired\" class=\"btn\">Abgelaufene l\u00F6schen</button>\r\n              <button id=\"debugClearAll\" class=\"btn\">Alles l\u00F6schen</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"debug-actions\">\r\n          <button id=\"debugCopy\" class=\"btn\">Copy report</button>\r\n          <button id=\"debugClose\" class=\"btn\">Schlie\u00DFen</button>\r\n        </div>\r\n      </div>`;\r\n    document.body.append(overlay);\r\n  }\r\n  overlay.hidden = false;\r\n  render();\r\n  overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closePanel(); });\r\n  document.getElementById('debugClose')?.addEventListener('click', closePanel, { once:true });\r\n  document.getElementById('debugCopy')?.addEventListener('click', copyReport, { once:true });\r\n  document.getElementById('debugClearExpired')?.addEventListener('click', ()=>{\r\n    clearExpiredCache();\r\n    render();\r\n  }, { once:true });\r\n  document.getElementById('debugClearAll')?.addEventListener('click', ()=>{\r\n    if(confirm('Wirklich den gesamten Cache l\u00F6schen?')){\r\n      clearAllCache();\r\n      render();\r\n    }\r\n  }, { once:true });\r\n}\r\n\r\nfunction closePanel(){ const overlay = document.getElementById('debugOverlay'); if(overlay) overlay.hidden = true; }\r\n\r\nfunction render(){\r\n  const pre = document.getElementById('debugPre'); if(!pre) return;\r\n  const s = getState();\r\n  const src = getSources();\r\n  const cfg = s.cfg||{};\r\n  const cacheStats = getCacheStats();\r\n  const heroPolicy = HeroPolicy.getHeroPolicy();\r\n  const heroPolicyIssues = HeroPolicy.getValidationIssues();\r\n  const heroPipeline = HeroPipeline.getDebugSnapshot();\r\n\r\n  const report = {\r\n    view: s.view,\r\n    counts: { movies: (s.movies||[]).length, shows: (s.shows||[]).length, filtered: (s.filtered||[]).length },\r\n    dataSources: src,\r\n    cache: cacheStats,\r\n    heroPolicy: {\r\n      policy: heroPolicy,\r\n      language: HeroPolicy.getPolicyLanguage(),\r\n      pools: HeroPolicy.getPoolSizes(),\r\n      slots: HeroPolicy.getSlotConfig(),\r\n      diversity: HeroPolicy.getDiversityWeights(),\r\n      rotation: HeroPolicy.getRotationConfig(),\r\n      textClamp: HeroPolicy.getTextClampConfig(),\r\n      fallback: HeroPolicy.getFallbackPreference(),\r\n      cache: HeroPolicy.getCacheTtl(),\r\n      loadedAt: HeroPolicy.getPolicyLoadedAt(),\r\n      issues: heroPolicyIssues\r\n    },\r\n    heroCache: heroPipeline,\r\n    tmdb: { enabled: !!cfg.tmdbEnabled, lang: cfg.lang, tokenPresent: !!(localStorage.getItem('tmdbToken')||cfg.tmdbApiKey) },\r\n    useTmdbImages: localStorage.getItem('useTmdb')==='1',\r\n    reduceMotion: localStorage.getItem('prefReduceMotion')==='1',\r\n    locationHash: location.hash,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n  pre.textContent = JSON.stringify(report, null, 2);\r\n\r\n  // Update cache stats display\r\n  const statsEl = document.getElementById('cacheStats');\r\n  if(statsEl && cacheStats){\r\n    const heroMovies = heroPipeline?.status?.movies || {};\r\n    const heroSeries = heroPipeline?.status?.series || {};\r\n    const formatTs = (ts)=>{\r\n      if(!Number.isFinite(ts) || ts <= 0) return 'n/a';\r\n      try{ return new Date(ts).toLocaleString(); }\r\n      catch(_err){ return 'n/a'; }\r\n    };\r\n    const heroFeature = heroPipeline?.enabled ? `aktiv (Quelle: ${heroPipeline.featureSource || 'default'})` : `deaktiviert (Quelle: ${heroPipeline?.featureSource || 'default'})`;\r\n    statsEl.innerHTML = `\r\n      <p>Eintr\u00E4ge gesamt: <strong>${cacheStats.totalEntries}</strong></p>\r\n      <p>G\u00FCltig: <strong>${cacheStats.validEntries}</strong> | Abgelaufen: <strong>${cacheStats.expiredEntries}</strong></p>\r\n      <p>Gr\u00F6\u00DFe: <strong>${cacheStats.totalSizeMB} MB</strong></p>\r\n      <p>Hero-Pipeline: <strong>${heroFeature}</strong></p>\r\n      <p>Filme: <strong>${heroMovies.size ?? heroPipeline?.poolSizes?.movies ?? 0}</strong> Eintr\u00E4ge \u00B7 Update: <strong>${formatTs(heroMovies.updatedAt)}</strong> \u00B7 Ablauf: <strong>${formatTs(heroMovies.expiresAt)}</strong></p>\r\n      <p>Serien: <strong>${heroSeries.size ?? heroPipeline?.poolSizes?.series ?? 0}</strong> Eintr\u00E4ge \u00B7 Update: <strong>${formatTs(heroSeries.updatedAt)}</strong> \u00B7 Ablauf: <strong>${formatTs(heroSeries.expiresAt)}</strong></p>\r\n    `;\r\n  }\r\n}\r\n\r\nfunction copyReport(){\r\n  const pre = document.getElementById('debugPre'); if(!pre) return;\r\n  const txt = pre.textContent || '';\r\n  navigator.clipboard?.writeText(txt).catch(err=>{\r\n    console.warn('[debug] Clipboard API write failed, using fallback:', err?.message || err);\r\n    try{\r\n      const ta=document.createElement('textarea');\r\n      ta.value=txt;\r\n      document.body.append(ta);\r\n      ta.select();\r\n      document.execCommand('copy');\r\n      ta.remove();\r\n    }catch(fallbackErr){\r\n      console.warn('[debug] Fallback clipboard copy failed:', fallbackErr?.message || fallbackErr);\r\n    }\r\n  });\r\n}\r\n\r\n", "import { getState } from './state.js';\r\nimport { renderGrid } from './grid.js';\r\nimport * as HeroPipeline from './hero/pipeline.js';\r\nimport { syncDefaultMetadataService } from './metadataService.js';\r\n\r\nlet heroRefreshHandler = null;\r\nlet reduceMotionHandler = null;\r\nlet tmdbHydrationStarted = false;\r\n\r\nexport function setHeroRefreshHandler(handler){\r\n  heroRefreshHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nexport function setReduceMotionHandler(handler){\r\n  reduceMotionHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nfunction notifyHeroRefresh(items){\r\n  if(heroRefreshHandler){\r\n    try{\r\n      heroRefreshHandler(items);\r\n    }catch(err){\r\n      console.warn('[settingsOverlay] Failed to trigger hero refresh handler:', err?.message);\r\n    }\r\n  }\r\n}\r\n\r\nfunction notifyReduceMotion(enabled){\r\n  if(reduceMotionHandler){\r\n    try{\r\n      reduceMotionHandler(enabled);\r\n    }catch(err){\r\n      console.warn('[settingsOverlay] Failed to trigger reduce motion handler:', err?.message);\r\n    }\r\n  }\r\n}\r\n\r\nexport function initSettingsOverlay(cfg){\r\n  const overlay = document.getElementById('settingsOverlay');\r\n  const dialog = overlay?.querySelector('.settings-dialog');\r\n  const open1 = document.getElementById('settingsBtn');\r\n  const open2 = document.getElementById('openSettings');\r\n  const headerSettingsBtn = document.getElementById('headerSettingsBtn');\r\n  const close2 = document.getElementById('settingsClose2');\r\n  const tmdbInput = document.getElementById('tmdbTokenInput');\r\n  const tmdbSave = document.getElementById('tmdbSave');\r\n  const tmdbTest = document.getElementById('tmdbTest');\r\n  const tmdbStatus = document.getElementById('tmdbStatus');\r\n  const tmdbClear = document.getElementById('tmdbClearCache');\r\n  const tmdbBadge = document.getElementById('tmdbStatusBadge');\r\n  const reduce = document.getElementById('prefReduceMotion');\r\n  const useTmdb = document.getElementById('useTmdbSetting');\r\n  const resetFilters = document.getElementById('resetFilters');\r\n  const body = overlay?.querySelector('.settings-body');\r\n\r\n  let heroStatus = document.getElementById('heroCacheStatus');\r\n  let heroRefreshMovies = document.getElementById('heroRefreshMovies');\r\n  let heroRefreshShows = document.getElementById('heroRefreshShows');\r\n  let heroRefreshAll = document.getElementById('heroRefreshAll');\r\n\r\n  if(!heroStatus && body){\r\n    const heroRow = document.createElement('div');\r\n    heroRow.className = 'settings-row';\r\n    heroRow.innerHTML = `\r\n      <div class=\"settings-inline\" id=\"heroRefreshControls\">\r\n        <button type=\"button\" id=\"heroRefreshMovies\" class=\"secondary\">Highlights Filme aktualisieren</button>\r\n        <button type=\"button\" id=\"heroRefreshShows\" class=\"secondary\">Highlights Serien aktualisieren</button>\r\n        <button type=\"button\" id=\"heroRefreshAll\" class=\"secondary\">Alle Highlights aktualisieren</button>\r\n      </div>\r\n      <p class=\"settings-help\" id=\"heroCacheStatus\" aria-live=\"polite\"></p>\r\n    `;\r\n    body.append(heroRow);\r\n    heroStatus = heroRow.querySelector('#heroCacheStatus');\r\n    heroRefreshMovies = heroRow.querySelector('#heroRefreshMovies');\r\n    heroRefreshShows = heroRow.querySelector('#heroRefreshShows');\r\n    heroRefreshAll = heroRow.querySelector('#heroRefreshAll');\r\n  }\r\n\r\n  const heroButtons = [heroRefreshMovies, heroRefreshShows, heroRefreshAll].filter(Boolean);\r\n  let heroTask = null;\r\n\r\n  function setHeroButtonsDisabled(disabled, reason){\r\n    heroButtons.forEach(btn => {\r\n      if(!btn) return;\r\n      btn.disabled = disabled || !HeroPipeline.isEnabled();\r\n      if(btn.disabled && reason){ btn.dataset.heroBusy = reason; }\r\n      else { btn.removeAttribute('data-hero-busy'); }\r\n    });\r\n  }\r\n\r\n  function formatUpdated(ts){\r\n    if(!Number.isFinite(ts) || ts <= 0) return 'unbekannt';\r\n    try {\r\n      return new Date(ts).toLocaleString(undefined, { hour: '2-digit', minute: '2-digit' });\r\n    } catch (_err) {\r\n      return 'unbekannt';\r\n    }\r\n  }\r\n\r\n  function formatExpiry(ts){\r\n    if(!Number.isFinite(ts) || ts <= 0) return 'kein Ablauf';\r\n    const diff = ts - Date.now();\r\n    if(diff <= 0) return 'abgelaufen';\r\n    const minutes = diff / 60000;\r\n    if(minutes < 1) return 'l\u00E4uft in <1 Min ab';\r\n    if(minutes < 60) return `l\u00E4uft in ${Math.round(minutes)} Min ab`;\r\n    const hours = minutes / 60;\r\n    if(hours < 24) return `l\u00E4uft in ${Math.round(hours)} Std ab`;\r\n    const days = hours / 24;\r\n    return `l\u00E4uft in ${Math.round(days)} Tg ab`;\r\n  }\r\n\r\n  function describeHeroStatus(label, status){\r\n    if(!status) return `${label}: keine Daten`;\r\n    if(status.state === 'disabled') return `${label}: deaktiviert`;\r\n    if(status.state === 'loading' || status.regenerating) return `${label}: wird aktualisiert \u2026`;\r\n    if(status.state === 'error') return `${label}: Fehler (${status.lastError || 'unbekannt'})`;\r\n    if(status.state === 'stale'){\r\n      return `${label}: ${status.size} Eintr\u00E4ge (Cache abgelaufen)`;\r\n    }\r\n    const updated = formatUpdated(status.updatedAt);\r\n    const expiry = formatExpiry(status.expiresAt);\r\n    return `${label}: ${status.size} Eintr\u00E4ge (Update ${updated}, ${expiry})`;\r\n  }\r\n\r\n  function updateHeroStatus(snapshot){\r\n    if(!heroStatus) return;\r\n    if(!snapshot || !HeroPipeline.isEnabled() || snapshot.enabled === false){\r\n      heroStatus.textContent = 'Hero-Pipeline deaktiviert \u2013 Legacy-Hero aktiv.';\r\n      setHeroButtonsDisabled(true, 'disabled');\r\n      return;\r\n    }\r\n    const busy = !!(snapshot.status?.movies?.regenerating || snapshot.status?.series?.regenerating);\r\n    setHeroButtonsDisabled(busy, busy ? 'busy' : '');\r\n    const segments = [];\r\n    segments.push(describeHeroStatus('Filme', snapshot.status?.movies));\r\n    segments.push(describeHeroStatus('Serien', snapshot.status?.series));\r\n    if(snapshot.tmdb){\r\n      if(!snapshot.tmdb.allowed) segments.push('TMDb deaktiviert');\r\n      else segments.push(`TMDb ${snapshot.tmdb.active ? 'aktiv' : 'aus (Toggle)'}`);\r\n    }\r\n    if(snapshot.featureSource){\r\n      segments.push(`Feature-Flag: ${snapshot.featureSource}`);\r\n    }\r\n    heroStatus.textContent = segments.join(' \u2022 ');\r\n  }\r\n\r\n  async function runHeroRegeneration(kind='all', label='Highlights aktualisieren \u2026'){\r\n    if(!HeroPipeline.isEnabled()) return;\r\n    if(heroTask){\r\n      try{ await heroTask; }catch(_err){}\r\n    }\r\n    if(heroStatus && label){ heroStatus.textContent = label; }\r\n    setHeroButtonsDisabled(true, 'busy');\r\n    const action = (kind === 'movies' || kind === 'series') ? HeroPipeline.refreshKind(kind) : HeroPipeline.refreshAll();\r\n    heroTask = action.then(()=>{\r\n      notifyHeroRefresh();\r\n    }).catch(err => {\r\n      console.warn('[settingsOverlay] Hero regeneration failed:', err?.message || err);\r\n    }).finally(()=>{\r\n      heroTask = null;\r\n      setHeroButtonsDisabled(false);\r\n    });\r\n    return heroTask;\r\n  }\r\n\r\n  HeroPipeline.subscribe(updateHeroStatus);\r\n\r\n  if(overlay && overlay.hidden) overlay.setAttribute('aria-hidden', 'true');\r\n\r\n  let restoreFocus = null;\r\n  let previousOverflow = '';\r\n  let isOpen = false;\r\n  const backgroundState = new Map();\r\n  const focusSelector = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])';\r\n\r\n  function getFocusable(){\r\n    if(!overlay) return [];\r\n    return Array.from(overlay.querySelectorAll(focusSelector)).filter(el=> !el.hasAttribute('disabled') && el.getAttribute('aria-hidden') !== 'true');\r\n  }\r\n\r\n  function focusDialog(){\r\n    if(dialog && typeof dialog.focus === 'function') dialog.focus({ preventScroll:true });\r\n    else if(overlay && typeof overlay.focus === 'function') overlay.focus({ preventScroll:true });\r\n  }\r\n\r\n  function setBackgroundInert(active){\r\n    if(!overlay) return;\r\n    const nodes = Array.from(document.body.children).filter(node=> node !== overlay);\r\n    if(active){\r\n      nodes.forEach(node=>{\r\n        if(!backgroundState.has(node)){\r\n          backgroundState.set(node, {\r\n            ariaHidden: node.hasAttribute('aria-hidden') ? node.getAttribute('aria-hidden') : null,\r\n            inert: node.hasAttribute('inert')\r\n          });\r\n        }\r\n        node.setAttribute('aria-hidden', 'true');\r\n        node.setAttribute('inert', '');\r\n      });\r\n    }else{\r\n      nodes.forEach(node=>{\r\n        const state = backgroundState.get(node);\r\n        if(state){\r\n          if(state.ariaHidden === null || state.ariaHidden === undefined) node.removeAttribute('aria-hidden');\r\n          else node.setAttribute('aria-hidden', state.ariaHidden);\r\n          if(state.inert) node.setAttribute('inert', '');\r\n          else node.removeAttribute('inert');\r\n          backgroundState.delete(node);\r\n        }else{\r\n          node.removeAttribute('aria-hidden');\r\n          node.removeAttribute('inert');\r\n        }\r\n      });\r\n      backgroundState.clear();\r\n    }\r\n  }\r\n\r\n  function openOverlay(){\r\n    if(!overlay || isOpen) return;\r\n    isOpen = true;\r\n    overlay.hidden = false;\r\n    overlay.setAttribute('aria-hidden', 'false');\r\n    restoreFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;\r\n    previousOverflow = document.body.style.overflow;\r\n    document.body.style.overflow = 'hidden';\r\n    setBackgroundInert(true);\r\n    syncSettingsUi();\r\n    requestAnimationFrame(focusDialog);\r\n  }\r\n\r\n  function closeOverlay(){\r\n    if(!overlay || !isOpen) return;\r\n    isOpen = false;\r\n    overlay.hidden = true;\r\n    overlay.setAttribute('aria-hidden', 'true');\r\n    setBackgroundInert(false);\r\n    document.body.style.overflow = previousOverflow;\r\n    if(restoreFocus && typeof restoreFocus.focus === 'function'){ restoreFocus.focus(); }\r\n    restoreFocus = null;\r\n  }\r\n\r\n  function handleKeydown(ev){\r\n    if(!isOpen) return;\r\n    if(ev.key === 'Escape'){\r\n      ev.preventDefault();\r\n      closeOverlay();\r\n      return;\r\n    }\r\n    if(ev.key !== 'Tab') return;\r\n    const focusable = getFocusable();\r\n    if(!focusable.length){\r\n      ev.preventDefault();\r\n      focusDialog();\r\n      return;\r\n    }\r\n    const first = focusable[0];\r\n    const last = focusable[focusable.length - 1];\r\n    const active = document.activeElement;\r\n    if(ev.shiftKey){\r\n      if(active === first || !overlay.contains(active)){\r\n        ev.preventDefault();\r\n        last.focus();\r\n      }\r\n    }else if(active === last){\r\n      ev.preventDefault();\r\n      first.focus();\r\n    }\r\n  }\r\n\r\n  open1 && open1.addEventListener('click', openOverlay);\r\n  open2 && open2.addEventListener('click', ()=>{ openOverlay(); });\r\n  headerSettingsBtn && headerSettingsBtn.addEventListener('click', openOverlay);\r\n  close2 && close2.addEventListener('click', closeOverlay);\r\n  overlay && overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closeOverlay(); });\r\n  overlay && overlay.addEventListener('keydown', handleKeydown);\r\n\r\n  function setTmdbStatus(msg='', kind=''){\r\n    if(!tmdbStatus) return;\r\n    tmdbStatus.textContent = msg;\r\n    tmdbStatus.dataset.kind = kind; // kind: success|error|info|pending\r\n    if(tmdbBadge){ tmdbBadge.dataset.kind = kind || ''; tmdbBadge.title = msg || ''; }\r\n    // Auto-Fallback: Bei Fehler und vorhandenem v3 API Key, gespeicherten ung\u00FCltigen Token entfernen\r\n    try{\r\n      if(kind==='error' && cfg && cfg.tmdbApiKey){\r\n        const stored = String(localStorage.getItem('tmdbToken')||'').trim();\r\n        const currentInput = String(tmdbInput?.value||'').trim();\r\n        if(stored && currentInput){\r\n          try{ localStorage.removeItem('tmdbToken'); }\r\n          catch(err){ console.warn('[settingsOverlay] Failed to remove tmdbToken from storage:', err?.message || err); }\r\n          if(tmdbInput) tmdbInput.value = '';\r\n          setUseTmdbAvailability(true);\r\n          const m = 'Ung\u00FCltiger Token entfernt. Verwende API Key aus config.json.';\r\n          tmdbStatus.textContent = m;\r\n          tmdbStatus.dataset.kind = 'info';\r\n          if(tmdbBadge){ tmdbBadge.dataset.kind = 'info'; tmdbBadge.title = m; }\r\n        }\r\n      }\r\n    }catch(err){ console.warn('[settingsOverlay] Failed to reset TMDB status state:', err?.message || err); }\r\n  }\r\n\r\n  function setUseTmdbAvailability(allowed){\r\n    if(!useTmdb) return;\r\n    useTmdb.disabled = !allowed;\r\n    useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token oder API Key.' : '';\r\n    if(!allowed && useTmdb.checked){\r\n      try{ localStorage.setItem('useTmdb', '0'); }\r\n      catch(err){ console.warn('[settingsOverlay] Failed to persist TMDB toggle state:', err?.message || err); }\r\n      useTmdb.checked = false;\r\n      renderGrid(getState().view);\r\n      notifyHeroRefresh();\r\n    }\r\n  }\r\n\r\n  function syncSettingsUi(){\r\n    let token = '';\r\n    try{ tmdbInput && (tmdbInput.value = token = (localStorage.getItem('tmdbToken')||'')); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to read stored tmdbToken:', err?.message || err); }\r\n    try{ reduce && (reduce.checked = localStorage.getItem('prefReduceMotion')==='1'); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to read reduce-motion preference:', err?.message || err); }\r\n    try{ if(useTmdb){\r\n      useTmdb.checked = localStorage.getItem('useTmdb')==='1';\r\n      useTmdb.disabled = !token;\r\n      useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token.' : '';\r\n    } }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to sync TMDB toggle from storage:', err?.message || err); }\r\n    try{ setUseTmdbAvailability(!!token || !!(cfg&&cfg.tmdbApiKey)); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to update TMDB availability:', err?.message || err); }\r\n    setTmdbStatus('', '');\r\n\r\n    // Check if TMDB is disabled in config\r\n    if(cfg && cfg.tmdbEnabled === false){\r\n      setTmdbStatus('\u26A0\uFE0F TMDB ist in config.json deaktiviert (tmdbEnabled: false). Hero-Banner ben\u00F6tigt TMDB!', 'error');\r\n    }else if(!token){\r\n      setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info');\r\n    }\r\n    // Optional: Auto-Check bei ge\u00F6ffnetem Dialog\r\n    if(token){\r\n      (async()=>{\r\n        setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n        try{\r\n          const svc = await import('./services/tmdb.js');\r\n          const res = await svc.validateToken?.(token);\r\n          if(res && res.ok){\r\n            setUseTmdbAvailability(true);\r\n            if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n            else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n          }else{\r\n            setUseTmdbAvailability(false);\r\n            if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n            else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n          }\r\n        }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n      })();\r\n    } else { setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); }\r\n  }\r\n\r\n  heroRefreshMovies && heroRefreshMovies.addEventListener('click', ()=>{\r\n    runHeroRegeneration('movies', 'Aktualisiere Film-Highlights \u2026');\r\n  });\r\n  heroRefreshShows && heroRefreshShows.addEventListener('click', ()=>{\r\n    runHeroRegeneration('series', 'Aktualisiere Serien-Highlights \u2026');\r\n  });\r\n  heroRefreshAll && heroRefreshAll.addEventListener('click', ()=>{\r\n    runHeroRegeneration('all', 'Aktualisiere alle Highlights \u2026');\r\n  });\r\n\r\n  tmdbSave && tmdbSave.addEventListener('click', async ()=>{\r\n    const raw = String(tmdbInput?.value||'').trim();\r\n    try{ localStorage.setItem('tmdbToken', raw); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to persist tmdbToken:', err?.message || err); }\r\n    if(!raw){\r\n      syncDefaultMetadataService(cfg, { preferStoredToken: false, token: '' });\r\n      setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info');\r\n      setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey));\r\n      HeroPipeline.updateTmdbActive(useTmdb?.checked ?? false);\r\n      runHeroRegeneration('all', 'Highlights aktualisieren (Token entfernt)\u2026');\r\n      return;\r\n    }\r\n    syncDefaultMetadataService(cfg, { preferStoredToken: false, token: raw });\r\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n    try{\r\n      const svc = await import('./services/tmdb.js');\r\n      const res = await svc.validateToken?.(raw);\r\n      if(res && res.ok){\r\n        setUseTmdbAvailability(true);\r\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n      }else{\r\n        setUseTmdbAvailability(false);\r\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n      }\r\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n\r\n    // Check if tmdbEnabled is false and warn user\r\n    if(cfg && cfg.tmdbEnabled === false && raw){\r\n      setTmdbStatus('\u26A0\uFE0F Token gespeichert, aber TMDB in config.json deaktiviert. Bitte \"tmdbEnabled\": true setzen!', 'error');\r\n    }\r\n\r\n    // Hero uses TMDB automatically when token is available - update pipeline state\r\n    HeroPipeline.updateTmdbActive(true);\r\n    runHeroRegeneration('all', 'Highlights aktualisieren (Token ge\u00E4ndert)\u2026');\r\n  });\r\n\r\n  tmdbTest && tmdbTest.addEventListener('click', async ()=>{\r\n    const raw = String(tmdbInput?.value||'').trim();\r\n    if(!raw){ setTmdbStatus('Bitte Token eingeben.', 'error'); return; }\r\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\r\n    try{\r\n      const svc = await import('./services/tmdb.js');\r\n      const res = await svc.validateToken?.(raw);\r\n      if(res && res.ok){\r\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\r\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\r\n      }else{\r\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\r\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\r\n      }\r\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\r\n  });\r\n  tmdbClear && tmdbClear.addEventListener('click', ()=>{\r\n    // Use safe clear utility that preserves user settings\r\n    import('./utils.js').then(m=>{\r\n      const result = m.clearHeroCache?.();\r\n      if(result && !result.error){\r\n        console.log('[settingsOverlay] Cleared hero cache:', result);\r\n        setTmdbStatus(`Cache geleert: ${result.heroEntries} Hero-Eintr\u00E4ge, ${result.tmdbCacheEntries} TMDB-Eintr\u00E4ge. Token erhalten.`, 'success');\r\n      }\r\n    });\r\n    // Also clear the TMDB service cache\r\n    import('./services/tmdb.js').then(m=>m.clearCache?.());\r\n    runHeroRegeneration('all', 'Highlights aktualisieren (TMDB-Cache geleert)\u2026');\r\n  });\r\n  reduce && reduce.addEventListener('change', ()=>{\r\n    try{ localStorage.setItem('prefReduceMotion', reduce.checked ? '1' : '0'); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to store reduce-motion preference:', err?.message || err); }\r\n    notifyReduceMotion(reduce.checked);\r\n  });\r\n  useTmdb && useTmdb.addEventListener('change', ()=>{\r\n    try{ localStorage.setItem('useTmdb', useTmdb.checked ? '1' : '0'); }\r\n    catch(err){ console.warn('[settingsOverlay] Failed to store TMDB usage preference:', err?.message || err); }\r\n    // Start TMDB hydration when enabling the toggle (if not already started)\r\n    if(useTmdb.checked && !tmdbHydrationStarted){\r\n      tmdbHydrationStarted = true;\r\n      import('./services/tmdb.js').then(m=>{\r\n        const s = getState();\r\n        m.hydrateOptional?.(s.movies, s.shows, s.cfg);\r\n      }).catch(err=>{ console.warn('[settingsOverlay] Failed to hydrate TMDB data:', err?.message || err); });\r\n      // Re-render a bit later to reflect incoming posters\r\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 1200);\r\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 3000);\r\n    }\r\n    // Note: Hero TMDB is automatic based on token, not card toggle\r\n    // But we still notify pipeline to refresh state\r\n    HeroPipeline.updateTmdbActive(true);\r\n    // Only regenerate hero if card toggle changed (cards don't affect hero)\r\n    // Actually, no need to regenerate hero for card toggle - it uses its own logic\r\n    renderGrid(getState().view);\r\n    notifyHeroRefresh();\r\n  });\r\n  resetFilters && resetFilters.addEventListener('click', ()=>{\r\n    const search = document.getElementById('search'); if(search) search.value='';\r\n    const q = document.getElementById('q'); if(q) q.value='';\r\n    const onlyNew = document.getElementById('onlyNew'); if(onlyNew) onlyNew.checked=false;\r\n    const yf = document.getElementById('yearFrom'); const yt = document.getElementById('yearTo'); if(yf) yf.value=''; if(yt) yt.value='';\r\n    const col = document.getElementById('collectionFilter'); if(col) col.value='';\r\n    document.querySelectorAll('#genreFilters .chip.active').forEach(n=>n.classList.remove('active'));\r\n    const genreRoot = document.getElementById('genreFilters');\r\n    if(genreRoot){\r\n      genreRoot.dataset.state = 'empty';\r\n      genreRoot.dataset.count = '0';\r\n    }\r\n    import('./filter.js').then(F=>{\r\n      const result = F.applyFilters();\r\n      renderGrid(getState().view);\r\n      notifyHeroRefresh(result);\r\n    });\r\n  });\r\n}\r\n\r\n", "import { getState } from './state.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { humanYear, formatRating, useTmdbOn } from './utils.js';\r\nimport { recordHeroHistory, getStoredPool } from './hero/storage.js';\r\n\r\nconst NUMBER_FORMAT = typeof Intl !== 'undefined' ? new Intl.NumberFormat('en-US') : { format: (value)=>String(value) };\r\n\r\nlet currentHeroEntry = null;\r\nlet heroDefaults = null;\r\nlet navigateToHashHandler = null;\r\nlet lastFallbackReason = null;\r\n\r\nconst HERO_FALLBACK_COPY = {\r\n  default: {\r\n    title: 'Highlights temporarily unavailable',\r\n    tagline: 'TMDb data could not be loaded just now.',\r\n    overview: 'The hero banner falls back to a neutral gradient until artwork and metadata are available again. Feel free to keep browsing and refresh later.'\r\n  },\r\n  'rate-limit': {\r\n    title: 'Highlights are catching their breath',\r\n    tagline: 'TMDb is currently rate limiting our artwork requests.',\r\n    overview: 'We are slowing down hero generation until the limit resets. Your library stays accessible in the meantime.'\r\n  },\r\n  error: {\r\n    title: 'Highlights paused',\r\n    tagline: 'Fresh TMDb data is temporarily unavailable.',\r\n    overview: 'We will automatically retry fetching artwork. You can also trigger a manual refresh from the settings when you are ready.'\r\n  }\r\n};\r\n\r\nexport function setCurrentHeroItem(item){\r\n  currentHeroEntry = item || null;\r\n  return currentHeroEntry;\r\n}\r\n\r\nexport function getCurrentHeroItem(){\r\n  return currentHeroEntry;\r\n}\r\n\r\nexport function getHeroFallbackReason(){\r\n  return lastFallbackReason;\r\n}\r\n\r\nexport function setHeroDefaults(defaults){\r\n  heroDefaults = defaults ? { ...defaults } : null;\r\n  return heroDefaults;\r\n}\r\n\r\nexport function getHeroDefaults(){\r\n  return heroDefaults;\r\n}\r\n\r\nexport function ensureHeroDefaults(){\r\n  if(heroDefaults) return heroDefaults;\r\n  const defaults = {\r\n    title: document.getElementById('heroTitle')?.textContent?.trim() || '',\r\n    tagline: document.getElementById('heroTagline')?.textContent?.trim() || '',\r\n    overview: document.getElementById('heroOverview')?.textContent?.trim() || '',\r\n    cta: document.getElementById('heroCta')?.textContent?.trim() || ''\r\n  };\r\n  heroDefaults = defaults;\r\n  return defaults;\r\n}\r\n\r\nexport function setHeroNavigation(handler){\r\n  navigateToHashHandler = typeof handler === 'function' ? handler : null;\r\n}\r\n\r\nexport function showHeroFallback(reason = 'default', overrides = {}){\r\n  const hero = document.getElementById('hero');\r\n  const heroTitle = document.getElementById('heroTitle');\r\n  const heroTagline = document.getElementById('heroTagline');\r\n  const heroOverview = document.getElementById('heroOverview');\r\n  const heroCta = document.getElementById('heroCta');\r\n  const heroMeta = document.getElementById('heroMeta');\r\n  const metaPrimary = document.getElementById('heroMetaPrimary');\r\n  const metaSecondary = document.getElementById('heroMetaSecondary');\r\n  const metaTertiary = document.getElementById('heroMetaTertiary');\r\n  const heroPicture = document.getElementById('heroPicture');\r\n  const heroImage = document.getElementById('heroBackdropImage');\r\n  const heroSourceLarge = document.getElementById('heroBackdropLarge');\r\n  const heroSourceMedium = document.getElementById('heroBackdropMedium');\r\n\r\n  if(!hero || !heroTitle || !heroTagline || !heroOverview || !heroCta || !heroMeta) return false;\r\n\r\n  const defaults = ensureHeroDefaults();\r\n  const copy = { ...HERO_FALLBACK_COPY.default, ...(HERO_FALLBACK_COPY[reason] || {}), ...(overrides || {}) };\r\n\r\n  setCurrentHeroItem(null);\r\n  lastFallbackReason = reason;\r\n\r\n  hero.dataset.heroKind = 'fallback';\r\n  hero.dataset.heroId = '';\r\n  hero.dataset.state = 'fallback';\r\n  hero.classList.remove('hero--has-media');\r\n  clearPicture(heroPicture, heroImage, heroSourceLarge, heroSourceMedium);\r\n\r\n  heroTitle.textContent = copy.title || defaults.title;\r\n\r\n  const taglineText = copy.tagline || '';\r\n  heroTagline.textContent = taglineText || defaults.tagline;\r\n  heroTagline.hidden = !taglineText;\r\n  heroTagline.dataset.taglinePaused = '0';\r\n  delete heroTagline.dataset.heroBound;\r\n  heroTagline.classList.remove('is-fading');\r\n\r\n  const overviewText = copy.overview || '';\r\n  heroOverview.textContent = overviewText;\r\n  heroOverview.hidden = !overviewText;\r\n\r\n  const ctaLabel = copy.cta || defaults.cta || heroCta.textContent || 'Browse featured titles';\r\n  heroCta.textContent = ctaLabel;\r\n  const ctaEnabled = typeof copy.ctaAction === 'function' && copy.ctaEnabled === true;\r\n  heroCta.disabled = !ctaEnabled;\r\n  heroCta.setAttribute('aria-disabled', ctaEnabled ? 'false' : 'true');\r\n  if(ctaEnabled){\r\n    heroCta.onclick = () => { try { copy.ctaAction(); } catch (err) { console.warn('[hero] Fallback CTA failed:', err?.message || err); } };\r\n    heroCta.setAttribute('aria-label', copy.ctaLabel || ctaLabel);\r\n  } else {\r\n    heroCta.onclick = null;\r\n    heroCta.removeAttribute('aria-label');\r\n  }\r\n\r\n  heroMeta.hidden = true;\r\n  if(metaPrimary) metaPrimary.innerHTML = '';\r\n  if(metaSecondary) metaSecondary.innerHTML = '';\r\n  if(metaTertiary) metaTertiary.innerHTML = '';\r\n\r\n  return true;\r\n}\r\n\r\nexport function refreshHero(listOverride){\r\n  const hero = document.getElementById('hero');\r\n  const heroTitle = document.getElementById('heroTitle');\r\n  const heroTagline = document.getElementById('heroTagline');\r\n  const heroOverview = document.getElementById('heroOverview');\r\n  const heroCta = document.getElementById('heroCta');\r\n  const heroMeta = document.getElementById('heroMeta');\r\n  const metaPrimary = document.getElementById('heroMetaPrimary');\r\n  const metaSecondary = document.getElementById('heroMetaSecondary');\r\n  const metaTertiary = document.getElementById('heroMetaTertiary');\r\n  const heroPicture = document.getElementById('heroPicture');\r\n  const heroImage = document.getElementById('heroBackdropImage');\r\n  const heroSourceLarge = document.getElementById('heroBackdropLarge');\r\n  const heroSourceMedium = document.getElementById('heroBackdropMedium');\r\n\r\n  if(!hero || !heroTitle || !heroTagline || !heroOverview || !heroCta || !heroMeta) return;\r\n\r\n  const defaults = ensureHeroDefaults();\r\n  const candidate = selectHeroEntry(listOverride);\r\n\r\n  if(!candidate){\r\n    setCurrentHeroItem(null);\r\n    lastFallbackReason = null;\r\n    hero.dataset.heroKind = '';\r\n    hero.dataset.heroId = '';\r\n    hero.dataset.state = 'empty';\r\n    hero.classList.remove('hero--has-media');\r\n    clearPicture(heroPicture, heroImage, heroSourceLarge, heroSourceMedium);\r\n    heroTitle.textContent = defaults.title;\r\n    heroTagline.textContent = defaults.tagline;\r\n    heroTagline.hidden = !defaults.tagline;\r\n    heroTagline.dataset.taglinePaused = '0';\r\n    delete heroTagline.dataset.heroBound;\r\n    heroTagline.classList.remove('is-fading');\r\n    heroOverview.textContent = defaults.overview;\r\n    heroOverview.hidden = !defaults.overview;\r\n    heroCta.textContent = defaults.cta || 'View details';\r\n    heroCta.disabled = true;\r\n    heroCta.setAttribute('aria-disabled', 'true');\r\n    heroCta.removeAttribute('aria-label');\r\n    heroCta.onclick = null;\r\n    heroMeta.hidden = true;\r\n    if(metaPrimary) metaPrimary.innerHTML = '';\r\n    if(metaSecondary) metaSecondary.innerHTML = '';\r\n    if(metaTertiary) metaTertiary.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  const normalized = ensureNormalizedEntry(candidate);\r\n  if(!normalized){\r\n    return refreshHero([]);\r\n  }\r\n\r\n  setCurrentHeroItem(normalized);\r\n  lastFallbackReason = null;\r\n\r\n  const kind = normalized.type === 'tv' ? 'show' : 'movie';\r\n  const targetId = normalized.cta?.id || normalized.id || '';\r\n\r\n  try {\r\n    recordHeroHistory(kind === 'show' ? 'series' : 'movies', normalized);\r\n  } catch (err) {\r\n    console.warn('[hero] Failed to record hero history:', err?.message || err);\r\n  }\r\n\r\n  hero.dataset.heroKind = kind;\r\n  hero.dataset.heroId = targetId;\r\n  hero.dataset.state = 'ready';\r\n\r\n  heroTitle.textContent = normalized.title || defaults.title;\r\n\r\n  if(heroTagline){\r\n    const tagline = normalized.tagline || '';\r\n    heroTagline.textContent = tagline;\r\n    heroTagline.hidden = !tagline;\r\n    heroTagline.dataset.taglinePaused = tagline ? '1' : '0';\r\n    if(tagline) heroTagline.dataset.heroBound = '1';\r\n    else delete heroTagline.dataset.heroBound;\r\n    heroTagline.classList.remove('is-fading');\r\n  }\r\n\r\n  if(heroOverview){\r\n    const overview = normalized.overview || '';\r\n    heroOverview.textContent = overview;\r\n    heroOverview.hidden = !overview;\r\n  }\r\n\r\n  const ctaLabel = normalized.cta?.label || (kind === 'show' ? 'View show details' : 'View movie details');\r\n  heroCta.textContent = ctaLabel;\r\n  heroCta.disabled = false;\r\n  heroCta.setAttribute('aria-disabled', 'false');\r\n  heroCta.setAttribute('aria-label', normalized.title ? `${ctaLabel}: ${normalized.title}` : ctaLabel);\r\n  heroCta.onclick = () => openHeroModal(normalized);\r\n\r\n  renderMeta(metaPrimary, metaSecondary, metaTertiary, heroMeta, normalized);\r\n  renderMedia(hero, heroPicture, heroImage, heroSourceLarge, heroSourceMedium, normalized);\r\n}\r\n\r\nfunction selectHeroEntry(listOverride){\r\n  if(Array.isArray(listOverride) && listOverride.length){\r\n    const normalizedOverride = ensureNormalizedList(listOverride);\r\n    if(normalizedOverride.length){\r\n      return chooseHeroCandidate(normalizedOverride);\r\n    }\r\n  }\r\n\r\n  const source = heroCandidatesFromState();\r\n  if(!source.length) return null;\r\n  return chooseHeroCandidate(source);\r\n}\r\n\r\nfunction ensureNormalizedList(list){\r\n  if(!Array.isArray(list)) return [];\r\n  const normalized = [];\r\n  list.forEach(item => {\r\n    if(!isPlayableHeroItem(item)) return;\r\n    const entry = ensureNormalizedEntry(item);\r\n    if(entry) normalized.push(entry);\r\n  });\r\n  return normalized;\r\n}\r\n\r\nfunction isPlayableHeroItem(item){\r\n  if(!item || typeof item !== 'object') return false;\r\n  if(item.isCollectionGroup) return false;\r\n  const type = typeof item.type === 'string' ? item.type.toLowerCase() : '';\r\n  if(type === 'collection') return false;\r\n  return true;\r\n}\r\n\r\nfunction chooseHeroCandidate(list){\r\n  if(list.length === 1) return list[0];\r\n  const index = Math.floor(Math.random() * list.length);\r\n  const candidate = list[index];\r\n  if(currentHeroEntry && list.length > 1 && candidate && currentHeroEntry && candidate.id === currentHeroEntry.id){\r\n    const alt = list.find(item => item && item.id !== currentHeroEntry.id);\r\n    return alt || candidate;\r\n  }\r\n  return candidate;\r\n}\r\n\r\nfunction heroCandidatesFromState(){\r\n  const state = getState();\r\n  const view = state.view === 'shows' ? 'series' : 'movies';\r\n  const stored = getStoredPool(view, { allowExpired: true }) || null;\r\n  const fromPool = Array.isArray(stored?.items) ? ensureNormalizedList(stored.items) : [];\r\n  if(fromPool.length) return fromPool;\r\n\r\n  const filtered = Array.isArray(state.filtered) && state.filtered.length ? state.filtered : null;\r\n  const pool = filtered || (view === 'series' ? state.shows : state.movies) || [];\r\n  return ensureNormalizedList(pool);\r\n}\r\n\r\nfunction ensureNormalizedEntry(item){\r\n  if(!item || typeof item !== 'object') return null;\r\n  if(isNormalized(item)){\r\n    return { ...item, cta: item.cta ? { ...item.cta } : null };\r\n  }\r\n  return normalizeLegacyItem(item);\r\n}\r\n\r\nfunction isNormalized(item){\r\n  if(!item || typeof item !== 'object') return false;\r\n  const ctaId = item?.cta?.id || item?.heroId;\r\n  return Boolean(item.title && ctaId);\r\n}\r\n\r\nfunction normalizeLegacyItem(raw){\r\n  if(!raw || typeof raw !== 'object') return null;\r\n  const type = raw.type === 'tv' ? 'tv' : 'movie';\r\n  const title = String(raw.title || raw.name || '').trim();\r\n  if(!title) return null;\r\n\r\n  const ids = collectIds(raw);\r\n  const targetId = ids.tmdb || ids.imdb || ids.ratingKey || '';\r\n  if(!targetId) return null;\r\n\r\n  const year = parseYear(raw);\r\n  const runtime = parseRuntime(raw, type);\r\n  const rating = parseRating(raw);\r\n  const genres = collectGenres(raw);\r\n  const certification = parseCertification(raw);\r\n  const overview = parseOverview(raw);\r\n  const tagline = parseTagline(raw);\r\n  const backdrops = collectLegacyBackdrops(raw);\r\n\r\n  const cta = {\r\n    id: targetId,\r\n    kind: type === 'tv' ? 'show' : 'movie',\r\n    label: type === 'tv' ? 'View show details' : 'View movie details',\r\n    target: `#/${type === 'tv' ? 'show' : 'movie'}/${targetId}`\r\n  };\r\n\r\n  return {\r\n    id: ids.ratingKey || `${type}-${targetId}`,\r\n    type,\r\n    title,\r\n    tagline,\r\n    overview,\r\n    year,\r\n    runtime,\r\n    rating,\r\n    genres,\r\n    certification,\r\n    cta,\r\n    ids,\r\n    backdrops\r\n  };\r\n}\r\n\r\nfunction collectIds(raw){\r\n  const ids = {};\r\n  if(raw?.ids && typeof raw.ids === 'object'){\r\n    if(raw.ids.tmdb) ids.tmdb = String(raw.ids.tmdb);\r\n    if(raw.ids.imdb) ids.imdb = String(raw.ids.imdb);\r\n    if(raw.ids.tvdb) ids.tvdb = String(raw.ids.tvdb);\r\n  }\r\n  if(raw?.ratingKey != null) ids.ratingKey = String(raw.ratingKey);\r\n  if(raw?.guid) ids.guid = String(raw.guid);\r\n  return ids;\r\n}\r\n\r\nfunction parseYear(raw){\r\n  const year = humanYear(raw);\r\n  return year ? Number(year) : null;\r\n}\r\n\r\nfunction parseRuntime(raw, type){\r\n  const minutes = raw?.runtimeMin ?? raw?.durationMin ?? (raw?.duration ? Math.round(Number(raw.duration) / 60000) : null);\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return null;\r\n  if(type === 'tv') return Math.max(1, Math.round(minutes));\r\n  return Math.max(1, Math.round(minutes));\r\n}\r\n\r\nfunction parseRating(raw){\r\n  const rating = Number(raw?.rating ?? raw?.audienceRating);\r\n  return Number.isFinite(rating) ? rating : null;\r\n}\r\n\r\nfunction collectGenres(raw){\r\n  const source = Array.isArray(raw?.genres) ? raw.genres : [];\r\n  const names = [];\r\n  source.forEach(entry => {\r\n    if(!entry) return;\r\n    if(typeof entry === 'string'){\r\n      const trimmed = entry.trim();\r\n      if(trimmed) names.push(trimmed);\r\n      return;\r\n    }\r\n    const name = entry.tag || entry.title || entry.name || entry.label || '';\r\n    if(name) names.push(name);\r\n  });\r\n  return Array.from(new Set(names));\r\n}\r\n\r\nfunction parseCertification(raw){\r\n  const rating = typeof raw?.contentRating === 'string' ? raw.contentRating.trim() : '';\r\n  if(!rating) return '';\r\n  const segments = rating.split('/');\r\n  const last = segments[segments.length - 1];\r\n  return last ? last.trim() : rating;\r\n}\r\n\r\nfunction parseOverview(raw){\r\n  const sources = [raw?.summary, raw?.plot, raw?.description, raw?.tagline];\r\n  for(const value of sources){\r\n    if(typeof value !== 'string') continue;\r\n    const trimmed = value.trim();\r\n    if(trimmed) return trimmed;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction parseTagline(raw){\r\n  const sources = [raw?.tagline];\r\n  for(const value of sources){\r\n    if(typeof value !== 'string') continue;\r\n    const trimmed = value.trim();\r\n    if(trimmed) return trimmed;\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction collectLegacyBackdrops(raw){\r\n  const preferTmdb = useTmdbOn();\r\n  const tmdbCandidates = [\r\n    raw?.tmdb?.backdrop,\r\n    raw?.tmdb?.backdrop_path,\r\n    raw?.tmdb?.backdropPath,\r\n    raw?.tmdb?.background,\r\n    raw?.tmdb?.art\r\n  ];\r\n  const localCandidates = [\r\n    raw?.art,\r\n    raw?.background,\r\n    raw?.thumbBackground,\r\n    raw?.coverArt,\r\n    raw?.thumb,\r\n    raw?.thumbFile\r\n  ];\r\n  const urls = [];\r\n  if(preferTmdb){\r\n    tmdbCandidates.forEach(candidate => {\r\n      const url = normalizeMediaPath(candidate, true);\r\n      if(url && !urls.includes(url)) urls.push(url);\r\n    });\r\n  }\r\n  localCandidates.forEach(candidate => {\r\n    const url = normalizeMediaPath(candidate, false);\r\n    if(url && !urls.includes(url)) urls.push(url);\r\n  });\r\n  return urls;\r\n}\r\n\r\nfunction normalizeMediaPath(path, preferTmdb){\r\n  if(typeof path !== 'string') return '';\r\n  const trimmed = path.trim();\r\n  if(!trimmed) return '';\r\n  if(trimmed.startsWith('http')) return trimmed;\r\n  if(trimmed.startsWith('/')){\r\n    if(preferTmdb && !trimmed.startsWith('/library/')){\r\n      return `https://image.tmdb.org/t/p/original${trimmed}`;\r\n    }\r\n    return trimmed;\r\n  }\r\n  return trimmed;\r\n}\r\n\r\nfunction renderMeta(primaryRoot, secondaryRoot, tertiaryRoot, container, entry){\r\n  const rows = buildMetaRows(entry);\r\n  const [primary = [], secondary = [], tertiary = []] = rows;\r\n\r\n  renderMetaRow(primaryRoot, primary);\r\n  renderMetaRow(secondaryRoot, secondary);\r\n  renderMetaRow(tertiaryRoot, tertiary);\r\n\r\n  const hasContent = primary.length || secondary.length || tertiary.length;\r\n  container.hidden = !hasContent;\r\n}\r\n\r\nfunction buildMetaRows(entry){\r\n  const rows = [];\r\n  const primary = [];\r\n  if(Number.isFinite(entry.year)) primary.push({ text: String(entry.year), label: 'Release year' });\r\n  if(Number.isFinite(entry.runtime)){\r\n    const runtimeText = entry.type === 'tv' ? `${entry.runtime} min/ep` : formatRuntime(entry.runtime);\r\n    primary.push({ text: runtimeText, label: entry.type === 'tv' ? 'Episode runtime' : 'Runtime' });\r\n  }\r\n  if(entry.certification){\r\n    primary.push({ text: entry.certification, label: 'Certification', kind: 'certification' });\r\n  }\r\n  if(primary.length) rows.push(primary);\r\n\r\n  const secondary = [];\r\n  if(entry.rating != null){\r\n    const ratingValue = formatRating(entry.rating);\r\n    secondary.push({ text: `\u2605 ${ratingValue}`, label: `Average rating ${ratingValue} out of 10`, kind: 'rating' });\r\n  }\r\n  if(entry.voteCount != null){\r\n    const votes = NUMBER_FORMAT.format(entry.voteCount);\r\n    secondary.push({ text: `${votes} votes`, label: `${votes} votes recorded` });\r\n  }\r\n  if(entry.type === 'tv'){\r\n    const parts = [];\r\n    if(Number.isFinite(entry.seasons) && entry.seasons > 0){\r\n      parts.push(`${entry.seasons} ${entry.seasons === 1 ? 'Season' : 'Seasons'}`);\r\n    }\r\n    if(Number.isFinite(entry.episodes) && entry.episodes > 0){\r\n      parts.push(`${entry.episodes} ${entry.episodes === 1 ? 'Episode' : 'Episodes'}`);\r\n    }\r\n    if(parts.length){\r\n      secondary.push({ text: parts.join(' \u2022 '), label: 'Episode availability' });\r\n    }\r\n  }\r\n  if(secondary.length) rows.push(secondary);\r\n\r\n  const tertiary = [];\r\n  if(Array.isArray(entry.genres)){\r\n    entry.genres.slice(0, 3).forEach(genre => {\r\n      const text = typeof genre === 'string' ? genre : '';\r\n      if(text) tertiary.push({ text, label: `Genre: ${text}` });\r\n    });\r\n  }\r\n  if(tertiary.length) rows.push(tertiary);\r\n\r\n  return rows;\r\n}\r\n\r\nfunction renderMetaRow(root, items){\r\n  if(!root){\r\n    return;\r\n  }\r\n  if(!items || !items.length){\r\n    root.innerHTML = '';\r\n    root.hidden = true;\r\n    return;\r\n  }\r\n  const fragment = document.createDocumentFragment();\r\n  items.forEach(item => {\r\n    const badge = document.createElement('span');\r\n    badge.className = 'hero__badge';\r\n    if(item.kind === 'certification') badge.classList.add('hero__badge--certification');\r\n    if(item.kind === 'rating') badge.classList.add('hero__badge--rating');\r\n    badge.textContent = item.text;\r\n    if(item.label) badge.setAttribute('aria-label', item.label);\r\n    fragment.appendChild(badge);\r\n  });\r\n  root.replaceChildren(fragment);\r\n  root.hidden = false;\r\n}\r\n\r\nfunction renderMedia(hero, picture, image, sourceLarge, sourceMedium, entry){\r\n  const backdrops = Array.isArray(entry.backdrops) ? entry.backdrops.filter(Boolean) : [];\r\n  const primary = backdrops[0] || '';\r\n  if(!picture || !image){\r\n    hero.classList.toggle('hero--has-media', Boolean(primary));\r\n    return;\r\n  }\r\n  if(!primary){\r\n    clearPicture(picture, image, sourceLarge, sourceMedium);\r\n    hero.classList.remove('hero--has-media');\r\n    return;\r\n  }\r\n  hero.classList.add('hero--has-media');\r\n  setSource(sourceLarge, primary);\r\n  setSource(sourceMedium, primary);\r\n  image.src = primary;\r\n  image.alt = entry.title ? `${entry.title} backdrop` : '';\r\n  image.removeAttribute('hidden');\r\n  picture.hidden = false;\r\n}\r\n\r\nfunction setSource(node, value){\r\n  if(!node) return;\r\n  if(value){\r\n    node.srcset = value;\r\n  } else {\r\n    node.removeAttribute('srcset');\r\n  }\r\n}\r\n\r\nfunction clearPicture(picture, image, sourceLarge, sourceMedium){\r\n  if(sourceLarge) sourceLarge.removeAttribute('srcset');\r\n  if(sourceMedium) sourceMedium.removeAttribute('srcset');\r\n  if(image){\r\n    image.removeAttribute('src');\r\n    image.setAttribute('hidden', '');\r\n  }\r\n  if(picture) picture.hidden = true;\r\n}\r\n\r\nfunction formatRuntime(minutes){\r\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\r\n  const hrs = Math.floor(minutes / 60);\r\n  const mins = Math.round(minutes % 60);\r\n  if(hrs && mins){\r\n    return `${hrs}h ${mins}m`;\r\n  }\r\n  if(hrs){\r\n    return `${hrs}h`;\r\n  }\r\n  return `${mins}m`;\r\n}\r\n\r\nfunction openHeroModal(entry){\r\n  const cta = entry?.cta;\r\n  const kind = cta?.kind || (entry.type === 'tv' ? 'show' : 'movie');\r\n  const id = cta?.id || entry.id;\r\n  if(!kind || !id) return;\r\n  navigateToItemHash(kind, id, cta?.target);\r\n  if(kind === 'show') openSeriesModalV2(id);\r\n  else openMovieModalV2(id);\r\n}\r\n\r\nfunction navigateToItemHash(kind, id, explicitTarget){\r\n  if(!kind || !id) return;\r\n  const hash = explicitTarget || `#/${kind}/${id}`;\r\n  const replace = (window.location.hash || '') === hash;\r\n  if(typeof navigateToHashHandler === 'function'){\r\n    try{\r\n      navigateToHashHandler(hash, { silent: true, replace });\r\n      return;\r\n    }catch(err){\r\n      console.warn('[hero] Failed to navigate via handler:', err?.message);\r\n    }\r\n  }\r\n  try{\r\n    window.location.hash = hash;\r\n  }catch(err){\r\n    console.warn('[hero] Failed to update hash directly:', err?.message);\r\n  }\r\n}\r\n", "import { refreshHero } from './hero.js';\r\nimport { getState, subscribe as subscribeState } from './state.js';\r\nimport * as HeroPipeline from './hero/pipeline.js';\r\n\r\nexport function initHeroAutoplay({ onRefresh = refreshHero } = {}){\r\n  const hero = document.getElementById('hero');\r\n  const timer = document.getElementById('heroTimer');\r\n  const bar = timer ? timer.querySelector('.hero-timer__bar') : null;\r\n  if(!hero || !timer || !bar) return null;\r\n  const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  if(reduce) { timer.hidden = true; return null; }\r\n  timer.removeAttribute('aria-hidden');\r\n  timer.dataset.state = 'running';\r\n\r\n  const DURATION = 15000; // 15s\r\n  const pauseReasons = new Set();\r\n  let wasPaused = false;\r\n  let elapsed = 0; // ms accumulated when not paused\r\n  let raf = null;\r\n  let lastTs = 0;\r\n  const pipelineEnabled = HeroPipeline.isEnabled();\r\n  let rotationKind = resolveKind();\r\n  let rotationItems = [];\r\n  let rotationIndex = 0;\r\n  let pipelinePaused = false;\r\n  let rotationSignature = '';\r\n  let unsubscribePipeline = null;\r\n  let unsubscribeState = null;\r\n\r\n  if(pipelineEnabled){\r\n    applyRotationPlan(HeroPipeline.getRotationPlan(rotationKind));\r\n    unsubscribePipeline = HeroPipeline.subscribe(() => {\r\n      applyRotationPlan(HeroPipeline.getRotationPlan(rotationKind));\r\n    });\r\n  }\r\n\r\n  unsubscribeState = subscribeState(() => {\r\n    const kind = resolveKind();\r\n    if(kind === rotationKind) return;\r\n    rotationKind = kind;\r\n    if(pipelineEnabled){\r\n      applyRotationPlan(HeroPipeline.getRotationPlan(rotationKind));\r\n    }\r\n  });\r\n\r\n  function resolveKind(){\r\n    const view = getState().view;\r\n    return view === 'shows' ? 'series' : 'movies';\r\n  }\r\n\r\n  function isPaused(){\r\n    return pauseReasons.size > 0;\r\n  }\r\n\r\n  function updatePausedState(){\r\n    const pausedNow = isPaused();\r\n    timer.dataset.state = pausedNow ? 'paused' : 'running';\r\n    if(wasPaused && !pausedNow){\r\n      lastTs = 0;\r\n    }\r\n    wasPaused = pausedNow;\r\n  }\r\n\r\n  function setPaused(reason, value){\r\n    if(value){\r\n      pauseReasons.add(reason);\r\n    }else{\r\n      pauseReasons.delete(reason);\r\n    }\r\n    updatePausedState();\r\n  }\r\n\r\n  function advanceRotation(){\r\n    if(!rotationItems.length) return null;\r\n    rotationIndex = (rotationIndex + 1) % rotationItems.length;\r\n    return rotationItems[rotationIndex];\r\n  }\r\n\r\n  function applyRotationPlan(plan){\r\n    if(!plan) return;\r\n    const items = Array.isArray(plan.items) ? plan.items : [];\r\n    const snapshot = plan.snapshot || HeroPipeline.getSnapshot();\r\n    const status = snapshot.status?.[rotationKind];\r\n    const busy = !HeroPipeline.isReady() || status?.regenerating;\r\n    const signature = `${rotationKind}:${status?.updatedAt || 0}:${items.length}`;\r\n    const hadItems = rotationItems.length > 0;\r\n    const previouslyPaused = pipelinePaused;\r\n\r\n    rotationItems = items;\r\n    rotationIndex = items.length ? (plan.startIndex % items.length) : 0;\r\n    pipelinePaused = busy || !items.length;\r\n    setPaused('pipeline', pipelinePaused);\r\n\r\n    if(!pipelinePaused && items.length){\r\n      if(!hadItems || previouslyPaused || rotationSignature !== signature){\r\n        try { onRefresh?.([items[rotationIndex]]); } catch (_err) {}\r\n        elapsed = 0;\r\n        bar.style.setProperty('--p', '0');\r\n      }\r\n    }\r\n\r\n    rotationSignature = signature;\r\n  }\r\n\r\n  function step(ts){\r\n    if(isPaused()){ lastTs = ts; raf = requestAnimationFrame(step); return; }\r\n    if(!lastTs) lastTs = ts;\r\n    const dt = Math.max(0, ts - lastTs);\r\n    lastTs = ts;\r\n    elapsed += dt;\r\n    const prog = Math.max(0, Math.min(1, elapsed / DURATION));\r\n    bar.style.setProperty('--p', String(prog));\r\n    if(prog >= 1){\r\n      // reset and ask app to refresh hero gently\r\n      elapsed = 0; lastTs = ts; bar.style.setProperty('--p','0');\r\n      try {\r\n        if(pipelineEnabled){\r\n          const next = advanceRotation();\r\n          if(next){ onRefresh?.([next]); }\r\n          else { onRefresh?.(); }\r\n        }else{\r\n          onRefresh?.();\r\n        }\r\n      } catch(_e) {\r\n        // no-op\r\n      }\r\n    }\r\n    raf = requestAnimationFrame(step);\r\n  }\r\n\r\n  function start(){ if(!raf) raf = requestAnimationFrame(step); }\r\n  // Pause on hover (without affecting layout)\r\n  hero.addEventListener('mouseenter', () => { setPaused('hover', true); });\r\n  hero.addEventListener('mouseleave', () => { setPaused('hover', false); });\r\n  document.addEventListener('visibilitychange', () => {\r\n    setPaused('hidden', document.hidden);\r\n  });\r\n\r\n  if(document.hidden){\r\n    setPaused('hidden', true);\r\n  } else {\r\n    updatePausedState();\r\n  }\r\n\r\n  start();\r\n\r\n  return {\r\n    pause(){ setPaused('manual', true); },\r\n    resume(){ setPaused('manual', false); },\r\n    reset(){ elapsed = 0; bar.style.setProperty('--p','0'); },\r\n    destroy(){\r\n      if(unsubscribePipeline) unsubscribePipeline();\r\n      if(unsubscribeState) unsubscribeState();\r\n    }\r\n  };\r\n}\r\n", "import { setState, getState } from './state.js';\r\nimport { showLoader, setLoader, hideLoader, showSkeleton, clearSkeleton } from './loader.js';\r\nimport * as Data from './data.js';\r\nimport * as Filter from './filter.js';\r\nimport { renderGrid } from './grid.js';\r\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\r\nimport { hydrateOptional } from './services/tmdb.js';\r\nimport * as Watch from './watchlist.js';\r\nimport * as Debug from './debug.js';\r\nimport { initErrorHandler, showError, showRetryableError } from './errorHandler.js';\r\nimport { initSettingsOverlay, setHeroRefreshHandler, setReduceMotionHandler } from './settingsOverlay.js';\r\nimport { refreshHero, setHeroNavigation, showHeroFallback } from './hero.js';\r\nimport { initHeroAutoplay } from './hero-autoplay.js';\r\nimport * as HeroPolicy from './hero/policy.js';\r\nimport * as HeroPipeline from './hero/pipeline.js';\r\nimport { syncDefaultMetadataService } from './metadataService.js';\r\n\r\nconst DEFAULT_FEATURE_FLAGS = { tmdbEnrichment: false };\r\nconst globalFeatures = (()=>{\r\n  const existing = typeof window !== 'undefined' && window.FEATURES ? window.FEATURES : {};\r\n  const merged = { ...DEFAULT_FEATURE_FLAGS, ...existing };\r\n  if(typeof window !== 'undefined'){\r\n    window.FEATURES = merged;\r\n  }\r\n  return merged;\r\n})();\r\n\r\nfunction applyFeatureFlags(cfg){\r\n  try{\r\n    if(globalFeatures){\r\n      globalFeatures.tmdbEnrichment = !!(cfg && cfg.tmdbEnabled);\r\n    }\r\n    if(typeof window !== 'undefined' && window.FEATURES && window.FEATURES !== globalFeatures){\r\n      window.FEATURES = { ...window.FEATURES, ...globalFeatures };\r\n    }\r\n  }catch(err){\r\n    console.warn('[main] Failed to apply feature flags:', err?.message || err);\r\n  }\r\n}\r\n\r\nlet taglineTicker = null;\r\nconst heroFallbackNotice = { reason: null };\r\n\r\nconst HERO_FALLBACK_MESSAGES = {\r\n  'rate-limit': () => showError('TMDb drosselt Anfragen', 'Highlights werden kurzzeitig langsamer aktualisiert.'),\r\n  error: detail => showError('Highlights vor\u00FCbergehend nicht verf\u00FCgbar', detail?.status?.lastError || 'TMDb-Daten konnten nicht geladen werden.'),\r\n  default: () => showError('Highlights vor\u00FCbergehend nicht verf\u00FCgbar', 'TMDb-Daten konnten nicht geladen werden.')\r\n};\r\n\r\nfunction announceHeroFallback(reason, detail){\r\n  if(heroFallbackNotice.reason === reason) return;\r\n  heroFallbackNotice.reason = reason;\r\n  const handler = HERO_FALLBACK_MESSAGES[reason] || HERO_FALLBACK_MESSAGES.default;\r\n  try {\r\n    handler(detail);\r\n  } catch (err) {\r\n    console.warn('[main] Failed to show hero fallback notification:', err?.message || err);\r\n  }\r\n}\r\n\r\nconst hashNavigation = (() => {\r\n  let lastHash = window.location.hash || '';\r\n  let suppressedHash = null;\r\n\r\n  function normalizeHash(raw){\r\n    if(typeof raw !== 'string') return '';\r\n    const trimmed = raw.trim();\r\n    if(!trimmed) return '';\r\n    return trimmed.startsWith('#') ? trimmed : `#${trimmed}`;\r\n  }\r\n\r\n  function updateHash(targetHash, options={}){\r\n    const { replace=false, silent=false } = options;\r\n    const hash = normalizeHash(targetHash);\r\n    if(!hash) return;\r\n\r\n    const current = window.location.hash || '';\r\n    if(hash === current){\r\n      if(replace && history && typeof history.replaceState === 'function'){\r\n        try{\r\n          history.replaceState(null, '', hash);\r\n        }catch(err){\r\n          console.warn('[main] Failed to replace hash via history:', err.message);\r\n        }\r\n      }\r\n      if(silent){\r\n        suppressedHash = hash;\r\n        lastHash = hash;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const method = replace ? 'replaceState' : 'pushState';\r\n    let usedHistory = false;\r\n    try{\r\n      if(history && typeof history[method] === 'function'){\r\n        history[method](null, '', hash);\r\n        usedHistory = true;\r\n      }\r\n    }catch(err){\r\n      console.warn(`[main] Failed to ${replace ? 'replace' : 'push'} hash via history:`, err.message);\r\n    }\r\n\r\n    if(!usedHistory){\r\n      window.location.hash = hash;\r\n      if(silent){\r\n        suppressedHash = hash;\r\n        lastHash = hash;\r\n      }\r\n      return;\r\n    }\r\n\r\n    if(silent){\r\n      suppressedHash = hash;\r\n      lastHash = hash;\r\n      return;\r\n    }\r\n\r\n    try{\r\n      const event = typeof HashChangeEvent === 'function' ? new HashChangeEvent('hashchange') : new Event('hashchange');\r\n      window.dispatchEvent(event);\r\n    }catch(err){\r\n      console.warn('[main] Failed to dispatch hashchange event:', err.message);\r\n    }\r\n  }\r\n\r\n  function shouldHandle(hash){\r\n    const current = typeof hash === 'string' ? hash : '';\r\n    if(suppressedHash && current === suppressedHash){\r\n      suppressedHash = null;\r\n      return false;\r\n    }\r\n    suppressedHash = null;\r\n    if(current === lastHash) return false;\r\n    lastHash = current;\r\n    return true;\r\n  }\r\n\r\n  function markProcessed(hash){\r\n    lastHash = typeof hash === 'string' ? hash : '';\r\n    suppressedHash = null;\r\n  }\r\n\r\n  return { navigate: updateHash, shouldHandle, markProcessed };\r\n})();\r\n\r\nexport const navigateToHash = (hash, options) => hashNavigation.navigate(hash, options);\r\n\r\nsetHeroNavigation(navigateToHash);\r\n\r\nfunction refreshHeroWithPipeline(listOverride){\r\n  if(Array.isArray(listOverride) && listOverride.length){\r\n    heroFallbackNotice.reason = null;\r\n    refreshHero(listOverride);\r\n    return;\r\n  }\r\n  if(HeroPipeline.isEnabled()){\r\n    const currentView = getState().view === 'shows' ? 'series' : 'movies';\r\n    const plan = HeroPipeline.getRotationPlan(currentView);\r\n    const status = plan?.snapshot?.status?.[currentView];\r\n    const ready = HeroPipeline.isReady();\r\n    const busy = status?.regenerating;\r\n    const items = Array.isArray(plan?.items) ? plan.items : [];\r\n    const tmdbRateLimit = plan?.snapshot?.tmdb?.rateLimit;\r\n    const rateLimited = !!tmdbRateLimit?.active;\r\n    const pipelineError = status?.state === 'error';\r\n    const shouldFallback = (!items.length && (pipelineError || (rateLimited && ready && !busy)));\r\n    if(shouldFallback){\r\n      const reason = pipelineError ? 'error' : 'rate-limit';\r\n      const applied = showHeroFallback(reason);\r\n      if(applied){\r\n        announceHeroFallback(reason, { status, rateLimit: tmdbRateLimit });\r\n      }\r\n      return;\r\n    }\r\n    if(ready && !busy && items.length){\r\n      const index = plan.startIndex % items.length;\r\n      const entry = items[index];\r\n      if(entry){\r\n        heroFallbackNotice.reason = null;\r\n        refreshHero([entry]);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n  heroFallbackNotice.reason = null;\r\n  refreshHero(listOverride);\r\n}\r\n\r\nfunction setFooterStatus(message, busy=true){\r\n  const footer = document.getElementById('footerMeta');\r\n  if(footer){\r\n    const status = footer.querySelector('#footerStatus');\r\n    if(status) status.textContent = message;\r\n    else footer.textContent = message;\r\n    footer.dataset.state = busy ? 'loading' : 'ready';\r\n  }\r\n  const grid = document.getElementById('grid');\r\n  if(grid){\r\n    grid.setAttribute('aria-busy', busy ? 'true' : 'false');\r\n  }\r\n}\r\n\r\nexport async function boot(){\r\n  const isTestEnv = !!globalThis.__PLEX_TEST_MODE__;\r\n  initErrorHandler();\r\n  applyReduceMotionPref();\r\n  showLoader();\r\n  setFooterStatus('Initialisiere \u2026', true);\r\n  setLoader('Initialisiere \u2026', 8);\r\n  showSkeleton(18);\r\n\r\n  const configPromise = fetch('config.json').then(r=>r.json()).catch((err)=>{\r\n    console.warn('[main] Failed to load config.json, using defaults:', err.message);\r\n    showError('Konfiguration konnte nicht geladen werden', 'Verwende Standardeinstellungen');\r\n    return { startView:'movies', tmdbEnabled:false };\r\n  });\r\n  const policyPromise = HeroPolicy.initHeroPolicy().catch((err)=>{\r\n    console.warn('[main] Failed to initialise hero policy:', err?.message || err);\r\n    return HeroPolicy.getHeroPolicy();\r\n  });\r\n\r\n  const [cfg, heroPolicy] = await Promise.all([configPromise, policyPromise]);\r\n  applyFeatureFlags(cfg);\r\n  syncDefaultMetadataService(cfg);\r\n  const heroPipelineInfo = HeroPipeline.configure({ cfg, policy: heroPolicy });\r\n  setState({\r\n    cfg,\r\n    view: cfg.startView || 'movies',\r\n    heroPolicy,\r\n    heroPolicyIssues: HeroPolicy.getValidationIssues(),\r\n    heroPipelineEnabled: heroPipelineInfo.enabled,\r\n    heroPipelineSource: heroPipelineInfo.source\r\n  });\r\n\r\n  try {\r\n    setFooterStatus('Filme laden \u2026', true);\r\n    setLoader('Filme laden \u2026', 25);\r\n    const movies = await Data.loadMovies();\r\n    setFooterStatus('Serien laden \u2026', true);\r\n    setLoader('Serien laden \u2026', 45);\r\n    const shows  = await Data.loadShows();\r\n\r\n    setFooterStatus('Filter vorbereiten \u2026', true);\r\n    setLoader('Filter vorbereiten \u2026', 60);\r\n    // build facets (richer set via Filter)\r\n    const facets = Filter.computeFacets(movies, shows);\r\n    setState({ movies, shows, facets });\r\n    HeroPipeline.setSources({ movies, shows });\r\n    HeroPipeline.setActiveView(getState().view);\r\n\r\n    if(HeroPipeline.isEnabled()){\r\n      setFooterStatus('Highlights vorbereiten \u2026', true);\r\n      setLoader('Highlights vorbereiten \u2026', 70);\r\n      try {\r\n        await HeroPipeline.primeAll();\r\n      } catch (err) {\r\n        console.warn('[main] Hero pipeline initial prime failed:', err?.message || err);\r\n      }\r\n    }\r\n\r\n    setFooterStatus('Ansicht aufbauen \u2026', true);\r\n    setLoader('Ansicht aufbauen \u2026', 85);\r\n    clearSkeleton();\r\n    renderSwitch();\r\n    Filter.renderFacets(facets);\r\n    Filter.initFilters();\r\n    const filtered = Filter.applyFilters();\r\n    renderStats(true);\r\n    renderGrid(getState().view);\r\n    renderFooterMeta();\r\n\r\n    hideLoader();\r\n\r\n    if(cfg.tmdbEnabled){\r\n      if(window.requestIdleCallback){\r\n        window.requestIdleCallback(()=> hydrateOptional?.(movies, shows, cfg), { timeout: 600 });\r\n      }else{\r\n        setTimeout(()=> hydrateOptional?.(movies, shows, cfg), 400);\r\n      }\r\n    }\r\n\r\n    if(!isTestEnv){\r\n      Watch.initUi();\r\n      initSettingsOverlay(cfg);\r\n      initAdvancedToggle();\r\n      initHeaderInteractions();\r\n      initScrollProgress();\r\n      initScrollTop();\r\n      initFilterBarAutoHideFallback();\r\n      refreshHeroWithPipeline(filtered);\r\n      initHeroAutoplay({ onRefresh: refreshHeroWithPipeline });\r\n      Debug.initDebugUi();\r\n    }else{\r\n      try{\r\n        refreshHeroWithPipeline(filtered);\r\n      }catch(err){\r\n        console.warn('[main] Test env hero refresh skipped:', err?.message || err);\r\n      }\r\n    }\r\n    handleHashChange(true);\r\n  } catch (error) {\r\n    console.error('[main] Boot failed:', error);\r\n    hideLoader();\r\n    clearSkeleton();\r\n    showRetryableError('Fehler beim Laden der Daten', () => window.location.reload());\r\n    throw error;\r\n  }\r\n  // Re-render grid on TMDB hydration progress to reveal new posters/data\r\n  // Note: Grid cards only re-render if user has enabled TMDB images\r\n  // Hero banner always uses TMDB data when credentials are available\r\n  let tmdbRaf;\r\n  window.addEventListener('tmdb:chunk', ()=>{\r\n    if(tmdbRaf) return; // throttle to animation frame\r\n    tmdbRaf = requestAnimationFrame(()=>{\r\n      tmdbRaf = null;\r\n      try{\r\n        const useTmdbCards = localStorage.getItem('useTmdb')==='1';\r\n        if(useTmdbCards){\r\n          renderGrid(getState().view);\r\n        }\r\n        // Always refresh hero when new TMDB data arrives (hero uses TMDB automatically)\r\n        refreshHeroWithPipeline();\r\n      }catch(err){\r\n        console.warn('[main] TMDB chunk render failed:', err.message);\r\n      }\r\n    });\r\n  });\r\n  window.addEventListener('tmdb:done', ()=>{\r\n    try{\r\n      const useTmdbCards = localStorage.getItem('useTmdb')==='1';\r\n      if(useTmdbCards){\r\n        renderGrid(getState().view);\r\n      }\r\n      // Always refresh hero when TMDB hydration is complete\r\n      refreshHeroWithPipeline();\r\n    }catch(err){\r\n      console.warn('[main] TMDB done render failed:', err.message);\r\n    }\r\n  });\r\n}\r\n\r\n// Debounced hashchange handler to prevent race conditions\r\nlet hashchangeTimeout = null;\r\n\r\nfunction applyHashNavigation(hash){\r\n  if(/^#\\/(movies|shows)$/.test(hash)){\r\n    const view = hash.includes('shows') ? 'shows' : 'movies';\r\n    setState({ view });\r\n    HeroPipeline.setActiveView(view);\r\n    HeroPipeline.ensureKind(view === 'shows' ? 'series' : 'movies').catch(err => {\r\n      console.warn('[main] Failed to ensure hero pool on hash navigation:', err?.message || err);\r\n    });\r\n    const result = Filter.applyFilters();\r\n    renderSwitch();\r\n    renderGrid(view);\r\n    refreshHeroWithPipeline(result);\r\n    return true;\r\n  }\r\n  const match = hash.match(/^#\\/(movie|show)\\/(.+)/);\r\n  if(!match) return false;\r\n  const [, kind, id ] = match;\r\n  const pool = kind === 'movie' ? getState().movies : getState().shows;\r\n  const item = (pool||[]).find(x => (x?.ids?.imdb===id || x?.ids?.tmdb===id || String(x?.ratingKey)===id));\r\n  if(!item) return false;\r\n  if(kind === 'show') openSeriesModalV2(item);\r\n  else openMovieModalV2(item);\r\n  return true;\r\n}\r\n\r\nfunction handleHashChange(force=false){\r\n  const currentHash = window.location.hash || '';\r\n  if(!force && !hashNavigation.shouldHandle(currentHash)) return;\r\n  if(force) hashNavigation.markProcessed(currentHash);\r\n  applyHashNavigation(currentHash);\r\n}\r\n\r\nwindow.addEventListener('hashchange', ()=>{\r\n  if(hashchangeTimeout){\r\n    clearTimeout(hashchangeTimeout);\r\n  }\r\n  hashchangeTimeout = setTimeout(()=>{\r\n    handleHashChange(false);\r\n  }, 50);\r\n});\r\n\r\nfunction renderSwitch(){\r\n  const root = document.getElementById('libraryTabs');\r\n  if(!root) return;\r\n  const buttons = Array.from(root.querySelectorAll('[data-lib]'));\r\n  const current = getState().view === 'shows' ? 'shows' : 'movies';\r\n  buttons.forEach(btn => {\r\n    const target = btn.dataset.lib === 'series' ? 'shows' : 'movies';\r\n    const isActive = current === target;\r\n    btn.classList.toggle('is-active', isActive);\r\n    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n    if(btn.dataset.bound === 'true') return;\r\n    btn.addEventListener('click', () => {\r\n      const view = btn.dataset.lib === 'series' ? 'shows' : 'movies';\r\n      if(getState().view === view) return;\r\n      setState({ view });\r\n      HeroPipeline.setActiveView(view);\r\n      if(HeroPipeline.isEnabled()){\r\n        const ensure = HeroPipeline.ensureKind(view === 'shows' ? 'series' : 'movies');\r\n        if(ensure && typeof ensure.catch === 'function'){\r\n          ensure.catch(err => {\r\n            console.warn('[main] Failed to ensure hero pool on view switch:', err?.message || err);\r\n          });\r\n        }\r\n      }\r\n      const target = view === 'movies' ? '#/movies' : '#/shows';\r\n      navigateToHash(target, { silent: true });\r\n      renderSwitch();\r\n      const result = Filter.applyFilters();\r\n      renderGrid(view);\r\n      refreshHeroWithPipeline(result);\r\n    });\r\n    btn.dataset.bound = 'true';\r\n  });\r\n}\r\n\r\nfunction renderStats(animate=false){\r\n  const root = document.getElementById('heroStats');\r\n  if(!root) return;\r\n  const s = getState();\r\n  const movies = (s.movies||[]).length;\r\n  const shows = (s.shows||[]).length;\r\n  const elM = root.querySelector('[data-stat=\"movies\"]');\r\n  const elS = root.querySelector('[data-stat=\"shows\"]');\r\n  if(!elM || !elS) return;\r\n  if(animate){ countTo(elM, movies); countTo(elS, shows); }\r\n  else { elM.textContent=String(movies); elS.textContent=String(shows); }\r\n}\r\n\r\nfunction countTo(el, target){\r\n  if(!el) return;\r\n  const start = Number(el.textContent)||0;\r\n  const end = Number(target)||0;\r\n  if(start===end){ el.textContent = String(end); return; }\r\n  const dur = 480; // ms\r\n  const t0 = performance.now();\r\n  function step(t){\r\n    const p = Math.min(1, (t - t0) / dur);\r\n    const val = Math.round(start + (end - start) * (p<0.5 ? 2*p*p : -1 + (4 - 2*p) * p));\r\n    el.textContent = String(val);\r\n    if(p < 1) requestAnimationFrame(step); else el.textContent = String(end);\r\n  }\r\n  requestAnimationFrame(step);\r\n}\r\n\r\nfunction renderFooterMeta(){\r\n  const el = document.getElementById('footerMeta');\r\n  if(!el) return;\r\n  const status = document.getElementById('footerStatus');\r\n  const s = getState();\r\n  const movies = (s.movies||[]); const shows=(s.shows||[]);\r\n  const times = movies.concat(shows).map(x=> new Date(x.addedAt||0).getTime()).filter(Number.isFinite);\r\n  const latest = times.length ? new Date(Math.max(...times)) : new Date();\r\n  const date = latest.toISOString().slice(0,10);\r\n  if(status){\r\n    status.textContent = `Stand: ${date}`;\r\n  }\r\n  el.dataset.state = 'ready';\r\n  const grid = document.getElementById('grid');\r\n  if(grid){ grid.setAttribute('aria-busy', 'false'); }\r\n}\r\n\r\nFilter.setFiltersUpdatedHandler(items => {\r\n  try{\r\n    refreshHeroWithPipeline(items);\r\n  }catch(err){\r\n    console.warn('[main] Failed to refresh hero from filters handler:', err?.message);\r\n  }\r\n});\r\n\r\nsetHeroRefreshHandler(items => {\r\n  try{\r\n    refreshHeroWithPipeline(items);\r\n  }catch(err){\r\n    console.warn('[main] Failed to refresh hero from settings handler:', err?.message);\r\n  }\r\n});\r\n\r\nsetReduceMotionHandler(enabled => {\r\n  try{\r\n    setReduceMotionClass(!!enabled);\r\n  }catch(err){\r\n    console.warn('[main] Failed to apply reduce motion setting from handler:', err?.message);\r\n  }\r\n});\r\n\r\nif(!globalThis.__PLEX_TEST_MODE__){\r\n  boot();\r\n}\r\n\r\n// Fallback: ensure the loading overlay is not left visible\r\n// in case an error interrupts the boot sequence.\r\nwindow.addEventListener('load', ()=>{\r\n  try{\r\n    hideLoader();\r\n  }catch(err){\r\n    console.warn('[main] Failed to hide loader on load event:', err.message);\r\n  }\r\n});\r\n\r\nfunction setReduceMotionClass(pref){\r\n  try{\r\n    const body = document.body;\r\n    if(body){\r\n      document.documentElement?.classList.remove('reduce-motion', 'reduced-motion');\r\n      body.classList.remove('reduced-motion');\r\n      body.classList.toggle('reduce-motion', pref);\r\n    } else {\r\n      document.documentElement?.classList.toggle('reduce-motion', pref);\r\n      window.addEventListener('DOMContentLoaded', ()=> setReduceMotionClass(pref), { once: true });\r\n    }\r\n  }catch(err){\r\n    console.warn('[main] Failed to update reduce motion class:', err.message);\r\n  }\r\n}\r\n\r\nfunction applyReduceMotionPref(){\r\n  try{\r\n    const pref = localStorage.getItem('prefReduceMotion')==='1';\r\n    setReduceMotionClass(pref);\r\n  }catch(err){\r\n    console.warn('[main] Failed to apply reduce motion preference:', err.message);\r\n  }\r\n}\r\n\r\nfunction initAdvancedToggle(){\r\n  const btn = document.getElementById('toggleAdvanced');\r\n  const panel = document.getElementById('advancedFilters');\r\n  if(!btn || !panel) return;\r\n  let animating = false;\r\n  let fallbackTimer = 0;\r\n\r\n  const finishAnimation = ()=>{\r\n    animating = false;\r\n    if(fallbackTimer){\r\n      clearTimeout(fallbackTimer);\r\n      fallbackTimer = 0;\r\n    }\r\n    if(panel.dataset.state === 'closing'){\r\n      panel.dataset.state = 'closed';\r\n      panel.hidden = true;\r\n      panel.style.removeProperty('--advanced-max');\r\n    }else if(panel.dataset.state === 'open'){\r\n      panel.style.removeProperty('--advanced-max');\r\n    }else if(panel.dataset.state === 'expanding'){\r\n      panel.dataset.state = 'open';\r\n      panel.style.removeProperty('--advanced-max');\r\n    }\r\n  };\r\n\r\n  const queueFinish = ()=>{\r\n    if(fallbackTimer){\r\n      clearTimeout(fallbackTimer);\r\n    }\r\n    fallbackTimer = window.setTimeout(finishAnimation, 320);\r\n  };\r\n\r\n  panel.addEventListener('transitionend', event=>{\r\n    if(event.target !== panel || event.propertyName !== 'max-height') return;\r\n    finishAnimation();\r\n  });\r\n\r\n  const openPanel = ()=>{\r\n    if(animating) return;\r\n    animating = true;\r\n    panel.hidden = false;\r\n    panel.dataset.state = 'expanding';\r\n    panel.setAttribute('aria-hidden', 'false');\r\n    panel.style.setProperty('--advanced-max', '0px');\r\n    requestAnimationFrame(()=>{\r\n      const height = panel.scrollHeight;\r\n      panel.style.setProperty('--advanced-max', height + 'px');\r\n      panel.dataset.state = 'open';\r\n      queueFinish();\r\n    });\r\n  };\r\n\r\n  const closePanel = ()=>{\r\n    if(animating) return;\r\n    animating = true;\r\n    const height = panel.scrollHeight;\r\n    panel.style.setProperty('--advanced-max', height + 'px');\r\n    panel.dataset.state = 'closing';\r\n    panel.setAttribute('aria-hidden', 'true');\r\n    requestAnimationFrame(()=>{\r\n      panel.style.setProperty('--advanced-max', '0px');\r\n      queueFinish();\r\n    });\r\n  };\r\n\r\n  btn.addEventListener('click', ()=>{\r\n    const expanded = btn.getAttribute('aria-expanded') === 'true';\r\n    if(expanded){\r\n      btn.setAttribute('aria-expanded', 'false');\r\n      closePanel();\r\n    }else{\r\n      btn.setAttribute('aria-expanded', 'true');\r\n      openPanel();\r\n    }\r\n  });\r\n}\r\n\r\nfunction initHeaderInteractions(){\r\n  const siteLogo = document.getElementById('siteLogo');\r\n  if(siteLogo){\r\n    siteLogo.addEventListener('error', ()=>{\r\n      siteLogo.classList.add('logo-missing');\r\n      const titleEl = document.querySelector('.site-header__brand-text .site-header__label');\r\n      if(titleEl) titleEl.classList.remove('sr-only');\r\n    });\r\n  }\r\n  const subtitle = document.getElementById('heroTagline');\r\n  const TAGLINES = [\r\n    'Curated spotlights and smart filters for every mood.',\r\n    'Bring Plex highlights on the road with offline browsing.',\r\n    'Plan your next movie night with shareable watchlists.'\r\n  ];\r\n  let idx = 0;\r\n  if(subtitle && !subtitle.textContent){\r\n    subtitle.textContent = TAGLINES[idx];\r\n  }\r\n  function rotate(){\r\n    if(!subtitle || subtitle.dataset.taglinePaused === '1') return;\r\n    subtitle.classList.add('is-fading');\r\n    setTimeout(()=>{\r\n      if(!subtitle || subtitle.dataset.taglinePaused === '1'){ subtitle && subtitle.classList.remove('is-fading'); return; }\r\n      idx = (idx + 1) % TAGLINES.length;\r\n      subtitle.textContent = TAGLINES[idx];\r\n      subtitle.classList.remove('is-fading');\r\n    }, 280);\r\n  }\r\n  if(subtitle){\r\n    subtitle.dataset.taglinePaused = subtitle.dataset.taglinePaused === '1' ? '1' : '0';\r\n    if(taglineTicker){\r\n      clearInterval(taglineTicker);\r\n    }\r\n    taglineTicker = setInterval(rotate, 6000);\r\n    setTimeout(rotate, 3000);\r\n  }else if(taglineTicker){\r\n    clearInterval(taglineTicker);\r\n    taglineTicker = null;\r\n  }\r\n}\r\n\r\nfunction initScrollProgress(){\r\n  const bar = document.getElementById('scrollProgress');\r\n  if(!bar) return;\r\n  const update = ()=>{\r\n    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop || 0;\r\n    const height = (document.documentElement.scrollHeight - document.documentElement.clientHeight) || 1;\r\n    const pct = Math.max(0, Math.min(100, (scrollTop/height)*100));\r\n    bar.style.width = pct + '%';\r\n  };\r\n  addEventListener('scroll', update, { passive:true });\r\n  update();\r\n}\r\n\r\nfunction initScrollTop(){\r\n  const btn = document.getElementById('scrollTop');\r\n  if(!btn) return;\r\n  const toggle = ()=>{ const y = window.scrollY||0; btn.style.display = y>300 ? 'block' : 'none'; };\r\n  addEventListener('scroll', toggle, { passive:true });\r\n  toggle();\r\n  btn.addEventListener('click', ()=> window.scrollTo({ top:0, behavior:'smooth' }));\r\n}\r\n\r\nfunction initFilterBarAutoHideFallback(){\r\n  const filters = document.querySelector('.filters');\r\n  if(!filters) return;\r\n\r\n  const supportsScrollTimeline = typeof CSS !== 'undefined'\r\n    && typeof CSS.supports === 'function'\r\n    && CSS.supports('animation-timeline: scroll()');\r\n\r\n  if(supportsScrollTimeline) return;\r\n\r\n  let lastY = window.scrollY || window.pageYOffset || 0;\r\n  let isHidden = false;\r\n  let ticking = false;\r\n  const MIN_SCROLL = 120;\r\n  const DELTA_HIDE = 8;\r\n\r\n  const setHidden = (nextHidden)=>{\r\n    if(isHidden === nextHidden) return;\r\n    isHidden = nextHidden;\r\n    filters.classList.toggle('is-hidden', isHidden);\r\n  };\r\n\r\n  const update = ()=>{\r\n    ticking = false;\r\n    const currentY = window.scrollY || window.pageYOffset || 0;\r\n\r\n    if(currentY <= MIN_SCROLL){\r\n      setHidden(false);\r\n      lastY = currentY;\r\n      return;\r\n    }\r\n\r\n    const delta = currentY - lastY;\r\n    lastY = currentY;\r\n\r\n    if(delta > DELTA_HIDE){\r\n      setHidden(true);\r\n    }else if(delta < -DELTA_HIDE){\r\n      setHidden(false);\r\n    }\r\n  };\r\n\r\n  const onScroll = ()=>{\r\n    if(ticking) return;\r\n    ticking = true;\r\n    requestAnimationFrame(update);\r\n  };\r\n\r\n  window.addEventListener('scroll', onScroll, { passive:true });\r\n  window.addEventListener('resize', update);\r\n\r\n  const reveal = ()=> setHidden(false);\r\n  filters.addEventListener('focusin', reveal);\r\n  filters.addEventListener('pointerenter', reveal, { passive:true });\r\n  filters.addEventListener('pointerdown', reveal, { passive:true });\r\n\r\n  update();\r\n}\r\n"],
  "mappings": "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",
  "names": ["setState", "patch", "S", "listeners", "fn", "subscribe", "getState", "init_state", "__esmMin", "el", "tag", "cls", "content", "n", "qs", "init_dom", "__esmMin", "s", "r", "ensure", "overlay", "qs", "el", "box", "msgEl", "bar", "showLoader", "setLoader", "msg", "p", "hideLoader", "showSkeleton", "count", "grid", "skeletonRoot", "i", "clearSkeleton", "init_loader", "__esmMin", "init_dom", "setCache", "key", "value", "ttl", "cacheKey", "CACHE_PREFIX", "item", "checkCacheSize", "error", "cleanOldestEntries", "getCache", "cached", "now", "clearAllCache", "clearExpiredCache", "keys", "cleared", "getCacheStats", "cacheKeys", "k", "totalSize", "validEntries", "expiredEntries", "stats", "percentage", "cacheEntries", "a", "b", "toRemove", "i", "cleanupInterval", "init_cache", "__esmMin", "isPlainObject", "value", "matchesType", "type", "validateAgainstSchema", "schema", "path", "expectedTypes", "expected", "item", "index", "required", "key", "prop", "properties", "definition", "ensureArrayOfStrings", "list", "cloneWithDefaults", "entry", "defaults", "result", "defaultValue", "isMovieEntry", "ratingKey", "isShowEntry", "season", "sanitizeMovieEntry", "MOVIE_DEFAULTS", "thumbValue", "thumbFileValue", "sanitizeShowEntry", "SHOW_DEFAULTS", "seasonCopy", "episode", "validateLibraryList", "data", "kind", "SHOW_LIST_SCHEMA", "MOVIE_LIST_SCHEMA", "guard", "sanitizer", "MOVIE_ITEM_SCHEMA", "SEASON_SCHEMA", "SHOW_ITEM_SCHEMA", "init_validators", "__esmMin", "errorHandler_exports", "__export", "clearErrors", "initErrorHandler", "showError", "showRetryableError", "withErrorHandling", "errorContainer", "event", "_a", "title", "message", "duration", "errorEl", "escapeHtml", "fn", "errorTitle", "args", "error", "retryFn", "retryBtn", "closeBtn", "str", "div", "init_errorHandler", "__esmMin", "fetchJson", "url", "retries", "useCache", "cached", "getCache", "lastError", "attempt", "r", "data", "setCache", "DATA_CACHE_TTL", "err", "delay", "resolve", "message", "error", "embeddedJsonById", "id", "n", "fromGlobalBag", "key", "bag", "globalExporterBag", "fromWindow", "varName", "loadWithCompat", "primaryUrl", "opts", "markSource", "emb", "win", "alt", "altData", "notifyUiError", "title", "mod", "_a", "prefixThumbValue", "value", "base", "raw", "SCHEME_RE", "normalizedRaw", "normalizedBase", "decodeWarned", "encodePath", "path", "segment", "segments", "normalizedSegments", "normalizedPath", "relativeSegments", "baseDir", "cleaned", "encoded", "prefixThumb", "obj", "_b", "current", "prefixed", "str", "prefixMovieThumb", "MOVIE_THUMB_BASE", "prefixShowThumb", "SHOW_THUMB_BASE", "prefixShowTree", "show", "prefixSeasonTree", "season", "ep", "normalizeMovieThumbs", "list", "item", "normalizeShowThumbs", "loadMovies", "rawMovies", "movies", "validateLibraryList", "validationError", "loadShows", "rawShows", "shows", "loadShowDetail", "keys", "cacheKeys", "getCachedDetail", "urls", "detailUrlCandidates", "normalized", "normalizeShowDetail", "storeDetail", "cloneDetail", "label", "src", "lastSources", "getSources", "href", "normalizeHrefKey", "showDetailCache", "val", "rk", "detailKey", "detailHref", "hrefKey", "withoutData", "idPart", "normalizeGenres", "castList", "normalizePeople", "normalizeSeason", "out", "normalizeEpisode", "seen", "result", "entry", "tag", "detail", "EXPORTER_BAG_KEY", "init_data", "__esmMin", "init_cache", "init_validators", "utils_exports", "__export", "clearHeroCache", "collectionTags", "enableMoreChipBehavior", "formatRating", "getGenreNames", "humanYear", "isNew", "renderChipsLimited", "useTmdbForCards", "useTmdbForHero", "useTmdbOn", "genres", "seen", "names", "entry", "name", "str", "container", "values", "limit", "vals", "head", "rest", "chips", "text", "chip", "more", "root", "btn", "e", "card", "hidden", "ch", "item", "candidates", "value", "match", "val", "trimmed", "num", "s", "added", "cfg", "getState", "days", "hasTmdbCredentials", "_a", "_b", "token", "state", "backup", "heroKeys", "k", "tmdbCacheKeys", "key", "err", "init_utils", "__esmMin", "init_state", "load", "saved", "STORAGE_KEY", "persist", "idFor", "item", "_a", "_b", "kind", "id", "isSaved", "count", "toggle", "k", "renderCount", "panel", "renderPanel", "el", "openPanel", "p", "closePanel", "setExpanded", "clear", "exportJson", "items", "listItems", "data", "blob", "a", "s", "getState", "pool", "map", "it", "list", "empty", "frag", "li", "t", "rm", "open", "initUi", "openBtn", "toggleBtn", "closeBtn", "clearBtn", "exportBtn", "on", "init_watchlist", "__esmMin", "init_state", "applyTabs", "root", "tabs", "buttons", "select", "target", "btn", "isActive", "pane", "moveFocus", "current", "delta", "currentIndex", "fallbackIndex", "index", "next", "ev", "last", "initial", "init_tabs", "__esmMin", "resolvePoster", "item", "_a", "_b", "tmdbPoster", "localPoster", "useTmdbOn", "runtimeText", "sources", "minutes", "value", "parsed", "ratingText", "rating", "formatRating", "studioText", "first", "company", "net", "entry", "buildChips", "chips", "isNew", "baseGenres", "tmdbGenres", "genres", "seen", "genre", "pickTagline", "tmdb", "pickContentRating", "pickBackdrop", "logoEntryToUrl", "logoEntryLanguage", "lang", "pickHeroLogo", "detail", "logos", "preferences", "pref", "match", "url", "sanitized", "sanitizeUrl", "pickLogo", "excludeUrl", "exclude", "candidates", "push", "str", "applyBackdrop", "root", "container", "reset", "img", "onLoad", "onError", "applyLogo", "slot", "logoUrl", "applyHeroLogo", "onReady", "ratingBucket", "pickRatingInfo", "_c", "tmdbVote", "fallback", "applyHeroMeta", "info", "chip", "label", "populateHead", "titleEl", "tagline", "metaEl", "subEl", "year", "humanYear", "runtime", "studio", "metaParts", "chipsRoot", "text", "span", "quickFacts", "quickList", "facts", "contentRating", "dt", "dd", "src", "onPosterReady", "heroLogo", "populateFooter", "ev", "buildFooterInitials", "name", "trimmed", "part", "createFallbackLogo", "initials", "ns", "svg", "rect", "createFooterLogoNode", "config", "FOOTER_TYPE_CONFIG", "baseLabel", "anchor", "TMDB_BASE_URL", "ariaSuffix", "buildFooterEntries", "entries", "pushEntry", "source", "type", "rawId", "id", "logoCandidates", "candidate", "keyParts", "key", "path", "link", "collectionSource", "footer", "logosRoot", "note", "fragment", "tmdbLink", "strong", "init_headerSection", "__esmMin", "init_utils", "updateOverview", "root", "item", "_a", "_b", "pane", "tmdb", "local", "overview", "previousParagraph", "wasExpanded", "paragraph", "toggle", "setExpanded", "expanded", "badgeText", "determineLanguageBadge", "badge", "children", "cb", "source", "_c", "_d", "_e", "_f", "cfgLang", "original", "stateLang", "getPreferredLanguage", "state", "getState", "init_overviewSection", "__esmMin", "init_state", "releaseDateText", "item", "tmdb", "candidates", "raw", "str", "parsed", "iso", "year", "humanYear", "namesFromList", "source", "entry", "genresFromItem", "_a", "arr", "mapped", "tmdbCrew", "detail", "jobs", "jobSet", "names", "member", "mergeNameLists", "primary", "secondary", "seen", "result", "name", "trimmed", "contentRatingFromItem", "aggregateRatings", "ratings", "formatOptionalRating", "watchProviderGroups", "_b", "_c", "_d", "_e", "region", "getState", "map", "groups", "key", "label", "providers", "value", "formatRating", "num", "updateDetails", "root", "_f", "pane", "grid", "general", "release", "runtime", "runtimeText", "studio", "studioText", "certification", "numericSeasons", "seasonCount", "episodeCount", "sum", "season", "eps", "countries", "collections", "labels", "section", "heading", "list", "dt", "dd", "genres", "chips", "span", "crew", "directors", "writers", "producers", "creators", "groupsWrap", "group", "groupEl", "labelEl", "listEl", "provider", "itemEl", "logo", "networks", "network", "chip", "img", "spokenLanguages", "lang", "labelParts", "upperCode", "fallback", "init_detailsSection", "__esmMin", "init_utils", "init_headerSection", "init_state", "now", "hoursToMs", "hours", "num", "h", "safeParse", "raw", "safeStringify", "payload", "createStore", "storageKey", "STORAGE_KEY", "memory", "loaded", "load", "parsed", "next", "nowTs", "entry", "key", "expiresAt", "persist", "serialisable", "get", "set", "value", "ttlHours", "clear", "prefix", "target", "changed", "clearExpired", "size", "defaultStore", "createCacheStore", "options", "cacheStore_default", "init_cacheStore", "__esmMin", "delay", "ms", "resolve", "parseRetryAfter", "value", "num", "date", "computeRetryDelay", "attempt", "retryAfter", "DELAY_CAP", "factor", "BASE_DELAY", "normaliseAppend", "append", "str", "resolveCredential", "options", "_a", "_b", "_c", "_d", "preferred", "key", "token", "createRequestInit", "credential", "headers", "applyCredentialToUrl", "url", "u", "buildUrl", "path", "params", "config", "base", "DEFAULT_API_BASE", "cleanPath", "search", "language", "DEFAULT_LANGUAGE", "region", "DEFAULT_REGION", "fetchJson", "init", "retries", "MAX_RETRIES", "lastError", "response", "error", "err", "createTmdbClient", "cache", "store", "createCacheStore", "getCacheKey", "method", "sorted", "get", "opts", "requestParams", "baseAppend", "nextAppend", "combined", "authedUrl", "cacheKey", "cached", "data", "defaultClient", "init_tmdbClient", "__esmMin", "init_cacheStore", "normaliseBase", "base", "raw", "DEFAULT_IMAGE_BASE", "ensurePath", "path", "str", "buildUrl", "size", "cleaned", "encodeSvg", "svg", "pickBackground", "type", "pickForeground", "makeInitials", "text", "limit", "parts", "part", "fallbackSvg", "width", "height", "fontSize", "fontWeight", "radius", "background", "foreground", "content", "fallbackPoster", "title", "fallbackBackdrop", "fallbackProfile", "name", "fallbackLogo", "fallbackEpisode", "normaliseOptions", "options", "_a", "_b", "_c", "_d", "urlPoster", "imageBase", "DEFAULT_SIZES", "urlBackdrop", "urlProfile", "urlLogo", "urlEpisode", "init_imageHelper", "__esmMin", "normaliseOptions", "options", "DEFAULT_OPTIONS", "normaliseId", "id", "num", "str", "parsed", "scoreImage", "entry", "votes", "normaliseLanguage", "lang", "pickBestImage", "images", "preferredLanguages", "fallbackPath", "sorted", "a", "b", "language", "candidate", "extractCollection", "detail", "collection", "urlPoster", "urlBackdrop", "mapGenres", "list", "mapProductionCompanies", "company", "urlLogo", "mapProvider", "_a", "_b", "_c", "cfg", "name", "mapWatchProviderRegion", "regionData", "types", "mapped", "type", "mapWatchProviders", "payload", "results", "region", "data", "regionKey", "mappedRegion", "defaultRegion", "mapNetworks", "network", "mapSeasons", "season", "mapSpokenLanguages", "pickCharacter", "role", "r", "pickJob", "job", "j", "mapCredits", "rawCredits", "castSource", "crewSource", "cast", "person", "urlProfile", "makeInitials", "crew", "selectReleaseCertification", "priorityCountries", "country", "item", "candidates", "release", "typeA", "typeB", "dateA", "dateB", "getContentRatingDE", "cert", "german", "us", "buildImageCollection", "mapper", "mapMovieDetail", "_d", "posterPath", "backdropPath", "mapTvDetail", "_e", "mapSeasonDetail", "seasonDetail", "show", "episodes", "episode", "stillPath", "urlEpisode", "init_tmdbMapper", "__esmMin", "init_imageHelper", "normaliseConfig", "input", "DEFAULT_IMAGE_BASE", "DEFAULT_TTL_HOURS", "createLogger", "args", "ensureArray", "value", "part", "combineAppend", "base", "extras", "values", "createFetcher", "client", "cache", "config", "log", "defaultAppend", "fetchWithCache", "key", "ttlHours", "loader", "cached", "err", "data", "getMovieEnriched", "id", "options", "_a", "movieId", "cacheKey", "ttl", "_b", "_c", "append", "detail", "mapMovieDetail", "getTvEnriched", "tvId", "mapTvDetail", "getSeasonEnriched", "seasonNumber", "show", "mapSeasonDetail", "createMetadataService", "inputOptions", "createCacheStore", "createTmdbClient", "fetcher", "prefix", "ensureDefaultCache", "defaultCacheStore", "ensureDefaultService", "defaultService", "configureMetadataServiceDefaults", "merged", "readStoredToken", "token", "syncDefaultMetadataService", "cfg", "overrides", "preferStoredToken", "overrideToken", "overrideApiKey", "overrideLanguage", "overrideRegion", "overrideTtl", "overrideImageBase", "lang", "region", "ttlCandidates", "candidate", "ttlNum", "imageBase", "apiKey", "metadataServiceFacade", "metadataService_default", "init_metadataService", "__esmMin", "init_cacheStore", "init_tmdbClient", "init_tmdbMapper", "renderSeasonsAccordion", "targetOrSeasons", "maybeSeasons", "maybeOptions", "root", "seasons", "options", "resolveContext", "card", "s", "idx", "seasonCardEl", "isTarget", "value", "resolveTarget", "target", "isPlainObject", "season", "prefixShowThumb", "head", "th", "img", "txt", "title", "sub", "year", "epCount", "chev", "body", "renderEpisodeRows", "seasonNumber", "resolveSeasonNumber", "tvId", "resolveShowTmdbId", "loaded", "loading", "abortController", "handleClick", "shouldEnrichSeason", "metadataService_default", "detail", "mergeSeasonEpisodes", "err", "logWarn", "episodes", "list", "empty", "ep", "episodeRowEl", "data", "combineEpisodeData", "row", "media", "createEpisodeStill", "content", "header", "buildEpisodeTitle", "right", "rating", "badge", "meta", "metaParts", "overview", "parts", "_a", "_b", "wrapper", "stillPath", "stillUrl", "alt", "small", "urlEpisode", "medium", "placeholder", "makeInitials", "_c", "tmdb", "resolveNumeric", "episodeNumber", "code", "durationMin", "runtimeText", "airDate", "still", "enrichedEpisodes", "localEpisodes", "lookup", "key", "buildEpisodeKey", "entry", "values", "num", "show", "_d", "_e", "showIds", "direct", "seasonId", "str", "hasTmdbCredentials", "config", "stored", "args", "init_seasonsAccordion", "__esmMin", "init_data", "init_metadataService", "init_imageHelper", "updateSeasons", "root", "item", "pane", "seasons", "renderSeasonsAccordion", "init_seasonsSection", "__esmMin", "init_seasonsAccordion", "setExternalLinks", "root", "item", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "tmdbBtn", "imdbBtn", "trailerBtn", "tmdbId", "imdbId", "trailer", "type", "init_externalLinks", "__esmMin", "normalizeLocalCast", "person", "_a", "_b", "_c", "name", "role", "rawRole", "tmdbProfile", "val", "thumb", "normalizeTmdbCast", "buildCastList", "item", "seen", "combined", "entry", "lowerName", "updateCast", "root", "cast", "pane", "scroll", "limited", "tmdbEnabled", "useTmdbOn", "data", "card", "roleText", "avatar", "imageSrc", "resolveCastImage", "img", "initials", "castInitials", "nameLine", "roleLine", "ensureCastStatusPosition", "setCastLoading", "loading", "resolveCastPane", "setCastStatus", "status", "statusEl", "normalizeTmdbProfile", "path", "str", "suffix", "TMDB_PROFILE_BASE", "TMDB_PROFILE_SIZE", "normalizeLocalImage", "raw", "tmdbCandidates", "candidate", "url", "localCandidates", "chars", "part", "init_castSection", "__esmMin", "init_utils", "isObject", "value", "parseGuidEntry", "entry", "_a", "_b", "raw", "str", "lower", "result", "key", "patterns", "GUID_PATTERNS", "pattern", "marker", "idx", "start", "ensureIds", "target", "_c", "ids", "assign", "guidSources", "source", "parsed", "deepClone", "out", "mapMovie", "item", "clone", "mapShow", "normalizeShow", "mapDetail", "detail", "needsShowDetail", "seasons", "hasEpisodes", "season", "cast", "mergeShowDetail", "mapped", "show", "normalizeThumbField", "normalizeGenresList", "normalizePeopleList", "normalizeSeasonEntry", "sc", "normalizeEpisodeEntry", "ep", "obj", "prefixShowThumb", "list", "seen", "tag", "init_shared", "__esmMin", "init_data", "demoData_exports", "__export", "DEMO_MOVIE", "DEMO_SERIES", "init_demoData", "__esmMin", "loadDemoDataModule", "demoDataModulePromise", "err", "resolveRoot", "rootEl", "container", "overlayContainer", "onOverlayClick", "dialogEl", "scrollContainer", "existing", "ev", "target", "closeModalV2", "getFocusableElements", "el", "bindFocusTrap", "focusTrapHandler", "focusables", "first", "last", "unbindFocusTrap", "bindEscape", "escapeHandler", "unbindEscape", "showOverlay", "root", "focusInitial", "closeBtn", "focus", "setTmdbStatus", "rootOrPayload", "maybePayload", "payload", "targetRoot", "statusEl", "state", "message", "showModalV2Loading", "loadingDiv", "renderModalV2", "item", "hasSeasons", "populateHead", "setExternalLinks", "updateOverview", "updateDetails", "updateSeasons", "updateCast", "buildCastList", "setCastLoading", "setCastStatus", "applyTabs", "refreshModalSections", "maybeStartTmdbEnrichment", "kind", "tokenSnapshot", "shouldUseTmdbEnrichment", "tmdbId", "resolveTmdbId", "activeToken", "renderToken", "getTvEnriched", "getMovieEnriched", "detail", "enriched", "attachTmdbDetail", "currentItem", "_a", "_b", "errorMessage", "hasTmdbCredentials", "stored", "cfg", "getState", "openMovieModalV2", "idOrData", "token", "lastActiveElement", "data", "resolveMovieData", "errorDiv", "currentKind", "openSeriesModalV2", "base", "resolveSeriesData", "working", "needsShowDetail", "loadShowDetail", "mergeShowDetail", "DEMO_MOVIE", "mapMovie", "str", "match", "movie", "matchesIdentifier", "DEMO_SERIES", "mapShow", "show", "id", "init_modalV2", "__esmMin", "init_tabs", "init_headerSection", "init_overviewSection", "init_detailsSection", "init_seasonsSection", "init_externalLinks", "init_castSection", "init_state", "init_data", "init_shared", "init_metadataService", "noop", "parsePx", "value", "num", "raf", "caf", "VirtualList", "init_virtualList", "__esmMin", "cb", "id", "container", "renderItem", "getKey", "updateItem", "getSignature", "overscan", "estimatedItemHeight", "minItemWidth", "force", "width", "list", "sampleItem", "sample", "rect", "node", "allowed", "nextSignatures", "item", "idx", "key", "signature", "prev", "index", "raw", "containerStyle", "hostStyle", "rowGap", "colGap", "gapFallback", "rawColumns", "el", "top", "viewportTop", "viewportBottom", "listStart", "listEnd", "startRow", "endRow", "start", "end", "needsRefresh", "i", "offsetY", "nextRendered", "toRender", "updated", "currentChildren", "same", "currentMap", "desired", "current", "grid_exports", "__export", "renderGrid", "cardEl", "item", "card", "el", "media", "img", "src", "resolvePoster", "gradient", "badges", "buildItemBadges", "badgeContainer", "badge", "pct", "progressPercent", "track", "fill", "body", "title", "sub", "metaPieces", "buildMetaPieces", "actions", "chips", "genres", "getGenreNames", "renderChipsLimited", "watchBtn", "updateWatchButtonState", "ev", "toggle", "openDetail", "createCollectionGroup", "name", "members", "list", "a", "b", "ay", "humanYear", "by", "years", "year", "addedTimestamps", "latestAdded", "ratings", "_a", "rating", "sum", "val", "posterItem", "entry", "groupCollectionsIfEnabled", "items", "togg", "colSel", "selected", "membership", "collectionTags", "groups", "collectionCardEl", "baseItem", "buildCollectionBadges", "pieces", "collectionMetaPieces", "sel", "ensureVirtualList", "grid", "virtualListInstance", "VirtualList", "itemKey", "gridItemSignature", "renderGridItemNode", "node", "refreshGridItemNode", "index", "key", "id", "resolveItemId", "CARD_SIGNATURE_PROP", "current", "signature", "replacement", "replaceCardNode", "view", "movies", "shows", "filtered", "getState", "base", "shouldAnimate", "lastRenderedView", "beginGridTransition", "finishGridTransition", "empty", "tmdbPoster", "useTmdbForCards", "fallback", "itemBadgeTexts", "isNew", "contentRating", "ratingNum", "formatRating", "createBadge", "collectionBadgeTexts", "text", "button", "saved", "isSaved", "runtime", "formatRuntime", "studio", "count", "_b", "raw", "minutes", "offset", "duration", "preferred", "collectionSignature", "itemSignature", "meta", "ratingValue", "parent", "hadFocus", "updateHash", "kind", "hash", "replace", "navigateToHash", "openSeriesModalV2", "openMovieModalV2", "init_grid", "__esmMin", "init_state", "init_dom", "init_utils", "init_watchlist", "init_modalV2", "init_main", "init_virtualList", "filter_exports", "__export", "applyFilters", "computeFacets", "initFilters", "renderFacets", "setFiltersUpdatedHandler", "updateFiltersAndGrid", "norm", "s", "matches", "item", "opts", "query", "onlyNew", "yearFrom", "yearTo", "genresActive", "selectedCollection", "getGenreNames", "r", "collectionTags", "isNew", "year", "humanYear", "itemGenres", "g", "sortItems", "items", "key", "arr", "a", "b", "movies", "shows", "genres", "years", "collections", "add", "x", "name", "y", "c", "ys", "f", "yFrom", "qs", "yTo", "col", "gRoot", "chips", "updateGenreFilterState", "getFilterOpts", "_a", "_b", "_c", "_d", "_e", "searchInput", "collection", "sort", "n", "getState", "pool", "filtered", "ordered", "setState", "renderGridForCurrentView", "gridModulePromise", "mod", "fn", "handler", "filtersUpdatedHandler", "result", "payload", "root", "activeCount", "sortSel", "v", "l", "bind", "sel", "ev", "yrReset", "t", "init_filter", "__esmMin", "init_state", "init_dom", "init_utils", "tmdb_exports", "__export", "clearCache", "hydrateOptional", "validateToken", "logWarn", "args", "normalizeConfig", "cfg", "language", "region", "ttlHours", "imageBase", "buildSignature", "auth", "authSig", "ensureMetadata", "signature", "metadataInstance", "metadataSignature", "options", "cacheStore_default", "createMetadataService", "keyFor", "item", "_a", "_b", "type", "imdb", "tmdb", "title", "year", "err", "SESSION_CACHE", "clear", "tokenFromEnv", "token", "val", "resolveByExternalId", "imdbId", "_c", "_d", "_e", "_f", "json", "resolveBySearch", "name", "client", "params", "result", "hydrateItem", "cacheKey", "service", "tmdbId", "detail", "enriched", "movies", "shows", "work", "limit", "index", "processChunk", "chunk", "it", "data", "withAuth", "url", "separator", "raw", "looksLikeV3", "looksLikeJwt", "decodeJwtPayload", "t", "part", "s", "init", "API_V3", "payload", "iss", "init_tmdb", "__esmMin", "init_cacheStore", "init_metadataService", "initHeroPolicy", "validationIssues", "raw", "loadError", "response", "POLICY_URL", "safeJson", "error", "addIssue", "showError", "activePolicy", "sanitizePolicy", "policyLoadedAt", "reportValidationIssues", "getHeroPolicy", "clone", "getPoolSizes", "getSlotConfig", "slots", "SLOT_KEYS", "key", "getDiversityWeights", "getRotationConfig", "getTextClampConfig", "getFallbackPreference", "getPolicyLanguage", "getCacheTtl", "hours", "grace", "getValidationIssues", "getPolicyLoadedAt", "target", "DEFAULT_POLICY", "ensurePositiveInt", "rawSlots", "slot", "quota", "ensureNumberInRange", "rawDiversity", "rawRotation", "rawClamp", "rawFallback", "ensureFallbackPreference", "rawCache", "ttlHours", "graceMinutes", "value", "fallback", "field", "allowZero", "num", "min", "max", "source", "message", "followUps", "init_policy", "__esmMin", "init_errorHandler", "logWarn", "args", "now", "delay", "ms", "resolve", "shallowEqual", "a", "b", "keysA", "keysB", "key", "getRateLimitSnapshot", "_a", "rateLimitState", "notifyRateLimitListeners", "snapshot", "listener", "rateLimitListeners", "err", "updateRateLimitState", "patch", "next", "computeRetryDelay", "attempt", "computeRateLimitDelay", "strikes", "fallback", "scaled", "candidate", "registerRateLimitHit", "retryAfterMs", "status", "nowTs", "delayMs", "throttlePenaltyUntil", "decayRateLimitStrikes", "refreshRateLimit", "getCacheKey", "type", "id", "language", "t", "lang", "ensureCacheLoaded", "cacheLoaded", "raw", "STORAGE_KEY", "parsed", "entry", "_b", "_c", "_d", "ts", "memoryCache", "pruneExpired", "changed", "schedulePersist", "getCacheEntry", "setCacheEntry", "data", "pruneOverflow", "entries", "at", "trimmed", "persistTimer", "persistCache", "parseRetryAfter", "value", "num", "date", "shouldRetryStatus", "isAbortError", "shouldRetryError", "withAuth", "url", "auth", "sep", "throttle", "waitInterval", "lastRequestAt", "waitPenalty", "wait", "fetchJson", "signal", "finalUrl", "init", "requestInit", "response", "retryable", "retryAfter", "text", "classifyCredential", "forcedKind", "readLocalStorageToken", "parseCfg", "json", "out", "line", "clean", "idx", "loadConfigCfg", "configPromise", "cachedConfig", "extractCredentialFromSettings", "settings", "token", "extractCredentialFromLocalStorage", "extractCredentialFromConfig", "cfg", "resolveAuth", "options", "classified", "fromSettings", "fromLocalStorage", "fromCfg", "getRateLimitState", "addRateLimitListener", "tmdbImageUrl", "path", "size", "normalizedPath", "variant", "IMG_BASE", "cleanId", "fetchDetails", "normalizedType", "normalizedId", "cached", "API_BASE", "APPEND_FIELDS", "extractRawTitle", "item", "candidates", "str", "parseYear", "match", "extractRawYear", "direct", "dateCandidate", "fromDate", "fetchByExternalId", "imdbId", "hit", "resolvedId", "details", "buildSearchUrl", "title", "year", "encodedTitle", "base", "fetchBySearch", "results", "extractIds", "ids", "merge", "guid", "schemePart", "restPart", "scheme", "tail", "buildSearchTitleOverride", "preferred", "fetchDetailsForItem", "baseOptions", "attempts", "searchTitle", "searchYear", "result", "init_tmdbClient", "__esmMin", "logWarn", "args", "cleanString", "value", "nonEmptyString", "str", "parseYear", "match", "parseDateYear", "date", "y", "clampRating", "num", "minutesFromDuration", "raw", "collectGenres", "tmdb", "names", "entry", "rawGenres", "seen", "result", "name", "key", "extractIds", "ids", "set", "input", "mergeGuid", "guid", "rawGuid", "schemePart", "restPart", "scheme", "tail", "chooseTitle", "type", "candidates", "c", "chooseTagline", "chooseOverview", "chooseYear", "_a", "_b", "_c", "primary", "secondary", "y2", "fromRaw", "chooseRuntime", "first", "v", "minutes", "season", "ep", "fallback", "chooseRating", "fromTmdb", "chooseVoteCount", "chooseCertification", "us", "sorted", "a", "b", "at", "bt", "cert", "rating", "rawRating", "cleaned", "extractBackdrops", "urls", "tmdbList", "backdrop", "BACKDROP_MIN_WIDTH", "url", "tmdbImageUrl", "TMDB_BACKDROP_SIZE", "plexBackdrop", "trimmed", "computeTvCounts", "count", "buildCta", "preferred", "targetId", "kind", "finalizeIds", "out", "ensureId", "normalizeItem", "options", "language", "tmdbBundle", "fetchDetailsForItem", "err", "tmdbData", "title", "normalized", "tagline", "overview", "year", "runtime", "voteCount", "genres", "certification", "backdrops", "counts", "cta", "tmdbMeta", "init_normalizer", "__esmMin", "init_tmdbClient", "now", "safeArea", "name", "readRaw", "area", "key", "writeRaw", "value", "parseJson", "raw", "stringifyJson", "normalizeKind", "kind", "poolKey", "POOL_PREFIX", "sessionPoolKey", "SESSION_SUFFIX", "historyKey", "HISTORY_PREFIX", "memoryKey", "MEMORY_PREFIX", "failureKey", "FAILURE_PREFIX", "readPoolFrom", "parsed", "readMemory", "local", "resolveAreas", "entry", "_a", "_b", "_c", "writeMemory", "entries", "payload", "json", "session", "readFailures", "writeFailures", "clonePoolData", "data", "copy", "getStoredPool", "nowTs", "policyHash", "allowExpired", "sessionKey", "sessionPool", "localPool", "source", "pool", "valid", "matchesPolicy", "storePool", "invalidatePool", "readHistory", "writeHistory", "resolveEntryKey", "suffix", "resolveHistoryId", "recordHeroHistory", "timestamp", "limit", "id", "filtered", "item", "pruned", "getHeroHistory", "windowMs", "list", "threshold", "seen", "recordHeroMemory", "ttlMs", "preserved", "additions", "additionIds", "slot", "filteredPreserved", "limited", "deduped", "finalSeen", "getHeroMemory", "clearHeroMemory", "recordHeroFailure", "reason", "hits", "resolveHeroFailure", "getHeroFailures", "clearHeroFailures", "init_storage", "__esmMin", "now", "logWarn", "args", "normalizeKind", "kind", "policySignature", "policy", "fragment", "err", "clamp", "value", "min", "max", "parseDate", "ts", "parseYear", "num", "match", "parseGenres", "raw", "out", "push", "val", "trimmed", "normalized", "g", "parseRating", "candidates", "candidate", "parseVoteCount", "resolveId", "key", "suffix", "computeSlotPlan", "poolSize", "slots", "plan", "remaining", "quotas", "SLOT_KEYS", "index", "_a", "quota", "count", "cursor", "computeCaps", "diversity", "genreWeight", "yearWeight", "genreCap", "yearCap", "prepareCandidates", "items", "nowTs", "seen", "prepared", "id", "addedAt", "year", "rating", "voteCount", "genres", "NEW_WINDOW_MS", "OLD_THRESHOLD_YEARS", "sortNew", "list", "a", "b", "sortTopRated", "ra", "rb", "vc", "sortOld", "ya", "yb", "shuffle", "arr", "i", "j", "passesCaps", "context", "caps", "genreCounts", "yearCounts", "genre", "applySelection", "slot", "attemptSelection", "allowHistory", "filter", "deferredHistory", "deferredMemory", "deferredFailures", "applyQueue", "queue", "ensureMinimum", "emitProgress", "detail", "payload", "listener", "listeners", "PROGRESS_EVENT", "normalizeSelection", "selection", "language", "options", "total", "settings", "auth", "authOptions", "signal", "disableTmdb", "failureTtlMs", "entry", "normalizedItem", "failureReason", "rateLimited", "normalizeItem", "recordHeroFailure", "resolveHeroFailure", "classifyCandidates", "history", "memory", "failures", "sum", "newList", "topList", "oldList", "randomList", "remainingRandom", "leftovers", "shouldReusePool", "policyHash", "cached", "getStoredPool", "graceMs", "getCacheTtl", "buildPool", "getHeroPolicy", "normalizedKind", "reuse", "clearHeroMemory", "clearHeroFailures", "ttlInfo", "memoryWindow", "base", "HISTORY_WINDOW_MS", "getHeroHistory", "HISTORY_LIMIT", "getHeroMemory", "getHeroFailures", "fallbackHistory", "FALLBACK_HISTORY_WINDOW_MS", "trimmedSelection", "finalItems", "updatedAt", "expiresAt", "recordHeroMemory", "storePool", "ensureHeroPool", "forceRegeneratePool", "init_pool", "__esmMin", "init_normalizer", "init_policy", "init_storage", "logWarn", "args", "now", "normalizeKind", "kind", "rateLimitEquals", "a", "b", "attachRateLimitListener", "detachRateLimitListener", "state", "getRateLimitState", "addRateLimitListener", "info", "next", "notify", "createStatus", "cloneStatus", "status", "copy", "readFeatureFlag", "raw", "FEATURE_FLAG_KEY", "err", "computeFeatureState", "cfg", "stored", "buildSnapshot", "snapshot", "listener", "listeners", "UPDATE_EVENT", "updateStatus", "patch", "normalized", "refreshReadyState", "ready", "loadStored", "getStoredPool", "ensureSources", "buildTmdbOptions", "hasCredentials", "useTmdbForHero", "disableTmdb", "authOptions", "fallback", "runPoolBuilder", "force", "items", "builder", "forceRegeneratePool", "ensureHeroPool", "options", "promise", "result", "payload", "poolItems", "computeDaySeed", "nowDate", "year", "startOfYear", "today", "diff", "comparePoolEntries", "ka", "kb", "computeRotation", "_a", "_b", "pool", "sorted", "freshnessSeed", "offset", "seed", "startIndex", "configure", "policy", "feature", "setSources", "movies", "shows", "setActiveView", "view", "primeAll", "tasks", "results", "ensureKind", "refreshKind", "refreshAll", "updateTmdbActive", "active", "isEnabled", "isReady", "getSnapshot", "getRotationPlan", "subscribe", "getDebugSnapshot", "init_pipeline", "__esmMin", "init_pool", "init_storage", "init_utils", "init_tmdbClient", "initDebugUi", "open", "openPanel", "_a", "_b", "_c", "_d", "overlay", "render", "ev", "closePanel", "copyReport", "clearExpiredCache", "clearAllCache", "_e", "_f", "_g", "_h", "pre", "s", "getState", "src", "getSources", "cfg", "cacheStats", "getCacheStats", "heroPolicy", "getHeroPolicy", "heroPolicyIssues", "getValidationIssues", "heroPipeline", "getDebugSnapshot", "report", "getPolicyLanguage", "getPoolSizes", "getSlotConfig", "getDiversityWeights", "getRotationConfig", "getTextClampConfig", "getFallbackPreference", "getCacheTtl", "getPolicyLoadedAt", "statsEl", "heroMovies", "heroSeries", "formatTs", "ts", "heroFeature", "txt", "err", "ta", "init_debug", "__esmMin", "init_state", "init_data", "init_cache", "init_policy", "init_pipeline", "setHeroRefreshHandler", "handler", "heroRefreshHandler", "setReduceMotionHandler", "reduceMotionHandler", "notifyHeroRefresh", "items", "notifyReduceMotion", "enabled", "initSettingsOverlay", "cfg", "overlay", "dialog", "open1", "open2", "headerSettingsBtn", "close2", "tmdbInput", "tmdbSave", "tmdbTest", "tmdbStatus", "tmdbClear", "tmdbBadge", "reduce", "useTmdb", "resetFilters", "body", "heroStatus", "heroRefreshMovies", "heroRefreshShows", "heroRefreshAll", "heroRow", "heroButtons", "heroTask", "setHeroButtonsDisabled", "disabled", "reason", "btn", "isEnabled", "formatUpdated", "ts", "formatExpiry", "diff", "minutes", "hours", "days", "describeHeroStatus", "label", "status", "updated", "expiry", "updateHeroStatus", "snapshot", "_a", "_b", "_c", "_d", "_e", "_f", "busy", "segments", "runHeroRegeneration", "kind", "refreshKind", "refreshAll", "err", "subscribe", "restoreFocus", "previousOverflow", "isOpen", "backgroundState", "focusSelector", "getFocusable", "el", "focusDialog", "setBackgroundInert", "active", "nodes", "node", "state", "openOverlay", "syncSettingsUi", "closeOverlay", "handleKeydown", "ev", "focusable", "first", "last", "setTmdbStatus", "msg", "stored", "currentInput", "setUseTmdbAvailability", "m", "allowed", "renderGrid", "getState", "token", "svc", "res", "raw", "syncDefaultMetadataService", "updateTmdbActive", "result", "tmdbHydrationStarted", "s", "search", "q", "onlyNew", "yf", "yt", "col", "n", "genreRoot", "F", "init_settingsOverlay", "__esmMin", "init_state", "init_grid", "init_pipeline", "init_metadataService", "setCurrentHeroItem", "item", "currentHeroEntry", "ensureHeroDefaults", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "heroDefaults", "defaults", "setHeroNavigation", "handler", "navigateToHashHandler", "showHeroFallback", "reason", "overrides", "hero", "heroTitle", "heroTagline", "heroOverview", "heroCta", "heroMeta", "metaPrimary", "metaSecondary", "metaTertiary", "heroPicture", "heroImage", "heroSourceLarge", "heroSourceMedium", "copy", "HERO_FALLBACK_COPY", "lastFallbackReason", "clearPicture", "taglineText", "overviewText", "ctaLabel", "ctaEnabled", "refreshHero", "listOverride", "candidate", "selectHeroEntry", "normalized", "ensureNormalizedEntry", "kind", "targetId", "recordHeroHistory", "tagline", "overview", "openHeroModal", "renderMeta", "renderMedia", "normalizedOverride", "ensureNormalizedList", "chooseHeroCandidate", "source", "heroCandidatesFromState", "list", "isPlayableHeroItem", "entry", "index", "state", "getState", "view", "stored", "getStoredPool", "fromPool", "pool", "isNormalized", "normalizeLegacyItem", "ctaId", "raw", "type", "title", "ids", "collectIds", "year", "parseYear", "runtime", "parseRuntime", "rating", "parseRating", "genres", "collectGenres", "certification", "parseCertification", "parseOverview", "parseTagline", "backdrops", "collectLegacyBackdrops", "cta", "humanYear", "minutes", "names", "trimmed", "name", "segments", "last", "sources", "value", "preferTmdb", "useTmdbOn", "tmdbCandidates", "localCandidates", "urls", "url", "normalizeMediaPath", "path", "primaryRoot", "secondaryRoot", "tertiaryRoot", "container", "rows", "buildMetaRows", "primary", "secondary", "tertiary", "renderMetaRow", "hasContent", "runtimeText", "formatRuntime", "ratingValue", "formatRating", "votes", "NUMBER_FORMAT", "parts", "genre", "text", "root", "items", "fragment", "badge", "picture", "image", "sourceLarge", "sourceMedium", "setSource", "node", "hrs", "mins", "id", "navigateToItemHash", "openSeriesModalV2", "openMovieModalV2", "explicitTarget", "hash", "replace", "init_hero", "__esmMin", "init_state", "init_modalV2", "init_utils", "init_storage", "initHeroAutoplay", "onRefresh", "refreshHero", "hero", "timer", "bar", "DURATION", "pauseReasons", "wasPaused", "elapsed", "raf", "lastTs", "pipelineEnabled", "isEnabled", "rotationKind", "resolveKind", "rotationItems", "rotationIndex", "pipelinePaused", "rotationSignature", "unsubscribePipeline", "unsubscribeState", "applyRotationPlan", "getRotationPlan", "subscribe", "kind", "getState", "isPaused", "updatePausedState", "pausedNow", "setPaused", "reason", "value", "advanceRotation", "plan", "_a", "items", "status", "getSnapshot", "busy", "isReady", "signature", "hadItems", "previouslyPaused", "step", "ts", "dt", "prog", "next", "start", "init_hero_autoplay", "__esmMin", "init_hero", "init_state", "init_pipeline", "applyFeatureFlags", "cfg", "globalFeatures", "announceHeroFallback", "reason", "detail", "heroFallbackNotice", "handler", "HERO_FALLBACK_MESSAGES", "refreshHeroWithPipeline", "listOverride", "_a", "_b", "_c", "_d", "refreshHero", "isEnabled", "currentView", "getState", "plan", "getRotationPlan", "status", "ready", "isReady", "busy", "items", "tmdbRateLimit", "rateLimited", "pipelineError", "showHeroFallback", "index", "entry", "setFooterStatus", "message", "footer", "grid", "boot", "isTestEnv", "initErrorHandler", "applyReduceMotionPref", "showLoader", "setLoader", "showSkeleton", "configPromise", "r", "err", "showError", "policyPromise", "initHeroPolicy", "getHeroPolicy", "heroPolicy", "syncDefaultMetadataService", "heroPipelineInfo", "configure", "setState", "getValidationIssues", "movies", "loadMovies", "shows", "loadShows", "facets", "computeFacets", "setSources", "setActiveView", "primeAll", "clearSkeleton", "renderSwitch", "renderFacets", "initFilters", "filtered", "applyFilters", "renderStats", "renderGrid", "renderFooterMeta", "hideLoader", "hydrateOptional", "initUi", "initSettingsOverlay", "initAdvancedToggle", "initHeaderInteractions", "initScrollProgress", "initScrollTop", "initFilterBarAutoHideFallback", "initHeroAutoplay", "initDebugUi", "handleHashChange", "error", "showRetryableError", "tmdbRaf", "applyHashNavigation", "hash", "view", "ensureKind", "result", "match", "kind", "id", "item", "x", "openSeriesModalV2", "openMovieModalV2", "force", "currentHash", "hashNavigation", "root", "buttons", "current", "btn", "target", "isActive", "ensure", "navigateToHash", "animate", "s", "elM", "elS", "countTo", "el", "start", "end", "dur", "t0", "step", "t", "p", "val", "times", "date", "setReduceMotionClass", "pref", "body", "panel", "animating", "fallbackTimer", "finishAnimation", "queueFinish", "event", "openPanel", "height", "closePanel", "siteLogo", "titleEl", "subtitle", "TAGLINES", "idx", "rotate", "taglineTicker", "bar", "update", "scrollTop", "pct", "toggle", "y", "filters", "lastY", "isHidden", "ticking", "MIN_SCROLL", "DELTA_HIDE", "setHidden", "nextHidden", "currentY", "delta", "onScroll", "reveal", "DEFAULT_FEATURE_FLAGS", "hashchangeTimeout", "init_main", "__esmMin", "init_state", "init_loader", "init_data", "init_filter", "init_grid", "init_modalV2", "init_tmdb", "init_watchlist", "init_debug", "init_errorHandler", "init_settingsOverlay", "init_hero", "init_hero_autoplay", "init_policy", "init_pipeline", "init_metadataService", "existing", "merged", "lastHash", "suppressedHash", "normalizeHash", "raw", "trimmed", "updateHash", "targetHash", "options", "replace", "silent", "method", "usedHistory", "shouldHandle", "markProcessed", "setHeroNavigation", "setFiltersUpdatedHandler", "setHeroRefreshHandler", "setReduceMotionHandler", "enabled"]
}
