{
  "version": 3,
  "sources": ["../js/state.js", "../js/dom.js", "../js/data.js", "../js/utils.js", "../js/watchlist.js", "../js/modal/seasonsAccordion.js", "../js/modal/shared.js", "../js/modalV2.js", "../js/grid.js", "../js/filter.js", "../js/services/tmdb.js", "../js/main.js", "../js/loader.js", "../js/debug.js"],
  "sourcesContent": ["const S = { view: 'movies', movies: [], shows: [], facets: {}, filtered: [], cfg: {} };\nconst listeners = new Set();\n\nexport const getState = () => S;\nexport function setState(patch){ Object.assign(S, patch); listeners.forEach(fn=>fn(S)); }\nexport function subscribe(fn){ listeners.add(fn); return ()=>listeners.delete(fn); }\n", "export const qs  = (s, r=document) => r.querySelector(s);\nexport const qsa = (s, r=document) => [...r.querySelectorAll(s)];\nexport function el(tag, cls, content){\n  const n=document.createElement(tag);\n  if(cls) n.className=cls;\n  if(content!=null) n.textContent = content;\n  return n;\n}\n\n", "let lastSources = { movies: null, shows: null };\nconst showDetailCache = new Map();\n\nconst MOVIE_THUMB_BASE = 'data/movies/';\nconst SHOW_THUMB_BASE = 'data/series/';\nconst SCHEME_RE = /^[a-z][a-z0-9+.-]*:/i;\n\nasync function fetchJson(url){\n  try{ const r = await fetch(url, { cache:'no-store' }); if(r && r.ok) return await r.json(); }\n  catch{}\n  return null;\n}\n\nfunction embeddedJsonById(id){\n  try{ const n = document.getElementById(id); if(n && n.textContent) return JSON.parse(n.textContent); }\n  catch{}\n  return null;\n}\n\nfunction fromGlobalBag(key){\n  try{ const bag = window.__PLEX_EXPORTER__; const arr = bag && Array.isArray(bag[key]) ? bag[key] : null; return arr || null; }\n  catch{ return null; }\n}\n\nfunction fromWindow(varName){\n  try{ const arr = Array.isArray(window[varName]) ? window[varName] : null; return arr || null; }\n  catch{ return null; }\n}\n\nasync function loadWithCompat(primaryUrl, opts){\n  // default: try site/data first\n  let data = await fetchJson(primaryUrl);\n  if(Array.isArray(data) && data.length){ markSource(opts?.label, `primary:${primaryUrl}`); return data; }\n  // fallback: embedded <script id=\"...\"> JSON\n  if(opts?.embedId){ const emb = embeddedJsonById(opts.embedId); if(Array.isArray(emb) && emb.length){ markSource(opts?.label, `embedded:${opts.embedId}`); return emb; } }\n  // fallback: global exporter bag\n  if(opts?.exportKey){ const bag = fromGlobalBag(opts.exportKey); if(Array.isArray(bag) && bag.length){ markSource(opts?.label, `globalBag:${opts.exportKey}`); return bag; } }\n  // fallback: window variable\n  if(opts?.globalVar){ const win = fromWindow(opts.globalVar); if(Array.isArray(win) && win.length){ markSource(opts?.label, `window:${opts.globalVar}`); return win; } }\n  // alt paths (legacy)\n  for(const alt of (opts?.altUrls||[])){\n    const j = await fetchJson(alt); if(Array.isArray(j) && j.length){ markSource(opts?.label, `alt:${alt}`); return j; }\n  }\n  // last resort: empty array\n  markSource(opts?.label, 'empty');\n  return Array.isArray(data) ? data : [];\n}\n\nexport function prefixThumbValue(value, base){\n  const raw = value == null ? '' : String(value).trim();\n  if(!raw) return '';\n  if(raw.startsWith('//') || raw.startsWith('/') || SCHEME_RE.test(raw)) return raw;\n  const normalizedBase = base ? (base.endsWith('/') ? base : `${base}/`) : '';\n  const withoutDots = raw.replace(/^\\.\\/+/, '');\n  const encodePath = path => path.split('/').map(segment => {\n    if(!segment) return '';\n    try{\n      return encodeURIComponent(decodeURIComponent(segment));\n    }catch{\n      return encodeURIComponent(segment);\n    }\n  }).join('/');\n  if(withoutDots.startsWith('data/')) return encodePath(withoutDots);\n  const cleanedLeading = withoutDots.replace(/^\\/+/, '');\n  let cleaned = cleanedLeading;\n  if(normalizedBase){\n    const escapeRegExp = str => str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n    const baseDir = normalizedBase.replace(/\\/+$/, '').split('/').pop();\n    if(baseDir){\n      const re = new RegExp(`^${escapeRegExp(baseDir)}\\/`);\n      cleaned = cleanedLeading.replace(re, '');\n    }\n  }\n  const encoded = encodePath(cleaned);\n  return `${normalizedBase}${encoded}`;\n}\n\n\nexport function prefixThumb(obj, base){\n  if(!obj || typeof obj !== 'object') return obj;\n  const current = obj.thumbFile ?? obj.thumb ?? '';\n  const prefixed = prefixThumbValue(current, base);\n  if(prefixed){\n    obj.thumbFile = prefixed;\n    obj.thumb = prefixed;\n  }else if(current){\n    const str = String(current);\n    obj.thumbFile = str;\n    if(obj.thumb == null) obj.thumb = str;\n  }\n  return obj;\n}\n\nexport function prefixMovieThumb(obj){\n  return prefixThumb(obj, MOVIE_THUMB_BASE);\n}\n\nexport function prefixShowThumb(obj){\n  return prefixThumb(obj, SHOW_THUMB_BASE);\n}\n\nexport function prefixShowTree(show){\n  if(!show || typeof show !== 'object') return show;\n  prefixShowThumb(show);\n  if(Array.isArray(show.seasons)) show.seasons.forEach(prefixSeasonTree);\n  return show;\n}\n\nfunction prefixSeasonTree(season){\n  if(!season || typeof season !== 'object') return season;\n  prefixShowThumb(season);\n  if(Array.isArray(season.episodes)) season.episodes.forEach(ep=>prefixShowThumb(ep));\n  return season;\n}\n\nfunction normalizeMovieThumbs(list){\n  if(!Array.isArray(list)) return [];\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixMovieThumb(item); });\n  return list;\n}\n\nfunction normalizeShowThumbs(list){\n  if(!Array.isArray(list)) return [];\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixShowTree(item); });\n  return list;\n}\n\nexport async function loadMovies(){\n  const movies = await loadWithCompat('data/movies/movies.json', {\n    label: 'movies',\n    embedId: 'movies-json',\n    exportKey: 'movies',\n    globalVar: '__PLEX_MOVIES__',\n    altUrls: [\n      'movies/movies.json',\n      'data/movies.json',\n      'Filme/movies.json',\n      'movies.json',\n    ],\n  });\n  return normalizeMovieThumbs(movies);\n}\nexport async function loadShows(){\n  const shows = await loadWithCompat('data/series/series_index.json', {\n    label: 'shows',\n    embedId: 'series-json',\n    exportKey: 'shows',\n    globalVar: '__PLEX_SHOWS__',\n    altUrls: [\n      'series/series_index.json',\n      'data/shows.json',\n      'data/series.json',\n      'Serien/series.json',\n      'series/series.json',\n      'series.json',\n      'shows.json',\n    ],\n  });\n  return normalizeShowThumbs(shows);\n}\n\nexport async function loadShowDetail(item){\n  if(!item) return null;\n  const keys = cacheKeys(item);\n  const cached = getCachedDetail(keys);\n  if(cached !== undefined) return cached;\n\n  const urls = detailUrlCandidates(item);\n  for(const url of urls){\n    const data = await fetchJson(url);\n    if(data && typeof data === 'object'){\n      const normalized = normalizeShowDetail(data);\n      storeDetail(keys, normalized, item);\n      return cloneDetail(normalized);\n    }\n  }\n  storeDetail(keys, null, item);\n  return null;\n}\n\nfunction markSource(label, src){\n  if(!label) return;\n  try{ lastSources[label] = src; }catch{}\n}\n\nexport function getSources(){ return { ...lastSources }; }\nexport function buildFacets(movies, shows){\n  // kept for compatibility; filter.js provides a richer computeFacets\n  const genres = new Set();\n  const years = new Set();\n  (movies||[]).concat(shows||[]).forEach(x=>{\n    (x.genres||[]).forEach(g=>{ if(g&&g.tag) genres.add(g.tag); });\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\n    if(y) years.add(Number(y));\n  });\n  return { genres:[...genres].sort(), years:[...years].sort((a,b)=>a-b), collections: [] };\n}\n\nfunction cacheKeys(item){\n  const keys = [];\n  if(item?.ratingKey !== undefined && item?.ratingKey !== null && item?.ratingKey !== ''){\n    keys.push(`rk:${String(item.ratingKey)}`);\n  }\n  const href = normalizeHrefKey(item?.href);\n  if(href) keys.push(`href:${href}`);\n  return keys;\n}\n\nfunction normalizeHrefKey(href){\n  if(!href) return '';\n  return String(href).trim().replace(/^\\.\\//,'').replace(/^\\/+/, '');\n}\n\nfunction getCachedDetail(keys){\n  for(const key of keys){\n    if(showDetailCache.has(key)){\n      const cached = showDetailCache.get(key);\n      return cached ? cloneDetail(cached) : null;\n    }\n  }\n  return undefined;\n}\n\nfunction storeDetail(keys, value, item){\n  const val = value;\n  keys.forEach(key=>{ showDetailCache.set(key, val); });\n  const rk = item?.ratingKey;\n  if(rk !== undefined && rk !== null){\n    showDetailCache.set(`rk:${String(rk)}`, val);\n  }\n  const detailKey = value && typeof value === 'object' ? value.ratingKey : undefined;\n  if(detailKey !== undefined && detailKey !== null){\n    showDetailCache.set(`rk:${String(detailKey)}`, val);\n  }\n  const href = normalizeHrefKey(item?.href);\n  if(href){\n    showDetailCache.set(`href:${href}`, val);\n  }\n  const detailHref = value && typeof value === 'object' ? normalizeHrefKey(value.href) : '';\n  if(detailHref){\n    showDetailCache.set(`href:${detailHref}`, val);\n  }\n}\n\nfunction detailUrlCandidates(item){\n  const urls = new Set();\n  const hrefKey = normalizeHrefKey(item?.href);\n  if(hrefKey){\n    if(/^https?:/i.test(hrefKey)){ urls.add(hrefKey); }\n    else{\n      if(hrefKey.startsWith('data/')) urls.add(hrefKey);\n      else urls.add(`data/${hrefKey}`);\n      const withoutData = hrefKey.replace(/^data\\//,'');\n      if(!withoutData.startsWith('series/')) urls.add(`data/series/${withoutData}`);\n      const idPart = withoutData.replace(/^series\\//,'').replace(/^details\\//,'').replace(/\\.json$/,'');\n      if(idPart) urls.add(`data/series/details/${idPart}.json`);\n    }\n  }\n  const rk = item?.ratingKey;\n  if(rk !== undefined && rk !== null){\n    urls.add(`data/series/details/${String(rk)}.json`);\n  }\n  return Array.from(urls);\n}\n\nfunction normalizeShowDetail(data){\n  if(!data || typeof data !== 'object') return null;\n  const show = { ...data };\n  prefixShowThumb(show);\n  show.genres = normalizeGenres(show.genres);\n  const castList = normalizePeople(show.cast || show.roles || []);\n  show.cast = castList;\n  show.roles = castList;\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeason).filter(Boolean) : [];\n  show.seasonCount = Number.isFinite(show.seasonCount) ? show.seasonCount : show.seasons.length;\n  prefixShowTree(show);\n  return show;\n}\n\nfunction normalizeSeason(season){\n  if(!season || typeof season !== 'object') return null;\n  const out = { ...season };\n  prefixShowThumb(out);\n  out.genres = normalizeGenres(out.genres);\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisode).filter(Boolean) : [];\n  prefixSeasonTree(out);\n  return out;\n}\n\nfunction normalizeEpisode(ep){\n  if(!ep || typeof ep !== 'object') return null;\n  const out = { ...ep };\n  prefixShowThumb(out);\n  out.genres = normalizeGenres(out.genres);\n  return out;\n}\n\nfunction normalizeGenres(list){\n  if(!Array.isArray(list)) return [];\n  const seen = new Set();\n  const result = [];\n  list.forEach(entry=>{\n    let obj = null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      if(tag) obj = { tag };\n    }else if(entry && typeof entry === 'object'){\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\n      if(tag){ obj = { ...entry, tag }; }\n    }\n    if(obj && !seen.has(obj.tag)){\n      seen.add(obj.tag);\n      result.push(obj);\n    }\n  });\n  return result;\n}\n\nfunction normalizePeople(list){\n  if(!Array.isArray(list)) return [];\n  return list.map(entry=>{\n    if(!entry) return null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      return tag ? { tag } : null;\n    }\n    if(typeof entry === 'object'){\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\n      if(tag){ return { ...entry, tag }; }\n      return { ...entry };\n    }\n    return null;\n  }).filter(Boolean);\n}\n\nfunction cloneDetail(detail){\n  if(detail === null || detail === undefined) return detail;\n  try{ return structuredClone(detail); }catch{}\n  try{ return JSON.parse(JSON.stringify(detail)); }catch{}\n  return detail;\n}\n", "import { getState } from './state.js';\n\nexport function getGenreNames(genres){\n  const seen = new Set();\n  const names = [];\n  (genres || []).forEach(entry=>{\n    let name = '';\n    if(typeof entry === 'string'){\n      name = entry;\n    }else if(entry && typeof entry === 'object'){\n      name = entry.tag || entry.title || entry.name || '';\n    }\n    const str = String(name || '').trim();\n    if(str && !seen.has(str)){\n      seen.add(str);\n      names.push(str);\n    }\n  });\n  return names;\n}\n\nexport function renderChipsLimited(container, values, limit=6){\n  if(!container) return;\n  const vals = (values||[]).filter(Boolean);\n  const head = vals.slice(0, limit);\n  const rest = vals.slice(limit);\n  const chips = head.map(text=>chip(text));\n  if(rest.length){\n    const more = chip(`+${rest.length} mehr`);\n    more.classList.add('more');\n    // store extra chips to reveal on click\n    more._extraChips = rest.map(text=>chip(text));\n    chips.push(more);\n  }\n  container.replaceChildren(...chips);\n  enableMoreChipBehavior(container);\n}\n\nexport function enableMoreChipBehavior(root = document){\n  try{\n    root.querySelectorAll('.chips .chip.more').forEach(btn=>{\n      if(btn.dataset.bound) return;\n      btn.dataset.bound = '1';\n      btn.addEventListener('click', ()=>{\n        const hidden = btn._extraChips || [];\n        try{ hidden.forEach(ch => btn.before(ch)); }catch{}\n        btn.remove();\n      });\n    });\n  }catch{}\n}\n\nexport function humanYear(item){\n  if(item?.year) return item.year;\n  if(item?.originallyAvailableAt) return String(item.originallyAvailableAt).slice(0,4);\n  return '';\n}\n\nexport function formatRating(val){\n  if(val === undefined || val === null || val === '') return '';\n  const num = Number(val);\n  if(Number.isFinite(num)){\n    const fixed = num.toFixed(1);\n    return fixed.endsWith('.0') ? fixed.slice(0,-2) : fixed;\n  }\n  return String(val).trim();\n}\n\nfunction chip(text){ const s=document.createElement('span'); s.className='chip'; s.textContent=String(text||''); return s; }\n\nexport function isNew(item){\n  if(!item?.addedAt) return false;\n  const added = new Date(item.addedAt).getTime();\n  if(!Number.isFinite(added)) return false;\n  const cfg = getState().cfg || {};\n  const days = Number(cfg.newDays || 30);\n  return Date.now() - added <= days * 24*60*60*1000;\n}\n\nexport function useTmdbOn(){ try{ return localStorage.getItem('useTmdb')==='1'; }catch{ return false; } }\n", "import { getState } from './state.js';\n\nconst STORAGE_KEY = 'watchlist:v1';\nlet saved = new Set();\n\nfunction load(){\n  try{ saved = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')); }catch{ saved = new Set(); }\n}\nfunction persist(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(saved.values()))); }catch{} }\n\nfunction idFor(item){\n  if(!item) return '';\n  const kind = (item.type==='tv' || item.libraryType==='show') ? 'show' : 'movie';\n  const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\n  return id ? `${kind}:${id}` : '';\n}\n\nexport function isSaved(item){ return saved.has(idFor(item)); }\nexport function count(){ return saved.size; }\nexport function toggle(item){ const k=idFor(item); if(!k) return; if(saved.has(k)) saved.delete(k); else saved.add(k); persist(); renderCount(); }\n\nexport function renderCount(){ const el=document.getElementById('watchlistCount'); if(el) el.textContent = String(count()); }\n\nexport function openPanel(){ const p=document.getElementById('watchlistPanel'); if(p) { p.hidden=false; p.setAttribute('aria-hidden','false'); renderPanel(); } }\nexport function closePanel(){ const p=document.getElementById('watchlistPanel'); if(p){ p.hidden=true; p.setAttribute('aria-hidden','true'); } setExpanded(false); }\n\nexport function clear(){ saved.clear(); persist(); renderCount(); renderPanel(); }\n\nexport function exportJson(){\n  const items = listItems();\n  const data = JSON.stringify(items, null, 2);\n  const blob = new Blob([data], { type:'application/json' });\n  const a = document.createElement('a');\n  a.href = URL.createObjectURL(blob);\n  a.download = 'watchlist.json';\n  document.body.append(a); a.click(); a.remove();\n  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);\n}\n\nfunction listItems(){\n  const s = getState();\n  const pool = (s.movies||[]).concat(s.shows||[]);\n  const map = new Map(pool.map(it=>[idFor(it), it]));\n  return Array.from(saved.values()).map(k=>map.get(k)).filter(Boolean);\n}\n\nexport function renderPanel(){\n  const list = document.getElementById('watchlistItems');\n  const empty = document.getElementById('watchlistEmpty');\n  if(!list || !empty) return;\n  const items = listItems();\n  if(items.length===0){ list.replaceChildren(); empty.hidden=false; return; }\n  empty.hidden=true;\n  const frag = document.createDocumentFragment();\n  items.forEach(item=>{\n    const li = document.createElement('li');\n    li.className = 'watchlist-item';\n    const t = document.createElement('span');\n    t.className='title';\n    t.textContent = item.title || '';\n    const rm = document.createElement('button');\n    rm.textContent = 'Entfernen';\n    rm.addEventListener('click', ()=>{ toggle(item); renderPanel(); });\n    const open = document.createElement('button');\n    open.textContent = '\u00D6ffnen';\n    open.addEventListener('click', ()=>{\n      const kind = (item.type==='tv') ? 'show' : 'movie';\n      const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\n      if(id) location.hash = `#/${kind}/${id}`;\n    });\n    li.append(t, open, rm);\n    frag.append(li);\n  });\n  list.replaceChildren(frag);\n}\n\nexport function initUi(){\n  load();\n  renderCount();\n  const openBtn = document.getElementById('openWatchlist');\n  const toggleBtn = document.getElementById('watchlistToggle');\n  const closeBtn = document.getElementById('closeWatchlist');\n  const clearBtn = document.getElementById('clearWatchlist');\n  const exportBtn = document.getElementById('exportWatchlist');\n  openBtn && openBtn.addEventListener('click', ()=>{ openPanel(); setExpanded(true); });\n  toggleBtn && toggleBtn.addEventListener('click', ()=>{ const p=document.getElementById('watchlistPanel'); if(p && !p.hidden){ closePanel(); } else { openPanel(); setExpanded(true); } });\n  closeBtn && closeBtn.addEventListener('click', ()=>{ closePanel(); });\n  clearBtn && clearBtn.addEventListener('click', ()=>{ clear(); });\n  exportBtn && exportBtn.addEventListener('click', ()=>{ exportJson(); });\n}\n\nfunction setExpanded(on){ const t=document.getElementById('watchlistToggle'); if(t) t.setAttribute('aria-expanded', on?'true':'false'); }\n", "import { prefixShowThumb } from '../data.js';\n\nexport function renderSeasonsAccordion(targetOrSeasons, maybeSeasons){\n  const root = resolveTarget(targetOrSeasons, maybeSeasons);\n  if(!root) return;\n  const seasons = Array.isArray(targetOrSeasons) && !isTarget(targetOrSeasons)\n    ? (targetOrSeasons || [])\n    : (Array.isArray(maybeSeasons) ? maybeSeasons : []);\n  root.replaceChildren();\n  (seasons||[]).forEach((s, idx)=> root.append(seasonCardEl(s, idx)));\n}\n\nfunction isTarget(value){\n  return value instanceof Element || typeof value === 'string';\n}\n\nfunction resolveTarget(targetOrSeasons, maybeSeasons){\n  if(isTarget(targetOrSeasons)){\n    if(targetOrSeasons instanceof Element) return targetOrSeasons;\n    if(typeof targetOrSeasons === 'string') return document.querySelector(targetOrSeasons);\n  }\n  if(isTarget(maybeSeasons)){\n    if(maybeSeasons instanceof Element) return maybeSeasons;\n    if(typeof maybeSeasons === 'string') return document.querySelector(maybeSeasons);\n  }\n  return document.getElementById('seasonsAccordion');\n}\n\nfunction seasonCardEl(season, idx){\n  prefixShowThumb(season);\n  const card = document.createElement('article'); card.className='season-card';\n  const head = document.createElement('div'); head.className='season-head';\n  const th = document.createElement('div'); th.className='season-thumb';\n  const img = new Image(); img.loading='lazy'; img.decoding='async';\n  img.src = season.thumbFile || '';\n  img.alt = season.title || `Staffel ${season.seasonNumber||idx+1}`;\n  th.append(img);\n  const txt = document.createElement('div');\n  const title = document.createElement('div'); title.className='season-title'; title.textContent = season.title || `Staffel ${season.seasonNumber||idx+1}`;\n  const sub = document.createElement('div'); sub.className='season-sub';\n  const year = season.year || season.releaseYear || '';\n  const epCount = Array.isArray(season.episodes) ? season.episodes.length : (season.episodeCount || 0);\n  sub.textContent = [year, epCount ? `${epCount} Episoden` : ''].filter(Boolean).join(' \u2022 ');\n  txt.append(title, sub);\n  const chev = document.createElement('div'); chev.className='chev'; chev.textContent = '\u203A';\n  head.append(th, txt, chev);\n  const body = document.createElement('div'); body.className='season-body';\n  (season.episodes||[]).forEach(ep => { prefixShowThumb(ep); body.append(episodeRowEl(ep)); });\n  head.addEventListener('click', ()=> card.classList.toggle('open'));\n  card.append(head, body);\n  return card;\n}\n\nfunction episodeRowEl(ep){\n  const row = document.createElement('div'); row.className='episode';\n  const title = document.createElement('div'); title.className='ep-title';\n  const sNum = ep.seasonNumber != null ? Number(ep.seasonNumber) : null;\n  const eNum = ep.episodeNumber != null ? Number(ep.episodeNumber) : null;\n  const code = (ep.seasonEpisode && String(ep.seasonEpisode).toUpperCase()) || (Number.isFinite(sNum) && Number.isFinite(eNum) ? `S${String(sNum).padStart(2,'0')}E${String(eNum).padStart(2,'0')}` : '');\n  title.textContent = `${code ? code + ' \u2022 ' : ''}${ep.title || ''}`;\n  const right = document.createElement('div'); right.className='badges';\n  const r = Number(ep.audienceRating ?? ep.rating);\n  if(Number.isFinite(r)){ const b=document.createElement('span'); b.className='badge'; b.textContent = `${r.toFixed(1)}`; right.append(b); }\n  const meta = document.createElement('div'); meta.className='ep-meta';\n  const durMin = ep.durationMin || (ep.duration ? Math.round(Number(ep.duration)/60000) : null);\n  const durText = ep.durationHuman || (durMin ? `${durMin} min` : null);\n  const dateText = ep.originallyAvailableAt || ep.date || '';\n  meta.textContent = [durText, dateText].filter(Boolean).join(' \u2022 ');\n  row.append(title, right, meta);\n  return row;\n}\n\n", "import { prefixShowThumb } from '../data.js';\n\nfunction deepClone(value){\n  if(value == null || typeof value !== 'object') return value;\n  if(typeof structuredClone === 'function'){\n    try{ return structuredClone(value); }\n    catch{}\n  }\n  try{ return JSON.parse(JSON.stringify(value)); }\n  catch{}\n  if(Array.isArray(value)) return value.map(entry => deepClone(entry));\n  const out = {};\n  for(const key of Object.keys(value)){\n    out[key] = deepClone(value[key]);\n  }\n  return out;\n}\n\nexport function mapMovie(item){\n  if(!item || typeof item !== 'object') return null;\n  const clone = deepClone(item);\n  if(clone.type === 'show') clone.type = 'tv';\n  if(!clone.type) clone.type = 'movie';\n  return clone;\n}\n\nexport function mapShow(item){\n  if(!item || typeof item !== 'object') return null;\n  const clone = deepClone(item);\n  if(clone.type !== 'tv') clone.type = 'tv';\n  normalizeShow(clone);\n  return clone;\n}\n\nexport function mapDetail(detail){\n  if(!detail || typeof detail !== 'object') return null;\n  const clone = deepClone(detail);\n  normalizeShow(clone);\n  return clone;\n}\n\nexport function needsShowDetail(item){\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\n  const hasEpisodes = seasons.some(season => Array.isArray(season?.episodes) && season.episodes.length);\n  const cast = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\n  return !seasons.length || !hasEpisodes || !cast.length;\n}\n\nexport function mergeShowDetail(target, detail){\n  if(!target) return target;\n  if(detail && typeof detail === 'object'){\n    const mapped = mapDetail(detail);\n    Object.assign(target, mapped);\n  }\n  normalizeShow(target);\n  return target;\n}\n\nexport function normalizeShow(show){\n  if(!show || typeof show !== 'object') return;\n  normalizeThumbField(show);\n  show.genres = normalizeGenresList(show.genres);\n  const cast = normalizePeopleList(show.cast || show.roles || []);\n  show.cast = cast;\n  show.roles = cast;\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeasonEntry).filter(Boolean) : [];\n  const sc = Number(show.seasonCount);\n  show.seasonCount = Number.isFinite(sc) && sc > 0 ? sc : show.seasons.length;\n}\n\nfunction normalizeSeasonEntry(season){\n  if(!season || typeof season !== 'object') return null;\n  const out = { ...season };\n  normalizeThumbField(out);\n  out.genres = normalizeGenresList(out.genres);\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisodeEntry).filter(Boolean) : [];\n  return out;\n}\n\nfunction normalizeEpisodeEntry(ep){\n  if(!ep || typeof ep !== 'object') return null;\n  const out = { ...ep };\n  normalizeThumbField(out);\n  out.genres = normalizeGenresList(out.genres);\n  return out;\n}\n\nfunction normalizeThumbField(obj){\n  prefixShowThumb(obj);\n}\n\nexport function normalizeGenresList(list){\n  if(!Array.isArray(list)) return [];\n  const seen = new Set();\n  const result = [];\n  list.forEach(entry => {\n    let item = null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      if(tag) item = { tag };\n    }else if(entry && typeof entry === 'object'){\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\n      if(tag){ item = { ...entry, tag }; }\n    }\n    if(item && !seen.has(item.tag)){\n      seen.add(item.tag);\n      result.push(item);\n    }\n  });\n  return result;\n}\n\nexport function normalizePeopleList(list){\n  if(!Array.isArray(list)) return [];\n  return list.map(entry => {\n    if(!entry) return null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      return tag ? { tag } : null;\n    }\n    if(typeof entry === 'object'){\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\n      return tag ? { ...entry, tag } : { ...entry };\n    }\n    return null;\n  }).filter(Boolean);\n}\n", "import { renderSeasonsAccordion } from './modal/seasonsAccordion.js';\nimport { formatRating, humanYear, isNew, useTmdbOn } from './utils.js';\nimport { getState } from './state.js';\nimport { loadShowDetail } from './data.js';\nimport { mapMovie, mapShow, mergeShowDetail, needsShowDetail } from './modal/shared.js';\n\nconst TMDB_PROFILE_BASE = 'https://image.tmdb.org/t/p/';\nconst TMDB_PROFILE_SIZE = 'w185';\n\nlet overlayContainer = null;\nlet dialogEl = null;\nlet scrollContainer = null;\nlet rootEl = null;\nlet lastActiveElement = null;\nlet focusTrapHandler = null;\nlet escapeHandler = null;\nlet renderToken = 0;\nlet currentKind = null;\nlet currentItem = null;\n\nconst DEMO_MOVIE = {\n  type: 'movie',\n  title: 'Lumen: Der Aufbruch',\n  tagline: 'Eine cineastische Demo f\u00FCr das neue Modal',\n  overview: 'Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\u00FCllt dabei eine Energiequelle, die alles ver\u00E4ndern k\u00F6nnte. Zwischen Loyalit\u00E4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\u00FCr das Cinematic-Layout entworfen wurde.',\n  summary: 'Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\u00E4ndern k\u00F6nnte.',\n  runtimeMin: 142,\n  contentRating: 'FSK 12',\n  studio: 'Aurora Pictures',\n  rating: 8.4,\n  audienceRating: 8.0,\n  userRating: 8.7,\n  originallyAvailableAt: '2024-05-17',\n  countries: [{ tag: 'Deutschland' }, { tag: 'Kanada' }],\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }, { tag: 'Abenteuer' }],\n  cast: [\n    { name: 'Mara Lenz', role: 'Captain Alys Vega', tmdbProfile: '/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg' },\n    { name: 'Tariq Benassi', role: 'Navigator Elian Soh', tmdbProfile: '/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg' },\n    { name: 'Hannah Ko', role: 'Wissenschaftlerin Dr. Mira Han', tmdbProfile: '/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg' },\n  ],\n  directors: [{ tag: 'Jonas Falk' }],\n  writers: [{ tag: 'Lea Winter' }],\n  producers: [{ tag: 'Studio Atlas' }],\n  labels: [{ tag: 'Dolby Atmos' }, { tag: '4K' }],\n  collections: [{ tag: 'Aurora-Saga' }],\n  trailer: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg',\n  ids: { tmdb: 'demo-lumen', imdb: 'tt0000001' },\n  addedAt: '2024-06-01T12:00:00Z',\n};\n\nconst DEMO_SERIES = {\n  type: 'tv',\n  title: 'Aurora Station',\n  tagline: 'Neue Horizonte in Serie',\n  overview: 'Die Besatzung der Aurora Station sch\u00FCtzt eine Au\u00DFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\u00E4tsel mit pers\u00F6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.',\n  summary: 'Ein orbitaler Au\u00DFenposten ringt um Hoffnung und Zusammenhalt, w\u00E4hrend eine fremde Macht erwacht.',\n  contentRating: 'TV-14',\n  studio: 'Nebula Network',\n  originallyAvailableAt: '2023-09-14',\n  seasonCount: 2,\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }],\n  countries: [{ tag: 'USA' }, { tag: 'Island' }],\n  creators: [{ tag: 'Elina S\u00F8rensen' }],\n  cast: [\n    { name: 'Noah Adler', role: 'Commander Ivar Hale', tmdbProfile: '/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg' },\n    { name: 'Sofia Idris', role: 'Ingenieurin Kaia Rhee', tmdbProfile: '/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg' },\n    { name: 'Helena Ruiz', role: 'Strategin Tala Voss', tmdbProfile: '/ziEuG1ESSofxDCspotYlrwz3Tq.png' },\n  ],\n  seasons: [\n    {\n      title: 'Staffel 1',\n      seasonNumber: 1,\n      year: 2023,\n      thumbFile: 'https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg',\n      episodes: [\n        {\n          title: 'Kapitel Eins: Erwachen',\n          seasonNumber: 1,\n          episodeNumber: 1,\n          durationMin: 54,\n          originallyAvailableAt: '2023-09-14',\n          audienceRating: 8.6,\n        },\n        {\n          title: 'Kapitel Zwei: Grenzwelten',\n          seasonNumber: 1,\n          episodeNumber: 2,\n          durationMin: 52,\n          originallyAvailableAt: '2023-09-21',\n          audienceRating: 8.2,\n        },\n      ],\n    },\n    {\n      title: 'Staffel 2',\n      seasonNumber: 2,\n      year: 2024,\n      thumbFile: 'https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg',\n      episodes: [\n        {\n          title: 'Kapitel Dreizehn: Resonanz',\n          seasonNumber: 2,\n          episodeNumber: 1,\n          durationMin: 56,\n          originallyAvailableAt: '2024-02-08',\n          audienceRating: 8.9,\n        },\n        {\n          title: 'Kapitel Vierzehn: Echo',\n          seasonNumber: 2,\n          episodeNumber: 2,\n          durationMin: 55,\n          originallyAvailableAt: '2024-02-15',\n          audienceRating: 8.7,\n        },\n      ],\n    },\n  ],\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg',\n  ids: { tmdb: 'demo-aurora-station', imdb: 'tt0000002' },\n};\n\nfunction resolveRoot(){\n  if(rootEl) return rootEl;\n  const container = document.getElementById('modal-root-v2');\n  if(!container) return null;\n  overlayContainer = container;\n  container.classList.add('modalv2-overlay');\n  if(!container.hasAttribute('hidden')) container.setAttribute('hidden', '');\n  if(!container.dataset.modalv2Ready){\n    container.innerHTML = `\n      <div class=\"modalv2-backdrop\" data-modalv2-backdrop=\"1\"></div>\n      <div class=\"modalv2-dialog\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"modalv2-scroll\" data-modalv2-scroll></div>\n      </div>\n    `;\n    container.dataset.modalv2Ready = '1';\n    container.addEventListener('click', onOverlayClick);\n  }\n  dialogEl = container.querySelector('.modalv2-dialog');\n  if(dialogEl && !dialogEl.hasAttribute('tabindex')) dialogEl.setAttribute('tabindex', '-1');\n  scrollContainer = container.querySelector('[data-modalv2-scroll]');\n  if(scrollContainer && !rootEl){\n    const existing = scrollContainer.querySelector('.modalv2');\n    if(existing) rootEl = existing;\n    else {\n      rootEl = document.createElement('div');\n      rootEl.className = 'modalv2';\n      rootEl.setAttribute('hidden', '');\n      scrollContainer.appendChild(rootEl);\n    }\n  }\n  return rootEl;\n}\n\nfunction onOverlayClick(ev){\n  if(!overlayContainer) return;\n  const target = ev.target;\n  if(target === overlayContainer || (target && target.dataset && target.dataset.modalv2Backdrop)){ closeModalV2(); }\n}\n\nfunction getFocusableElements(){\n  if(!dialogEl) return [];\n  const selectors = 'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex=\"-1\"])';\n  return Array.from(dialogEl.querySelectorAll(selectors)).filter(el=>{\n    if(el.hasAttribute('disabled')) return false;\n    if(el.getAttribute('aria-hidden') === 'true') return false;\n    if(el.hasAttribute('hidden')) return false;\n    return el.offsetParent !== null;\n  });\n}\n\nfunction bindFocusTrap(){\n  if(!dialogEl) return;\n  if(focusTrapHandler){ dialogEl.removeEventListener('keydown', focusTrapHandler); }\n  focusTrapHandler = (ev)=>{\n    if(ev.key !== 'Tab') return;\n    const focusables = getFocusableElements();\n    if(!focusables.length) return;\n    const first = focusables[0];\n    const last = focusables[focusables.length - 1];\n    if(ev.shiftKey){\n      if(document.activeElement === first){ ev.preventDefault(); last.focus(); }\n    }else if(document.activeElement === last){\n      ev.preventDefault(); first.focus();\n    }\n  };\n  dialogEl.addEventListener('keydown', focusTrapHandler);\n}\n\nfunction unbindFocusTrap(){\n  if(!dialogEl || !focusTrapHandler) return;\n  dialogEl.removeEventListener('keydown', focusTrapHandler);\n  focusTrapHandler = null;\n}\n\nfunction bindEscape(){\n  if(escapeHandler) return;\n  escapeHandler = (ev)=>{\n    if(ev.key === 'Escape'){ ev.preventDefault(); closeModalV2(); }\n  };\n  window.addEventListener('keydown', escapeHandler);\n}\n\nfunction unbindEscape(){\n  if(!escapeHandler) return;\n  window.removeEventListener('keydown', escapeHandler);\n  escapeHandler = null;\n}\n\nfunction showOverlay(){\n  const root = resolveRoot();\n  if(!root || !overlayContainer) return null;\n  overlayContainer.hidden = false;\n  overlayContainer.setAttribute('aria-hidden', 'false');\n  document.body.classList.add('modalv2-open');\n  if(scrollContainer) scrollContainer.scrollTop = 0;\n  bindFocusTrap();\n  bindEscape();\n  return root;\n}\n\nfunction focusInitial(){\n  if(!dialogEl) return;\n  const closeBtn = dialogEl.querySelector('#v2Close');\n  const focusables = getFocusableElements();\n  let target = (closeBtn && !closeBtn.hasAttribute('hidden')) ? closeBtn : focusables[0];\n  if(!target) target = dialogEl;\n  if(target){\n    const focus = ()=>{ try{ target.focus(); }catch{} };\n    (window.requestAnimationFrame || setTimeout)(focus, 0);\n  }\n}\n\nfunction resolvePoster(item){\n  const tmdbPoster = item?.tmdb?.poster || item?.tmdbPoster;\n  const localPoster = item?.poster || item?.thumbFile || item?.art || '';\n  return (useTmdbOn() && tmdbPoster) ? tmdbPoster : localPoster;\n}\n\nfunction runtimeText(item){\n  const minutes = item?.runtimeMin || item?.durationMin || (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\n  if(!Number.isFinite(minutes)) return '';\n  if(item?.type === 'tv'){ return `~${minutes} min/Ep`; }\n  return `${minutes} min`;\n}\n\nfunction ratingText(item){\n  const rating = Number(item?.rating ?? item?.audienceRating);\n  if(!Number.isFinite(rating)) return '';\n  return `\u2605 ${formatRating(rating)}`;\n}\n\nfunction studioText(item){\n  return item?.studio || item?.network || item?.studioName || '';\n}\n\nfunction releaseDateText(item){\n  const candidates = [\n    item?.originallyAvailableAt,\n    item?.releaseDate,\n    item?.premiereDate,\n    item?.firstAired,\n    item?.airDate,\n  ];\n  for(const raw of candidates){\n    const str = raw == null ? '' : String(raw).trim();\n    if(!str) continue;\n    const parsed = new Date(str);\n    if(Number.isFinite(parsed.getTime())){\n      try{\n        return parsed.toLocaleDateString('de-DE', { year:'numeric', month:'2-digit', day:'2-digit' });\n      }catch{}\n    }\n    const iso = str.match(/^\\d{4}-\\d{2}-\\d{2}/);\n    if(iso && iso[0]) return iso[0];\n    if(str.length >= 4) return str.slice(0, 10);\n  }\n  const year = humanYear(item);\n  return year ? String(year) : '';\n}\n\nfunction namesFromList(source){\n  if(!Array.isArray(source)) return [];\n  return source.map(entry=>{\n    if(!entry) return '';\n    if(typeof entry === 'string') return entry;\n    return entry.tag || entry.title || entry.name || '';\n  }).filter(Boolean);\n}\n\nfunction genresFromItem(item){\n  const arr = Array.isArray(item?.genres) ? item.genres : [];\n  const mapped = arr.map(entry=>{\n    if(!entry) return '';\n    if(typeof entry === 'string') return entry;\n    return entry.tag || entry.title || entry.name || '';\n  }).filter(Boolean);\n  return Array.from(new Set(mapped));\n}\n\nfunction buildChips(item){\n  const chips = [];\n  if(isNew(item)) chips.push('Neu');\n  if(item?.type === 'tv' && Number.isFinite(Number(item?.seasonCount))){\n    chips.push(`Staffeln: ${item.seasonCount}`);\n  }\n  const genres = (item?.genres || []).map(entry=>{\n    if(!entry) return '';\n    if(typeof entry === 'string') return entry;\n    return entry.tag || entry.title || entry.name || '';\n  }).filter(Boolean);\n  genres.forEach(genre=> chips.push(genre));\n  return chips;\n}\n\nfunction buildCastList(item){\n  const source = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\n  return source.map(person=>{\n    if(!person) return null;\n    if(typeof person === 'string'){\n      const name = String(person).trim();\n      if(!name) return null;\n      return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\n    }\n    const name = String(person.tag || person.name || person.role || '').trim();\n    if(!name) return null;\n    const role = (()=>{\n      const rawRole = String(person.role || '').trim();\n      if(!rawRole) return '';\n      return rawRole.toLowerCase() === name.toLowerCase() ? '' : rawRole;\n    })();\n    const tmdbProfile = [\n      person?.tmdb?.profile,\n      person?.tmdb?.profile_path,\n      person?.tmdb?.profilePath,\n      person?.tmdbProfile,\n      person?.profile,\n      person?.profile_path,\n      person?.profilePath,\n    ].find(val => typeof val === 'string' && val.trim());\n    const thumb = [person?.thumb, person?.photo, person?.image].find(val => typeof val === 'string' && val.trim()) || '';\n    return {\n      name,\n      role,\n      thumb,\n      tmdbProfile: tmdbProfile ? String(tmdbProfile).trim() : '',\n      raw: person,\n    };\n  }).filter(Boolean);\n}\n\nfunction normalizeTmdbProfile(path){\n  const str = String(path || '').trim();\n  if(!str) return '';\n  if(/^https?:\\/\\//i.test(str)) return str;\n  if(str.startsWith('//')) return `https:${str}`;\n  const suffix = str.startsWith('/') ? str : `/${str}`;\n  return `${TMDB_PROFILE_BASE}${TMDB_PROFILE_SIZE}${suffix}`;\n}\n\nfunction normalizeLocalImage(path){\n  const str = String(path || '').trim();\n  if(!str) return '';\n  if(/^https?:\\/\\//i.test(str) || str.startsWith('data:')) return str;\n  if(str.startsWith('//')) return `https:${str}`;\n  return str;\n}\n\nfunction resolveCastImage(entry, tmdbEnabled){\n  if(!entry) return '';\n  const raw = entry.raw || {};\n  if(tmdbEnabled){\n    const tmdbCandidates = [\n      entry.tmdbProfile,\n      raw?.tmdb?.profile,\n      raw?.tmdb?.profile_path,\n      raw?.tmdb?.profilePath,\n      raw?.tmdbProfile,\n      raw?.profile,\n      raw?.profile_path,\n      raw?.profilePath,\n    ];\n    for(const candidate of tmdbCandidates){\n      const url = normalizeTmdbProfile(candidate);\n      if(url) return url;\n    }\n  }\n  const localCandidates = [entry.thumb, raw?.thumb, raw?.photo, raw?.image];\n  for(const candidate of localCandidates){\n    const url = normalizeLocalImage(candidate);\n    if(url) return url;\n  }\n  return '';\n}\n\nfunction castInitials(name){\n  const str = String(name || '').trim();\n  if(!str) return '?';\n  const parts = str.split(/\\s+/).slice(0, 2);\n  const chars = parts.map(part => part.charAt(0)).filter(Boolean);\n  return chars.length ? chars.join('').toUpperCase() : str.charAt(0).toUpperCase();\n}\n\nfunction applyTabs(root){\n  const tabs = root.querySelector('.v2-tabs');\n  if(!tabs) return;\n  const buttons = Array.from(tabs.querySelectorAll('button[data-t]'));\n  const select = (target)=>{\n    buttons.forEach(btn=>{\n      const isActive = btn.dataset.t === target;\n      btn.classList.toggle('active', isActive);\n      btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\n      btn.tabIndex = isActive ? 0 : -1;\n      const pane = root.querySelector(`.v2-pane[data-pane=\"${btn.dataset.t}\"]`);\n      if(pane){\n        pane.hidden = !isActive;\n        pane.setAttribute('aria-hidden', pane.hidden ? 'true' : 'false');\n      }\n    });\n  };\n  const moveFocus = (current, delta)=>{\n    if(!buttons.length) return;\n    const currentIndex = buttons.indexOf(current);\n    const fallbackIndex = delta > 0 ? 0 : buttons.length - 1;\n    const index = currentIndex === -1 ? fallbackIndex : (currentIndex + delta + buttons.length) % buttons.length;\n    const next = buttons[index];\n    if(next){\n      next.focus();\n      select(next.dataset.t);\n    }\n  };\n  tabs.addEventListener('click', ev=>{\n    const btn = ev.target.closest('button[data-t]');\n    if(!btn) return;\n    ev.preventDefault();\n    select(btn.dataset.t);\n  });\n  tabs.addEventListener('keydown', ev=>{\n    const btn = ev.target.closest('button[data-t]');\n    if(!btn) return;\n    switch(ev.key){\n      case 'ArrowLeft':\n      case 'ArrowUp':\n        ev.preventDefault();\n        moveFocus(btn, -1);\n        break;\n      case 'ArrowRight':\n      case 'ArrowDown':\n        ev.preventDefault();\n        moveFocus(btn, 1);\n        break;\n      case 'Home':\n        ev.preventDefault();\n        if(buttons[0]){\n          buttons[0].focus();\n          select(buttons[0].dataset.t);\n        }\n        break;\n      case 'End':\n        ev.preventDefault();\n        if(buttons.length){\n          const last = buttons[buttons.length - 1];\n          last.focus();\n          select(last.dataset.t);\n        }\n        break;\n      default:\n        break;\n    }\n  });\n  const initial = buttons.find(btn=> btn.classList.contains('active')) || buttons[0];\n  if(initial) select(initial.dataset.t);\n}\n\nfunction updateCast(root, cast){\n  const pane = root.querySelector('.v2-cast');\n  if(!pane) return;\n  pane.innerHTML = '<div class=\"v2-cast-scroll\"></div>';\n  const scroll = pane.querySelector('.v2-cast-scroll');\n  if(!scroll) return;\n  const limited = Array.isArray(cast) ? cast.slice(0, 12) : [];\n  if(!limited.length){\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\n    scroll.removeAttribute('role');\n    return;\n  }\n  scroll.setAttribute('role', 'list');\n  const tmdbEnabled = useTmdbOn();\n  limited.forEach(entry=>{\n    const data = (entry && typeof entry === 'object' && 'name' in entry)\n      ? entry\n      : (()=>{\n          const name = String(entry || '').trim();\n          if(!name) return null;\n          return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\n        })();\n    if(!data || !data.name) return;\n\n    const card = document.createElement('article');\n    card.className = 'v2-cast-card';\n    card.tabIndex = 0;\n    card.setAttribute('role', 'listitem');\n\n    const roleText = String(data.role || '').trim();\n    card.setAttribute('aria-label', roleText ? `${data.name} \u2013 ${roleText}` : data.name);\n\n    const avatar = document.createElement('div');\n    avatar.className = 'v2-cast-avatar';\n    const imageSrc = resolveCastImage(data, tmdbEnabled);\n    if(imageSrc){\n      avatar.classList.add('has-image');\n      const img = document.createElement('img');\n      img.src = imageSrc;\n      img.alt = data.name;\n      img.loading = 'lazy';\n      img.decoding = 'async';\n      avatar.appendChild(img);\n    }else{\n      const initials = document.createElement('span');\n      initials.className = 'v2-cast-initials';\n      initials.textContent = castInitials(data.name);\n      initials.setAttribute('aria-hidden', 'true');\n      avatar.appendChild(initials);\n    }\n\n    const nameLine = document.createElement('p');\n    nameLine.className = 'v2-cast-name';\n    nameLine.textContent = data.name;\n\n    card.append(avatar, nameLine);\n\n    if(roleText){\n      const roleLine = document.createElement('p');\n      roleLine.className = 'v2-cast-role';\n      roleLine.textContent = roleText;\n      card.append(roleLine);\n    }else{\n      card.classList.add('v2-cast-card--no-role');\n    }\n    scroll.appendChild(card);\n  });\n\n  if(!scroll.children.length){\n    scroll.innerHTML = '<span class=\"modalv2-loading\">Keine Besetzungsdaten verf\u00FCgbar.</span>';\n    scroll.removeAttribute('role');\n  }\n}\n\nfunction updateOverview(root, text){\n  const pane = root.querySelector('.v2-overview');\n  if(!pane) return;\n\n  const overview = typeof text === 'string' ? text : '';\n\n  if(!overview){\n    pane.textContent = '';\n    return;\n  }\n\n  const paragraph = document.createElement('p');\n  paragraph.className = 'v2-overview-text line-clamp line-clamp-5';\n  paragraph.textContent = overview;\n\n  const toggle = document.createElement('button');\n  toggle.type = 'button';\n  toggle.className = 'v2-overview-toggle';\n\n  const setExpanded = (expanded)=>{\n    paragraph.classList.toggle('is-expanded', expanded);\n    toggle.setAttribute('aria-expanded', String(expanded));\n    toggle.textContent = expanded ? 'Weniger anzeigen' : 'Mehr anzeigen';\n  };\n\n  toggle.addEventListener('click', ()=>{\n    const expanded = toggle.getAttribute('aria-expanded') === 'true';\n    setExpanded(!expanded);\n  });\n\n  pane.replaceChildren(paragraph, toggle);\n  setExpanded(false);\n\n  const measure = ()=>{\n    const overflowing = paragraph.scrollHeight > paragraph.clientHeight + 1;\n    if(!overflowing){\n      paragraph.classList.add('is-expanded');\n      toggle.hidden = true;\n    }\n  };\n  const schedule = typeof requestAnimationFrame === 'function' ? requestAnimationFrame : (cb)=>setTimeout(cb, 0);\n  schedule(measure);\n}\n\nfunction updateDetails(root, item){\n  const pane = root.querySelector('.v2-details');\n  if(!pane) return;\n  pane.replaceChildren();\n\n  const grid = document.createElement('div');\n  grid.className = 'v2-details-grid';\n\n  const general = [];\n  const release = releaseDateText(item);\n  if(release) general.push(['Ver\u00F6ffentlichung', release]);\n  const runtime = runtimeText(item);\n  if(runtime) general.push(['Laufzeit', runtime]);\n  const studio = studioText(item);\n  if(studio) general.push(['Studio', studio]);\n  const certification = (item?.contentRating || '').trim();\n  if(certification) general.push(['Freigabe', certification]);\n  const critic = formatRating(item?.rating);\n  const audience = formatRating(item?.audienceRating);\n  const user = formatRating(item?.userRating);\n  if(critic){\n    general.push(['Bewertung', `\u2605 ${critic}`]);\n    if(audience && audience !== critic) general.push(['Publikum', `\u2605 ${audience}`]);\n  }else if(audience){\n    general.push(['Bewertung', `\u2605 ${audience}`]);\n  }\n  if(user) general.push(['Eigene Wertung', `\u2605 ${user}`]);\n\n  if(item?.type === 'tv'){\n    const numericSeasons = Number(item?.seasonCount);\n    const seasonCount = Number.isFinite(numericSeasons) ? numericSeasons : (Array.isArray(item?.seasons) ? item.seasons.length : null);\n    if(Number.isFinite(seasonCount) && seasonCount > 0){\n      general.push(['Staffeln', String(seasonCount)]);\n    }\n    const episodeCount = Array.isArray(item?.seasons) ? item.seasons.reduce((sum, season)=>{\n      if(!season) return sum;\n      const eps = Array.isArray(season.episodes) ? season.episodes.length : 0;\n      return sum + (Number.isFinite(eps) ? eps : 0);\n    }, 0) : null;\n    if(Number.isFinite(episodeCount) && episodeCount > 0){\n      general.push(['Episoden', String(episodeCount)]);\n    }\n  }\n\n  const countries = namesFromList(item?.countries);\n  if(countries.length) general.push(['L\u00E4nder', countries.join(', ')]);\n  const collections = namesFromList(item?.collections);\n  if(collections.length) general.push(['Sammlungen', collections.join(', ')]);\n  const labels = namesFromList(item?.labels);\n  if(labels.length) general.push(['Labels', labels.join(', ')]);\n  if(item?.editionTitle) general.push(['Edition', item.editionTitle]);\n  if(item?.originalTitle && item.originalTitle !== item.title) general.push(['Originaltitel', item.originalTitle]);\n\n  if(general.length){\n    const section = document.createElement('section');\n    section.className = 'v2-details-section';\n    section.dataset.section = 'general';\n    const heading = document.createElement('h3');\n    heading.className = 'v2-details-heading';\n    heading.textContent = 'Allgemein';\n    const list = document.createElement('dl');\n    list.className = 'v2-details-list';\n    general.forEach(([label, value])=>{\n      if(!label || !value) return;\n      const dt = document.createElement('dt');\n      dt.textContent = label;\n      const dd = document.createElement('dd');\n      dd.textContent = value;\n      list.append(dt, dd);\n    });\n    if(list.childElementCount){\n      section.append(heading, list);\n      grid.append(section);\n    }\n  }\n\n  const genres = genresFromItem(item);\n  if(genres.length){\n    const section = document.createElement('section');\n    section.className = 'v2-details-section';\n    section.dataset.section = 'genres';\n    const heading = document.createElement('h3');\n    heading.className = 'v2-details-heading';\n    heading.textContent = 'Genres';\n    const chips = document.createElement('div');\n    chips.className = 'v2-chip-group';\n    genres.forEach(name=>{\n      const span = document.createElement('span');\n      span.className = 'chip';\n      span.textContent = name;\n      chips.appendChild(span);\n    });\n    section.append(heading, chips);\n    grid.append(section);\n  }\n\n  const crew = [];\n  const directors = namesFromList(item?.directors);\n  if(directors.length) crew.push(['Regie', directors.join(', ')]);\n  const writers = namesFromList(item?.writers);\n  if(writers.length) crew.push(['Drehbuch', writers.join(', ')]);\n  const producers = namesFromList(item?.producers);\n  if(producers.length) crew.push(['Produktion', producers.join(', ')]);\n  const creators = namesFromList(item?.creators || item?.showrunners);\n  if(item?.type === 'tv' && creators.length) crew.push(['Creator', creators.join(', ')]);\n\n  if(crew.length){\n    const section = document.createElement('section');\n    section.className = 'v2-details-section';\n    section.dataset.section = 'crew';\n    const heading = document.createElement('h3');\n    heading.className = 'v2-details-heading';\n    heading.textContent = 'Credits';\n    const list = document.createElement('dl');\n    list.className = 'v2-details-list';\n    crew.forEach(([label, value])=>{\n      if(!label || !value) return;\n      const dt = document.createElement('dt');\n      dt.textContent = label;\n      const dd = document.createElement('dd');\n      dd.textContent = value;\n      list.append(dt, dd);\n    });\n    if(list.childElementCount){\n      section.append(heading, list);\n      grid.append(section);\n    }\n  }\n\n  if(grid.childElementCount){\n    pane.appendChild(grid);\n  }else{\n    const fallback = document.createElement('p');\n    fallback.className = 'v2-details-empty';\n    fallback.textContent = 'Keine zus\u00E4tzlichen Details verf\u00FCgbar.';\n    pane.appendChild(fallback);\n  }\n}\n\nfunction updateSeasons(root, item){\n  const pane = root.querySelector('.v2-seasons');\n  if(!pane) return;\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\n  if(!seasons.length){\n    pane.innerHTML = '<p class=\"modalv2-loading\">Keine Staffel-Informationen verf\u00FCgbar.</p>';\n    return;\n  }\n  pane.innerHTML = '';\n  renderSeasonsAccordion(pane, seasons);\n}\n\nfunction setExternalLinks(root, item){\n  const tmdbBtn = root.querySelector('#v2Tmdb');\n  const imdbBtn = root.querySelector('#v2Imdb');\n  const trailerBtn = root.querySelector('#v2Trailer');\n  const tmdbId = item?.ids?.tmdb || item?.tmdbId;\n  const imdbId = item?.ids?.imdb || item?.imdbId;\n  const trailer = item?.trailer || item?.trailerUrl;\n  const type = item?.type === 'tv' ? 'tv' : 'movie';\n  if(tmdbBtn){\n    if(tmdbId){\n      tmdbBtn.hidden = false;\n      tmdbBtn.href = `https://www.themoviedb.org/${type}/${tmdbId}`;\n    }else{\n      tmdbBtn.hidden = true;\n      tmdbBtn.removeAttribute('href');\n    }\n  }\n  if(imdbBtn){\n    if(imdbId){\n      imdbBtn.hidden = false;\n      imdbBtn.href = `https://www.imdb.com/title/${imdbId}/`;\n    }else{\n      imdbBtn.hidden = true;\n      imdbBtn.removeAttribute('href');\n    }\n  }\n  if(trailerBtn){\n    if(trailer){\n      trailerBtn.hidden = false;\n      trailerBtn.onclick = ()=> window.open(trailer, '_blank', 'noopener');\n    }else{\n      trailerBtn.hidden = true;\n      trailerBtn.onclick = null;\n    }\n  }\n}\n\nfunction populateHead(root, item){\n  const titleEl = root.querySelector('.v2-title');\n  if(titleEl) titleEl.textContent = item?.title || item?.name || '';\n  const tagline = (item?.tagline || '').trim();\n  const metaEl = root.querySelector('.v2-meta');\n  const subEl = root.querySelector('.v2-subline');\n  const year = humanYear(item);\n  const runtime = runtimeText(item);\n  const rating = ratingText(item);\n  const studio = studioText(item);\n  const metaParts = [year, runtime, rating, studio].filter(Boolean);\n  if(subEl){\n    const fallback = metaParts.join(' \u2022 ');\n    subEl.textContent = tagline || fallback;\n    subEl.hidden = !(tagline || fallback);\n  }\n  if(metaEl){\n    metaEl.textContent = tagline && metaParts.length ? metaParts.join(' \u2022 ') : '';\n    metaEl.hidden = !(tagline && metaParts.length);\n  }\n  const chipsRoot = root.querySelector('.v2-chips');\n  if(chipsRoot){\n    chipsRoot.replaceChildren();\n    buildChips(item).forEach(text=>{\n      const span = document.createElement('span');\n      span.className = 'chip';\n      span.textContent = text;\n      chipsRoot.appendChild(span);\n    });\n    chipsRoot.hidden = !chipsRoot.childElementCount;\n  }\n  const quickFacts = root.querySelector('.v2-facts');\n  const quickList = root.querySelector('.v2-facts-list');\n  if(quickFacts && quickList){\n    const facts = [];\n    if(year) facts.push(['Jahr', year]);\n    const contentRating = (item?.contentRating || '').trim();\n    if(contentRating) facts.push(['Freigabe', contentRating]);\n    if(runtime) facts.push(['Laufzeit', runtime]);\n    if(rating) facts.push(['Bewertung', rating]);\n    if(studio) facts.push(['Studio', studio]);\n    quickList.replaceChildren();\n    facts.forEach(([label, value])=>{\n      const dt = document.createElement('dt');\n      dt.textContent = label;\n      const dd = document.createElement('dd');\n      dd.textContent = value;\n      quickList.append(dt, dd);\n    });\n    quickFacts.hidden = !facts.length;\n  }\n  const img = root.querySelector('.v2-poster img');\n  if(img){\n    const src = resolvePoster(item);\n    img.src = src || '';\n    img.alt = item?.title ? `Poster: ${item.title}` : '';\n    img.loading = 'lazy';\n    img.decoding = 'async';\n    img.classList.remove('is-ready');\n    if(src){\n      img.addEventListener('load', onPosterReady, { once:true });\n      img.addEventListener('error', onPosterReady, { once:true });\n    }else{\n      img.classList.add('is-ready');\n    }\n  }\n}\n\nfunction onPosterReady(ev){\n  ev.currentTarget?.classList.add('is-ready');\n}\n\nexport function showModalV2Loading(message='Details werden geladen \u2026'){\n  const root = showOverlay();\n  if(!root) return;\n  root.hidden = false;\n  root.innerHTML = `<div class=\"modalv2-loading\">${message}</div>`;\n}\n\nexport function renderModalV2(item){\n  const root = showOverlay();\n  if(!root) return;\n  root.hidden = false;\n  const hasSeasons = item?.type === 'tv';\n  root.innerHTML = `\n    <section class=\"v2-layout\">\n      <aside class=\"v2-side\">\n        <div class=\"v2-poster\"><img alt=\"\"></div>\n        <div class=\"v2-facts\" aria-label=\"Schnellinfos\" hidden>\n          <h3 class=\"v2-facts-title\">Schnellinfos</h3>\n          <dl class=\"v2-facts-list\"></dl>\n        </div>\n      </aside>\n      <div class=\"v2-info\">\n        <header class=\"v2-head\">\n          <div class=\"v2-titlebar\">\n            <div class=\"v2-title-wrap\">\n              <h2 class=\"v2-title\" id=\"modalV2Title\"></h2>\n              <div class=\"v2-subline\"></div>\n              <div class=\"v2-meta\"></div>\n            </div>\n            <div class=\"v2-actions\" aria-label=\"Externe Aktionen\">\n              <button class=\"v2-icon-btn\" id=\"v2Close\" type=\"button\" aria-label=\"Schlie\u00DFen\">\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n                  <path d=\"M6 6l12 12M6 18L18 6\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n                </svg>\n              </button>\n              <a class=\"v2-icon-btn\" id=\"v2Tmdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf TMDB \u00F6ffnen\" hidden>\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n                  <path d=\"M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\n                  <path d=\"M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n                </svg>\n              </a>\n              <a class=\"v2-icon-btn\" id=\"v2Imdb\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label=\"Auf IMDb \u00F6ffnen\" hidden>\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n                  <path d=\"M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\"></path>\n                </svg>\n              </a>\n              <button class=\"v2-icon-btn\" id=\"v2Trailer\" type=\"button\" aria-label=\"Trailer abspielen\" hidden>\n                <svg class=\"v2-icon\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\">\n                  <path d=\"M9 6l8 6-8 6V6z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.7\" stroke-linejoin=\"round\" stroke-linecap=\"round\"></path>\n                </svg>\n              </button>\n            </div>\n          </div>\n          <div class=\"v2-chips\" aria-label=\"Attribute\"></div>\n        </header>\n        <nav class=\"v2-tabs\" aria-label=\"Details Navigation\" role=\"tablist\">\n          <button type=\"button\" data-t=\"overview\" class=\"active\" id=\"v2TabOverview\" role=\"tab\" aria-controls=\"v2PaneOverview\" aria-selected=\"true\">\u00DCberblick</button>\n          <button type=\"button\" data-t=\"details\" id=\"v2TabDetails\" role=\"tab\" aria-controls=\"v2PaneDetails\" aria-selected=\"false\">Details</button>\n          ${hasSeasons ? '<button type=\"button\" data-t=\"seasons\" id=\"v2TabSeasons\" role=\"tab\" aria-controls=\"v2PaneSeasons\" aria-selected=\"false\">Staffeln</button>' : ''}\n          <button type=\"button\" data-t=\"cast\" id=\"v2TabCast\" role=\"tab\" aria-controls=\"v2PaneCast\" aria-selected=\"false\">Cast</button>\n        </nav>\n        <section class=\"v2-body\">\n          <div class=\"v2-pane v2-overview\" data-pane=\"overview\" id=\"v2PaneOverview\" role=\"tabpanel\" aria-labelledby=\"v2TabOverview\"></div>\n          <div class=\"v2-pane v2-details\" data-pane=\"details\" id=\"v2PaneDetails\" role=\"tabpanel\" aria-labelledby=\"v2TabDetails\" hidden></div>\n          ${hasSeasons ? '<div class=\"v2-pane v2-seasons\" data-pane=\"seasons\" id=\"v2PaneSeasons\" role=\"tabpanel\" aria-labelledby=\"v2TabSeasons\" hidden></div>' : ''}\n          <div class=\"v2-pane v2-cast\" data-pane=\"cast\" id=\"v2PaneCast\" role=\"tabpanel\" aria-labelledby=\"v2TabCast\" hidden></div>\n        </section>\n      </div>\n    </section>\n  `;\n\n  populateHead(root, item);\n  setExternalLinks(root, item);\n  updateOverview(root, item?.overview || item?.summary || '');\n  updateDetails(root, item);\n  if(item?.type === 'tv'){ updateSeasons(root, item); }\n  updateCast(root, buildCastList(item));\n  applyTabs(root);\n  const closeBtn = root.querySelector('#v2Close');\n  if(closeBtn){\n    closeBtn.addEventListener('click', closeModalV2);\n  }\n  if(dialogEl) dialogEl.setAttribute('aria-labelledby', 'modalV2Title');\n  focusInitial();\n}\n\nexport async function openMovieModalV2(idOrData){\n  const token = ++renderToken;\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n  const root = showOverlay();\n  if(!root) return;\n  const data = resolveMovieData(idOrData);\n  if(token !== renderToken) return;\n  if(!data){\n    root.hidden = false;\n    root.innerHTML = '<div class=\"modalv2-loading\">Film konnte nicht geladen werden.</div>';\n    currentItem = null;\n    currentKind = null;\n    focusInitial();\n    return;\n  }\n  currentItem = data;\n  currentKind = 'movie';\n  renderModalV2(data);\n}\n\nexport async function openSeriesModalV2(idOrData){\n  const token = ++renderToken;\n  lastActiveElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n  const base = resolveSeriesData(idOrData);\n  const root = showOverlay();\n  if(!root) return;\n  if(token !== renderToken) return;\n  if(!base){\n    root.hidden = false;\n    root.innerHTML = '<div class=\"modalv2-loading\">Seriendetails konnten nicht geladen werden.</div>';\n    currentItem = null;\n    currentKind = null;\n    focusInitial();\n    return;\n  }\n  currentItem = base;\n  currentKind = 'show';\n  let working = base;\n  if(needsShowDetail(working)){\n    showModalV2Loading();\n    if(token !== renderToken) return;\n    let detail = null;\n    try{ detail = await loadShowDetail(working); }\n    catch{ detail = null; }\n    if(token !== renderToken) return;\n    if(detail){ mergeShowDetail(working, detail); currentItem = working; }\n  }\n  if(token !== renderToken) return;\n  renderModalV2(working);\n}\n\nexport function closeModalV2(){\n  renderToken++;\n  if(!overlayContainer) return;\n  overlayContainer.hidden = true;\n  overlayContainer.setAttribute('aria-hidden', 'true');\n  document.body.classList.remove('modalv2-open');\n  unbindFocusTrap();\n  unbindEscape();\n  if(rootEl){\n    rootEl.innerHTML = '';\n    rootEl.setAttribute('hidden', '');\n  }\n  if(scrollContainer) scrollContainer.scrollTop = 0;\n  if(lastActiveElement && typeof lastActiveElement.focus === 'function'){\n    try{ lastActiveElement.focus(); }\n    catch{}\n  }\n  lastActiveElement = null;\n  currentItem = null;\n  currentKind = null;\n}\n\nexport function isModalV2Open(){\n  return Boolean(overlayContainer && !overlayContainer.hidden);\n}\n\nexport function getModalV2Context(){\n  return currentItem ? { item: currentItem, kind: currentKind } : { item: null, kind: null };\n}\n\nfunction resolveMovieData(idOrData){\n  if(idOrData === 'demo') return mapMovie(DEMO_MOVIE);\n  if(idOrData && typeof idOrData === 'object') return mapMovie(idOrData);\n  const str = idOrData == null ? '' : String(idOrData).trim();\n  if(!str) return null;\n  const state = getState();\n  const movies = Array.isArray(state?.movies) ? state.movies : [];\n  const match = movies.find(movie => matchesIdentifier(movie, str));\n  return match ? mapMovie(match) : null;\n}\n\nfunction resolveSeriesData(idOrData){\n  if(idOrData === 'demo') return mapShow(DEMO_SERIES);\n  if(idOrData && typeof idOrData === 'object') return mapShow(idOrData);\n  const str = idOrData == null ? '' : String(idOrData).trim();\n  if(!str) return null;\n  const state = getState();\n  const shows = Array.isArray(state?.shows) ? state.shows : [];\n  const match = shows.find(show => matchesIdentifier(show, str));\n  return match ? mapShow(match) : null;\n}\n\nfunction matchesIdentifier(item, id){\n  if(!item) return false;\n  const str = String(id || '').trim();\n  if(!str) return false;\n  if(item?.ids?.imdb && String(item.ids.imdb) === str) return true;\n  if(item?.ids?.tmdb && String(item.ids.tmdb) === str) return true;\n  if(item?.ratingKey != null && String(item.ratingKey) === str) return true;\n  return false;\n}\n", "import { getState } from './state.js';\nimport * as Filter from './filter.js';\nimport { el } from './dom.js';\nimport { humanYear, formatRating, renderChipsLimited, useTmdbOn, isNew, getGenreNames } from './utils.js';\nimport * as Watch from './watchlist.js';\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\n\nfunction cardEl(item){\n  const card = el('article','cardv2');\n  card.style.contentVisibility = 'auto';\n  card.dataset.kind = (item?.type === 'tv') ? 'show' : 'movie';\n  card.tabIndex = 0;\n  card.setAttribute('role', 'button');\n  if(item?.title) card.setAttribute('aria-label', item.title);\n\n  const badges = buildItemBadges(item);\n  const poster = createPoster(item, badges, progressPercent(item));\n\n  const body = el('div','cardv2__body');\n  const title = document.createElement('h3');\n  title.className = 'cardv2__title';\n  title.textContent = item?.title || '';\n\n  const sub = el('div','cardv2__meta');\n  const metaPieces = buildMetaPieces(item);\n  sub.textContent = metaPieces.join(' \u2022 ');\n\n  const tags = el('div','cardv2__tags');\n  const genres = getGenreNames(item?.genres);\n  renderChipsLimited(tags, genres, 3);\n\n  const actions = el('div','cardv2__actions');\n  const watchBtn = document.createElement('button');\n  watchBtn.type = 'button';\n  watchBtn.className = 'watch-btn btn';\n  updateWatchButtonState(watchBtn, item);\n  watchBtn.addEventListener('click', ev=>{\n    ev.stopPropagation();\n    Watch.toggle(item);\n    updateWatchButtonState(watchBtn, item);\n  });\n  actions.append(watchBtn);\n\n  body.append(title, sub, tags, actions);\n  card.append(poster, body);\n\n  card.addEventListener('click', ()=> openDetail(item));\n  card.addEventListener('keydown', ev=>{\n    if(ev.target !== card) return;\n    if(ev.key === 'Enter' || ev.key === ' '){\n      ev.preventDefault();\n      openDetail(item);\n    }\n  });\n\n  return card;\n}\n\nfunction collectionTags(item){\n  return ((item && item.collections) || [])\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\n    .filter(Boolean);\n}\n\nfunction createCollectionGroup(name, members){\n  const list = (members||[]).slice().sort((a,b)=>{\n    const ay = Number(humanYear(a)) || 0;\n    const by = Number(humanYear(b)) || 0;\n    if(ay !== by) return ay - by;\n    return (a.title||'').localeCompare(b.title||'', 'de');\n  });\n  const years = list.map(item=>Number(humanYear(item))||0).filter(Boolean);\n  const year = years.length ? Math.min(...years) : '';\n  const addedTimestamps = list.map(item=> new Date(item.addedAt||0).getTime()).filter(Number.isFinite);\n  const latestAdded = addedTimestamps.length ? new Date(Math.max(...addedTimestamps)).toISOString() : null;\n  const ratings = list.map(item=>Number(item.rating ?? item.audienceRating)).filter(Number.isFinite);\n  const rating = ratings.length ? ratings.reduce((sum,val)=>sum+val,0) / ratings.length : null;\n  const posterItem = list.find(entry=>entry.thumbFile) || list[0] || null;\n  const genres = Array.from(new Set(list.flatMap(entry=>getGenreNames(entry.genres)))).slice(0,4);\n  return { isCollectionGroup:true, type:'collection', title:name, collectionName:name, items:list, itemCount:list.length, year: year || '', addedAt: latestAdded, rating, posterItem, genres };\n}\n\nfunction groupCollectionsIfEnabled(items){\n  const togg = document.getElementById('groupCollections');\n  const colSel = document.getElementById('collectionFilter');\n  const selected = colSel && colSel.value;\n  if(!togg || !togg.checked) return items;\n  if(selected) return items; // drilling into a single collection -> show items, not groups\n  const membership = new Map();\n  items.forEach(item=>{\n    collectionTags(item).forEach(name=>{\n      if(!membership.has(name)) membership.set(name, []);\n      membership.get(name).push(item);\n    });\n  });\n  const groups = [];\n  membership.forEach((members, name)=>{ groups.push(createCollectionGroup(name, members)); });\n  // preserve stable order by title\n  groups.sort((a,b)=> a.title.localeCompare(b.title,'de'));\n  return groups;\n}\n\nfunction collectionCardEl(entry){\n  const card = el('article','cardv2 collection');\n  card.style.contentVisibility='auto';\n  card.dataset.kind = 'collection';\n  card.tabIndex = 0;\n  card.setAttribute('role', 'button');\n  if(entry?.title) card.setAttribute('aria-label', entry.title);\n\n  const baseItem = entry.posterItem || {};\n  const poster = createPoster(baseItem, buildCollectionBadges(entry), 0, entry.title || '');\n\n  const body = el('div','cardv2__body');\n  const title = document.createElement('h3');\n  title.className = 'cardv2__title';\n  title.textContent = entry.title || '';\n\n  const sub = el('div','cardv2__meta');\n  const pieces = [entry.year, `${entry.itemCount} Titel`];\n  if(Number.isFinite(entry.rating)) pieces.push(`\u2605 ${formatRating(entry.rating)}`);\n  sub.textContent = pieces.filter(Boolean).join(' \u2022 ');\n\n  const tags = el('div','cardv2__tags');\n  renderChipsLimited(tags, entry.genres||[], 3);\n\n  body.append(title, sub, tags);\n  card.append(poster, body);\n\n  card.addEventListener('click', ()=>{\n    const sel = document.getElementById('collectionFilter');\n    if(sel){\n      sel.value = entry.collectionName || entry.title || '';\n      sel.dispatchEvent(new Event('change', { bubbles:true }));\n    }\n  });\n\n  card.addEventListener('keydown', ev=>{\n    if(ev.target !== card) return;\n    if(ev.key === 'Enter' || ev.key === ' '){\n      ev.preventDefault();\n      const sel = document.getElementById('collectionFilter');\n      if(sel){\n        sel.value = entry.collectionName || entry.title || '';\n        sel.dispatchEvent(new Event('change', { bubbles:true }));\n      }\n    }\n  });\n\n  return card;\n}\n\nexport function renderGrid(view){\n  const { movies, shows, filtered } = getState();\n  const base = (view==='shows' ? shows : movies) || [];\n  const list = Array.isArray(filtered) ? filtered : base;\n  const items = groupCollectionsIfEnabled(list);\n  const grid = document.getElementById('grid');\n  if(!grid) return;\n  beginGridTransition(grid);\n  const frag = document.createDocumentFragment();\n  items.forEach(x=>frag.append(x.isCollectionGroup ? collectionCardEl(x) : cardEl(x)));\n  grid.replaceChildren(frag);\n  finishGridTransition(grid);\n  const empty = document.getElementById('empty');\n  if(empty) empty.hidden = items.length > 0;\n}\n\nfunction beginGridTransition(grid){\n  if(!grid) return;\n  grid.classList.remove('is-entering','is-ready');\n  grid.classList.add('is-leaving');\n}\n\nfunction finishGridTransition(grid){\n  if(!grid) return;\n  grid.classList.remove('is-leaving');\n  grid.classList.add('is-entering');\n  requestAnimationFrame(()=>{\n    grid.classList.add('is-ready');\n    setTimeout(()=>grid.classList.remove('is-entering','is-ready'), 240);\n  });\n}\n\nfunction createPoster(item, badges=[], progress=0, altOverride=''){\n  const poster = el('div','cardv2__thumb');\n  const img = new Image();\n  img.loading = 'lazy';\n  img.decoding = 'async';\n  img.alt = altOverride || item?.title || '';\n  const src = resolvePoster(item);\n  if(src) img.src = src;\n  poster.append(img);\n\n  if(Array.isArray(badges) && badges.length){\n    const badgeGroup = el('div','cardv2__badge-group');\n    badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeGroup.append(badge); });\n    if(badgeGroup.childElementCount) poster.append(badgeGroup);\n  }\n\n  const overlay = document.createElement('div');\n  overlay.className = 'cardv2__thumb-overlay';\n  overlay.setAttribute('aria-hidden','true');\n  poster.append(overlay);\n\n  const pct = Number(progress) || 0;\n  if(pct > 0){\n    const track = el('div','cardv2__progress');\n    const fill = document.createElement('span');\n    fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;\n    track.append(fill);\n    poster.append(track);\n  }\n\n  return poster;\n}\n\nfunction resolvePoster(item){\n  if(!item) return '';\n  const tmdbPoster = useTmdbOn() && (item?.tmdb?.poster || item?.tmdbPoster);\n  const fallback = item?.thumbFile || item?.poster || item?.art || item?.thumb || '';\n  return tmdbPoster || fallback || '';\n}\n\nfunction buildItemBadges(item){\n  const badges = [];\n  if(isNew(item)) badges.push(createBadge('Neu'));\n  const contentRating = String(item?.contentRating || '').trim();\n  if(contentRating) badges.push(createBadge(contentRating));\n  const ratingNum = Number(item?.rating ?? item?.audienceRating);\n  if(Number.isFinite(ratingNum)) badges.push(createBadge(`\u2605 ${formatRating(ratingNum)}`));\n  return badges.slice(0, 3);\n}\n\nfunction buildCollectionBadges(entry){\n  const badges = [];\n  if(Number.isFinite(entry?.itemCount) && entry.itemCount > 0) badges.push(createBadge(`${entry.itemCount} Titel`));\n  if(entry?.year) badges.push(createBadge(String(entry.year)));\n  return badges;\n}\n\nfunction createBadge(text){\n  const badge = document.createElement('span');\n  badge.className = 'badge';\n  badge.textContent = String(text || '');\n  return badge;\n}\n\nfunction updateWatchButtonState(button, item){\n  if(!button) return;\n  const saved = Watch.isSaved(item);\n  button.textContent = saved ? 'Gemerkt' : 'Merken';\n  button.classList.toggle('active', saved);\n  button.setAttribute('aria-pressed', saved ? 'true' : 'false');\n}\n\nfunction buildMetaPieces(item){\n  const pieces = [];\n  const year = humanYear(item);\n  if(year) pieces.push(String(year));\n  const runtime = formatRuntime(item);\n  if(runtime) pieces.push(runtime);\n  const rating = Number(item?.rating ?? item?.audienceRating);\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\n  const studio = item?.studio || item?.network || '';\n  if(studio) pieces.push(studio);\n  return pieces;\n}\n\nfunction formatRuntime(item){\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\n  const minutes = Number(raw);\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\n  return `${minutes} min`;\n}\n\nfunction progressPercent(item){\n  const offset = Number(item?.viewOffset ?? item?.viewoffset);\n  const duration = Number(item?.duration);\n  if(!Number.isFinite(offset) || !Number.isFinite(duration) || duration <= 0) return 0;\n  return Math.max(1, Math.min(100, Math.round((offset / duration) * 100)));\n}\n\nfunction resolveItemId(item){\n  if(!item) return '';\n  const preferred = item?.ids?.imdb || item?.ids?.tmdb;\n  if(preferred) return String(preferred);\n  if(item?.ratingKey) return String(item.ratingKey);\n  return '';\n}\n\nfunction updateHash(kind, id){\n  if(!kind || !id) return;\n  const hash = `#/${kind}/${id}`;\n  try{\n    if(history && typeof history.pushState === 'function'){\n      if(location.hash === hash && typeof history.replaceState === 'function') history.replaceState(null, '', hash);\n      else history.pushState(null, '', hash);\n      return;\n    }\n  }catch{}\n  try{ window.__skipNextHashNavigation = true; }\n  catch{}\n  location.hash = hash;\n}\n\nfunction openDetail(item){\n  if(!item) return;\n  const kind = item?.type === 'tv' ? 'show' : 'movie';\n  const id = resolveItemId(item);\n  if(id) updateHash(kind, id);\n  if(kind === 'show') openSeriesModalV2(item);\n  else openMovieModalV2(item);\n}\n", "import { getState, setState } from './state.js';\nimport { qs } from './dom.js';\nimport { getGenreNames } from './utils.js';\n\nfunction humanYear(item){\n  if(item.year) return item.year;\n  if(item.originallyAvailableAt) return String(item.originallyAvailableAt).slice(0,4);\n  return '';\n}\n\nfunction collectionTags(item){\n  return ((item && item.collections) || [])\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\n    .filter(Boolean);\n}\n\nfunction isNew(item){\n  if(!item?.addedAt) return false;\n  const added = new Date(item.addedAt).getTime();\n  if(!Number.isFinite(added)) return false;\n  const cfg = getState().cfg || {};\n  const days = Number(cfg.newDays || 30);\n  return Date.now() - added <= days * 24*60*60*1000;\n}\n\nfunction norm(s){ return String(s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\n\nfunction matches(item, opts){\n  const query = norm(opts.query||'');\n  const onlyNew = !!opts.onlyNew;\n  const yearFrom = Number(opts.yearFrom)||null;\n  const yearTo = Number(opts.yearTo)||null;\n  const genresActive = opts.genres || new Set();\n  const selectedCollection = opts.collection || '';\n\n  if(query){\n    const haystack = norm([\n      item.title,\n      item.originalTitle,\n      item.summary,\n      item.studio,\n      getGenreNames(item.genres).join(' '),\n      (item.roles||[]).map(r=>r && (r.tag||r.role||r.name)).join(' '),\n      collectionTags(item).join(' '),\n    ].filter(Boolean).join(' '));\n    if(!haystack.includes(query)) return false;\n  }\n\n  if(onlyNew && !isNew(item)) return false;\n\n  const year = Number(humanYear(item)) || null;\n  if(yearFrom && (!year || year < yearFrom)) return false;\n  if(yearTo && (!year || year > yearTo)) return false;\n\n  if(genresActive.size){\n    const itemGenres = new Set(getGenreNames(item.genres));\n    for(const g of genresActive){ if(!itemGenres.has(g)) return false; }\n  }\n\n  if(selectedCollection){\n    const tags = new Set(collectionTags(item));\n    if(!tags.has(selectedCollection)) return false;\n  }\n\n  return true;\n}\n\nfunction sortItems(items, key){\n  const arr = items.slice();\n  switch(key){\n    case 'year-desc':\n      arr.sort((a,b)=> (Number(humanYear(b))||0) - (Number(humanYear(a))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\n    case 'year-asc':\n      arr.sort((a,b)=> (Number(humanYear(a))||0) - (Number(humanYear(b))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\n    case 'title-desc':\n      arr.sort((a,b)=> String(b.title||'').localeCompare(String(a.title||''),'de')); break;\n    case 'added-desc':\n      arr.sort((a,b)=> new Date(b.addedAt||0)-new Date(a.addedAt||0)); break;\n    case 'title-asc':\n    default:\n      arr.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||''),'de'));\n  }\n  return arr;\n}\n\nexport function computeFacets(movies, shows){\n  const genres = new Set();\n  const years = new Set();\n  const collections = new Set();\n  const add = (arr)=> (arr||[]).forEach(x=>{\n    getGenreNames(x.genres).forEach(name=>genres.add(name));\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\n    if(y) years.add(Number(y));\n    collectionTags(x).forEach(c=>collections.add(c));\n  });\n  add(movies); add(shows);\n  const ys = [...years].sort((a,b)=>a-b);\n  return { genres:[...genres].sort(), years:ys, collections:[...collections].sort((a,b)=>a.localeCompare(b,'de')) };\n}\n\nexport function renderFacets(f){\n  // years\n  const yFrom = qs('#yearFrom'); const yTo = qs('#yearTo');\n  if(yFrom){ yFrom.replaceChildren(new Option('Ab Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\n  if(yTo){ yTo.replaceChildren(new Option('Bis Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\n  // collections\n  const col = qs('#collectionFilter');\n  if(col){ col.replaceChildren(new Option('Alle Collections',''), ...f.collections.map(c=>new Option(c,c))); }\n  // genres\n  const gRoot = qs('#genreFilters');\n  if(gRoot){\n    const chips = f.genres.map(name=>{\n      const b = document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=name; b.dataset.name=name; return b;\n    });\n    gRoot.replaceChildren(...chips);\n    updateGenreFilterState();\n  }\n}\n\nfunction getFilterOpts(){\n  const searchInput = document.getElementById('search') || document.getElementById('q');\n  const query = (searchInput?.value || '').trim();\n  const onlyNew = qs('#onlyNew')?.checked || false;\n  const yearFrom = qs('#yearFrom')?.value || '';\n  const yearTo = qs('#yearTo')?.value || '';\n  const collection = qs('#collectionFilter')?.value || '';\n  const sort = qs('#sort')?.value || 'title-asc';\n  const genres = new Set();\n  document.querySelectorAll('#genreFilters .chip.active').forEach(n=>genres.add(n.dataset.name));\n  return { query, onlyNew, yearFrom, yearTo, collection, genres, sort };\n}\n\nexport function applyFilters(){\n  const s = getState();\n  const view = s.view;\n  const pool = view==='shows' ? s.shows : s.movies;\n  const opts = getFilterOpts();\n  const filtered = (pool||[]).filter(item=>matches(item, opts));\n  const ordered = sortItems(filtered, opts.sort);\n  setState({ filtered: ordered });\n  return ordered;\n}\n\nlet gridModulePromise = null;\nfunction renderGridForCurrentView(){\n  if(!gridModulePromise){\n    gridModulePromise = import('./grid.js');\n  }\n  gridModulePromise.then(mod=>{\n    const fn = mod && mod.renderGrid;\n    if(typeof fn === 'function') fn(getState().view);\n  }).catch(console.error);\n}\n\nexport function updateFiltersAndGrid(){\n  const result = applyFilters();\n  renderGridForCurrentView();\n  notifyFiltersUpdated(result);\n  return result;\n}\n\nfunction notifyFiltersUpdated(items){\n  try{\n    const payload = Array.isArray(items) ? items.slice() : [];\n    const detail = { items: payload, view: getState().view };\n    window.dispatchEvent(new CustomEvent('filters:updated', { detail }));\n  }catch{}\n}\n\nfunction updateGenreFilterState(){\n  const root = document.getElementById('genreFilters');\n  if(!root) return;\n  const activeCount = root.querySelectorAll('.chip.active').length;\n  root.dataset.state = activeCount > 0 ? 'active' : 'empty';\n  root.dataset.count = String(activeCount);\n}\n\nexport function initFilters(){\n  // populate sort options\n  const sortSel = qs('#sort');\n  if(sortSel && sortSel.options.length===0){\n    [['title-asc','Titel A\u2013Z'],['title-desc','Titel Z\u2013A'],['year-desc','Jahr \u2193'],['year-asc','Jahr \u2191'],['added-desc','Zuletzt hinzugef\u00FCgt']]\n      .forEach(([v,l])=> sortSel.add(new Option(l, v)));\n  }\n\n  const bind = (sel, ev='input')=>{\n    const n = qs(sel);\n    if(!n) return;\n    n.addEventListener(ev, ()=>{ updateFiltersAndGrid(); });\n    if(ev === 'input' && n instanceof HTMLInputElement && n.type === 'search'){\n      n.addEventListener('search', ()=>{ updateFiltersAndGrid(); });\n    }\n  };\n  bind('#search');\n  bind('#q');\n  bind('#onlyNew','change'); bind('#yearFrom','change'); bind('#yearTo','change'); bind('#collectionFilter','change'); bind('#sort','change'); bind('#groupCollections','change');\n  const yrReset = qs('#yearReset'); if(yrReset){ yrReset.addEventListener('click',()=>{ const a=qs('#yearFrom'); const b=qs('#yearTo'); if(a) a.value=''; if(b) b.value=''; updateFiltersAndGrid(); }); }\n  const gRoot = qs('#genreFilters');\n  if(gRoot){\n    gRoot.addEventListener('click', ev=>{\n      const t = ev.target;\n      if(!(t instanceof HTMLElement)) return;\n      if(!t.classList.contains('chip')) return;\n      t.classList.toggle('active');\n      updateGenreFilterState();\n      updateFiltersAndGrid();\n    });\n    updateGenreFilterState();\n  }\n}\n\n", "// Optional TMDB enrichment. Supports v4 Bearer token or v3 API key.\n\nconst API_V3 = 'https://api.themoviedb.org/3';\nconst IMG = 'https://image.tmdb.org/t/p/';\nconst POSTER_W = 'w342';\nconst BACKDROP_W = 'w780';\n\nlet cache;\n\nfunction loadCache(){\n  try{ return new Map(JSON.parse(localStorage.getItem('tmdbCache')||'[]')); }catch{ return new Map(); }\n}\nfunction persist(){ try{ localStorage.setItem('tmdbCache', JSON.stringify(Array.from(cache.entries()))); }catch{} }\nexport function clearCache(){ try{ localStorage.removeItem('tmdbCache'); cache = new Map(); }catch{} }\n\nfunction tokenFromEnv(cfg){\n  try{\n    const t = localStorage.getItem('tmdbToken');\n    if(t) return { kind:'bearer', value: t };\n  }catch{}\n  if(cfg?.tmdbApiKey) return { kind:'apikey', value: String(cfg.tmdbApiKey) };\n  return { kind:'none', value: '' };\n}\n\nfunction keyFor(item){\n  const t = (item.type==='tv') ? 'tv' : 'movie';\n  const imdb = item?.ids?.imdb || '';\n  const tmdb = item?.ids?.tmdb || '';\n  const title = (item.title||'').toLowerCase();\n  const year = String(item.year || '').slice(0,4);\n  return [t, imdb, tmdb, title, year].filter(Boolean).join('|');\n}\n\nfunction withAuth(url, auth){\n  if(!auth || auth.kind==='none') return { url, init:{} };\n  if(auth.kind==='bearer') return { url, init: { headers: { 'Authorization': `Bearer ${auth.value}`, 'Accept':'application/json' } } };\n  // v3 api key via query param\n  const sep = url.includes('?') ? '&' : '?';\n  return { url: `${url}${sep}api_key=${encodeURIComponent(auth.value)}`, init: { headers: { 'Accept':'application/json' } } };\n}\n\nasync function getJson(url, auth){\n  const { url: u, init } = withAuth(url, auth);\n  const res = await fetch(u, init);\n  if(!res.ok) throw new Error('HTTP '+res.status);\n  return res.json();\n}\n\nfunction pickBestPoster(p){ return p?.file_path ? IMG+POSTER_W+p.file_path : ''; }\nfunction pickBestBackdrop(p){ return p?.file_path ? IMG+BACKDROP_W+p.file_path : ''; }\n\nasync function byId(type, id, lang, auth){\n  const inf = await getJson(`${API_V3}/${type}/${id}?language=${encodeURIComponent(lang||'de-DE')}`, auth);\n  const images = await getJson(`${API_V3}/${type}/${id}/images`, auth).catch(()=>({ posters:[], backdrops:[] }));\n  const poster = pickBestPoster((images.posters||[])[0]) || (inf.poster_path ? IMG+POSTER_W+inf.poster_path : '');\n  const backdrop = pickBestBackdrop((images.backdrops||[])[0]) || (inf.backdrop_path ? IMG+BACKDROP_W+inf.backdrop_path : '');\n  return { id: inf.id, poster, backdrop, url: `https://www.themoviedb.org/${type}/${inf.id}` };\n}\n\nasync function bySearch(type, title, year, lang, auth){\n  const q = encodeURIComponent(title||'');\n  const yParam = year ? `&year=${encodeURIComponent(String(year))}` : '';\n  const res = await getJson(`${API_V3}/search/${type}?query=${q}${yParam}&language=${encodeURIComponent(lang||'de-DE')}`, auth);\n  const first = (res.results||[])[0];\n  if(!first) throw new Error('not found');\n  return byId(type, first.id, lang, auth);\n}\n\nasync function hydrateItem(item, cfg, auth){\n  const type = (item.type==='tv') ? 'tv' : 'movie';\n  const k = keyFor(item);\n  if(cache.has(k)) return cache.get(k);\n  let out;\n  try{\n    if(item?.ids?.tmdb){ out = await byId(type, item.ids.tmdb, cfg.lang, auth); }\n    else if(item?.ids?.imdb){\n      // find by external id\n      const json = await getJson(`${API_V3}/find/${item.ids.imdb}?external_source=imdb_id&language=${encodeURIComponent(cfg.lang||'de-DE')}`, auth);\n      const hit = (type==='movie' ? (json.movie_results||[])[0] : (json.tv_results||[])[0]);\n      if(hit) out = await byId(type, hit.id, cfg.lang, auth); else throw new Error('not found');\n    }else{\n      out = await bySearch(type, item.title, item.year, cfg.lang, auth);\n    }\n  }catch(e){ out = null; }\n  cache.set(k, out);\n  persist();\n  return out;\n}\n\nexport async function hydrateOptional(movies, shows, cfg={}){\n  try{\n    cache = cache || loadCache();\n    const auth = tokenFromEnv(cfg);\n    if(!auth.value) return;\n    const work = (movies||[]).concat(shows||[]);\n    let i = 0; const limit = 40; // keep it light\n    const next = async()=>{\n      const chunk = work.slice(i, i+4); i += 4;\n      await Promise.all(chunk.map(async (it)=>{\n        const data = await hydrateItem(it, cfg, auth);\n        if(data){\n          it.tmdb = { id:data.id, poster:data.poster, backdrop:data.backdrop, url:data.url };\n          it.ids = it.ids||{}; if(!it.ids.tmdb && data.id) it.ids.tmdb = String(data.id);\n        }\n      }));\n      try{ window.dispatchEvent(new CustomEvent('tmdb:chunk', { detail: { updated: chunk.length, index: i } })); }catch{}\n      if(i < Math.min(work.length, limit)) (window.requestIdleCallback||setTimeout)(next, 250);\n      else{ try{ window.dispatchEvent(new CustomEvent('tmdb:done', { detail: { total: Math.min(work.length, limit) } })); }catch{} }\n    };\n    next();\n  }catch{}\n}\n\n// Lightweight token validation used by settings UI\nexport async function validateToken(raw){\n  const token = String(raw||'').trim();\n  if(!token) throw new Error('empty');\n  const looksLikeV3 = /^[a-f0-9]{32}$/i.test(token);\n  const looksLikeJwt = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$/.test(token);\n  const decodeJwtPayload = (t)=>{\n    try{\n      const part = t.split('.')[1];\n      const pad = (s)=> s + '='.repeat((4 - (s.length % 4)) % 4);\n      const json = atob(pad(part.replace(/-/g,'+').replace(/_/g,'/')));\n      return JSON.parse(json);\n    }catch{ return null; }\n  };\n\n  // If it looks like a v3 API key, validate it against a protected v3 config endpoint\n  if(looksLikeV3){\n    const { url, init } = withAuth(`${API_V3}/configuration`, { kind:'apikey', value: token });\n    const res = await fetch(url, init);\n    if(res.ok) return { ok:true, as:'apikey', hint:'v3Key' };\n    return { ok:false, as:'apikey', hint:'looksV3' };\n  }\n\n  // Heuristic validation for v4 Bearer tokens (API Read Access Token):\n  // - Check JWT shape and issuer claim if present\n  // - Perform a benign v3 request with Bearer header to confirm CORS/connectivity\n  if(looksLikeJwt){\n    const payload = decodeJwtPayload(token);\n    if(payload && typeof payload === 'object'){\n      const iss = String(payload.iss||'');\n      if(iss && !/themoviedb\\.org/i.test(iss)){\n        return { ok:false, as:'bearer', hint:'issMismatch' };\n      }\n    }\n    const { url, init } = withAuth(`${API_V3}/trending/movie/day`, { kind:'bearer', value: token });\n    try{\n      const res = await fetch(url, init);\n      if(res.ok) return { ok:true, as:'bearer', hint:null };\n    }catch{}\n    // Some public endpoints ignore invalid Authorization headers; fall back to structural pass\n    return { ok:true, as:'bearer', hint:'structOnly' };\n  }\n\n  return { ok:false, as:'bearer', hint:null };\n}\n", "import { setState, getState } from './state.js';\nimport { showLoader, setLoader, hideLoader, showSkeleton, clearSkeleton } from './loader.js';\nimport * as Data from './data.js';\nimport * as Filter from './filter.js';\nimport { renderGrid } from './grid.js';\nimport { openMovieModalV2, openSeriesModalV2 } from './modalV2.js';\nimport { hydrateOptional } from './services/tmdb.js';\nimport * as Watch from './watchlist.js';\nimport * as Debug from './debug.js';\nimport { humanYear, formatRating, useTmdbOn } from './utils.js';\n\nlet currentHeroItem = null;\nlet heroDefaults = null;\n\nfunction setFooterStatus(message, busy=true){\n  const footer = document.getElementById('footerMeta');\n  if(footer){\n    footer.textContent = message;\n    footer.dataset.state = busy ? 'loading' : 'ready';\n  }\n  const grid = document.getElementById('grid');\n  if(grid){\n    grid.setAttribute('aria-busy', busy ? 'true' : 'false');\n  }\n}\n\nasync function boot(){\n  applyReduceMotionPref();\n  showLoader();\n  setFooterStatus('Initialisiere \u2026', true);\n  setLoader('Initialisiere \u2026', 8);\n  showSkeleton(18);\n\n  const cfg = await fetch('config.json').then(r=>r.json()).catch(()=>({ startView:'movies', tmdbEnabled:false }));\n  setState({ cfg, view: cfg.startView || 'movies' });\n\n  setFooterStatus('Filme laden \u2026', true);\n  setLoader('Filme laden \u2026', 25);\n  const movies = await Data.loadMovies();\n  setFooterStatus('Serien laden \u2026', true);\n  setLoader('Serien laden \u2026', 45);\n  const shows  = await Data.loadShows();\n\n  setFooterStatus('Filter vorbereiten \u2026', true);\n  setLoader('Filter vorbereiten \u2026', 60);\n  // build facets (richer set via Filter)\n  const facets = Filter.computeFacets(movies, shows);\n  setState({ movies, shows, facets });\n\n  setFooterStatus('Ansicht aufbauen \u2026', true);\n  setLoader('Ansicht aufbauen \u2026', 85);\n  clearSkeleton();\n  renderSwitch();\n  Filter.renderFacets(facets);\n  Filter.initFilters();\n  Filter.applyFilters();\n  renderStats(true);\n  renderGrid(getState().view);\n  renderFooterMeta();\n\n  hideLoader();\n\n  if(cfg.tmdbEnabled) (window.requestIdleCallback || setTimeout)(()=> hydrateOptional?.(movies, shows, cfg), 400);\n\n  Watch.initUi();\n  initSettingsOverlay(cfg);\n  initAdvancedToggle();\n  initHeaderInteractions();\n  initScrollProgress();\n  initScrollTop();\n  renderHeroHighlight();\n  Debug.initDebugUi();\n  // Re-render grid on TMDB hydration progress to reveal new posters\n  let tmdbRaf;\n  window.addEventListener('tmdb:chunk', ()=>{\n    if(tmdbRaf) return; // throttle to animation frame\n    tmdbRaf = requestAnimationFrame(()=>{\n      tmdbRaf = null;\n      try{\n        if(localStorage.getItem('useTmdb')==='1'){\n          renderGrid(getState().view);\n          renderHeroHighlight();\n        }\n      }catch{}\n    });\n  });\n  window.addEventListener('tmdb:done', ()=>{\n    try{\n      if(localStorage.getItem('useTmdb')==='1'){\n        renderGrid(getState().view);\n        renderHeroHighlight();\n      }\n    }catch{}\n  });\n}\n\nwindow.addEventListener('hashchange', ()=>{\n  if(window.__skipNextHashNavigation){\n    try{ window.__skipNextHashNavigation = false; }\n    catch{}\n    return;\n  }\n  const hash = location.hash || '';\n  // deep link to views\n  if(/^#\\/(movies|shows)$/.test(hash)){\n    const view = hash.includes('shows') ? 'shows' : 'movies';\n    setState({ view });\n    const result = Filter.applyFilters();\n    renderSwitch();\n    renderGrid(view);\n    renderHeroHighlight(result);\n    return;\n  }\n  // item details\n  const m = hash.match(/^#\\/(movie|show)\\/(.+)/);\n  if(!m) return;\n  const [ , kind, id ] = m;\n  const pool = kind==='movie' ? getState().movies : getState().shows;\n  const item = (pool||[]).find(x => (x?.ids?.imdb===id || x?.ids?.tmdb===id || String(x?.ratingKey)===id));\n  if(!item) return;\n  if(kind === 'show') openSeriesModalV2(item);\n  else openMovieModalV2(item);\n});\n\nfunction renderSwitch(){\n  const root = document.getElementById('libraryTabs');\n  if(!root) return;\n  const buttons = Array.from(root.querySelectorAll('[data-lib]'));\n  const current = getState().view === 'shows' ? 'shows' : 'movies';\n  buttons.forEach(btn => {\n    const target = btn.dataset.lib === 'series' ? 'shows' : 'movies';\n    const isActive = current === target;\n    btn.classList.toggle('is-active', isActive);\n    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n    if(btn.dataset.bound === 'true') return;\n    btn.addEventListener('click', () => {\n      const view = btn.dataset.lib === 'series' ? 'shows' : 'movies';\n      if(getState().view === view) return;\n      setState({ view });\n      try{ window.__skipNextHashNavigation = true; }catch{}\n      location.hash = view === 'movies' ? '#/movies' : '#/shows';\n      renderSwitch();\n      const result = Filter.applyFilters();\n      renderGrid(view);\n      renderHeroHighlight(result);\n    });\n    btn.dataset.bound = 'true';\n  });\n}\n\nfunction renderStats(animate=false){\n  const root = document.getElementById('heroStats');\n  if(!root) return;\n  const s = getState();\n  const movies = (s.movies||[]).length;\n  const shows = (s.shows||[]).length;\n  const elM = root.querySelector('[data-stat=\"movies\"]');\n  const elS = root.querySelector('[data-stat=\"shows\"]');\n  if(!elM || !elS) return;\n  if(animate){ countTo(elM, movies); countTo(elS, shows); }\n  else { elM.textContent=String(movies); elS.textContent=String(shows); }\n}\n\nfunction countTo(el, target){\n  if(!el) return;\n  const start = Number(el.textContent)||0;\n  const end = Number(target)||0;\n  if(start===end){ el.textContent = String(end); return; }\n  const dur = 480; // ms\n  const t0 = performance.now();\n  function step(t){\n    const p = Math.min(1, (t - t0) / dur);\n    const val = Math.round(start + (end - start) * (p<0.5 ? 2*p*p : -1 + (4 - 2*p) * p));\n    el.textContent = String(val);\n    if(p < 1) requestAnimationFrame(step); else el.textContent = String(end);\n  }\n  requestAnimationFrame(step);\n}\n\nfunction renderFooterMeta(){\n  const el = document.getElementById('footerMeta');\n  if(!el) return;\n  const status = document.getElementById('footerStatus');\n  const s = getState();\n  const movies = (s.movies||[]); const shows=(s.shows||[]);\n  const times = movies.concat(shows).map(x=> new Date(x.addedAt||0).getTime()).filter(Number.isFinite);\n  const latest = times.length ? new Date(Math.max(...times)) : new Date();\n  const date = latest.toISOString().slice(0,10);\n  if(status){\n    status.textContent = `Stand: ${date}`;\n  }\n  el.dataset.state = 'ready';\n  const grid = document.getElementById('grid');\n  if(grid){ grid.setAttribute('aria-busy', 'false'); }\n}\n\nfunction renderHeroHighlight(listOverride){\n  const hero = document.getElementById('hero');\n  const title = document.getElementById('heroTitle');\n  const subtitle = document.getElementById('heroSubtitle');\n  const cta = document.getElementById('heroCta');\n  if(!hero || !title || !subtitle || !cta) return;\n\n  ensureHeroDefaults();\n  const candidate = selectHeroItem(listOverride);\n\n  if(!candidate){\n    currentHeroItem = null;\n    title.textContent = heroDefaults.title;\n    subtitle.textContent = heroDefaults.subtitle;\n    subtitle.dataset.taglinePaused = '0';\n    delete subtitle.dataset.heroBound;\n    subtitle.classList.remove('is-fading');\n    cta.textContent = heroDefaults.cta;\n    cta.disabled = true;\n    cta.setAttribute('aria-disabled', 'true');\n    cta.removeAttribute('aria-label');\n    cta.onclick = null;\n    hero.style.backgroundImage = '';\n    hero.classList.remove('has-poster');\n    hero.dataset.heroKind = '';\n    hero.dataset.heroId = '';\n    return;\n  }\n\n  currentHeroItem = candidate;\n  const kind = candidate.type === 'tv' ? 'show' : 'movie';\n  const heroId = resolveHeroId(candidate);\n\n  title.textContent = candidate.title || heroDefaults.title;\n  subtitle.textContent = heroSubtitleText(candidate);\n  subtitle.dataset.taglinePaused = '1';\n  subtitle.dataset.heroBound = '1';\n  subtitle.classList.remove('is-fading');\n\n  const ctaLabel = kind === 'show' ? 'Serien-Details \u00F6ffnen' : 'Film-Details \u00F6ffnen';\n  cta.textContent = ctaLabel;\n  cta.disabled = false;\n  cta.setAttribute('aria-disabled', 'false');\n  cta.setAttribute('aria-label', candidate.title ? `${ctaLabel}: ${candidate.title}` : ctaLabel);\n  cta.onclick = ()=> openHeroModal(candidate, kind, heroId);\n\n  hero.dataset.heroKind = kind;\n  hero.dataset.heroId = heroId || '';\n\n  const background = resolveHeroBackdrop(candidate);\n  if(background){\n    hero.style.backgroundImage = `url(${background})`;\n    hero.classList.add('has-poster');\n  }else{\n    hero.style.backgroundImage = '';\n    hero.classList.remove('has-poster');\n  }\n}\n\nfunction ensureHeroDefaults(){\n  if(heroDefaults) return;\n  heroDefaults = {\n    title: document.getElementById('heroTitle')?.textContent || '',\n    subtitle: document.getElementById('heroSubtitle')?.textContent || '',\n    cta: document.getElementById('heroCta')?.textContent || '',\n  };\n}\n\nfunction selectHeroItem(listOverride){\n  if(Array.isArray(listOverride)){\n    const playableOverride = listOverride.filter(isPlayableHeroItem);\n    if(!playableOverride.length) return null;\n    return chooseHeroCandidate(playableOverride);\n  }\n  const source = heroCandidatesFromState();\n  const playable = source.filter(isPlayableHeroItem);\n  if(!playable.length) return null;\n  return chooseHeroCandidate(playable);\n}\n\nfunction chooseHeroCandidate(list){\n  if(list.length === 1) return list[0];\n  const index = Math.floor(Math.random() * list.length);\n  const candidate = list[index];\n  if(currentHeroItem && list.length > 1 && candidate === currentHeroItem){\n    const alt = list.find(item=> item !== currentHeroItem);\n    return alt || candidate;\n  }\n  return candidate;\n}\n\nfunction heroCandidatesFromState(){\n  const state = getState();\n  const view = state.view === 'shows' ? 'shows' : 'movies';\n  const filtered = Array.isArray(state.filtered) && state.filtered.length ? state.filtered : null;\n  const list = filtered || (view === 'shows' ? state.shows : state.movies) || [];\n  return Array.isArray(list) ? list : [];\n}\n\nfunction isPlayableHeroItem(item){\n  return Boolean(item) && typeof item === 'object' && !item.isCollectionGroup && item.type !== 'collection';\n}\n\nfunction heroSubtitleText(item){\n  const meta = [];\n  const year = humanYear(item);\n  if(year) meta.push(String(year));\n  const runtime = heroRuntimeText(item);\n  if(runtime) meta.push(runtime);\n  const rating = Number(item?.rating ?? item?.audienceRating);\n  if(Number.isFinite(rating)) meta.push(`\u2605 ${formatRating(rating)}`);\n  const genres = heroGenres(item, 2);\n  if(genres.length) meta.push(genres.join(', '));\n  const summary = heroSummaryText(item);\n  if(summary) return meta.length ? `${meta.join(' \u2022 ')} \u2014 ${summary}` : summary;\n  return meta.length ? meta.join(' \u2022 ') : heroDefaults?.subtitle || '';\n}\n\nfunction heroRuntimeText(item){\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\n  const minutes = Number(raw);\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\n  return `${minutes} min`;\n}\n\nfunction heroGenres(item, limit=3){\n  const list = Array.isArray(item?.genres) ? item.genres : [];\n  const names = [];\n  list.forEach(entry=>{\n    if(!entry) return;\n    if(typeof entry === 'string'){ names.push(entry); return; }\n    const name = entry.tag || entry.title || entry.name || entry.label || '';\n    if(name) names.push(name);\n  });\n  const unique = Array.from(new Set(names));\n  return unique.slice(0, Math.max(0, limit));\n}\n\nfunction heroSummaryText(item){\n  const sources = [item?.tagline, item?.summary, item?.plot, item?.overview];\n  for(const raw of sources){\n    if(typeof raw !== 'string') continue;\n    const text = raw.trim();\n    if(text) return truncateText(text, 220);\n  }\n  return '';\n}\n\nfunction truncateText(text, maxLength){\n  const str = String(text || '').trim();\n  if(!str) return '';\n  if(str.length <= maxLength) return str;\n  return `${str.slice(0, Math.max(0, maxLength - 1)).trimEnd()}\u2026`;\n}\n\nfunction resolveHeroId(item){\n  if(!item) return '';\n  if(item?.ids?.imdb) return String(item.ids.imdb);\n  if(item?.ids?.tmdb) return String(item.ids.tmdb);\n  if(item?.ratingKey != null) return String(item.ratingKey);\n  return '';\n}\n\nfunction openHeroModal(item, kind, heroId){\n  if(heroId) navigateToItemHash(kind, heroId);\n  if(kind === 'show') openSeriesModalV2(item);\n  else openMovieModalV2(item);\n}\n\nfunction navigateToItemHash(kind, id){\n  if(!kind || !id) return;\n  const hash = `#/${kind}/${id}`;\n  try{\n    if(history && typeof history.pushState === 'function'){\n      if(location.hash === hash && typeof history.replaceState === 'function') history.replaceState(null, '', hash);\n      else history.pushState(null, '', hash);\n      return;\n    }\n  }catch{}\n  try{ window.__skipNextHashNavigation = true; }catch{}\n  location.hash = hash;\n}\n\nfunction resolveHeroBackdrop(item){\n  if(!item) return '';\n  const tmdbEnabled = useTmdbOn();\n  const tmdbCandidates = [\n    item?.tmdb?.backdrop,\n    item?.tmdb?.backdrop_path,\n    item?.tmdb?.backdropPath,\n    item?.tmdb?.background,\n    item?.tmdb?.art,\n  ];\n  const localCandidates = [\n    item?.art,\n    item?.background,\n    item?.thumbBackground,\n    item?.coverArt,\n    item?.thumb,\n    item?.thumbFile,\n  ];\n  if(tmdbEnabled){\n    const tmdb = tmdbCandidates.find(isValidMediaPath);\n    if(tmdb) return tmdb;\n  }\n  const local = localCandidates.find(isValidMediaPath);\n  return local || '';\n}\n\nfunction isValidMediaPath(value){\n  return typeof value === 'string' && value.trim().length > 0;\n}\n\nwindow.addEventListener('filters:updated', ev=>{\n  const detail = ev?.detail;\n  const items = Array.isArray(detail?.items) ? detail.items : null;\n  renderHeroHighlight(items);\n});\n\nboot();\n\n// Fallback: ensure the loading overlay is not left visible\n// in case an error interrupts the boot sequence.\nwindow.addEventListener('load', ()=>{ try{ hideLoader(); }catch{} });\n\nfunction initSettingsOverlay(cfg){\n  const overlay = document.getElementById('settingsOverlay');\n  const dialog = overlay?.querySelector('.settings-dialog');\n  const open1 = document.getElementById('settingsBtn');\n  const open2 = document.getElementById('openSettings');\n  const close2 = document.getElementById('settingsClose2');\n  const tmdbInput = document.getElementById('tmdbTokenInput');\n  const tmdbSave = document.getElementById('tmdbSave');\n  const tmdbTest = document.getElementById('tmdbTest');\n  const tmdbStatus = document.getElementById('tmdbStatus');\n  const tmdbClear = document.getElementById('tmdbClearCache');\n  const tmdbBadge = document.getElementById('tmdbStatusBadge');\n  const reduce = document.getElementById('prefReduceMotion');\n  const useTmdb = document.getElementById('useTmdbSetting');\n  const resetFilters = document.getElementById('resetFilters');\n\n  if(overlay && overlay.hidden) overlay.setAttribute('aria-hidden', 'true');\n\n  let restoreFocus = null;\n  let previousOverflow = '';\n  let isOpen = false;\n  const backgroundState = new Map();\n  const focusSelector = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])';\n\n  function getFocusable(){\n    if(!overlay) return [];\n    return Array.from(overlay.querySelectorAll(focusSelector)).filter(el=> !el.hasAttribute('disabled') && el.getAttribute('aria-hidden') !== 'true');\n  }\n\n  function focusDialog(){\n    if(dialog && typeof dialog.focus === 'function') dialog.focus({ preventScroll:true });\n    else if(overlay && typeof overlay.focus === 'function') overlay.focus({ preventScroll:true });\n  }\n\n  function setBackgroundInert(active){\n    if(!overlay) return;\n    const nodes = Array.from(document.body.children).filter(node=> node !== overlay);\n    if(active){\n      nodes.forEach(node=>{\n        if(!backgroundState.has(node)){\n          backgroundState.set(node, {\n            ariaHidden: node.hasAttribute('aria-hidden') ? node.getAttribute('aria-hidden') : null,\n            inert: node.hasAttribute('inert')\n          });\n        }\n        node.setAttribute('aria-hidden', 'true');\n        node.setAttribute('inert', '');\n      });\n    }else{\n      nodes.forEach(node=>{\n        const state = backgroundState.get(node);\n        if(state){\n          if(state.ariaHidden === null || state.ariaHidden === undefined) node.removeAttribute('aria-hidden');\n          else node.setAttribute('aria-hidden', state.ariaHidden);\n          if(state.inert) node.setAttribute('inert', '');\n          else node.removeAttribute('inert');\n          backgroundState.delete(node);\n        }else{\n          node.removeAttribute('aria-hidden');\n          node.removeAttribute('inert');\n        }\n      });\n      backgroundState.clear();\n    }\n  }\n\n  function openOverlay(){\n    if(!overlay || isOpen) return;\n    isOpen = true;\n    overlay.hidden = false;\n    overlay.setAttribute('aria-hidden', 'false');\n    restoreFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n    previousOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n    setBackgroundInert(true);\n    syncSettingsUi();\n    requestAnimationFrame(focusDialog);\n  }\n\n  function closeOverlay(){\n    if(!overlay || !isOpen) return;\n    isOpen = false;\n    overlay.hidden = true;\n    overlay.setAttribute('aria-hidden', 'true');\n    setBackgroundInert(false);\n    document.body.style.overflow = previousOverflow;\n    if(restoreFocus && typeof restoreFocus.focus === 'function'){ restoreFocus.focus(); }\n    restoreFocus = null;\n  }\n\n  function handleKeydown(ev){\n    if(!isOpen) return;\n    if(ev.key === 'Escape'){\n      ev.preventDefault();\n      closeOverlay();\n      return;\n    }\n    if(ev.key !== 'Tab') return;\n    const focusable = getFocusable();\n    if(!focusable.length){\n      ev.preventDefault();\n      focusDialog();\n      return;\n    }\n    const first = focusable[0];\n    const last = focusable[focusable.length - 1];\n    const active = document.activeElement;\n    if(ev.shiftKey){\n      if(active === first || !overlay.contains(active)){\n        ev.preventDefault();\n        last.focus();\n      }\n    }else if(active === last){\n      ev.preventDefault();\n      first.focus();\n    }\n  }\n\n  open1 && open1.addEventListener('click', openOverlay);\n  open2 && open2.addEventListener('click', ()=>{ openOverlay(); });\n  close2 && close2.addEventListener('click', closeOverlay);\n  overlay && overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closeOverlay(); });\n  overlay && overlay.addEventListener('keydown', handleKeydown);\n\n  function setTmdbStatus(msg='', kind=''){\n    if(!tmdbStatus) return;\n    tmdbStatus.textContent = msg;\n    tmdbStatus.dataset.kind = kind; // kind: success|error|info|pending\n    if(tmdbBadge){ tmdbBadge.dataset.kind = kind || ''; tmdbBadge.title = msg || ''; }\n    // Auto-Fallback: Bei Fehler und vorhandenem v3 API Key, gespeicherten ung\u00FCltigen Token entfernen\n    try{\n      if(kind==='error' && cfg && cfg.tmdbApiKey){\n        const stored = String(localStorage.getItem('tmdbToken')||'').trim();\n        const currentInput = String(tmdbInput?.value||'').trim();\n        if(stored && currentInput){\n          try{ localStorage.removeItem('tmdbToken'); }catch{}\n          if(tmdbInput) tmdbInput.value = '';\n          setUseTmdbAvailability(true);\n          const m = 'Ung\u00FCltiger Token entfernt. Verwende API Key aus config.json.';\n          tmdbStatus.textContent = m;\n          tmdbStatus.dataset.kind = 'info';\n          if(tmdbBadge){ tmdbBadge.dataset.kind = 'info'; tmdbBadge.title = m; }\n        }\n      }\n    }catch{}\n  }\n\n  function setUseTmdbAvailability(allowed){\n    if(!useTmdb) return;\n    useTmdb.disabled = !allowed;\n    useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token oder API Key.' : '';\n    if(!allowed && useTmdb.checked){\n      try{ localStorage.setItem('useTmdb', '0'); }catch{}\n      useTmdb.checked = false;\n      renderGrid(getState().view);\n    }\n  }\n\n  function syncSettingsUi(){\n    let token = '';\n    try{ tmdbInput && (tmdbInput.value = token = (localStorage.getItem('tmdbToken')||'')); }catch{}\n    try{ reduce && (reduce.checked = localStorage.getItem('prefReduceMotion')==='1'); }catch{}\n    try{ if(useTmdb){\n      useTmdb.checked = localStorage.getItem('useTmdb')==='1';\n      useTmdb.disabled = !token;\n      useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token.' : '';\n    } }catch{}\n    try{ setUseTmdbAvailability(!!token || !!(cfg&&cfg.tmdbApiKey)); }catch{}\n    setTmdbStatus('', '');\n    if(!token){ setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info'); }\n    if(!cfg?.tmdbEnabled){ setTmdbStatus('Hinweis: TMDB in config.json deaktiviert (tmdbEnabled=false).', 'info'); }\n    // Optional: Auto-Check bei ge\u00F6ffnetem Dialog\n    if(token){\n      (async()=>{\n        setTmdbStatus('Pr\u00FCfe Token...', 'pending');\n        try{\n          const svc = await import('./services/tmdb.js');\n          const res = await svc.validateToken?.(token);\n          if(res && res.ok){\n            setUseTmdbAvailability(true);\n            if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\n            else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\n          }else{\n            setUseTmdbAvailability(false);\n            if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\n            else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\n          }\n        }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\n      })();\n    } else { setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); }\n  }\n\n  tmdbSave && tmdbSave.addEventListener('click', async ()=>{\n    const raw = String(tmdbInput?.value||'').trim();\n    try{ localStorage.setItem('tmdbToken', raw); }catch{}\n    if(!raw){ setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info'); setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); return; }\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\n    try{\n      const svc = await import('./services/tmdb.js');\n      const res = await svc.validateToken?.(raw);\n      if(res && res.ok){\n        setUseTmdbAvailability(true);\n        setUseTmdbAvailability(true);\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\n      }else{\n        setUseTmdbAvailability(false);\n        setUseTmdbAvailability(false);\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\n      }\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\n  });\n\n  tmdbTest && tmdbTest.addEventListener('click', async ()=>{\n    const raw = String(tmdbInput?.value||'').trim();\n    if(!raw){ setTmdbStatus('Bitte Token eingeben.', 'error'); return; }\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\n    try{\n      const svc = await import('./services/tmdb.js');\n      const res = await svc.validateToken?.(raw);\n      if(res && res.ok){\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\n      }else{\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\n      }\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\n  });\n  tmdbClear && tmdbClear.addEventListener('click', ()=>{ import('./services/tmdb.js').then(m=>m.clearCache?.()); });\n  reduce && reduce.addEventListener('change', ()=>{\n    try{ localStorage.setItem('prefReduceMotion', reduce.checked ? '1' : '0'); }catch{}\n    document.documentElement.classList.toggle('reduce-motion', reduce.checked);\n  });\n  useTmdb && useTmdb.addEventListener('change', ()=>{\n    try{ localStorage.setItem('useTmdb', useTmdb.checked ? '1' : '0'); }catch{}\n    // Start TMDB hydration when enabling the toggle (if not already started)\n    if(useTmdb.checked && !window.__tmdbHydrationStarted){\n      window.__tmdbHydrationStarted = 1;\n      import('./services/tmdb.js').then(m=>{\n        const s = getState();\n        m.hydrateOptional?.(s.movies, s.shows, s.cfg);\n      }).catch(()=>{});\n      // Re-render a bit later to reflect incoming posters\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 1200);\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 3000);\n    }\n    renderGrid(getState().view);\n    renderHeroHighlight();\n  });\n  resetFilters && resetFilters.addEventListener('click', ()=>{\n    const search = document.getElementById('search'); if(search) search.value='';\n    const q = document.getElementById('q'); if(q) q.value='';\n    const onlyNew = document.getElementById('onlyNew'); if(onlyNew) onlyNew.checked=false;\n    const yf = document.getElementById('yearFrom'); const yt = document.getElementById('yearTo'); if(yf) yf.value=''; if(yt) yt.value='';\n    const col = document.getElementById('collectionFilter'); if(col) col.value='';\n    document.querySelectorAll('#genreFilters .chip.active').forEach(n=>n.classList.remove('active'));\n    const genreRoot = document.getElementById('genreFilters');\n    if(genreRoot){\n      genreRoot.dataset.state = 'empty';\n      genreRoot.dataset.count = '0';\n    }\n    import('./filter.js').then(F=>{\n      const result = F.applyFilters();\n      renderGrid(getState().view);\n      renderHeroHighlight(result);\n    });\n  });\n}\n\nfunction applyReduceMotionPref(){\n  try{ const pref = localStorage.getItem('prefReduceMotion')==='1'; document.documentElement.classList.toggle('reduce-motion', pref); }catch{}\n}\n\nfunction initAdvancedToggle(){\n  const btn = document.getElementById('toggleAdvanced');\n  const panel = document.getElementById('advancedFilters');\n  if(!btn || !panel) return;\n  let animating = false;\n  let fallbackTimer = 0;\n\n  const finishAnimation = ()=>{\n    animating = false;\n    if(fallbackTimer){\n      clearTimeout(fallbackTimer);\n      fallbackTimer = 0;\n    }\n    if(panel.dataset.state === 'closing'){\n      panel.dataset.state = 'closed';\n      panel.hidden = true;\n      panel.style.removeProperty('--advanced-max');\n    }else if(panel.dataset.state === 'open'){\n      panel.style.removeProperty('--advanced-max');\n    }else if(panel.dataset.state === 'expanding'){\n      panel.dataset.state = 'open';\n      panel.style.removeProperty('--advanced-max');\n    }\n  };\n\n  const queueFinish = ()=>{\n    if(fallbackTimer){\n      clearTimeout(fallbackTimer);\n    }\n    fallbackTimer = window.setTimeout(finishAnimation, 320);\n  };\n\n  panel.addEventListener('transitionend', event=>{\n    if(event.target !== panel || event.propertyName !== 'max-height') return;\n    finishAnimation();\n  });\n\n  const openPanel = ()=>{\n    if(animating) return;\n    animating = true;\n    panel.hidden = false;\n    panel.dataset.state = 'expanding';\n    panel.setAttribute('aria-hidden', 'false');\n    panel.style.setProperty('--advanced-max', '0px');\n    requestAnimationFrame(()=>{\n      const height = panel.scrollHeight;\n      panel.style.setProperty('--advanced-max', height + 'px');\n      panel.dataset.state = 'open';\n      queueFinish();\n    });\n  };\n\n  const closePanel = ()=>{\n    if(animating) return;\n    animating = true;\n    const height = panel.scrollHeight;\n    panel.style.setProperty('--advanced-max', height + 'px');\n    panel.dataset.state = 'closing';\n    panel.setAttribute('aria-hidden', 'true');\n    requestAnimationFrame(()=>{\n      panel.style.setProperty('--advanced-max', '0px');\n      queueFinish();\n    });\n  };\n\n  btn.addEventListener('click', ()=>{\n    const expanded = btn.getAttribute('aria-expanded') === 'true';\n    if(expanded){\n      btn.setAttribute('aria-expanded', 'false');\n      closePanel();\n    }else{\n      btn.setAttribute('aria-expanded', 'true');\n      openPanel();\n    }\n  });\n}\n\nfunction initHeaderInteractions(){\n  const siteLogo = document.getElementById('siteLogo');\n  if(siteLogo){\n    siteLogo.addEventListener('error', ()=>{\n      siteLogo.classList.add('logo-missing');\n      const titleEl = document.querySelector('.site-header__brand-text .site-header__label');\n      if(titleEl) titleEl.classList.remove('sr-only');\n    });\n  }\n  const subtitle = document.getElementById('heroSubtitle');\n  const TAGLINES = [\n    'Offline st\u00F6bern & Wunschlisten teilen',\n    'Filter. Finden. Freuen.',\n    'Filme & Serien \u2013 stressfrei sichtbar',\n    'Schneller als jeder SMB-Share',\n    'Merkliste zuerst, Streit sp\u00E4ter'\n  ];\n  let idx = 0; if(subtitle) subtitle.textContent = TAGLINES[idx];\n  function rotate(){\n    if(!subtitle || subtitle.dataset.taglinePaused==='1') return;\n    subtitle.classList.add('is-fading');\n    setTimeout(()=>{\n      if(!subtitle || subtitle.dataset.taglinePaused==='1'){ subtitle && subtitle.classList.remove('is-fading'); return; }\n      idx = (idx+1)%TAGLINES.length; subtitle.textContent = TAGLINES[idx]; subtitle.classList.remove('is-fading');\n    }, 280);\n  }\n  if(subtitle){ subtitle.dataset.taglinePaused='0'; if(!window.__taglineTicker){ window.__taglineTicker = setInterval(rotate, 6000); setTimeout(rotate, 3000); } }\n}\n\nfunction initScrollProgress(){\n  const bar = document.getElementById('scrollProgress');\n  if(!bar) return;\n  const update = ()=>{\n    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop || 0;\n    const height = (document.documentElement.scrollHeight - document.documentElement.clientHeight) || 1;\n    const pct = Math.max(0, Math.min(100, (scrollTop/height)*100));\n    bar.style.width = pct + '%';\n  };\n  addEventListener('scroll', update, { passive:true });\n  update();\n}\n\nfunction initScrollTop(){\n  const btn = document.getElementById('scrollTop');\n  if(!btn) return;\n  const toggle = ()=>{ const y = window.scrollY||0; btn.style.display = y>300 ? 'block' : 'none'; };\n  addEventListener('scroll', toggle, { passive:true });\n  toggle();\n  btn.addEventListener('click', ()=> window.scrollTo({ top:0, behavior:'smooth' }));\n}\n", "import { qs, el } from './dom.js';\n\nlet overlay;\nlet bar;\nlet msgEl;\nlet skeletonRoot;\n\nfunction ensure(){\n  if(overlay) return;\n  overlay = qs('#loaderOverlay');\n  if(!overlay){\n    overlay = el('div','loader-overlay');\n    overlay.id = 'loaderOverlay';\n    // Start hidden by default so a partially executed boot sequence\n    // does not leave a dark overlay on screen.\n    overlay.hidden = true;\n    const box = el('div','loader');\n    msgEl = el('div','msg','');\n    bar = el('div','bar');\n    box.append(msgEl, bar);\n    overlay.append(box);\n    document.body.append(overlay);\n  }\n}\n\nexport function showLoader(){ ensure(); overlay.hidden = false; }\nexport function setLoader(msg, p){ ensure(); if(msgEl) msgEl.textContent = msg||''; if(bar) bar.style.width = (p||0)+\"%\"; }\nexport function hideLoader(){ ensure(); overlay.hidden = true; }\n\nexport function showSkeleton(count=18){\n  const grid = qs('#grid');\n  if(!grid) return;\n  skeletonRoot = el('div','skeleton');\n  for(let i=0;i<count;i++){ skeletonRoot.append(el('div','skel')); }\n  grid.replaceChildren(skeletonRoot);\n}\nexport function clearSkeleton(){\n  if(skeletonRoot && skeletonRoot.parentElement){ skeletonRoot.parentElement.removeChild(skeletonRoot); }\n  skeletonRoot = null;\n}\n", "import { getState } from './state.js';\nimport { getSources } from './data.js';\n\nexport function initDebugUi(){\n  const open = document.getElementById('openDebug');\n  if(open){ open.addEventListener('click', ()=>{ openPanel(); }); }\n}\n\nfunction openPanel(){\n  let overlay = document.getElementById('debugOverlay');\n  if(!overlay){ overlay = document.createElement('div'); overlay.id='debugOverlay'; overlay.className='debug-overlay';\n    overlay.innerHTML = `\n      <div class=\"debug-dialog\">\n        <div class=\"debug-header\"><h2>Debug</h2></div>\n        <div class=\"debug-body\"><pre id=\"debugPre\" class=\"debug-pre\"></pre></div>\n        <div class=\"debug-actions\">\n          <button id=\"debugCopy\" class=\"btn\">Copy report</button>\n          <button id=\"debugClose\" class=\"btn\">Schlie\u00DFen</button>\n        </div>\n      </div>`;\n    document.body.append(overlay);\n  }\n  overlay.hidden = false;\n  render();\n  overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closePanel(); });\n  document.getElementById('debugClose')?.addEventListener('click', closePanel, { once:true });\n  document.getElementById('debugCopy')?.addEventListener('click', copyReport, { once:true });\n}\n\nfunction closePanel(){ const overlay = document.getElementById('debugOverlay'); if(overlay) overlay.hidden = true; }\n\nfunction render(){\n  const pre = document.getElementById('debugPre'); if(!pre) return;\n  const s = getState();\n  const src = getSources();\n  const cfg = s.cfg||{};\n  const report = {\n    view: s.view,\n    counts: { movies: (s.movies||[]).length, shows: (s.shows||[]).length, filtered: (s.filtered||[]).length },\n    dataSources: src,\n    tmdb: { enabled: !!cfg.tmdbEnabled, lang: cfg.lang, tokenPresent: !!(localStorage.getItem('tmdbToken')||cfg.tmdbApiKey) },\n    useTmdbImages: localStorage.getItem('useTmdb')==='1',\n    reduceMotion: localStorage.getItem('prefReduceMotion')==='1',\n    locationHash: location.hash,\n    userAgent: navigator.userAgent,\n  };\n  pre.textContent = JSON.stringify(report, null, 2);\n}\n\nfunction copyReport(){\n  const pre = document.getElementById('debugPre'); if(!pre) return;\n  const txt = pre.textContent || '';\n  navigator.clipboard?.writeText(txt).catch(()=>{\n    try{ const ta=document.createElement('textarea'); ta.value=txt; document.body.append(ta); ta.select(); document.execCommand('copy'); ta.remove(); }catch{}\n  });\n}\n\n"],
  "mappings": "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",
  "names": ["setState", "patch", "S", "listeners", "fn", "getState", "init_state", "__esmMin", "el", "tag", "cls", "content", "n", "qs", "init_dom", "__esmMin", "s", "r", "fetchJson", "url", "r", "embeddedJsonById", "id", "n", "fromGlobalBag", "key", "bag", "fromWindow", "varName", "loadWithCompat", "primaryUrl", "opts", "data", "markSource", "emb", "win", "alt", "j", "prefixThumbValue", "value", "base", "raw", "SCHEME_RE", "normalizedBase", "withoutDots", "encodePath", "path", "segment", "cleanedLeading", "cleaned", "escapeRegExp", "str", "baseDir", "re", "encoded", "prefixThumb", "obj", "_a", "_b", "current", "prefixed", "prefixMovieThumb", "MOVIE_THUMB_BASE", "prefixShowThumb", "SHOW_THUMB_BASE", "prefixShowTree", "show", "prefixSeasonTree", "season", "ep", "normalizeMovieThumbs", "list", "item", "normalizeShowThumbs", "loadMovies", "movies", "loadShows", "shows", "loadShowDetail", "keys", "cacheKeys", "cached", "getCachedDetail", "urls", "detailUrlCandidates", "normalized", "normalizeShowDetail", "storeDetail", "cloneDetail", "label", "src", "lastSources", "getSources", "href", "normalizeHrefKey", "showDetailCache", "val", "rk", "detailKey", "detailHref", "hrefKey", "withoutData", "idPart", "normalizeGenres", "castList", "normalizePeople", "normalizeSeason", "out", "normalizeEpisode", "seen", "result", "entry", "tag", "detail", "init_data", "__esmMin", "getGenreNames", "genres", "seen", "names", "entry", "name", "str", "renderChipsLimited", "container", "values", "limit", "vals", "head", "rest", "chips", "text", "chip", "more", "enableMoreChipBehavior", "root", "btn", "hidden", "ch", "humanYear", "item", "formatRating", "val", "num", "fixed", "s", "isNew", "added", "cfg", "getState", "days", "useTmdbOn", "init_utils", "__esmMin", "init_state", "load", "saved", "STORAGE_KEY", "persist", "idFor", "item", "_a", "_b", "kind", "id", "isSaved", "count", "toggle", "k", "renderCount", "el", "openPanel", "p", "renderPanel", "closePanel", "setExpanded", "clear", "exportJson", "items", "listItems", "data", "blob", "a", "s", "getState", "pool", "map", "it", "list", "empty", "frag", "li", "t", "rm", "open", "initUi", "openBtn", "toggleBtn", "closeBtn", "clearBtn", "exportBtn", "on", "init_watchlist", "__esmMin", "init_state", "renderSeasonsAccordion", "targetOrSeasons", "maybeSeasons", "root", "resolveTarget", "seasons", "isTarget", "s", "idx", "seasonCardEl", "value", "season", "prefixShowThumb", "card", "head", "th", "img", "txt", "title", "sub", "year", "epCount", "chev", "body", "ep", "episodeRowEl", "_a", "row", "sNum", "eNum", "code", "right", "r", "b", "meta", "durMin", "durText", "dateText", "init_seasonsAccordion", "__esmMin", "init_data", "deepClone", "value", "entry", "out", "key", "mapMovie", "item", "clone", "mapShow", "normalizeShow", "mapDetail", "detail", "needsShowDetail", "seasons", "hasEpisodes", "season", "cast", "mergeShowDetail", "target", "mapped", "show", "normalizeThumbField", "normalizeGenresList", "normalizePeopleList", "normalizeSeasonEntry", "sc", "normalizeEpisodeEntry", "ep", "obj", "prefixShowThumb", "list", "seen", "result", "tag", "init_shared", "__esmMin", "init_data", "resolveRoot", "rootEl", "container", "overlayContainer", "onOverlayClick", "dialogEl", "scrollContainer", "existing", "ev", "target", "closeModalV2", "getFocusableElements", "el", "bindFocusTrap", "focusTrapHandler", "focusables", "first", "last", "unbindFocusTrap", "bindEscape", "escapeHandler", "unbindEscape", "showOverlay", "root", "focusInitial", "closeBtn", "focus", "resolvePoster", "item", "_a", "tmdbPoster", "localPoster", "useTmdbOn", "runtimeText", "minutes", "ratingText", "rating", "formatRating", "studioText", "releaseDateText", "candidates", "raw", "str", "parsed", "iso", "year", "humanYear", "namesFromList", "source", "entry", "genresFromItem", "mapped", "buildChips", "chips", "isNew", "genre", "buildCastList", "person", "_b", "_c", "name", "role", "rawRole", "tmdbProfile", "val", "thumb", "normalizeTmdbProfile", "path", "suffix", "TMDB_PROFILE_BASE", "TMDB_PROFILE_SIZE", "normalizeLocalImage", "resolveCastImage", "tmdbEnabled", "tmdbCandidates", "candidate", "url", "localCandidates", "castInitials", "chars", "part", "applyTabs", "tabs", "buttons", "select", "btn", "isActive", "pane", "moveFocus", "current", "delta", "currentIndex", "fallbackIndex", "index", "next", "initial", "updateCast", "cast", "scroll", "limited", "data", "card", "roleText", "avatar", "imageSrc", "img", "initials", "nameLine", "roleLine", "updateOverview", "text", "overview", "paragraph", "toggle", "setExpanded", "expanded", "cb", "updateDetails", "grid", "general", "release", "runtime", "studio", "certification", "critic", "audience", "user", "numericSeasons", "seasonCount", "episodeCount", "sum", "season", "eps", "countries", "collections", "labels", "section", "heading", "list", "label", "value", "dt", "dd", "genres", "span", "crew", "directors", "writers", "producers", "creators", "fallback", "updateSeasons", "seasons", "renderSeasonsAccordion", "setExternalLinks", "tmdbBtn", "imdbBtn", "trailerBtn", "tmdbId", "imdbId", "trailer", "type", "populateHead", "titleEl", "tagline", "metaEl", "subEl", "metaParts", "chipsRoot", "quickFacts", "quickList", "facts", "contentRating", "src", "onPosterReady", "showModalV2Loading", "message", "renderModalV2", "hasSeasons", "openMovieModalV2", "idOrData", "token", "renderToken", "lastActiveElement", "resolveMovieData", "currentItem", "currentKind", "openSeriesModalV2", "base", "resolveSeriesData", "working", "needsShowDetail", "detail", "loadShowDetail", "mergeShowDetail", "mapMovie", "DEMO_MOVIE", "state", "getState", "match", "movie", "matchesIdentifier", "mapShow", "DEMO_SERIES", "show", "id", "init_modalV2", "__esmMin", "init_seasonsAccordion", "init_utils", "init_state", "init_data", "init_shared", "grid_exports", "__export", "renderGrid", "cardEl", "item", "card", "el", "badges", "buildItemBadges", "poster", "createPoster", "progressPercent", "body", "title", "sub", "metaPieces", "buildMetaPieces", "tags", "genres", "getGenreNames", "renderChipsLimited", "actions", "watchBtn", "updateWatchButtonState", "ev", "toggle", "openDetail", "collectionTags", "entry", "createCollectionGroup", "name", "members", "list", "a", "b", "ay", "humanYear", "by", "years", "year", "addedTimestamps", "latestAdded", "ratings", "_a", "rating", "sum", "val", "posterItem", "groupCollectionsIfEnabled", "items", "togg", "colSel", "selected", "membership", "groups", "collectionCardEl", "baseItem", "buildCollectionBadges", "pieces", "formatRating", "sel", "view", "movies", "shows", "filtered", "getState", "base", "grid", "beginGridTransition", "frag", "x", "finishGridTransition", "empty", "progress", "altOverride", "img", "src", "resolvePoster", "badgeGroup", "badge", "overlay", "pct", "track", "fill", "tmdbPoster", "useTmdbOn", "fallback", "isNew", "createBadge", "contentRating", "ratingNum", "text", "button", "saved", "isSaved", "runtime", "formatRuntime", "studio", "_b", "raw", "minutes", "offset", "duration", "resolveItemId", "preferred", "updateHash", "kind", "id", "hash", "openSeriesModalV2", "openMovieModalV2", "init_grid", "__esmMin", "init_state", "init_filter", "init_dom", "init_utils", "init_watchlist", "init_modalV2", "filter_exports", "__export", "applyFilters", "computeFacets", "initFilters", "renderFacets", "updateFiltersAndGrid", "humanYear", "item", "collectionTags", "entry", "isNew", "added", "cfg", "getState", "days", "norm", "s", "matches", "opts", "query", "onlyNew", "yearFrom", "yearTo", "genresActive", "selectedCollection", "getGenreNames", "r", "year", "itemGenres", "g", "sortItems", "items", "key", "arr", "a", "b", "movies", "shows", "genres", "years", "collections", "add", "x", "name", "y", "c", "ys", "f", "yFrom", "qs", "yTo", "col", "gRoot", "chips", "updateGenreFilterState", "getFilterOpts", "_a", "_b", "_c", "_d", "_e", "searchInput", "collection", "sort", "n", "pool", "filtered", "ordered", "setState", "renderGridForCurrentView", "gridModulePromise", "mod", "fn", "result", "notifyFiltersUpdated", "detail", "root", "activeCount", "sortSel", "v", "l", "bind", "sel", "ev", "yrReset", "t", "init_filter", "__esmMin", "init_state", "init_dom", "init_utils", "tmdb_exports", "__export", "clearCache", "hydrateOptional", "validateToken", "loadCache", "persist", "cache", "tokenFromEnv", "cfg", "keyFor", "item", "_a", "_b", "imdb", "tmdb", "title", "year", "withAuth", "url", "auth", "sep", "getJson", "u", "init", "res", "pickBestPoster", "p", "IMG", "POSTER_W", "pickBestBackdrop", "BACKDROP_W", "byId", "type", "id", "lang", "inf", "API_V3", "images", "poster", "backdrop", "bySearch", "q", "yParam", "first", "hydrateItem", "k", "out", "json", "hit", "movies", "shows", "work", "i", "limit", "next", "chunk", "it", "data", "raw", "token", "looksLikeV3", "looksLikeJwt", "decodeJwtPayload", "t", "part", "s", "payload", "iss", "init_tmdb", "__esmMin", "init_state", "init_dom", "overlay", "bar", "msgEl", "skeletonRoot", "ensure", "qs", "el", "box", "showLoader", "setLoader", "msg", "p", "hideLoader", "showSkeleton", "count", "grid", "i", "clearSkeleton", "init_data", "init_filter", "init_grid", "init_modalV2", "init_tmdb", "init_watchlist", "init_state", "init_data", "initDebugUi", "open", "openPanel", "_a", "_b", "overlay", "render", "ev", "closePanel", "copyReport", "pre", "s", "getState", "src", "getSources", "cfg", "report", "txt", "ta", "init_utils", "currentHeroItem", "heroDefaults", "setFooterStatus", "message", "busy", "footer", "grid", "boot", "applyReduceMotionPref", "showLoader", "setLoader", "showSkeleton", "cfg", "r", "setState", "movies", "loadMovies", "shows", "loadShows", "facets", "computeFacets", "clearSkeleton", "renderSwitch", "renderFacets", "initFilters", "applyFilters", "renderStats", "renderGrid", "getState", "renderFooterMeta", "hideLoader", "_a", "hydrateOptional", "initUi", "initSettingsOverlay", "initAdvancedToggle", "initHeaderInteractions", "initScrollProgress", "initScrollTop", "renderHeroHighlight", "initDebugUi", "tmdbRaf", "hash", "view", "result", "m", "kind", "id", "item", "x", "_b", "openSeriesModalV2", "openMovieModalV2", "root", "buttons", "current", "btn", "target", "isActive", "animate", "s", "elM", "elS", "countTo", "el", "start", "end", "dur", "t0", "step", "t", "p", "val", "status", "times", "date", "listOverride", "hero", "title", "subtitle", "cta", "ensureHeroDefaults", "candidate", "selectHeroItem", "heroId", "resolveHeroId", "heroSubtitleText", "ctaLabel", "openHeroModal", "background", "resolveHeroBackdrop", "_c", "playableOverride", "isPlayableHeroItem", "chooseHeroCandidate", "playable", "heroCandidatesFromState", "list", "index", "state", "meta", "year", "humanYear", "runtime", "heroRuntimeText", "rating", "formatRating", "genres", "heroGenres", "summary", "heroSummaryText", "raw", "minutes", "limit", "names", "entry", "name", "sources", "text", "truncateText", "maxLength", "str", "navigateToItemHash", "_d", "_e", "tmdbEnabled", "useTmdbOn", "tmdbCandidates", "localCandidates", "tmdb", "isValidMediaPath", "value", "ev", "detail", "items", "overlay", "dialog", "open1", "open2", "close2", "tmdbInput", "tmdbSave", "tmdbTest", "tmdbStatus", "tmdbClear", "tmdbBadge", "reduce", "useTmdb", "resetFilters", "restoreFocus", "previousOverflow", "isOpen", "backgroundState", "focusSelector", "getFocusable", "focusDialog", "setBackgroundInert", "active", "nodes", "node", "openOverlay", "syncSettingsUi", "closeOverlay", "handleKeydown", "focusable", "first", "last", "setTmdbStatus", "msg", "stored", "currentInput", "setUseTmdbAvailability", "allowed", "token", "svc", "res", "search", "q", "onlyNew", "yf", "yt", "col", "n", "genreRoot", "F", "pref", "panel", "animating", "fallbackTimer", "finishAnimation", "queueFinish", "event", "openPanel", "height", "closePanel", "siteLogo", "titleEl", "TAGLINES", "idx", "rotate", "bar", "update", "scrollTop", "pct", "toggle", "y"]
}
