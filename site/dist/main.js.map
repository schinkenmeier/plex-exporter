{
  "version": 3,
  "sources": ["../js/state.js", "../js/dom.js", "../js/loader.js", "../js/cache.js", "../js/data/validators.js", "../js/errorHandler.js", "../js/data.js", "../js/utils.js", "../js/watchlist.js", "../js/modalV3/focusTrap.js", "../js/modalV3/shell.js", "../js/modalV3/state.js", "../js/modalV3/formatting.js", "../js/modalV3/header.js", "../js/modalV3/overview.js", "../js/modalV3/details.js", "../js/modalV3/castData.js", "../js/modalV3/cast.js", "../js/cacheStore.js", "../js/tmdbClient.js", "../js/imageHelper.js", "../js/tmdbMapper.js", "../js/metadataService.js", "../js/modalV3/seasons.js", "../js/modalV3/tabs.js", "../js/modalV3/mapping.js", "../js/modalV3/viewModel.js", "../js/modal/demoData.js", "../js/modalV3/index.js", "../js/grid/virtualList.js", "../js/grid.js", "../js/filter.js", "../js/services/tmdb.js", "../js/hero/policy.js", "../js/hero/tmdbClient.js", "../js/hero/normalizer.js", "../js/hero/storage.js", "../js/hero/pool.js", "../js/hero/pipeline.js", "../js/debug.js", "../js/settingsOverlay.js", "../js/hero.js", "../js/hero-autoplay.js", "../js/main.js"],
  "sourcesContent": ["const S = { view: 'movies', movies: [], shows: [], facets: {}, filtered: [], cfg: {}, heroPolicy: null, heroPolicyIssues: [] };\nconst listeners = new Set();\n\nexport const getState = () => S;\nexport function setState(patch){ Object.assign(S, patch); listeners.forEach(fn=>fn(S)); }\nexport function subscribe(fn){ listeners.add(fn); return ()=>listeners.delete(fn); }\n", "export const qs  = (s, r=document) => r.querySelector(s);\nexport const qsa = (s, r=document) => [...r.querySelectorAll(s)];\nexport function el(tag, cls, content){\n  const n=document.createElement(tag);\n  if(cls) n.className=cls;\n  if(content!=null) n.textContent = content;\n  return n;\n}\n\n", "import { qs, el } from './dom.js';\n\nlet overlay;\nlet bar;\nlet msgEl;\nlet skeletonRoot;\n\nfunction ensure(){\n  if(overlay) return;\n  overlay = qs('#loaderOverlay');\n  if(!overlay){\n    overlay = el('div','loader-overlay');\n    overlay.id = 'loaderOverlay';\n    // Start hidden by default so a partially executed boot sequence\n    // does not leave a dark overlay on screen.\n    overlay.hidden = true;\n    const box = el('div','loader');\n    msgEl = el('div','msg','');\n    bar = el('div','bar');\n    box.append(msgEl, bar);\n    overlay.append(box);\n    document.body.append(overlay);\n  }\n}\n\nexport function showLoader(){ ensure(); overlay.hidden = false; }\nexport function setLoader(msg, p){ ensure(); if(msgEl) msgEl.textContent = msg||''; if(bar) bar.style.width = (p||0)+\"%\"; }\nexport function hideLoader(){ ensure(); overlay.hidden = true; }\n\nexport function showSkeleton(count=18){\n  const grid = qs('#grid');\n  if(!grid) return;\n  skeletonRoot = el('div','skeleton');\n  for(let i=0;i<count;i++){ skeletonRoot.append(el('div','skel')); }\n  grid.replaceChildren(skeletonRoot);\n}\nexport function clearSkeleton(){\n  if(skeletonRoot && skeletonRoot.parentElement){ skeletonRoot.parentElement.removeChild(skeletonRoot); }\n  skeletonRoot = null;\n}\n", "/**\n * Enhanced Caching System with TTL and Storage Management\n */\n\nconst CACHE_PREFIX = 'plex_cache_';\nconst DEFAULT_TTL = 1000 * 60 * 60 * 24; // 24 hours\nconst MAX_CACHE_SIZE = 5 * 1024 * 1024; // 5MB\n\n/**\n * Set an item in cache with TTL\n * @param {string} key - Cache key\n * @param {any} value - Value to cache\n * @param {number} ttl - Time to live in milliseconds\n */\nexport function setCache(key, value, ttl = DEFAULT_TTL) {\n  try {\n    const cacheKey = CACHE_PREFIX + key;\n    const item = {\n      value,\n      timestamp: Date.now(),\n      ttl\n    };\n    localStorage.setItem(cacheKey, JSON.stringify(item));\n\n    // Check if we're approaching storage limits\n    checkCacheSize();\n  } catch (error) {\n    if (error.name === 'QuotaExceededError') {\n      console.warn('[cache] Storage quota exceeded, cleaning old entries');\n      cleanOldestEntries();\n      // Try again after cleanup\n      try {\n        const cacheKey = CACHE_PREFIX + key;\n        const item = { value, timestamp: Date.now(), ttl };\n        localStorage.setItem(cacheKey, JSON.stringify(item));\n      } catch (retryError) {\n        console.error('[cache] Failed to cache after cleanup:', retryError);\n      }\n    } else {\n      console.error('[cache] Failed to set cache:', error);\n    }\n  }\n}\n\n/**\n * Get an item from cache\n * @param {string} key - Cache key\n * @returns {any|null} Cached value or null if expired/not found\n */\nexport function getCache(key) {\n  try {\n    const cacheKey = CACHE_PREFIX + key;\n    const cached = localStorage.getItem(cacheKey);\n\n    if (!cached) return null;\n\n    const item = JSON.parse(cached);\n    if(typeof item.timestamp !== 'number' || typeof item.ttl !== 'number'){\n      localStorage.removeItem(cacheKey);\n      return null;\n    }\n    const now = Date.now();\n\n    // Check if expired\n    if (item.timestamp + item.ttl < now) {\n      localStorage.removeItem(cacheKey);\n      return null;\n    }\n\n    return item.value;\n  } catch (error) {\n    console.error('[cache] Failed to get cache:', error);\n    return null;\n  }\n}\n\n/**\n * Remove an item from cache\n * @param {string} key - Cache key\n */\nexport function removeCache(key) {\n  try {\n    const cacheKey = CACHE_PREFIX + key;\n    localStorage.removeItem(cacheKey);\n  } catch (error) {\n    console.error('[cache] Failed to remove cache:', error);\n  }\n}\n\n/**\n * Clear all cache entries\n */\nexport function clearAllCache() {\n  try {\n    const keys = Object.keys(localStorage);\n    keys.forEach(key => {\n      if (key.startsWith(CACHE_PREFIX)) {\n        localStorage.removeItem(key);\n      }\n    });\n    console.log('[cache] All cache cleared');\n  } catch (error) {\n    console.error('[cache] Failed to clear cache:', error);\n  }\n}\n\n/**\n * Clear expired cache entries\n */\nexport function clearExpiredCache() {\n  try {\n    const keys = Object.keys(localStorage);\n    const now = Date.now();\n    let cleared = 0;\n\n    keys.forEach(key => {\n      if (key.startsWith(CACHE_PREFIX)) {\n        try {\n          const item = JSON.parse(localStorage.getItem(key));\n          if (item.timestamp + item.ttl < now) {\n            localStorage.removeItem(key);\n            cleared++;\n          }\n        } catch (e) {\n          // Invalid cache entry, remove it\n          localStorage.removeItem(key);\n          cleared++;\n        }\n      }\n    });\n\n    if (cleared > 0) {\n      console.log(`[cache] Cleared ${cleared} expired entries`);\n    }\n  } catch (error) {\n    console.error('[cache] Failed to clear expired cache:', error);\n  }\n}\n\n/**\n * Get cache statistics\n */\nexport function getCacheStats() {\n  try {\n    const keys = Object.keys(localStorage);\n    const cacheKeys = keys.filter(k => k.startsWith(CACHE_PREFIX));\n    const now = Date.now();\n\n    let totalSize = 0;\n    let validEntries = 0;\n    let expiredEntries = 0;\n\n    cacheKeys.forEach(key => {\n      const value = localStorage.getItem(key);\n      totalSize += value.length * 2; // Approximate size in bytes (UTF-16)\n\n      try {\n        const item = JSON.parse(value);\n        if (item.timestamp + item.ttl >= now) {\n          validEntries++;\n        } else {\n          expiredEntries++;\n        }\n      } catch (e) {\n        expiredEntries++;\n      }\n    });\n\n    return {\n      totalEntries: cacheKeys.length,\n      validEntries,\n      expiredEntries,\n      totalSize,\n      totalSizeMB: (totalSize / 1024 / 1024).toFixed(2)\n    };\n  } catch (error) {\n    console.error('[cache] Failed to get cache stats:', error);\n    return null;\n  }\n}\n\n/**\n * Check cache size and clean if necessary\n */\nfunction checkCacheSize() {\n  try {\n    const stats = getCacheStats();\n    if (stats && stats.totalSize > MAX_CACHE_SIZE) {\n      console.warn('[cache] Cache size exceeded limit, cleaning...');\n      cleanOldestEntries(0.3); // Remove 30% of entries\n    }\n  } catch (error) {\n    console.error('[cache] Failed to check cache size:', error);\n  }\n}\n\n/**\n * Clean oldest cache entries\n * @param {number} percentage - Percentage of entries to remove (0-1)\n */\nfunction cleanOldestEntries(percentage = 0.3) {\n  try {\n    const keys = Object.keys(localStorage);\n    const cacheEntries = [];\n\n    keys.forEach(key => {\n      if (key.startsWith(CACHE_PREFIX)) {\n        try {\n          const item = JSON.parse(localStorage.getItem(key));\n          cacheEntries.push({ key, timestamp: item.timestamp });\n        } catch (e) {\n          // Invalid entry, mark for removal\n          cacheEntries.push({ key, timestamp: 0 });\n        }\n      }\n    });\n\n    // Sort by timestamp (oldest first)\n    cacheEntries.sort((a, b) => a.timestamp - b.timestamp);\n\n    // Remove oldest percentage\n    const toRemove = Math.ceil(cacheEntries.length * percentage);\n    for (let i = 0; i < toRemove; i++) {\n      localStorage.removeItem(cacheEntries[i].key);\n    }\n\n    console.log(`[cache] Removed ${toRemove} oldest entries`);\n  } catch (error) {\n    console.error('[cache] Failed to clean oldest entries:', error);\n  }\n}\n\n/**\n * Cached fetch wrapper\n * @param {string} url - URL to fetch\n * @param {object} options - Fetch options\n * @param {number} ttl - Cache TTL in milliseconds\n */\nexport async function cachedFetch(url, options = {}, ttl = DEFAULT_TTL) {\n  const cacheKey = `fetch_${url}`;\n\n  // Try to get from cache first\n  const cached = getCache(cacheKey);\n  if (cached !== null) {\n    return cached;\n  }\n\n  // Fetch and cache\n  try {\n    const response = await fetch(url, options);\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json();\n    setCache(cacheKey, data, ttl);\n    return data;\n  } catch (error) {\n    console.error(`[cache] Fetch failed for ${url}:`, error);\n    throw error;\n  }\n}\n\n// Auto-cleanup on page load (only in real browser environments)\nlet cleanupInterval = null;\n\nif (typeof window !== 'undefined' && typeof window.document !== 'undefined' && window === globalThis) {\n  // Clear expired entries on load\n  clearExpiredCache();\n\n  // Periodic cleanup every 5 minutes\n  cleanupInterval = setInterval(clearExpiredCache, 5 * 60 * 1000);\n}\n\n/**\n * Stop the periodic cleanup interval (useful for testing)\n */\nexport function stopCleanupInterval() {\n  if (cleanupInterval) {\n    clearInterval(cleanupInterval);\n    cleanupInterval = null;\n  }\n}\n", "const LOG_PREFIX = '[data/validators]';\n\nconst MOVIE_DEFAULTS = Object.freeze({\n  thumb: '',\n  thumbFile: '',\n  summary: '',\n  href: '',\n  tagline: '',\n  genres: [],\n});\n\nconst SHOW_DEFAULTS = Object.freeze({\n  thumb: '',\n  thumbFile: '',\n  summary: '',\n  href: '',\n  tagline: '',\n  genres: [],\n  seasons: [],\n});\n\nconst MOVIE_ITEM_SCHEMA = Object.freeze({\n  type: 'object',\n  required: ['title', 'ratingKey'],\n  properties: {\n    title: { type: 'string' },\n    ratingKey: { type: ['string', 'number'] },\n    thumb: { type: 'string', nullable: true },\n    thumbFile: { type: 'string', nullable: true },\n    summary: { type: 'string', nullable: true },\n    href: { type: 'string', nullable: true },\n    tagline: { type: 'string', nullable: true },\n    genres: { type: 'array', items: { type: ['string', 'object'] }, nullable: true },\n  },\n});\n\nconst SEASON_SCHEMA = Object.freeze({\n  type: 'object',\n  properties: {\n    episodes: { type: 'array', items: { type: 'object' }, nullable: true },\n    thumb: { type: 'string', nullable: true },\n    thumbFile: { type: 'string', nullable: true },\n  },\n});\n\nconst SHOW_ITEM_SCHEMA = Object.freeze({\n  type: 'object',\n  required: ['title', 'ratingKey'],\n  properties: {\n    title: { type: 'string' },\n    ratingKey: { type: ['string', 'number'] },\n    thumb: { type: 'string', nullable: true },\n    thumbFile: { type: 'string', nullable: true },\n    summary: { type: 'string', nullable: true },\n    href: { type: 'string', nullable: true },\n    tagline: { type: 'string', nullable: true },\n    genres: { type: 'array', items: { type: ['string', 'object'] }, nullable: true },\n    seasons: { type: 'array', items: SEASON_SCHEMA, nullable: true },\n  },\n});\n\nconst MOVIE_LIST_SCHEMA = Object.freeze({ type: 'array', items: MOVIE_ITEM_SCHEMA });\nconst SHOW_LIST_SCHEMA = Object.freeze({ type: 'array', items: SHOW_ITEM_SCHEMA });\n\nfunction isPlainObject(value){\n  return value !== null && typeof value === 'object' && !Array.isArray(value);\n}\n\nfunction matchesType(value, type){\n  switch(type){\n    case 'string': return typeof value === 'string';\n    case 'number': return typeof value === 'number' && Number.isFinite(value);\n    case 'boolean': return typeof value === 'boolean';\n    case 'array': return Array.isArray(value);\n    case 'object': return isPlainObject(value);\n    default: return false;\n  }\n}\n\nfunction validateAgainstSchema(value, schema, path = 'value'){\n  if(!schema) return;\n  if(value == null){\n    if(schema.nullable) return;\n    throw new Error(`${path} darf nicht null oder undefined sein.`);\n  }\n  const expectedTypes = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if(expectedTypes && expectedTypes.length){\n    const typeOk = expectedTypes.some(type => matchesType(value, type));\n    if(!typeOk){\n      const expected = expectedTypes.join(' oder ');\n      throw new Error(`${path} erwartet Typ ${expected}, erhielt ${typeof value}.`);\n    }\n  }\n  if(expectedTypes.includes('array')){\n    if(!Array.isArray(value)){\n      throw new Error(`${path} erwartet eine Liste.`);\n    }\n    if(schema.items){\n      value.forEach((item, index) => {\n        // Skip validation for genre items - they can be string or object with tag\n        if(path.includes('.genres') || path.includes('List') && schema.items.type &&\n           Array.isArray(schema.items.type) && schema.items.type.includes('string') && schema.items.type.includes('object')) {\n          return;\n        }\n        validateAgainstSchema(item, schema.items, `${path}[${index}]`);\n      });\n    }\n    return;\n  }\n  if(expectedTypes.includes('object')){\n    if(!isPlainObject(value)){\n      throw new Error(`${path} erwartet ein Objekt.`);\n    }\n    const required = schema.required || [];\n    for(const key of required){\n      const prop = value[key];\n      if(prop == null || (typeof prop === 'string' && !prop.trim())){\n        throw new Error(`${path}.${key} ist ein Pflichtfeld.`);\n      }\n    }\n    const properties = schema.properties || {};\n    for(const [key, definition] of Object.entries(properties)){\n      if(value[key] == null){\n        continue;\n      }\n      validateAgainstSchema(value[key], definition, `${path}.${key}`);\n    }\n  }\n}\n\nfunction ensureArrayOfStrings(list){\n  if(!Array.isArray(list)) return [];\n  return list\n    .map(item => {\n      if(typeof item === 'string') return item.trim();\n      if(item && typeof item === 'object' && typeof item.tag === 'string') return item.tag.trim();\n      return null;\n    })\n    .filter(item => item && item.length > 0);\n}\n\nfunction cloneWithDefaults(entry, defaults){\n  const result = { ...entry };\n  for(const [key, defaultValue] of Object.entries(defaults)){\n    if(result[key] == null){\n      result[key] = Array.isArray(defaultValue) ? [...defaultValue] : defaultValue;\n    }else if(Array.isArray(defaultValue)){\n      result[key] = Array.isArray(result[key]) ? [...result[key]] : [...defaultValue];\n    }\n  }\n  return result;\n}\n\nexport function isMovieEntry(value){\n  if(!isPlainObject(value)) return false;\n  if(typeof value.title !== 'string' || !value.title.trim()) return false;\n  const ratingKey = value.ratingKey;\n  if(!(typeof ratingKey === 'string' || typeof ratingKey === 'number')) return false;\n  return true;\n}\n\nexport function isShowEntry(value){\n  if(!isMovieEntry(value)) return false;\n  if(value.seasons == null) return true;\n  if(!Array.isArray(value.seasons)) return false;\n  return value.seasons.every(season => isPlainObject(season));\n}\n\nfunction sanitizeMovieEntry(entry){\n  const result = cloneWithDefaults(entry, MOVIE_DEFAULTS);\n  result.title = result.title.trim();\n  result.ratingKey = String(entry.ratingKey).trim();\n  const thumbValue = typeof result.thumb === 'string' ? result.thumb : '';\n  const thumbFileValue = typeof result.thumbFile === 'string' ? result.thumbFile : '';\n  result.thumb = thumbValue;\n  result.thumbFile = thumbFileValue || thumbValue;\n  result.summary = typeof result.summary === 'string' ? result.summary : '';\n  result.href = typeof result.href === 'string' ? result.href : '';\n  result.tagline = typeof result.tagline === 'string' ? result.tagline : '';\n  result.genres = ensureArrayOfStrings(result.genres);\n  return result;\n}\n\nfunction sanitizeShowEntry(entry){\n  const result = cloneWithDefaults(entry, SHOW_DEFAULTS);\n  result.title = result.title.trim();\n  result.ratingKey = String(entry.ratingKey).trim();\n  const thumbValue = typeof result.thumb === 'string' ? result.thumb : '';\n  const thumbFileValue = typeof result.thumbFile === 'string' ? result.thumbFile : '';\n  result.thumb = thumbValue;\n  result.thumbFile = thumbFileValue || thumbValue;\n  result.summary = typeof result.summary === 'string' ? result.summary : '';\n  result.href = typeof result.href === 'string' ? result.href : '';\n  result.tagline = typeof result.tagline === 'string' ? result.tagline : '';\n  result.genres = ensureArrayOfStrings(result.genres);\n  if(Array.isArray(entry.seasons)){\n    result.seasons = entry.seasons\n      .filter(isPlainObject)\n      .map(season => {\n        const seasonCopy = { ...season };\n        seasonCopy.episodes = Array.isArray(season.episodes)\n          ? season.episodes.filter(isPlainObject).map(episode => ({ ...episode }))\n          : [];\n        if(typeof seasonCopy.thumb !== 'string') seasonCopy.thumb = '';\n        if(typeof seasonCopy.thumbFile !== 'string') seasonCopy.thumbFile = '';\n        return seasonCopy;\n      });\n  }else{\n    result.seasons = [];\n  }\n  return result;\n}\n\nexport function validateLibraryList(data, kind = 'movie'){\n  const schema = kind === 'show' ? SHOW_LIST_SCHEMA : MOVIE_LIST_SCHEMA;\n  validateAgainstSchema(data, schema, `${kind}List`);\n  if(!Array.isArray(data)){\n    throw new Error('Datensatz ist keine Liste.');\n  }\n  const guard = kind === 'show' ? isShowEntry : isMovieEntry;\n  const sanitizer = kind === 'show' ? sanitizeShowEntry : sanitizeMovieEntry;\n  return data.map((entry, index) => {\n    if(!guard(entry)){\n      console.warn(`${LOG_PREFIX} Ung\u00FCltiger ${kind}-Eintrag an Index ${index}:`, entry);\n      throw new Error(`Ung\u00FCltiger ${kind}-Eintrag an Index ${index}.`);\n    }\n    return sanitizer(entry);\n  });\n}\n\nexport const __TEST_INTERNALS__ = {\n  MOVIE_DEFAULTS,\n  SHOW_DEFAULTS,\n  MOVIE_ITEM_SCHEMA,\n  SHOW_ITEM_SCHEMA,\n  MOVIE_LIST_SCHEMA,\n  SHOW_LIST_SCHEMA,\n  validateAgainstSchema,\n};\n", "/**\n * Global Error Handler\n * Provides centralized error handling and user feedback\n */\n\nlet errorContainer = null;\n\n/**\n * Initialize the error handler\n */\nexport function initErrorHandler() {\n  // Create error container if it doesn't exist\n  if (!errorContainer) {\n    errorContainer = document.createElement('div');\n    errorContainer.id = 'errorContainer';\n    errorContainer.className = 'error-container';\n    errorContainer.setAttribute('role', 'alert');\n    errorContainer.setAttribute('aria-live', 'polite');\n    document.body.appendChild(errorContainer);\n  }\n\n  // Global error handler for unhandled promise rejections\n  window.addEventListener('unhandledrejection', (event) => {\n    console.error('Unhandled promise rejection:', event.reason);\n    showError('Ein unerwarteter Fehler ist aufgetreten', event.reason?.message);\n    event.preventDefault();\n  });\n\n  // Global error handler for runtime errors\n  window.addEventListener('error', (event) => {\n    console.error('Runtime error:', event.error);\n    showError('Ein Fehler ist aufgetreten', event.error?.message);\n  });\n}\n\n/**\n * Show an error message to the user\n * @param {string} title - Error title\n * @param {string} message - Error message\n * @param {number} duration - Duration in ms (0 = permanent)\n */\nexport function showError(title, message = '', duration = 5000) {\n  if (!errorContainer) initErrorHandler();\n\n  const errorEl = document.createElement('div');\n  errorEl.className = 'error-toast';\n  errorEl.innerHTML = `\n    <div class=\"error-toast-content\">\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\n      <div class=\"error-toast-text\">\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\n        ${message ? `<div class=\"error-toast-message\">${escapeHtml(message)}</div>` : ''}\n      </div>\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\n    </div>\n  `;\n\n  const closeBtn = errorEl.querySelector('.error-toast-close');\n  closeBtn.addEventListener('click', () => {\n    errorEl.classList.add('error-toast-exit');\n    setTimeout(() => errorEl.remove(), 300);\n  });\n\n  errorContainer.appendChild(errorEl);\n\n  // Auto-remove after duration\n  if (duration > 0) {\n    setTimeout(() => {\n      if (errorEl.parentNode) {\n        errorEl.classList.add('error-toast-exit');\n        setTimeout(() => errorEl.remove(), 300);\n      }\n    }, duration);\n  }\n\n  // Animate in\n  requestAnimationFrame(() => {\n    errorEl.classList.add('error-toast-show');\n  });\n\n  return errorEl;\n}\n\n/**\n * Wrap an async function with error handling\n * @param {Function} fn - Async function to wrap\n * @param {string} errorTitle - Error title to show on failure\n * @returns {Function} Wrapped function\n */\nexport function withErrorHandling(fn, errorTitle = 'Ein Fehler ist aufgetreten') {\n  return async (...args) => {\n    try {\n      return await fn(...args);\n    } catch (error) {\n      console.error(`[${errorTitle}]`, error);\n      showError(errorTitle, error.message);\n      throw error;\n    }\n  };\n}\n\n/**\n * Show a loading error with retry option\n * @param {string} title - Error title\n * @param {Function} retryFn - Function to call on retry\n */\nexport function showRetryableError(title, retryFn) {\n  if (!errorContainer) initErrorHandler();\n\n  const errorEl = document.createElement('div');\n  errorEl.className = 'error-toast error-toast-retryable';\n  errorEl.innerHTML = `\n    <div class=\"error-toast-content\">\n      <div class=\"error-toast-icon\">\u26A0\uFE0F</div>\n      <div class=\"error-toast-text\">\n        <div class=\"error-toast-title\">${escapeHtml(title)}</div>\n      </div>\n      <button class=\"error-toast-retry\">Erneut versuchen</button>\n      <button class=\"error-toast-close\" aria-label=\"Schlie\u00DFen\">\u00D7</button>\n    </div>\n  `;\n\n  const retryBtn = errorEl.querySelector('.error-toast-retry');\n  const closeBtn = errorEl.querySelector('.error-toast-close');\n\n  retryBtn.addEventListener('click', async () => {\n    errorEl.remove();\n    try {\n      await retryFn();\n    } catch (err) {\n      console.error('Retry failed:', err);\n    }\n  });\n\n  closeBtn.addEventListener('click', () => {\n    errorEl.classList.add('error-toast-exit');\n    setTimeout(() => errorEl.remove(), 300);\n  });\n\n  errorContainer.appendChild(errorEl);\n\n  requestAnimationFrame(() => {\n    errorEl.classList.add('error-toast-show');\n  });\n\n  return errorEl;\n}\n\n/**\n * Clear all error messages\n */\nexport function clearErrors() {\n  if (errorContainer) {\n    errorContainer.innerHTML = '';\n  }\n}\n\n/**\n * Escape HTML to prevent XSS\n * @param {string} str - String to escape\n * @returns {string} Escaped string\n */\nfunction escapeHtml(str) {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n", "import { getCache, setCache } from './cache.js';\nimport { validateLibraryList } from './data/validators.js';\n\nconst LOG_PREFIX = '[data]';\n\nlet lastSources = { movies: null, shows: null };\nconst showDetailCache = new Map();\nconst DATA_CACHE_TTL = 1000 * 60 * 30; // 30 minutes for data files\n\nconst EXPORTER_BAG_KEY = '__PLEX_EXPORTER__';\n\nconst globalExporterBag = (()=>{\n  try{\n    if(typeof globalThis !== 'undefined'){\n      if(globalThis[EXPORTER_BAG_KEY]) return globalThis[EXPORTER_BAG_KEY];\n      if(globalThis.window && globalThis.window[EXPORTER_BAG_KEY]){\n        return globalThis.window[EXPORTER_BAG_KEY];\n      }\n    }\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to resolve global exporter bag:`, err?.message || err);\n  }\n  return null;\n})();\n\nconst MOVIE_THUMB_BASE = 'data/movies/';\nconst SHOW_THUMB_BASE = 'data/series/';\nconst SCHEME_RE = /^[a-z][a-z0-9+.-]*:/i;\n\nexport async function fetchJson(url, retries = 2, useCache = true){\n  // Try cache first if enabled\n  if(useCache){\n    const cached = getCache(url);\n    if(cached !== null) {\n      console.log(`${LOG_PREFIX} Cache hit for ${url}`);\n      return cached;\n    }\n  }\n\n  let lastError = null;\n  for(let attempt = 0; attempt <= retries; attempt++){\n    try{\n      const r = await fetch(url, { cache:'no-store' });\n      if(r && r.ok) {\n        const data = await r.json();\n        // Cache successful responses\n        if(useCache && data) {\n          setCache(url, data, DATA_CACHE_TTL);\n        }\n        return data;\n      }\n      if(r && r.status === 404) return null; // Don't retry 404s\n      lastError = new Error(`HTTP ${r.status}: ${r.statusText}`);\n    }\n    catch(err){\n      lastError = err;\n      console.warn(`${LOG_PREFIX} Fetch attempt ${attempt + 1}/${retries + 1} failed for ${url}:`, err.message);\n    }\n    if(attempt < retries){\n      // Exponential backoff\n      const delay = Math.min(1000 * Math.pow(2, attempt), 5000);\n      await new Promise(resolve => setTimeout(resolve, delay));\n    }\n  }\n  const message = lastError?.message || 'Unbekannter Fehler';\n  console.error(`${LOG_PREFIX} All fetch attempts failed for ${url}:`, message);\n  const error = new Error(`Daten konnten nicht geladen werden: ${url} (${message})`);\n  if(lastError && typeof lastError === 'object'){\n    error.cause = lastError;\n  }\n  throw error;\n}\n\nfunction embeddedJsonById(id){\n  try{\n    const n = document.getElementById(id);\n    if(n && n.textContent) return JSON.parse(n.textContent);\n  }\n  catch(err){\n    console.warn(`${LOG_PREFIX} Failed to parse embedded JSON #${id}:`, err.message);\n  }\n  return null;\n}\n\nfunction fromGlobalBag(key){\n  try{\n    const bag = globalExporterBag;\n    const arr = bag && Array.isArray(bag[key]) ? bag[key] : null;\n    return arr || null;\n  }\n  catch(err){\n    console.warn(`${LOG_PREFIX} Failed to access global bag[${key}]:`, err.message);\n    return null;\n  }\n}\n\nfunction fromWindow(varName){\n  try{\n    const arr = Array.isArray(window[varName]) ? window[varName] : null;\n    return arr || null;\n  }\n  catch(err){\n    console.warn(`${LOG_PREFIX} Failed to access window.${varName}:`, err.message);\n    return null;\n  }\n}\n\nasync function loadWithCompat(primaryUrl, opts){\n  // default: try site/data first\n  let data = null;\n  try{\n    data = await fetchJson(primaryUrl);\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Primary source failed for ${primaryUrl}:`, err.message);\n    data = null;\n  }\n  if(Array.isArray(data) && data.length){ markSource(opts?.label, `primary:${primaryUrl}`); return data; }\n  // fallback: embedded <script id=\"...\"> JSON\n  if(opts?.embedId){ const emb = embeddedJsonById(opts.embedId); if(Array.isArray(emb) && emb.length){ markSource(opts?.label, `embedded:${opts.embedId}`); return emb; } }\n  // fallback: global exporter bag\n  if(opts?.exportKey){ const bag = fromGlobalBag(opts.exportKey); if(Array.isArray(bag) && bag.length){ markSource(opts?.label, `globalBag:${opts.exportKey}`); return bag; } }\n  // fallback: window variable\n  if(opts?.globalVar){ const win = fromWindow(opts.globalVar); if(Array.isArray(win) && win.length){ markSource(opts?.label, `window:${opts.globalVar}`); return win; } }\n  // alt paths (legacy)\n  for(const alt of (opts?.altUrls||[])){\n    let altData = null;\n    try{\n      altData = await fetchJson(alt);\n    }catch(err){\n      console.warn(`${LOG_PREFIX} Alternate source failed for ${alt}:`, err.message);\n      altData = null;\n    }\n    if(Array.isArray(altData) && altData.length){ markSource(opts?.label, `alt:${alt}`); return altData; }\n  }\n  // last resort: empty array\n  markSource(opts?.label, 'empty');\n  return Array.isArray(data) ? data : [];\n}\n\nfunction notifyUiError(title, message){\n  if(typeof window === 'undefined' || typeof document === 'undefined' || typeof document.createElement !== 'function'){\n    console.warn(`${LOG_PREFIX} Skipping UI error feedback (environment missing DOM APIs): ${title} - ${message}`);\n    return;\n  }\n  import('./errorHandler.js').then(mod=>{\n    try{\n      mod.showError?.(title, message, 8000);\n    }catch(err){\n      console.warn(`${LOG_PREFIX} Failed to display UI error message:`, err?.message || err);\n    }\n  }).catch(err=>{\n    console.warn(`${LOG_PREFIX} Failed to load error handler for UI feedback:`, err?.message || err);\n  });\n}\n\nexport function prefixThumbValue(value, base){\n  const raw = value == null ? '' : String(value).trim();\n  if(!raw) return '';\n  if(raw.startsWith('//') || raw.startsWith('/') || SCHEME_RE.test(raw)) return raw;\n  const normalizedRaw = raw.replace(/\\\\/g, '/');\n  const normalizedBase = base ? (base.endsWith('/') ? base : `${base}/`) : '';\n  let decodeWarned = false;\n  const encodePath = path => path.split('/').map(segment => {\n    if(!segment) return '';\n    try{\n      return encodeURIComponent(decodeURIComponent(segment));\n    }catch(err){\n      if(!decodeWarned){\n        decodeWarned = true;\n        console.warn(`${LOG_PREFIX} Failed to normalize thumb segment \"${segment}\":`, err);\n      }\n      return encodeURIComponent(segment);\n    }\n  }).join('/');\n  const trimmed = normalizedRaw.replace(/^\\/+/, '');\n  const segments = trimmed.split('/');\n  const normalizedSegments = [];\n  for(const segment of segments){\n    if(!segment || segment === '.') continue;\n    if(segment === '..'){\n      if(normalizedSegments.length) normalizedSegments.pop();\n      continue;\n    }\n    normalizedSegments.push(segment);\n  }\n  const normalizedPath = normalizedSegments.join('/');\n  if(normalizedPath.startsWith('data/')) return encodePath(normalizedPath);\n  let relativeSegments = normalizedSegments;\n  if(normalizedBase && relativeSegments.length){\n    const baseDir = normalizedBase.replace(/\\/+$/, '').split('/').pop();\n    if(baseDir && relativeSegments[0] === baseDir){\n      relativeSegments = relativeSegments.slice(1);\n    }\n  }\n  const cleaned = relativeSegments.join('/');\n  const encoded = encodePath(cleaned);\n  return `${normalizedBase}${encoded}`;\n}\n\n\nexport function prefixThumb(obj, base){\n  if(!obj || typeof obj !== 'object') return obj;\n  const current = obj.thumbFile ?? obj.thumb ?? '';\n  const prefixed = prefixThumbValue(current, base);\n  if(prefixed){\n    obj.thumbFile = prefixed;\n    obj.thumb = prefixed;\n  }else if(current){\n    const str = String(current);\n    obj.thumbFile = str;\n    if(obj.thumb == null) obj.thumb = str;\n  }\n  return obj;\n}\n\nexport function prefixMovieThumb(obj){\n  return prefixThumb(obj, MOVIE_THUMB_BASE);\n}\n\nexport function prefixShowThumb(obj){\n  return prefixThumb(obj, SHOW_THUMB_BASE);\n}\n\nexport function prefixShowTree(show){\n  if(!show || typeof show !== 'object') return show;\n  prefixShowThumb(show);\n  if(Array.isArray(show.seasons)) show.seasons.forEach(prefixSeasonTree);\n  return show;\n}\n\nfunction prefixSeasonTree(season){\n  if(!season || typeof season !== 'object') return season;\n  prefixShowThumb(season);\n  if(Array.isArray(season.episodes)) season.episodes.forEach(ep=>prefixShowThumb(ep));\n  return season;\n}\n\nfunction normalizeMovieThumbs(list){\n  if(!Array.isArray(list)) return [];\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixMovieThumb(item); });\n  return list;\n}\n\nfunction normalizeShowThumbs(list){\n  if(!Array.isArray(list)) return [];\n  list.forEach(item=>{ if(item && typeof item === 'object') prefixShowTree(item); });\n  return list;\n}\n\nexport async function loadMovies(){\n  try {\n    const rawMovies = await loadWithCompat('data/movies/movies.json', {\n      label: 'movies',\n      embedId: 'movies-json',\n      exportKey: 'movies',\n      globalVar: '__PLEX_MOVIES__',\n      altUrls: [\n        'movies/movies.json',\n        'data/movies.json',\n        'Filme/movies.json',\n        'movies.json',\n      ],\n    });\n    let movies;\n    try{\n      movies = validateLibraryList(rawMovies, 'movie');\n    }catch(validationError){\n      const message = validationError?.message || 'Unbekannte Validierungsfehler';\n      console.warn(`${LOG_PREFIX} Movie validation failed:`, validationError);\n      const error = new Error(`Ung\u00FCltige Filmdaten: ${message}`);\n      if(validationError instanceof Error){\n        error.cause = validationError;\n      }\n      throw error;\n    }\n    return normalizeMovieThumbs(movies);\n  } catch (error) {\n    console.error(`${LOG_PREFIX} loadMovies failed:`, error);\n    notifyUiError('Filme konnten nicht geladen werden', error?.message || 'Unbekannter Fehler');\n    return [];\n  }\n}\nexport async function loadShows(){\n  try {\n    const rawShows = await loadWithCompat('data/series/series_index.json', {\n      label: 'shows',\n      embedId: 'series-json',\n      exportKey: 'shows',\n      globalVar: '__PLEX_SHOWS__',\n      altUrls: [\n        'series/series_index.json',\n        'data/shows.json',\n        'data/series.json',\n        'Serien/series.json',\n        'series/series.json',\n        'series.json',\n        'shows.json',\n      ],\n    });\n    let shows;\n    try{\n      shows = validateLibraryList(rawShows, 'show');\n    }catch(validationError){\n      const message = validationError?.message || 'Unbekannte Validierungsfehler';\n      console.warn(`${LOG_PREFIX} Show validation failed:`, validationError);\n      const error = new Error(`Ung\u00FCltige Seriendaten: ${message}`);\n      if(validationError instanceof Error){\n        error.cause = validationError;\n      }\n      throw error;\n    }\n    return normalizeShowThumbs(shows);\n  } catch (error) {\n    console.error(`${LOG_PREFIX} loadShows failed:`, error);\n    notifyUiError('Serien konnten nicht geladen werden', error?.message || 'Unbekannter Fehler');\n    return [];\n  }\n}\n\nexport async function loadShowDetail(item){\n  if(!item) return null;\n  const keys = cacheKeys(item);\n  const cached = getCachedDetail(keys);\n  if(cached !== undefined) return cached;\n\n  const urls = detailUrlCandidates(item);\n  let lastError = null;\n\n  for(const url of urls){\n    try {\n      const data = await fetchJson(url);\n      if(data && typeof data === 'object'){\n        const normalized = normalizeShowDetail(data);\n        storeDetail(keys, normalized, item);\n        return cloneDetail(normalized);\n      }\n    } catch (error) {\n      lastError = error;\n      console.warn(`${LOG_PREFIX} Failed to load show detail from ${url}:`, error.message);\n    }\n  }\n\n  if(lastError) {\n    console.error(`${LOG_PREFIX} Could not load show detail for ${item.title || 'unknown'}`, lastError);\n    notifyUiError('Details konnten nicht geladen werden', lastError?.message || 'Bitte sp\u00E4ter erneut versuchen.');\n  }\n\n  storeDetail(keys, null, item);\n  return null;\n}\n\nfunction markSource(label, src){\n  if(!label) return;\n  try{\n    lastSources[label] = src;\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to record source for ${label}:`, err);\n  }\n}\n\nexport function getSources(){ return { ...lastSources }; }\nfunction cacheKeys(item){\n  const keys = [];\n  if(item?.ratingKey !== undefined && item?.ratingKey !== null && item?.ratingKey !== ''){\n    keys.push(`rk:${String(item.ratingKey)}`);\n  }\n  const href = normalizeHrefKey(item?.href);\n  if(href) keys.push(`href:${href}`);\n  return keys;\n}\n\nfunction normalizeHrefKey(href){\n  if(!href) return '';\n  return String(href).trim().replace(/^\\.\\//,'').replace(/^\\/+/, '');\n}\n\nfunction getCachedDetail(keys){\n  for(const key of keys){\n    if(showDetailCache.has(key)){\n      const cached = showDetailCache.get(key);\n      return cached ? cloneDetail(cached) : null;\n    }\n  }\n  return undefined;\n}\n\nfunction storeDetail(keys, value, item){\n  const val = value;\n  keys.forEach(key=>{ showDetailCache.set(key, val); });\n  const rk = item?.ratingKey;\n  if(rk !== undefined && rk !== null){\n    showDetailCache.set(`rk:${String(rk)}`, val);\n  }\n  const detailKey = value && typeof value === 'object' ? value.ratingKey : undefined;\n  if(detailKey !== undefined && detailKey !== null){\n    showDetailCache.set(`rk:${String(detailKey)}`, val);\n  }\n  const href = normalizeHrefKey(item?.href);\n  if(href){\n    showDetailCache.set(`href:${href}`, val);\n  }\n  const detailHref = value && typeof value === 'object' ? normalizeHrefKey(value.href) : '';\n  if(detailHref){\n    showDetailCache.set(`href:${detailHref}`, val);\n  }\n}\n\nfunction detailUrlCandidates(item){\n  const urls = new Set();\n  const hrefKey = normalizeHrefKey(item?.href);\n  if(hrefKey){\n    if(/^https?:/i.test(hrefKey)){ urls.add(hrefKey); }\n    else{\n      if(hrefKey.startsWith('data/')) urls.add(hrefKey);\n      else urls.add(`data/${hrefKey}`);\n      const withoutData = hrefKey.replace(/^data\\//,'');\n      if(!withoutData.startsWith('series/')) urls.add(`data/series/${withoutData}`);\n      const idPart = withoutData.replace(/^series\\//,'').replace(/^details\\//,'').replace(/\\.json$/,'');\n      if(idPart) urls.add(`data/series/details/${idPart}.json`);\n    }\n  }\n  const rk = item?.ratingKey;\n  if(rk !== undefined && rk !== null){\n    urls.add(`data/series/details/${String(rk)}.json`);\n  }\n  return Array.from(urls);\n}\n\nfunction normalizeShowDetail(data){\n  if(!data || typeof data !== 'object') return null;\n  const show = { ...data };\n  prefixShowThumb(show);\n  show.genres = normalizeGenres(show.genres);\n  const castList = normalizePeople(show.cast || show.roles || []);\n  show.cast = castList;\n  show.roles = castList;\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeason).filter(Boolean) : [];\n  show.seasonCount = Number.isFinite(show.seasonCount) ? show.seasonCount : show.seasons.length;\n  prefixShowTree(show);\n  return show;\n}\n\nfunction normalizeSeason(season){\n  if(!season || typeof season !== 'object') return null;\n  const out = { ...season };\n  prefixShowThumb(out);\n  out.genres = normalizeGenres(out.genres);\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisode).filter(Boolean) : [];\n  prefixSeasonTree(out);\n  return out;\n}\n\nfunction normalizeEpisode(ep){\n  if(!ep || typeof ep !== 'object') return null;\n  const out = { ...ep };\n  prefixShowThumb(out);\n  out.genres = normalizeGenres(out.genres);\n  return out;\n}\n\nfunction normalizeGenres(list){\n  if(!Array.isArray(list)) return [];\n  const seen = new Set();\n  const result = [];\n  list.forEach(entry=>{\n    let obj = null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      if(tag) obj = { tag };\n    }else if(entry && typeof entry === 'object'){\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\n      if(tag){ obj = { ...entry, tag }; }\n    }\n    if(obj && !seen.has(obj.tag)){\n      seen.add(obj.tag);\n      result.push(obj);\n    }\n  });\n  return result;\n}\n\nfunction normalizePeople(list){\n  if(!Array.isArray(list)) return [];\n  return list.map(entry=>{\n    if(!entry) return null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      return tag ? { tag } : null;\n    }\n    if(typeof entry === 'object'){\n      const tag = String(entry.tag || entry.name || entry.role || '').trim();\n      if(tag){ return { ...entry, tag }; }\n      return { ...entry };\n    }\n    return null;\n  }).filter(Boolean);\n}\n\nfunction cloneDetail(detail){\n  if(detail === null || detail === undefined) return detail;\n  try{\n    return structuredClone(detail);\n  }catch(err){\n    console.warn(`${LOG_PREFIX} structuredClone failed for show detail:`, err);\n  }\n  try{\n    return JSON.parse(JSON.stringify(detail));\n  }catch(err){\n    console.warn(`${LOG_PREFIX} JSON clone failed for show detail:`, err);\n  }\n  return detail;\n}\n", "import { getState } from './state.js';\n\nconst LOG_PREFIX = '[utils]';\n\nexport function getGenreNames(genres){\n  const seen = new Set();\n  const names = [];\n  (genres || []).forEach(entry=>{\n    let name = '';\n    if(typeof entry === 'string'){\n      name = entry;\n    }else if(entry && typeof entry === 'object'){\n      name = entry.tag || entry.title || entry.name || '';\n    }\n    const str = String(name || '').trim();\n    if(str && !seen.has(str)){\n      seen.add(str);\n      names.push(str);\n    }\n  });\n  return names;\n}\n\nexport function renderChipsLimited(container, values, limit=3){\n  if(!container) return;\n  const vals = (values||[]).filter(Boolean);\n\n  // If we have more values than the limit, show limit chips + aggregator\n  if(vals.length > limit){\n    const head = vals.slice(0, limit);\n    const rest = vals.slice(limit);\n    const chips = head.map(text=>chip(text));\n\n    const more = chip(`+ ${rest.length}`);\n    more.classList.add('more', 'card__chip--more');\n    more.setAttribute('data-more', rest.length);\n    more.setAttribute('title', `${rest.length} weitere Genres: ${rest.join(', ')}`);\n    // store extra chips to reveal on click\n    more._extraChips = rest.map(text=>chip(text));\n    chips.push(more);\n\n    container.replaceChildren(...chips);\n  } else {\n    // Show all chips if we have limit or fewer\n    const chips = vals.map(text=>chip(text));\n    container.replaceChildren(...chips);\n  }\n\n  enableMoreChipBehavior(container);\n}\n\nexport function enableMoreChipBehavior(root = document){\n  try{\n    root.querySelectorAll('.chip.more, .card__chip--more').forEach(btn=>{\n      if(btn.dataset.bound) return;\n      btn.dataset.bound = '1';\n      btn.addEventListener('click', (e)=>{\n        // Stop propagation to prevent card click from opening modal\n        e.stopPropagation();\n\n        // Find the parent card element\n        const card = btn.closest('.card');\n        if(card) {\n          // Trigger the card's click event to open the modal\n          card.click();\n        } else {\n          // Fallback: expand inline if not in a card context\n          const hidden = btn._extraChips || [];\n          try{\n            hidden.forEach(ch => btn.before(ch));\n          }catch(err){\n            console.warn(`${LOG_PREFIX} Failed to expand inline chips:`, err);\n          }\n          btn.remove();\n        }\n      });\n    });\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to enable more chip behaviour:`, err);\n  }\n}\n\nexport function collectionTags(item){\n  return ((item && item.collections) || [])\n    .map(entry=>entry && (entry.tag || entry.title || entry.name || ''))\n    .filter(Boolean);\n}\n\nexport function humanYear(item){\n  if(!item) return '';\n  const candidates = [\n    item.originallyAvailableAt,\n    item.year,\n    item.releaseDate,\n    item.premiereDate,\n  ];\n\n  for(const value of candidates){\n    if(value === undefined || value === null) continue;\n    const str = String(value);\n    if(!str) continue;\n    const match = str.match(/\\d{4}/);\n    if(match) return match[0];\n  }\n\n  return '';\n}\n\nexport function formatRating(val){\n  if(val instanceof Number){\n    return formatRating(val.valueOf());\n  }\n\n  if(typeof val === 'number'){\n    return Number.isFinite(val) ? val.toFixed(1) : '0.0';\n  }\n\n  if(typeof val === 'string'){\n    const trimmed = val.trim();\n    if(!trimmed) return '0.0';\n    const num = Number(trimmed);\n    return Number.isFinite(num) ? num.toFixed(1) : '0.0';\n  }\n\n  return '0.0';\n}\n\nfunction chip(text){ const s=document.createElement('span'); s.className='chip'; s.textContent=String(text||''); return s; }\n\nexport function isNew(item){\n  if(!item?.addedAt) return false;\n  const added = new Date(item.addedAt).getTime();\n  if(!Number.isFinite(added)) return false;\n  const cfg = getState().cfg || {};\n  const days = Number(cfg.newDays || 30);\n  return Date.now() - added <= days * 24*60*60*1000;\n}\n\n/**\n * Check if TMDB credentials are available\n * @returns {boolean}\n */\nfunction hasTmdbCredentials(){\n  try{\n    const token = localStorage.getItem('tmdbToken');\n    if(token && token.trim()) return true;\n    const state = getState();\n    if(state.cfg?.tmdbToken || state.cfg?.tmdbApiKey) return true;\n    return false;\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Unable to check TMDB credentials:`, err);\n    return false;\n  }\n}\n\n/**\n * Check if TMDB images should be used for grid cards\n * User-controlled toggle (default: off)\n * @returns {boolean}\n */\nexport function useTmdbForCards(){\n  try{\n    return localStorage.getItem('useTmdb')==='1';\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Unable to read TMDB card preference from storage:`, err);\n    return false;\n  }\n}\n\n/**\n * Check if TMDB should be used for Hero banner\n * Always enabled when credentials are available\n * @returns {boolean}\n */\nexport function useTmdbForHero(){\n  return hasTmdbCredentials();\n}\n\n/**\n * Legacy alias for backwards compatibility\n * @deprecated Use useTmdbForCards() instead\n */\nexport function useTmdbOn(){\n  return useTmdbForCards();\n}\n\n/**\n * Safely clear hero cache while preserving user settings\n * @returns {Object} Summary of cleared items\n */\nexport function clearHeroCache(){\n  try{\n    // Backup important user data\n    const backup = {\n      tmdbToken: localStorage.getItem('tmdbToken'),\n      useTmdb: localStorage.getItem('useTmdb'),\n      prefReduceMotion: localStorage.getItem('prefReduceMotion'),\n      watchlist: localStorage.getItem('watchlist:v1'),\n      modalLayout: localStorage.getItem('modalLayout'),\n      scrollOrchestratorEnabled: localStorage.getItem('scrollOrchestratorEnabled')\n    };\n\n    // Count items before clearing\n    const heroKeys = Object.keys(localStorage).filter(k =>\n      k.startsWith('hero') || k.startsWith('Hero')\n    );\n    const tmdbCacheKeys = Object.keys(localStorage).filter(k =>\n      k.includes('tmdbCache') || k === 'hero.tmdbCache.v1'\n    );\n\n    // Clear hero-related data\n    heroKeys.forEach(key => localStorage.removeItem(key));\n    tmdbCacheKeys.forEach(key => localStorage.removeItem(key));\n\n    // Restore user settings\n    Object.entries(backup).forEach(([key, value]) => {\n      if(value !== null) localStorage.setItem(key, value);\n    });\n\n    console.log(`${LOG_PREFIX} Cleared ${heroKeys.length} hero entries and ${tmdbCacheKeys.length} TMDB cache entries`);\n\n    return {\n      heroEntries: heroKeys.length,\n      tmdbCacheEntries: tmdbCacheKeys.length,\n      preserved: Object.keys(backup).filter(k => backup[k] !== null)\n    };\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to clear hero cache:`, err);\n    return { error: err.message };\n  }\n}\n", "import { getState } from './state.js';\n\nconst STORAGE_KEY = 'watchlist:v1';\nconst LOG_PREFIX = '[watchlist]';\nlet saved = new Set();\n\nfunction load(){\n  try{\n    saved = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'));\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to load entries from storage:`, err?.message || err);\n    saved = new Set();\n  }\n}\nfunction persist(){\n  try{\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(saved.values())));\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to persist entries to storage:`, err?.message || err);\n  }\n}\n\nfunction idFor(item){\n  if(!item) return '';\n  const kind = (item.type==='tv' || item.libraryType==='show') ? 'show' : 'movie';\n  const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\n  return id ? `${kind}:${id}` : '';\n}\n\nexport function isSaved(item){ return saved.has(idFor(item)); }\nexport function count(){ return saved.size; }\nexport function toggle(item){\n  const k=idFor(item);\n  if(!k) return;\n  if(saved.has(k)) saved.delete(k); else saved.add(k);\n  persist();\n  renderCount();\n  const panel=document.getElementById('watchlistPanel');\n  if(panel && !panel.hidden) renderPanel();\n}\n\nexport function renderCount(){ const el=document.getElementById('watchlistCount'); if(el) el.textContent = String(count()); }\n\nexport function openPanel(){\n  const p=document.getElementById('watchlistPanel');\n  if(p) {\n    p.hidden=false;\n    p.setAttribute('aria-hidden','false');\n    renderPanel();\n  }\n}\n\nexport function closePanel(){\n  const p=document.getElementById('watchlistPanel');\n  if(p){\n    p.hidden=true;\n    p.setAttribute('aria-hidden','true');\n  }\n  setExpanded(false);\n}\n\nexport function clear(){ saved.clear(); persist(); renderCount(); renderPanel(); }\n\nexport function exportJson(){\n  const items = listItems();\n  const data = JSON.stringify(items, null, 2);\n  const blob = new Blob([data], { type:'application/json' });\n  const a = document.createElement('a');\n  a.href = URL.createObjectURL(blob);\n  a.download = 'watchlist.json';\n  document.body.append(a); a.click(); a.remove();\n  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);\n}\n\nfunction listItems(){\n  const s = getState();\n  const pool = (s.movies||[]).concat(s.shows||[]);\n  const map = new Map(pool.map(it=>[idFor(it), it]));\n  return Array.from(saved.values()).map(k=>map.get(k)).filter(Boolean);\n}\n\nexport function renderPanel(){\n  const list = document.getElementById('watchlistItems');\n  const empty = document.getElementById('watchlistEmpty');\n  if(!list || !empty) return;\n  const items = listItems();\n  if(items.length===0){ list.replaceChildren(); empty.hidden=false; return; }\n  empty.hidden=true;\n  const frag = document.createDocumentFragment();\n  items.forEach(item=>{\n    const li = document.createElement('li');\n    li.className = 'watchlist-item';\n    const t = document.createElement('span');\n    t.className='title';\n    t.textContent = item.title || '';\n    const rm = document.createElement('button');\n    rm.textContent = 'Entfernen';\n    rm.addEventListener('click', ()=>{ toggle(item); renderPanel(); });\n    const open = document.createElement('button');\n    open.textContent = '\u00D6ffnen';\n    open.addEventListener('click', ()=>{\n      const kind = (item.type==='tv') ? 'show' : 'movie';\n      const id = item.ids?.imdb || item.ids?.tmdb || String(item.ratingKey||'');\n      if(id) location.hash = `#/${kind}/${id}`;\n    });\n    li.append(t, open, rm);\n    frag.append(li);\n  });\n  list.replaceChildren(frag);\n}\n\nexport function initUi(){\n  load();\n  renderCount();\n  const openBtn = document.getElementById('openWatchlist');\n  const toggleBtn = document.getElementById('watchlistToggle');\n  const closeBtn = document.getElementById('closeWatchlist');\n  const clearBtn = document.getElementById('clearWatchlist');\n  const exportBtn = document.getElementById('exportWatchlist');\n  openBtn && openBtn.addEventListener('click', ()=>{ openPanel(); setExpanded(true); });\n  toggleBtn && toggleBtn.addEventListener('click', ()=>{ const p=document.getElementById('watchlistPanel'); if(p && !p.hidden){ closePanel(); } else { openPanel(); setExpanded(true); } });\n  closeBtn && closeBtn.addEventListener('click', ()=>{ closePanel(); });\n  clearBtn && clearBtn.addEventListener('click', ()=>{ clear(); });\n  exportBtn && exportBtn.addEventListener('click', ()=>{ exportJson(); });\n}\n\nfunction setExpanded(on){ const t=document.getElementById('watchlistToggle'); if(t) t.setAttribute('aria-expanded', on?'true':'false'); }\n", "const selectors = 'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex=\"-1\"])';\n\nlet boundDialog = null;\nlet focusTrapHandler = null;\nlet escapeHandler = null;\nlet escapeCallback = null;\n\nfunction isElementVisible(el){\n  if(!el) return false;\n  if(el.hasAttribute('disabled')) return false;\n  if(el.getAttribute('aria-hidden') === 'true') return false;\n  if(el.hasAttribute('hidden')) return false;\n  if(el.offsetParent === null) return false;\n  return true;\n}\n\nexport function getFocusableElements(container){\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(!elementCtor || !(container instanceof elementCtor)) return [];\n  return Array.from(container.querySelectorAll(selectors)).filter(isElementVisible);\n}\n\nexport function bindFocusTrap(container){\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(!elementCtor || !(container instanceof elementCtor)) return;\n  if(boundDialog && focusTrapHandler){\n    boundDialog.removeEventListener('keydown', focusTrapHandler);\n  }\n  const handler = (ev)=>{\n    if(ev.key !== 'Tab') return;\n    const focusables = getFocusableElements(container);\n    if(!focusables.length) return;\n    const first = focusables[0];\n    const last = focusables[focusables.length - 1];\n    const active = typeof document !== 'undefined' ? document.activeElement : null;\n    if(ev.shiftKey){\n      if(active === first){\n        ev.preventDefault();\n        last.focus();\n      }\n      return;\n    }\n    if(active === last){\n      ev.preventDefault();\n      first.focus();\n    }\n  };\n  container.addEventListener('keydown', handler);\n  boundDialog = container;\n  focusTrapHandler = handler;\n}\n\nexport function unbindFocusTrap(){\n  if(boundDialog && focusTrapHandler){\n    boundDialog.removeEventListener('keydown', focusTrapHandler);\n  }\n  boundDialog = null;\n  focusTrapHandler = null;\n}\n\nexport function bindEscape(callback){\n  if(typeof window === 'undefined') return;\n  if(escapeHandler){\n    window.removeEventListener('keydown', escapeHandler);\n  }\n  escapeCallback = typeof callback === 'function' ? callback : null;\n  const handler = (ev)=>{\n    if(ev.key !== 'Escape') return;\n    ev.preventDefault();\n    if(escapeCallback){\n      try{ escapeCallback(ev); }\n      catch(err){ console.warn('[modalV3] Failed to handle escape key:', err?.message || err); }\n    }\n  };\n  escapeHandler = handler;\n  window.addEventListener('keydown', handler);\n}\n\nexport function unbindEscape(){\n  if(typeof window === 'undefined') return;\n  if(escapeHandler){\n    window.removeEventListener('keydown', escapeHandler);\n  }\n  escapeHandler = null;\n  escapeCallback = null;\n}\n\nexport function focusInitial(container){\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(!elementCtor || !(container instanceof elementCtor)) return;\n  const closeBtn = container.querySelector('#action-close');\n  const focusables = getFocusableElements(container);\n  let target = (closeBtn && !closeBtn.hasAttribute('hidden')) ? closeBtn : focusables[0];\n  if(!target) target = container;\n  const focusFn = ()=>{\n    try{ target.focus(); }\n    catch(err){ console.warn('[modalV3] Failed to focus target element:', err?.message || err); }\n  };\n  const schedule = typeof window !== 'undefined' && window.requestAnimationFrame ? window.requestAnimationFrame : setTimeout;\n  schedule(focusFn, 0);\n}\n", "import { bindFocusTrap, unbindFocusTrap, bindEscape, unbindEscape, focusInitial as focusDialog, getFocusableElements } from './focusTrap.js';\n\nlet overlayContainer = null;\nlet dialogEl = null;\nlet scrollContainer = null;\nlet backdropEl = null;\nlet rootEl = null;\n\nfunction ensureContainer(){\n  if(typeof document === 'undefined') return null;\n  if(overlayContainer) return overlayContainer;\n  const container = document.getElementById('modal-root');\n  if(!container) return null;\n  overlayContainer = container;\n  container.classList.add('modalv3-overlay');\n  if(!container.hasAttribute('hidden')) container.setAttribute('hidden', '');\n  if(!container.hasAttribute('aria-hidden')) container.setAttribute('aria-hidden', 'true');\n  container.dataset.modalv3Ready = '1';\n\n  if(!container.querySelector('.modalv3-dialog')){\n    container.innerHTML = `\n      <div class=\"modalv3-backdrop\"></div>\n      <div class=\"modalv3-dialog\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"modalv3-scroll\" data-modalv3-scroll></div>\n      </div>\n    `;\n  }\n\n  dialogEl = container.querySelector('.modalv3-dialog');\n  if(dialogEl && !dialogEl.hasAttribute('tabindex')) dialogEl.setAttribute('tabindex', '-1');\n  scrollContainer = container.querySelector('[data-modalv3-scroll]');\n  backdropEl = container.querySelector('.modalv3-backdrop');\n\n  if(scrollContainer){\n    rootEl = scrollContainer.querySelector('[data-modalv3-root]');\n    if(!rootEl){\n      rootEl = document.createElement('div');\n      rootEl.dataset.modalv3Root = '1';\n      rootEl.className = 'modalv3';\n      rootEl.setAttribute('hidden', '');\n      scrollContainer.appendChild(rootEl);\n    }\n  }\n\n  return overlayContainer;\n}\n\nfunction ensureShell(){\n  const container = ensureContainer();\n  if(!container || !dialogEl || !rootEl) return null;\n  return { overlay: container, dialog: dialogEl, scroll: scrollContainer, backdrop: backdropEl, root: rootEl };\n}\n\nexport function openShell({ onRequestClose } = {}){\n  const shell = ensureShell();\n  if(!shell) return null;\n  const { overlay, scroll, dialog } = shell;\n  overlay.hidden = false;\n  overlay.setAttribute('aria-hidden', 'false');\n  if(typeof document !== 'undefined' && document.body){\n    document.body.classList.add('modalv3-open');\n  }\n  if(scroll) scroll.scrollTop = 0;\n  bindFocusTrap(dialog);\n  bindEscape(onRequestClose);\n  return shell;\n}\n\nexport function closeShell(){\n  if(!overlayContainer) return;\n  overlayContainer.hidden = true;\n  overlayContainer.setAttribute('aria-hidden', 'true');\n  if(typeof document !== 'undefined' && document.body){\n    document.body.classList.remove('modalv3-open');\n  }\n  unbindFocusTrap();\n  unbindEscape();\n  if(rootEl){\n    rootEl.innerHTML = '';\n    rootEl.setAttribute('hidden', '');\n  }\n  if(scrollContainer) scrollContainer.scrollTop = 0;\n}\n\nexport function getShell(){\n  return ensureShell();\n}\n\nexport function focusInitial(){\n  if(!dialogEl) return;\n  focusDialog(dialogEl);\n}\n\nexport function getRoot(){\n  const shell = ensureShell();\n  return shell ? shell.root : null;\n}\n\nexport function getOverlay(){\n  const shell = ensureShell();\n  return shell ? shell.overlay : null;\n}\n\nexport function getBackdrop(){\n  const shell = ensureShell();\n  return shell ? shell.backdrop : null;\n}\n\nexport function getDialog(){\n  const shell = ensureShell();\n  return shell ? shell.dialog : null;\n}\n\nexport function clearContent(){\n  if(rootEl){\n    rootEl.innerHTML = '';\n  }\n}\n\nexport function getFocusable(){\n  if(!dialogEl) return [];\n  return getFocusableElements(dialogEl);\n}\n", "const state = {\n  renderSequence: 0,\n  activeRenderToken: 0,\n  activeKind: null,\n  activeItem: null,\n  lastFocused: null,\n};\n\nexport function startRender(kind = null, item = null){\n  state.renderSequence += 1;\n  state.activeRenderToken = state.renderSequence;\n  state.activeKind = kind || null;\n  state.activeItem = item || null;\n  return state.activeRenderToken;\n}\n\nexport function isCurrentRender(token){\n  if(!token) return false;\n  return token === state.activeRenderToken;\n}\n\nexport function getRenderToken(){\n  return state.activeRenderToken;\n}\n\nexport function cancelRender(){\n  state.renderSequence += 1;\n  state.activeRenderToken = 0;\n  return state.renderSequence;\n}\n\nexport function setActiveItem(kind = null, item = null){\n  state.activeKind = kind || null;\n  state.activeItem = item || null;\n}\n\nexport function getActiveItem(){\n  return { kind: state.activeKind, item: state.activeItem };\n}\n\nexport function clearActiveItem(){\n  state.activeKind = null;\n  state.activeItem = null;\n}\n\nexport function captureLastFocused(){\n  if(typeof document === 'undefined'){\n    state.lastFocused = null;\n    return null;\n  }\n  const active = document.activeElement;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  state.lastFocused = elementCtor && active instanceof elementCtor ? active : null;\n  return state.lastFocused;\n}\n\nexport function restoreLastFocused(){\n  const target = state.lastFocused;\n  state.lastFocused = null;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(target && (!elementCtor || target instanceof elementCtor) && typeof target.focus === 'function'){\n    try{ target.focus(); }\n    catch(err){ console.warn('[modalV3] Failed to restore focus to last active element:', err?.message || err); }\n  }\n}\n\nexport function getLastFocused(){\n  return state.lastFocused;\n}\n\nexport function resetState(){\n  state.activeKind = null;\n  state.activeItem = null;\n  state.activeRenderToken = 0;\n  state.lastFocused = null;\n}\n\nexport function getState(){\n  return { ...state };\n}\n", "import { formatRating } from '../utils.js';\n\n/**\n * Build a human readable runtime string for movies and shows.\n * @param {object} item\n * @returns {string}\n */\nexport function runtimeText(item){\n  const sources = [\n    item?.runtimeMin,\n    item?.durationMin,\n    item?.tmdbDetail?.runtime,\n    item?.duration ? Math.round(Number(item.duration) / 60000) : null,\n  ];\n\n  let minutes = null;\n  for(const value of sources){\n    const parsed = Number(value);\n    if(Number.isFinite(parsed) && parsed > 0){\n      minutes = parsed;\n      break;\n    }\n  }\n\n  if(minutes === null) return '';\n  if(item?.type === 'tv'){ return `~${minutes} min/Ep`; }\n  return `${minutes} min`;\n}\n\n/**\n * Format rating text with a leading star.\n * @param {object} item\n * @returns {string}\n */\nexport function ratingText(item){\n  const rating = Number(item?.rating ?? item?.audienceRating);\n  if(!Number.isFinite(rating)) return '';\n  return `\u2605 ${formatRating(rating)}`;\n}\n\n/**\n * Resolve the studio/network label.\n * @param {object} item\n * @returns {string}\n */\nexport function studioText(item){\n  if(item?.studio) return item.studio;\n  if(item?.network) return item.network;\n  if(item?.studioName) return item.studioName;\n  if(item?.tmdbDetail?.productionCompanies){\n    const first = item.tmdbDetail.productionCompanies.find(company => company?.name);\n    if(first && first.name) return first.name;\n  }\n  if(item?.tmdbDetail?.networks){\n    const net = item.tmdbDetail.networks.find(entry => entry?.name);\n    if(net && net.name) return net.name;\n  }\n  return '';\n}\n", "import { formatRating } from '../utils.js';\nimport { runtimeText, ratingText, studioText } from './formatting.js';\n\nfunction sanitizeUrl(url){\n  if(!url) return '';\n  const str = String(url).trim();\n  if(!str) return '';\n  if(/^https?:\\/\\//i.test(str) || /^data:image\\//i.test(str)) return str;\n  if(str.startsWith('//')) return `https:${str}`;\n  if(str.startsWith('data/')) return str;\n  return str.replace(/[\"'()]/g, '');\n}\n\nfunction logoEntryToUrl(entry){\n  if(!entry) return '';\n  if(typeof entry === 'string') return entry;\n  return (\n    entry.url ||\n    entry.file_path ||\n    entry.filePath ||\n    entry.path ||\n    entry.logo ||\n    entry.logoPath ||\n    entry.poster ||\n    entry.backdrop ||\n    ''\n  );\n}\n\nfunction logoEntryLanguage(entry){\n  if(!entry || typeof entry !== 'object') return '';\n  const lang = entry.iso6391 || entry.iso_639_1 || entry.language || '';\n  return typeof lang === 'string' ? lang.toLowerCase() : '';\n}\n\nfunction resolveBaseItem(viewModel){\n  if(!viewModel) return null;\n  const item = viewModel.item || {};\n  const tmdbDetail = viewModel.tmdb || item.tmdbDetail || null;\n  const type = viewModel.kind === 'show' ? 'tv' : item.type;\n  return { ...item, tmdbDetail, type };\n}\n\nfunction deriveMeta(viewModel){\n  const baseItem = resolveBaseItem(viewModel);\n  const runtime = viewModel?.meta?.runtime || (baseItem ? runtimeText(baseItem) : '');\n  const rating = viewModel?.meta?.rating || (baseItem ? ratingText(baseItem) : '');\n  const tmdbRating = viewModel?.meta?.tmdbRating || '';\n  const studio = viewModel?.meta?.studio || (baseItem ? studioText(baseItem) : '');\n  const contentRating = viewModel?.meta?.contentRating || '';\n  const seasonCount = viewModel?.meta?.seasonCount ?? null;\n  return { runtime, rating, tmdbRating, studio, contentRating, seasonCount };\n}\n\nfunction resolveDetail(viewModel){\n  if(!viewModel) return null;\n  return viewModel.tmdb || viewModel.item?.tmdbDetail || viewModel.item?.tmdb || null;\n}\n\nfunction pickHeroLogo(viewModel){\n  const detail = resolveDetail(viewModel);\n  const logos = Array.isArray(detail?.images?.logos) ? detail.images.logos : [];\n  if(!logos.length) return '';\n  const preferences = ['de', 'en', ''];\n  for(const pref of preferences){\n    const match = logos.find(entry => {\n      const lang = logoEntryLanguage(entry);\n      if(pref){ return lang === pref; }\n      return !lang;\n    });\n    const url = sanitizeUrl(logoEntryToUrl(match));\n    if(url) return url;\n  }\n  for(const entry of logos){\n    const url = sanitizeUrl(logoEntryToUrl(entry));\n    if(url) return url;\n  }\n  return '';\n}\n\nfunction pickLogo(viewModel, excludeUrl=''){\n  const detail = resolveDetail(viewModel);\n  const candidates = [];\n  const seen = new Set();\n  const exclude = sanitizeUrl(excludeUrl);\n  if(exclude) seen.add(exclude);\n  const push = value => {\n    const url = sanitizeUrl(logoEntryToUrl(value));\n    if(!url || seen.has(url)) return;\n    seen.add(url);\n    candidates.push(url);\n  };\n  if(Array.isArray(detail?.images?.logos)) detail.images.logos.forEach(push);\n  if(Array.isArray(detail?.networks)) detail.networks.forEach(push);\n  if(Array.isArray(detail?.productionCompanies)) detail.productionCompanies.forEach(push);\n  if(detail?.collection) push(detail.collection);\n  const itemLogos = viewModel?.item?.tmdbDetail?.images?.logos;\n  if(Array.isArray(itemLogos)) itemLogos.forEach(push);\n  return candidates[0] || '';\n}\n\nfunction ratingBucket(value){\n  if(!Number.isFinite(value)) return '';\n  if(value >= 7.5) return 'high';\n  if(value >= 5.5) return 'medium';\n  if(value > 0) return 'low';\n  return '';\n}\n\nfunction pickHeroRating(viewModel){\n  if(!viewModel) return null;\n  const tmdb = viewModel.tmdb || viewModel.item?.tmdbDetail || null;\n  const tmdbVote = Number(tmdb?.voteAverage ?? tmdb?.vote_average);\n  if(Number.isFinite(tmdbVote) && tmdbVote > 0){\n    return {\n      label: 'TMDB',\n      text: formatRating(tmdbVote),\n      value: tmdbVote,\n      bucket: ratingBucket(tmdbVote),\n    };\n  }\n  const fallback = Number(\n    viewModel.item?.rating ??\n    viewModel.item?.audienceRating ??\n    viewModel.item?.userRating ??\n    viewModel.item?.ratingKey\n  );\n  if(Number.isFinite(fallback) && fallback > 0){\n    return {\n      label: 'Bewertung',\n      text: formatRating(fallback),\n      value: fallback,\n      bucket: ratingBucket(fallback),\n    };\n  }\n  return null;\n}\n\nfunction clearElement(element){\n  if(!element) return;\n  element.replaceChildren();\n}\n\nfunction ensureElement(tag, className){\n  if(typeof document === 'undefined') return null;\n  const el = document.createElement(tag);\n  if(className) el.className = className;\n  return el;\n}\n\nfunction createHeadStructure(){\n  const root = ensureElement('header', 'v3-head');\n  if(!root) return null;\n\n  const actions = ensureElement('div', 'v3-head__actions');\n  const closeButton = ensureElement('button', 'v3-head__close');\n  if(actions && closeButton){\n    closeButton.id = 'action-close';\n    closeButton.type = 'button';\n    closeButton.setAttribute('aria-label', 'Schlie\u00DFen');\n    const icon = ensureElement('span', 'v3-head__close-icon');\n    if(icon){\n      icon.setAttribute('aria-hidden', 'true');\n      icon.textContent = '\u00D7';\n      closeButton.append(icon);\n    }\n    closeButton.hidden = false;\n    closeButton.removeAttribute('hidden');\n    actions.append(closeButton);\n  }\n\n  const visual = ensureElement('div', 'v3-head__visual');\n  visual.dataset.v3HeadVisual = '1';\n  const hero = ensureElement('div', 'v3-head__hero');\n  hero.dataset.v3HeadHero = '1';\n  const backdrop = ensureElement('div', 'v3-head__backdrop');\n  backdrop.dataset.v3HeadBackdrop = '1';\n  const overlayLogo = ensureElement('div', 'v3-head__overlay-logo');\n  overlayLogo.dataset.v3HeadOverlayLogo = '1';\n  overlayLogo.hidden = true;\n  const overlayMeta = ensureElement('div', 'v3-head__overlay-meta');\n  overlayMeta.dataset.v3HeadOverlayMeta = '1';\n  overlayMeta.hidden = true;\n  hero.append(backdrop, overlayLogo, overlayMeta);\n  const logoSlot = ensureElement('div', 'v3-head__logo');\n  logoSlot.dataset.v3HeadLogo = '1';\n  logoSlot.hidden = true;\n  visual.append(hero, logoSlot);\n\n  const status = ensureElement('p', 'v3-head__status');\n  status.dataset.v3HeadStatus = '1';\n  status.hidden = true;\n  status.setAttribute('aria-live', 'polite');\n  status.setAttribute('aria-atomic', 'true');\n\n  const titlebar = ensureElement('div', 'v3-head__titlebar');\n  const titlewrap = ensureElement('div', 'v3-head__titlewrap');\n  const badges = ensureElement('div', 'v3-badges');\n  badges.dataset.v3HeadBadges = '1';\n  badges.hidden = true;\n  const title = ensureElement('h1', 'v3-title');\n  title.dataset.v3HeadTitle = '1';\n  const subtitle = ensureElement('p', 'v3-subtitle');\n  subtitle.dataset.v3HeadSubtitle = '1';\n  subtitle.hidden = true;\n  const meta = ensureElement('p', 'v3-submeta');\n  meta.dataset.v3HeadMeta = '1';\n  meta.hidden = true;\n  titlewrap.append(badges, title, subtitle, meta);\n  titlebar.append(titlewrap);\n\n  if(actions && actions.childElementCount) root.append(actions);\n  root.append(visual, status, titlebar);\n  return root;\n}\n\nfunction createPosterStructure(){\n  const root = ensureElement('div', 'v3-poster-card');\n  if(!root) return null;\n  const media = ensureElement('div', 'v3-poster-media');\n  media.dataset.v3PosterMedia = '1';\n  media.dataset.state = 'empty';\n  const skeleton = ensureElement('div', 'v3-poster-skeleton');\n  skeleton.dataset.v3PosterSkeleton = '1';\n  skeleton.setAttribute('aria-hidden', 'true');\n  const img = ensureElement('img', '');\n  img.dataset.v3PosterImage = '1';\n  img.alt = '';\n  img.loading = 'lazy';\n  img.decoding = 'async';\n  img.referrerPolicy = 'no-referrer';\n  media.append(skeleton, img);\n\n  const quickfacts = ensureElement('section', 'v3-quickfacts');\n  quickfacts.dataset.v3Quickfacts = '1';\n  quickfacts.hidden = true;\n  quickfacts.setAttribute('aria-label', 'Schnellinfos');\n  const qTitle = ensureElement('h3', 'v3-quickfacts-title');\n  qTitle.textContent = 'Schnellinfos';\n  const qList = ensureElement('dl', 'v3-quickfacts-list');\n  qList.dataset.v3QuickfactsList = '1';\n  quickfacts.append(qTitle, qList);\n\n  root.append(media, quickfacts);\n  return root;\n}\n\nfunction createHeadRefs(root){\n  if(!root) return null;\n  return {\n    root,\n    elements: {\n      heroBackdrop: root.querySelector('[data-v3-head-backdrop]'),\n      overlayLogo: root.querySelector('[data-v3-head-overlay-logo]'),\n      overlayMeta: root.querySelector('[data-v3-head-overlay-meta]'),\n      logo: root.querySelector('[data-v3-head-logo]'),\n      status: root.querySelector('[data-v3-head-status]'),\n      badges: root.querySelector('[data-v3-head-badges]'),\n      title: root.querySelector('[data-v3-head-title]'),\n      subtitle: root.querySelector('[data-v3-head-subtitle]'),\n      meta: root.querySelector('[data-v3-head-meta]'),\n      close: root.querySelector('#action-close'),\n    },\n  };\n}\n\nfunction createPosterRefs(root){\n  if(!root) return null;\n  const media = root.querySelector('[data-v3-poster-media]');\n  const quickfactsRoot = root.querySelector('[data-v3-quickfacts]');\n  return {\n    root,\n    media,\n    img: media?.querySelector('[data-v3-poster-image]') || media?.querySelector('img'),\n    skeleton: media?.querySelector('[data-v3-poster-skeleton]') || null,\n    quickfactsRoot,\n    quickfactsList: quickfactsRoot?.querySelector('[data-v3-quickfacts-list]') || quickfactsRoot?.querySelector('dl'),\n  };\n}\n\nfunction coerceHeadTarget(target){\n  if(!target) return null;\n  if(target.root && target.elements) return target;\n  if(target.root){\n    const refs = createHeadRefs(target.root);\n    return refs ? { ...refs } : null;\n  }\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(elementCtor && target instanceof elementCtor){\n    return createHeadRefs(target);\n  }\n  return null;\n}\n\nfunction coercePosterTarget(target){\n  if(!target) return null;\n  if(target.root && target.media) return target;\n  if(target.root){\n    const refs = createPosterRefs(target.root);\n    return refs ? { ...refs } : null;\n  }\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(elementCtor && target instanceof elementCtor){\n    return createPosterRefs(target);\n  }\n  return null;\n}\n\nfunction resetBackdrop(backdrop){\n  if(!backdrop) return;\n  backdrop.style.backgroundImage = '';\n  if(backdrop.dataset){\n    backdrop.dataset.state = '';\n    backdrop.dataset.src = '';\n    backdrop.dataset.source = '';\n  }\n}\n\nfunction applyBackdrop(backdrop, viewModel){\n  if(!backdrop) return;\n  const source = viewModel?.backdrop?.source || '';\n  const rawUrl = viewModel?.backdrop?.url || viewModel?.item?.art || viewModel?.item?.background || '';\n  const sanitized = sanitizeUrl(rawUrl);\n  if(backdrop.dataset) backdrop.dataset.source = source || '';\n  if(!sanitized){\n    resetBackdrop(backdrop);\n    return;\n  }\n  if(typeof Image === 'undefined'){\n    backdrop.style.backgroundImage = `url(\"${sanitized}\")`;\n    if(backdrop.dataset){\n      backdrop.dataset.state = 'ready';\n      backdrop.dataset.src = sanitized;\n    }\n    return;\n  }\n  if(backdrop.dataset?.src === sanitized && backdrop.dataset?.state === 'ready'){\n    return;\n  }\n  if(backdrop.dataset){\n    backdrop.dataset.state = 'loading';\n    backdrop.dataset.src = sanitized;\n  }\n  backdrop.style.backgroundImage = '';\n  const img = new Image();\n  img.decoding = 'async';\n  img.referrerPolicy = 'no-referrer';\n  img.addEventListener('load', () => {\n    if(backdrop.dataset?.src !== sanitized) return;\n    backdrop.style.backgroundImage = `url(\"${sanitized}\")`;\n    if(backdrop.dataset) backdrop.dataset.state = 'ready';\n  }, { once: true });\n  img.addEventListener('error', () => {\n    if(backdrop.dataset?.src !== sanitized) return;\n    resetBackdrop(backdrop);\n  }, { once: true });\n  img.src = sanitized;\n}\n\nfunction applyHeroLogo(slot, viewModel, onError){\n  if(!slot) return '';\n  const logoUrl = sanitizeUrl(pickHeroLogo(viewModel));\n  slot.dataset.src = '';\n  if(!logoUrl){\n    slot.hidden = true;\n    slot.dataset.state = '';\n    clearElement(slot);\n    return '';\n  }\n  const img = ensureElement('img', 'v3-head__overlay-image');\n  img.alt = viewModel?.title ? `Hero Logo: ${viewModel.title}` : 'Hero Logo';\n  img.decoding = 'async';\n  img.loading = 'lazy';\n  img.referrerPolicy = 'no-referrer';\n  clearElement(slot);\n  slot.appendChild(img);\n  slot.dataset.src = logoUrl;\n  if(typeof Image === 'undefined'){\n    img.src = logoUrl;\n    slot.hidden = false;\n    slot.dataset.state = 'ready';\n    return logoUrl;\n  }\n  slot.hidden = true;\n  slot.dataset.state = 'loading';\n  img.addEventListener('load', () => {\n    if(slot.dataset?.src !== logoUrl) return;\n    slot.hidden = false;\n    slot.dataset.state = 'ready';\n  }, { once: true });\n  img.addEventListener('error', () => {\n    if(slot.dataset?.src !== logoUrl) return;\n    slot.hidden = true;\n    slot.dataset.state = '';\n    slot.dataset.src = '';\n    clearElement(slot);\n    if(typeof onError === 'function') onError();\n  }, { once: true });\n  img.src = logoUrl;\n  return logoUrl;\n}\n\nfunction applyLogo(slot, viewModel, excludeUrl=''){\n  if(!slot) return;\n  const logoUrl = sanitizeUrl(pickLogo(viewModel, excludeUrl));\n  if(!logoUrl){\n    slot.hidden = true;\n    clearElement(slot);\n    return;\n  }\n  let img = slot.querySelector('img');\n  if(!img){\n    img = ensureElement('img', 'v3-head__logo-image');\n    slot.replaceChildren(img);\n  }\n  img.alt = viewModel?.title ? `Logo: ${viewModel.title}` : 'Logo';\n  img.decoding = 'async';\n  img.loading = 'lazy';\n  img.referrerPolicy = 'no-referrer';\n  img.src = logoUrl;\n  slot.hidden = false;\n}\n\nfunction applyHeroMeta(slot, viewModel){\n  if(!slot) return;\n  clearElement(slot);\n  const ratingInfo = pickHeroRating(viewModel);\n  if(!ratingInfo){\n    slot.hidden = true;\n    slot.dataset.state = '';\n    return;\n  }\n  const chip = ensureElement('span', 'v3-head__rating-chip');\n  if(ratingInfo.bucket) chip.dataset.score = ratingInfo.bucket;\n  const label = ensureElement('span', 'v3-head__rating-label');\n  label.textContent = ratingInfo.label;\n  const value = ensureElement('strong', 'v3-head__rating-value');\n  value.textContent = ratingInfo.text;\n  chip.append(label, value);\n  chip.setAttribute('aria-label', `${ratingInfo.label} Bewertung ${ratingInfo.text} von 10`);\n  slot.appendChild(chip);\n  slot.hidden = false;\n  slot.dataset.state = 'ready';\n}\n\nfunction renderTitleSection(target, viewModel){\n  const head = coerceHeadTarget(target);\n  if(!head) return;\n  const { title, subtitle, meta } = head.elements;\n  const derivedMeta = deriveMeta(viewModel);\n  if(title) title.textContent = viewModel?.title || '';\n  const tagline = viewModel?.tagline || '';\n  const metaParts = [];\n  if(viewModel?.year) metaParts.push(viewModel.year);\n  if(derivedMeta.runtime) metaParts.push(derivedMeta.runtime);\n  const rating = derivedMeta.rating || derivedMeta.tmdbRating;\n  if(rating) metaParts.push(rating);\n  const studio = derivedMeta.studio;\n  if(studio) metaParts.push(studio);\n  const fallback = metaParts.join(' \u2022 ');\n  if(subtitle){\n    const text = tagline || fallback;\n    subtitle.textContent = text;\n    subtitle.hidden = !text;\n  }\n  if(meta){\n    const metaText = tagline && fallback ? fallback : '';\n    meta.textContent = metaText;\n    meta.hidden = !metaText;\n  }\n}\n\nfunction renderBadgesSection(target, badges){\n  const head = coerceHeadTarget(target);\n  if(!head) return;\n  const container = head.elements.badges;\n  if(!container) return;\n  clearElement(container);\n  const entries = Array.isArray(badges) ? badges.filter(Boolean) : [];\n  entries.forEach(entry => {\n    const badge = ensureElement('span', 'v3-badge');\n    badge.dataset.source = entry.source || '';\n    const label = ensureElement('span', 'v3-badge__label');\n    label.textContent = entry.label || '';\n    const value = ensureElement('strong', 'v3-badge__value');\n    value.textContent = entry.text || '';\n    badge.append(label, value);\n    badge.setAttribute('aria-label', `${entry.label || 'Badge'}: ${entry.text || ''}`);\n    container.appendChild(badge);\n  });\n  container.hidden = !container.childElementCount;\n}\n\nfunction renderHeroSection(target, viewModel){\n  const head = coerceHeadTarget(target);\n  if(!head) return;\n  const { heroBackdrop, overlayLogo, overlayMeta, logo } = head.elements;\n  applyBackdrop(heroBackdrop, viewModel);\n  const heroLogo = applyHeroLogo(overlayLogo, viewModel, () => applyLogo(logo, viewModel, ''));\n  applyHeroMeta(overlayMeta, viewModel);\n  applyLogo(logo, viewModel, heroLogo);\n}\n\nfunction setPosterState(target, state){\n  if(!target) return;\n  if(target.dataset) target.dataset.state = state || '';\n}\n\nfunction renderPoster(target, viewModel){\n  const poster = coercePosterTarget(target);\n  if(!poster || !poster.media) return;\n  const { media } = poster;\n  const source = viewModel?.poster?.source || '';\n  if(media.dataset) media.dataset.source = source || '';\n  const url = sanitizeUrl(viewModel?.poster?.url);\n  const currentUrl = url || '';\n  const title = viewModel?.title || viewModel?.item?.title || '';\n  const altText = viewModel?.poster?.alt || (title ? `Poster: ${title}` : 'Poster');\n  const newImg = ensureElement('img', '');\n  newImg.dataset.v3PosterImage = '1';\n  newImg.dataset.posterUrl = currentUrl;\n  newImg.alt = altText;\n  newImg.loading = 'lazy';\n  newImg.decoding = 'async';\n  newImg.referrerPolicy = 'no-referrer';\n  newImg.className = poster.img?.className || '';\n  newImg.classList.remove('is-ready');\n  media.querySelectorAll('[data-v3-poster-image]').forEach(node => {\n    if(node !== newImg) node.remove();\n  });\n  const skeleton = poster.skeleton;\n  if(media.dataset) media.dataset.posterUrl = currentUrl;\n  if(url){\n    setPosterState(media, 'loading');\n    newImg.addEventListener('load', () => {\n      if(media.dataset?.posterUrl !== currentUrl || newImg.dataset.posterUrl !== currentUrl) return;\n      newImg.classList.add('is-ready');\n      setPosterState(media, 'ready');\n    }, { once: true });\n    newImg.addEventListener('error', () => {\n      if(media.dataset?.posterUrl !== currentUrl || newImg.dataset.posterUrl !== currentUrl) return;\n      newImg.classList.add('is-ready');\n      setPosterState(media, 'error');\n    }, { once: true });\n    newImg.src = url;\n  }else{\n    newImg.classList.add('is-ready');\n    setPosterState(media, 'empty');\n  }\n  if(skeleton && !media.contains(skeleton)) media.prepend(skeleton);\n  media.appendChild(newImg);\n  poster.img = newImg;\n}\n\nfunction formatSeasonCount(value){\n  if(!Number.isFinite(Number(value))) return '';\n  const num = Number(value);\n  if(num <= 0) return '';\n  return num === 1 ? '1 Staffel' : `${num} Staffeln`;\n}\n\nfunction renderQuickfactsSection(target, viewModel){\n  const poster = coercePosterTarget(target);\n  if(!poster) return;\n  const { quickfactsRoot, quickfactsList } = poster;\n  if(!quickfactsRoot || !quickfactsList) return;\n  clearElement(quickfactsList);\n  const derivedMeta = deriveMeta(viewModel);\n  const entries = [];\n  if(viewModel?.year) entries.push(['Jahr', viewModel.year]);\n  if(viewModel?.releaseDate) entries.push(['Ver\u00F6ffentlichung', viewModel.releaseDate]);\n  if(derivedMeta.contentRating) entries.push(['Freigabe', derivedMeta.contentRating]);\n  if(derivedMeta.runtime) entries.push(['Laufzeit', derivedMeta.runtime]);\n  if(derivedMeta.rating) entries.push(['Bewertung', derivedMeta.rating]);\n  if(derivedMeta.tmdbRating) entries.push(['TMDB', derivedMeta.tmdbRating]);\n  if(derivedMeta.studio) entries.push([viewModel?.kind === 'show' ? 'Netzwerk' : 'Studio', derivedMeta.studio]);\n  const seasonCount = formatSeasonCount(derivedMeta.seasonCount);\n  if(seasonCount) entries.push(['Staffeln', seasonCount]);\n  const originalTitle = viewModel?.originalTitle;\n  if(originalTitle && originalTitle !== viewModel?.title){\n    entries.push(['Original', originalTitle]);\n  }\n  if(Array.isArray(viewModel?.genres) && viewModel.genres.length){\n    entries.push(['Genres', viewModel.genres.join(', ')]);\n  }\n  entries.forEach(([label, value]) => {\n    const dt = ensureElement('dt', '');\n    dt.textContent = label;\n    const dd = ensureElement('dd', '');\n    dd.textContent = value;\n    quickfactsList.append(dt, dd);\n  });\n  const hasEntries = entries.length > 0;\n  quickfactsRoot.hidden = !hasEntries;\n  quickfactsRoot.setAttribute('aria-hidden', hasEntries ? 'false' : 'true');\n}\n\nexport function createHead(viewModel = null){\n  const root = createHeadStructure();\n  if(!root) return null;\n  const refs = createHeadRefs(root);\n  if(viewModel) renderHead(refs, viewModel);\n  return refs;\n}\n\nexport function createPosterCard(viewModel = null){\n  const root = createPosterStructure();\n  if(!root) return null;\n  const refs = createPosterRefs(root);\n  if(viewModel){\n    renderPoster(refs, viewModel);\n    renderQuickfacts(refs, viewModel);\n  }\n  return refs;\n}\n\nexport function renderHead(target, viewModel){\n  const head = coerceHeadTarget(target);\n  if(!head) return null;\n  renderHeroSection(head, viewModel);\n  renderTitleSection(head, viewModel);\n  renderBadgesSection(head, viewModel?.badges || []);\n  setHeadStatus(head, null);\n  return head;\n}\n\nexport function renderPosterCard(target, viewModel){\n  renderPoster(target, viewModel);\n  renderQuickfactsSection(target, viewModel);\n}\n\nexport function renderBackdropHero(target, viewModel){\n  renderHeroSection(target, viewModel);\n}\n\nexport function renderTitle(target, viewModel){\n  renderTitleSection(target, viewModel);\n}\n\nexport function renderBadges(target, badges){\n  renderBadgesSection(target, badges);\n}\n\nexport function renderQuickfacts(target, viewModel){\n  renderQuickfactsSection(target, viewModel);\n}\n\nexport function setHeadStatus(target, payload){\n  const head = coerceHeadTarget(target);\n  const statusEl = head?.elements?.status;\n  if(!statusEl) return;\n  if(!payload){\n    statusEl.hidden = true;\n    statusEl.textContent = '';\n    if(statusEl.dataset) statusEl.dataset.state = '';\n    statusEl.setAttribute('aria-hidden', 'true');\n    return;\n  }\n  const message = payload.message ? String(payload.message).trim() : '';\n  const state = payload.state ? String(payload.state).trim() : '';\n  statusEl.textContent = message;\n  if(statusEl.dataset) statusEl.dataset.state = state;\n  const hasMessage = Boolean(message);\n  statusEl.hidden = !hasMessage;\n  statusEl.setAttribute('aria-hidden', hasMessage ? 'false' : 'true');\n}\n\nexport function getHeadRoot(target){\n  const head = coerceHeadTarget(target);\n  return head?.root || null;\n}\n\nexport function getPosterRoot(target){\n  const poster = coercePosterTarget(target);\n  return poster?.root || null;\n}\n\n", "import { getState } from '../state.js';\n\nlet paragraphIdCounter = 0;\n\nfunction nextParagraphId(){\n  paragraphIdCounter += 1;\n  return `modalv3-overview-${paragraphIdCounter}`;\n}\n\nfunction ensureContainer(target){\n  if(!target) return null;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(target instanceof elementCtor) return target;\n  if(elementCtor && target.content instanceof elementCtor) return target.content;\n  if(elementCtor && target.root instanceof elementCtor) return target.root;\n  return null;\n}\n\nfunction sanitizeText(value){\n  if(value == null) return '';\n  const str = String(value);\n  return str.trim();\n}\n\nfunction getPreferredLanguage(){\n  const state = typeof getState === 'function' ? getState() : null;\n  const lang = state?.cfg?.lang || state?.cfg?.iso || state?.cfg?.locale;\n  return typeof lang === 'string' && lang.trim() ? lang.trim() : 'de-DE';\n}\n\nfunction resolveOriginalLanguage(viewModel){\n  const tmdb = viewModel?.tmdb || viewModel?.item?.tmdbDetail || viewModel?.item?.tmdb || null;\n  const candidates = [\n    tmdb?.originalLanguage,\n    tmdb?.original_language,\n    viewModel?.item?.originalLanguage,\n    viewModel?.item?.original_language,\n    tmdb?.languages?.[0],\n  ];\n  for(const entry of candidates){\n    if(!entry) continue;\n    const str = sanitizeText(entry).toLowerCase();\n    if(str) return str;\n  }\n  return '';\n}\n\nfunction determineLanguageBadge(viewModel){\n  const original = resolveOriginalLanguage(viewModel);\n  if(!original) return '';\n  const preferred = getPreferredLanguage().toLowerCase();\n  if(original === 'en' && preferred && !preferred.startsWith('en')){\n    return 'EN';\n  }\n  return '';\n}\n\nfunction createFallback(){\n  const paragraph = document.createElement('p');\n  paragraph.textContent = 'Keine Inhaltsangabe verf\u00FCgbar.';\n  paragraph.className = 'v3-overview__fallback';\n  return paragraph;\n}\n\nfunction buildOverviewElements(container, viewModel){\n  const text = sanitizeText(viewModel?.overview) || sanitizeText(viewModel?.summary);\n  const elements = { items: [] };\n  const languageBadge = determineLanguageBadge(viewModel);\n\n  if(languageBadge){\n    const badge = document.createElement('span');\n    badge.className = 'v3-chip';\n    badge.dataset.badge = 'language';\n    badge.textContent = languageBadge;\n    badge.setAttribute('aria-label', `Sprache: ${languageBadge}`);\n    elements.items.push(badge);\n  }\n\n  if(!text){\n    elements.items.push(createFallback());\n    return elements;\n  }\n\n  const paragraphId = nextParagraphId();\n  const paragraph = document.createElement('p');\n  paragraph.className = 'v3-overview__text line-clamp line-clamp-5';\n  paragraph.id = paragraphId;\n  paragraph.textContent = text;\n\n  const toggle = document.createElement('button');\n  toggle.type = 'button';\n  toggle.className = 'v3-overview__toggle';\n  toggle.setAttribute('aria-controls', paragraphId);\n  toggle.dataset.overviewToggle = '1';\n\n  elements.paragraph = paragraph;\n  elements.toggle = toggle;\n  elements.items.push(paragraph, toggle);\n\n  return elements;\n}\n\nfunction scheduleMeasure(fn){\n  if(typeof requestAnimationFrame === 'function'){\n    return requestAnimationFrame(fn);\n  }\n  return setTimeout(fn, 0);\n}\n\nfunction setExpanded(container, paragraph, toggle, expanded){\n  const isExpanded = Boolean(expanded);\n  paragraph.classList.toggle('is-expanded', isExpanded);\n  toggle.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');\n  toggle.textContent = isExpanded ? 'Weniger anzeigen' : 'Mehr anzeigen';\n  if(container?.dataset) container.dataset.overviewExpanded = isExpanded ? 'true' : 'false';\n}\n\nfunction measureOverflow(paragraph, toggle){\n  if(!paragraph || !toggle) return;\n  try{\n    const overflowing = paragraph.scrollHeight > paragraph.clientHeight + 1;\n    toggle.hidden = !overflowing;\n    if(!overflowing){\n      paragraph.classList.add('is-expanded');\n      toggle.setAttribute('aria-expanded', 'true');\n      const container = paragraph.parentElement;\n      if(container?.dataset) container.dataset.overviewExpanded = 'true';\n    }\n  }catch(err){\n    console.warn('[modalV3/overview] Failed to measure overview paragraph:', err?.message || err);\n  }\n}\n\nexport function renderOverview(target, viewModel){\n  if(typeof document === 'undefined') return;\n  const container = ensureContainer(target);\n  if(!container) return;\n  const previousExpanded = container.dataset?.overviewExpanded === 'true';\n  container.replaceChildren();\n\n  const elements = buildOverviewElements(container, viewModel || {});\n  elements.items.forEach(node => container.appendChild(node));\n\n  if(!elements.paragraph || !elements.toggle) return;\n\n  const { paragraph, toggle } = elements;\n  const stateToApply = previousExpanded && !toggle.hidden;\n  setExpanded(container, paragraph, toggle, stateToApply);\n\n  toggle.addEventListener('click', () => {\n    const expanded = toggle.getAttribute('aria-expanded') === 'true';\n    setExpanded(container, paragraph, toggle, !expanded);\n  });\n\n  scheduleMeasure(() => measureOverflow(paragraph, toggle));\n}\n\nexport default renderOverview;\n", "import { runtimeText, ratingText, studioText } from './formatting.js';\n\nfunction ensureContainer(target){\n  if(!target) return null;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(elementCtor && target instanceof elementCtor) return target;\n  if(elementCtor && target.content instanceof elementCtor) return target.content;\n  if(elementCtor && target.root instanceof elementCtor) return target.root;\n  return null;\n}\n\nfunction toArray(value){\n  if(Array.isArray(value)) return value;\n  if(value == null) return [];\n  return [value];\n}\n\nfunction cleanString(value){\n  if(value == null) return '';\n  const str = String(value);\n  return str.trim();\n}\n\nfunction resolveBaseItem(viewModel){\n  if(!viewModel) return null;\n  const item = viewModel.item || {};\n  const tmdbDetail = viewModel.tmdb || item.tmdbDetail || null;\n  const type = viewModel.kind === 'show' ? 'tv' : item.type;\n  return { ...item, tmdbDetail, type };\n}\n\nfunction deriveMeta(viewModel){\n  const baseItem = resolveBaseItem(viewModel);\n  return {\n    runtime: cleanString(viewModel?.meta?.runtime) || (baseItem ? runtimeText(baseItem) : ''),\n    rating: cleanString(viewModel?.meta?.rating) || (baseItem ? ratingText(baseItem) : ''),\n    tmdbRating: cleanString(viewModel?.meta?.tmdbRating),\n    studio: cleanString(viewModel?.meta?.studio) || (baseItem ? studioText(baseItem) : ''),\n    contentRating: cleanString(viewModel?.meta?.contentRating),\n    seasonCount: viewModel?.meta?.seasonCount ?? null,\n  };\n}\n\nfunction mergeUniqueStrings(...lists){\n  const result = [];\n  const seen = new Set();\n  lists.forEach(list => {\n    toArray(list).forEach(entry => {\n      const str = cleanString(entry);\n      if(!str) return;\n      const key = str.toLowerCase();\n      if(seen.has(key)) return;\n      seen.add(key);\n      result.push(str);\n    });\n  });\n  return result;\n}\n\nfunction namesFromList(source){\n  if(!source) return [];\n  return mergeUniqueStrings(toArray(source).map(entry => {\n    if(entry == null) return '';\n    if(typeof entry === 'string') return entry;\n    return entry?.name || entry?.title || entry?.tag || entry?.label || '';\n  }));\n}\n\nfunction crewByJob(detail, jobs){\n  const jobSet = new Set(toArray(jobs).map(job => cleanString(job).toLowerCase()).filter(Boolean));\n  if(!jobSet.size) return [];\n  const crew = toArray(detail?.credits?.crew);\n  const matches = crew.filter(member => {\n    if(!member) return false;\n    const job = cleanString(member.job).toLowerCase();\n    return job && jobSet.has(job);\n  }).map(member => member?.name || member?.original_name || member?.originalName || '');\n  return mergeUniqueStrings(matches);\n}\n\nfunction creatorsFromDetail(detail){\n  const createdBy = detail?.createdBy || detail?.created_by;\n  return namesFromList(createdBy);\n}\n\nfunction formatSeasonCount(value){\n  const num = Number(value);\n  if(!Number.isFinite(num) || num <= 0) return '';\n  return num === 1 ? '1 Staffel' : `${num} Staffeln`;\n}\n\nfunction gatherLanguages(viewModel){\n  const languages = [];\n  const seen = new Set();\n  const add = value => {\n    const str = cleanString(value);\n    if(!str) return;\n    const key = str.toLowerCase();\n    if(seen.has(key)) return;\n    seen.add(key);\n    languages.push(str);\n  };\n\n  const tmdb = viewModel?.tmdb || viewModel?.item?.tmdbDetail || null;\n  const spoken = tmdb?.spokenLanguages || tmdb?.spoken_languages;\n  toArray(spoken).forEach(entry => {\n    if(!entry) return;\n    add(entry?.name || entry?.englishName || entry?.iso_639_1 || entry);\n  });\n\n  toArray(viewModel?.item?.languages).forEach(add);\n  toArray(viewModel?.item?.audioLanguages).forEach(add);\n  toArray(viewModel?.item?.audio_language).forEach(add);\n  add(viewModel?.item?.language);\n\n  return languages;\n}\n\nfunction buildHighlightChips(viewModel){\n  const chips = [];\n  const meta = deriveMeta(viewModel);\n  const studio = meta.studio;\n  if(studio){\n    chips.push({ label: viewModel?.kind === 'show' ? 'Netzwerk' : 'Studio', value: studio, key: 'studio' });\n  }\n  const release = cleanString(viewModel?.releaseDate) || cleanString(viewModel?.year);\n  if(release) chips.push({ label: 'Ver\u00F6ffentlichung', value: release, key: 'release' });\n  const rating = meta.rating || meta.tmdbRating;\n  if(rating) chips.push({ label: 'Bewertung', value: rating, key: 'rating' });\n  if(!chips.length) return null;\n  const wrapper = document.createElement('div');\n  wrapper.className = 'v3-chip-group';\n  wrapper.dataset.v3DetailHighlights = '1';\n  chips.forEach(entry => {\n    const chip = document.createElement('span');\n    chip.className = 'v3-chip';\n    chip.dataset.detailKey = entry.key;\n    chip.textContent = `${entry.label}: ${entry.value}`;\n    chip.setAttribute('aria-label', `${entry.label}: ${entry.value}`);\n    wrapper.appendChild(chip);\n  });\n  return wrapper;\n}\n\nfunction buildDefinitionSection(title, entries){\n  if(!entries || !entries.length) return null;\n  const section = document.createElement('section');\n  section.dataset.v3DetailsSection = title.toLowerCase();\n  const heading = document.createElement('h3');\n  heading.textContent = title;\n  section.appendChild(heading);\n  const list = document.createElement('dl');\n  const nodeCtor = typeof Node !== 'undefined' ? Node : null;\n  entries.forEach(entry => {\n    const { term, value } = entry;\n    const dt = document.createElement('dt');\n    dt.textContent = term;\n    const dd = document.createElement('dd');\n    if(nodeCtor && value instanceof nodeCtor){\n      dd.appendChild(value);\n    }else{\n      dd.textContent = String(value ?? '');\n    }\n    list.append(dt, dd);\n  });\n  section.appendChild(list);\n  return section;\n}\n\nfunction gatherGeneralEntries(viewModel){\n  const entries = [];\n  const meta = deriveMeta(viewModel);\n  const release = cleanString(viewModel?.releaseDate) || cleanString(viewModel?.year);\n  if(release) entries.push({ term: 'Ver\u00F6ffentlichung', value: release });\n  if(meta.runtime) entries.push({ term: 'Laufzeit', value: meta.runtime });\n  if(meta.contentRating) entries.push({ term: 'Freigabe', value: meta.contentRating });\n  const seasonCount = formatSeasonCount(meta.seasonCount);\n  if(seasonCount) entries.push({ term: 'Staffeln', value: seasonCount });\n  const genres = Array.isArray(viewModel?.genres) ? viewModel.genres.filter(Boolean) : [];\n  if(genres.length) entries.push({ term: 'Genres', value: genres.join(', ') });\n  const original = cleanString(viewModel?.originalTitle);\n  if(original && original !== cleanString(viewModel?.title)){\n    entries.push({ term: 'Originaltitel', value: original });\n  }\n  return entries;\n}\n\nfunction gatherCreditEntries(viewModel){\n  const entries = [];\n  const item = viewModel?.item || {};\n  const detail = viewModel?.tmdb || item?.tmdbDetail || null;\n  const directors = mergeUniqueStrings(namesFromList(item?.directors), crewByJob(detail, ['Director']));\n  if(directors.length) entries.push({ term: 'Regie', value: directors.join(', ') });\n  const writers = mergeUniqueStrings(namesFromList(item?.writers), crewByJob(detail, ['Writer', 'Screenplay', 'Story']));\n  if(writers.length) entries.push({ term: 'Drehbuch', value: writers.join(', ') });\n  const producers = mergeUniqueStrings(namesFromList(item?.producers), crewByJob(detail, ['Producer', 'Executive Producer']));\n  if(producers.length) entries.push({ term: 'Produktion', value: producers.join(', ') });\n  if(viewModel?.kind === 'show'){\n    const creators = mergeUniqueStrings(namesFromList(item?.creators || item?.showrunners), creatorsFromDetail(detail));\n    if(creators.length) entries.push({ term: 'Creator', value: creators.join(', ') });\n  }\n  return entries;\n}\n\nfunction buildLink(href){\n  const link = document.createElement('a');\n  link.href = href;\n  link.target = '_blank';\n  link.rel = 'noopener noreferrer';\n  link.textContent = href;\n  return link;\n}\n\nfunction gatherMetadataEntries(viewModel){\n  const entries = [];\n  const tmdbUrl = cleanString(viewModel?.tmdbUrl);\n  if(tmdbUrl) entries.push({ term: 'TMDB', value: buildLink(tmdbUrl) });\n  const tmdbId = cleanString(viewModel?.tmdb?.id || viewModel?.item?.tmdbId || viewModel?.item?.ids?.tmdb);\n  if(tmdbId) entries.push({ term: 'TMDB-ID', value: tmdbId });\n  const imdbId = cleanString(viewModel?.item?.imdbId || viewModel?.item?.ids?.imdb || viewModel?.tmdb?.imdbId || viewModel?.tmdb?.externalIds?.imdbId);\n  if(imdbId) entries.push({ term: 'IMDb-ID', value: imdbId });\n  const ratingKey = cleanString(viewModel?.item?.ratingKey || viewModel?.item?.rating_key || viewModel?.item?.id);\n  if(ratingKey) entries.push({ term: 'Plex-ID', value: ratingKey });\n  const languages = gatherLanguages(viewModel);\n  if(languages.length) entries.push({ term: 'Sprachen', value: languages.join(', ') });\n  return entries;\n}\n\nexport function renderDetails(target, viewModel){\n  if(typeof document === 'undefined') return;\n  const container = ensureContainer(target);\n  if(!container) return;\n  container.replaceChildren();\n\n  const highlights = buildHighlightChips(viewModel || {});\n  if(highlights) container.appendChild(highlights);\n\n  const general = buildDefinitionSection('Allgemein', gatherGeneralEntries(viewModel || {}));\n  if(general) container.appendChild(general);\n\n  const credits = buildDefinitionSection('Credits', gatherCreditEntries(viewModel || {}));\n  if(credits) container.appendChild(credits);\n\n  const metadata = buildDefinitionSection('Metadaten', gatherMetadataEntries(viewModel || {}));\n  if(metadata) container.appendChild(metadata);\n\n  if(!container.childElementCount){\n    const fallback = document.createElement('p');\n    fallback.textContent = 'Keine Details verf\u00FCgbar.';\n    container.appendChild(fallback);\n  }\n}\n\nexport default renderDetails;\n", "function normalizeLocalCast(person){\n  if(!person) return null;\n  if(typeof person === 'string'){\n    const name = String(person).trim();\n    if(!name) return null;\n    return { name, role:'', thumb:'', tmdbProfile:'', raw:null };\n  }\n  const name = String(person.tag || person.name || person.role || '').trim();\n  if(!name) return null;\n  const role = (()=>{\n    const rawRole = String(person.role || '').trim();\n    if(!rawRole) return '';\n    return rawRole.toLowerCase() === name.toLowerCase() ? '' : rawRole;\n  })();\n  const tmdbProfile = [\n    person?.tmdb?.profile,\n    person?.tmdb?.profile_path,\n    person?.tmdb?.profilePath,\n    person?.tmdbProfile,\n    person?.profile,\n    person?.profile_path,\n    person?.profilePath,\n  ].find(val => typeof val === 'string' && val.trim());\n  const thumb = [person?.thumb, person?.photo, person?.image].find(val => typeof val === 'string' && val.trim()) || '';\n  return {\n    name,\n    role,\n    thumb,\n    tmdbProfile: tmdbProfile ? String(tmdbProfile).trim() : '',\n    raw: person,\n  };\n}\n\nfunction normalizeTmdbCast(person){\n  if(!person) return null;\n  const name = String(person.name || person.original_name || '').trim();\n  if(!name) return null;\n  const role = String(person.character || '').trim();\n  return {\n    name,\n    role,\n    thumb: '',\n    tmdbProfile: person.profile || person.profile_path || person.profilePath || '',\n    raw: { tmdb: person },\n  };\n}\n\nexport function buildCastList(item){\n  const seen = new Map();\n  const combined = [];\n  const localSource = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\n\n  localSource.forEach(person => {\n    const entry = normalizeLocalCast(person);\n    if(!entry) return;\n    const lowerName = entry.name.toLowerCase();\n    if(!seen.has(lowerName)){\n      seen.set(lowerName, true);\n      combined.push(entry);\n    }\n  });\n\n  const tmdbSource = Array.isArray(item?.tmdbDetail?.credits?.cast) ? item.tmdbDetail.credits.cast : [];\n  tmdbSource.forEach(person => {\n    const entry = normalizeTmdbCast(person);\n    if(!entry) return;\n    const lowerName = entry.name.toLowerCase();\n    if(!seen.has(lowerName)){\n      seen.set(lowerName, true);\n      combined.push(entry);\n    }\n  });\n\n  return combined;\n}\n\nexport { normalizeLocalCast, normalizeTmdbCast };\n", "import { buildCastList } from './castData.js';\nimport { useTmdbOn } from '../utils.js';\n\nconst MAX_INITIAL_CAST = 12;\nconst castState = new WeakMap();\nlet listIdCounter = 0;\n\nfunction resolveContainer(target){\n  if(!target) return null;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(elementCtor && target instanceof elementCtor) return target;\n  if(elementCtor && target.content instanceof elementCtor) return target.content;\n  if(elementCtor && target.root instanceof elementCtor) return target.root;\n  return null;\n}\n\nfunction ensureCastRoot(target){\n  const container = resolveContainer(target);\n  if(!container) return null;\n  let root = container.querySelector('[data-v3-cast]');\n  if(!root){\n    root = document.createElement('div');\n    root.className = 'v3-cast';\n    root.dataset.v3Cast = '1';\n    root.dataset.loading = 'false';\n    container.appendChild(root);\n  }\n  return root;\n}\n\nfunction ensureList(root){\n  if(!root) return null;\n  let list = root.querySelector('[data-v3-cast-list]');\n  if(!list){\n    list = document.createElement('div');\n    list.className = 'v3-cast__scroller';\n    list.dataset.v3CastList = '1';\n    list.id = `v3-cast-list-${++listIdCounter}`;\n    root.appendChild(list);\n  }\n  return list;\n}\n\nfunction getState(root){\n  let state = castState.get(root);\n  if(!state){\n    state = { entries: [], expanded: false };\n    castState.set(root, state);\n  }\n  return state;\n}\n\nfunction normalizeTmdbProfile(path){\n  const str = String(path || '').trim();\n  if(!str) return '';\n  if(/^https?:\\/\\//i.test(str)) return str;\n  if(str.startsWith('//')) return `https:${str}`;\n  const suffix = str.startsWith('/') ? str : `/${str}`;\n  return `https://image.tmdb.org/t/p/w185${suffix}`;\n}\n\nfunction normalizeLocalImage(path){\n  const str = String(path || '').trim();\n  if(!str) return '';\n  if(/^https?:\\/\\//i.test(str) || str.startsWith('data:')) return str;\n  if(str.startsWith('//')) return `https:${str}`;\n  return str;\n}\n\nfunction resolveCastImage(entry, tmdbEnabled){\n  if(!entry) return '';\n  const raw = entry.raw || {};\n  if(tmdbEnabled){\n    const tmdbCandidates = [\n      entry.tmdbProfile,\n      raw?.tmdb?.profile,\n      raw?.tmdb?.profile_path,\n      raw?.tmdb?.profilePath,\n      raw?.tmdbProfile,\n      raw?.profile,\n      raw?.profile_path,\n      raw?.profilePath,\n    ];\n    for(const candidate of tmdbCandidates){\n      const url = normalizeTmdbProfile(candidate);\n      if(url) return url;\n    }\n  }\n  const localCandidates = [entry.thumb, raw?.thumb, raw?.photo, raw?.image];\n  for(const candidate of localCandidates){\n    const url = normalizeLocalImage(candidate);\n    if(url) return url;\n  }\n  return '';\n}\n\nfunction castInitials(name){\n  const str = String(name || '').trim();\n  if(!str) return '?';\n  const parts = str.split(/\\s+/).slice(0, 2);\n  const chars = parts.map(part => part.charAt(0)).filter(Boolean);\n  return chars.length ? chars.join('').toUpperCase() : str.charAt(0).toUpperCase();\n}\n\nfunction createCastCard(entry, tmdbEnabled){\n  const name = String(entry?.name || '').trim();\n  if(!name) return null;\n  const role = String(entry?.role || '').trim();\n\n  const card = document.createElement('article');\n  card.className = 'v3-cast-card';\n  card.setAttribute('role', 'listitem');\n  card.tabIndex = 0;\n  if(role){\n    card.setAttribute('aria-label', `${name} \u2013 ${role}`);\n  }else{\n    card.setAttribute('aria-label', name);\n    card.classList.add('v3-cast-card--no-role');\n  }\n\n  const avatar = document.createElement('div');\n  avatar.className = 'v3-cast-card__avatar';\n  const imageUrl = resolveCastImage(entry, tmdbEnabled);\n  if(imageUrl){\n    avatar.classList.add('has-image');\n    const img = document.createElement('img');\n    img.src = imageUrl;\n    img.alt = name;\n    img.loading = 'lazy';\n    img.decoding = 'async';\n    avatar.appendChild(img);\n  }else{\n    const initials = document.createElement('span');\n    initials.className = 'v3-cast-card__initials';\n    initials.textContent = castInitials(name);\n    initials.setAttribute('aria-hidden', 'true');\n    avatar.appendChild(initials);\n  }\n\n  const meta = document.createElement('div');\n  meta.className = 'v3-cast-card__meta';\n  const nameLine = document.createElement('p');\n  nameLine.className = 'v3-cast-card__name';\n  nameLine.textContent = name;\n  meta.appendChild(nameLine);\n  if(role){\n    const roleLine = document.createElement('p');\n    roleLine.className = 'v3-cast-card__role';\n    roleLine.textContent = role;\n    meta.appendChild(roleLine);\n  }\n\n  card.append(avatar, meta);\n  return card;\n}\n\nfunction renderEntries(root, entries, expanded){\n  const list = ensureList(root);\n  if(!list) return;\n  const tmdbEnabled = useTmdbOn();\n  const visible = expanded ? entries : entries.slice(0, MAX_INITIAL_CAST);\n  list.replaceChildren(...visible.map(entry => createCastCard(entry, tmdbEnabled)).filter(Boolean));\n  if(visible.length){\n    list.setAttribute('role', 'list');\n  }else{\n    list.removeAttribute('role');\n  }\n  list.dataset.count = String(visible.length);\n  root.dataset.expanded = expanded ? 'true' : 'false';\n}\n\nfunction ensureMoreButton(root){\n  let button = root.querySelector('[data-v3-cast-more]');\n  if(button) return button;\n  button = document.createElement('button');\n  button.type = 'button';\n  button.className = 'v3-cast__more';\n  button.dataset.v3CastMore = '1';\n  button.textContent = 'Mehr Cast anzeigen';\n  const list = ensureList(root);\n  if(list?.id) button.setAttribute('aria-controls', list.id);\n  button.addEventListener('click', () => {\n    const state = getState(root);\n    state.expanded = true;\n    renderEntries(root, state.entries, true);\n    updateMoreButton(root);\n    button.setAttribute('aria-expanded', 'true');\n  });\n  root.appendChild(button);\n  return button;\n}\n\nfunction removeMoreButton(root){\n  const button = root.querySelector('[data-v3-cast-more]');\n  if(button){\n    button.remove();\n  }\n}\n\nfunction updateMoreButton(root){\n  const state = getState(root);\n  const hasMore = state.entries.length > MAX_INITIAL_CAST;\n  if(hasMore && !state.expanded){\n    const button = ensureMoreButton(root);\n    button.hidden = false;\n    button.disabled = false;\n    button.setAttribute('aria-expanded', 'false');\n  }else{\n    removeMoreButton(root);\n  }\n  ensureStatusPlacement(root);\n}\n\nfunction ensureStatusPlacement(root){\n  const status = root.querySelector('.v3-cast-status');\n  if(!status) return;\n  const list = ensureList(root);\n  if(!list) return;\n  const moreButton = root.querySelector('[data-v3-cast-more]');\n  const desiredPrevious = moreButton || list;\n  if(status.previousElementSibling !== desiredPrevious){\n    if(moreButton){\n      root.insertBefore(status, moreButton.nextSibling);\n    }else{\n      root.insertBefore(status, list.nextSibling);\n    }\n  }\n}\n\nexport function setCastLoading(target, loading){\n  const root = ensureCastRoot(target);\n  if(!root) return;\n  const isLoading = Boolean(loading);\n  root.dataset.loading = isLoading ? 'true' : 'false';\n  if(isLoading){\n    root.setAttribute('aria-busy', 'true');\n  }else{\n    root.removeAttribute('aria-busy');\n  }\n}\n\nexport function setCastStatus(target, status){\n  const root = ensureCastRoot(target);\n  if(!root) return;\n  let statusEl = root.querySelector('.v3-cast-status');\n  if(!status || !status.message){\n    if(statusEl) statusEl.remove();\n    root.dataset.status = '';\n    return;\n  }\n  if(!statusEl){\n    statusEl = document.createElement('p');\n    statusEl.className = 'v3-cast-status';\n    statusEl.setAttribute('aria-live', 'polite');\n    statusEl.setAttribute('aria-atomic', 'true');\n    root.appendChild(statusEl);\n  }\n  statusEl.dataset.state = status.state || '';\n  statusEl.textContent = status.message;\n  root.dataset.status = status.state || '';\n  ensureStatusPlacement(root);\n}\n\nexport function renderCast(target, payload){\n  const root = ensureCastRoot(target);\n  if(!root) return;\n  const source = payload?.item || payload;\n  const entries = buildCastList(source) || [];\n  const state = getState(root);\n  state.entries = entries;\n  state.expanded = false;\n  setCastLoading(root, false);\n  if(!entries.length){\n    ensureList(root).replaceChildren();\n    setCastStatus(root, { state: 'empty', message: 'Keine Besetzungsdaten verf\u00FCgbar.' });\n    removeMoreButton(root);\n    root.dataset.count = '0';\n    return;\n  }\n  setCastStatus(root, null);\n  renderEntries(root, entries, false);\n  updateMoreButton(root);\n  root.dataset.count = String(entries.length);\n}\n\n", "const DEFAULT_TTL_HOURS = 24;\nconst STORAGE_KEY = 'tmdb.metadata.cache.v1';\nconst LOG_PREFIX = '[cacheStore]';\n\nfunction now(){\n  return Date.now();\n}\n\nfunction hoursToMs(hours){\n  const num = Number(hours);\n  if(!Number.isFinite(num) || num <= 0){\n    return DEFAULT_TTL_HOURS * 60 * 60 * 1000;\n  }\n  if(num < 0.01){\n    // Allow extremely small TTL values to expire quickly so unit tests can\n    // exercise expiry paths without long waits. This keeps behaviour for\n    // typical TTL values (>= 0.01 hours) unchanged while still supporting\n    // fractional hour precision.\n    return Math.max(1, num * 60 * 60 * 1000 * 0.01);\n  }\n  return num * 60 * 60 * 1000;\n}\n\nfunction safeParse(raw){\n  try{\n    return JSON.parse(raw);\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to parse persisted cache payload:`, err);\n    return [];\n  }\n}\n\nfunction safeStringify(payload){\n  try{\n    return JSON.stringify(payload);\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to serialise cache payload:`, err);\n    return '[]';\n  }\n}\n\nfunction createStore({ storageKey = STORAGE_KEY } = {}){\n  let memory = new Map();\n  let loaded = false;\n  let persistedSignature = null;\n\n  function rebuildFromStorage(raw){\n    const parsed = safeParse(raw);\n    const next = new Map();\n    const nowTs = now();\n    if(Array.isArray(parsed)){\n      for(const entry of parsed){\n        if(!Array.isArray(entry) || entry.length < 2) continue;\n        const [key, payload] = entry;\n        if(!key || !payload) continue;\n        const expiresAt = Number(payload.expiresAt);\n        if(Number.isFinite(expiresAt) && expiresAt > nowTs){\n          next.set(String(key), { value: payload.value, expiresAt });\n        }\n      }\n    }\n    memory = next;\n  }\n\n  function syncFromStorage(force = false){\n    if(typeof localStorage === 'undefined') return;\n    let raw = null;\n    try{\n      raw = localStorage.getItem(storageKey);\n    }catch(err){\n      console.warn(`${LOG_PREFIX} Failed to read persisted cache:`, err);\n      memory = new Map();\n      persistedSignature = null;\n      return;\n    }\n    if(!raw){\n      if(memory.size){\n        memory = new Map();\n      }\n      persistedSignature = null;\n      return;\n    }\n    if(!force && raw === persistedSignature) return;\n    rebuildFromStorage(raw);\n    persistedSignature = raw;\n  }\n\n  function load(){\n    if(!loaded){\n      syncFromStorage(true);\n      loaded = true;\n    }else{\n      syncFromStorage(false);\n    }\n  }\n\n  function persist(){\n    if(typeof localStorage === 'undefined') return;\n    const serialisable = Array.from(memory.entries()).map(([key, entry])=>[\n      key,\n      { value: entry.value, expiresAt: entry.expiresAt }\n    ]);\n    try{\n      const payload = safeStringify(serialisable);\n      localStorage.setItem(storageKey, payload);\n      persistedSignature = payload;\n    }catch(err){\n      console.warn(`${LOG_PREFIX} Failed to persist cache:`, err);\n    }\n  }\n\n  function get(key){\n    if(!key) return null;\n    load();\n    const entry = memory.get(String(key));\n    if(!entry) return null;\n    if(Number.isFinite(entry.expiresAt) && entry.expiresAt <= now()){\n      memory.delete(String(key));\n      persist();\n      return null;\n    }\n    return entry.value;\n  }\n\n  function set(key, value, ttlHours = DEFAULT_TTL_HOURS){\n    if(!key) return value;\n    load();\n    const expiresAt = now() + hoursToMs(ttlHours);\n    memory.set(String(key), { value, expiresAt });\n    persist();\n    return value;\n  }\n\n  function clear(prefix){\n    load();\n    if(!prefix){\n      memory.clear();\n      persist();\n      return;\n    }\n    const target = String(prefix);\n    let changed = false;\n    for(const key of memory.keys()){\n      if(key.startsWith(target)){\n        memory.delete(key);\n        changed = true;\n      }\n    }\n    if(changed) persist();\n  }\n\n  function clearExpired(){\n    load();\n    const nowTs = now();\n    let changed = false;\n    for(const [key, entry] of memory.entries()){\n      if(Number.isFinite(entry.expiresAt) && entry.expiresAt <= nowTs){\n        memory.delete(key);\n        changed = true;\n      }\n    }\n    if(changed) persist();\n    return changed;\n  }\n\n  function size(){\n    load();\n    return memory.size;\n  }\n\n  return { get, set, clear, clearExpired, size };\n}\n\nconst defaultStore = createStore();\n\nexport function get(key){\n  return defaultStore.get(key);\n}\n\nexport function set(key, value, ttlHours){\n  return defaultStore.set(key, value, ttlHours);\n}\n\nexport function clear(prefix){\n  return defaultStore.clear(prefix);\n}\n\nexport function clearExpired(){\n  return defaultStore.clearExpired();\n}\n\nexport function size(){\n  return defaultStore.size();\n}\n\nexport function createCacheStore(options){\n  return createStore(options);\n}\n\nexport default {\n  get,\n  set,\n  clear,\n  clearExpired,\n  size,\n  createCacheStore,\n};\n", "import { createCacheStore } from './cacheStore.js';\n\nconst DEFAULT_API_BASE = 'https://api.themoviedb.org/3';\nconst DEFAULT_LANGUAGE = 'de-DE';\nconst DEFAULT_REGION = 'DE';\nconst LOG_PREFIX = '[tmdbClient]';\nconst MAX_RETRIES = 4;\nconst BASE_DELAY = 500;\nconst DELAY_CAP = 10_000;\n\nfunction delay(ms){\n  return new Promise(resolve => setTimeout(resolve, Math.max(0, ms || 0)));\n}\n\nfunction parseRetryAfter(value){\n  if(!value) return null;\n  const num = Number(value);\n  if(Number.isFinite(num)) return num * 1000;\n  const date = Date.parse(value);\n  if(Number.isFinite(date)) return Math.max(0, date - Date.now());\n  return null;\n}\n\nfunction computeRetryDelay(attempt, retryAfter){\n  if(Number.isFinite(retryAfter) && retryAfter > 0) return Math.min(retryAfter, DELAY_CAP);\n  const factor = Math.pow(2, Math.max(0, attempt));\n  return Math.min(DELAY_CAP, BASE_DELAY * factor);\n}\n\nfunction normaliseAppend(append){\n  if(!append) return '';\n  if(Array.isArray(append)) return append.filter(Boolean).join(',');\n  if(typeof append === 'string') return append.split(',').map(str => str.trim()).filter(Boolean).join(',');\n  return '';\n}\n\nfunction resolveCredential(options = {}){\n  const preferred = [\n    options.token,\n    options.tmdbToken,\n    options?.credentials?.token,\n    options?.settings?.tmdbToken,\n  ].find(value => typeof value === 'string' && value.trim());\n  if(preferred){\n    return { kind: 'bearer', value: preferred.trim() };\n  }\n\n  const key = [\n    options.apiKey,\n    options.tmdbApiKey,\n    options?.credentials?.apiKey,\n    options?.settings?.tmdbApiKey,\n  ].find(value => typeof value === 'string' && value.trim());\n  if(key){\n    return { kind: 'apikey', value: key.trim() };\n  }\n\n  if(typeof localStorage !== 'undefined'){\n    try{\n      const token = localStorage.getItem('tmdbToken');\n      if(token && token.trim()) return { kind: 'bearer', value: token.trim() };\n    }catch(err){\n      console.warn(`${LOG_PREFIX} Unable to read tmdbToken from storage:`, err);\n    }\n  }\n\n  return { kind: 'none', value: '' };\n}\n\nfunction createRequestInit(credential){\n  const headers = { Accept: 'application/json;charset=utf-8' };\n  if(credential?.kind === 'bearer' && credential.value){\n    headers.Authorization = `Bearer ${credential.value}`;\n  }\n  return { headers };\n}\n\nfunction applyCredentialToUrl(url, credential){\n  if(credential?.kind !== 'apikey' || !credential.value) return url;\n  const u = new URL(url);\n  u.searchParams.set('api_key', credential.value);\n  return u.toString();\n}\n\nfunction buildUrl(path, params, config){\n  const base = String(config.apiBase || DEFAULT_API_BASE).replace(/\\/$/, '');\n  const cleanPath = path.startsWith('/') ? path : `/${path}`;\n  const url = new URL(`${base}${cleanPath}`);\n  const search = url.searchParams;\n\n  const append = normaliseAppend(params.append_to_response);\n  if(append){\n    search.set('append_to_response', append);\n  }\n\n  const language = params.language || config.language || DEFAULT_LANGUAGE;\n  if(language) search.set('language', language);\n\n  const region = params.region || config.region || DEFAULT_REGION;\n  if(region) search.set('region', region);\n\n  for(const [key, value] of Object.entries(params)){\n    if(value === undefined || value === null) continue;\n    if(key === 'append_to_response' || key === 'language' || key === 'region') continue;\n    if(Array.isArray(value)){\n      if(value.length) search.set(key, value.join(','));\n      continue;\n    }\n    search.set(key, String(value));\n  }\n\n  const finalUrl = url.toString();\n  if(append){\n    return finalUrl.replace(/append_to_response=([^&]+)/, (_, value) => `append_to_response=${decodeURIComponent(value)}`);\n  }\n  return finalUrl;\n}\n\nasync function fetchJson(url, init, { retries = MAX_RETRIES } = {}){\n  let attempt = 0;\n  let lastError = null;\n  while(attempt <= retries){\n    try{\n      const response = await fetch(url, init);\n      if(response.status === 204) return null;\n      if(response.status === 429 && attempt < retries){\n        const retryAfter = parseRetryAfter(response.headers.get('Retry-After'));\n        await delay(computeRetryDelay(attempt, retryAfter));\n        attempt += 1;\n        continue;\n      }\n      if(!response.ok){\n        const error = new Error(`TMDB request failed with status ${response.status}`);\n        error.status = response.status;\n        error.url = url;\n        try{\n          error.body = await response.text();\n        }catch(_err){\n          error.body = null;\n        }\n        throw error;\n      }\n      const data = await response.json();\n      return data;\n    }catch(err){\n      lastError = err;\n      const status = typeof err?.status === 'number' ? err.status : null;\n      const shouldRetry = status == null || status >= 500 || status === 429;\n      if(attempt >= retries || !shouldRetry){\n        break;\n      }\n      await delay(computeRetryDelay(attempt, null));\n      attempt += 1;\n    }\n  }\n  throw lastError || new Error('TMDB request failed');\n}\n\n/**\n * Creates a TMDB API client with caching and retry logic\n * @param {Object} [options] - Configuration options\n * @param {string} [options.apiBase] - TMDB API base URL\n * @param {string} [options.language] - Default language (e.g., 'de-DE')\n * @param {string} [options.region] - Default region (e.g., 'DE')\n * @param {string} [options.token] - TMDB v4 Bearer token\n * @param {string} [options.apiKey] - TMDB v3 API key\n * @param {number} [options.ttlHours] - Cache TTL in hours\n * @param {boolean} [options.useCache] - Enable caching\n * @param {Object} [options.cacheStore] - Custom cache store instance\n * @returns {Object} TMDB client with get method\n */\nexport function createTmdbClient(options = {}){\n  const cache = options.cache instanceof Map ? options.cache : null;\n  const config = {\n    apiBase: options.apiBase || DEFAULT_API_BASE,\n    language: options.language || DEFAULT_LANGUAGE,\n    region: options.region || DEFAULT_REGION,\n    ttlHours: options.ttlHours || options.ttl || 0,\n  };\n  const credential = resolveCredential(options);\n  const store = options.cacheStore || (options.useCache ? createCacheStore() : null);\n\n  function getCacheKey(method, params){\n    if(!cache && !store) return '';\n    const sorted = Object.keys(params).sort().map(key => `${key}=${JSON.stringify(params[key])}`).join('&');\n    return `${method}?${sorted}`;\n  }\n\n  async function get(path, params = {}, opts = {}){\n    const requestParams = { ...params };\n    if(opts.append){\n      const baseAppend = normaliseAppend(requestParams.append_to_response);\n      const nextAppend = normaliseAppend(opts.append);\n      const combined = [baseAppend, nextAppend].filter(Boolean).join(',');\n      if(combined){\n        requestParams.append_to_response = combined;\n      }\n    }\n    if(opts.language) requestParams.language = opts.language;\n    if(opts.region) requestParams.region = opts.region;\n    const url = buildUrl(path, requestParams, config);\n    const authedUrl = applyCredentialToUrl(url, credential);\n    const init = createRequestInit(credential);\n    const cacheKey = getCacheKey(path, requestParams);\n    if(cacheKey){\n      if(cache && cache.has(cacheKey)) return cache.get(cacheKey);\n      if(store){\n        const cached = store.get(cacheKey);\n        if(cached) return cached;\n      }\n    }\n    const data = await fetchJson(authedUrl, init, { retries: opts.retries ?? MAX_RETRIES });\n    if(cacheKey){\n      if(cache) cache.set(cacheKey, data);\n      if(store){\n        try{\n          store.set(cacheKey, data, options.ttlHours || 0);\n        }catch(err){\n          console.warn(`${LOG_PREFIX} Failed to persist response cache:`, err);\n        }\n      }\n    }\n    return data;\n  }\n\n  return {\n    get,\n    get credential(){ return credential; },\n    get config(){ return { ...config }; },\n  };\n}\n\nconst defaultClient = createTmdbClient();\n\nexport async function get(path, params){\n  return defaultClient.get(path, params);\n}\n\nexport default defaultClient;\n", "const DEFAULT_IMAGE_BASE = 'https://image.tmdb.org/t/p';\nconst DEFAULT_SIZES = {\n  poster: 'w500',\n  backdrop: 'w780',\n  profile: 'h632',\n  logo: 'w500',\n  episode: 'w780',\n};\n\nfunction normaliseBase(base){\n  const raw = String(base || DEFAULT_IMAGE_BASE).trim();\n  if(!raw) return DEFAULT_IMAGE_BASE;\n  return raw.replace(/\\/$/, '');\n}\n\nfunction ensurePath(path){\n  if(!path) return '';\n  const str = String(path);\n  if(!str) return '';\n  return str.startsWith('/') ? str : `/${str}`;\n}\n\nfunction buildUrl(path, size, base){\n  const cleaned = ensurePath(path);\n  if(!cleaned) return '';\n  const root = normaliseBase(base);\n  return `${root}/${size}${cleaned}`;\n}\n\nfunction encodeSvg(svg){\n  return `data:image/svg+xml,${encodeURIComponent(svg)}`;\n}\n\nfunction pickBackground(type){\n  switch(type){\n    case 'poster':\n      return '#1f2933';\n    case 'profile':\n      return '#111827';\n    case 'logo':\n      return '#0f172a';\n    case 'episode':\n      return '#0b1120';\n    default:\n      return '#101827';\n  }\n}\n\nfunction pickForeground(type){\n  return type === 'logo' ? '#e5e7eb' : '#f9fafb';\n}\n\nexport function makeInitials(text, limit = 2){\n  const str = String(text || '').trim();\n  if(!str){\n    return '';\n  }\n  const parts = str.split(/\\s+/u).filter(Boolean);\n  if(!parts.length){\n    return str.slice(0, limit).toUpperCase();\n  }\n  const selected = parts.slice(0, limit).map(part => part.charAt(0));\n  return selected.join('').toUpperCase();\n}\n\nfunction fallbackSvg({\n  type,\n  text = '',\n  width,\n  height,\n  fontSize,\n  fontWeight = '600',\n  radius = 0,\n}){\n  const background = pickBackground(type);\n  const foreground = pickForeground(type);\n  const content = makeInitials(text, 2) || '\u2205';\n  const svg = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">\\n  <rect x=\"0\" y=\"0\" width=\"${width}\" height=\"${height}\" rx=\"${radius}\" ry=\"${radius}\" fill=\"${background}\"/>\\n  <text x=\"50%\" y=\"50%\" dominant-baseline=\"central\" text-anchor=\"middle\" fill=\"${foreground}\" font-family=\"'Inter', 'Segoe UI', sans-serif\" font-size=\"${fontSize}\" font-weight=\"${fontWeight}\" letter-spacing=\"0.08em\">${content}</text>\\n</svg>`;\n  return encodeSvg(svg);\n}\n\nfunction fallbackPoster(title){\n  return fallbackSvg({ type: 'poster', text: title, width: 500, height: 750, fontSize: 140, radius: 24 });\n}\n\nfunction fallbackBackdrop(title){\n  return fallbackSvg({ type: 'backdrop', text: title, width: 780, height: 439, fontSize: 120, radius: 16 });\n}\n\nfunction fallbackProfile(name){\n  return fallbackSvg({ type: 'profile', text: name, width: 400, height: 600, fontSize: 140, radius: 32 });\n}\n\nfunction fallbackLogo(title){\n  return fallbackSvg({ type: 'logo', text: title, width: 500, height: 281, fontSize: 96, radius: 24 });\n}\n\nfunction fallbackEpisode(title){\n  return fallbackSvg({ type: 'episode', text: title, width: 780, height: 439, fontSize: 110, radius: 24 });\n}\n\nfunction normaliseOptions(options){\n  return {\n    imageBase: options?.imageBase ?? options?.base ?? DEFAULT_IMAGE_BASE,\n    title: options?.title ?? options?.fallbackTitle ?? '',\n    size: options?.size,\n  };\n}\n\nexport function urlPoster(path, options = {}){\n  const { imageBase, title, size } = normaliseOptions(options);\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.poster, imageBase);\n  return candidate || fallbackPoster(title);\n}\n\nexport function urlBackdrop(path, options = {}){\n  const { imageBase, title, size } = normaliseOptions(options);\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.backdrop, imageBase);\n  return candidate || fallbackBackdrop(title);\n}\n\nexport function urlProfile(path, options = {}){\n  const { imageBase, title, size } = normaliseOptions(options);\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.profile, imageBase);\n  return candidate || fallbackProfile(title);\n}\n\nexport function urlLogo(path, options = {}){\n  const { imageBase, title, size } = normaliseOptions(options);\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.logo, imageBase);\n  return candidate || fallbackLogo(title);\n}\n\nexport function urlEpisode(path, options = {}){\n  const { imageBase, title, size } = normaliseOptions(options);\n  const candidate = buildUrl(path, size || DEFAULT_SIZES.episode, imageBase);\n  return candidate || fallbackEpisode(title);\n}\n\nexport function buildFallbackPoster(title){\n  return fallbackPoster(title);\n}\n\nexport function buildFallbackBackdrop(title){\n  return fallbackBackdrop(title);\n}\n\nexport function buildFallbackProfile(name){\n  return fallbackProfile(name);\n}\n\nexport function buildFallbackLogo(title){\n  return fallbackLogo(title);\n}\n\nexport function buildFallbackEpisode(title){\n  return fallbackEpisode(title);\n}\n\nexport default {\n  urlPoster,\n  urlBackdrop,\n  urlProfile,\n  urlLogo,\n  urlEpisode,\n  makeInitials,\n  buildFallbackPoster,\n  buildFallbackBackdrop,\n  buildFallbackProfile,\n  buildFallbackLogo,\n  buildFallbackEpisode,\n};\n", "import {\n  urlPoster,\n  urlBackdrop,\n  urlProfile,\n  urlLogo,\n  urlEpisode,\n  makeInitials,\n} from './imageHelper.js';\n\nconst DEFAULT_OPTIONS = {\n  imageBase: 'https://image.tmdb.org/t/p',\n  posterSize: 'w500',\n  backdropSize: 'w780',\n  profileSize: 'h632',\n  logoSize: 'w500',\n  stillSize: 'w780',\n  castLimit: 20,\n  crewLimit: 40,\n  region: 'DE',\n};\n\nfunction normaliseOptions(options = {}){\n  return {\n    ...DEFAULT_OPTIONS,\n    ...options,\n  };\n}\n\nfunction normaliseId(id){\n  if(id == null) return '';\n  const num = Number(id);\n  if(Number.isFinite(num) && num > 0) return String(Math.floor(num));\n  // Only accept valid numeric strings\n  const str = String(id).trim();\n  if(/^\\d+$/.test(str)){\n    const parsed = parseInt(str, 10);\n    if(parsed > 0) return String(parsed);\n  }\n  return '';\n}\n\nfunction scoreImage(entry){\n  const votes = Number(entry.vote_count || entry.voteCount || 0);\n  const rating = Number(entry.vote_average || entry.voteAverage || 0);\n  return (rating * 10) + votes;\n}\n\nfunction normaliseLanguage(lang){\n  if(!lang) return 'any';\n  const str = String(lang).toLowerCase();\n  if(str === 'xx' || str === 'null') return 'any';\n  return str;\n}\n\nexport function pickBestImage(images = [], { preferredLanguages = ['de', 'en', 'any'], fallbackPath = '' } = {}){\n  if(!Array.isArray(images) || images.length === 0){\n    return fallbackPath || '';\n  }\n  const sorted = images\n    .filter(entry => entry && entry.file_path)\n    .map(entry => ({\n      ...entry,\n      language: normaliseLanguage(entry.iso_639_1 || entry.language || ''),\n      score: scoreImage(entry),\n    }))\n    .sort((a, b) => b.score - a.score);\n\n  for(const language of preferredLanguages){\n    const candidate = sorted.find(entry => entry.language === normaliseLanguage(language));\n    if(candidate) return candidate.file_path || fallbackPath || '';\n  }\n\n  return sorted.length ? sorted[0].file_path || fallbackPath || '' : fallbackPath || '';\n}\n\nfunction extractCollection(detail, options){\n  if(!detail?.belongs_to_collection) return null;\n  const collection = detail.belongs_to_collection;\n  return {\n    id: normaliseId(collection.id),\n    name: collection.name || '',\n    poster: urlPoster(collection.poster_path, { imageBase: options.imageBase, size: options.posterSize, title: collection.name }),\n    backdrop: urlBackdrop(collection.backdrop_path, { imageBase: options.imageBase, size: options.backdropSize, title: collection.name }),\n  };\n}\n\nfunction mapGenres(list){\n  if(!Array.isArray(list)) return [];\n  return list.map(entry => entry && (entry.name || entry.title || entry.tag)).filter(Boolean).map(String);\n}\n\nfunction mapProductionCompanies(list, options){\n  if(!Array.isArray(list)) return [];\n  return list.map(company => ({\n    id: normaliseId(company?.id),\n    name: company?.name || '',\n    originCountry: company?.origin_country || '',\n    logo: urlLogo(company?.logo_path, { imageBase: options.imageBase, size: options.logoSize, title: company?.name }),\n  }));\n}\n\nfunction mapProvider(entry, options){\n  if(!entry) return null;\n  const cfg = normaliseOptions(options);\n  const id = normaliseId(entry.provider_id ?? entry.id);\n  const name = entry.provider_name || entry.name || '';\n  if(!name) return null;\n  return {\n    id,\n    providerId: id,\n    name,\n    logoPath: entry.logo_path || '',\n    logo: urlLogo(entry.logo_path, { imageBase: cfg.imageBase, size: cfg.logoSize, title: name }),\n    displayPriority: entry.display_priority ?? entry.displayPriority ?? null,\n  };\n}\n\nfunction mapWatchProviderRegion(regionData, options){\n  if(!regionData) return null;\n  const cfg = normaliseOptions(options);\n  const types = ['flatrate', 'rent', 'buy', 'free', 'ads'];\n  const mapped = { link: regionData.link || '' };\n  for(const type of types){\n    const list = Array.isArray(regionData[type]) ? regionData[type] : [];\n    mapped[type] = list\n      .map(entry => mapProvider(entry, cfg))\n      .filter(Boolean);\n  }\n  return mapped;\n}\n\nfunction mapWatchProviders(payload, options = {}){\n  const cfg = normaliseOptions(options);\n  const results = payload?.results;\n  if(!results || typeof results !== 'object') return {};\n  const mapped = {};\n  for(const [region, data] of Object.entries(results)){\n    const regionKey = String(region || '').toUpperCase();\n    if(!regionKey) continue;\n    const mappedRegion = mapWatchProviderRegion(data, cfg);\n    if(mappedRegion) mapped[regionKey] = mappedRegion;\n  }\n  const defaultRegion = String(options.region || cfg.region || '').toUpperCase();\n  if(defaultRegion && mapped[defaultRegion]){\n    mapped.default = mapped[defaultRegion];\n  }\n  return mapped;\n}\n\nfunction mapNetworks(list, options){\n  if(!Array.isArray(list)) return [];\n  return list.map(network => ({\n    id: normaliseId(network?.id),\n    name: network?.name || '',\n    logo: urlLogo(network?.logo_path, { imageBase: options.imageBase, size: options.logoSize, title: network?.name }),\n    originCountry: network?.origin_country || '',\n  }));\n}\n\nfunction mapSeasons(list, options){\n  if(!Array.isArray(list)) return [];\n  return list.map(season => ({\n    id: normaliseId(season?.id),\n    name: season?.name || '',\n    seasonNumber: season?.season_number ?? null,\n    episodeCount: season?.episode_count ?? null,\n    airDate: season?.air_date || '',\n    poster: urlPoster(season?.poster_path, { imageBase: options.imageBase, size: options.posterSize, title: season?.name }),\n  }));\n}\n\nfunction mapSpokenLanguages(list){\n  if(!Array.isArray(list)) return [];\n  return list.map(entry => ({\n    code: entry?.iso_639_1 || '',\n    name: entry?.english_name || entry?.name || '',\n  }));\n}\n\nfunction pickCharacter(entry){\n  if(entry?.character) return entry.character;\n  if(Array.isArray(entry?.roles) && entry.roles.length){\n    const role = entry.roles.find(r => r?.character) || entry.roles[0];\n    return role?.character || '';\n  }\n  return '';\n}\n\nfunction pickJob(entry){\n  if(entry?.job) return entry.job;\n  if(Array.isArray(entry?.jobs) && entry.jobs.length){\n    const job = entry.jobs.find(j => j?.job) || entry.jobs[0];\n    return job?.job || '';\n  }\n  return '';\n}\n\nexport function mapCredits(rawCredits, options = {}){\n  const cfg = normaliseOptions(options);\n  if(!rawCredits) return { cast: [], crew: [] };\n  const castSource = Array.isArray(rawCredits.cast) && rawCredits.cast.length\n    ? rawCredits.cast\n    : Array.isArray(rawCredits?.aggregate?.cast) ? rawCredits.aggregate.cast : [];\n  const crewSource = Array.isArray(rawCredits.crew) && rawCredits.crew.length\n    ? rawCredits.crew\n    : Array.isArray(rawCredits?.aggregate?.crew) ? rawCredits.aggregate.crew : [];\n\n  const cast = castSource.slice(0, cfg.castLimit).map(person => ({\n    id: normaliseId(person?.id),\n    name: person?.name || person?.original_name || '',\n    character: pickCharacter(person),\n    order: person?.order ?? 0,\n    profile: urlProfile(person?.profile_path, { imageBase: cfg.imageBase, size: cfg.profileSize, title: person?.name }),\n    initials: makeInitials(person?.name || person?.original_name || ''),\n    knownForDepartment: person?.known_for_department || '',\n  }));\n\n  const crew = crewSource.slice(0, cfg.crewLimit).map(person => ({\n    id: normaliseId(person?.id),\n    name: person?.name || person?.original_name || '',\n    job: pickJob(person),\n    department: person?.department || '',\n    profile: urlProfile(person?.profile_path, { imageBase: cfg.imageBase, size: cfg.profileSize, title: person?.name }),\n    initials: makeInitials(person?.name || person?.original_name || ''),\n  }));\n\n  return { cast, crew };\n}\n\nfunction selectReleaseCertification(results = []){\n  const priorityCountries = ['DE', 'AT', 'CH', 'US'];\n  for(const country of priorityCountries){\n    const entry = results.find(item => item?.iso_3166_1 === country);\n    if(!entry) continue;\n    const releases = Array.isArray(entry.release_dates) ? entry.release_dates : [];\n    const candidates = releases\n      .filter(release => release && typeof release.certification === 'string' && release.certification.trim())\n      .sort((a, b) => {\n        const typeA = a.type ?? 0;\n        const typeB = b.type ?? 0;\n        if(typeA !== typeB) return typeA - typeB;\n        const dateA = Date.parse(a.release_date || '') || 0;\n        const dateB = Date.parse(b.release_date || '') || 0;\n        return dateA - dateB;\n      });\n    if(candidates.length) return candidates[0].certification.trim();\n  }\n  return '';\n}\n\nexport function getContentRatingDE(payload = {}){\n  if(payload.release_dates?.results){\n    const cert = selectReleaseCertification(payload.release_dates.results);\n    if(cert) return cert;\n  }\n  if(payload.content_ratings?.results){\n    const results = Array.isArray(payload.content_ratings.results) ? payload.content_ratings.results : [];\n    const german = results.find(entry => entry?.iso_3166_1 === 'DE' && entry?.rating);\n    if(german) return String(german.rating).trim();\n    const us = results.find(entry => entry?.iso_3166_1 === 'US' && entry?.rating);\n    if(us) return String(us.rating).trim();\n  }\n  return '';\n}\n\nfunction buildImageCollection(images = [], mapper){\n  if(!Array.isArray(images)) return [];\n  return images\n    .filter(entry => entry && entry.file_path)\n    .map(mapper);\n}\n\nexport function mapMovieDetail(detail, options = {}){\n  if(!detail) return null;\n  const cfg = normaliseOptions(options);\n  const posterPath = pickBestImage(detail.images?.posters, { fallbackPath: detail.poster_path });\n  const backdropPath = pickBestImage(detail.images?.backdrops, { fallbackPath: detail.backdrop_path, preferredLanguages: ['de', 'en', 'any'] });\n\n  return {\n    type: 'movie',\n    id: normaliseId(detail.id),\n    title: detail.title || detail.original_title || '',\n    originalTitle: detail.original_title || '',\n    overview: detail.overview || '',\n    tagline: detail.tagline || '',\n    releaseDate: detail.release_date || '',\n    runtime: Number(detail.runtime) || null,\n    status: detail.status || '',\n    homepage: detail.homepage || '',\n    imdbId: detail.imdb_id || '',\n    collection: extractCollection(detail, cfg),\n    poster: urlPoster(posterPath, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.title }),\n    posterPath,\n    backdrop: urlBackdrop(backdropPath, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.title }),\n    backdropPath,\n    genres: mapGenres(detail.genres),\n    voteAverage: Number(detail.vote_average) || 0,\n    voteCount: Number(detail.vote_count) || 0,\n    popularity: Number(detail.popularity) || 0,\n    productionCountries: Array.isArray(detail.production_countries) ? detail.production_countries.map(entry => entry?.iso_3166_1 || entry?.name || '').filter(Boolean) : [],\n    productionCompanies: mapProductionCompanies(detail.production_companies, cfg),\n    spokenLanguages: mapSpokenLanguages(detail.spoken_languages),\n    contentRating: getContentRatingDE(detail),\n    credits: mapCredits(detail.credits, cfg),\n    images: {\n      posters: buildImageCollection(detail.images?.posters, entry => ({\n        path: entry.file_path,\n        url: urlPoster(entry.file_path, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.title }),\n        width: entry.width,\n        height: entry.height,\n        voteAverage: entry.vote_average,\n        voteCount: entry.vote_count,\n        language: entry.iso_639_1 || '',\n      })),\n      backdrops: buildImageCollection(detail.images?.backdrops, entry => ({\n        path: entry.file_path,\n        url: urlBackdrop(entry.file_path, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.title }),\n        width: entry.width,\n        height: entry.height,\n        voteAverage: entry.vote_average,\n        voteCount: entry.vote_count,\n        language: entry.iso_639_1 || '',\n      })),\n    },\n    watchProviders: mapWatchProviders(detail['watch/providers'], cfg),\n    url: detail.id ? `https://www.themoviedb.org/movie/${detail.id}` : '',\n    raw: detail,\n  };\n}\n\nexport function mapTvDetail(detail, options = {}){\n  if(!detail) return null;\n  const cfg = normaliseOptions(options);\n  const posterPath = pickBestImage(detail.images?.posters, { fallbackPath: detail.poster_path });\n  const backdropPath = pickBestImage(detail.images?.backdrops, { fallbackPath: detail.backdrop_path, preferredLanguages: ['de', 'en', 'any'] });\n\n  return {\n    type: 'tv',\n    id: normaliseId(detail.id),\n    name: detail.name || detail.original_name || '',\n    originalName: detail.original_name || '',\n    overview: detail.overview || '',\n    tagline: detail.tagline || '',\n    firstAirDate: detail.first_air_date || '',\n    lastAirDate: detail.last_air_date || '',\n    numberOfEpisodes: Number(detail.number_of_episodes) || 0,\n    numberOfSeasons: Number(detail.number_of_seasons) || 0,\n    status: detail.status || '',\n    homepage: detail.homepage || '',\n    inProduction: !!detail.in_production,\n    poster: urlPoster(posterPath, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.name }),\n    posterPath,\n    backdrop: urlBackdrop(backdropPath, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.name }),\n    backdropPath,\n    genres: mapGenres(detail.genres),\n    voteAverage: Number(detail.vote_average) || 0,\n    voteCount: Number(detail.vote_count) || 0,\n    popularity: Number(detail.popularity) || 0,\n    createdBy: Array.isArray(detail.created_by) ? detail.created_by.map(person => ({\n      id: normaliseId(person?.id),\n      name: person?.name || '',\n      profile: urlProfile(person?.profile_path, { imageBase: cfg.imageBase, size: cfg.profileSize, title: person?.name }),\n      initials: makeInitials(person?.name || ''),\n    })) : [],\n    networks: mapNetworks(detail.networks, cfg),\n    productionCompanies: mapProductionCompanies(detail.production_companies, cfg),\n    seasons: mapSeasons(detail.seasons, cfg),\n    contentRating: getContentRatingDE(detail),\n    credits: (() => {\n      const rawCredits = detail.credits || null;\n      const hasDirectCredits = rawCredits && (\n        (Array.isArray(rawCredits.cast) && rawCredits.cast.length > 0) ||\n        (Array.isArray(rawCredits.crew) && rawCredits.crew.length > 0)\n      );\n      const source = hasDirectCredits ? rawCredits : (detail.aggregate_credits || null);\n      return mapCredits(source, cfg);\n    })(),\n    images: {\n      posters: buildImageCollection(detail.images?.posters, entry => ({\n        path: entry.file_path,\n        url: urlPoster(entry.file_path, { imageBase: cfg.imageBase, size: cfg.posterSize, title: detail.name }),\n        width: entry.width,\n        height: entry.height,\n        voteAverage: entry.vote_average,\n        voteCount: entry.vote_count,\n        language: entry.iso_639_1 || '',\n      })),\n      backdrops: buildImageCollection(detail.images?.backdrops, entry => ({\n        path: entry.file_path,\n        url: urlBackdrop(entry.file_path, { imageBase: cfg.imageBase, size: cfg.backdropSize, title: detail.name }),\n        width: entry.width,\n        height: entry.height,\n        voteAverage: entry.vote_average,\n        voteCount: entry.vote_count,\n        language: entry.iso_639_1 || '',\n      })),\n      logos: buildImageCollection(detail.images?.logos, entry => ({\n        path: entry.file_path,\n        url: urlLogo(entry.file_path, { imageBase: cfg.imageBase, size: cfg.logoSize, title: detail.name }),\n        width: entry.width,\n        height: entry.height,\n        language: entry.iso_639_1 || '',\n      })),\n    },\n    watchProviders: mapWatchProviders(detail['watch/providers'], cfg),\n    url: detail.id ? `https://www.themoviedb.org/tv/${detail.id}` : '',\n    raw: detail,\n  };\n}\n\nexport function mapSeasonDetail(seasonDetail, options = {}){\n  if(!seasonDetail) return null;\n  const cfg = normaliseOptions(options);\n  const show = options.show || {};\n  const posterPath = pickBestImage(seasonDetail.images?.posters, { fallbackPath: seasonDetail.poster_path });\n\n  const episodes = Array.isArray(seasonDetail.episodes) ? seasonDetail.episodes.map(episode => {\n    const stillPath = pickBestImage(episode?.images?.stills, { fallbackPath: episode?.still_path });\n    return {\n      id: normaliseId(episode?.id),\n      episodeNumber: episode?.episode_number ?? null,\n      seasonNumber: episode?.season_number ?? seasonDetail.season_number ?? null,\n      name: episode?.name || '',\n      overview: episode?.overview || '',\n      airDate: episode?.air_date || '',\n      runtime: Number(episode?.runtime) || null,\n      voteAverage: Number(episode?.vote_average) || 0,\n      voteCount: Number(episode?.vote_count) || 0,\n      still: urlEpisode(stillPath, { imageBase: cfg.imageBase, size: cfg.stillSize, title: episode?.name || seasonDetail.name }),\n      stillPath,\n      crew: mapCredits({ crew: episode?.crew || [] }, cfg).crew,\n      guestStars: mapCredits({ cast: episode?.guest_stars || [] }, { ...cfg, castLimit: 10 }).cast,\n    };\n  }) : [];\n\n  return {\n    type: 'season',\n    id: normaliseId(seasonDetail.id),\n    showId: normaliseId(show.id || seasonDetail.show_id || ''),\n    name: seasonDetail.name || '',\n    overview: seasonDetail.overview || '',\n    airDate: seasonDetail.air_date || '',\n    seasonNumber: seasonDetail.season_number ?? null,\n    episodeCount: seasonDetail.episodes ? seasonDetail.episodes.length : seasonDetail.episode_count || 0,\n    poster: urlPoster(posterPath, { imageBase: cfg.imageBase, size: cfg.posterSize, title: seasonDetail.name || show.name }),\n    posterPath,\n    episodes,\n    credits: mapCredits(seasonDetail.credits, cfg),\n    url: show.id ? `https://www.themoviedb.org/tv/${show.id}/season/${seasonDetail.season_number ?? ''}` : '',\n    raw: seasonDetail,\n  };\n}\n\nexport default {\n  mapMovieDetail,\n  mapTvDetail,\n  mapSeasonDetail,\n  mapCredits,\n  pickBestImage,\n  getContentRatingDE,\n};\n", "import { createCacheStore } from './cacheStore.js';\nimport { createTmdbClient } from './tmdbClient.js';\nimport {\n  mapMovieDetail,\n  mapTvDetail,\n  mapSeasonDetail,\n} from './tmdbMapper.js';\n\nconst LOG_PREFIX = '[metadataService]';\nconst DEFAULT_TTL_HOURS = 24;\nconst DEFAULT_IMAGE_BASE = 'https://image.tmdb.org/t/p';\n\nfunction normaliseConfig(input = {}){\n  return {\n    apiKey: input.apiKey || input.tmdbApiKey || '',\n    token: input.token || input.tmdbToken || '',\n    language: input.language || input.lang || 'de-DE',\n    region: input.region || input.iso || 'DE',\n    imageBase: input.imageBase || DEFAULT_IMAGE_BASE,\n    ttlHours: Number(input.ttlHours || input.ttl || DEFAULT_TTL_HOURS) || DEFAULT_TTL_HOURS,\n  };\n}\n\nfunction createLogger(){\n  return {\n    warn(...args){\n      try {\n        console.warn(LOG_PREFIX, ...args);\n      } catch (_err) {\n        // ignore\n      }\n    },\n  };\n}\n\nfunction ensureArray(value){\n  if(!value) return [];\n  if(Array.isArray(value)) return value;\n  return String(value).split(',').map(part => part.trim()).filter(Boolean);\n}\n\nfunction combineAppend(base, extras){\n  const values = new Set([...ensureArray(base), ...ensureArray(extras)]);\n  if(!values.size) return '';\n  return Array.from(values).join(',');\n}\n\nfunction createFetcher(client, cache, config, log){\n  const defaultAppend = {\n    movie: 'images,credits,release_dates,watch/providers',\n    tv: 'images,content_ratings,aggregate_credits,credits,watch/providers',\n    season: 'images,credits',\n  };\n\n  async function fetchWithCache(key, ttlHours, loader){\n    try{\n      const cached = cache.get(key);\n      if(cached) return cached;\n    }catch(err){\n      log.warn('Cache read failed for', key, err?.message || err);\n    }\n    let data = null;\n    try{\n      data = await loader();\n    }catch(err){\n      log.warn('Request failed for', key, err?.message || err);\n      throw err;\n    }\n    try{\n      if(data != null) cache.set(key, data, ttlHours);\n    }catch(err){\n      log.warn('Cache write failed for', key, err?.message || err);\n    }\n    return data;\n  }\n\n  /**\n   * Fetches enriched movie details from TMDB with caching\n   * @param {string|number} id - TMDB movie ID\n   * @param {Object} [options] - Configuration options\n   * @param {number} [options.ttlHours] - Cache TTL in hours\n   * @param {string} [options.language] - Language code (e.g., 'de-DE')\n   * @param {string} [options.region] - Region code (e.g., 'DE')\n   * @param {string|string[]} [options.append] - Additional TMDB endpoints to append\n   * @param {string} [options.posterSize] - Poster image size\n   * @param {string} [options.backdropSize] - Backdrop image size\n   * @param {string} [options.profileSize] - Profile image size\n   * @param {string} [options.logoSize] - Logo image size\n   * @returns {Promise<Object|null>} Enriched movie data or null\n   */\n  async function getMovieEnriched(id, options = {}){\n    const movieId = id ?? options.id;\n    if(movieId == null) return null;\n    const cacheKey = `tmdb:movie:${movieId}:v1`;\n    const ttl = options.ttlHours ?? config.ttlHours;\n    return fetchWithCache(cacheKey, ttl, async ()=>{\n      const append = combineAppend(defaultAppend.movie, options.append);\n      const detail = await client.get(`/movie/${movieId}`, {\n        append_to_response: append,\n      }, {\n        language: options.language ?? config.language,\n        region: options.region ?? config.region,\n      });\n      return mapMovieDetail(detail, {\n        imageBase: config.imageBase,\n        posterSize: options.posterSize,\n        backdropSize: options.backdropSize,\n        profileSize: options.profileSize,\n        logoSize: options.logoSize,\n        region: options.region ?? config.region,\n      });\n    });\n  }\n\n  /**\n   * Fetches enriched TV series details from TMDB with caching\n   * @param {string|number} id - TMDB TV series ID\n   * @param {Object} [options] - Configuration options (same as getMovieEnriched)\n   * @returns {Promise<Object|null>} Enriched TV series data or null\n   */\n  async function getTvEnriched(id, options = {}){\n    const tvId = id ?? options.id;\n    if(tvId == null) return null;\n    const cacheKey = `tmdb:tv:${tvId}:v1`;\n    const ttl = options.ttlHours ?? config.ttlHours;\n    return fetchWithCache(cacheKey, ttl, async ()=>{\n      const append = combineAppend(defaultAppend.tv, options.append);\n      const detail = await client.get(`/tv/${tvId}`, {\n        append_to_response: append,\n      }, {\n        language: options.language ?? config.language,\n        region: options.region ?? config.region,\n      });\n      return mapTvDetail(detail, {\n        imageBase: config.imageBase,\n        posterSize: options.posterSize,\n        backdropSize: options.backdropSize,\n        profileSize: options.profileSize,\n        logoSize: options.logoSize,\n        region: options.region ?? config.region,\n      });\n    });\n  }\n\n  /**\n   * Fetches enriched season details from TMDB with caching\n   * @param {string|number} tvId - TMDB TV series ID\n   * @param {number} seasonNumber - Season number\n   * @param {Object} [options] - Configuration options\n   * @param {Object} [options.show] - Parent show object to attach to season\n   * @param {boolean} [options.skipShowLookup] - Skip automatic show lookup\n   * @param {string} [options.stillSize] - Episode still image size\n   * @returns {Promise<Object|null>} Enriched season data or null\n   */\n  async function getSeasonEnriched(tvId, seasonNumber, options = {}){\n    if(tvId == null || seasonNumber == null) return null;\n    const cacheKey = `tmdb:tv:${tvId}:season:${seasonNumber}:v1`;\n    const ttl = options.ttlHours ?? config.ttlHours;\n    return fetchWithCache(cacheKey, ttl, async ()=>{\n      const append = combineAppend(defaultAppend.season, options.append);\n      const detail = await client.get(`/tv/${tvId}/season/${seasonNumber}`, {\n        append_to_response: append,\n      }, {\n        language: options.language ?? config.language,\n        region: options.region ?? config.region,\n      });\n      let show = options.show || null;\n      if(!show && !options.skipShowLookup){\n        try{\n          show = await getTvEnriched(tvId, { ttlHours: ttl });\n        }catch(err){\n          log.warn('Failed to load parent show for season', tvId, seasonNumber, err?.message || err);\n          // Provide minimal show object as fallback\n          show = { id: tvId, name: '', type: 'tv' };\n        }\n      }\n      // Ensure show has at least minimal structure\n      if(!show){\n        show = { id: tvId, name: '', type: 'tv' };\n      }\n      return mapSeasonDetail(detail, {\n        imageBase: config.imageBase,\n        posterSize: options.posterSize,\n        backdropSize: options.backdropSize,\n        profileSize: options.profileSize,\n        logoSize: options.logoSize,\n        show,\n      });\n    });\n  }\n\n  return {\n    getMovieEnriched,\n    getTvEnriched,\n    getSeasonEnriched,\n  };\n}\n\nexport function createMetadataService(inputOptions = {}){\n  const config = normaliseConfig(inputOptions);\n  const cache = inputOptions.cacheStore || createCacheStore({ storageKey: inputOptions.storageKey });\n  const client = createTmdbClient({\n    apiBase: inputOptions.apiBase || config.apiBase,\n    apiKey: config.apiKey,\n    token: config.token,\n    language: config.language,\n    region: config.region,\n    ttlHours: config.ttlHours,\n  });\n  const log = createLogger();\n  const fetcher = createFetcher(client, cache, config, log);\n\n  return {\n    getMovieEnriched: fetcher.getMovieEnriched,\n    getTvEnriched: fetcher.getTvEnriched,\n    getSeasonEnriched: fetcher.getSeasonEnriched,\n    get client(){ return client; },\n    get cache(){ return cache; },\n    get config(){ return { ...config }; },\n    clear(prefix){ cache.clear(prefix); },\n  };\n}\n\nlet defaultCacheStore = null;\nlet defaultService = null;\n\nfunction ensureDefaultCache(){\n  if(!defaultCacheStore){\n    defaultCacheStore = createCacheStore();\n  }\n  return defaultCacheStore;\n}\n\nfunction ensureDefaultService(){\n  if(!defaultService){\n    defaultService = createMetadataService({ cacheStore: ensureDefaultCache() });\n  }\n  return defaultService;\n}\n\nexport function configureMetadataServiceDefaults(options = {}){\n  const merged = { ...options };\n  if(!merged.cacheStore){\n    merged.cacheStore = ensureDefaultCache();\n  }\n  defaultService = createMetadataService(merged);\n  return defaultService;\n}\n\nfunction readStoredToken(){\n  try{\n    const token = localStorage.getItem('tmdbToken');\n    if(token && token.trim()){\n      return token.trim();\n    }\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to read tmdbToken from storage:`, err?.message || err);\n  }\n  return '';\n}\n\nexport function syncDefaultMetadataService(cfg = {}, overrides = {}){\n  try{\n    const {\n      preferStoredToken = true,\n      token: overrideToken,\n      apiKey: overrideApiKey,\n      language: overrideLanguage,\n      region: overrideRegion,\n      ttlHours: overrideTtl,\n      imageBase: overrideImageBase,\n    } = overrides || {};\n\n    const options = {};\n    const lang = overrideLanguage || cfg.lang || cfg.language;\n    if(lang) options.language = lang;\n    const region = overrideRegion || cfg.region || cfg.iso;\n    if(region) options.region = region;\n    const ttlCandidates = [overrideTtl, cfg.ttlHours, cfg.tmdbTtlHours];\n    for(const candidate of ttlCandidates){\n      if(candidate === undefined || candidate === null) continue;\n      if(typeof candidate === 'string' && candidate.trim() === '') continue;\n      const ttlNum = Number(candidate);\n      if(Number.isFinite(ttlNum)){\n        options.ttlHours = ttlNum;\n        break;\n      }\n    }\n    const imageBase = overrideImageBase || cfg.imageBase || cfg.tmdbImageBase;\n    if(imageBase) options.imageBase = imageBase;\n\n    let token = typeof overrideToken === 'string' ? overrideToken.trim() : (overrideToken ?? '');\n    if(typeof token !== 'string') token = '';\n    if(!token && preferStoredToken){\n      token = readStoredToken();\n    }\n    if(!token && typeof cfg.tmdbToken === 'string'){\n      token = cfg.tmdbToken.trim();\n    }\n\n    let apiKey = typeof overrideApiKey === 'string' ? overrideApiKey.trim() : (overrideApiKey ?? '');\n    if(typeof apiKey !== 'string') apiKey = '';\n    if(!apiKey && typeof cfg.tmdbApiKey === 'string'){\n      apiKey = cfg.tmdbApiKey.trim();\n    }\n\n    if(token){\n      options.token = token;\n    }else if(apiKey){\n      options.apiKey = apiKey;\n    }\n\n    configureMetadataServiceDefaults(options);\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to sync default metadata service:`, err?.message || err);\n  }\n}\n\nexport const getMovieEnriched = (...args) => ensureDefaultService().getMovieEnriched(...args);\nexport const getTvEnriched = (...args) => ensureDefaultService().getTvEnriched(...args);\nexport const getSeasonEnriched = (...args) => ensureDefaultService().getSeasonEnriched(...args);\n\nconst metadataServiceFacade = {\n  getMovieEnriched: (...args) => ensureDefaultService().getMovieEnriched(...args),\n  getTvEnriched: (...args) => ensureDefaultService().getTvEnriched(...args),\n  getSeasonEnriched: (...args) => ensureDefaultService().getSeasonEnriched(...args),\n  clear(prefix){\n    return ensureDefaultService().clear(prefix);\n  },\n  configure: configureMetadataServiceDefaults,\n  sync: syncDefaultMetadataService,\n};\n\nObject.defineProperties(metadataServiceFacade, {\n  client: {\n    get(){\n      return ensureDefaultService().client;\n    },\n  },\n  cache: {\n    get(){\n      return ensureDefaultService().cache;\n    },\n  },\n  config: {\n    get(){\n      return ensureDefaultService().config;\n    },\n  },\n});\n\nexport default metadataServiceFacade;\n", "import metadataService from '../metadataService.js';\nimport { urlEpisode, makeInitials } from '../imageHelper.js';\nimport { runtimeText } from './formatting.js';\n\nconst LOG_PREFIX = '[modalV3/seasons]';\nlet seasonInstanceCounter = 0;\n\nfunction ensureContainer(target){\n  if(!target) return null;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(elementCtor && target instanceof elementCtor) return target;\n  if(elementCtor && target.root instanceof elementCtor) return target.root;\n  if(elementCtor && target.content instanceof elementCtor) return target.content;\n  return null;\n}\n\nfunction asArray(value){\n  return Array.isArray(value) ? value : [];\n}\n\nfunction sanitizeText(value){\n  if(value == null) return '';\n  const str = String(value);\n  return str.trim();\n}\n\nfunction resolveSeasonNumber(season, fallback){\n  const candidates = [\n    season?.seasonNumber,\n    season?.number,\n    season?.index,\n    season?.season,\n    season?.season_index,\n    season?.season_number,\n  ];\n  for(const candidate of candidates){\n    const num = Number(candidate);\n    if(Number.isFinite(num)) return num;\n  }\n  return fallback;\n}\n\nfunction resolveShowIdentifiers(viewModel){\n  const item = viewModel?.item || {};\n  const tmdb = viewModel?.tmdb || item?.tmdbDetail || item?.tmdb || {};\n  const ids = item?.ids || {};\n  const tmdbId = (\n    tmdb?.id ??\n    tmdb?.ids?.tmdb ??\n    item?.tmdbId ??\n    ids?.tmdb ??\n    item?.parent?.ids?.tmdb ??\n    null\n  );\n  const name = sanitizeText(viewModel?.title) || sanitizeText(tmdb?.name) || sanitizeText(item?.title) || '';\n  return {\n    tmdbId: tmdbId != null ? String(tmdbId).trim() || null : null,\n    show: tmdb?.id ? tmdb : { id: tmdbId ?? item?.tmdbId ?? '', name },\n  };\n}\n\nfunction buildSeasonMeta(season){\n  const parts = [];\n  const year = sanitizeText(season?.year) || sanitizeText(season?.airDate);\n  if(year) parts.push(year);\n  const count = Number(season?.episodeCount);\n  if(Number.isFinite(count) && count >= 0){\n    const suffix = count === 1 ? 'Episode' : 'Episoden';\n    parts.push(`${count} ${suffix}`);\n  }\n  return parts.join(' \u2022 ');\n}\n\nfunction createPoster(season){\n  const figure = document.createElement('div');\n  figure.className = 'v3-season-card__thumb';\n  const posterUrl = sanitizeText(season?.poster?.url || season?.poster);\n  const alt = sanitizeText(season?.title) || 'Staffelposter';\n  if(posterUrl){\n    const img = new Image();\n    img.decoding = 'async';\n    img.loading = 'lazy';\n    img.src = posterUrl;\n    img.alt = alt;\n    figure.append(img);\n  }else{\n    figure.dataset.state = 'empty';\n    const initials = document.createElement('span');\n    initials.textContent = makeInitials(alt, 2) || '\u2205';\n    figure.append(initials);\n  }\n  return figure;\n}\n\nfunction buildSeasonSummary(season){\n  const summary = sanitizeText(season?.overview);\n  if(!summary) return null;\n  const paragraph = document.createElement('p');\n  paragraph.className = 'v3-season-card__summary';\n  paragraph.textContent = summary;\n  return paragraph;\n}\n\nfunction setExpanded(card, button, panel, expanded){\n  const isExpanded = Boolean(expanded);\n  card.classList.toggle('is-open', isExpanded);\n  button.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');\n  panel.hidden = !isExpanded;\n  panel.setAttribute('aria-hidden', isExpanded ? 'false' : 'true');\n}\n\nfunction combineEpisodeData(ep){\n  const tmdb = ep?.tmdb || {};\n  const seasonNumber = resolveSeasonNumber(ep, resolveSeasonNumber(tmdb, null));\n  const episodeNumber = (()=>{\n    const candidates = [\n      ep?.episodeNumber,\n      ep?.number,\n      ep?.index,\n      ep?.episode,\n      tmdb?.episodeNumber,\n    ];\n    for(const candidate of candidates){\n      const num = Number(candidate);\n      if(Number.isFinite(num)) return num;\n    }\n    return null;\n  })();\n  const code = (ep?.seasonEpisode && String(ep.seasonEpisode))\n    || (Number.isFinite(seasonNumber) && Number.isFinite(episodeNumber)\n      ? `S${String(seasonNumber).padStart(2, '0')}E${String(episodeNumber).padStart(2, '0')}`\n      : '');\n  const durationMin = (()=>{\n    const candidates = [\n      ep?.durationMin,\n      ep?.duration,\n      tmdb?.runtime,\n    ];\n    for(const candidate of candidates){\n      const num = Number(candidate);\n      if(Number.isFinite(num) && num > 0){\n        return num > 500 ? Math.round(num / 60000) : Math.round(num);\n      }\n    }\n    return null;\n  })();\n  const runtimeTextValue = Number.isFinite(durationMin) && durationMin > 0\n    ? runtimeText({ runtimeMin: durationMin })\n    : '';\n  const rating = (()=>{\n    const candidates = [\n      tmdb?.voteAverage,\n      ep?.rating,\n      ep?.audienceRating,\n      ep?.score,\n    ];\n    for(const candidate of candidates){\n      const num = Number(candidate);\n      if(Number.isFinite(num) && num > 0) return num;\n    }\n    return null;\n  })();\n  const airDate = sanitizeText(tmdb?.airDate || ep?.airDate || ep?.originallyAvailableAt || ep?.date);\n  const overview = sanitizeText(tmdb?.overview || ep?.overview || ep?.summary || ep?.description || ep?.plot);\n  const stillPath = tmdb?.stillPath || ep?.tmdbStillPath || ep?.stillPath;\n  const stillUrl = tmdb?.still || ep?.tmdbStill || ep?.still || ep?.thumbFile || ep?.thumb;\n  const title = sanitizeText(tmdb?.name || ep?.title || ep?.name);\n  return {\n    title,\n    code,\n    runtimeText: runtimeTextValue,\n    rating,\n    overview,\n    airDate,\n    stillPath,\n    stillUrl,\n  };\n}\n\nexport function createEpisodeStill(data, context = {}){\n  const wrapper = document.createElement('div');\n  wrapper.className = 'v3-episode__still';\n  const alt = data.title || context.showTitle || 'Episode';\n  if(data.stillPath){\n    const small = urlEpisode(data.stillPath, { size: 'w300', title: alt });\n    const medium = urlEpisode(data.stillPath, { size: 'w780', title: alt });\n    const img = new Image();\n    img.decoding = 'async';\n    img.loading = 'lazy';\n    img.src = small;\n    img.srcset = `${small} 300w, ${medium} 780w`;\n    img.alt = alt;\n    wrapper.append(img);\n    return wrapper;\n  }\n  if(data.stillUrl){\n    const img = new Image();\n    img.decoding = 'async';\n    img.loading = 'lazy';\n    img.src = data.stillUrl;\n    img.alt = alt;\n    wrapper.append(img);\n    return wrapper;\n  }\n  wrapper.dataset.state = 'empty';\n  const placeholder = document.createElement('span');\n  placeholder.className = 'v3-episode__initials';\n  placeholder.textContent = makeInitials(alt, 2) || '\u2205';\n  wrapper.append(placeholder);\n  return wrapper;\n}\n\nfunction buildEpisodeTitle(data){\n  const parts = [];\n  if(data.code) parts.push(data.code);\n  if(data.title) parts.push(data.title);\n  return parts.join(' \u2022 ');\n}\n\nfunction formatRating(value){\n  if(!Number.isFinite(value)) return '';\n  return value >= 10 ? value.toFixed(0) : value.toFixed(1);\n}\n\nfunction createBadge(text, variant){\n  if(!text) return null;\n  const badge = document.createElement('span');\n  badge.className = 'v3-episode__badge';\n  if(variant) badge.dataset.variant = variant;\n  badge.textContent = text;\n  return badge;\n}\n\nfunction createEpisodeRow(ep, context){\n  const data = combineEpisodeData(ep);\n  const row = document.createElement('article');\n  row.className = 'v3-episode';\n\n  const media = createEpisodeStill(data, context);\n  row.append(media);\n\n  const body = document.createElement('div');\n  body.className = 'v3-episode__body';\n\n  const header = document.createElement('div');\n  header.className = 'v3-episode__header';\n  const title = document.createElement('h4');\n  title.className = 'v3-episode__title';\n  title.textContent = buildEpisodeTitle(data) || 'Episode';\n  header.append(title);\n\n  const badges = document.createElement('div');\n  badges.className = 'v3-episode__badges';\n  const runtimeBadge = createBadge(data.runtimeText, 'runtime');\n  const ratingBadge = createBadge(formatRating(data.rating), 'rating');\n  if(runtimeBadge) badges.append(runtimeBadge);\n  if(ratingBadge) badges.append(ratingBadge);\n  if(badges.childElementCount) header.append(badges);\n\n  const meta = document.createElement('p');\n  meta.className = 'v3-episode__meta';\n  meta.textContent = [data.airDate, data.runtimeText].filter(Boolean).join(' \u2022 ');\n\n  const overview = document.createElement('p');\n  overview.className = 'v3-episode__overview';\n  overview.textContent = data.overview || 'Keine Beschreibung verf\u00FCgbar.';\n\n  body.append(header, meta, overview);\n  row.append(body);\n  return row;\n}\n\nfunction renderEpisodeList(container, episodes, context){\n  container.replaceChildren();\n  const list = asArray(episodes);\n  if(!list.length){\n    const fallback = document.createElement('p');\n    fallback.className = 'v3-episode__empty';\n    fallback.textContent = 'Keine Episoden verf\u00FCgbar.';\n    container.append(fallback);\n    return;\n  }\n  list.forEach(ep => container.append(createEpisodeRow(ep, context)));\n}\n\nfunction attachKeyboardNavigation(container){\n  if(!container || container.dataset?.accordionReady === '1') return;\n  container.dataset.accordionReady = '1';\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  container.addEventListener('keydown', event => {\n    if(!elementCtor) return;\n    const target = event.target instanceof elementCtor ? event.target : null;\n    if(!target || typeof target.matches !== 'function' || !target.matches('[data-season-toggle]')) return;\n    const toggles = Array.from(container.querySelectorAll('[data-season-toggle]'));\n    if(!toggles.length) return;\n    const currentIndex = toggles.indexOf(target);\n    if(currentIndex === -1) return;\n    if(event.key === 'ArrowDown' || event.key === 'ArrowRight'){\n      event.preventDefault();\n      const next = toggles[(currentIndex + 1) % toggles.length];\n      next?.focus();\n    }else if(event.key === 'ArrowUp' || event.key === 'ArrowLeft'){\n      event.preventDefault();\n      const prev = toggles[(currentIndex - 1 + toggles.length) % toggles.length];\n      prev?.focus();\n    }else if(event.key === 'Home'){\n      event.preventDefault();\n      toggles[0]?.focus();\n    }else if(event.key === 'End'){\n      event.preventDefault();\n      toggles[toggles.length - 1]?.focus();\n    }\n  });\n}\n\nfunction createSeasonCard(season, index, context){\n  const card = document.createElement('article');\n  card.className = 'v3-season-card';\n  const headingId = `v3-season-${seasonInstanceCounter += 1}-header`;\n  const panelId = `v3-season-${seasonInstanceCounter}-panel`;\n\n  const heading = document.createElement('h3');\n  heading.className = 'v3-season-card__heading';\n\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.className = 'v3-season-card__button';\n  button.dataset.seasonToggle = '1';\n  button.id = headingId;\n  button.setAttribute('aria-expanded', 'false');\n  button.setAttribute('aria-controls', panelId);\n\n  const poster = createPoster(season);\n  const label = document.createElement('div');\n  label.className = 'v3-season-card__label';\n  const title = document.createElement('span');\n  title.className = 'v3-season-card__title';\n  title.textContent = sanitizeText(season?.title) || `Staffel ${resolveSeasonNumber(season, index + 1)}`;\n  const meta = document.createElement('span');\n  meta.className = 'v3-season-card__meta';\n  meta.textContent = buildSeasonMeta(season);\n  label.append(title, meta);\n\n  const chevron = document.createElement('span');\n  chevron.className = 'v3-season-card__chevron';\n  chevron.setAttribute('aria-hidden', 'true');\n  chevron.textContent = '\u203A';\n\n  button.append(poster, label, chevron);\n  heading.append(button);\n\n  const panel = document.createElement('div');\n  panel.id = panelId;\n  panel.className = 'v3-season-card__panel';\n  panel.setAttribute('role', 'region');\n  panel.setAttribute('aria-labelledby', headingId);\n  panel.hidden = true;\n  panel.setAttribute('aria-hidden', 'true');\n\n  const summary = buildSeasonSummary(season);\n  if(summary) panel.append(summary);\n  const episodesRoot = document.createElement('div');\n  episodesRoot.className = 'v3-episode-list';\n  panel.append(episodesRoot);\n\n  const initialEpisodes = asArray(season?.episodes);\n  if(initialEpisodes.length){\n    renderEpisodeList(episodesRoot, initialEpisodes, { showTitle: context.showTitle });\n  }\n\n  let loaded = Boolean(initialEpisodes.length);\n  let loading = false;\n  let abortController = null;\n\n  function applyLoadingState(isLoading){\n    card.classList.toggle('is-loading', isLoading);\n    if(isLoading){\n      panel.dataset.loading = 'true';\n      episodesRoot.replaceChildren();\n      const loadingMessage = document.createElement('p');\n      loadingMessage.className = 'v3-episode__loading';\n      loadingMessage.textContent = 'Episoden werden geladen \u2026';\n      episodesRoot.append(loadingMessage);\n    }else{\n      delete panel.dataset.loading;\n    }\n  }\n\n  function cancelRequest(){\n    if(abortController && !abortController.signal.aborted){\n      abortController.abort();\n    }\n    abortController = null;\n  }\n\n  function fetchEpisodes(){\n    if(loaded || loading) return;\n    const seasonNumber = resolveSeasonNumber(season, index + 1);\n    if(!context.tmdbId || seasonNumber == null){\n      loaded = true;\n      renderEpisodeList(episodesRoot, initialEpisodes, { showTitle: context.showTitle });\n      return;\n    }\n    if(!metadataService || typeof metadataService.getSeasonEnriched !== 'function'){\n      loaded = true;\n      renderEpisodeList(episodesRoot, initialEpisodes, { showTitle: context.showTitle });\n      return;\n    }\n    loading = true;\n    applyLoadingState(true);\n    abortController = typeof AbortController === 'function' ? new AbortController() : null;\n    metadataService.getSeasonEnriched(context.tmdbId, seasonNumber, { stillSize: 'w300', show: context.show })\n      .then(detail => {\n        if(abortController?.signal.aborted) return;\n        const episodes = asArray(detail?.episodes);\n        if(episodes.length){\n          season.episodes = episodes;\n          renderEpisodeList(episodesRoot, episodes, { showTitle: context.showTitle });\n        }else{\n          renderEpisodeList(episodesRoot, [], { showTitle: context.showTitle });\n        }\n        loaded = true;\n      })\n      .catch(err => {\n        if(abortController?.signal.aborted) return;\n        console.warn(LOG_PREFIX, 'Failed to enrich season', context.tmdbId, seasonNumber, err?.message || err);\n        renderEpisodeList(episodesRoot, initialEpisodes, { showTitle: context.showTitle });\n        loaded = true;\n      })\n      .finally(() => {\n        loading = false;\n        applyLoadingState(false);\n        abortController = null;\n      });\n  }\n\n  function toggle(){\n    const expanded = button.getAttribute('aria-expanded') === 'true';\n    const next = !expanded;\n    setExpanded(card, button, panel, next);\n    if(next) fetchEpisodes();\n  }\n\n  button.addEventListener('click', () => {\n    toggle();\n  });\n\n  button.addEventListener('keydown', event => {\n    if(event.key === ' ' || event.key === 'Spacebar' || event.key === 'Enter'){\n      event.preventDefault();\n      toggle();\n    }\n  });\n\n  card._cleanup = () => {\n    cancelRequest();\n  };\n\n  card.append(heading, panel);\n  return card;\n}\n\nexport function renderSeasons(target, viewModel){\n  if(typeof document === 'undefined') return;\n  const container = ensureContainer(target);\n  if(!container) return;\n  seasonInstanceCounter = 0;\n  const seasons = asArray(viewModel?.seasons);\n  container.classList.add('v3-seasons');\n  container.replaceChildren();\n\n  if(!seasons.length){\n    const fallback = document.createElement('p');\n    fallback.className = 'v3-seasons__empty';\n    fallback.textContent = 'Keine Staffelinformationen verf\u00FCgbar.';\n    container.append(fallback);\n    return;\n  }\n\n  const { tmdbId, show } = resolveShowIdentifiers(viewModel || {});\n  const context = {\n    tmdbId,\n    show,\n    showTitle: sanitizeText(viewModel?.title) || sanitizeText(show?.name),\n  };\n\n  const cards = seasons.map((season, index) => createSeasonCard(season, index, context));\n  cards.forEach(card => container.append(card));\n  attachKeyboardNavigation(container);\n}\n\nexport default renderSeasons;\n", "const TAB_SELECTOR = '[data-tab]';\n\nfunction getButtons(container){\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(!container || (elementCtor && !(container instanceof elementCtor))) return [];\n  return Array.from(container.querySelectorAll(TAB_SELECTOR)).filter(btn => {\n    return btn instanceof elementCtor;\n  });\n}\n\nfunction resolvePanel(root, button){\n  if(!root || !button) return null;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  const doc = root.ownerDocument || (elementCtor && root instanceof elementCtor ? root.ownerDocument : null) || (typeof document !== 'undefined' ? document : null);\n  const controlId = button.getAttribute('aria-controls');\n  if(controlId && doc){\n    const byId = doc.getElementById(controlId);\n    if(byId && (!root.contains || root.contains(byId))) return byId;\n  }\n  const dataTab = button.dataset ? (button.dataset.tab || button.dataset.pane) : '';\n  if(dataTab){\n    const selector = `[data-pane=\"${dataTab}\"]`;\n    const withinRoot = root.querySelector(selector);\n    if(withinRoot) return withinRoot;\n  }\n  if(controlId && doc){\n    try{\n      const fallback = doc.querySelector(`[data-pane=\"${controlId}\"]`);\n      if(fallback) return fallback;\n    }catch(err){\n      console.warn('[modalV3/tabs] Failed to query panel for control:', controlId, err?.message || err);\n    }\n  }\n  return null;\n}\n\nfunction selectButton(root, buttons, target){\n  if(!buttons.length) return;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  const targetButton = typeof target === 'string'\n    ? buttons.find(btn => (btn.dataset?.tab === target) || (btn.getAttribute('aria-controls') === target))\n    : target;\n  if(!targetButton || (elementCtor && !(targetButton instanceof elementCtor))) return;\n\n  buttons.forEach(btn => {\n    const isActive = btn === targetButton;\n    btn.classList.toggle('active', isActive);\n    btn.setAttribute('aria-selected', isActive ? 'true' : 'false');\n    btn.tabIndex = isActive ? 0 : -1;\n    const panel = resolvePanel(root, btn);\n    if(panel){\n      panel.classList.toggle('is-hidden', !isActive);\n      if(isActive){\n        panel.hidden = false;\n        panel.setAttribute('aria-hidden', 'false');\n      }else{\n        panel.hidden = true;\n        panel.setAttribute('aria-hidden', 'true');\n      }\n    }\n  });\n}\n\nfunction moveFocus(root, buttons, current, delta){\n  if(!buttons.length || !current) return;\n  const currentIndex = buttons.indexOf(current);\n  const fallbackIndex = delta > 0 ? 0 : buttons.length - 1;\n  const nextIndex = currentIndex === -1\n    ? fallbackIndex\n    : (currentIndex + delta + buttons.length) % buttons.length;\n  const nextButton = buttons[nextIndex];\n  if(nextButton){\n    focusButton(nextButton);\n    selectButton(root, buttons, nextButton);\n  }\n}\n\nfunction focusButton(button){\n  if(!button) return;\n  const doc = button.ownerDocument || (typeof document !== 'undefined' ? document : null);\n  if(typeof button.focus === 'function'){\n    button.focus();\n  }\n  if(doc && doc.activeElement !== button){\n    try{\n      doc.activeElement = button;\n    }catch(_err){\n      // ignore assignment errors (read-only in some environments)\n    }\n  }\n}\n\nexport function applyTabs(root){\n  if(!root) return;\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  const scope = (elementCtor && root instanceof elementCtor) ? root : root.root || root;\n  if(!scope || (elementCtor && !(scope instanceof elementCtor))) return;\n  const containers = Array.from(scope.querySelectorAll('.v3-tabs'));\n  containers.forEach(container => {\n    if(!container || container.dataset?.tabsReady === '1') return;\n    const buttons = getButtons(container);\n    if(!buttons.length) return;\n    container.dataset.tabsReady = '1';\n    if(!container.hasAttribute('role')) container.setAttribute('role', 'tablist');\n    buttons.forEach(btn => {\n      if(!btn.hasAttribute('role')) btn.setAttribute('role', 'tab');\n      if(!btn.hasAttribute('type')) btn.setAttribute('type', 'button');\n    });\n\n    container.addEventListener('click', ev => {\n      const target = ev.target && typeof ev.target.closest === 'function'\n        ? ev.target.closest(TAB_SELECTOR)\n        : null;\n      if(!target || !buttons.includes(target)) return;\n      ev.preventDefault();\n      selectButton(scope, buttons, target);\n    });\n\n    container.addEventListener('keydown', ev => {\n      const target = ev.target && typeof ev.target.closest === 'function'\n        ? ev.target.closest(TAB_SELECTOR)\n        : null;\n      if(!target || !buttons.includes(target)) return;\n      switch(ev.key){\n        case 'ArrowLeft':\n        case 'ArrowUp':\n          ev.preventDefault();\n          moveFocus(scope, buttons, target, -1);\n          break;\n        case 'ArrowRight':\n        case 'ArrowDown':\n          ev.preventDefault();\n          moveFocus(scope, buttons, target, 1);\n          break;\n        case 'Home':\n          ev.preventDefault();\n          if(buttons[0]){\n            focusButton(buttons[0]);\n            selectButton(scope, buttons, buttons[0]);\n          }\n          break;\n        case 'End':\n          ev.preventDefault();\n          if(buttons.length){\n            const last = buttons[buttons.length - 1];\n            focusButton(last);\n            selectButton(scope, buttons, last);\n          }\n          break;\n        default:\n          break;\n      }\n    });\n\n    const initiallySelected = buttons.find(btn => btn.getAttribute('aria-selected') === 'true') || buttons[0];\n    selectButton(scope, buttons, initiallySelected);\n  });\n}\n\nexport default applyTabs;\n", "import { prefixShowThumb } from '../data.js';\n\nconst GUID_PATTERNS = {\n  tmdb: [\n    'tmdb://',\n    'themoviedb://',\n    'com.plexapp.agents.themoviedb://'\n  ],\n  imdb: [\n    'imdb://',\n    'com.plexapp.agents.imdb://'\n  ],\n  tvdb: [\n    'tvdb://',\n    'thetvdb://',\n    'com.plexapp.agents.thetvdb://'\n  ]\n};\n\nfunction isObject(value){\n  return value !== null && typeof value === 'object';\n}\n\nfunction parseGuidEntry(entry){\n  const raw = isObject(entry) ? (entry.id ?? entry.guid ?? '') : entry;\n  const str = typeof raw === 'string' ? raw.trim() : '';\n  if(!str) return {};\n  const lower = str.toLowerCase();\n  const result = {};\n  for(const [key, patterns] of Object.entries(GUID_PATTERNS)){\n    if(result[key]) continue;\n    for(const pattern of patterns){\n      const marker = pattern.toLowerCase();\n      const idx = lower.indexOf(marker);\n      if(idx === -1) continue;\n      const start = idx + marker.length;\n      let value = str.slice(start);\n      value = value.replace(/^\\/+/, '');\n      value = value.split(/[?#]/)[0];\n      if(!value) continue;\n      if(value.includes('/')){\n        const parts = value.split('/');\n        value = parts.find(Boolean) || '';\n      }\n      value = value.trim();\n      if(value){\n        result[key] = value;\n        break;\n      }\n    }\n  }\n  return result;\n}\n\nfunction ensureIds(target){\n  if(!target || typeof target !== 'object') return target;\n  const ids = { ...(target.ids || {}) };\n  const assign = (key, value)=>{\n    if(ids[key]) return;\n    const str = value == null ? '' : String(value).trim();\n    if(str) ids[key] = str;\n  };\n\n  assign('tmdb', target.tmdbId);\n  assign('tmdb', target?.tmdb?.id);\n  assign('imdb', target.imdbId);\n  assign('imdb', target?.tmdb?.imdbId);\n  assign('tvdb', target.tvdbId);\n  assign('tvdb', target?.tmdb?.tvdbId);\n\n  const guidSources = [];\n  if(Array.isArray(target?.guids)) guidSources.push(...target.guids);\n  if(target?.guid) guidSources.push(target.guid);\n\n  guidSources.forEach(source=>{\n    const parsed = parseGuidEntry(source);\n    Object.entries(parsed).forEach(([key, value])=> assign(key, value));\n  });\n\n  if(Object.keys(ids).length){\n    target.ids = ids;\n    if(ids.tmdb && !target.tmdbId){\n      target.tmdbId = ids.tmdb;\n    }\n  }\n  return target;\n}\n\nfunction deepClone(value){\n  if(value == null || typeof value !== 'object') return value;\n  if(typeof structuredClone === 'function'){\n    try{ return structuredClone(value); }\n    catch(err){ console.warn('[modalV3/mapping] structuredClone failed, falling back to JSON clone:', err?.message || err); }\n  }\n  try{ return JSON.parse(JSON.stringify(value)); }\n  catch(err){ console.warn('[modalV3/mapping] JSON clone failed, falling back to manual clone:', err?.message || err); }\n  if(Array.isArray(value)) return value.map(entry => deepClone(entry));\n  const out = {};\n  for(const key of Object.keys(value)){\n    out[key] = deepClone(value[key]);\n  }\n  return out;\n}\n\nexport function mapMovie(item){\n  if(!item || typeof item !== 'object') return null;\n  const clone = deepClone(item);\n  if(clone.type === 'show') clone.type = 'tv';\n  if(!clone.type) clone.type = 'movie';\n  ensureIds(clone);\n  return clone;\n}\n\nexport function mapShow(item){\n  if(!item || typeof item !== 'object') return null;\n  const clone = deepClone(item);\n  if(clone.type !== 'tv') clone.type = 'tv';\n  ensureIds(clone);\n  normalizeShow(clone);\n  return clone;\n}\n\nexport function mapDetail(detail){\n  if(!detail || typeof detail !== 'object') return null;\n  const clone = deepClone(detail);\n  ensureIds(clone);\n  normalizeShow(clone);\n  return clone;\n}\n\nexport function needsShowDetail(item){\n  const seasons = Array.isArray(item?.seasons) ? item.seasons : [];\n  const hasEpisodes = seasons.some(season => Array.isArray(season?.episodes) && season.episodes.length);\n  const cast = Array.isArray(item?.cast) ? item.cast : Array.isArray(item?.roles) ? item.roles : [];\n  return !seasons.length || !hasEpisodes || !cast.length;\n}\n\nexport function mergeShowDetail(target, detail){\n  if(!target) return target;\n  if(detail && typeof detail === 'object'){\n    const mapped = mapDetail(detail);\n    Object.assign(target, mapped);\n    ensureIds(target);\n  }\n  normalizeShow(target);\n  return target;\n}\n\nexport function normalizeShow(show){\n  if(!show || typeof show !== 'object') return;\n  normalizeThumbField(show);\n  show.genres = normalizeGenresList(show.genres);\n  const cast = normalizePeopleList(show.cast || show.roles || []);\n  show.cast = cast;\n  show.roles = cast;\n  show.seasons = Array.isArray(show.seasons) ? show.seasons.map(normalizeSeasonEntry).filter(Boolean) : [];\n  const sc = Number(show.seasonCount);\n  show.seasonCount = Number.isFinite(sc) && sc > 0 ? sc : show.seasons.length;\n}\n\nfunction normalizeSeasonEntry(season){\n  if(!season || typeof season !== 'object') return null;\n  const out = { ...season };\n  normalizeThumbField(out);\n  out.genres = normalizeGenresList(out.genres);\n  out.episodes = Array.isArray(out.episodes) ? out.episodes.map(normalizeEpisodeEntry).filter(Boolean) : [];\n  return out;\n}\n\nfunction normalizeEpisodeEntry(ep){\n  if(!ep || typeof ep !== 'object') return null;\n  const out = { ...ep };\n  normalizeThumbField(out);\n  out.genres = normalizeGenresList(out.genres);\n  return out;\n}\n\nfunction normalizeThumbField(obj){\n  prefixShowThumb(obj);\n}\n\nfunction normalizePeopleList(list){\n  if(!Array.isArray(list)) return [];\n  return list.map(entry => {\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      if(!tag) return null;\n      const normalized = { tag, name: tag };\n      prefixShowThumb(normalized);\n      return normalized;\n    }\n    if(!entry || typeof entry !== 'object') return null;\n    const rawName = entry?.tag || entry?.name || entry?.title || '';\n    const name = String(rawName).trim();\n    if(!name) return null;\n    const normalized = {\n      ...entry,\n      tag: name,\n      name,\n    };\n    prefixShowThumb(normalized);\n    return normalized;\n  }).filter(Boolean);\n}\n\nexport function normalizeGenresList(list){\n  if(!Array.isArray(list)) return [];\n  const seen = new Set();\n  const result = [];\n  list.forEach(entry => {\n    let item = null;\n    if(typeof entry === 'string'){\n      const tag = entry.trim();\n      if(tag) item = { tag };\n    }else if(entry && typeof entry === 'object'){\n      const tag = String(entry.tag || entry.title || entry.name || entry.label || '').trim();\n      if(tag){ item = { ...entry, tag }; }\n    }\n    if(item && !seen.has(item.tag)){\n      seen.add(item.tag);\n      result.push(item);\n    }\n  });\n  return result;\n}\n\nexport { normalizePeopleList };\n", "import metadataService from '../metadataService.js';\nimport { runtimeText, ratingText, studioText } from './formatting.js';\nimport { mapMovie, mapShow, mergeShowDetail, normalizeGenresList } from './mapping.js';\nimport { buildFallbackPoster, buildFallbackBackdrop, buildFallbackProfile, makeInitials } from '../imageHelper.js';\n\nconst LOG_PREFIX = '[modalV3/viewModel]';\nconst TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p';\nconst IMAGE_SIZES = {\n  poster: 'w500',\n  backdrop: 'w780',\n  profile: 'w185',\n};\nconst DEFAULT_TABS = {\n  overview: '\u00DCberblick',\n  details: 'Details',\n  cast: 'Besetzung',\n  seasons: 'Staffeln',\n};\n\n/**\n * @typedef {Object} ImageEntry\n * @property {string} url\n * @property {'tmdb'|'local'|'fallback'} source\n * @property {string} [alt]\n */\n\n/**\n * @typedef {Object} BadgeEntry\n * @property {string} id\n * @property {string} label\n * @property {string} text\n * @property {'tmdb'|'local'|'derived'} source\n */\n\n/**\n * @typedef {Object} CastEntry\n * @property {string} id\n * @property {string} name\n * @property {string} subtitle\n * @property {string} role\n * @property {string} character\n * @property {{ url: string, source: 'tmdb'|'local'|'fallback' }} image\n * @property {string} initials\n * @property {'tmdb'|'local'} source\n * @property {number} order\n */\n\n/**\n * @typedef {Object} SeasonSummary\n * @property {string} id\n * @property {number|null} seasonNumber\n * @property {string} title\n * @property {string} overview\n * @property {string} airDate\n * @property {string} year\n * @property {number|null} episodeCount\n * @property {{ url: string, source: 'tmdb'|'local'|'fallback' }} poster\n * @property {'tmdb'|'local'} source\n */\n\n/**\n * @typedef {Object} MediaDetailViewModel\n * @property {'movie'|'show'} kind\n * @property {object} item\n * @property {object|null} tmdb\n * @property {string} title\n * @property {string} originalTitle\n * @property {string} overview\n * @property {string} summary\n * @property {string} tagline\n * @property {string} releaseDate\n * @property {string} year\n * @property {string[]} genres\n * @property {BadgeEntry[]} badges\n * @property {{ id: string, label: string, count?: number }[]} tabs\n * @property {string} defaultTab\n * @property {ImageEntry} poster\n * @property {ImageEntry} backdrop\n * @property {CastEntry[]} cast\n * @property {SeasonSummary[]} seasons\n * @property {{ runtime?: string, rating?: string, tmdbRating?: string, studio?: string, contentRating?: string, seasonCount?: number|null }} meta\n * @property {object|null} watchProviders\n * @property {string} tmdbUrl\n */\n\n/** @type {MediaDetailViewModel} */\nconst __MediaDetailViewModelType = /** @type {MediaDetailViewModel} */ ({});\n/** @type {SeasonSummary} */\nconst __SeasonSummaryType = /** @type {SeasonSummary} */ ({});\n/** @type {CastEntry} */\nconst __CastEntryType = /** @type {CastEntry} */ ({});\n\nfunction isObject(value){\n  return value != null && typeof value === 'object' && !Array.isArray(value);\n}\n\nfunction asArray(value){\n  return Array.isArray(value) ? value : [];\n}\n\nfunction trimString(value){\n  if(typeof value !== 'string') return '';\n  return value.trim();\n}\n\nfunction extractImageCandidate(candidate){\n  if(!candidate) return '';\n  if(typeof candidate === 'string') return candidate;\n  if(Array.isArray(candidate)){\n    for(const entry of candidate){\n      const found = extractImageCandidate(entry);\n      if(found) return found;\n    }\n    return '';\n  }\n  if(isObject(candidate)){\n    return (\n      candidate.url ||\n      candidate.path ||\n      candidate.file_path ||\n      candidate.filePath ||\n      candidate.location ||\n      candidate.poster ||\n      candidate.backdrop ||\n      candidate.profile ||\n      candidate.thumbFile ||\n      candidate.thumb ||\n      candidate.image ||\n      ''\n    );\n  }\n  return '';\n}\n\nfunction normaliseImageUrl(candidate, size){\n  const raw = trimString(extractImageCandidate(candidate));\n  if(!raw) return '';\n  if(/^https?:\\/\\//i.test(raw) || raw.startsWith('data:')) return raw;\n  if(raw.startsWith('//')) return `https:${raw}`;\n  if(raw.startsWith('data/') || raw.startsWith('./') || raw.startsWith('../')) return raw;\n  if(raw.startsWith('assets/')) return raw;\n  if(raw.includes('://')) return raw;\n  if(raw.startsWith('/')) return `${TMDB_IMAGE_BASE}/${size}${raw}`;\n  if(raw.startsWith('t/p/')){\n    return `${TMDB_IMAGE_BASE}/${size}/${raw.slice(4)}`;\n  }\n  if(/^w\\d+\\//.test(raw)){\n    const parts = raw.split('/');\n    const suffix = parts.slice(1).join('/');\n    return suffix ? `${TMDB_IMAGE_BASE}/${size}/${suffix}` : `${TMDB_IMAGE_BASE}/${size}`;\n  }\n  return raw;\n}\n\nfunction selectImage(candidates, fallbackBuilder, size, title){\n  for(const candidate of candidates){\n    if(candidate == null) continue;\n    const value = candidate.value !== undefined ? candidate.value : candidate;\n    const url = normaliseImageUrl(value, size);\n    if(url){\n      const source = candidate.source || 'local';\n      return { url, source };\n    }\n  }\n  return { url: fallbackBuilder(title), source: 'fallback' };\n}\n\nfunction firstString(...values){\n  for(const value of values){\n    if(!value) continue;\n    if(typeof value === 'string'){\n      const trimmed = value.trim();\n      if(trimmed) return trimmed;\n    }\n    if(isObject(value)){\n      const str = trimString(value.tag || value.name || value.title || value.label || value.value);\n      if(str) return str;\n    }\n  }\n  return '';\n}\n\nfunction parseYear(value){\n  const str = trimString(value);\n  if(!str) return '';\n  const match = str.match(/(\\d{4})/);\n  if(match) return match[1];\n  const date = new Date(str);\n  const year = date.getFullYear();\n  return Number.isFinite(year) ? String(year) : '';\n}\n\nfunction pickTitle(item, tmdb){\n  return firstString(\n    item?.title,\n    item?.name,\n    item?.grandparentTitle,\n    tmdb?.title,\n    tmdb?.name,\n    tmdb?.originalTitle,\n    tmdb?.originalName,\n    item?.tag,\n    'Unbekannter Titel'\n  );\n}\n\nfunction pickOriginalTitle(item, tmdb){\n  return firstString(\n    item?.originalTitle,\n    item?.originalName,\n    tmdb?.originalTitle,\n    tmdb?.originalName,\n    ''\n  );\n}\n\nfunction pickTagline(item, tmdb){\n  return firstString(\n    tmdb?.tagline,\n    item?.tagline,\n    ''\n  );\n}\n\nfunction pickOverview(item, tmdb){\n  return firstString(\n    tmdb?.overview,\n    item?.summary,\n    item?.overview,\n    item?.plot,\n    ''\n  );\n}\n\nfunction pickSummary(item, tmdb){\n  return firstString(\n    item?.summary,\n    item?.shortSummary,\n    item?.plot,\n    tmdb?.overview,\n    ''\n  );\n}\n\nfunction pickReleaseDate(item, tmdb, kind){\n  if(kind === 'show'){\n    return firstString(\n      item?.originallyAvailableAt,\n      item?.firstAired,\n      item?.premiereDate,\n      tmdb?.firstAirDate,\n      tmdb?.lastAirDate,\n      ''\n    );\n  }\n  return firstString(\n    item?.originallyAvailableAt,\n    item?.releaseDate,\n    item?.availableSince,\n    tmdb?.releaseDate,\n    ''\n  );\n}\n\nfunction pickYear(item, tmdb, kind){\n  const candidates = [\n    item?.year,\n    item?.releaseYear,\n    tmdb?.year,\n    kind === 'show' ? tmdb?.firstAirDate : tmdb?.releaseDate,\n    pickReleaseDate(item, tmdb, kind),\n  ];\n  for(const candidate of candidates){\n    const year = parseYear(candidate);\n    if(year) return year;\n  }\n  return '';\n}\n\nfunction buildPosterEntry(item, tmdb){\n  const title = pickTitle(item, tmdb);\n  const candidates = [\n    { value: tmdb?.poster, source: 'tmdb' },\n    { value: tmdb?.posterPath, source: 'tmdb' },\n    { value: tmdb?.collection?.poster, source: 'tmdb' },\n    { value: item?.tmdbPoster, source: 'tmdb' },\n    { value: item?.poster, source: 'local' },\n    { value: item?.thumbFile, source: 'local' },\n    { value: item?.thumb, source: 'local' },\n    { value: item?.art, source: 'local' },\n  ];\n  const image = selectImage(candidates, buildFallbackPoster, IMAGE_SIZES.poster, title);\n  return { ...image, alt: title };\n}\n\nfunction buildBackdropEntry(item, tmdb){\n  const title = pickTitle(item, tmdb);\n  const candidates = [\n    { value: tmdb?.backdrop, source: 'tmdb' },\n    { value: tmdb?.backdropPath, source: 'tmdb' },\n    { value: tmdb?.collection?.backdrop, source: 'tmdb' },\n    { value: item?.art, source: 'local' },\n    { value: item?.background, source: 'local' },\n    { value: item?.thumb, source: 'local' },\n  ];\n  const image = selectImage(candidates, buildFallbackBackdrop, IMAGE_SIZES.backdrop, title);\n  return { ...image, alt: title };\n}\n\nfunction buildProfileImage(name, candidates){\n  const resolved = selectImage(candidates, buildFallbackProfile, IMAGE_SIZES.profile, name || '');\n  return { url: resolved.url, source: resolved.source };\n}\n\nfunction createBadge(id, label, text, source = 'derived'){\n  const cleaned = trimString(text);\n  if(!cleaned) return null;\n  return { id, label, text: cleaned, source };\n}\n\nfunction resolveContentRating(item, tmdb){\n  return firstString(\n    tmdb?.contentRating,\n    item?.contentRating,\n    item?.contentRating?.tag,\n    item?.ratingTag,\n    item?.ratingName,\n    item?.ratingLabel,\n    item?.parentRating,\n    ''\n  );\n}\n\nfunction resolveSeasonCount(item, tmdb){\n  const candidates = [\n    item?.seasonCount,\n    item?.childCount,\n    asArray(item?.seasons).length,\n    tmdb?.numberOfSeasons,\n    asArray(tmdb?.seasons).length,\n  ];\n  for(const candidate of candidates){\n    const num = Number(candidate);\n    if(Number.isFinite(num) && num > 0){\n      return Math.round(num);\n    }\n  }\n  return null;\n}\n\nfunction buildRuntimeBadge(item, tmdb, kind){\n  const runtime = runtimeText({ ...item, tmdbDetail: tmdb || item?.tmdbDetail || null, type: kind === 'show' ? 'tv' : 'movie' });\n  return createBadge('runtime', 'Laufzeit', runtime, 'derived');\n}\n\nfunction buildSeasonBadge(item, tmdb){\n  const count = resolveSeasonCount(item, tmdb);\n  if(!count) return null;\n  const label = count === 1 ? 'Staffel' : 'Staffeln';\n  return createBadge('seasonCount', 'Staffeln', `${count} ${label}`, tmdb?.numberOfSeasons ? 'tmdb' : 'derived');\n}\n\nfunction buildRatingBadge(item, tmdb){\n  const text = ratingText({ ...item, tmdbDetail: tmdb || item?.tmdbDetail || null });\n  const source = item?.rating || item?.audienceRating ? 'local' : 'derived';\n  return createBadge('rating', 'Bewertung', text, source);\n}\n\nfunction formatTmdbRating(tmdb){\n  const rating = Number(tmdb?.voteAverage);\n  if(!Number.isFinite(rating) || rating <= 0) return '';\n  return `${rating.toFixed(1)} / 10`;\n}\n\nfunction buildContentRatingBadge(item, tmdb){\n  const rating = resolveContentRating(item, tmdb);\n  const source = tmdb?.contentRating ? 'tmdb' : item?.contentRating ? 'local' : 'derived';\n  return createBadge('contentRating', 'FSK', rating, source);\n}\n\nfunction buildStudioBadge(item, tmdb, kind){\n  const studio = studioText({ ...item, tmdbDetail: tmdb || item?.tmdbDetail || null, type: kind === 'show' ? 'tv' : 'movie' });\n  if(!trimString(studio)) return null;\n  const source = item?.studio || item?.network ? 'local' : tmdb?.productionCompanies || tmdb?.networks ? 'tmdb' : 'derived';\n  return createBadge('studio', kind === 'show' ? 'Netzwerk' : 'Studio', studio, source);\n}\n\nfunction buildBadges(kind, item, tmdb){\n  const badges = [];\n  const runtimeBadge = buildRuntimeBadge(item, tmdb, kind);\n  if(runtimeBadge) badges.push(runtimeBadge);\n  if(kind === 'show'){\n    const seasonBadge = buildSeasonBadge(item, tmdb);\n    if(seasonBadge) badges.push(seasonBadge);\n  }\n  const ratingBadge = buildRatingBadge(item, tmdb);\n  if(ratingBadge) badges.push(ratingBadge);\n  const contentBadge = buildContentRatingBadge(item, tmdb);\n  if(contentBadge) badges.push(contentBadge);\n  const studioBadge = buildStudioBadge(item, tmdb, kind);\n  if(studioBadge) badges.push(studioBadge);\n  const tmdbBadgeText = formatTmdbRating(tmdb);\n  const tmdbBadge = createBadge('tmdbRating', 'TMDB', tmdbBadgeText, 'tmdb');\n  if(tmdbBadge) badges.push(tmdbBadge);\n  return badges;\n}\n\nfunction buildTabs(kind, { hasCast, seasons }){\n  const tabs = [];\n  tabs.push({ id: 'overview', label: DEFAULT_TABS.overview });\n  tabs.push({ id: 'details', label: DEFAULT_TABS.details });\n  if(kind === 'show'){\n    const count = seasons.length;\n    const label = count ? `${DEFAULT_TABS.seasons} (${count})` : DEFAULT_TABS.seasons;\n    tabs.push({ id: 'seasons', label, count });\n  }\n  if(hasCast){\n    tabs.push({ id: 'cast', label: DEFAULT_TABS.cast, count: hasCast });\n  }\n  return { tabs, defaultTab: tabs[0]?.id || 'overview' };\n}\n\nfunction normalizeCastName(person){\n  return firstString(person?.name, person?.tag, person?.title, person?.role);\n}\n\nfunction normalizeCastRole(person){\n  return firstString(person?.role, person?.character, person?.job, person?.subtitle);\n}\n\nfunction buildCastEntries(item, tmdb){\n  const entries = [];\n  const seen = new Set();\n  const localCast = asArray(item?.cast).length ? asArray(item?.cast) : asArray(item?.roles);\n  const tmdbCredits = asArray(tmdb?.credits?.cast || item?.tmdbDetail?.credits?.cast);\n\n  const pushEntry = (entry)=>{\n    if(!entry || !entry.name) return;\n    const key = `${entry.name.toLowerCase()}::${entry.character || entry.role || ''}`;\n    if(seen.has(key)) return;\n    seen.add(key);\n    entries.push(entry);\n  };\n\n  localCast.forEach((person, index) => {\n    if(!person) return;\n    const name = normalizeCastName(person);\n    const subtitle = normalizeCastRole(person);\n    if(!name) return;\n    const image = buildProfileImage(name, [\n      { value: person?.tmdbProfile, source: 'tmdb' },\n      { value: person?.profile, source: 'tmdb' },\n      { value: person?.profile_path, source: 'tmdb' },\n      { value: person?.profilePath, source: 'tmdb' },\n      { value: person?.thumb, source: 'local' },\n      { value: person?.photo, source: 'local' },\n      { value: person?.image, source: 'local' },\n    ]);\n    const id = trimString(firstString(person?.id, person?.guid, person?.personId, name));\n    pushEntry({\n      id: id || name,\n      name,\n      subtitle: subtitle || '',\n      role: subtitle || '',\n      character: subtitle || '',\n      image,\n      initials: makeInitials(name || subtitle || ''),\n      source: 'local',\n      order: Number.isFinite(Number(person?.order)) ? Number(person.order) : index,\n    });\n  });\n\n  tmdbCredits.forEach((person, index) => {\n    if(!person) return;\n    const name = firstString(person?.name, person?.original_name);\n    if(!name) return;\n    const character = firstString(person?.character, person?.role);\n    const image = buildProfileImage(name, [\n      { value: person?.profile, source: 'tmdb' },\n      { value: person?.profile_path, source: 'tmdb' },\n      { value: person?.profilePath, source: 'tmdb' },\n    ]);\n    const id = trimString(person?.id != null ? String(person.id) : name);\n    pushEntry({\n      id: id || name,\n      name,\n      subtitle: character || trimString(person?.known_for_department),\n      role: character || '',\n      character: character || '',\n      image,\n      initials: makeInitials(name || character || ''),\n      source: 'tmdb',\n      order: Number.isFinite(Number(person?.order)) ? Number(person.order) : 1000 + index,\n    });\n  });\n\n  return entries\n    .sort((a, b) => a.order - b.order)\n    .slice(0, 20)\n    .map(entry => ({\n      ...entry,\n      image: entry.image?.url ? entry.image : { url: buildFallbackProfile(entry.name), source: 'fallback' },\n      initials: entry.initials || makeInitials(entry.name),\n    }));\n}\n\nfunction normalizeSeasonTitle(season, fallbackNumber){\n  return firstString(\n    season?.title,\n    season?.name,\n    season?.label,\n    typeof fallbackNumber === 'number' ? `Staffel ${fallbackNumber}` : ''\n  );\n}\n\nfunction resolveSeasonKey(season){\n  const number = Number(season?.seasonNumber ?? season?.index ?? season?.season ?? season?.season_index ?? season?.season_number);\n  if(Number.isFinite(number)) return `season-${number}`;\n  const id = trimString(firstString(season?.id, season?.guid));\n  if(id) return `id-${id}`;\n  const title = trimString(firstString(season?.title, season?.name));\n  if(title) return `title-${title.toLowerCase()}`;\n  return `season-${Math.random().toString(36).slice(2)}`;\n}\n\nfunction resolveEpisodeCount(season){\n  const fromField = Number(season?.episodeCount ?? season?.childCount ?? season?.episode_count);\n  if(Number.isFinite(fromField) && fromField >= 0) return fromField;\n  const episodes = asArray(season?.episodes);\n  if(episodes.length) return episodes.length;\n  return null;\n}\n\nfunction resolveSeasonPoster(title, season, source){\n  const candidates = [\n    { value: season?.poster, source },\n    { value: season?.posterPath, source },\n    { value: season?.poster_path, source },\n    { value: season?.thumbFile, source: 'local' },\n    { value: season?.thumb, source: 'local' },\n    { value: season?.art, source: 'local' },\n  ];\n  return selectImage(candidates, buildFallbackPoster, IMAGE_SIZES.poster, title);\n}\n\nfunction mergeSeasonEntry(base, update){\n  if(!update) return base;\n  const merged = { ...base };\n  if(!trimString(merged.title)) merged.title = update.title;\n  if(!trimString(merged.overview)) merged.overview = update.overview;\n  if(!trimString(merged.airDate)) merged.airDate = update.airDate;\n  if(!trimString(merged.year)) merged.year = update.year;\n  if(merged.episodeCount == null && update.episodeCount != null) merged.episodeCount = update.episodeCount;\n  if(merged.poster?.source === 'fallback' && update.poster?.url){\n    merged.poster = update.poster;\n  }\n  return merged;\n}\n\nfunction buildSeasonSummaries(show, tmdb){\n  const results = [];\n  const lookup = new Map();\n  const pushSeason = (season, source)=>{\n    if(!season) return;\n    const key = resolveSeasonKey(season);\n    const numberRaw = season?.seasonNumber ?? season?.index ?? season?.season ?? season?.season_index ?? season?.season_number;\n    const seasonNumber = Number.isFinite(Number(numberRaw)) ? Number(numberRaw) : null;\n    const title = normalizeSeasonTitle(season, seasonNumber ?? (results.length + 1)) || (seasonNumber != null ? `Staffel ${seasonNumber}` : 'Staffel');\n    const airDate = firstString(season?.airDate, season?.premiereDate, season?.originallyAvailableAt, season?.air_date);\n    const year = parseYear(season?.year) || parseYear(airDate);\n    const overview = firstString(season?.overview, season?.summary, season?.description);\n    const poster = resolveSeasonPoster(title, season, source);\n    const entry = {\n      id: trimString(firstString(season?.id, season?.guid, `${key}`)) || key,\n      seasonNumber,\n      title,\n      overview,\n      airDate: airDate || '',\n      year: year || '',\n      episodeCount: resolveEpisodeCount(season),\n      poster,\n      source,\n    };\n    if(lookup.has(key)){\n      const existingIndex = lookup.get(key);\n      const existing = results[existingIndex];\n      results[existingIndex] = mergeSeasonEntry(existing, entry);\n    }else{\n      lookup.set(key, results.length);\n      results.push(entry);\n    }\n  };\n\n  asArray(show?.seasons).forEach(season => pushSeason(season, 'local'));\n  asArray(tmdb?.seasons).forEach(season => pushSeason(season, 'tmdb'));\n\n  return results\n    .map(entry => ({\n      ...entry,\n      poster: entry.poster?.url ? entry.poster : { url: buildFallbackPoster(entry.title), source: 'fallback' },\n    }))\n    .sort((a, b) => {\n      if(a.seasonNumber != null && b.seasonNumber != null) return a.seasonNumber - b.seasonNumber;\n      if(a.seasonNumber != null) return -1;\n      if(b.seasonNumber != null) return 1;\n      return a.title.localeCompare(b.title);\n    });\n}\n\nfunction buildGenreList(item, tmdb){\n  const result = [];\n  const seen = new Set();\n  const add = (value)=>{\n    const str = trimString(value);\n    if(!str) return;\n    const key = str.toLowerCase();\n    if(seen.has(key)) return;\n    seen.add(key);\n    result.push(str);\n  };\n  normalizeGenresList(item?.genres).forEach(entry => add(entry?.tag || entry?.name || entry?.title));\n  asArray(item?.genre).forEach(add);\n  asArray(tmdb?.genres).forEach(entry => add(typeof entry === 'string' ? entry : entry?.name || entry?.title));\n  return result;\n}\n\nfunction buildMeta(kind, item, tmdb){\n  const runtime = runtimeText({ ...item, tmdbDetail: tmdb || item?.tmdbDetail || null, type: kind === 'show' ? 'tv' : 'movie' }) || '';\n  const rating = ratingText({ ...item, tmdbDetail: tmdb || item?.tmdbDetail || null }) || '';\n  const tmdbRating = formatTmdbRating(tmdb) || '';\n  const studio = studioText({ ...item, tmdbDetail: tmdb || item?.tmdbDetail || null, type: kind === 'show' ? 'tv' : 'movie' }) || '';\n  const contentRating = resolveContentRating(item, tmdb) || '';\n  const seasonCount = kind === 'show' ? resolveSeasonCount(item, tmdb) : null;\n  return {\n    runtime,\n    rating,\n    tmdbRating,\n    studio,\n    contentRating,\n    seasonCount,\n  };\n}\n\nfunction resolveMovieInput(payload){\n  if(!payload || typeof payload !== 'object') return payload;\n  return payload.item || payload.movie || payload.media || payload;\n}\n\nfunction resolveShowInput(payload){\n  if(!payload || typeof payload !== 'object') return payload;\n  return payload.item || payload.show || payload.media || payload;\n}\n\nasync function fetchTmdbMovie(item, options = {}){\n  const explicit = options.tmdb || options.tmdbDetail;\n  if(explicit) return explicit;\n  if(item?.tmdbDetail) return item.tmdbDetail;\n  const tmdbId = firstString(\n    options.tmdbId,\n    item?.ids?.tmdb,\n    item?.tmdbId,\n    item?.tmdb?.id\n  );\n  if(!tmdbId) return null;\n  if(!metadataService || typeof metadataService.getMovieEnriched !== 'function') return null;\n  try{\n    const detail = await metadataService.getMovieEnriched(tmdbId, {\n      posterSize: IMAGE_SIZES.poster,\n      backdropSize: IMAGE_SIZES.backdrop,\n      profileSize: IMAGE_SIZES.profile,\n    });\n    return detail || null;\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to load TMDB movie detail for`, tmdbId, err?.message || err);\n    return null;\n  }\n}\n\nasync function fetchTmdbShow(item, options = {}){\n  const explicit = options.tmdb || options.tmdbDetail;\n  if(explicit) return explicit;\n  if(item?.tmdbDetail) return item.tmdbDetail;\n  const tmdbId = firstString(\n    options.tmdbId,\n    item?.ids?.tmdb,\n    item?.tmdbId,\n    item?.tmdb?.id\n  );\n  if(!tmdbId) return null;\n  if(!metadataService || typeof metadataService.getTvEnriched !== 'function') return null;\n  try{\n    const detail = await metadataService.getTvEnriched(tmdbId, {\n      posterSize: IMAGE_SIZES.poster,\n      backdropSize: IMAGE_SIZES.backdrop,\n      profileSize: IMAGE_SIZES.profile,\n    });\n    return detail || null;\n  }catch(err){\n    console.warn(`${LOG_PREFIX} Failed to load TMDB show detail for`, tmdbId, err?.message || err);\n    return null;\n  }\n}\n\nfunction normalizeMovieItem(item){\n  if(!item) return null;\n  const mapped = mapMovie(item);\n  if(!mapped) return null;\n  mapped.genres = normalizeGenresList(mapped.genres);\n  return mapped;\n}\n\nfunction normalizeShowItem(item, detail){\n  if(!item) return null;\n  const mapped = mapShow(item);\n  if(detail) mergeShowDetail(mapped, detail);\n  return mapped;\n}\n\nfunction assignTmdbDetail(target, tmdb){\n  if(!target || !tmdb) return;\n  target.tmdbDetail = tmdb;\n}\n\nfunction buildBaseViewModel(kind, item, tmdb){\n  const poster = buildPosterEntry(item, tmdb);\n  const backdrop = buildBackdropEntry(item, tmdb);\n  const cast = buildCastEntries(item, tmdb);\n  const seasons = kind === 'show' ? buildSeasonSummaries(item, tmdb) : [];\n  const { tabs, defaultTab } = buildTabs(kind, { hasCast: cast.length, seasons });\n  const badges = buildBadges(kind, item, tmdb);\n  const meta = buildMeta(kind, item, tmdb);\n  const releaseDate = pickReleaseDate(item, tmdb, kind) || '';\n  const year = pickYear(item, tmdb, kind) || '';\n  const title = pickTitle(item, tmdb);\n  const originalTitle = pickOriginalTitle(item, tmdb);\n  const tagline = pickTagline(item, tmdb);\n  const overview = pickOverview(item, tmdb);\n  const summary = pickSummary(item, tmdb);\n  const genres = buildGenreList(item, tmdb);\n\n  return {\n    kind,\n    item,\n    tmdb,\n    title,\n    originalTitle,\n    overview,\n    summary,\n    tagline,\n    releaseDate,\n    year,\n    genres,\n    badges,\n    tabs,\n    defaultTab,\n    poster,\n    backdrop,\n    cast,\n    seasons,\n    meta,\n    watchProviders: tmdb?.watchProviders?.default || tmdb?.watchProviders || null,\n    tmdbUrl: tmdb?.url || '',\n  };\n}\n\n/**\n * @param {object} payload\n * @param {object} [options]\n * @returns {Promise<MediaDetailViewModel|null>}\n */\nexport async function buildMovieViewModel(payload, options = {}){\n  const rawItem = resolveMovieInput(payload);\n  const item = normalizeMovieItem(rawItem);\n  if(!item) return null;\n  const tmdb = await fetchTmdbMovie(item, { ...options, tmdb: options.tmdb || payload?.tmdb || payload?.tmdbDetail });\n  if(tmdb) assignTmdbDetail(item, tmdb);\n  return buildBaseViewModel('movie', item, tmdb);\n}\n\n/**\n * @param {object} payload\n * @param {object} [options]\n * @returns {Promise<MediaDetailViewModel|null>}\n */\nexport async function buildSeriesViewModel(payload, options = {}){\n  const rawItem = resolveShowInput(payload);\n  const detail = options.detail || payload?.detail || payload?.showDetail || null;\n  const item = normalizeShowItem(rawItem, detail);\n  if(!item) return null;\n  const tmdb = await fetchTmdbShow(item, { ...options, tmdb: options.tmdb || payload?.tmdb || payload?.tmdbDetail });\n  if(tmdb) assignTmdbDetail(item, tmdb);\n  if(detail) mergeShowDetail(item, detail);\n  return buildBaseViewModel('show', item, tmdb);\n}\n\nexport {\n  __MediaDetailViewModelType as MediaDetailViewModel,\n  __SeasonSummaryType as SeasonSummary,\n  __CastEntryType as CastEntry,\n};\n\n", "export const DEMO_MOVIE = {\n  type: 'movie',\n  title: 'Lumen: Der Aufbruch',\n  tagline: 'Eine cineastische Demo f\u00FCr das neue Modal',\n  overview: 'Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\u00FCllt dabei eine Energiequelle, die alles ver\u00E4ndern k\u00F6nnte. Zwischen Loyalit\u00E4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\u00FCr das Cinematic-Layout entworfen wurde.',\n  summary: 'Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\u00E4ndern k\u00F6nnte.',\n  runtimeMin: 142,\n  contentRating: 'FSK 12',\n  studio: 'Aurora Pictures',\n  rating: 8.4,\n  audienceRating: 8.0,\n  userRating: 8.7,\n  originallyAvailableAt: '2024-05-17',\n  countries: [{ tag: 'Deutschland' }, { tag: 'Kanada' }],\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }, { tag: 'Abenteuer' }],\n  cast: [\n    { name: 'Mara Lenz', role: 'Captain Alys Vega', tmdbProfile: '/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg' },\n    { name: 'Tariq Benassi', role: 'Navigator Elian Soh', tmdbProfile: '/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg' },\n    { name: 'Hannah Ko', role: 'Wissenschaftlerin Dr. Mira Han', tmdbProfile: '/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg' },\n  ],\n  directors: [{ tag: 'Jonas Falk' }],\n  writers: [{ tag: 'Lea Winter' }],\n  producers: [{ tag: 'Studio Atlas' }],\n  labels: [{ tag: 'Dolby Atmos' }, { tag: '4K' }],\n  collections: [{ tag: 'Aurora-Saga' }],\n  trailer: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg',\n  ids: { tmdb: 'demo-lumen', imdb: 'tt0000001' },\n  addedAt: '2024-06-01T12:00:00Z',\n};\n\nexport const DEMO_SERIES = {\n  type: 'tv',\n  title: 'Aurora Station',\n  tagline: 'Neue Horizonte in Serie',\n  overview: 'Die Besatzung der Aurora Station sch\u00FCtzt eine Au\u00DFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\u00E4tsel mit pers\u00F6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.',\n  summary: 'Ein orbitaler Au\u00DFenposten ringt um Hoffnung und Zusammenhalt, w\u00E4hrend eine fremde Macht erwacht.',\n  contentRating: 'TV-14',\n  studio: 'Nebula Network',\n  originallyAvailableAt: '2023-09-14',\n  seasonCount: 2,\n  genres: [{ tag: 'Science-Fiction' }, { tag: 'Drama' }],\n  countries: [{ tag: 'USA' }, { tag: 'Island' }],\n  creators: [{ tag: 'Elina S\u00F8rensen' }],\n  cast: [\n    { name: 'Noah Adler', role: 'Commander Ivar Hale', tmdbProfile: '/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg' },\n    { name: 'Sofia Idris', role: 'Ingenieurin Kaia Rhee', tmdbProfile: '/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg' },\n    { name: 'Helena Ruiz', role: 'Strategin Tala Voss', tmdbProfile: '/ziEuG1ESSofxDCspotYlrwz3Tq.png' },\n  ],\n  seasons: [\n    {\n      title: 'Staffel 1',\n      seasonNumber: 1,\n      year: 2023,\n      thumbFile: 'https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg',\n      episodes: [\n        {\n          title: 'Kapitel Eins: Erwachen',\n          seasonNumber: 1,\n          episodeNumber: 1,\n          durationMin: 54,\n          originallyAvailableAt: '2023-09-14',\n          audienceRating: 8.6,\n        },\n        {\n          title: 'Kapitel Zwei: Grenzwelten',\n          seasonNumber: 1,\n          episodeNumber: 2,\n          durationMin: 52,\n          originallyAvailableAt: '2023-09-21',\n          audienceRating: 8.2,\n        },\n      ],\n    },\n    {\n      title: 'Staffel 2',\n      seasonNumber: 2,\n      year: 2024,\n      thumbFile: 'https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg',\n      episodes: [\n        {\n          title: 'Kapitel Dreizehn: Resonanz',\n          seasonNumber: 2,\n          episodeNumber: 1,\n          durationMin: 56,\n          originallyAvailableAt: '2024-02-08',\n          audienceRating: 8.9,\n        },\n        {\n          title: 'Kapitel Vierzehn: Echo',\n          seasonNumber: 2,\n          episodeNumber: 2,\n          durationMin: 55,\n          originallyAvailableAt: '2024-02-15',\n          audienceRating: 8.7,\n        },\n      ],\n    },\n  ],\n  tmdbPoster: 'https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg',\n  ids: { tmdb: 'demo-aurora-station', imdb: 'tt0000002' },\n};\n", "import { openShell, closeShell, getShell, focusInitial } from './shell.js';\nimport { startRender, isCurrentRender, cancelRender, clearActiveItem, captureLastFocused, restoreLastFocused, setActiveItem, getActiveItem } from './state.js';\nimport { createHead, createPosterCard } from './header.js';\nimport { renderOverview } from './overview.js';\nimport { renderDetails } from './details.js';\nimport { renderCast } from './cast.js';\nimport { renderSeasons } from './seasons.js';\nimport { applyTabs } from './tabs.js';\nimport { getState as getAppState } from '../state.js';\nimport { loadMovies, loadShows, loadShowDetail } from '../data.js';\nimport { buildMovieViewModel, buildSeriesViewModel } from './viewModel.js';\n\nfunction normalizeTabId(rawId, index){\n  const fallback = `tab-${index + 1}`;\n  if(rawId == null) return fallback;\n  const str = String(rawId).trim();\n  if(!str) return fallback;\n  return str;\n}\n\nfunction normalizeTabLabel(rawLabel, fallback){\n  if(rawLabel == null) return fallback;\n  const str = String(rawLabel).trim();\n  return str || fallback;\n}\n\nconst LOG_PREFIX = '[modalV3]';\nlet moviesCache = null;\nlet showsCache = null;\nconst demoModule = { promise: null };\n\nfunction isViewModelCandidate(content){\n  if(!content || typeof content !== 'object' || Array.isArray(content)) return false;\n  if(!Array.isArray(content.tabs)) return false;\n  return typeof content.kind === 'string' || typeof content.title === 'string';\n}\n\nfunction matchesIdentifier(item, rawId){\n  if(!item) return false;\n  const str = rawId == null ? '' : String(rawId).trim();\n  if(!str) return false;\n  if(item?.ids?.imdb && String(item.ids.imdb) === str) return true;\n  if(item?.ids?.tmdb && String(item.ids.tmdb) === str) return true;\n  if(item?.ratingKey != null && String(item.ratingKey) === str) return true;\n  if(item?.rating_key != null && String(item.rating_key) === str) return true;\n  if(item?.id != null && String(item.id) === str) return true;\n  return false;\n}\n\nasync function ensureDemoModule(){\n  if(!demoModule.promise){\n    demoModule.promise = import('../modal/demoData.js').catch(err => {\n      console.warn(LOG_PREFIX, 'Demo-Daten konnten nicht geladen werden.', err?.message || err);\n      return { DEMO_MOVIE: null, DEMO_SERIES: null };\n    });\n  }\n  return demoModule.promise;\n}\n\nasync function ensureMovies(){\n  if(Array.isArray(moviesCache)) return moviesCache;\n  try{\n    moviesCache = await loadMovies();\n  }catch(err){\n    moviesCache = [];\n    console.warn(LOG_PREFIX, 'Failed to load movie library for detail view:', err?.message || err);\n  }\n  return moviesCache;\n}\n\nasync function ensureShows(){\n  if(Array.isArray(showsCache)) return showsCache;\n  try{\n    showsCache = await loadShows();\n  }catch(err){\n    showsCache = [];\n    console.warn(LOG_PREFIX, 'Failed to load show library for detail view:', err?.message || err);\n  }\n  return showsCache;\n}\n\nfunction findInList(list, id){\n  if(!Array.isArray(list) || !list.length) return null;\n  return list.find(entry => matchesIdentifier(entry, id)) || null;\n}\n\nasync function resolveMoviePayload(input){\n  if(input === 'demo'){\n    const { DEMO_MOVIE } = await ensureDemoModule();\n    return DEMO_MOVIE ? { item: DEMO_MOVIE } : null;\n  }\n  if(input && typeof input === 'object'){\n    if(input.item || input.movie) return { item: input.item || input.movie };\n    return { item: input };\n  }\n  const id = input == null ? '' : String(input).trim();\n  if(!id) return null;\n  const state = getAppState();\n  let match = findInList(state?.movies, id);\n  if(!match){\n    const library = await ensureMovies();\n    match = findInList(library, id);\n  }\n  return match ? { item: match } : null;\n}\n\nasync function resolveSeriesPayload(input){\n  if(input === 'demo'){\n    const { DEMO_SERIES } = await ensureDemoModule();\n    return DEMO_SERIES ? { item: DEMO_SERIES } : null;\n  }\n  if(input && typeof input === 'object'){\n    const base = input.item || input.show || input.media || input;\n    const detail = input.detail || input.showDetail || input.tmdbDetail || null;\n    return { item: base, detail: detail || null };\n  }\n  const id = input == null ? '' : String(input).trim();\n  if(!id) return null;\n  const state = getAppState();\n  let match = findInList(state?.shows, id);\n  if(!match){\n    const library = await ensureShows();\n    match = findInList(library, id);\n  }\n  if(!match) return null;\n  let detail = null;\n  try{\n    detail = await loadShowDetail(match);\n  }catch(err){\n    console.warn(LOG_PREFIX, 'Failed to load show detail payload for', id, err?.message || err);\n  }\n  return { item: match, detail: detail || null };\n}\n\nasync function loadMovieDetailViewModel(payload, options = {}){\n  const resolved = await resolveMoviePayload(payload);\n  if(!resolved || !resolved.item) return null;\n  try{\n    return await buildMovieViewModel(resolved, options);\n  }catch(err){\n    console.warn(LOG_PREFIX, 'Failed to build movie view model:', err?.message || err);\n    return null;\n  }\n}\n\nasync function loadSeriesDetailViewModel(payload, options = {}){\n  const resolved = await resolveSeriesPayload(payload);\n  if(!resolved || !resolved.item) return null;\n  try{\n    return await buildSeriesViewModel({ ...resolved, detail: resolved.detail }, options);\n  }catch(err){\n    console.warn(LOG_PREFIX, 'Failed to build series view model:', err?.message || err);\n    return null;\n  }\n}\n\nfunction createPaneStack(viewModel){\n  if(typeof document === 'undefined') return null;\n  const article = document.createElement('article');\n  article.className = 'v3-shell';\n  article.dataset.modalv3Shell = '1';\n\n  const head = createHead(viewModel);\n  const headRoot = head?.root || null;\n  const closeButton = head?.elements?.close || headRoot?.querySelector('#action-close');\n  if(closeButton){\n    closeButton.hidden = false;\n    closeButton.removeAttribute('hidden');\n    closeButton.addEventListener('click', closeDetailV3);\n  }\n  if(headRoot) article.appendChild(headRoot);\n\n  const body = document.createElement('div');\n  body.className = 'v3-shell__body';\n  const columns = document.createElement('div');\n  columns.className = 'v3-shell-columns';\n\n  const aside = document.createElement('aside');\n  aside.className = 'v3-shell-aside';\n  const poster = createPosterCard(viewModel);\n  const posterRoot = poster?.root || null;\n  if(posterRoot) aside.appendChild(posterRoot);\n\n  const main = document.createElement('div');\n  main.className = 'v3-shell-main';\n  const tabs = document.createElement('div');\n  tabs.className = 'v3-tabs';\n  tabs.dataset.v3Tabs = '1';\n  tabs.setAttribute('role', 'tablist');\n  tabs.setAttribute('aria-label', 'Detailbereiche');\n  const stack = document.createElement('div');\n  stack.className = 'v3-pane-stack';\n  main.append(tabs, stack);\n\n  columns.append(aside, main);\n  body.append(columns);\n  article.appendChild(body);\n\n  const tabEntries = Array.isArray(viewModel?.tabs) && viewModel.tabs.length ? viewModel.tabs : [{ id: 'overview', label: '\u00DCberblick' }];\n  const defaultTab = viewModel?.defaultTab || tabEntries[0]?.id || 'overview';\n  const paneMap = new Map();\n\n  tabEntries.forEach((tab, index) => {\n    const id = normalizeTabId(tab?.id, index);\n    const label = normalizeTabLabel(tab?.label, id);\n    const button = document.createElement('button');\n    button.className = 'v3-tab';\n    button.dataset.tab = id;\n    const tabId = `v3-tab-${id}`;\n    const paneId = `v3-pane-${id}`;\n    button.id = tabId;\n    button.type = 'button';\n    button.setAttribute('role', 'tab');\n    button.setAttribute('aria-controls', paneId);\n    const isDefault = id === defaultTab || (!defaultTab && index === 0);\n    button.setAttribute('aria-selected', isDefault ? 'true' : 'false');\n    button.classList.toggle('active', isDefault);\n    button.tabIndex = isDefault ? 0 : -1;\n    button.textContent = label;\n    tabs.appendChild(button);\n\n    const panel = document.createElement('section');\n    panel.className = 'v3-pane';\n    panel.dataset.pane = id;\n    panel.id = paneId;\n    panel.setAttribute('role', 'tabpanel');\n    panel.setAttribute('aria-labelledby', tabId);\n    panel.hidden = !isDefault;\n    panel.setAttribute('aria-hidden', isDefault ? 'false' : 'true');\n\n    const paneTitle = document.createElement('h2');\n    paneTitle.className = 'v3-pane__title';\n    paneTitle.textContent = label;\n    const paneContent = document.createElement('div');\n    paneContent.className = 'v3-pane__content';\n    panel.append(paneTitle, paneContent);\n    stack.appendChild(panel);\n\n    paneMap.set(id, { tab: button, panel, content: paneContent });\n  });\n\n  if(paneMap.has('overview')){\n    renderOverview(paneMap.get('overview').content, viewModel);\n  }\n  if(paneMap.has('details')){\n    renderDetails(paneMap.get('details').content, viewModel);\n  }\n  if(paneMap.has('cast')){\n    renderCast(paneMap.get('cast').content, viewModel);\n  }\n  if(paneMap.has('seasons')){\n    renderSeasons(paneMap.get('seasons').content, viewModel);\n  }\n\n  paneMap.forEach((entry, id) => {\n    if(id === 'overview' || id === 'details') return;\n    if(entry.content.childElementCount > 0) return;\n    const fallback = document.createElement('p');\n    fallback.textContent = 'Inhalt folgt \u2026';\n    entry.panel.classList.add('v3-pane--muted');\n    entry.content.appendChild(fallback);\n  });\n\n  return { root: article, tabs, paneMap };\n}\n\nfunction ensureOverlayListeners(){\n  const shell = getShell();\n  if(!shell) return;\n  const { overlay } = shell;\n  if(overlay && !overlay.dataset.modalv3Click){\n    overlay.addEventListener('click', onOverlayClick);\n    overlay.dataset.modalv3Click = '1';\n  }\n}\n\nfunction onOverlayClick(ev){\n  const shell = getShell();\n  if(!shell) return;\n  const { overlay } = shell;\n  const target = ev.target;\n  if(target === overlay || (target && target.classList && target.classList.contains('modalv3-backdrop'))){\n    closeDetailV3();\n  }\n}\n\nexport function showLoading(message = 'Details werden geladen \u2026'){\n  ensureOverlayListeners();\n  const shell = openShell({ onRequestClose: closeDetailV3 });\n  if(!shell) return null;\n  const { root } = shell;\n  if(!root) return null;\n  root.hidden = false;\n  root.removeAttribute('hidden');\n  const loading = document.createElement('div');\n  loading.className = 'modalv3-loading';\n  loading.textContent = String(message || 'Details werden geladen \u2026');\n  root.replaceChildren(loading);\n  focusInitial();\n  return root;\n}\n\nfunction resolveNodes(content){\n  if(content == null) return [];\n  const nodeCtor = typeof Node !== 'undefined' ? Node : null;\n  if(nodeCtor && content instanceof nodeCtor){\n    return [content];\n  }\n  if(Array.isArray(content)){\n    const nodes = [];\n    for(const item of content){\n      if(nodeCtor && item instanceof nodeCtor){\n        nodes.push(item);\n      }\n    }\n    return nodes;\n  }\n  return null;\n}\n\nfunction resolveTargetElement(target){\n  const elementCtor = typeof HTMLElement !== 'undefined' ? HTMLElement : null;\n  if(!target) return null;\n  if(elementCtor && target instanceof elementCtor) return target;\n  if(typeof target === 'string' && typeof document !== 'undefined'){\n    try{ return document.querySelector(target); }\n    catch(err){ console.warn(LOG_PREFIX, 'Failed to query target element:', err?.message || err); }\n  }\n  if(elementCtor && target.root instanceof elementCtor) return target.root;\n  if(elementCtor && target.content instanceof elementCtor) return target.content;\n  return null;\n}\n\nexport function renderMediaDetail(target, viewModel, options = {}){\n  if(!isViewModelCandidate(viewModel)) return null;\n  const container = resolveTargetElement(target);\n  if(!container) return null;\n  const { layout = 'modal', replace = true, className, onRendered } = options || {};\n  const view = createPaneStack(viewModel);\n  if(!view?.root) return null;\n  view.root.hidden = false;\n  view.root.removeAttribute('hidden');\n  if(layout === 'standalone'){\n    view.root.classList.add('v3-shell--standalone');\n  }\n  if(className){\n    const classes = Array.isArray(className) ? className : String(className).split(/\\s+/);\n    classes.filter(Boolean).forEach(cls => view.root.classList.add(cls));\n  }\n  if(replace){\n    container.replaceChildren(view.root);\n  }else{\n    container.appendChild(view.root);\n  }\n  applyTabs(view.root);\n  if(typeof onRendered === 'function'){\n    try{ onRendered(view); }\n    catch(err){ console.warn(LOG_PREFIX, 'renderMediaDetail onRendered failed:', err?.message || err); }\n  }\n  return view;\n}\n\nexport function renderDetail(content, options = {}){\n  const { token, media, kind } = options || {};\n  if(token && !isCurrentRender(token)) return null;\n  if(kind != null || media != null){\n    const current = getActiveItem();\n    const resolvedKind = kind != null ? kind : current.kind;\n    const resolvedMedia = media != null ? media : current.item;\n    setActiveItem(resolvedKind, resolvedMedia);\n  }\n  ensureOverlayListeners();\n  const shell = openShell({ onRequestClose: closeDetailV3 });\n  if(!shell) return null;\n  const { root } = shell;\n  if(!root) return null;\n  root.hidden = false;\n  root.removeAttribute('hidden');\n\n  let handledByViewModel = false;\n  if(isViewModelCandidate(content)){\n    const rendered = renderMediaDetail(root, content, { replace: true, layout: 'modal' });\n    handledByViewModel = Boolean(rendered);\n  }\n\n  if(!handledByViewModel){\n    const nodes = resolveNodes(content);\n    if(nodes){\n      root.replaceChildren(...nodes);\n    }else if(typeof content === 'string'){\n      root.innerHTML = content;\n    }else if(content != null){\n      root.textContent = String(content);\n    }else{\n      root.innerHTML = '';\n    }\n\n    if(root.querySelector('.v3-tabs')){\n      applyTabs(root);\n    }\n  }\n\n  focusInitial();\n  return root;\n}\n\nfunction renderDetailError(message, options = {}){\n  const root = renderDetail(String(message || 'Details konnten nicht geladen werden.'), options);\n  clearActiveItem();\n  return root;\n}\n\nexport async function openMovieDetailV3(payload = null, options = {}){\n  captureLastFocused();\n  const token = startRender('movie', payload);\n  showLoading();\n  try{\n    const viewModel = await loadMovieDetailViewModel(payload, options);\n    if(!isCurrentRender(token)) return token;\n    if(!viewModel){\n      renderDetailError('Film konnte nicht geladen werden.', { token });\n      return token;\n    }\n    renderDetail(viewModel, { token, kind: 'movie', media: viewModel.item });\n  }catch(err){\n    console.warn(LOG_PREFIX, 'Failed to open movie detail:', err?.message || err);\n    if(isCurrentRender(token)){\n      renderDetailError('Film konnte nicht geladen werden.', { token });\n    }\n  }\n  return token;\n}\n\nexport async function openSeriesDetailV3(payload = null, options = {}){\n  captureLastFocused();\n  const token = startRender('show', payload);\n  showLoading();\n  try{\n    const viewModel = await loadSeriesDetailViewModel(payload, options);\n    if(!isCurrentRender(token)) return token;\n    if(!viewModel){\n      renderDetailError('Seriendetails konnten nicht geladen werden.', { token });\n      return token;\n    }\n    renderDetail(viewModel, { token, kind: 'show', media: viewModel.item });\n  }catch(err){\n    console.warn(LOG_PREFIX, 'Failed to open series detail:', err?.message || err);\n    if(isCurrentRender(token)){\n      renderDetailError('Seriendetails konnten nicht geladen werden.', { token });\n    }\n  }\n  return token;\n}\n\nexport function closeDetailV3(){\n  cancelRender();\n  closeShell();\n  restoreLastFocused();\n  clearActiveItem();\n}\n\nexport { closeDetailV3 as hideDetailV3 };\nexport { loadMovieDetailViewModel, loadSeriesDetailViewModel };\n", "const DEFAULT_ESTIMATED_HEIGHT = 420;\nconst DEFAULT_MIN_WIDTH = 190;\n\nconst raf = typeof requestAnimationFrame === 'function'\n  ? requestAnimationFrame\n  : (cb)=> setTimeout(cb, 16);\nconst caf = typeof cancelAnimationFrame === 'function'\n  ? cancelAnimationFrame\n  : (id)=> clearTimeout(id);\n\nfunction noop(){}\n\nfunction parsePx(value){\n  const num = parseFloat(value);\n  return Number.isFinite(num) ? num : 0;\n}\n\nexport class VirtualList {\n  constructor({\n    container,\n    renderItem,\n    getKey = noop,\n    updateItem = null,\n    getSignature = null,\n    overscan = 2,\n    estimatedItemHeight = DEFAULT_ESTIMATED_HEIGHT,\n    minItemWidth = DEFAULT_MIN_WIDTH\n  }){\n    if(!container) throw new Error('VirtualList requires a container element');\n    if(typeof renderItem !== 'function') throw new Error('VirtualList requires a renderItem function');\n\n    this.container = container;\n    this.renderItem = renderItem;\n    this.getKey = getKey;\n    this.updateItem = typeof updateItem === 'function' ? updateItem : null;\n    this.getSignature = typeof getSignature === 'function' ? getSignature : null;\n    this.overscan = Math.max(0, overscan|0);\n    this.estimatedItemHeight = estimatedItemHeight;\n    this.minItemWidth = minItemWidth;\n\n    this.items = [];\n    this.range = { start: 0, end: 0 };\n    this.columns = 1;\n    this.rowCount = 0;\n    this.rowHeight = this.estimatedItemHeight;\n    this.totalHeight = 0;\n    this.itemHeight = this.estimatedItemHeight;\n    this.containerTop = 0;\n    this.paddingTop = 0;\n    this.paddingBottom = 0;\n    this.gapY = 0;\n    this.gapX = 0;\n    this.metricsDirty = true;\n    this.pendingFrame = 0;\n    this.lastWidth = 0;\n\n    this.nodeCache = new Map();\n    this.renderedKeys = new Set();\n    this.itemSignatures = new Map();\n    this.scrollTicking = false;\n\n    this.spacer = document.createElement('div');\n    this.spacer.className = 'grid-virtual__spacer';\n    this.windowEl = document.createElement('div');\n    this.windowEl.className = 'grid-virtual__window';\n    this.itemsHost = document.createElement('div');\n    this.itemsHost.className = 'grid-virtual__items';\n\n    this.container.textContent = '';\n    this.windowEl.append(this.itemsHost);\n    this.container.append(this.spacer, this.windowEl);\n\n    this.measureRoot = document.createElement('div');\n    this.measureRoot.className = 'grid-virtual__measure';\n    this.measureRoot.setAttribute('aria-hidden', 'true');\n    Object.assign(this.measureRoot.style, {\n      position: 'absolute',\n      visibility: 'hidden',\n      pointerEvents: 'none',\n      inset: '0 auto auto 0',\n      zIndex: '-1'\n    });\n    this.container.append(this.measureRoot);\n\n    this.handleScroll = this.handleScroll.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.update = this.update.bind(this);\n\n    window.addEventListener('scroll', this.handleScroll, { passive: true });\n    window.addEventListener('resize', this.handleResize);\n\n    if(typeof ResizeObserver === 'function'){\n      this.resizeObserver = new ResizeObserver(this.handleResize);\n      this.resizeObserver.observe(this.container);\n    } else {\n      this.resizeObserver = null;\n    }\n  }\n\n  destroy(){\n    window.removeEventListener('scroll', this.handleScroll);\n    window.removeEventListener('resize', this.handleResize);\n    if(this.resizeObserver){\n      this.resizeObserver.disconnect();\n    }\n    if(this.pendingFrame){\n      caf(this.pendingFrame);\n      this.pendingFrame = 0;\n    }\n    this.nodeCache.clear();\n    this.renderedKeys.clear();\n    this.itemSignatures.clear();\n    this.items = [];\n    this.spacer.remove();\n    this.windowEl.remove();\n    this.measureRoot.remove();\n  }\n\n  schedule(force = false){\n    if(force) this.metricsDirty = true;\n    if(this.pendingFrame) return;\n    this.pendingFrame = raf(()=>{\n      this.pendingFrame = 0;\n      this.update();\n    });\n  }\n\n  handleScroll(){\n    if(this.scrollTicking) return;\n    this.scrollTicking = true;\n    this.schedule(false);\n    raf(()=>{\n      this.scrollTicking = false;\n    });\n  }\n\n  handleResize(){\n    const width = this.container.clientWidth;\n    if(width !== this.lastWidth){\n      this.metricsDirty = true;\n      this.lastWidth = width;\n    }\n    this.schedule(true);\n  }\n\n  setItems(list){\n    this.items = Array.isArray(list) ? list.slice() : [];\n    this.metricsDirty = true;\n    this.pruneCache();\n    this.measureItems();\n    this.update();\n  }\n\n  measureItems(){\n    if(!this.items.length){\n      this.itemHeight = this.estimatedItemHeight;\n      return;\n    }\n    const sampleItem = this.items[0];\n    this.measureRoot.textContent = '';\n    const sample = this.renderItem(sampleItem, 0);\n    if(sample instanceof HTMLElement){\n      this.measureRoot.append(sample);\n      if(typeof sample.getBoundingClientRect === 'function'){\n        const rect = sample.getBoundingClientRect();\n        if(rect && rect.height > 0){\n          this.itemHeight = rect.height;\n        }\n      } else if(sample.offsetHeight){\n        this.itemHeight = sample.offsetHeight;\n      }\n    }\n    this.measureRoot.textContent = '';\n  }\n\n  pruneCache(){\n    if(!this.items.length){\n      this.nodeCache.forEach(node=> node.remove());\n      this.nodeCache.clear();\n      this.itemSignatures.clear();\n      this.renderedKeys.clear();\n      return;\n    }\n    const allowed = new Set();\n    const nextSignatures = this.getSignature ? new Map() : null;\n\n    this.items.forEach((item, idx)=>{\n      const key = this.keyFor(item, idx);\n      allowed.add(key);\n      if(nextSignatures){\n        const signature = this.signatureFor(item, idx);\n        nextSignatures.set(key, signature);\n        const prev = this.itemSignatures.get(key);\n        if(prev !== undefined && prev !== signature){\n          const node = this.nodeCache.get(key);\n          if(node){\n            if(node.parentNode) node.parentNode.removeChild(node);\n            this.nodeCache.delete(key);\n            this.renderedKeys.delete(key);\n          }\n        }\n      }\n    });\n\n    this.nodeCache.forEach((node, key)=>{\n      if(!allowed.has(key)){\n        if(node.parentNode) node.parentNode.removeChild(node);\n        this.nodeCache.delete(key);\n        this.renderedKeys.delete(key);\n      }\n    });\n\n    if(nextSignatures){\n      this.itemSignatures = nextSignatures;\n    } else {\n      this.itemSignatures.clear();\n    }\n  }\n\n  keyFor(item, index){\n    const raw = this.getKey ? this.getKey(item, index) : null;\n    if(raw === undefined || raw === null || raw === ''){\n      return `index-${index}`;\n    }\n    return String(raw);\n  }\n\n  signatureFor(item, index){\n    if(!this.getSignature) return undefined;\n    try {\n      return this.getSignature(item, index);\n    } catch (err) {\n      return undefined;\n    }\n  }\n\n  refreshMetrics(){\n    const containerStyle = getComputedStyle(this.container);\n    this.paddingTop = parsePx(containerStyle.paddingTop);\n    this.paddingBottom = parsePx(containerStyle.paddingBottom);\n\n    const hostStyle = getComputedStyle(this.itemsHost);\n    const rowGap = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('row-gap') : hostStyle.rowGap;\n    const colGap = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('column-gap') : hostStyle.columnGap;\n    const gapFallback = hostStyle.getPropertyValue ? hostStyle.getPropertyValue('gap') : hostStyle.gap;\n\n    this.gapY = parsePx(rowGap || gapFallback);\n    this.gapX = parsePx(colGap || gapFallback);\n\n    const rawColumns = Math.floor((this.container.clientWidth + this.gapX) / (this.minItemWidth + this.gapX));\n    this.columns = Math.max(1, rawColumns || 1);\n    this.rowHeight = this.itemHeight + this.gapY;\n    if(this.rowHeight <= 0) this.rowHeight = this.itemHeight || this.estimatedItemHeight;\n    this.rowCount = this.columns > 0 ? Math.ceil(this.items.length / this.columns) : this.items.length;\n    this.totalHeight = Math.max(0, this.rowCount * this.rowHeight);\n\n    this.updateContainerPosition();\n\n    this.spacer.style.height = `${this.totalHeight}px`;\n    this.windowEl.style.top = `${this.paddingTop}px`;\n    this.windowEl.style.paddingBottom = `${this.paddingBottom}px`;\n    this.metricsDirty = false;\n  }\n\n  updateContainerPosition(){\n    let el = this.container;\n    let top = 0;\n    while(el && el !== document.body){\n      top += el.offsetTop;\n      el = el.offsetParent;\n    }\n    this.containerTop = top;\n  }\n\n  update(){\n    if(this.metricsDirty){\n      this.refreshMetrics();\n    }\n    this.syncVisibleRange();\n  }\n\n  syncVisibleRange(){\n    if(!this.items.length){\n      this.windowEl.style.transform = 'translate3d(0, 0, 0)';\n      this.itemsHost.replaceChildren();\n      this.range = { start: 0, end: 0 };\n      return;\n    }\n\n    const viewportTop = window.scrollY;\n    const viewportBottom = viewportTop + window.innerHeight;\n    const listStart = this.containerTop + this.paddingTop;\n    const listEnd = listStart + this.totalHeight;\n\n    if(window.__VLIST_DEBUG){\n      console.log('\uD83D\uDCCA VirtualList Debug:', {\n        'Scroll-Position': Math.round(window.scrollY) + 'px',\n        'Grid startet bei': Math.round(this.containerTop) + 'px',\n        'Zeilen-H\u00F6he': Math.round(this.rowHeight) + 'px',\n        'Spalten': this.columns,\n        'Gesamt-H\u00F6he': Math.round(this.totalHeight) + 'px',\n        'Sichtbarer Bereich': `Row ${Math.floor((viewportTop - listStart) / this.rowHeight)} - ${Math.ceil((viewportBottom - listStart) / this.rowHeight)}`\n      });\n    }\n\n    let startRow;\n    if(viewportTop <= listStart){\n      startRow = 0;\n    } else if(viewportTop >= listEnd){\n      startRow = Math.max(0, this.rowCount - 1);\n    } else {\n      startRow = Math.floor((viewportTop - listStart) / this.rowHeight);\n    }\n\n    let endRow;\n    if(viewportBottom >= listEnd){\n      endRow = Math.max(0, this.rowCount - 1);\n    } else if(viewportBottom <= listStart){\n      endRow = 0;\n    } else {\n      endRow = Math.ceil((viewportBottom - listStart) / this.rowHeight);\n    }\n\n    startRow = Math.max(0, Math.min(startRow, Math.max(0, this.rowCount - 1)) - this.overscan);\n    endRow = Math.min(Math.max(0, this.rowCount - 1), endRow + this.overscan);\n\n    const start = Math.max(0, Math.min(this.items.length, startRow * this.columns));\n    const end = Math.max(start, Math.min(this.items.length, (endRow + 1) * this.columns));\n\n    if(start === this.range.start && end === this.range.end){\n      let needsRefresh = false;\n      for(let i=start; i<end; i++){\n        const key = this.keyFor(this.items[i], i);\n        if(!this.renderedKeys.has(key)){\n          needsRefresh = true;\n          break;\n        }\n      }\n      if(!needsRefresh){\n        return;\n      }\n    }\n\n    this.range = { start, end };\n    const offsetRow = Math.floor(start / this.columns);\n    const offsetY = offsetRow * this.rowHeight;\n    this.windowEl.style.transform = `translate3d(0, ${offsetY}px, 0)`;\n\n    const nextRendered = new Set();\n    const toRender = [];\n\n    for(let i=start; i<end; i++){\n      const item = this.items[i];\n      const key = this.keyFor(item, i);\n      let node = this.nodeCache.get(key);\n      if(node){\n        if(this.updateItem){\n          const updated = this.updateItem(node, item, i);\n          if(updated instanceof HTMLElement && updated !== node){\n            node = updated;\n            this.nodeCache.set(key, node);\n          } else if(!(updated instanceof HTMLElement)){\n            continue;\n          }\n        }\n      } else {\n        node = this.renderItem(item, i);\n        if(!(node instanceof HTMLElement)) continue;\n        this.nodeCache.set(key, node);\n      }\n      nextRendered.add(key);\n      toRender.push(node);\n    }\n\n    // Reconcile DOM with minimal operations\n    const currentChildren = this.itemsHost.children;\n\n    // Quick path: exact same content\n    if(currentChildren.length === toRender.length){\n      let same = true;\n      for(let i = 0; i < toRender.length; i++){\n        if(currentChildren[i] !== toRender[i]){\n          same = false;\n          break;\n        }\n      }\n      if(same){\n        this.renderedKeys = nextRendered;\n        return;\n      }\n    }\n\n    // Build a map of current positions\n    const currentMap = new Map();\n    for(let i = 0; i < currentChildren.length; i++){\n      currentMap.set(currentChildren[i], i);\n    }\n\n    // Update nodes position by position\n    for(let i = 0; i < toRender.length; i++){\n      const desired = toRender[i];\n      const current = currentChildren[i];\n\n      if(current !== desired){\n        if(currentMap.has(desired)){\n          // Node exists somewhere - move it\n          this.itemsHost.insertBefore(desired, current || null);\n        } else {\n          // New node - insert it\n          this.itemsHost.insertBefore(desired, current || null);\n        }\n      }\n    }\n\n    // Remove any extra nodes at the end\n    while(this.itemsHost.children.length > toRender.length){\n      this.itemsHost.lastChild.remove();\n    }\n\n    this.renderedKeys = nextRendered;\n  }\n}\n", "import { getState } from './state.js';\nimport { el } from './dom.js';\nimport { humanYear, formatRating, renderChipsLimited, useTmdbForCards, isNew, getGenreNames, collectionTags } from './utils.js';\nimport * as Watch from './watchlist.js';\nimport { openMovieDetailV3, openSeriesDetailV3 } from './modalV3/index.js';\nimport { navigateToHash } from './main.js';\nimport { VirtualList } from './grid/virtualList.js';\n\nconst CARD_SIGNATURE_PROP = '__gridVirtualSignature';\n\nfunction cardEl(item){\n  const card = el('article','card');\n  card.dataset.kind = (item?.type === 'tv') ? 'show' : 'movie';\n  card.tabIndex = 0;\n  card.setAttribute('role', 'button');\n  if(item?.title) card.setAttribute('aria-label', item.title);\n\n  // 1) Media Block\n  const media = el('div','card__media');\n  const img = new Image();\n  img.loading = 'lazy';\n  img.decoding = 'async';\n  img.className = 'card__img';\n  img.alt = item?.title || '';\n  img.style.aspectRatio = '2 / 3';\n  const src = resolvePoster(item);\n  if(src) img.src = src;\n\n  const gradient = el('div','card__media-gradient');\n  gradient.setAttribute('aria-hidden','true');\n\n  const badges = buildItemBadges(item);\n  const badgeContainer = el('div','card__badges');\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\n\n  media.append(img, gradient);\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\n\n  const pct = progressPercent(item);\n  if(pct > 0){\n    const track = el('div','card__progress');\n    const fill = document.createElement('span');\n    fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;\n    track.append(fill);\n    media.append(track);\n  }\n\n  // 2) Info Block\n  const body = el('div','card__body');\n  const title = document.createElement('h3');\n  title.className = 'card__title';\n  title.textContent = item?.title || '';\n  if(item?.title) title.setAttribute('title', item.title);\n\n  const sub = el('div','card__meta');\n  const metaPieces = buildMetaPieces(item);\n  sub.textContent = metaPieces.join(' \u2022 ');\n\n  body.append(title, sub);\n\n  // 3) Actions Block\n  const actions = el('div','card__actions');\n\n  const chips = el('div','card__chips');\n  const genres = getGenreNames(item?.genres);\n  renderChipsLimited(chips, genres, 3);\n\n  const watchBtn = document.createElement('button');\n  watchBtn.type = 'button';\n  watchBtn.className = 'card__primary';\n  updateWatchButtonState(watchBtn, item);\n  watchBtn.addEventListener('click', ev=>{\n    ev.stopPropagation();\n    Watch.toggle(item);\n    updateWatchButtonState(watchBtn, item);\n  });\n\n  actions.append(chips, watchBtn);\n\n  card.append(media, body, actions);\n\n  card.addEventListener('click', ()=> openDetail(item));\n  card.addEventListener('keydown', ev=>{\n    if(ev.target !== card) return;\n    if(ev.key === 'Enter' || ev.key === ' '){\n      ev.preventDefault();\n      openDetail(item);\n    }\n  });\n\n  return card;\n}\n\nfunction createCollectionGroup(name, members){\n  const list = (members||[]).slice().sort((a,b)=>{\n    const ay = Number(humanYear(a)) || 0;\n    const by = Number(humanYear(b)) || 0;\n    if(ay !== by) return ay - by;\n    return (a.title||'').localeCompare(b.title||'', 'de');\n  });\n  const years = list.map(item=>Number(humanYear(item))||0).filter(Boolean);\n  const year = years.length ? Math.min(...years) : '';\n  const addedTimestamps = list.map(item=> new Date(item.addedAt||0).getTime()).filter(Number.isFinite);\n  const latestAdded = addedTimestamps.length ? new Date(Math.max(...addedTimestamps)).toISOString() : null;\n  const ratings = list.map(item=>Number(item.rating ?? item.audienceRating)).filter(Number.isFinite);\n  const rating = ratings.length ? ratings.reduce((sum,val)=>sum+val,0) / ratings.length : null;\n  const posterItem = list.find(entry=>entry.thumbFile) || list[0] || null;\n  const genres = Array.from(new Set(list.flatMap(entry=>getGenreNames(entry.genres)))).slice(0,4);\n  return { isCollectionGroup:true, type:'collection', title:name, collectionName:name, items:list, itemCount:list.length, year: year || '', addedAt: latestAdded, rating, posterItem, genres };\n}\n\nfunction groupCollectionsIfEnabled(items){\n  const togg = document.getElementById('groupCollections');\n  const colSel = document.getElementById('collectionFilter');\n  const selected = colSel && colSel.value;\n  if(!togg || !togg.checked) return items;\n  if(selected) return items; // drilling into a single collection -> show items, not groups\n  const membership = new Map();\n  items.forEach(item=>{\n    collectionTags(item).forEach(name=>{\n      if(!membership.has(name)) membership.set(name, []);\n      membership.get(name).push(item);\n    });\n  });\n  const groups = [];\n  membership.forEach((members, name)=>{ groups.push(createCollectionGroup(name, members)); });\n  // preserve stable order by title\n  groups.sort((a,b)=> a.title.localeCompare(b.title,'de'));\n  return groups;\n}\n\nfunction collectionCardEl(entry){\n  const card = el('article','card card--collection');\n  card.dataset.kind = 'collection';\n  card.tabIndex = 0;\n  card.setAttribute('role', 'button');\n  if(entry?.title) card.setAttribute('aria-label', entry.title);\n\n  // 1) Media Block\n  const media = el('div','card__media');\n  const baseItem = entry.posterItem || {};\n  const img = new Image();\n  img.loading = 'lazy';\n  img.decoding = 'async';\n  img.className = 'card__img';\n  img.alt = entry?.title || '';\n  img.style.aspectRatio = '2 / 3';\n  const src = resolvePoster(baseItem);\n  if(src) img.src = src;\n\n  const gradient = el('div','card__media-gradient');\n  gradient.setAttribute('aria-hidden','true');\n\n  const badges = buildCollectionBadges(entry);\n  const badgeContainer = el('div','card__badges');\n  badges.forEach(badge=>{ if(badge instanceof HTMLElement) badgeContainer.append(badge); });\n\n  media.append(img, gradient);\n  if(badgeContainer.childElementCount) media.append(badgeContainer);\n\n  // 2) Info Block\n  const body = el('div','card__body');\n  const title = document.createElement('h3');\n  title.className = 'card__title';\n  title.textContent = entry.title || '';\n  if(entry?.title) title.setAttribute('title', entry.title);\n\n  const sub = el('div','card__meta');\n  const pieces = collectionMetaPieces(entry);\n  sub.textContent = pieces.filter(Boolean).join(' \u2022 ');\n\n  body.append(title, sub);\n\n  // 3) Actions Block\n  const actions = el('div','card__actions');\n  const chips = el('div','card__chips');\n  renderChipsLimited(chips, entry.genres||[], 3);\n  actions.append(chips);\n\n  card.append(media, body, actions);\n\n  card.addEventListener('click', ()=>{\n    const sel = document.getElementById('collectionFilter');\n    if(sel){\n      sel.value = entry.collectionName || entry.title || '';\n      sel.dispatchEvent(new Event('change', { bubbles:true }));\n    }\n  });\n\n  card.addEventListener('keydown', ev=>{\n    if(ev.target !== card) return;\n    if(ev.key === 'Enter' || ev.key === ' '){\n      ev.preventDefault();\n      const sel = document.getElementById('collectionFilter');\n      if(sel){\n        sel.value = entry.collectionName || entry.title || '';\n        sel.dispatchEvent(new Event('change', { bubbles:true }));\n      }\n    }\n  });\n\n  return card;\n}\n\nlet virtualListInstance = null;\n\nfunction ensureVirtualList(grid){\n  if(virtualListInstance) return virtualListInstance;\n  virtualListInstance = new VirtualList({\n    container: grid,\n    overscan: 1,\n    estimatedItemHeight: 460,\n    minItemWidth: 190,\n    getKey: itemKey,\n    getSignature: gridItemSignature,\n    renderItem(item){\n      const node = renderGridItemNode(item);\n      return node;\n    },\n    updateItem(node, item){\n      return refreshGridItemNode(node, item);\n    }\n  });\n  return virtualListInstance;\n}\n\nfunction itemKey(item, index){\n  if(item?.isCollectionGroup){\n    const key = item.collectionName || item.title || '';\n    return key ? `collection:${key}` : `collection-index-${index}`;\n  }\n  const id = resolveItemId(item);\n  return id ? `item:${id}` : `item-index-${index}`;\n}\n\nfunction renderGridItemNode(item){\n  const node = item?.isCollectionGroup ? collectionCardEl(item) : cardEl(item);\n  if(node instanceof HTMLElement){\n    node[CARD_SIGNATURE_PROP] = gridItemSignature(item);\n  }\n  return node;\n}\n\nfunction refreshGridItemNode(current, item){\n  if(current instanceof HTMLElement){\n    const signature = gridItemSignature(item);\n    if(current[CARD_SIGNATURE_PROP] === signature){\n      current[CARD_SIGNATURE_PROP] = signature;\n      return current;\n    }\n  }\n  const replacement = renderGridItemNode(item);\n  if(!(replacement instanceof HTMLElement)) return current;\n  return replaceCardNode(current, replacement);\n}\n\nlet lastRenderedView = null;\n\nexport function renderGrid(view){\n  const { movies, shows, filtered } = getState();\n  const base = (view==='shows' ? shows : movies) || [];\n  const list = Array.isArray(filtered) ? filtered : base;\n  const items = groupCollectionsIfEnabled(list);\n  const grid = document.getElementById('grid');\n  if(!grid) return;\n\n  const shouldAnimate = lastRenderedView !== view;\n  lastRenderedView = view;\n\n  if(shouldAnimate) beginGridTransition(grid);\n  const vlist = ensureVirtualList(grid);\n  vlist.setItems(items);\n  if(shouldAnimate) finishGridTransition(grid);\n  const empty = document.getElementById('empty');\n  if(empty) empty.hidden = items.length > 0;\n  grid.setAttribute('aria-busy', 'false');\n}\n\nfunction beginGridTransition(grid){\n  if(!grid) return;\n  grid.classList.remove('is-entering','is-ready');\n  grid.classList.add('is-leaving');\n}\n\nfunction finishGridTransition(grid){\n  if(!grid) return;\n  grid.classList.remove('is-leaving');\n  grid.classList.add('is-entering');\n  requestAnimationFrame(()=>{\n    grid.classList.add('is-ready');\n    setTimeout(()=>grid.classList.remove('is-entering','is-ready'), 240);\n  });\n}\n\n\nfunction resolvePoster(item){\n  if(!item) return '';\n  const tmdbPoster = useTmdbForCards() && (item?.tmdb?.poster || item?.tmdbPoster);\n  const fallback = item?.thumbFile || item?.poster || item?.art || item?.thumb || '';\n  return tmdbPoster || fallback || '';\n}\n\nfunction itemBadgeTexts(item){\n  const badges = [];\n  if(isNew(item)) badges.push('Neu');\n  const contentRating = String(item?.contentRating || '').trim();\n  if(contentRating) badges.push(contentRating);\n  const ratingNum = Number(item?.rating ?? item?.audienceRating);\n  if(Number.isFinite(ratingNum)) badges.push(`\u2605 ${formatRating(ratingNum)}`);\n  return badges.slice(0, 3);\n}\n\nfunction buildItemBadges(item){\n  return itemBadgeTexts(item).map(createBadge);\n}\n\nfunction collectionBadgeTexts(entry){\n  const badges = [];\n  if(Number.isFinite(entry?.itemCount) && entry.itemCount > 0) badges.push(`${entry.itemCount} Titel`);\n  if(entry?.year) badges.push(String(entry.year));\n  return badges;\n}\n\nfunction buildCollectionBadges(entry){\n  return collectionBadgeTexts(entry).map(createBadge);\n}\n\nfunction createBadge(text){\n  const badge = document.createElement('span');\n  badge.className = 'badge';\n  badge.textContent = String(text || '');\n  return badge;\n}\n\nfunction updateWatchButtonState(button, item){\n  if(!button) return;\n  const saved = Watch.isSaved(item);\n  button.textContent = saved ? 'Gemerkt' : 'Merken';\n  button.classList.toggle('active', saved);\n  button.setAttribute('aria-pressed', saved ? 'true' : 'false');\n}\n\nfunction buildMetaPieces(item){\n  const pieces = [];\n  const year = humanYear(item);\n  if(year) pieces.push(String(year));\n  const runtime = formatRuntime(item);\n  if(runtime) pieces.push(runtime);\n  const rating = Number(item?.rating ?? item?.audienceRating);\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\n  const studio = item?.studio || item?.network || '';\n  if(studio) pieces.push(studio);\n  return pieces;\n}\n\nfunction collectionMetaPieces(entry){\n  const pieces = [];\n  if(entry?.year) pieces.push(String(entry.year));\n  const count = Number(entry?.itemCount);\n  if(Number.isFinite(count)) pieces.push(`${count} Titel`);\n  const rating = Number(entry?.rating);\n  if(Number.isFinite(rating)) pieces.push(`\u2605 ${formatRating(rating)}`);\n  return pieces;\n}\n\nfunction formatRuntime(item){\n  const raw = item?.runtimeMin ?? item?.durationMin ?? (item?.duration ? Math.round(Number(item.duration) / 60000) : null);\n  const minutes = Number(raw);\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\n  if(item?.type === 'tv') return `~${minutes} min/Ep`;\n  return `${minutes} min`;\n}\n\nfunction progressPercent(item){\n  const offset = Number(item?.viewOffset ?? item?.viewoffset);\n  const duration = Number(item?.duration);\n  if(!Number.isFinite(offset) || !Number.isFinite(duration) || duration <= 0) return 0;\n  return Math.max(1, Math.min(100, Math.round((offset / duration) * 100)));\n}\n\nfunction resolveItemId(item){\n  if(!item) return '';\n  const preferred = item?.ids?.imdb || item?.ids?.tmdb;\n  if(preferred) return String(preferred);\n  if(item?.ratingKey) return String(item.ratingKey);\n  return '';\n}\n\nfunction gridItemSignature(entry){\n  if(entry?.isCollectionGroup) return collectionSignature(entry);\n  return itemSignature(entry);\n}\n\nfunction itemSignature(item){\n  const genres = getGenreNames(item?.genres).slice(0, 3);\n  const badges = itemBadgeTexts(item);\n  const meta = buildMetaPieces(item);\n  return JSON.stringify({\n    id: resolveItemId(item),\n    title: item?.title || '',\n    poster: resolvePoster(item),\n    badges,\n    meta,\n    progress: progressPercent(item),\n    watch: Watch.isSaved(item),\n    genres\n  });\n}\n\nfunction collectionSignature(entry){\n  const baseItem = entry?.posterItem || null;\n  const genres = Array.isArray(entry?.genres) ? entry.genres.slice(0, 3).map(String) : [];\n  const badges = collectionBadgeTexts(entry);\n  const meta = collectionMetaPieces(entry);\n  const count = Number(entry?.itemCount);\n  const ratingValue = Number(entry?.rating);\n  return JSON.stringify({\n    name: entry?.collectionName || entry?.title || '',\n    title: entry?.title || '',\n    itemCount: Number.isFinite(count) ? count : null,\n    year: entry?.year || '',\n    rating: Number.isFinite(ratingValue) ? ratingValue : null,\n    poster: resolvePoster(baseItem),\n    badges,\n    meta,\n    genres\n  });\n}\n\nfunction replaceCardNode(current, replacement){\n  if(!(replacement instanceof HTMLElement)) return current;\n  if(!(current instanceof HTMLElement)) return replacement;\n  const parent = current.parentNode;\n  const hadFocus = document.activeElement === current;\n  if(parent){\n    parent.replaceChild(replacement, current);\n  }\n  if(hadFocus && typeof replacement.focus === 'function'){\n    requestAnimationFrame(()=>{\n      try {\n        replacement.focus({ preventScroll: true });\n      } catch (err) {\n        replacement.focus();\n      }\n    });\n  }\n  return replacement;\n}\n\nfunction updateHash(kind, id){\n  if(!kind || !id) return;\n  const hash = `#/${kind}/${id}`;\n  const replace = (window.location.hash || '') === hash;\n  navigateToHash(hash, { silent: true, replace });\n}\n\nfunction openDetail(item){\n  if(!item) return;\n  const kind = item?.type === 'tv' ? 'show' : 'movie';\n  const id = resolveItemId(item);\n  if(id) updateHash(kind, id);\n  if(kind === 'show') openSeriesDetailV3(item);\n  else openMovieDetailV3(item);\n}\n", "import { getState, setState } from './state.js';\nimport { qs } from './dom.js';\nimport { getGenreNames, humanYear, collectionTags, isNew } from './utils.js';\n\nfunction norm(s){ return String(s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,''); }\n\nfunction matches(item, opts){\n  const query = norm(opts.query||'');\n  const onlyNew = !!opts.onlyNew;\n  const yearFrom = Number(opts.yearFrom)||null;\n  const yearTo = Number(opts.yearTo)||null;\n  const genresActive = opts.genres || new Set();\n  const selectedCollection = opts.collection || '';\n\n  if(query){\n    const haystack = norm([\n      item.title,\n      item.originalTitle,\n      item.summary,\n      item.studio,\n      getGenreNames(item.genres).join(' '),\n      (item.roles||[]).map(r=>r && (r.tag||r.role||r.name)).join(' '),\n      collectionTags(item).join(' '),\n    ].filter(Boolean).join(' '));\n    if(!haystack.includes(query)) return false;\n  }\n\n  if(onlyNew && !isNew(item)) return false;\n\n  const year = Number(humanYear(item)) || null;\n  if(yearFrom && (!year || year < yearFrom)) return false;\n  if(yearTo && (!year || year > yearTo)) return false;\n\n  if(genresActive.size){\n    const itemGenres = new Set(getGenreNames(item.genres));\n    for(const g of genresActive){ if(!itemGenres.has(g)) return false; }\n  }\n\n  if(selectedCollection){\n    const tags = new Set(collectionTags(item));\n    if(!tags.has(selectedCollection)) return false;\n  }\n\n  return true;\n}\n\nfunction sortItems(items, key){\n  const arr = items.slice();\n  switch(key){\n    case 'year-desc':\n      arr.sort((a,b)=> (Number(humanYear(b))||0) - (Number(humanYear(a))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\n    case 'year-asc':\n      arr.sort((a,b)=> (Number(humanYear(a))||0) - (Number(humanYear(b))||0) || String(a.title||'').localeCompare(String(b.title||''),'de')); break;\n    case 'title-desc':\n      arr.sort((a,b)=> String(b.title||'').localeCompare(String(a.title||''),'de')); break;\n    case 'added-desc':\n      arr.sort((a,b)=> new Date(b.addedAt||0)-new Date(a.addedAt||0)); break;\n    case 'title-asc':\n    default:\n      arr.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||''),'de'));\n  }\n  return arr;\n}\n\nexport function computeFacets(movies, shows){\n  const genres = new Set();\n  const years = new Set();\n  const collections = new Set();\n  const add = (arr)=> (arr||[]).forEach(x=>{\n    getGenreNames(x.genres).forEach(name=>genres.add(name));\n    const y = x.year || (x.originallyAvailableAt?String(x.originallyAvailableAt).slice(0,4):'');\n    if(y) years.add(Number(y));\n    collectionTags(x).forEach(c=>collections.add(c));\n  });\n  add(movies); add(shows);\n  const ys = [...years].sort((a,b)=>a-b);\n  return { genres:[...genres].sort(), years:ys, collections:[...collections].sort((a,b)=>a.localeCompare(b,'de')) };\n}\n\nexport function renderFacets(f){\n  // years\n  const yFrom = qs('#yearFrom'); const yTo = qs('#yearTo');\n  if(yFrom){ yFrom.replaceChildren(new Option('Ab Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\n  if(yTo){ yTo.replaceChildren(new Option('Bis Jahr',''), ...f.years.map(y=>new Option(String(y), String(y)))); }\n  // collections\n  const col = qs('#collectionFilter');\n  if(col){ col.replaceChildren(new Option('Alle Collections',''), ...f.collections.map(c=>new Option(c,c))); }\n  // genres\n  const gRoot = qs('#genreFilters');\n  if(gRoot){\n    const chips = f.genres.map(name=>{\n      const b = document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=name; b.dataset.name=name; return b;\n    });\n    gRoot.replaceChildren(...chips);\n    updateGenreFilterState();\n  }\n}\n\nfunction getFilterOpts(){\n  const searchInput = document.getElementById('search') || document.getElementById('q');\n  const query = (searchInput?.value || '').trim();\n  const onlyNew = qs('#onlyNew')?.checked || false;\n  const yearFrom = qs('#yearFrom')?.value || '';\n  const yearTo = qs('#yearTo')?.value || '';\n  const collection = qs('#collectionFilter')?.value || '';\n  const sort = qs('#sort')?.value || 'title-asc';\n  const genres = new Set();\n  document.querySelectorAll('#genreFilters .chip.active').forEach(n=>genres.add(n.dataset.name));\n  return { query, onlyNew, yearFrom, yearTo, collection, genres, sort };\n}\n\nexport function applyFilters(){\n  const s = getState();\n  const view = s.view;\n  const pool = view==='shows' ? s.shows : s.movies;\n  const opts = getFilterOpts();\n  const filtered = (pool||[]).filter(item=>matches(item, opts));\n  const ordered = sortItems(filtered, opts.sort);\n  setState({ filtered: ordered });\n  return ordered;\n}\n\nlet gridModulePromise = null;\nfunction renderGridForCurrentView(){\n  if(!gridModulePromise){\n    gridModulePromise = import('./grid.js');\n  }\n  gridModulePromise.then(mod=>{\n    const fn = mod && mod.renderGrid;\n    if(typeof fn === 'function') fn(getState().view);\n  }).catch(console.error);\n}\n\nlet filtersUpdatedHandler = null;\n\nexport function setFiltersUpdatedHandler(handler){\n  filtersUpdatedHandler = typeof handler === 'function' ? handler : null;\n}\n\nexport function updateFiltersAndGrid(){\n  const result = applyFilters();\n  renderGridForCurrentView();\n  if(filtersUpdatedHandler){\n    try{\n      const payload = Array.isArray(result) ? result.slice() : [];\n      filtersUpdatedHandler(payload, getState().view);\n    }catch(err){\n      console.warn('[filter] Failed to notify filters handler:', err?.message);\n    }\n  }\n  return result;\n}\n\nfunction updateGenreFilterState(){\n  const root = document.getElementById('genreFilters');\n  if(!root) return;\n  const activeCount = root.querySelectorAll('.chip.active').length;\n  root.dataset.state = activeCount > 0 ? 'active' : 'empty';\n  root.dataset.count = String(activeCount);\n}\n\nexport function initFilters(){\n  // populate sort options\n  const sortSel = qs('#sort');\n  if(sortSel && sortSel.options.length===0){\n    [['title-asc','Titel A\u2013Z'],['title-desc','Titel Z\u2013A'],['year-desc','Jahr \u2193'],['year-asc','Jahr \u2191'],['added-desc','Zuletzt hinzugef\u00FCgt']]\n      .forEach(([v,l])=> sortSel.add(new Option(l, v)));\n  }\n\n  const bind = (sel, ev='input')=>{\n    const n = qs(sel);\n    if(!n) return;\n    n.addEventListener(ev, ()=>{ updateFiltersAndGrid(); });\n    if(ev === 'input' && n instanceof HTMLInputElement && n.type === 'search'){\n      n.addEventListener('search', ()=>{ updateFiltersAndGrid(); });\n    }\n  };\n  bind('#search');\n  bind('#q');\n  bind('#onlyNew','change'); bind('#yearFrom','change'); bind('#yearTo','change'); bind('#collectionFilter','change'); bind('#sort','change'); bind('#groupCollections','change');\n  const yrReset = qs('#yearReset'); if(yrReset){ yrReset.addEventListener('click',()=>{ const a=qs('#yearFrom'); const b=qs('#yearTo'); if(a) a.value=''; if(b) b.value=''; updateFiltersAndGrid(); }); }\n  const gRoot = qs('#genreFilters');\n  if(gRoot){\n    gRoot.addEventListener('click', ev=>{\n      const t = ev.target;\n      if(!(t instanceof HTMLElement)) return;\n      if(!t.classList.contains('chip')) return;\n      t.classList.toggle('active');\n      updateGenreFilterState();\n      updateFiltersAndGrid();\n    });\n    updateGenreFilterState();\n  }\n}\n\n", "import cacheStore, { clear as clearCacheStore } from '../cacheStore.js';\nimport { createMetadataService } from '../metadataService.js';\n\nconst API_V3 = 'https://api.themoviedb.org/3';\nconst LOG_PREFIX = '[tmdb]';\nconst SESSION_CACHE = new Map();\n\nlet metadataInstance = null;\nlet metadataSignature = '';\n\nfunction logWarn(...args){\n  try {\n    console.warn(LOG_PREFIX, ...args);\n  } catch (_err) {\n    // ignore\n  }\n}\n\nfunction normalizeConfig(cfg = {}){\n  const language = cfg.lang || cfg.language || 'de-DE';\n  const region = cfg.region || cfg.iso || 'DE';\n  const ttlHours = Number(cfg.ttlHours || cfg.tmdbTtlHours || 24) || 24;\n  const imageBase = cfg.imageBase || cfg.tmdbImageBase;\n  return { language, region, ttlHours, imageBase };\n}\n\nfunction buildSignature(cfg, auth){\n  const { language, region, ttlHours, imageBase } = normalizeConfig(cfg);\n  const authSig = auth?.kind ? `${auth.kind}:${auth.value || ''}` : 'none';\n  return JSON.stringify({ language, region, ttlHours, imageBase, auth: authSig });\n}\n\nfunction ensureMetadata(cfg = {}, auth){\n  const signature = buildSignature(cfg, auth);\n  if(metadataInstance && metadataSignature === signature){\n    return metadataInstance;\n  }\n  const { language, region, ttlHours, imageBase } = normalizeConfig(cfg);\n  const options = {\n    cacheStore,\n    language,\n    region,\n    ttlHours,\n  };\n  if(imageBase) options.imageBase = imageBase;\n  if(auth?.kind === 'bearer' && auth.value){\n    options.token = auth.value;\n  } else if(auth?.kind === 'apikey' && auth.value){\n    options.apiKey = auth.value;\n  }\n  metadataInstance = createMetadataService(options);\n  metadataSignature = signature;\n  return metadataInstance;\n}\n\nfunction keyFor(item){\n  const type = (item?.type === 'tv') ? 'tv' : 'movie';\n  const imdb = item?.ids?.imdb || '';\n  const tmdb = item?.ids?.tmdb || '';\n  const title = (item?.title || item?.name || '').toLowerCase();\n  const year = String(item?.year || '').slice(0, 4);\n  return [type, imdb, tmdb, title, year].filter(Boolean).join('|');\n}\n\nexport function clearCache(){\n  try{\n    localStorage.removeItem('tmdbCache');\n  }catch(err){\n    logWarn('Failed to clear legacy TMDB cache from storage:', err);\n  }\n  SESSION_CACHE.clear();\n  try{\n    clearCacheStore('tmdb:');\n  }catch(err){\n    logWarn('Failed to clear metadata cache store:', err);\n  }\n  if(metadataInstance){\n    try{\n      metadataInstance.clear?.('tmdb:');\n    }catch(err){\n      logWarn('Failed to clear metadata service cache:', err);\n    }\n  }\n}\n\nfunction tokenFromEnv(cfg){\n  try{\n    const token = localStorage.getItem('tmdbToken');\n    if(token && token.trim()) return { kind: 'bearer', value: token.trim() };\n  }catch(err){\n    logWarn('Failed to read TMDB token from storage:', err);\n  }\n  if(cfg?.tmdbToken){\n    const val = String(cfg.tmdbToken).trim();\n    if(val) return { kind: 'bearer', value: val };\n  }\n  if(cfg?.tmdbApiKey){\n    const val = String(cfg.tmdbApiKey).trim();\n    if(val) return { kind: 'apikey', value: val };\n  }\n  return { kind: 'none', value: '' };\n}\n\nasync function resolveByExternalId(type, imdbId, cfg, auth){\n  if(!imdbId) return null;\n  try{\n    const service = ensureMetadata(cfg, auth);\n    const client = service.client;\n    const json = await client.get(`/find/${encodeURIComponent(imdbId)}`, {\n      external_source: 'imdb_id',\n    });\n    if(type === 'movie'){\n      return json?.movie_results?.[0]?.id ?? null;\n    }\n    return json?.tv_results?.[0]?.id ?? null;\n  }catch(err){\n    logWarn(`Failed to resolve external id ${imdbId}:`, err);\n    return null;\n  }\n}\n\nasync function resolveBySearch(type, title, year, cfg, auth){\n  const name = String(title || '').trim();\n  if(!name) return null;\n  try{\n    const service = ensureMetadata(cfg, auth);\n    const client = service.client;\n    const params = {\n      query: name,\n      include_adult: false,\n    };\n    if(year){\n      if(type === 'movie') params.year = year;\n      else params.first_air_date_year = year;\n    }\n    const json = await client.get(`/search/${type}`, params);\n    const result = Array.isArray(json?.results) ? json.results[0] : null;\n    return result?.id ?? null;\n  }catch(err){\n    logWarn(`Search failed for ${type} ${title}:`, err);\n    return null;\n  }\n}\n\nasync function hydrateItem(item, cfg, auth){\n  const type = (item?.type === 'tv') ? 'tv' : 'movie';\n  const cacheKey = keyFor(item);\n  if(SESSION_CACHE.has(cacheKey)){\n    return SESSION_CACHE.get(cacheKey);\n  }\n  const service = ensureMetadata(cfg, auth);\n  let tmdbId = item?.ids?.tmdb;\n  if(!tmdbId && item?.ids?.imdb){\n    tmdbId = await resolveByExternalId(type, item.ids.imdb, cfg, auth);\n  }\n  if(!tmdbId){\n    const year = item?.year ? Number(String(item.year).slice(0, 4)) : undefined;\n    tmdbId = await resolveBySearch(type, item?.title || item?.name, year, cfg, auth);\n  }\n  if(!tmdbId){\n    SESSION_CACHE.set(cacheKey, null);\n    return null;\n  }\n  try{\n    const detail = type === 'tv'\n      ? await service.getTvEnriched(tmdbId)\n      : await service.getMovieEnriched(tmdbId);\n    if(!detail){\n      SESSION_CACHE.set(cacheKey, null);\n      return null;\n    }\n    const enriched = {\n      id: detail.id || String(tmdbId),\n      poster: detail.poster || '',\n      backdrop: detail.backdrop || '',\n      url: detail.url || `https://www.themoviedb.org/${type}/${tmdbId}`,\n    };\n    SESSION_CACHE.set(cacheKey, enriched);\n    return enriched;\n  }catch(err){\n    logWarn(`Hydration failed for ${type} ${tmdbId}:`, err);\n    SESSION_CACHE.set(cacheKey, null);\n    return null;\n  }\n}\n\nexport async function hydrateOptional(movies, shows, cfg = {}){\n  try{\n    const auth = tokenFromEnv(cfg);\n    if(!auth.value){\n      return;\n    }\n    ensureMetadata(cfg, auth);\n    const work = [...(movies || []), ...(shows || [])];\n    const limit = 40;\n    let index = 0;\n    const processChunk = async () => {\n      const chunk = work.slice(index, index + 4);\n      index += 4;\n      await Promise.all(chunk.map(async (it) => {\n        const data = await hydrateItem(it, cfg, auth);\n        if(data){\n          it.tmdb = { id: data.id, poster: data.poster, backdrop: data.backdrop, url: data.url };\n          it.ids = it.ids || {};\n          if(!it.ids.tmdb && data.id){\n            it.ids.tmdb = String(data.id);\n          }\n        }\n      }));\n      try{\n        window.dispatchEvent(new CustomEvent('tmdb:chunk', { detail: { updated: chunk.length, index } }));\n      }catch(err){\n        logWarn('Failed to dispatch tmdb:chunk event:', err);\n      }\n      const hasMore = index < Math.min(work.length, limit);\n      if(hasMore){\n        if(window.requestIdleCallback){\n          window.requestIdleCallback(processChunk, { timeout: 500 });\n        }else{\n          setTimeout(processChunk, 250);\n        }\n      }else{\n        try{\n          window.dispatchEvent(new CustomEvent('tmdb:done', { detail: { total: Math.min(work.length, limit) } }));\n        }catch(err){\n          logWarn('Failed to dispatch tmdb:done event:', err);\n        }\n      }\n    };\n    processChunk();\n  }catch(err){\n    logWarn('hydrateOptional failed to start:', err);\n  }\n}\n\nfunction withAuth(url, auth){\n  if(!auth || auth.kind === 'none') return { url, init: {} };\n  if(auth.kind === 'bearer'){\n    return { url, init: { headers: { Authorization: `Bearer ${auth.value}`, Accept: 'application/json' } } };\n  }\n  const separator = url.includes('?') ? '&' : '?';\n  return { url: `${url}${separator}api_key=${encodeURIComponent(auth.value)}`, init: { headers: { Accept: 'application/json' } } };\n}\n\n// Lightweight token validation used by settings UI\nexport async function validateToken(raw){\n  const token = String(raw || '').trim();\n  if(!token) throw new Error('empty');\n  const looksLikeV3 = /^[a-f0-9]{32}$/i.test(token);\n  const looksLikeJwt = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+$/.test(token);\n  const decodeJwtPayload = (t)=>{\n    try{\n      const part = t.split('.')[1];\n      const pad = (s)=> s + '='.repeat((4 - (s.length % 4)) % 4);\n      const json = atob(pad(part.replace(/-/g,'+').replace(/_/g,'/')));\n      return JSON.parse(json);\n    }catch(err){\n      logWarn('Failed to decode TMDB JWT payload:', err);\n      return null;\n    }\n  };\n\n  if(looksLikeV3){\n    const { url, init } = withAuth(`${API_V3}/configuration`, { kind:'apikey', value: token });\n    const res = await fetch(url, init);\n    if(res.ok) return { ok:true, as:'apikey', hint:'v3Key' };\n    return { ok:false, as:'apikey', hint:'looksV3' };\n  }\n\n  if(looksLikeJwt){\n    const payload = decodeJwtPayload(token);\n    if(payload && typeof payload === 'object'){\n      const iss = String(payload.iss||'');\n      if(iss && !/themoviedb\\.org/i.test(iss)){\n        return { ok:false, as:'bearer', hint:'issMismatch' };\n      }\n    }\n    const { url, init } = withAuth(`${API_V3}/trending/movie/day`, { kind:'bearer', value: token });\n    try{\n      const res = await fetch(url, init);\n      if(res.ok) return { ok:true, as:'bearer', hint:null };\n    }catch(err){\n      logWarn('Bearer token validation request failed:', err);\n    }\n    return { ok:true, as:'bearer', hint:'structOnly' };\n  }\n\n  return { ok:false, as:'bearer', hint:null };\n}\n", "import { showError } from '../errorHandler.js';\n\nconst POLICY_URL = 'hero.policy.json';\n\nconst DEFAULT_POLICY = Object.freeze({\n  poolSizeMovies: 10,\n  poolSizeSeries: 10,\n  slots: {\n    new: { quota: 0.3 },\n    topRated: { quota: 0.3 },\n    oldButGold: { quota: 0.2 },\n    random: { quota: 0.2 }\n  },\n  diversity: {\n    genre: 0.4,\n    year: 0.35,\n    antiRepeat: 0.25\n  },\n  rotation: {\n    intervalMinutes: 360,\n    minPoolSize: 6\n  },\n  textClamp: {\n    title: 96,\n    subtitle: 240,\n    summary: 220\n  },\n  fallback: {\n    prefer: 'movies',\n    allowDuplicates: false\n  },\n  language: 'en-US',\n  cache: {\n    ttlHours: 24,\n    graceMinutes: 15\n  }\n});\n\nconst SLOT_KEYS = ['new', 'topRated', 'oldButGold', 'random'];\n\nlet activePolicy = clone(DEFAULT_POLICY);\nlet policyLoadedAt = 0;\nlet validationIssues = [];\n\nexport async function initHeroPolicy(){\n  validationIssues = [];\n  let raw = null;\n  let loadError = null;\n\n  try {\n    const response = await fetch(POLICY_URL, { cache: 'no-cache' });\n    if(!response.ok){\n      throw new Error(`HTTP ${response.status}`);\n    }\n    raw = await safeJson(response);\n  } catch (error) {\n    loadError = error;\n    addIssue(`Failed to load policy (${error?.message || 'unknown error'})`);\n    showError('Hero-Policy konnte nicht geladen werden', error?.message || 'Unbekannter Fehler');\n  }\n\n  activePolicy = sanitizePolicy(raw);\n  policyLoadedAt = Date.now();\n\n  reportValidationIssues(loadError);\n\n  return activePolicy;\n}\n\nexport function getHeroPolicy(){\n  return clone(activePolicy);\n}\n\nexport function getPoolSizes(){\n  return {\n    movies: activePolicy.poolSizeMovies,\n    series: activePolicy.poolSizeSeries\n  };\n}\n\nexport function getSlotConfig(){\n  const slots = {};\n  SLOT_KEYS.forEach((key) => {\n    slots[key] = { quota: activePolicy.slots[key].quota };\n  });\n  return slots;\n}\n\nexport function getDiversityWeights(){\n  return { ...activePolicy.diversity };\n}\n\nexport function getRotationConfig(){\n  return { ...activePolicy.rotation };\n}\n\nexport function getTextClampConfig(){\n  return { ...activePolicy.textClamp };\n}\n\nexport function getFallbackPreference(){\n  return { ...activePolicy.fallback };\n}\n\nexport function getPolicyLanguage(){\n  return activePolicy.language;\n}\n\nexport function getCacheTtl(){\n  const hours = Number(activePolicy.cache.ttlHours);\n  const grace = Number(activePolicy.cache.graceMinutes);\n  return {\n    ttlHours: hours,\n    ttlMs: hours * 60 * 60 * 1000,\n    graceMinutes: grace,\n    graceMs: grace * 60 * 1000\n  };\n}\n\nexport function getValidationIssues(){\n  return validationIssues.slice();\n}\n\nexport function getPolicyLoadedAt(){\n  return policyLoadedAt;\n}\n\nfunction sanitizePolicy(raw){\n  const target = clone(DEFAULT_POLICY);\n  if(!raw || typeof raw !== 'object'){\n    addIssue('Policy payload missing or invalid, using defaults.');\n    return target;\n  }\n\n  target.poolSizeMovies = ensurePositiveInt(raw.poolSizeMovies, target.poolSizeMovies, 'poolSizeMovies');\n  target.poolSizeSeries = ensurePositiveInt(raw.poolSizeSeries, target.poolSizeSeries, 'poolSizeSeries');\n\n  const rawSlots = raw.slots && typeof raw.slots === 'object' ? raw.slots : {};\n  SLOT_KEYS.forEach((key) => {\n    const slot = rawSlots[key];\n    const quota = ensureNumberInRange(slot?.quota, 0, 1, target.slots[key].quota, `slots.${key}.quota`);\n    target.slots[key] = { quota };\n  });\n\n  const rawDiversity = raw.diversity && typeof raw.diversity === 'object' ? raw.diversity : {};\n  target.diversity = {\n    genre: ensureNumberInRange(rawDiversity.genre, 0, 1, target.diversity.genre, 'diversity.genre'),\n    year: ensureNumberInRange(rawDiversity.year, 0, 1, target.diversity.year, 'diversity.year'),\n    antiRepeat: ensureNumberInRange(rawDiversity.antiRepeat, 0, 1, target.diversity.antiRepeat, 'diversity.antiRepeat')\n  };\n\n  const rawRotation = raw.rotation && typeof raw.rotation === 'object' ? raw.rotation : {};\n  target.rotation = {\n    intervalMinutes: ensurePositiveInt(rawRotation.intervalMinutes, target.rotation.intervalMinutes, 'rotation.intervalMinutes'),\n    minPoolSize: ensurePositiveInt(rawRotation.minPoolSize, target.rotation.minPoolSize, 'rotation.minPoolSize')\n  };\n\n  const rawClamp = raw.textClamp && typeof raw.textClamp === 'object' ? raw.textClamp : {};\n  target.textClamp = {\n    title: ensurePositiveInt(rawClamp.title, target.textClamp.title, 'textClamp.title'),\n    subtitle: ensurePositiveInt(rawClamp.subtitle, target.textClamp.subtitle, 'textClamp.subtitle'),\n    summary: ensurePositiveInt(rawClamp.summary, target.textClamp.summary, 'textClamp.summary')\n  };\n\n  const rawFallback = raw.fallback && typeof raw.fallback === 'object' ? raw.fallback : {};\n  target.fallback = {\n    prefer: ensureFallbackPreference(rawFallback.prefer, target.fallback.prefer),\n    allowDuplicates: typeof rawFallback.allowDuplicates === 'boolean' ? rawFallback.allowDuplicates : target.fallback.allowDuplicates\n  };\n\n  target.language = typeof raw.language === 'string' && raw.language.trim() ? raw.language.trim() : target.language;\n  if(target.language !== (raw.language || '').trim()){\n    addIssue('language missing or invalid, defaulted to en-US.');\n  }\n\n  const rawCache = raw.cache && typeof raw.cache === 'object' ? raw.cache : {};\n  const ttlHours = ensurePositiveInt(rawCache.ttlHours, target.cache.ttlHours, 'cache.ttlHours');\n  const graceMinutes = ensurePositiveInt(rawCache.graceMinutes, target.cache.graceMinutes, 'cache.graceMinutes', true);\n  target.cache = { ttlHours, graceMinutes };\n\n  return target;\n}\n\nfunction ensurePositiveInt(value, fallback, field, allowZero){\n  const num = Number(value);\n  if(Number.isFinite(num) && (!allowZero ? num > 0 : num >= 0)){\n    return Math.floor(num);\n  }\n  if(value != null){\n    addIssue(`${field} invalid (${value}), using default (${fallback}).`);\n  }\n  return fallback;\n}\n\nfunction ensureNumberInRange(value, min, max, fallback, field){\n  const num = Number(value);\n  if(Number.isFinite(num) && num >= min && num <= max){\n    return num;\n  }\n  if(value != null){\n    addIssue(`${field} invalid (${value}), using default (${fallback}).`);\n  }\n  return fallback;\n}\n\nfunction ensureFallbackPreference(value, fallback){\n  if(value === 'movies' || value === 'series' || value === 'shows'){\n    return value === 'shows' ? 'series' : value;\n  }\n  if(value != null){\n    addIssue(`fallback.prefer invalid (${value}), using default (${fallback}).`);\n  }\n  return fallback;\n}\n\nfunction clone(source){\n  return JSON.parse(JSON.stringify(source));\n}\n\nasync function safeJson(response){\n  try {\n    return await response.json();\n  } catch (error) {\n    addIssue(`Failed to parse hero policy JSON (${error?.message || error}).`);\n    return null;\n  }\n}\n\nfunction addIssue(message){\n  if(!message) return;\n  validationIssues.push(message);\n}\n\nfunction reportValidationIssues(loadError){\n  if(!validationIssues.length) return;\n  if(loadError){\n    const followUps = validationIssues.slice(1);\n    if(followUps.length){\n      showError('Hero-Policy Hinweise', followUps.join(' \u2022 '));\n    }\n    return;\n  }\n  showError('Hero-Policy Hinweise', validationIssues.join(' \u2022 '));\n}\n\n", "const API_BASE = 'https://api.themoviedb.org/3';\nconst IMG_BASE = 'https://image.tmdb.org/t/p/';\nconst APPEND_FIELDS = 'images,release_dates,content_ratings,credits';\nconst STORAGE_KEY = 'hero.tmdbCache.v1';\nconst CACHE_TTL = 1000 * 60 * 60 * 24; // 24 hours\nconst MAX_CACHE_ENTRIES = 60;\nconst MIN_REQUEST_INTERVAL = 400; // ms\nconst MAX_RETRIES = 4;\nconst BASE_RETRY_DELAY = 400; // ms\nconst RETRY_DELAY_CAP = 8000; // ms\nconst RATE_LIMIT_BASE_DELAY = 1200; // ms\nconst RATE_LIMIT_CAP = 60000; // ms\nconst MAX_RATE_LIMIT_STRIKES = 5;\nconst RATE_LIMIT_RECOVERY_WINDOW = 90_000; // ms\nconst PENALTY_DECAY_STEP = 1;\nconst LOG_PREFIX = '[hero:tmdbClient]';\n\nlet memoryCache = new Map();\nlet cacheLoaded = false;\nlet persistTimer = null;\nlet lastRequestAt = 0;\nlet configPromise = null;\nlet cachedConfig = {};\nlet throttlePenaltyUntil = 0;\nlet rateLimitState = {\n  active: false,\n  until: 0,\n  retryAfterMs: 0,\n  lastStatus: null,\n  lastHitAt: 0,\n  strikes: 0\n};\nconst rateLimitListeners = new Set();\n\nfunction logWarn(...args){\n  try {\n    console.warn(LOG_PREFIX, ...args);\n  } catch (_err) {\n    // ignore\n  }\n}\n\nfunction now(){ return Date.now(); }\n\nfunction delay(ms){\n  return new Promise(resolve => setTimeout(resolve, Math.max(0, ms || 0)));\n}\n\nfunction shallowEqual(a, b){\n  if(a === b) return true;\n  if(!a || !b) return false;\n  const keysA = Object.keys(a);\n  const keysB = Object.keys(b);\n  if(keysA.length !== keysB.length) return false;\n  for(const key of keysA){\n    if(a[key] !== b[key]) return false;\n  }\n  return true;\n}\n\nfunction getRateLimitSnapshot(){\n  return {\n    active: !!rateLimitState.active,\n    until: Number(rateLimitState.until) || 0,\n    retryAfterMs: Number(rateLimitState.retryAfterMs) || 0,\n    lastStatus: rateLimitState.lastStatus ?? null,\n    lastHitAt: Number(rateLimitState.lastHitAt) || 0,\n    strikes: Number(rateLimitState.strikes) || 0\n  };\n}\n\nfunction notifyRateLimitListeners(){\n  const snapshot = getRateLimitSnapshot();\n  for(const listener of rateLimitListeners){\n    try {\n      listener(snapshot);\n    } catch (err) {\n      logWarn('Rate limit listener failed:', err?.message || err);\n    }\n  }\n}\n\nfunction updateRateLimitState(patch){\n  const next = { ...getRateLimitSnapshot(), ...patch };\n  if(shallowEqual(rateLimitState, next)) return rateLimitState;\n  rateLimitState = next;\n  notifyRateLimitListeners();\n  return rateLimitState;\n}\n\nfunction computeRetryDelay(attempt){\n  return Math.min(RETRY_DELAY_CAP, BASE_RETRY_DELAY * Math.pow(2, Math.max(0, attempt)));\n}\n\nfunction computeRateLimitDelay(strikes, fallback){\n  const scaled = RATE_LIMIT_BASE_DELAY * Math.pow(2, Math.max(0, strikes - 1));\n  const candidate = Math.max(fallback || 0, scaled);\n  return Math.min(RATE_LIMIT_CAP, candidate);\n}\n\nfunction registerRateLimitHit(retryAfterMs, status = 429){\n  const nowTs = now();\n  const strikes = Math.min(MAX_RATE_LIMIT_STRIKES, (rateLimitState.strikes || 0) + 1);\n  const delayMs = computeRateLimitDelay(strikes, retryAfterMs);\n  throttlePenaltyUntil = Math.max(throttlePenaltyUntil, nowTs + delayMs);\n  updateRateLimitState({\n    active: true,\n    strikes,\n    retryAfterMs: delayMs,\n    until: nowTs + delayMs,\n    lastStatus: status,\n    lastHitAt: nowTs\n  });\n  return delayMs;\n}\n\nfunction decayRateLimitStrikes(){\n  if(!rateLimitState.strikes) return;\n  const strikes = Math.max(0, rateLimitState.strikes - PENALTY_DECAY_STEP);\n  updateRateLimitState({\n    strikes,\n    active: rateLimitState.active && rateLimitState.until > now()\n  });\n}\n\nfunction refreshRateLimit(){\n  const nowTs = now();\n  if(rateLimitState.active && nowTs >= rateLimitState.until){\n    updateRateLimitState({ active: false, retryAfterMs: 0, until: 0 });\n  } else if(!rateLimitState.active && rateLimitState.strikes > 0 && nowTs - rateLimitState.lastHitAt > RATE_LIMIT_RECOVERY_WINDOW){\n    updateRateLimitState({ strikes: Math.max(0, rateLimitState.strikes - PENALTY_DECAY_STEP) });\n  }\n  if(throttlePenaltyUntil && nowTs >= throttlePenaltyUntil){\n    throttlePenaltyUntil = 0;\n  }\n}\n\nfunction getCacheKey(type, id, language){\n  const t = (type === 'tv') ? 'tv' : 'movie';\n  const lang = String(language || 'en-US').trim() || 'en-US';\n  return `${t}:${String(id || '').trim()}:${lang}`;\n}\n\nfunction ensureCacheLoaded(){\n  if(cacheLoaded) return;\n  cacheLoaded = true;\n  if(typeof localStorage === 'undefined') return;\n  let raw;\n  try {\n    raw = localStorage.getItem(STORAGE_KEY);\n    if(!raw) return;\n  } catch (err) {\n    logWarn('Failed to read TMDB cache from storage:', err?.message || err);\n    return;\n  }\n  let parsed;\n  try {\n    parsed = JSON.parse(raw);\n  } catch (err) {\n    logWarn('Stored TMDB cache invalid JSON:', err?.message || err);\n    return;\n  }\n  if(!Array.isArray(parsed)) return;\n  const nowTs = now();\n  parsed.forEach(([key, entry]) => {\n    if(!key || !entry) return;\n    const ts = Number(entry.ts ?? entry.timestamp ?? entry.fetchedAt);\n    if(!Number.isFinite(ts)) return;\n    if(nowTs - ts > CACHE_TTL) return;\n    memoryCache.set(String(key), { ts, data: entry.data ?? entry.payload ?? null });\n  });\n}\n\nfunction pruneExpired(){\n  const nowTs = now();\n  let changed = false;\n  for(const [key, entry] of memoryCache.entries()){\n    if(!entry || typeof entry !== 'object'){ memoryCache.delete(key); changed = true; continue; }\n    const ts = Number(entry.ts);\n    if(!Number.isFinite(ts) || nowTs - ts > CACHE_TTL){ memoryCache.delete(key); changed = true; }\n  }\n  if(changed) schedulePersist();\n}\n\nfunction getCacheEntry(key){\n  ensureCacheLoaded();\n  const entry = memoryCache.get(key);\n  if(!entry) return null;\n  const ts = Number(entry.ts);\n  if(!Number.isFinite(ts) || now() - ts > CACHE_TTL){\n    memoryCache.delete(key);\n    schedulePersist();\n    return null;\n  }\n  return entry;\n}\n\nfunction setCacheEntry(key, data){\n  ensureCacheLoaded();\n  memoryCache.set(key, { ts: now(), data });\n  pruneOverflow();\n  schedulePersist();\n}\n\nfunction pruneOverflow(){\n  if(memoryCache.size <= MAX_CACHE_ENTRIES) return;\n  const entries = Array.from(memoryCache.entries());\n  entries.sort((a, b) => {\n    const at = Number(a[1]?.ts || 0);\n    const bt = Number(b[1]?.ts || 0);\n    return bt - at;\n  });\n  const trimmed = entries.slice(0, MAX_CACHE_ENTRIES);\n  memoryCache = new Map(trimmed);\n}\n\nfunction schedulePersist(){\n  if(typeof localStorage === 'undefined') return;\n  if(persistTimer) return;\n  persistTimer = setTimeout(()=>{\n    persistTimer = null;\n    persistCache();\n  }, 120);\n}\n\nfunction persistCache(){\n  if(typeof localStorage === 'undefined') return;\n  const entries = Array.from(memoryCache.entries()).map(([key, entry])=>{\n    return [key, { ts: entry?.ts ?? now(), data: entry?.data ?? null }];\n  });\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));\n  } catch (err) {\n    logWarn('Failed to persist TMDB cache:', err?.message || err);\n  }\n}\n\nfunction parseRetryAfter(value){\n  if(!value) return 0;\n  const num = Number(value);\n  if(Number.isFinite(num)) return Math.max(0, num * 1000);\n  const date = Date.parse(value);\n  if(Number.isFinite(date)) return Math.max(0, date - now());\n  return 0;\n}\n\nfunction shouldRetryStatus(status){\n  return status === 429 || (status >= 500 && status < 600);\n}\n\nfunction isAbortError(err){\n  return err && (err.name === 'AbortError' || err.code === 'ABORT_ERR');\n}\n\nfunction shouldRetryError(err){\n  if(isAbortError(err)) return false;\n  if(err && typeof err === 'object'){\n    if(err.name === 'TypeError' && /network/i.test(err.message || '')) return true;\n    if(/network/i.test(err?.message || '')) return true;\n  }\n  return false;\n}\n\nfunction withAuth(url, auth){\n  if(!auth || !auth.value) return { url, init: { headers: { 'Accept': 'application/json' } } };\n  if(auth.kind === 'apikey'){\n    const sep = url.includes('?') ? '&' : '?';\n    return {\n      url: `${url}${sep}api_key=${encodeURIComponent(auth.value)}`,\n      init: { headers: { 'Accept': 'application/json' } }\n    };\n  }\n  return {\n    url,\n    init: {\n      headers: {\n        'Accept': 'application/json',\n        'Authorization': `Bearer ${auth.value}`\n      }\n    }\n  };\n}\n\nasync function throttle(){\n  refreshRateLimit();\n  const nowTs = now();\n  const waitInterval = Math.max(0, (lastRequestAt + MIN_REQUEST_INTERVAL) - nowTs);\n  const waitPenalty = Math.max(0, throttlePenaltyUntil - nowTs);\n  const wait = Math.max(waitInterval, waitPenalty);\n  if(wait > 0){\n    await delay(wait);\n  }\n  lastRequestAt = now();\n}\n\nasync function fetchJson(url, auth, { signal } = {}, attempt = 0){\n  const { url: finalUrl, init } = withAuth(url, auth);\n  const requestInit = { ...init, signal };\n  await throttle();\n  let response;\n  try {\n    response = await fetch(finalUrl, requestInit);\n  } catch (err) {\n    if(attempt < MAX_RETRIES && shouldRetryError(err)){\n      const wait = computeRetryDelay(attempt);\n      await delay(wait);\n      return fetchJson(url, auth, { signal }, attempt + 1);\n    }\n    throw err;\n  }\n  if(!response.ok){\n    const status = response.status;\n    const retryable = shouldRetryStatus(status) && attempt < MAX_RETRIES;\n    if(status === 429){\n      const retryAfter = parseRetryAfter(response.headers.get('retry-after'));\n      const wait = registerRateLimitHit(retryAfter, status);\n      if(retryable){\n        await delay(wait);\n        return fetchJson(url, auth, { signal }, attempt + 1);\n      }\n    } else if(retryable){\n      const wait = computeRetryDelay(attempt);\n      await delay(wait);\n      return fetchJson(url, auth, { signal }, attempt + 1);\n    }\n    const text = await response.text().catch(()=> '');\n    const err = new Error(`HTTP ${status}${text ? `: ${text}` : ''}`);\n    err.status = status;\n    if(status === 429) err.code = 'RATE_LIMIT';\n    throw err;\n  }\n  decayRateLimitStrikes();\n  refreshRateLimit();\n  return response.json();\n}\n\nfunction classifyCredential(raw, forcedKind){\n  if(!raw && raw !== 0) return null;\n  const value = String(raw || '').trim();\n  if(!value) return null;\n  const kind = forcedKind || (/^[a-f0-9]{32}$/i.test(value) ? 'apikey' : 'bearer');\n  return { kind, value };\n}\n\nfunction readLocalStorageToken(){\n  if(typeof localStorage === 'undefined') return '';\n  try {\n    const token = localStorage.getItem('tmdbToken');\n    return token || '';\n  } catch (err) {\n    logWarn('Failed to read tmdbToken from storage:', err?.message || err);\n    return '';\n  }\n}\n\nfunction parseCfg(text){\n  if(!text) return {};\n  const trimmed = text.trim();\n  if(!trimmed) return {};\n  if(trimmed.startsWith('{') || trimmed.startsWith('[')){\n    try {\n      const json = JSON.parse(trimmed);\n      if(json && typeof json === 'object') return json;\n    } catch (err) {\n      logWarn('Failed to parse config.cfg JSON:', err?.message || err);\n    }\n  }\n  const out = {};\n  trimmed.split(/\\r?\\n/).forEach(line => {\n    const clean = line.trim();\n    if(!clean || clean.startsWith('#') || clean.startsWith(';')) return;\n    const idx = clean.indexOf('=');\n    if(idx === -1) return;\n    const key = clean.slice(0, idx).trim();\n    const value = clean.slice(idx + 1).trim();\n    if(key) out[key] = value;\n  });\n  return out;\n}\n\nasync function loadConfigCfg(){\n  if(configPromise) return configPromise;\n  configPromise = (async ()=>{\n    if(typeof fetch !== 'function') return {};\n    try {\n      const response = await fetch('config.cfg', { cache: 'no-cache' });\n      if(!response.ok){\n        if(response.status !== 404){\n          logWarn(`Failed to load config.cfg (HTTP ${response.status})`);\n        }\n        return {};\n      }\n      const text = await response.text();\n      cachedConfig = parseCfg(text);\n      return cachedConfig;\n    } catch (err) {\n      logWarn('Error loading config.cfg:', err?.message || err);\n      return {};\n    }\n  })();\n  return configPromise;\n}\n\nfunction extractCredentialFromSettings(settings){\n  if(!settings || typeof settings !== 'object') return null;\n  if(settings.tmdbToken){\n    const token = classifyCredential(settings.tmdbToken, 'bearer');\n    if(token) return { ...token, source: 'settings.tmdbToken' };\n  }\n  if(settings.tmdbApiKey){\n    const key = classifyCredential(settings.tmdbApiKey, 'apikey');\n    if(key) return { ...key, source: 'settings.tmdbApiKey' };\n  }\n  return null;\n}\n\nfunction extractCredentialFromLocalStorage(){\n  const token = classifyCredential(readLocalStorageToken(), 'bearer');\n  if(token) return { ...token, source: 'localStorage.tmdbToken' };\n  return null;\n}\n\nfunction extractCredentialFromConfig(cfg){\n  if(!cfg || typeof cfg !== 'object') return null;\n  if(cfg.tmdbToken){\n    const token = classifyCredential(cfg.tmdbToken, 'bearer');\n    if(token) return { ...token, source: 'config.cfg.tmdbToken' };\n  }\n  if(cfg.tmdbApiKey){\n    const key = classifyCredential(cfg.tmdbApiKey, 'apikey');\n    if(key) return { ...key, source: 'config.cfg.tmdbApiKey' };\n  }\n  return null;\n}\n\nexport async function resolveAuth(settings={}, options={}){\n  if(options.credentials){\n    if(typeof options.credentials === 'string' || typeof options.credentials === 'number'){\n      const classified = classifyCredential(options.credentials);\n      if(classified) return { ...classified, source: 'explicit' };\n    } else if(options.credentials && typeof options.credentials === 'object' && options.credentials.value){\n      const classified = classifyCredential(options.credentials.value, options.credentials.kind);\n      if(classified) return { ...classified, source: options.credentials.source || 'explicit' };\n    }\n  }\n  const fromSettings = extractCredentialFromSettings(settings);\n  if(fromSettings) return fromSettings;\n  const fromLocalStorage = extractCredentialFromLocalStorage();\n  if(fromLocalStorage) return fromLocalStorage;\n  if(settings && settings.tmdbApiKey){\n    const key = classifyCredential(settings.tmdbApiKey, 'apikey');\n    if(key) return { ...key, source: 'settings.tmdbApiKey' };\n  }\n  const cfg = await loadConfigCfg().catch(()=> (cachedConfig || {}));\n  const fromCfg = extractCredentialFromConfig(cfg);\n  if(fromCfg) return fromCfg;\n  if(options.fallbackCredential){\n    const fallback = classifyCredential(options.fallbackCredential);\n    if(fallback) return { ...fallback, source: 'fallback' };\n  }\n  return null;\n}\n\nexport function getRateLimitState(){\n  return getRateLimitSnapshot();\n}\n\nexport function addRateLimitListener(listener){\n  if(typeof listener !== 'function') return () => {};\n  rateLimitListeners.add(listener);\n  try {\n    listener(getRateLimitSnapshot());\n  } catch (err) {\n    logWarn('Rate limit listener threw during init:', err?.message || err);\n  }\n  return () => rateLimitListeners.delete(listener);\n}\n\nexport function tmdbImageUrl(path, size='original'){\n  const raw = typeof path === 'string' ? path : '';\n  const trimmed = raw.trim();\n  if(!trimmed) return '';\n  const normalizedPath = trimmed.startsWith('/') ? trimmed : `/${trimmed}`;\n  const variant = String(size || 'original').trim() || 'original';\n  return `${IMG_BASE}${variant}${normalizedPath}`;\n}\n\nfunction cleanId(value){\n  if(value == null) return '';\n  const str = String(value).trim();\n  return str;\n}\n\nexport function clearCache(){\n  memoryCache.clear();\n  cacheLoaded = true;\n  if(typeof localStorage !== 'undefined'){\n    try {\n      localStorage.removeItem(STORAGE_KEY);\n    } catch (err) {\n      logWarn('Failed to clear TMDB cache from storage:', err?.message || err);\n    }\n  }\n}\n\nexport function getCached(type, id, language){\n  const key = getCacheKey(type, id, language);\n  const entry = getCacheEntry(key);\n  return entry ? { data: entry.data, fetchedAt: entry.ts } : null;\n}\n\nexport async function fetchDetails(type, id, options = {}){\n  const normalizedType = type === 'tv' ? 'tv' : 'movie';\n  const normalizedId = cleanId(id);\n  if(!normalizedId) return null;\n  const language = cleanId(options.language) || 'en-US';\n  const key = getCacheKey(normalizedType, normalizedId, language);\n  if(!options.forceRefresh){\n    const cached = getCacheEntry(key);\n    if(cached){\n      return {\n        id: normalizedId,\n        type: normalizedType,\n        language,\n        data: cached.data,\n        fetchedAt: cached.ts,\n        source: 'cache'\n      };\n    }\n  }\n  const auth = options.auth || await resolveAuth(options.settings, options.authOptions || {});\n  if(!auth){\n    logWarn('TMDB credentials missing; cannot fetch details.');\n    return null;\n  }\n  const url = `${API_BASE}/${normalizedType}/${encodeURIComponent(normalizedId)}?language=${encodeURIComponent(language)}&append_to_response=${APPEND_FIELDS}`;\n  let data;\n  try {\n    data = await fetchJson(url, auth, { signal: options.signal });\n  } catch (err) {\n    logWarn(`Failed to fetch TMDB ${normalizedType}#${normalizedId}:`, err?.message || err);\n    throw err;\n  }\n  setCacheEntry(key, data);\n  const entry = getCacheEntry(key);\n  return {\n    id: normalizedId,\n    type: normalizedType,\n    language,\n    data,\n    fetchedAt: entry?.ts || now(),\n    source: 'network'\n  };\n}\n\nfunction extractRawTitle(item){\n  if(!item || typeof item !== 'object') return '';\n  const candidates = [item.title, item.name, item.originalTitle, item.original_name, item.original_title];\n  for(const candidate of candidates){\n    const str = typeof candidate === 'string' ? candidate.trim() : '';\n    if(str) return str;\n  }\n  return '';\n}\n\nfunction parseYear(value){\n  if(value == null) return null;\n  const num = Number(value);\n  if(Number.isFinite(num) && num > 1800) return Math.trunc(num);\n  if(typeof value === 'string'){\n    const match = value.match(/(19|20|21)\\d{2}/);\n    if(match) return Number(match[0]);\n  }\n  return null;\n}\n\nfunction extractRawYear(item){\n  if(!item || typeof item !== 'object') return null;\n  const direct = parseYear(item.year ?? item.startYear);\n  if(direct) return direct;\n  const dateCandidate = item.originallyAvailableAt || item.premieredAt || item.releaseDate || item.firstAirDate;\n  const fromDate = parseYear(dateCandidate);\n  if(fromDate) return fromDate;\n  return null;\n}\n\nasync function fetchByExternalId(type, imdbId, options){\n  const language = options.language || 'en-US';\n  const url = `${API_BASE}/find/${encodeURIComponent(imdbId)}?external_source=imdb_id&language=${encodeURIComponent(language)}`;\n  const json = await fetchJson(url, options.auth, { signal: options.signal });\n  const key = type === 'tv' ? 'tv_results' : 'movie_results';\n  const results = Array.isArray(json?.[key]) ? json[key] : [];\n  const hit = results.find(entry => entry && entry.id != null);\n  if(!hit || hit.id == null) return null;\n  const resolvedId = String(hit.id);\n  const details = await fetchDetails(type, resolvedId, options);\n  if(details){\n    details.id = resolvedId;\n    details.resolvedId = resolvedId;\n  }\n  return details;\n}\n\nfunction buildSearchUrl(type, title, language, year){\n  const encodedTitle = encodeURIComponent(title);\n  const lang = encodeURIComponent(language || 'en-US');\n  const base = `${API_BASE}/search/${type}?query=${encodedTitle}&language=${lang}`;\n  if(!year) return base;\n  const param = type === 'tv' ? 'first_air_date_year' : 'year';\n  return `${base}&${param}=${encodeURIComponent(String(year))}`;\n}\n\nasync function fetchBySearch(type, title, year, options){\n  if(!title) return null;\n  const language = options.language || 'en-US';\n  const url = buildSearchUrl(type, title, language, year);\n  const json = await fetchJson(url, options.auth, { signal: options.signal });\n  const results = Array.isArray(json?.results) ? json.results : [];\n  if(!results.length) return null;\n  const hit = results.find(entry => entry && entry.id != null) || results[0];\n  if(!hit || hit.id == null) return null;\n  const resolvedId = String(hit.id);\n  const details = await fetchDetails(type, resolvedId, options);\n  if(details){\n    details.id = resolvedId;\n    details.resolvedId = resolvedId;\n  }\n  return details;\n}\n\nfunction extractIds(item){\n  const ids = { tmdb: '', imdb: '' };\n  if(!item || typeof item !== 'object') return ids;\n  const merge = (guid)=>{\n    const raw = typeof guid === 'string' ? guid : guid?.id;\n    if(!raw) return;\n    const str = String(raw).trim();\n    if(!str) return;\n    const [schemePart, restPart] = str.split('://');\n    if(!restPart){\n      if(str.startsWith('tt')) ids.imdb = str;\n      return;\n    }\n    const scheme = schemePart.toLowerCase();\n    const rest = restPart.split('?')[0].replace(/^\\//, '');\n    const tail = rest.split('/').pop();\n    if(scheme === 'imdb' || scheme.includes('imdb')){\n      ids.imdb = tail || ids.imdb;\n      return;\n    }\n    if(scheme === 'tmdb' || scheme.includes('themoviedb')){\n      ids.tmdb = tail || ids.tmdb;\n      return;\n    }\n  };\n  if(item.ids && typeof item.ids === 'object'){\n    if(item.ids.tmdb) ids.tmdb = cleanId(item.ids.tmdb);\n    if(item.ids.imdb) ids.imdb = cleanId(item.ids.imdb);\n  }\n  merge(item.guid);\n  if(Array.isArray(item.guids)) item.guids.forEach(merge);\n  return ids;\n}\n\nfunction buildSearchTitleOverride(raw, options){\n  const preferred = cleanId(options?.searchTitle);\n  if(preferred) return preferred;\n  return extractRawTitle(raw);\n}\n\nexport async function fetchDetailsForItem(raw, options = {}){\n  if(!raw || typeof raw !== 'object') return null;\n  const type = raw.type === 'tv' ? 'tv' : 'movie';\n  const language = cleanId(options.language) || 'en-US';\n  const auth = options.auth || await resolveAuth(options.settings, options.authOptions || {});\n  if(!auth){\n    logWarn('Skipping TMDB lookup (missing credentials).');\n    return null;\n  }\n  const baseOptions = { ...options, auth, language };\n  const ids = extractIds(raw);\n  const attempts = [];\n\n  if(ids.tmdb){\n    attempts.push({ label: 'direct id', fn: ()=> fetchDetails(type, ids.tmdb, baseOptions) });\n  }\n  if(ids.imdb){\n    attempts.push({ label: 'imdb find', fn: ()=> fetchByExternalId(type, ids.imdb, baseOptions) });\n  }\n  const searchTitle = buildSearchTitleOverride(raw, options);\n  if(searchTitle){\n    const searchYear = options.searchYear ?? extractRawYear(raw);\n    attempts.push({ label: 'search', fn: ()=> fetchBySearch(type, searchTitle, searchYear, baseOptions) });\n  }\n\n  for(const attempt of attempts){\n    try {\n      const result = await attempt.fn();\n      if(result){\n        if(!result.resolvedId && result.id) result.resolvedId = result.id;\n        return result;\n      }\n    } catch (err) {\n      logWarn(`TMDB ${attempt.label} lookup failed:`, err?.message || err);\n    }\n  }\n  return null;\n}\n\n// Periodically prune expired entries\nsetInterval(()=>{ try { pruneExpired(); } catch(_err){} }, CACHE_TTL / 6).unref?.();\n\nexport default {\n  fetchDetails,\n  fetchDetailsForItem,\n  resolveAuth,\n  clearCache,\n  getCached,\n  tmdbImageUrl,\n  getRateLimitState,\n  addRateLimitListener\n};\n", "import { fetchDetailsForItem, tmdbImageUrl } from './tmdbClient.js';\n\nconst LOG_PREFIX = '[hero:normalizer]';\nconst BACKDROP_MIN_WIDTH = 1920;\nconst TMDB_BACKDROP_SIZE = 'original';\n\nfunction logWarn(...args){\n  try {\n    console.warn(LOG_PREFIX, ...args);\n  } catch (_err) {\n    // ignore\n  }\n}\n\nfunction cleanString(value){\n  if(typeof value !== 'string') return '';\n  const trimmed = value.trim();\n  return trimmed;\n}\n\nfunction nonEmptyString(value){\n  const str = cleanString(value);\n  return str ? str : '';\n}\n\nfunction parseYear(value){\n  if(value == null) return null;\n  if(typeof value === 'number' && Number.isFinite(value)){\n    if(value > 1800 && value < 9999) return Math.trunc(value);\n  }\n  if(typeof value === 'string'){\n    const match = value.match(/(19|20|21)\\d{2}/);\n    if(match) return Number(match[0]);\n  }\n  return null;\n}\n\nfunction parseDateYear(value){\n  if(!value) return null;\n  try {\n    const date = new Date(value);\n    if(Number.isNaN(date.getTime())) return null;\n    const y = date.getUTCFullYear();\n    return y > 1800 && y < 9999 ? y : null;\n  } catch (_err) {\n    return null;\n  }\n}\n\nfunction clampRating(value){\n  const num = Number(value);\n  if(!Number.isFinite(num) || num <= 0) return null;\n  return Math.round(num * 10) / 10;\n}\n\nfunction minutesFromDuration(raw){\n  if(raw == null) return null;\n  const num = Number(raw);\n  if(Number.isFinite(num) && num > 0){\n    if(num > 1000){\n      return Math.max(1, Math.round(num / 60_000));\n    }\n    return Math.round(num);\n  }\n  return null;\n}\n\nfunction collectGenres(raw, tmdb){\n  const names = [];\n  if(tmdb && Array.isArray(tmdb.genres)){\n    for(const entry of tmdb.genres){\n      if(entry && typeof entry === 'object' && entry.name){\n        const str = cleanString(entry.name);\n        if(str) names.push(str);\n      }\n    }\n  }\n  const rawGenres = raw?.genres;\n  if(Array.isArray(rawGenres)){\n    rawGenres.forEach(entry => {\n      if(!entry) return;\n      if(typeof entry === 'string'){\n        const str = cleanString(entry);\n        if(str) names.push(str);\n        return;\n      }\n      const str = cleanString(entry.tag || entry.title || entry.label || entry.name);\n      if(str) names.push(str);\n    });\n  }\n  const seen = new Set();\n  const result = [];\n  for(const name of names){\n    const key = name.toLowerCase();\n    if(seen.has(key)) continue;\n    seen.add(key);\n    result.push(name);\n  }\n  return result.slice(0, 2);\n}\n\nfunction extractIds(raw){\n  const ids = {};\n  const set = (key, value)=>{\n    if(value == null) return;\n    const input = typeof value === 'string' ? value : String(value);\n    const str = nonEmptyString(input);\n    if(str) ids[key] = str;\n  };\n  if(raw && typeof raw === 'object'){\n    if(raw.ratingKey != null) set('ratingKey', raw.ratingKey);\n    if(raw.ids && typeof raw.ids === 'object'){\n      set('tmdb', raw.ids.tmdb);\n      set('imdb', raw.ids.imdb);\n    }\n    const mergeGuid = (guid)=>{\n      const rawGuid = typeof guid === 'string' ? guid : guid?.id;\n      const str = nonEmptyString(rawGuid);\n      if(!str) return;\n      const [schemePart, restPart] = str.split('://');\n      if(restPart){\n        const scheme = schemePart.toLowerCase();\n        const rest = restPart.split('?')[0].replace(/^\\//, '');\n        const tail = rest.split('/').pop();\n        if(scheme === 'imdb' || scheme.includes('imdb')){ set('imdb', tail); return; }\n        if(scheme === 'tmdb' || scheme.includes('themoviedb')){ set('tmdb', tail); return; }\n        if(scheme === 'tvdb' || scheme.includes('thetvdb')){ set('tvdb', tail); return; }\n      } else if(str.startsWith('tt')){\n        set('imdb', str);\n      }\n    };\n    mergeGuid(raw.guid);\n    if(Array.isArray(raw.guids)) raw.guids.forEach(mergeGuid);\n  }\n  return ids;\n}\n\nfunction chooseTitle(raw, tmdb, type){\n  if(tmdb){\n    if(type === 'tv'){\n      const candidates = [tmdb.name, tmdb.original_name];\n      for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\n    } else {\n      const candidates = [tmdb.title, tmdb.original_title];\n      for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\n    }\n  }\n  if(raw){\n    const candidates = [raw.title, raw.name, raw.originalTitle];\n    for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\n  }\n  return '';\n}\n\nfunction chooseTagline(raw, tmdb){\n  const candidates = [tmdb?.tagline, raw?.tagline];\n  for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\n  return '';\n}\n\nfunction chooseOverview(raw, tmdb){\n  const candidates = [tmdb?.overview, raw?.summary, raw?.plot, raw?.description];\n  for(const c of candidates){ const str = nonEmptyString(c); if(str) return str; }\n  return '';\n}\n\nfunction chooseYear(raw, tmdb, type){\n  if(tmdb){\n    const primary = type === 'tv' ? tmdb.first_air_date : tmdb.release_date;\n    const y = parseYear(primary) ?? parseDateYear(primary);\n    if(y) return y;\n    const secondary = type === 'tv' ? tmdb.last_air_date : tmdb.release_date;\n    const y2 = parseYear(secondary) ?? parseDateYear(secondary);\n    if(y2) return y2;\n  }\n  const fromRaw = parseYear(raw?.year) ?? parseDateYear(raw?.originallyAvailableAt);\n  if(fromRaw) return fromRaw;\n  return null;\n}\n\nfunction chooseRuntime(raw, tmdb, type){\n  if(tmdb){\n    if(type === 'tv' && Array.isArray(tmdb.episode_run_time) && tmdb.episode_run_time.length){\n      const first = minutesFromDuration(tmdb.episode_run_time.find(v => minutesFromDuration(v)));\n      if(first) return first;\n    }\n    if(type === 'movie'){\n      const minutes = minutesFromDuration(tmdb.runtime);\n      if(minutes) return minutes;\n    }\n  }\n  if(type === 'movie'){\n    const fromRaw = minutesFromDuration(raw?.durationMin ?? raw?.duration);\n    if(fromRaw) return fromRaw;\n  } else if(type === 'tv'){\n    if(Array.isArray(raw?.seasons)){\n      for(const season of raw.seasons){\n        if(!Array.isArray(season?.episodes)) continue;\n        for(const ep of season.episodes){\n          const minutes = minutesFromDuration(ep?.durationMin ?? ep?.duration);\n          if(minutes) return minutes;\n        }\n      }\n    }\n    const fallback = minutesFromDuration(raw?.durationMin ?? raw?.duration);\n    if(fallback) return fallback;\n  }\n  return null;\n}\n\nfunction chooseRating(raw, tmdb){\n  const fromTmdb = clampRating(tmdb?.vote_average);\n  if(fromTmdb) return fromTmdb;\n  const fromRaw = clampRating(raw?.rating ?? raw?.audienceRating);\n  if(fromRaw) return fromRaw;\n  return null;\n}\n\nfunction chooseVoteCount(tmdb){\n  const num = Number(tmdb?.vote_count);\n  if(Number.isFinite(num) && num > 0) return Math.round(num);\n  return null;\n}\n\nfunction chooseCertification(raw, tmdb, type){\n  if(type === 'movie' && tmdb?.release_dates?.results){\n    const releases = Array.isArray(tmdb.release_dates.results) ? tmdb.release_dates.results : [];\n    const us = releases.find(entry => entry && entry.iso_3166_1 === 'US');\n    const dates = Array.isArray(us?.release_dates) ? us.release_dates : [];\n    const sorted = dates.filter(entry => nonEmptyString(entry?.certification)).sort((a, b)=>{\n      const at = Number(a?.type ?? 0);\n      const bt = Number(b?.type ?? 0);\n      return at - bt;\n    });\n    if(sorted.length){\n      const cert = nonEmptyString(sorted.find(entry => entry.type === 3)?.certification || sorted[0].certification);\n      if(cert) return cert;\n    }\n  }\n  if(type === 'tv' && Array.isArray(tmdb?.content_ratings?.results)){\n    const us = tmdb.content_ratings.results.find(entry => entry && entry.iso_3166_1 === 'US');\n    const rating = nonEmptyString(us?.rating);\n    if(rating) return rating;\n  }\n  const rawRating = nonEmptyString(raw?.contentRating);\n  if(rawRating){\n    const match = rawRating.split('/').pop();\n    const cleaned = nonEmptyString(match);\n    if(cleaned) return cleaned;\n  }\n  return '';\n}\n\nfunction extractBackdrops(tmdb, raw){\n  const urls = [];\n\n  // Primary: TMDB backdrops (best quality)\n  const tmdbList = Array.isArray(tmdb?.images?.backdrops) ? tmdb.images.backdrops : [];\n  for(const backdrop of tmdbList){\n    if(!backdrop || !backdrop.file_path) continue;\n    if(backdrop.width && backdrop.width < BACKDROP_MIN_WIDTH) continue;\n    const url = tmdbImageUrl(backdrop.file_path, TMDB_BACKDROP_SIZE);\n    if(!url) continue;\n    if(!urls.includes(url)) urls.push(url);\n  }\n\n  // Fallback: Plex images if no TMDB backdrops available\n  if(urls.length === 0 && raw){\n    const plexBackdrop = raw.art || raw.thumb || raw.thumbFile || raw.backdrop;\n    if(plexBackdrop && typeof plexBackdrop === 'string'){\n      const trimmed = plexBackdrop.trim();\n      if(trimmed && !urls.includes(trimmed)){\n        urls.push(trimmed);\n      }\n    }\n  }\n\n  return urls;\n}\n\nfunction computeTvCounts(raw, tmdb){\n  const result = { seasons: null, episodes: null };\n  if(Number.isFinite(tmdb?.number_of_seasons)) result.seasons = Math.max(0, Math.round(tmdb.number_of_seasons));\n  if(Number.isFinite(tmdb?.number_of_episodes)) result.episodes = Math.max(0, Math.round(tmdb.number_of_episodes));\n  if(result.seasons == null && Array.isArray(raw?.seasons)) result.seasons = raw.seasons.length;\n  if(result.episodes == null && Array.isArray(raw?.seasons)){\n    let count = 0;\n    raw.seasons.forEach(season => { if(Array.isArray(season?.episodes)) count += season.episodes.length; });\n    if(count > 0) result.episodes = count;\n  }\n  return result;\n}\n\nfunction buildCta(type, ids){\n  if(!ids || typeof ids !== 'object') return null;\n  const preferred = ids.tmdb || ids.imdb || ids.ratingKey;\n  const targetId = nonEmptyString(preferred);\n  if(!targetId) return null;\n  const kind = type === 'tv' ? 'show' : 'movie';\n  const label = kind === 'show' ? 'Show details' : 'Movie details';\n  return {\n    id: targetId,\n    kind,\n    label,\n    target: `#/${kind}/${targetId}`\n  };\n}\n\nfunction finalizeIds(ids){\n  const out = {};\n  Object.entries(ids || {}).forEach(([key, value]) => {\n    const str = nonEmptyString(value);\n    if(str) out[key] = str;\n  });\n  return out;\n}\n\nfunction ensureId(ids, type){\n  if(ids.ratingKey) return ids.ratingKey;\n  if(ids.tmdb) return `${type}-${ids.tmdb}`;\n  if(ids.imdb) return `${type}-${ids.imdb}`;\n  return '';\n}\n\nexport async function normalizeItem(raw, options = {}){\n  if(!raw || typeof raw !== 'object') return null;\n  const type = raw.type === 'tv' ? 'tv' : 'movie';\n  const language = nonEmptyString(options.language) || 'en-US';\n  let ids = extractIds(raw);\n\n  let tmdbBundle = null;\n  if(options.disableTmdb !== true){\n    try {\n      tmdbBundle = await fetchDetailsForItem(raw, {\n        language,\n        settings: options.settings,\n        auth: options.auth,\n        authOptions: options.authOptions,\n        signal: options.signal,\n        searchTitle: options.searchTitle,\n        searchYear: options.searchYear\n      });\n    } catch (err) {\n      logWarn('TMDB lookup failed:', err?.message || err);\n    }\n  }\n  const tmdbData = tmdbBundle?.data;\n  if(tmdbBundle?.resolvedId){\n    if(!ids.tmdb) ids.tmdb = String(tmdbBundle.resolvedId);\n  }\n  if(tmdbData?.id && !ids.tmdb){\n    ids.tmdb = String(tmdbData.id);\n  }\n  if(tmdbData?.imdb_id && !ids.imdb){\n    ids.imdb = String(tmdbData.imdb_id).trim();\n  }\n  ids = finalizeIds(ids);\n\n  const title = chooseTitle(raw, tmdbData, type);\n  if(!title){\n    logWarn('Skipping item without title', raw?.ratingKey || raw?.title || raw?.guid || 'unknown');\n    return null;\n  }\n\n  const normalized = {\n    id: ensureId(ids, type) || String(raw.ratingKey ?? raw.guid ?? title),\n    type,\n    title\n  };\n\n  const tagline = chooseTagline(raw, tmdbData);\n  if(tagline) normalized.tagline = tagline;\n\n  const overview = chooseOverview(raw, tmdbData);\n  if(overview) normalized.overview = overview;\n\n  const year = chooseYear(raw, tmdbData, type);\n  if(year) normalized.year = year;\n\n  const runtime = chooseRuntime(raw, tmdbData, type);\n  if(runtime) normalized.runtime = runtime;\n\n  const rating = chooseRating(raw, tmdbData);\n  if(rating != null) normalized.rating = rating;\n\n  const voteCount = chooseVoteCount(tmdbData);\n  if(voteCount != null) normalized.voteCount = voteCount;\n\n  const genres = collectGenres(raw, tmdbData);\n  if(genres.length) normalized.genres = genres;\n\n  const certification = chooseCertification(raw, tmdbData, type);\n  if(certification) normalized.certification = certification;\n\n  const backdrops = extractBackdrops(tmdbData, raw);\n  if(backdrops.length) normalized.backdrops = backdrops;\n\n  if(type === 'tv'){\n    const counts = computeTvCounts(raw, tmdbData);\n    if(counts.seasons != null) normalized.seasons = counts.seasons;\n    if(counts.episodes != null) normalized.episodes = counts.episodes;\n  }\n\n  const cta = buildCta(type, ids);\n  if(cta) normalized.cta = cta;\n\n  if(Object.keys(ids).length) normalized.ids = ids;\n  normalized.language = language;\n\n  if(tmdbBundle){\n    const tmdbMeta = {\n      id: ids.tmdb || (tmdbBundle.id ? String(tmdbBundle.id) : ''),\n      fetchedAt: tmdbBundle.fetchedAt || Date.now(),\n      source: tmdbBundle.source\n    };\n    if(!tmdbMeta.id) delete tmdbMeta.id;\n    if(!tmdbMeta.source) delete tmdbMeta.source;\n    if(options.includeTmdbRaw && tmdbData) tmdbMeta.raw = tmdbData;\n    if(Object.keys(tmdbMeta).length) normalized.tmdb = tmdbMeta;\n  }\n\n  if(options.includeSource) normalized.source = raw;\n\n  return normalized;\n}\n\nexport async function normalizeItems(items, options = {}){\n  if(!Array.isArray(items)) return [];\n  const out = [];\n  for(const item of items){\n    const normalized = await normalizeItem(item, options);\n    if(normalized) out.push(normalized);\n  }\n  return out;\n}\n\nexport default {\n  normalizeItem,\n  normalizeItems\n};\n", "const LOG_PREFIX = '[hero:storage]';\nconst POOL_PREFIX = 'heroPool:';\nconst HISTORY_PREFIX = 'heroHistory:';\nconst MEMORY_PREFIX = 'heroMemory:';\nconst FAILURE_PREFIX = 'heroFailures:';\nconst SESSION_SUFFIX = ':session';\nconst HISTORY_LIMIT = 80;\nconst HISTORY_WINDOW_MS = 1000 * 60 * 60 * 24 * 14; // 14 days\nconst MEMORY_LIMIT = 120;\nconst FAILURE_LIMIT = 80;\n\nfunction now(){\n  return Date.now();\n}\n\nfunction safeArea(name){\n  try {\n    if(typeof globalThis !== 'undefined' && globalThis[name]){\n      return globalThis[name];\n    }\n  } catch (err) {\n    console.warn(LOG_PREFIX, `Failed to resolve storage area ${name}:`, err?.message || err);\n  }\n  return null;\n}\n\nfunction readRaw(area, key){\n  if(!area) return null;\n  try {\n    return area.getItem(key);\n  } catch (err) {\n    console.warn(LOG_PREFIX, `Failed to read ${key} from storage:`, err?.message || err);\n    return null;\n  }\n}\n\nfunction writeRaw(area, key, value){\n  if(!area) return;\n  try {\n    if(value == null){\n      area.removeItem(key);\n    } else {\n      area.setItem(key, value);\n    }\n  } catch (err) {\n    console.warn(LOG_PREFIX, `Failed to write ${key} to storage:`, err?.message || err);\n  }\n}\n\nfunction parseJson(raw){\n  if(!raw) return null;\n  try {\n    return JSON.parse(raw);\n  } catch (err) {\n    console.warn(LOG_PREFIX, 'Failed to parse storage JSON:', err?.message || err);\n    return null;\n  }\n}\n\nfunction stringifyJson(value){\n  try {\n    return JSON.stringify(value);\n  } catch (err) {\n    console.warn(LOG_PREFIX, 'Failed to stringify storage payload:', err?.message || err);\n    return null;\n  }\n}\n\nfunction normalizeKind(kind){\n  if(kind === 'shows' || kind === 'show' || kind === 'series') return 'series';\n  return 'movies';\n}\n\nfunction poolKey(kind){\n  return `${POOL_PREFIX}${normalizeKind(kind)}`;\n}\n\nfunction sessionPoolKey(kind){\n  return `${poolKey(kind)}${SESSION_SUFFIX}`;\n}\n\nfunction historyKey(kind){\n  return `${HISTORY_PREFIX}${normalizeKind(kind)}`;\n}\n\nfunction memoryKey(kind){\n  return `${MEMORY_PREFIX}${normalizeKind(kind)}`;\n}\n\nfunction failureKey(kind){\n  return `${FAILURE_PREFIX}${normalizeKind(kind)}`;\n}\n\nfunction readPoolFrom(area, key){\n  const raw = readRaw(area, key);\n  if(!raw) return null;\n  const parsed = parseJson(raw);\n  if(!parsed || typeof parsed !== 'object') return null;\n  return parsed;\n}\n\nfunction writePoolTo(area, key, payload){\n  const json = stringifyJson(payload);\n  if(json == null) return;\n  writeRaw(area, key, json);\n}\n\nfunction readMemory(kind){\n  const { local } = resolveAreas();\n  const key = memoryKey(kind);\n  const raw = readPoolFrom(local, key);\n  if(!Array.isArray(raw)) return [];\n  return raw.map(entry => ({\n    id: typeof entry?.id === 'string' ? entry.id : String(entry?.id || ''),\n    ts: Number(entry?.ts ?? entry?.timestamp ?? entry?.time ?? 0),\n    slot: typeof entry?.slot === 'string' ? entry.slot : (entry?.slot != null ? String(entry.slot) : undefined)\n  })).filter(entry => entry.id && Number.isFinite(entry.ts));\n}\n\nfunction writeMemory(kind, entries){\n  const payload = Array.isArray(entries) ? entries.map(entry => ({\n    id: entry.id,\n    ts: entry.ts,\n    slot: entry.slot\n  })) : [];\n  const json = stringifyJson(payload);\n  if(json == null) return;\n  const { local, session } = resolveAreas();\n  const key = memoryKey(kind);\n  writeRaw(local, key, json);\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, json);\n}\n\nfunction readFailures(kind){\n  const { local } = resolveAreas();\n  const key = failureKey(kind);\n  const raw = readPoolFrom(local, key);\n  if(!Array.isArray(raw)) return [];\n  return raw.map(entry => ({\n    id: typeof entry?.id === 'string' ? entry.id : String(entry?.id || ''),\n    ts: Number(entry?.ts ?? entry?.timestamp ?? entry?.time ?? 0),\n    reason: typeof entry?.reason === 'string' ? entry.reason : '',\n    hits: Number(entry?.hits) || 0\n  })).filter(entry => entry.id && Number.isFinite(entry.ts));\n}\n\nfunction writeFailures(kind, entries){\n  const payload = Array.isArray(entries) ? entries.map(entry => ({\n    id: entry.id,\n    ts: entry.ts,\n    reason: entry.reason || '',\n    hits: Number(entry.hits) || 0\n  })) : [];\n  const json = stringifyJson(payload);\n  if(json == null) return;\n  const { local, session } = resolveAreas();\n  const key = failureKey(kind);\n  writeRaw(local, key, json);\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, json);\n}\n\nfunction resolveAreas(){\n  return {\n    local: safeArea('localStorage'),\n    session: safeArea('sessionStorage')\n  };\n}\n\nfunction clonePoolData(data){\n  if(!data || typeof data !== 'object') return null;\n  const copy = {\n    kind: normalizeKind(data.kind || data.library || data.type),\n    items: Array.isArray(data.items) ? data.items.slice() : [],\n    updatedAt: Number(data.updatedAt) || now(),\n    expiresAt: Number(data.expiresAt) || 0,\n    policyHash: typeof data.policyHash === 'string' ? data.policyHash : '',\n    slotSummary: data.slotSummary && typeof data.slotSummary === 'object' ? { ...data.slotSummary } : {},\n    meta: data.meta && typeof data.meta === 'object' ? { ...data.meta } : undefined\n  };\n  if(data.generatedAt && !copy.updatedAt){\n    copy.updatedAt = Number(data.generatedAt) || copy.updatedAt;\n  }\n  return copy;\n}\n\nexport function getStoredPool(kind, { now: nowTs = now(), policyHash = null, allowExpired = false } = {}){\n  const { local, session } = resolveAreas();\n  const key = poolKey(kind);\n  const sessionKey = sessionPoolKey(kind);\n  const sessionPool = readPoolFrom(session, sessionKey);\n  const localPool = readPoolFrom(local, key);\n  const source = sessionPool || localPool || null;\n  if(!source) return null;\n  const pool = clonePoolData(source);\n  if(!pool) return null;\n  const expiry = Number(pool.expiresAt) || 0;\n  const valid = expiry > nowTs;\n  const matchesPolicy = policyHash ? pool.policyHash === policyHash : true;\n  if(!allowExpired && !valid) return null;\n  if(policyHash && !matchesPolicy) return null;\n  pool.isExpired = !valid;\n  pool.matchesPolicy = matchesPolicy;\n  pool.source = sessionPool ? 'session' : 'local';\n  return pool;\n}\n\nexport function storePool(kind, data){\n  const { local, session } = resolveAreas();\n  if(!data || typeof data !== 'object'){\n    invalidatePool(kind);\n    return;\n  }\n  const payload = clonePoolData({ ...data, kind });\n  if(!payload) return;\n  const key = poolKey(kind);\n  const sessionKey = sessionPoolKey(kind);\n  const json = stringifyJson(payload);\n  if(json == null) return;\n  writeRaw(local, key, json);\n  writeRaw(session, sessionKey, json);\n}\n\nexport function invalidatePool(kind){\n  const { local, session } = resolveAreas();\n  const key = poolKey(kind);\n  const sessionKey = sessionPoolKey(kind);\n  writeRaw(local, key, null);\n  writeRaw(session, sessionKey, null);\n}\n\nfunction readHistory(kind){\n  const { local } = resolveAreas();\n  const key = historyKey(kind);\n  const raw = readPoolFrom(local, key);\n  if(!Array.isArray(raw)) return [];\n  return raw.map(entry => ({\n    id: typeof entry?.id === 'string' ? entry.id : String(entry?.id || ''),\n    ts: Number(entry?.ts ?? entry?.timestamp ?? entry?.time ?? entry?.at)\n  })).filter(entry => entry.id && Number.isFinite(entry.ts));\n}\n\nfunction writeHistory(kind, entries){\n  const { local, session } = resolveAreas();\n  const key = historyKey(kind);\n  const payload = Array.isArray(entries) ? entries.map(entry => ({ id: entry.id, ts: entry.ts })) : [];\n  const json = stringifyJson(payload);\n  if(json == null) return;\n  writeRaw(local, key, json);\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, json);\n}\n\nfunction resolveEntryKey(entry){\n  if(!entry) return null;\n  if(typeof entry === 'string') return entry.trim() || null;\n  if(typeof entry === 'number') return `#${entry}`;\n  if(entry && typeof entry === 'object'){\n    if(entry.poolId != null) return String(entry.poolId);\n    if(entry.poolEntryId != null) return String(entry.poolEntryId);\n    if(entry.heroId != null) return String(entry.heroId);\n    if(entry.cta && entry.cta.id != null) return String(entry.cta.id);\n    if(entry.ids && typeof entry.ids === 'object'){\n      if(entry.ids.imdb) return `imdb:${entry.ids.imdb}`;\n      if(entry.ids.tmdb) return `tmdb:${entry.ids.tmdb}`;\n      if(entry.ids.tvdb) return `tvdb:${entry.ids.tvdb}`;\n    }\n    if(entry.guid) return String(entry.guid);\n    if(entry.ratingKey != null) return `rk:${entry.ratingKey}`;\n    if(entry.id != null) return String(entry.id);\n    if(entry.slug) return String(entry.slug);\n    if(entry.key) return String(entry.key);\n    if(entry.title){\n      const suffix = entry.year ? `:${entry.year}` : '';\n      return `title:${entry.title}${suffix}`;\n    }\n  }\n  return null;\n}\n\nfunction resolveHistoryId(entry){\n  return resolveEntryKey(entry);\n}\n\nexport function recordHeroHistory(kind, entry, { timestamp = now(), limit = HISTORY_LIMIT } = {}){\n  const id = resolveHistoryId(entry);\n  if(!id) return null;\n  const list = readHistory(kind);\n  const filtered = list.filter(item => item.id !== id);\n  filtered.unshift({ id, ts: timestamp });\n  const pruned = filtered\n    .filter(item => timestamp - item.ts <= HISTORY_WINDOW_MS)\n    .slice(0, Math.max(1, limit));\n  writeHistory(kind, pruned);\n  return pruned;\n}\n\nexport function getHeroHistory(kind, { now: nowTs = now(), windowMs = HISTORY_WINDOW_MS, limit = HISTORY_LIMIT } = {}){\n  const list = readHistory(kind);\n  if(!list.length) return { entries: [], set: new Set() };\n  const threshold = nowTs - Math.max(0, windowMs);\n  const seen = new Set();\n  const entries = [];\n  for(const item of list){\n    if(!item || !item.id) continue;\n    if(item.ts < threshold) continue;\n    if(seen.has(item.id)) continue;\n    seen.add(item.id);\n    entries.push({ id: item.id, ts: item.ts });\n    if(entries.length >= limit) break;\n  }\n  return { entries, set: seen };\n}\n\nexport function recordHeroMemory(kind, entries, { timestamp = now(), ttlMs = 0, limit = MEMORY_LIMIT } = {}){\n  if(!Array.isArray(entries) || !entries.length) return [];\n  const threshold = ttlMs > 0 ? Math.max(0, timestamp - ttlMs) : 0;\n  const list = readMemory(kind);\n  const seen = new Set();\n  const preserved = [];\n  for(const item of list){\n    if(!item || !item.id) continue;\n    if(threshold && item.ts < threshold) continue;\n    if(seen.has(item.id)) continue;\n    seen.add(item.id);\n    preserved.push(item);\n  }\n  const additions = [];\n  const additionIds = new Set();\n  for(const entry of entries){\n    const id = resolveEntryKey(entry);\n    if(!id) continue;\n    const slot = typeof entry?.slot === 'string' ? entry.slot : (entry?.poolSlot ? String(entry.poolSlot) : undefined);\n    additions.push({ id, ts: timestamp, slot });\n    additionIds.add(id);\n  }\n  const filteredPreserved = preserved.filter(item => !additionIds.has(item.id));\n  const merged = [...additions, ...filteredPreserved].filter(item => item && item.id);\n  const limited = merged.slice(0, Math.max(1, limit));\n  const deduped = [];\n  const finalSeen = new Set();\n  for(const item of limited){\n    if(finalSeen.has(item.id)) continue;\n    finalSeen.add(item.id);\n    deduped.push(item);\n  }\n  writeMemory(kind, deduped);\n  return deduped;\n}\n\nexport function getHeroMemory(kind, { now: nowTs = now(), windowMs = 0, limit = MEMORY_LIMIT } = {}){\n  const list = readMemory(kind);\n  if(!list.length) return { entries: [], set: new Set() };\n  const threshold = windowMs > 0 ? Math.max(0, nowTs - windowMs) : 0;\n  const seen = new Set();\n  const entries = [];\n  for(const item of list){\n    if(!item || !item.id) continue;\n    if(threshold && item.ts < threshold) continue;\n    if(seen.has(item.id)) continue;\n    seen.add(item.id);\n    entries.push({ id: item.id, ts: item.ts, slot: item.slot });\n    if(entries.length >= limit) break;\n  }\n  return { entries, set: seen };\n}\n\nexport function clearHeroMemory(kind){\n  const { local, session } = resolveAreas();\n  const key = memoryKey(kind);\n  writeRaw(local, key, null);\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, null);\n}\n\nexport function recordHeroFailure(kind, entry, { timestamp = now(), ttlMs = 0, limit = FAILURE_LIMIT, reason = '' } = {}){\n  const id = resolveEntryKey(entry);\n  if(!id) return null;\n  const threshold = ttlMs > 0 ? Math.max(0, timestamp - ttlMs) : 0;\n  const list = readFailures(kind);\n  const filtered = [];\n  let hits = 0;\n  for(const item of list){\n    if(!item || !item.id) continue;\n    if(item.id === id){\n      hits = (item.hits || 0) + 1;\n      continue;\n    }\n    if(threshold && item.ts < threshold) continue;\n    filtered.push(item);\n  }\n  const payload = { id, ts: timestamp, reason: reason || '', hits };\n  filtered.unshift(payload);\n  const limited = filtered.slice(0, Math.max(1, limit));\n  writeFailures(kind, limited);\n  return payload;\n}\n\nexport function resolveHeroFailure(kind, entry){\n  const id = resolveEntryKey(entry);\n  if(!id) return;\n  const list = readFailures(kind);\n  const filtered = list.filter(item => item && item.id !== id);\n  if(filtered.length === list.length) return;\n  writeFailures(kind, filtered);\n}\n\nexport function getHeroFailures(kind, { now: nowTs = now(), windowMs = 0, limit = FAILURE_LIMIT } = {}){\n  const list = readFailures(kind);\n  if(!list.length) return { entries: [], set: new Set() };\n  const threshold = windowMs > 0 ? Math.max(0, nowTs - windowMs) : 0;\n  const seen = new Set();\n  const entries = [];\n  for(const item of list){\n    if(!item || !item.id) continue;\n    if(threshold && item.ts < threshold) continue;\n    if(seen.has(item.id)) continue;\n    seen.add(item.id);\n    entries.push({ id: item.id, ts: item.ts, reason: item.reason || '', hits: item.hits || 0 });\n    if(entries.length >= limit) break;\n  }\n  return { entries, set: seen };\n}\n\nexport function clearHeroFailures(kind){\n  const { local, session } = resolveAreas();\n  const key = failureKey(kind);\n  writeRaw(local, key, null);\n  writeRaw(session, `${key}${SESSION_SUFFIX}`, null);\n}\n\nexport default {\n  getStoredPool,\n  storePool,\n  invalidatePool,\n  recordHeroHistory,\n  getHeroHistory,\n  recordHeroMemory,\n  getHeroMemory,\n  clearHeroMemory,\n  recordHeroFailure,\n  resolveHeroFailure,\n  getHeroFailures,\n  clearHeroFailures\n};\n", "import { normalizeItem } from './normalizer.js';\nimport { getHeroPolicy, getCacheTtl } from './policy.js';\nimport {\n  getStoredPool,\n  storePool,\n  invalidatePool,\n  getHeroHistory,\n  getHeroMemory,\n  recordHeroMemory,\n  clearHeroMemory,\n  getHeroFailures,\n  recordHeroFailure,\n  resolveHeroFailure,\n  clearHeroFailures\n} from './storage.js';\n\nconst LOG_PREFIX = '[hero:pool]';\nconst PROGRESS_EVENT = 'hero:pool-progress';\nconst HISTORY_WINDOW_MS = 1000 * 60 * 60 * 24 * 7; // 7 days\nconst HISTORY_LIMIT = 60;\nconst NEW_WINDOW_MS = 1000 * 60 * 60 * 24 * 90; // 90 days\nconst OLD_THRESHOLD_YEARS = 12;\nconst FALLBACK_HISTORY_WINDOW_MS = 1000 * 60 * 60 * 24 * 30; // 30 days fallback when pool too small\n\nconst SLOT_KEYS = ['new', 'topRated', 'oldButGold', 'random'];\n\nconst listeners = new Set();\n\nfunction now(){\n  return Date.now();\n}\n\nfunction logWarn(...args){\n  try {\n    console.warn(LOG_PREFIX, ...args);\n  } catch (_err) {\n    // ignore\n  }\n}\n\nfunction normalizeKind(kind){\n  if(kind === 'series' || kind === 'show' || kind === 'shows') return 'series';\n  return 'movies';\n}\n\nfunction policySignature(policy, kind){\n  if(!policy || typeof policy !== 'object') return '';\n  try {\n    const normalizedKind = normalizeKind(kind);\n    const fragment = {\n      poolSize: normalizedKind === 'series' ? policy.poolSizeSeries : policy.poolSizeMovies,\n      slots: policy.slots,\n      diversity: policy.diversity,\n      language: policy.language || 'en-US'\n    };\n    return JSON.stringify(fragment);\n  } catch (err) {\n    logWarn('Failed to compute policy signature:', err?.message || err);\n    return '';\n  }\n}\n\nfunction clamp(value, min, max){\n  return Math.min(max, Math.max(min, value));\n}\n\nfunction parseDate(value){\n  if(!value) return 0;\n  if(typeof value === 'number' && Number.isFinite(value)){\n    if(value > 1_000_000_000_000) return Math.trunc(value);\n    return Math.trunc(value * 1000);\n  }\n  if(typeof value === 'string'){\n    const ts = Date.parse(value);\n    if(Number.isFinite(ts)) return ts;\n  }\n  return 0;\n}\n\nfunction parseYear(value){\n  if(!value) return null;\n  const num = Number(value);\n  if(Number.isFinite(num) && num > 1800 && num < 2100) return Math.trunc(num);\n  if(typeof value === 'string'){\n    const match = value.match(/(19|20|21)\\d{2}/);\n    if(match) return Number(match[0]);\n  }\n  return null;\n}\n\nfunction parseGenres(raw){\n  const out = [];\n  const push = (val)=>{\n    if(!val || typeof val !== 'string') return;\n    const trimmed = val.trim();\n    if(!trimmed) return;\n    const normalized = trimmed.replace(/\\s+/g, ' ');\n    if(!out.includes(normalized)) out.push(normalized);\n  };\n  if(Array.isArray(raw?.genres)){\n    for(const g of raw.genres){\n      if(!g) continue;\n      if(typeof g === 'string'){ push(g); continue; }\n      if(typeof g === 'object'){ push(g.tag || g.title || g.label || g.name || ''); }\n    }\n  }\n  if(Array.isArray(raw?.Genre)){\n    for(const g of raw.Genre){ push(typeof g === 'string' ? g : g?.tag); }\n  }\n  return out.slice(0, 3);\n}\n\nfunction parseRating(raw){\n  const candidates = [raw?.rating, raw?.audienceRating, raw?.userRating];\n  for(const candidate of candidates){\n    const num = Number(candidate);\n    if(Number.isFinite(num) && num > 0) return clamp(Math.round(num * 10) / 10, 0, 10);\n  }\n  return null;\n}\n\nfunction parseVoteCount(raw){\n  const candidates = [raw?.ratingCount, raw?.audienceRatingCount, raw?.userRatingCount, raw?.viewCount];\n  for(const candidate of candidates){\n    const num = Number(candidate);\n    if(Number.isFinite(num) && num >= 0) return Math.trunc(num);\n  }\n  return 0;\n}\n\nfunction resolveId(raw){\n  if(!raw || typeof raw !== 'object') return null;\n  if(raw.heroId != null) return String(raw.heroId);\n  if(raw.ids && typeof raw.ids === 'object'){\n    if(raw.ids.imdb) return `imdb:${raw.ids.imdb}`;\n    if(raw.ids.tmdb) return `tmdb:${raw.ids.tmdb}`;\n    if(raw.ids.tvdb) return `tvdb:${raw.ids.tvdb}`;\n  }\n  if(raw.guid) return String(raw.guid);\n  if(raw.ratingKey != null) return `rk:${raw.ratingKey}`;\n  if(raw.id != null) return String(raw.id);\n  if(raw.slug) return String(raw.slug);\n  if(raw.key != null){\n    const key = typeof raw.key === 'string' ? raw.key.trim() : String(raw.key);\n    if(key) return key;\n  }\n  if(raw.title){\n    const suffix = raw.year ? `:${raw.year}` : '';\n    return `title:${raw.title}${suffix}`;\n  }\n  return null;\n}\n\nfunction computeSlotPlan(poolSize, slots){\n  const plan = { new: 0, topRated: 0, oldButGold: 0, random: 0 };\n  let remaining = poolSize;\n  const quotas = slots && typeof slots === 'object' ? slots : {};\n  SLOT_KEYS.forEach((key, index) => {\n    if(index === SLOT_KEYS.length - 1){\n      plan[key] = Math.max(0, remaining);\n      remaining = 0;\n      return;\n    }\n    const quota = Number(quotas[key]?.quota);\n    if(!Number.isFinite(quota) || quota <= 0){\n      plan[key] = 0;\n      return;\n    }\n    const count = Math.max(0, Math.round(poolSize * clamp(quota, 0, 1)));\n    plan[key] = Math.min(remaining, count);\n    remaining -= plan[key];\n  });\n  let cursor = 0;\n  while(remaining > 0){\n    const key = SLOT_KEYS[cursor % SLOT_KEYS.length];\n    plan[key] += 1;\n    remaining -= 1;\n    cursor += 1;\n  }\n  return plan;\n}\n\nfunction computeCaps(poolSize, diversity){\n  const genreWeight = clamp(Number(diversity?.genre) || 0.4, 0.1, 0.9);\n  const yearWeight = clamp(Number(diversity?.year) || 0.35, 0.1, 0.9);\n  const genreCap = Math.max(1, Math.round(poolSize * clamp(genreWeight * 0.5, 0.1, 0.35)));\n  const yearCap = Math.max(1, Math.round(poolSize * clamp(yearWeight * 0.5, 0.1, 0.35)));\n  return { perGenre: genreCap, perYear: yearCap };\n}\n\nfunction prepareCandidates(items){\n  if(!Array.isArray(items) || !items.length) return [];\n  const nowTs = now();\n  const seen = new Set();\n  const prepared = [];\n  for(const raw of items){\n    if(!raw || typeof raw !== 'object') continue;\n    const id = resolveId(raw);\n    if(!id) continue;\n    if(seen.has(id)) continue;\n    seen.add(id);\n    const addedAt = parseDate(raw.addedAt || raw.createdAt || raw.added);\n    const year = parseYear(raw.year || raw.originallyAvailableAt);\n    const rating = parseRating(raw);\n    const voteCount = parseVoteCount(raw);\n    const genres = parseGenres(raw);\n    const candidate = {\n      id,\n      raw,\n      addedAt,\n      year,\n      rating: rating ?? 0,\n      voteCount,\n      genres,\n      isNew: addedAt && nowTs - addedAt <= NEW_WINDOW_MS,\n      isOld: year ? (new Date().getUTCFullYear() - year) >= OLD_THRESHOLD_YEARS : false\n    };\n    prepared.push(candidate);\n  }\n  return prepared;\n}\n\nfunction sortNew(list){\n  return list.slice().sort((a, b) => (b.addedAt || 0) - (a.addedAt || 0));\n}\n\nfunction sortTopRated(list){\n  return list.slice().sort((a, b) => {\n    const ra = Number.isFinite(a.rating) ? a.rating : 0;\n    const rb = Number.isFinite(b.rating) ? b.rating : 0;\n    if(rb !== ra) return rb - ra;\n    const vc = (b.voteCount || 0) - (a.voteCount || 0);\n    if(vc !== 0) return vc;\n    return (b.addedAt || 0) - (a.addedAt || 0);\n  });\n}\n\nfunction sortOld(list){\n  return list.slice().sort((a, b) => {\n    const ya = a.year || 0;\n    const yb = b.year || 0;\n    if(ya && yb && ya !== yb) return ya - yb;\n    const rb = (b.rating || 0) - (a.rating || 0);\n    if(rb !== 0) return rb;\n    return (b.addedAt || 0) - (a.addedAt || 0);\n  });\n}\n\nfunction shuffle(list){\n  const arr = list.slice();\n  for(let i = arr.length - 1; i > 0; i--){\n    const j = Math.floor(Math.random() * (i + 1));\n    [arr[i], arr[j]] = [arr[j], arr[i]];\n  }\n  return arr;\n}\n\nfunction passesCaps(context, candidate){\n  const { caps, genreCounts, yearCounts } = context;\n  if(caps.perGenre > 0 && candidate.genres && candidate.genres.length){\n    for(const genre of candidate.genres){\n      const count = genreCounts.get(genre) || 0;\n      if(count >= caps.perGenre) return false;\n    }\n  }\n  if(caps.perYear > 0 && candidate.year){\n    const count = yearCounts.get(candidate.year) || 0;\n    if(count >= caps.perYear) return false;\n  }\n  return true;\n}\n\nfunction applySelection(context, candidate, slot){\n  context.selected.push({ ...candidate, slot });\n  context.selectedIds.add(candidate.id);\n  context.summary[slot] = (context.summary[slot] || 0) + 1;\n  if(candidate.genres){\n    for(const genre of candidate.genres){\n      context.genreCounts.set(genre, (context.genreCounts.get(genre) || 0) + 1);\n    }\n  }\n  if(candidate.year){\n    context.yearCounts.set(candidate.year, (context.yearCounts.get(candidate.year) || 0) + 1);\n  }\n}\n\nfunction attemptSelection(list, count, slot, context, { allowHistory = false, filter } = {}){\n  if(count <= 0) return 0;\n  const deferredHistory = [];\n  const deferredMemory = [];\n  const deferredFailures = [];\n  for(const candidate of list){\n    if(context.selected.length >= context.poolSize) break;\n    if(context.summary[slot] >= count) break;\n    if(context.selectedIds.has(candidate.id)) continue;\n    if(filter && !filter(candidate)) continue;\n    if(!passesCaps(context, candidate)) continue;\n    if(context.failureSet && context.failureSet.has(candidate.id)){\n      deferredFailures.push(candidate);\n      continue;\n    }\n    if(context.memorySet && context.memorySet.has(candidate.id)){\n      deferredMemory.push(candidate);\n      continue;\n    }\n    if(!allowHistory && context.historySet && context.historySet.has(candidate.id)){\n      deferredHistory.push(candidate);\n      continue;\n    }\n    applySelection(context, candidate, slot);\n  }\n  if(context.summary[slot] >= count || context.selected.length >= context.poolSize) return context.summary[slot];\n  const applyQueue = (queue)=>{\n    for(const candidate of queue){\n      if(context.selected.length >= context.poolSize) break;\n      if(context.summary[slot] >= count) break;\n      if(context.selectedIds.has(candidate.id)) continue;\n      if(!passesCaps(context, candidate)) continue;\n      applySelection(context, candidate, slot);\n    }\n  };\n  if(deferredMemory.length){\n    applyQueue(deferredMemory);\n  }\n  if(context.summary[slot] < count && deferredHistory.length){\n    applyQueue(deferredHistory);\n  }\n  if(context.summary[slot] < count && deferredFailures.length){\n    applyQueue(deferredFailures);\n  }\n  return context.summary[slot];\n}\n\nfunction ensureMinimum(context, list){\n  for(const candidate of list){\n    if(context.selected.length >= context.poolSize) break;\n    if(context.selectedIds.has(candidate.id)) continue;\n    applySelection(context, candidate, 'random');\n  }\n}\n\nfunction emitProgress(detail){\n  const payload = { ...detail, timestamp: now() };\n  for(const listener of listeners){\n    try { listener(payload); } catch (err) { logWarn('Progress listener failed:', err?.message || err); }\n  }\n  try {\n    if(typeof window !== 'undefined' && typeof window.dispatchEvent === 'function' && typeof CustomEvent === 'function'){\n      window.dispatchEvent(new CustomEvent(PROGRESS_EVENT, { detail: payload }));\n    }\n  } catch (err) {\n    logWarn('Failed to dispatch progress event:', err?.message || err);\n  }\n}\n\nasync function normalizeSelection(selection, language, options = {}){\n  const normalized = [];\n  const total = selection.length;\n  const {\n    settings,\n    auth,\n    authOptions,\n    signal,\n    disableTmdb,\n    kind,\n    failureTtlMs\n  } = options;\n  for(let index = 0; index < selection.length; index++){\n    const entry = selection[index];\n    emitProgress({ stage: 'normalizing', index: index + 1, total, slot: entry.slot, id: entry.id });\n    let normalizedItem = null;\n    let failureReason = '';\n    let rateLimited = false;\n    try {\n      normalizedItem = await normalizeItem(entry.raw, {\n        language,\n        settings,\n        auth,\n        authOptions,\n        signal,\n        disableTmdb\n      });\n    } catch (err) {\n      logWarn('Failed to normalize hero candidate:', err?.message || err);\n      failureReason = err?.message || '';\n      if(err?.code === 'RATE_LIMIT') rateLimited = true;\n    }\n    if(!normalizedItem){\n      if(kind && !rateLimited){\n        try {\n          recordHeroFailure(kind, entry.raw || entry, { timestamp: now(), ttlMs: failureTtlMs, reason: failureReason || 'normalize' });\n        } catch (_err){}\n      }\n      continue;\n    }\n    if(kind){\n      try { resolveHeroFailure(kind, entry.raw || normalizedItem); } catch (_err){}\n    }\n    normalizedItem.slot = entry.slot;\n    normalizedItem.poolSlot = entry.slot;\n    normalizedItem.poolId = entry.id;\n    normalized.push(normalizedItem);\n  }\n  return normalized;\n}\n\nfunction classifyCandidates(items, plan, diversity, history, memory, failures){\n  const poolSize = Object.values(plan).reduce((sum, value) => sum + value, 0);\n  const context = {\n    poolSize,\n    caps: computeCaps(poolSize, diversity),\n    selected: [],\n    summary: { new: 0, topRated: 0, oldButGold: 0, random: 0 },\n    genreCounts: new Map(),\n    yearCounts: new Map(),\n    selectedIds: new Set(),\n    historySet: history?.set || new Set(),\n    memorySet: memory?.set || new Set(),\n    failureSet: failures?.set || new Set()\n  };\n\n  const prepared = prepareCandidates(items);\n  const newList = sortNew(prepared);\n  const topList = sortTopRated(prepared);\n  const oldList = sortOld(prepared.filter(entry => entry.isOld));\n  const randomList = shuffle(prepared);\n\n  attemptSelection(newList, plan.new, 'new', context, { allowHistory: false, filter: candidate => candidate.isNew });\n  attemptSelection(newList, plan.new, 'new', context, { allowHistory: false });\n  attemptSelection(newList, plan.new, 'new', context, { allowHistory: true });\n\n  attemptSelection(topList, plan.topRated, 'topRated', context, { allowHistory: false });\n  attemptSelection(topList, plan.topRated, 'topRated', context, { allowHistory: true });\n\n  attemptSelection(oldList, plan.oldButGold, 'oldButGold', context, { allowHistory: false });\n  attemptSelection(oldList, plan.oldButGold, 'oldButGold', context, { allowHistory: true });\n\n  const remainingRandom = randomList.filter(candidate => !context.selectedIds.has(candidate.id));\n  attemptSelection(remainingRandom, plan.random, 'random', context, { allowHistory: false });\n  attemptSelection(remainingRandom, plan.random, 'random', context, { allowHistory: true });\n\n  if(context.selected.length < poolSize){\n    const leftovers = prepared.filter(candidate => !context.selectedIds.has(candidate.id));\n    ensureMinimum(context, leftovers);\n  }\n\n  return context;\n}\n\nfunction shouldReusePool(kind, policyHash, options = {}){\n  const nowTs = now();\n  const cached = getStoredPool(kind, { now: nowTs, policyHash });\n  if(!cached || !Array.isArray(cached.items) || !cached.items.length) return null;\n  if(cached.isExpired){\n    if(options.allowGrace){\n      const { graceMs } = getCacheTtl();\n      if(graceMs && graceMs > 0 && cached.expiresAt + graceMs > nowTs){\n        emitProgress({ stage: 'cache', status: 'grace', kind, size: cached.items.length });\n        return { ...cached, fromCache: true };\n      }\n    }\n    return null;\n  }\n  emitProgress({ stage: 'cache', status: 'hit', kind, size: cached.items.length });\n  return { ...cached, fromCache: true };\n}\n\nasync function buildPool(kind, items, options = {}){\n  const policy = options.policy || getHeroPolicy();\n  const normalizedKind = normalizeKind(kind);\n  const policyHash = policySignature(policy, normalizedKind);\n  const reuse = !options.force && shouldReusePool(normalizedKind, policyHash, { allowGrace: true });\n  if(reuse) return reuse;\n\n  if(options.force){\n    try { clearHeroMemory(normalizedKind); } catch (_err){}\n    try { clearHeroFailures(normalizedKind); } catch (_err){}\n  }\n\n  const poolSize = normalizedKind === 'series' ? policy.poolSizeSeries : policy.poolSizeMovies;\n  if(!poolSize || poolSize <= 0){\n    return { items: [], summary: {}, fromCache: false, updatedAt: now(), expiresAt: 0 };\n  }\n\n  emitProgress({ stage: 'start', kind: normalizedKind, total: poolSize });\n\n  const plan = computeSlotPlan(poolSize, policy.slots);\n  const ttlInfo = getCacheTtl();\n  const nowTs = now();\n  const memoryWindow = (()=>{\n    const base = Math.max(0, (ttlInfo.ttlMs || 0)) + Math.max(0, ttlInfo.graceMs || 0);\n    return base > 0 ? base : HISTORY_WINDOW_MS;\n  })();\n  const history = getHeroHistory(normalizedKind, { windowMs: HISTORY_WINDOW_MS, limit: HISTORY_LIMIT });\n  const memory = getHeroMemory(normalizedKind, { now: nowTs, windowMs: memoryWindow, limit: Math.max(HISTORY_LIMIT * 2, poolSize * 2) });\n  const failures = getHeroFailures(normalizedKind, { now: nowTs, windowMs: memoryWindow });\n\n  let context = classifyCandidates(items, plan, { ...policy.diversity, kind: normalizedKind }, history, memory, failures);\n\n  if(context.selected.length < poolSize && history.entries.length){\n    const fallbackHistory = getHeroHistory(normalizedKind, { windowMs: FALLBACK_HISTORY_WINDOW_MS, limit: HISTORY_LIMIT });\n    context = classifyCandidates(items, plan, { ...policy.diversity, kind: normalizedKind }, fallbackHistory, memory, failures);\n  }\n\n  const trimmedSelection = context.selected.slice(0, poolSize);\n\n  const normalizedItems = await normalizeSelection(trimmedSelection, policy.language || 'en-US', {\n    ...options.tmdb,\n    kind: normalizedKind,\n    failureTtlMs: memoryWindow\n  });\n  const finalItems = normalizedItems.slice(0, poolSize);\n\n  const updatedAt = now();\n  const expiresAt = updatedAt + (ttlInfo.ttlMs || 0);\n\n  const payload = {\n    kind: normalizedKind,\n    items: finalItems,\n    updatedAt,\n    expiresAt,\n    policyHash,\n    slotSummary: context.summary,\n    meta: {\n      plan,\n      totalCandidates: items?.length || 0,\n      selectionCount: finalItems.length\n    }\n  };\n\n  try {\n    recordHeroMemory(normalizedKind, finalItems, { timestamp: updatedAt, ttlMs: memoryWindow, limit: Math.max(HISTORY_LIMIT * 2, poolSize * 2) });\n  } catch (_err){}\n\n  storePool(normalizedKind, payload);\n  emitProgress({ stage: 'done', kind: normalizedKind, size: finalItems.length, updatedAt });\n  return { ...payload, fromCache: false };\n}\n\nexport async function ensureHeroPool(kind, items, options = {}){\n  return buildPool(kind, items, options);\n}\n\nexport function forceRegeneratePool(kind, items, options = {}){\n  return buildPool(kind, items, { ...options, force: true });\n}\n\nexport function clearHeroPool(kind){\n  invalidatePool(kind);\n}\n\nexport function addProgressListener(listener){\n  if(typeof listener !== 'function') return () => {};\n  listeners.add(listener);\n  return () => listeners.delete(listener);\n}\n\nexport { PROGRESS_EVENT };\n\nexport default {\n  ensureHeroPool,\n  forceRegeneratePool,\n  clearHeroPool,\n  addProgressListener,\n  PROGRESS_EVENT\n};\n", "import { ensureHeroPool, forceRegeneratePool } from './pool.js';\nimport { getStoredPool } from './storage.js';\nimport { useTmdbForHero } from '../utils.js';\nimport { addRateLimitListener, getRateLimitState } from './tmdbClient.js';\n\nconst LOG_PREFIX = '[hero:pipeline]';\nconst FEATURE_FLAG_KEY = 'feature.heroPipeline';\nconst UPDATE_EVENT = 'hero:pipeline-update';\n\nconst listeners = new Set();\nlet detachRateLimitListener = null;\n\nconst state = {\n  cfg: {},\n  policy: null,\n  enabled: true,\n  featureSource: 'default',\n  ready: false,\n  sources: { movies: [], series: [] },\n  pools: { movies: [], series: [] },\n  status: {\n    movies: createStatus('movies'),\n    series: createStatus('series')\n  },\n  tmdb: {\n    allowed: false,\n    active: false,\n    rateLimit: {\n      active: false,\n      until: 0,\n      retryAfterMs: 0,\n      lastStatus: null,\n      strikes: 0\n    }\n  },\n  activeKind: 'movies',\n  inFlight: new Map()\n};\n\nfunction logWarn(...args){\n  try {\n    console.warn(LOG_PREFIX, ...args);\n  } catch (_err) {\n    // ignore\n  }\n}\n\nfunction now(){\n  return Date.now();\n}\n\nfunction normalizeKind(kind){\n  if(kind === 'show' || kind === 'shows' || kind === 'series') return 'series';\n  return 'movies';\n}\n\nfunction rateLimitEquals(a, b){\n  if(a === b) return true;\n  if(!a || !b) return false;\n  return a.active === b.active\n    && a.until === b.until\n    && a.retryAfterMs === b.retryAfterMs\n    && a.lastStatus === b.lastStatus\n    && a.strikes === b.strikes;\n}\n\nfunction attachRateLimitListener(){\n  if(detachRateLimitListener) return;\n  try {\n    state.tmdb.rateLimit = { ...getRateLimitState() };\n  } catch (_err) {\n    state.tmdb.rateLimit = { active: false, until: 0, retryAfterMs: 0, lastStatus: null, strikes: 0 };\n  }\n  const handler = info => {\n    const next = info ? { ...info } : { active: false, until: 0, retryAfterMs: 0, lastStatus: null, strikes: 0 };\n    if(rateLimitEquals(state.tmdb.rateLimit, next)) return;\n    state.tmdb.rateLimit = next;\n    notify();\n  };\n  detachRateLimitListener = addRateLimitListener(handler);\n}\n\nfunction createStatus(kind){\n  return {\n    kind,\n    state: 'idle',\n    regenerating: false,\n    size: 0,\n    updatedAt: 0,\n    expiresAt: 0,\n    fromCache: false,\n    source: '',\n    policyHash: '',\n    slotSummary: {},\n    matchesPolicy: true,\n    isExpired: false,\n    lastError: null,\n    lastRefresh: 0\n  };\n}\n\nfunction cloneStatus(status){\n  if(!status) return null;\n  const copy = { ...status };\n  copy.slotSummary = status.slotSummary ? { ...status.slotSummary } : {};\n  return copy;\n}\n\nfunction readFeatureFlag(){\n  if(typeof localStorage === 'undefined') return null;\n  try {\n    const raw = localStorage.getItem(FEATURE_FLAG_KEY);\n    if(raw === '1' || raw === '0') return raw;\n  } catch (err) {\n    logWarn('Failed to read feature flag:', err?.message || err);\n  }\n  return null;\n}\n\nfunction computeFeatureState(cfg){\n  const stored = readFeatureFlag();\n  if(stored != null){\n    return { enabled: stored === '1', source: 'localStorage' };\n  }\n  if(cfg && typeof cfg.heroPipelineEnabled === 'boolean'){\n    return { enabled: !!cfg.heroPipelineEnabled, source: 'config.heroPipelineEnabled' };\n  }\n  if(cfg && cfg.features && typeof cfg.features.heroPipeline === 'boolean'){\n    return { enabled: !!cfg.features.heroPipeline, source: 'config.features.heroPipeline' };\n  }\n  return { enabled: true, source: 'default' };\n}\n\nfunction buildSnapshot(){\n  return {\n    enabled: state.enabled,\n    featureSource: state.featureSource,\n    ready: state.ready,\n    activeKind: state.activeKind,\n    tmdb: {\n      allowed: state.tmdb.allowed,\n      active: state.tmdb.active,\n      rateLimit: state.tmdb.rateLimit ? { ...state.tmdb.rateLimit } : { active: false, until: 0, retryAfterMs: 0, lastStatus: null, strikes: 0 }\n    },\n    status: {\n      movies: cloneStatus(state.status.movies),\n      series: cloneStatus(state.status.series)\n    },\n    pools: {\n      movies: state.pools.movies.slice(),\n      series: state.pools.series.slice()\n    }\n  };\n}\n\nfunction notify(){\n  const snapshot = buildSnapshot();\n  for(const listener of listeners){\n    try {\n      listener(snapshot);\n    } catch (err) {\n      logWarn('Listener failed:', err?.message || err);\n    }\n  }\n  try {\n    if(typeof window !== 'undefined' && typeof window.dispatchEvent === 'function' && typeof CustomEvent === 'function'){\n      window.dispatchEvent(new CustomEvent(UPDATE_EVENT, { detail: snapshot }));\n    }\n  } catch (err) {\n    logWarn('Failed to dispatch pipeline event:', err?.message || err);\n  }\n  return snapshot;\n}\n\nfunction updateStatus(kind, patch){\n  const normalized = normalizeKind(kind);\n  const status = state.status[normalized];\n  if(!status) return;\n  const next = { ...patch };\n  if(next.slotSummary){\n    next.slotSummary = { ...next.slotSummary };\n  }\n  state.status[normalized] = { ...status, ...next };\n}\n\nfunction refreshReadyState(){\n  if(!state.enabled){\n    state.ready = true;\n    return;\n  }\n  const kinds = ['movies', 'series'];\n  const ready = kinds.every(kind => {\n    const status = state.status[kind];\n    if(!status) return false;\n    return status.state === 'ready' || status.state === 'error' || status.state === 'stale';\n  });\n  state.ready = ready;\n}\n\nfunction loadStored(kind){\n  const normalized = normalizeKind(kind);\n  const stored = getStoredPool(normalized, { allowExpired: true });\n  if(!stored) return;\n  state.pools[normalized] = Array.isArray(stored.items) ? stored.items.slice() : [];\n  updateStatus(normalized, {\n    state: stored.isExpired ? 'stale' : 'ready',\n    regenerating: false,\n    size: state.pools[normalized].length,\n    updatedAt: Number(stored.updatedAt) || 0,\n    expiresAt: Number(stored.expiresAt) || 0,\n    fromCache: true,\n    source: stored.source || 'cache',\n    policyHash: stored.policyHash || '',\n    slotSummary: stored.slotSummary || {},\n    matchesPolicy: stored.matchesPolicy !== false,\n    isExpired: !!stored.isExpired\n  });\n}\n\nfunction ensureSources(){\n  if(!state.sources.movies) state.sources.movies = [];\n  if(!state.sources.series) state.sources.series = [];\n}\n\nfunction buildTmdbOptions(){\n  // Hero always uses TMDB when credentials are available\n  // Re-check in case token was added after initial configure\n  const hasCredentials = useTmdbForHero();\n  const shouldUseTmdb = state.tmdb.allowed && hasCredentials;\n  const disableTmdb = !shouldUseTmdb;\n\n  const authOptions = {};\n  if(state.cfg && typeof state.cfg === 'object'){\n    const fallback = state.cfg.tmdbToken || state.cfg.tmdbApiKey;\n    if(fallback) authOptions.fallbackCredential = fallback;\n  }\n  return {\n    disableTmdb,\n    settings: state.cfg,\n    authOptions: Object.keys(authOptions).length ? authOptions : undefined\n  };\n}\n\nasync function runPoolBuilder(kind, { force = false } = {}){\n  const normalized = normalizeKind(kind);\n  if(!state.enabled){\n    updateStatus(normalized, { state: 'disabled', regenerating: false });\n    refreshReadyState();\n    return null;\n  }\n\n  ensureSources();\n  if(state.inFlight.has(normalized)){\n    return state.inFlight.get(normalized);\n  }\n\n  const items = normalized === 'series' ? state.sources.series : state.sources.movies;\n  updateStatus(normalized, {\n    state: 'loading',\n    regenerating: true,\n    lastError: null\n  });\n  notify();\n\n  const builder = force ? forceRegeneratePool : ensureHeroPool;\n  const options = {\n    policy: state.policy || undefined,\n    tmdb: buildTmdbOptions()\n  };\n\n  const promise = builder(normalized, items, options)\n    .then(result => {\n      const payload = result || {};\n      const poolItems = Array.isArray(payload.items) ? payload.items.slice() : [];\n      state.pools[normalized] = poolItems;\n      updateStatus(normalized, {\n        state: payload.items ? 'ready' : 'ready',\n        regenerating: false,\n        size: poolItems.length,\n        updatedAt: Number(payload.updatedAt) || now(),\n        expiresAt: Number(payload.expiresAt) || 0,\n        fromCache: !!payload.fromCache,\n        source: payload.source || (payload.fromCache ? 'cache' : 'fresh'),\n        policyHash: payload.policyHash || '',\n        slotSummary: payload.slotSummary || {},\n        matchesPolicy: payload.matchesPolicy !== false,\n        isExpired: false,\n        lastError: null,\n        lastRefresh: now()\n      });\n      refreshReadyState();\n      notify();\n      return payload;\n    })\n    .catch(err => {\n      logWarn('Failed to build hero pool for', normalized, err?.message || err);\n      updateStatus(normalized, {\n        state: 'error',\n        regenerating: false,\n        lastError: err?.message || String(err)\n      });\n      refreshReadyState();\n      notify();\n      throw err;\n    })\n    .finally(() => {\n      state.inFlight.delete(normalized);\n    });\n\n  state.inFlight.set(normalized, promise);\n  return promise;\n}\n\nfunction computeDaySeed(){\n  const nowDate = new Date();\n  const year = nowDate.getUTCFullYear();\n  const startOfYear = Date.UTC(year, 0, 1);\n  const today = Date.UTC(year, nowDate.getUTCMonth(), nowDate.getUTCDate());\n  const diff = Math.max(0, today - startOfYear);\n  return Math.floor(diff / (24 * 60 * 60 * 1000));\n}\n\nfunction comparePoolEntries(a, b){\n  const ka = String(a?.poolId || a?.id || '').toLowerCase();\n  const kb = String(b?.poolId || b?.id || '').toLowerCase();\n  if(ka < kb) return -1;\n  if(ka > kb) return 1;\n  return 0;\n}\n\nfunction computeRotation(kind, snapshot){\n  const normalized = normalizeKind(kind);\n  const pool = snapshot?.pools?.[normalized] || [];\n  if(!Array.isArray(pool) || !pool.length){\n    return { items: [], startIndex: 0 };\n  }\n  const sorted = pool.slice().sort(comparePoolEntries);\n  const status = snapshot.status?.[normalized] || {};\n  const freshnessSeed = status.updatedAt ? Math.floor(Number(status.updatedAt) / (24 * 60 * 60 * 1000)) : 0;\n  const offset = normalized === 'series' ? 7 : 0;\n  const seed = computeDaySeed() + freshnessSeed + offset;\n  const startIndex = sorted.length ? seed % sorted.length : 0;\n  return { items: sorted, startIndex };\n}\n\nexport function configure({ cfg, policy } = {}){\n  state.cfg = cfg || {};\n  state.policy = policy || null;\n  const feature = computeFeatureState(cfg);\n  state.enabled = !!feature.enabled;\n  state.featureSource = feature.source;\n  state.tmdb.allowed = !!cfg?.tmdbEnabled;\n  state.tmdb.active = state.tmdb.allowed && useTmdbForHero();\n  attachRateLimitListener();\n  loadStored('movies');\n  loadStored('series');\n  refreshReadyState();\n  notify();\n  return { enabled: state.enabled, source: state.featureSource };\n}\n\nexport function setSources({ movies = [], shows = [] } = {}){\n  state.sources = { movies: Array.isArray(movies) ? movies : [], series: Array.isArray(shows) ? shows : [] };\n}\n\nexport function setActiveView(view){\n  const normalized = view === 'shows' || view === 'series' ? 'series' : 'movies';\n  if(state.activeKind !== normalized){\n    state.activeKind = normalized;\n    notify();\n  }\n}\n\nexport async function primeAll(options = {}){\n  if(!state.enabled){\n    refreshReadyState();\n    return { skipped: true };\n  }\n  const kinds = options.kinds || ['movies', 'series'];\n  const tasks = kinds.map(kind => runPoolBuilder(kind));\n  const results = await Promise.allSettled(tasks);\n  refreshReadyState();\n  notify();\n  return results;\n}\n\nexport function ensureKind(kind, options = {}){\n  return runPoolBuilder(kind, options);\n}\n\nexport function refreshKind(kind, options = {}){\n  return runPoolBuilder(kind, { ...options, force: true });\n}\n\nexport function refreshAll(){\n  if(!state.enabled){\n    return Promise.resolve({ skipped: true });\n  }\n  return Promise.all([refreshKind('movies'), refreshKind('series')]);\n}\n\nexport function updateTmdbActive(active){\n  // Hero always uses TMDB when credentials are available\n  // This function now just checks if credentials exist\n  const next = !!(state.tmdb.allowed && useTmdbForHero());\n  if(state.tmdb.active === next) return;\n  state.tmdb.active = next;\n  notify();\n}\n\nexport function isEnabled(){\n  return !!state.enabled;\n}\n\nexport function isReady(){\n  return !!state.ready;\n}\n\nexport function getSnapshot(){\n  return buildSnapshot();\n}\n\nexport function getStatus(kind){\n  if(!kind) return { ...buildSnapshot().status };\n  const normalized = normalizeKind(kind);\n  return cloneStatus(state.status[normalized]);\n}\n\nexport function getPool(kind){\n  if(!state.enabled) return [];\n  const normalized = normalizeKind(kind);\n  return state.pools[normalized]?.slice() || [];\n}\n\nexport function getRotationPlan(kind){\n  const snapshot = buildSnapshot();\n  const plan = computeRotation(kind, snapshot);\n  return { ...plan, snapshot };\n}\n\nexport function subscribe(listener){\n  if(typeof listener !== 'function') return () => {};\n  listeners.add(listener);\n  try {\n    listener(buildSnapshot());\n  } catch (err) {\n    logWarn('Initial listener invocation failed:', err?.message || err);\n  }\n  return () => listeners.delete(listener);\n}\n\nexport function getDebugSnapshot(){\n  const snapshot = buildSnapshot();\n  return {\n    enabled: snapshot.enabled,\n    featureSource: snapshot.featureSource,\n    ready: snapshot.ready,\n    tmdb: snapshot.tmdb,\n    status: snapshot.status,\n    poolSizes: {\n      movies: snapshot.pools.movies.length,\n      series: snapshot.pools.series.length\n    }\n  };\n}\n\nexport default {\n  configure,\n  setSources,\n  setActiveView,\n  primeAll,\n  ensureKind,\n  refreshKind,\n  refreshAll,\n  updateTmdbActive,\n  isEnabled,\n  isReady,\n  getSnapshot,\n  getStatus,\n  getPool,\n  getRotationPlan,\n  subscribe,\n  getDebugSnapshot\n};\n", "import { getState } from './state.js';\nimport { getSources } from './data.js';\nimport { getCacheStats, clearAllCache, clearExpiredCache } from './cache.js';\nimport * as HeroPolicy from './hero/policy.js';\nimport * as HeroPipeline from './hero/pipeline.js';\n\nexport function initDebugUi(){\n  const open = document.getElementById('openDebug');\n  if(open){ open.addEventListener('click', ()=>{ openPanel(); }); }\n}\n\nfunction openPanel(){\n  let overlay = document.getElementById('debugOverlay');\n  if(!overlay){ overlay = document.createElement('div'); overlay.id='debugOverlay'; overlay.className='debug-overlay';\n    overlay.innerHTML = `\n      <div class=\"debug-dialog\">\n        <div class=\"debug-header\"><h2>Debug</h2></div>\n        <div class=\"debug-body\">\n          <pre id=\"debugPre\" class=\"debug-pre\"></pre>\n          <div class=\"debug-cache-controls\">\n            <h3>Cache-Verwaltung</h3>\n            <div id=\"cacheStats\" class=\"cache-stats\"></div>\n            <div class=\"cache-buttons\">\n              <button id=\"debugClearExpired\" class=\"btn\">Abgelaufene l\u00F6schen</button>\n              <button id=\"debugClearAll\" class=\"btn\">Alles l\u00F6schen</button>\n            </div>\n          </div>\n        </div>\n        <div class=\"debug-actions\">\n          <button id=\"debugCopy\" class=\"btn\">Copy report</button>\n          <button id=\"debugClose\" class=\"btn\">Schlie\u00DFen</button>\n        </div>\n      </div>`;\n    document.body.append(overlay);\n  }\n  overlay.hidden = false;\n  render();\n  overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closePanel(); });\n  document.getElementById('debugClose')?.addEventListener('click', closePanel, { once:true });\n  document.getElementById('debugCopy')?.addEventListener('click', copyReport, { once:true });\n  document.getElementById('debugClearExpired')?.addEventListener('click', ()=>{\n    clearExpiredCache();\n    render();\n  }, { once:true });\n  document.getElementById('debugClearAll')?.addEventListener('click', ()=>{\n    if(confirm('Wirklich den gesamten Cache l\u00F6schen?')){\n      clearAllCache();\n      render();\n    }\n  }, { once:true });\n}\n\nfunction closePanel(){ const overlay = document.getElementById('debugOverlay'); if(overlay) overlay.hidden = true; }\n\nfunction render(){\n  const pre = document.getElementById('debugPre'); if(!pre) return;\n  const s = getState();\n  const src = getSources();\n  const cfg = s.cfg||{};\n  const cacheStats = getCacheStats();\n  const heroPolicy = HeroPolicy.getHeroPolicy();\n  const heroPolicyIssues = HeroPolicy.getValidationIssues();\n  const heroPipeline = HeroPipeline.getDebugSnapshot();\n\n  const report = {\n    view: s.view,\n    counts: { movies: (s.movies||[]).length, shows: (s.shows||[]).length, filtered: (s.filtered||[]).length },\n    dataSources: src,\n    cache: cacheStats,\n    heroPolicy: {\n      policy: heroPolicy,\n      language: HeroPolicy.getPolicyLanguage(),\n      pools: HeroPolicy.getPoolSizes(),\n      slots: HeroPolicy.getSlotConfig(),\n      diversity: HeroPolicy.getDiversityWeights(),\n      rotation: HeroPolicy.getRotationConfig(),\n      textClamp: HeroPolicy.getTextClampConfig(),\n      fallback: HeroPolicy.getFallbackPreference(),\n      cache: HeroPolicy.getCacheTtl(),\n      loadedAt: HeroPolicy.getPolicyLoadedAt(),\n      issues: heroPolicyIssues\n    },\n    heroCache: heroPipeline,\n    tmdb: { enabled: !!cfg.tmdbEnabled, lang: cfg.lang, tokenPresent: !!(localStorage.getItem('tmdbToken')||cfg.tmdbApiKey) },\n    useTmdbImages: localStorage.getItem('useTmdb')==='1',\n    reduceMotion: localStorage.getItem('prefReduceMotion')==='1',\n    locationHash: location.hash,\n    userAgent: navigator.userAgent,\n  };\n  pre.textContent = JSON.stringify(report, null, 2);\n\n  // Update cache stats display\n  const statsEl = document.getElementById('cacheStats');\n  if(statsEl && cacheStats){\n    const heroMovies = heroPipeline?.status?.movies || {};\n    const heroSeries = heroPipeline?.status?.series || {};\n    const formatTs = (ts)=>{\n      if(!Number.isFinite(ts) || ts <= 0) return 'n/a';\n      try{ return new Date(ts).toLocaleString(); }\n      catch(_err){ return 'n/a'; }\n    };\n    const heroFeature = heroPipeline?.enabled ? `aktiv (Quelle: ${heroPipeline.featureSource || 'default'})` : `deaktiviert (Quelle: ${heroPipeline?.featureSource || 'default'})`;\n    statsEl.innerHTML = `\n      <p>Eintr\u00E4ge gesamt: <strong>${cacheStats.totalEntries}</strong></p>\n      <p>G\u00FCltig: <strong>${cacheStats.validEntries}</strong> | Abgelaufen: <strong>${cacheStats.expiredEntries}</strong></p>\n      <p>Gr\u00F6\u00DFe: <strong>${cacheStats.totalSizeMB} MB</strong></p>\n      <p>Hero-Pipeline: <strong>${heroFeature}</strong></p>\n      <p>Filme: <strong>${heroMovies.size ?? heroPipeline?.poolSizes?.movies ?? 0}</strong> Eintr\u00E4ge \u00B7 Update: <strong>${formatTs(heroMovies.updatedAt)}</strong> \u00B7 Ablauf: <strong>${formatTs(heroMovies.expiresAt)}</strong></p>\n      <p>Serien: <strong>${heroSeries.size ?? heroPipeline?.poolSizes?.series ?? 0}</strong> Eintr\u00E4ge \u00B7 Update: <strong>${formatTs(heroSeries.updatedAt)}</strong> \u00B7 Ablauf: <strong>${formatTs(heroSeries.expiresAt)}</strong></p>\n    `;\n  }\n}\n\nfunction copyReport(){\n  const pre = document.getElementById('debugPre'); if(!pre) return;\n  const txt = pre.textContent || '';\n  navigator.clipboard?.writeText(txt).catch(err=>{\n    console.warn('[debug] Clipboard API write failed, using fallback:', err?.message || err);\n    try{\n      const ta=document.createElement('textarea');\n      ta.value=txt;\n      document.body.append(ta);\n      ta.select();\n      document.execCommand('copy');\n      ta.remove();\n    }catch(fallbackErr){\n      console.warn('[debug] Fallback clipboard copy failed:', fallbackErr?.message || fallbackErr);\n    }\n  });\n}\n\n", "import { getState } from './state.js';\nimport { renderGrid } from './grid.js';\nimport * as HeroPipeline from './hero/pipeline.js';\nimport { syncDefaultMetadataService } from './metadataService.js';\n\nlet heroRefreshHandler = null;\nlet reduceMotionHandler = null;\nlet tmdbHydrationStarted = false;\n\nexport function setHeroRefreshHandler(handler){\n  heroRefreshHandler = typeof handler === 'function' ? handler : null;\n}\n\nexport function setReduceMotionHandler(handler){\n  reduceMotionHandler = typeof handler === 'function' ? handler : null;\n}\n\nfunction notifyHeroRefresh(items){\n  if(heroRefreshHandler){\n    try{\n      heroRefreshHandler(items);\n    }catch(err){\n      console.warn('[settingsOverlay] Failed to trigger hero refresh handler:', err?.message);\n    }\n  }\n}\n\nfunction notifyReduceMotion(enabled){\n  if(reduceMotionHandler){\n    try{\n      reduceMotionHandler(enabled);\n    }catch(err){\n      console.warn('[settingsOverlay] Failed to trigger reduce motion handler:', err?.message);\n    }\n  }\n}\n\nexport function initSettingsOverlay(cfg){\n  const overlay = document.getElementById('settingsOverlay');\n  const dialog = overlay?.querySelector('.settings-dialog');\n  const open1 = document.getElementById('settingsBtn');\n  const open2 = document.getElementById('openSettings');\n  const headerSettingsBtn = document.getElementById('headerSettingsBtn');\n  const close2 = document.getElementById('settingsClose2');\n  const tmdbInput = document.getElementById('tmdbTokenInput');\n  const tmdbSave = document.getElementById('tmdbSave');\n  const tmdbTest = document.getElementById('tmdbTest');\n  const tmdbStatus = document.getElementById('tmdbStatus');\n  const tmdbClear = document.getElementById('tmdbClearCache');\n  const tmdbBadge = document.getElementById('tmdbStatusBadge');\n  const reduce = document.getElementById('prefReduceMotion');\n  const useTmdb = document.getElementById('useTmdbSetting');\n  const resetFilters = document.getElementById('resetFilters');\n  const body = overlay?.querySelector('.settings-body');\n\n  let heroStatus = document.getElementById('heroCacheStatus');\n  let heroRefreshMovies = document.getElementById('heroRefreshMovies');\n  let heroRefreshShows = document.getElementById('heroRefreshShows');\n  let heroRefreshAll = document.getElementById('heroRefreshAll');\n\n  if(!heroStatus && body){\n    const heroRow = document.createElement('div');\n    heroRow.className = 'settings-row';\n    heroRow.innerHTML = `\n      <div class=\"settings-inline\" id=\"heroRefreshControls\">\n        <button type=\"button\" id=\"heroRefreshMovies\" class=\"secondary\">Highlights Filme aktualisieren</button>\n        <button type=\"button\" id=\"heroRefreshShows\" class=\"secondary\">Highlights Serien aktualisieren</button>\n        <button type=\"button\" id=\"heroRefreshAll\" class=\"secondary\">Alle Highlights aktualisieren</button>\n      </div>\n      <p class=\"settings-help\" id=\"heroCacheStatus\" aria-live=\"polite\"></p>\n    `;\n    body.append(heroRow);\n    heroStatus = heroRow.querySelector('#heroCacheStatus');\n    heroRefreshMovies = heroRow.querySelector('#heroRefreshMovies');\n    heroRefreshShows = heroRow.querySelector('#heroRefreshShows');\n    heroRefreshAll = heroRow.querySelector('#heroRefreshAll');\n  }\n\n  const heroButtons = [heroRefreshMovies, heroRefreshShows, heroRefreshAll].filter(Boolean);\n  let heroTask = null;\n\n  function setHeroButtonsDisabled(disabled, reason){\n    heroButtons.forEach(btn => {\n      if(!btn) return;\n      btn.disabled = disabled || !HeroPipeline.isEnabled();\n      if(btn.disabled && reason){ btn.dataset.heroBusy = reason; }\n      else { btn.removeAttribute('data-hero-busy'); }\n    });\n  }\n\n  function formatUpdated(ts){\n    if(!Number.isFinite(ts) || ts <= 0) return 'unbekannt';\n    try {\n      return new Date(ts).toLocaleString(undefined, { hour: '2-digit', minute: '2-digit' });\n    } catch (_err) {\n      return 'unbekannt';\n    }\n  }\n\n  function formatExpiry(ts){\n    if(!Number.isFinite(ts) || ts <= 0) return 'kein Ablauf';\n    const diff = ts - Date.now();\n    if(diff <= 0) return 'abgelaufen';\n    const minutes = diff / 60000;\n    if(minutes < 1) return 'l\u00E4uft in <1 Min ab';\n    if(minutes < 60) return `l\u00E4uft in ${Math.round(minutes)} Min ab`;\n    const hours = minutes / 60;\n    if(hours < 24) return `l\u00E4uft in ${Math.round(hours)} Std ab`;\n    const days = hours / 24;\n    return `l\u00E4uft in ${Math.round(days)} Tg ab`;\n  }\n\n  function describeHeroStatus(label, status){\n    if(!status) return `${label}: keine Daten`;\n    if(status.state === 'disabled') return `${label}: deaktiviert`;\n    if(status.state === 'loading' || status.regenerating) return `${label}: wird aktualisiert \u2026`;\n    if(status.state === 'error') return `${label}: Fehler (${status.lastError || 'unbekannt'})`;\n    if(status.state === 'stale'){\n      return `${label}: ${status.size} Eintr\u00E4ge (Cache abgelaufen)`;\n    }\n    const updated = formatUpdated(status.updatedAt);\n    const expiry = formatExpiry(status.expiresAt);\n    return `${label}: ${status.size} Eintr\u00E4ge (Update ${updated}, ${expiry})`;\n  }\n\n  function updateHeroStatus(snapshot){\n    if(!heroStatus) return;\n    if(!snapshot || !HeroPipeline.isEnabled() || snapshot.enabled === false){\n      heroStatus.textContent = 'Hero-Pipeline deaktiviert \u2013 Legacy-Hero aktiv.';\n      setHeroButtonsDisabled(true, 'disabled');\n      return;\n    }\n    const busy = !!(snapshot.status?.movies?.regenerating || snapshot.status?.series?.regenerating);\n    setHeroButtonsDisabled(busy, busy ? 'busy' : '');\n    const segments = [];\n    segments.push(describeHeroStatus('Filme', snapshot.status?.movies));\n    segments.push(describeHeroStatus('Serien', snapshot.status?.series));\n    if(snapshot.tmdb){\n      if(!snapshot.tmdb.allowed) segments.push('TMDb deaktiviert');\n      else segments.push(`TMDb ${snapshot.tmdb.active ? 'aktiv' : 'aus (Toggle)'}`);\n    }\n    if(snapshot.featureSource){\n      segments.push(`Feature-Flag: ${snapshot.featureSource}`);\n    }\n    heroStatus.textContent = segments.join(' \u2022 ');\n  }\n\n  async function runHeroRegeneration(kind='all', label='Highlights aktualisieren \u2026'){\n    if(!HeroPipeline.isEnabled()) return;\n    if(heroTask){\n      try{ await heroTask; }catch(_err){}\n    }\n    if(heroStatus && label){ heroStatus.textContent = label; }\n    setHeroButtonsDisabled(true, 'busy');\n    const action = (kind === 'movies' || kind === 'series') ? HeroPipeline.refreshKind(kind) : HeroPipeline.refreshAll();\n    heroTask = action.then(()=>{\n      notifyHeroRefresh();\n    }).catch(err => {\n      console.warn('[settingsOverlay] Hero regeneration failed:', err?.message || err);\n    }).finally(()=>{\n      heroTask = null;\n      setHeroButtonsDisabled(false);\n    });\n    return heroTask;\n  }\n\n  HeroPipeline.subscribe(updateHeroStatus);\n\n  if(overlay && overlay.hidden) overlay.setAttribute('aria-hidden', 'true');\n\n  let restoreFocus = null;\n  let previousOverflow = '';\n  let isOpen = false;\n  const backgroundState = new Map();\n  const focusSelector = 'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])';\n\n  function getFocusable(){\n    if(!overlay) return [];\n    return Array.from(overlay.querySelectorAll(focusSelector)).filter(el=> !el.hasAttribute('disabled') && el.getAttribute('aria-hidden') !== 'true');\n  }\n\n  function focusDialog(){\n    if(dialog && typeof dialog.focus === 'function') dialog.focus({ preventScroll:true });\n    else if(overlay && typeof overlay.focus === 'function') overlay.focus({ preventScroll:true });\n  }\n\n  function setBackgroundInert(active){\n    if(!overlay) return;\n    const nodes = Array.from(document.body.children).filter(node=> node !== overlay);\n    if(active){\n      nodes.forEach(node=>{\n        if(!backgroundState.has(node)){\n          backgroundState.set(node, {\n            ariaHidden: node.hasAttribute('aria-hidden') ? node.getAttribute('aria-hidden') : null,\n            inert: node.hasAttribute('inert')\n          });\n        }\n        node.setAttribute('aria-hidden', 'true');\n        node.setAttribute('inert', '');\n      });\n    }else{\n      nodes.forEach(node=>{\n        const state = backgroundState.get(node);\n        if(state){\n          if(state.ariaHidden === null || state.ariaHidden === undefined) node.removeAttribute('aria-hidden');\n          else node.setAttribute('aria-hidden', state.ariaHidden);\n          if(state.inert) node.setAttribute('inert', '');\n          else node.removeAttribute('inert');\n          backgroundState.delete(node);\n        }else{\n          node.removeAttribute('aria-hidden');\n          node.removeAttribute('inert');\n        }\n      });\n      backgroundState.clear();\n    }\n  }\n\n  function openOverlay(){\n    if(!overlay || isOpen) return;\n    isOpen = true;\n    overlay.hidden = false;\n    overlay.setAttribute('aria-hidden', 'false');\n    restoreFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n    previousOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n    setBackgroundInert(true);\n    syncSettingsUi();\n    requestAnimationFrame(focusDialog);\n  }\n\n  function closeOverlay(){\n    if(!overlay || !isOpen) return;\n    isOpen = false;\n    overlay.hidden = true;\n    overlay.setAttribute('aria-hidden', 'true');\n    setBackgroundInert(false);\n    document.body.style.overflow = previousOverflow;\n    if(restoreFocus && typeof restoreFocus.focus === 'function'){ restoreFocus.focus(); }\n    restoreFocus = null;\n  }\n\n  function handleKeydown(ev){\n    if(!isOpen) return;\n    if(ev.key === 'Escape'){\n      ev.preventDefault();\n      closeOverlay();\n      return;\n    }\n    if(ev.key !== 'Tab') return;\n    const focusable = getFocusable();\n    if(!focusable.length){\n      ev.preventDefault();\n      focusDialog();\n      return;\n    }\n    const first = focusable[0];\n    const last = focusable[focusable.length - 1];\n    const active = document.activeElement;\n    if(ev.shiftKey){\n      if(active === first || !overlay.contains(active)){\n        ev.preventDefault();\n        last.focus();\n      }\n    }else if(active === last){\n      ev.preventDefault();\n      first.focus();\n    }\n  }\n\n  open1 && open1.addEventListener('click', openOverlay);\n  open2 && open2.addEventListener('click', ()=>{ openOverlay(); });\n  headerSettingsBtn && headerSettingsBtn.addEventListener('click', openOverlay);\n  close2 && close2.addEventListener('click', closeOverlay);\n  overlay && overlay.addEventListener('click', (ev)=>{ if(ev.target===overlay) closeOverlay(); });\n  overlay && overlay.addEventListener('keydown', handleKeydown);\n\n  function setTmdbStatus(msg='', kind=''){\n    if(!tmdbStatus) return;\n    tmdbStatus.textContent = msg;\n    tmdbStatus.dataset.kind = kind; // kind: success|error|info|pending\n    if(tmdbBadge){ tmdbBadge.dataset.kind = kind || ''; tmdbBadge.title = msg || ''; }\n    // Auto-Fallback: Bei Fehler und vorhandenem v3 API Key, gespeicherten ung\u00FCltigen Token entfernen\n    try{\n      if(kind==='error' && cfg && cfg.tmdbApiKey){\n        const stored = String(localStorage.getItem('tmdbToken')||'').trim();\n        const currentInput = String(tmdbInput?.value||'').trim();\n        if(stored && currentInput){\n          try{ localStorage.removeItem('tmdbToken'); }\n          catch(err){ console.warn('[settingsOverlay] Failed to remove tmdbToken from storage:', err?.message || err); }\n          if(tmdbInput) tmdbInput.value = '';\n          setUseTmdbAvailability(true);\n          const m = 'Ung\u00FCltiger Token entfernt. Verwende API Key aus config.json.';\n          tmdbStatus.textContent = m;\n          tmdbStatus.dataset.kind = 'info';\n          if(tmdbBadge){ tmdbBadge.dataset.kind = 'info'; tmdbBadge.title = m; }\n        }\n      }\n    }catch(err){ console.warn('[settingsOverlay] Failed to reset TMDB status state:', err?.message || err); }\n  }\n\n  function setUseTmdbAvailability(allowed){\n    if(!useTmdb) return;\n    useTmdb.disabled = !allowed;\n    useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token oder API Key.' : '';\n    if(!allowed && useTmdb.checked){\n      try{ localStorage.setItem('useTmdb', '0'); }\n      catch(err){ console.warn('[settingsOverlay] Failed to persist TMDB toggle state:', err?.message || err); }\n      useTmdb.checked = false;\n      renderGrid(getState().view);\n      notifyHeroRefresh();\n    }\n  }\n\n  function syncSettingsUi(){\n    let token = '';\n    try{ tmdbInput && (tmdbInput.value = token = (localStorage.getItem('tmdbToken')||'')); }\n    catch(err){ console.warn('[settingsOverlay] Failed to read stored tmdbToken:', err?.message || err); }\n    try{ reduce && (reduce.checked = localStorage.getItem('prefReduceMotion')==='1'); }\n    catch(err){ console.warn('[settingsOverlay] Failed to read reduce-motion preference:', err?.message || err); }\n    try{ if(useTmdb){\n      useTmdb.checked = localStorage.getItem('useTmdb')==='1';\n      useTmdb.disabled = !token;\n      useTmdb.title = useTmdb.disabled ? 'Nur verf\u00FCgbar mit g\u00FCltigem Token.' : '';\n    } }\n    catch(err){ console.warn('[settingsOverlay] Failed to sync TMDB toggle from storage:', err?.message || err); }\n    try{ setUseTmdbAvailability(!!token || !!(cfg&&cfg.tmdbApiKey)); }\n    catch(err){ console.warn('[settingsOverlay] Failed to update TMDB availability:', err?.message || err); }\n    setTmdbStatus('', '');\n\n    // Check if TMDB is disabled in config\n    if(cfg && cfg.tmdbEnabled === false){\n      setTmdbStatus('\u26A0\uFE0F TMDB ist in config.json deaktiviert (tmdbEnabled: false). Hero-Banner ben\u00F6tigt TMDB!', 'error');\n    }else if(!token){\n      setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info');\n    }\n    // Optional: Auto-Check bei ge\u00F6ffnetem Dialog\n    if(token){\n      (async()=>{\n        setTmdbStatus('Pr\u00FCfe Token...', 'pending');\n        try{\n          const svc = await import('./services/tmdb.js');\n          const res = await svc.validateToken?.(token);\n          if(res && res.ok){\n            setUseTmdbAvailability(true);\n            if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\n            else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\n          }else{\n            setUseTmdbAvailability(false);\n            if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\n            else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\n          }\n        }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\n      })();\n    } else { setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey)); }\n  }\n\n  heroRefreshMovies && heroRefreshMovies.addEventListener('click', ()=>{\n    runHeroRegeneration('movies', 'Aktualisiere Film-Highlights \u2026');\n  });\n  heroRefreshShows && heroRefreshShows.addEventListener('click', ()=>{\n    runHeroRegeneration('series', 'Aktualisiere Serien-Highlights \u2026');\n  });\n  heroRefreshAll && heroRefreshAll.addEventListener('click', ()=>{\n    runHeroRegeneration('all', 'Aktualisiere alle Highlights \u2026');\n  });\n\n  tmdbSave && tmdbSave.addEventListener('click', async ()=>{\n    const raw = String(tmdbInput?.value||'').trim();\n    try{ localStorage.setItem('tmdbToken', raw); }\n    catch(err){ console.warn('[settingsOverlay] Failed to persist tmdbToken:', err?.message || err); }\n    if(!raw){\n      syncDefaultMetadataService(cfg, { preferStoredToken: false, token: '' });\n      setTmdbStatus('Kein Token hinterlegt. TMDB ist deaktiviert.', 'info');\n      setUseTmdbAvailability(!!(cfg&&cfg.tmdbApiKey));\n      HeroPipeline.updateTmdbActive(useTmdb?.checked ?? false);\n      runHeroRegeneration('all', 'Highlights aktualisieren (Token entfernt)\u2026');\n      return;\n    }\n    syncDefaultMetadataService(cfg, { preferStoredToken: false, token: raw });\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\n    try{\n      const svc = await import('./services/tmdb.js');\n      const res = await svc.validateToken?.(raw);\n      if(res && res.ok){\n        setUseTmdbAvailability(true);\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\n      }else{\n        setUseTmdbAvailability(false);\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\n      }\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\n\n    // Check if tmdbEnabled is false and warn user\n    if(cfg && cfg.tmdbEnabled === false && raw){\n      setTmdbStatus('\u26A0\uFE0F Token gespeichert, aber TMDB in config.json deaktiviert. Bitte \"tmdbEnabled\": true setzen!', 'error');\n    }\n\n    // Hero uses TMDB automatically when token is available - update pipeline state\n    HeroPipeline.updateTmdbActive(true);\n    runHeroRegeneration('all', 'Highlights aktualisieren (Token ge\u00E4ndert)\u2026');\n  });\n\n  tmdbTest && tmdbTest.addEventListener('click', async ()=>{\n    const raw = String(tmdbInput?.value||'').trim();\n    if(!raw){ setTmdbStatus('Bitte Token eingeben.', 'error'); return; }\n    setTmdbStatus('Pr\u00FCfe Token...', 'pending');\n    try{\n      const svc = await import('./services/tmdb.js');\n      const res = await svc.validateToken?.(raw);\n      if(res && res.ok){\n        if(res.as==='bearer') setTmdbStatus('Token g\u00FCltig (v4 Bearer).', 'success');\n        else if(res.as==='apikey') setTmdbStatus('API Key g\u00FCltig (v3). Tipp: dauerhaft in site/config.json unter \"tmdbApiKey\" eintragen.', 'success');\n      }else{\n        if(res?.hint==='looksV3') setTmdbStatus('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als \"tmdbApiKey\" eintragen oder v4 Bearer Token verwenden.', 'error');\n        else setTmdbStatus('Token ung\u00FCltig oder keine Berechtigung (401).', 'error');\n      }\n    }catch(e){ setTmdbStatus('Pr\u00FCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\u00FCfen.', 'error'); }\n  });\n  tmdbClear && tmdbClear.addEventListener('click', ()=>{\n    // Use safe clear utility that preserves user settings\n    import('./utils.js').then(m=>{\n      const result = m.clearHeroCache?.();\n      if(result && !result.error){\n        console.log('[settingsOverlay] Cleared hero cache:', result);\n        setTmdbStatus(`Cache geleert: ${result.heroEntries} Hero-Eintr\u00E4ge, ${result.tmdbCacheEntries} TMDB-Eintr\u00E4ge. Token erhalten.`, 'success');\n      }\n    });\n    // Also clear the TMDB service cache\n    import('./services/tmdb.js').then(m=>m.clearCache?.());\n    runHeroRegeneration('all', 'Highlights aktualisieren (TMDB-Cache geleert)\u2026');\n  });\n  reduce && reduce.addEventListener('change', ()=>{\n    try{ localStorage.setItem('prefReduceMotion', reduce.checked ? '1' : '0'); }\n    catch(err){ console.warn('[settingsOverlay] Failed to store reduce-motion preference:', err?.message || err); }\n    notifyReduceMotion(reduce.checked);\n  });\n  useTmdb && useTmdb.addEventListener('change', ()=>{\n    try{ localStorage.setItem('useTmdb', useTmdb.checked ? '1' : '0'); }\n    catch(err){ console.warn('[settingsOverlay] Failed to store TMDB usage preference:', err?.message || err); }\n    // Start TMDB hydration when enabling the toggle (if not already started)\n    if(useTmdb.checked && !tmdbHydrationStarted){\n      tmdbHydrationStarted = true;\n      import('./services/tmdb.js').then(m=>{\n        const s = getState();\n        m.hydrateOptional?.(s.movies, s.shows, s.cfg);\n      }).catch(err=>{ console.warn('[settingsOverlay] Failed to hydrate TMDB data:', err?.message || err); });\n      // Re-render a bit later to reflect incoming posters\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 1200);\n      setTimeout(()=>{ if(useTmdb.checked) renderGrid(getState().view); }, 3000);\n    }\n    // Note: Hero TMDB is automatic based on token, not card toggle\n    // But we still notify pipeline to refresh state\n    HeroPipeline.updateTmdbActive(true);\n    // Only regenerate hero if card toggle changed (cards don't affect hero)\n    // Actually, no need to regenerate hero for card toggle - it uses its own logic\n    renderGrid(getState().view);\n    notifyHeroRefresh();\n  });\n  resetFilters && resetFilters.addEventListener('click', ()=>{\n    const search = document.getElementById('search'); if(search) search.value='';\n    const q = document.getElementById('q'); if(q) q.value='';\n    const onlyNew = document.getElementById('onlyNew'); if(onlyNew) onlyNew.checked=false;\n    const yf = document.getElementById('yearFrom'); const yt = document.getElementById('yearTo'); if(yf) yf.value=''; if(yt) yt.value='';\n    const col = document.getElementById('collectionFilter'); if(col) col.value='';\n    document.querySelectorAll('#genreFilters .chip.active').forEach(n=>n.classList.remove('active'));\n    const genreRoot = document.getElementById('genreFilters');\n    if(genreRoot){\n      genreRoot.dataset.state = 'empty';\n      genreRoot.dataset.count = '0';\n    }\n    import('./filter.js').then(F=>{\n      const result = F.applyFilters();\n      renderGrid(getState().view);\n      notifyHeroRefresh(result);\n    });\n  });\n}\n\n", "import { getState } from './state.js';\nimport { openMovieDetailV3, openSeriesDetailV3 } from './modalV3/index.js';\nimport { humanYear, formatRating, useTmdbOn } from './utils.js';\nimport { recordHeroHistory, getStoredPool } from './hero/storage.js';\n\nconst NUMBER_FORMAT = typeof Intl !== 'undefined' ? new Intl.NumberFormat('en-US') : { format: (value)=>String(value) };\n\nlet currentHeroEntry = null;\nlet heroDefaults = null;\nlet navigateToHashHandler = null;\nlet lastFallbackReason = null;\n\nconst HERO_FALLBACK_COPY = {\n  default: {\n    title: 'Highlights temporarily unavailable',\n    tagline: 'TMDb data could not be loaded just now.',\n    overview: 'The hero banner falls back to a neutral gradient until artwork and metadata are available again. Feel free to keep browsing and refresh later.'\n  },\n  'rate-limit': {\n    title: 'Highlights are catching their breath',\n    tagline: 'TMDb is currently rate limiting our artwork requests.',\n    overview: 'We are slowing down hero generation until the limit resets. Your library stays accessible in the meantime.'\n  },\n  error: {\n    title: 'Highlights paused',\n    tagline: 'Fresh TMDb data is temporarily unavailable.',\n    overview: 'We will automatically retry fetching artwork. You can also trigger a manual refresh from the settings when you are ready.'\n  }\n};\n\nexport function setCurrentHeroItem(item){\n  currentHeroEntry = item || null;\n  return currentHeroEntry;\n}\n\nexport function getCurrentHeroItem(){\n  return currentHeroEntry;\n}\n\nexport function getHeroFallbackReason(){\n  return lastFallbackReason;\n}\n\nexport function setHeroDefaults(defaults){\n  heroDefaults = defaults ? { ...defaults } : null;\n  return heroDefaults;\n}\n\nexport function getHeroDefaults(){\n  return heroDefaults;\n}\n\nexport function ensureHeroDefaults(){\n  if(heroDefaults) return heroDefaults;\n  const defaults = {\n    title: document.getElementById('heroTitle')?.textContent?.trim() || '',\n    tagline: document.getElementById('heroTagline')?.textContent?.trim() || '',\n    overview: document.getElementById('heroOverview')?.textContent?.trim() || '',\n    cta: document.getElementById('heroCta')?.textContent?.trim() || ''\n  };\n  heroDefaults = defaults;\n  return defaults;\n}\n\nexport function setHeroNavigation(handler){\n  navigateToHashHandler = typeof handler === 'function' ? handler : null;\n}\n\nexport function showHeroFallback(reason = 'default', overrides = {}){\n  const hero = document.getElementById('hero');\n  const heroTitle = document.getElementById('heroTitle');\n  const heroTagline = document.getElementById('heroTagline');\n  const heroOverview = document.getElementById('heroOverview');\n  const heroCta = document.getElementById('heroCta');\n  const heroMeta = document.getElementById('heroMeta');\n  const metaPrimary = document.getElementById('heroMetaPrimary');\n  const metaSecondary = document.getElementById('heroMetaSecondary');\n  const metaTertiary = document.getElementById('heroMetaTertiary');\n  const heroPicture = document.getElementById('heroPicture');\n  const heroImage = document.getElementById('heroBackdropImage');\n  const heroSourceLarge = document.getElementById('heroBackdropLarge');\n  const heroSourceMedium = document.getElementById('heroBackdropMedium');\n\n  if(!hero || !heroTitle || !heroTagline || !heroOverview || !heroCta || !heroMeta) return false;\n\n  const defaults = ensureHeroDefaults();\n  const copy = { ...HERO_FALLBACK_COPY.default, ...(HERO_FALLBACK_COPY[reason] || {}), ...(overrides || {}) };\n\n  setCurrentHeroItem(null);\n  lastFallbackReason = reason;\n\n  hero.dataset.heroKind = 'fallback';\n  hero.dataset.heroId = '';\n  hero.dataset.state = 'fallback';\n  hero.classList.remove('hero--has-media');\n  clearPicture(heroPicture, heroImage, heroSourceLarge, heroSourceMedium);\n\n  heroTitle.textContent = copy.title || defaults.title;\n\n  const taglineText = copy.tagline || '';\n  heroTagline.textContent = taglineText || defaults.tagline;\n  heroTagline.hidden = !taglineText;\n  heroTagline.dataset.taglinePaused = '0';\n  delete heroTagline.dataset.heroBound;\n  heroTagline.classList.remove('is-fading');\n\n  const overviewText = copy.overview || '';\n  heroOverview.textContent = overviewText;\n  heroOverview.hidden = !overviewText;\n\n  const ctaLabel = copy.cta || defaults.cta || heroCta.textContent || 'Browse featured titles';\n  heroCta.textContent = ctaLabel;\n  const ctaEnabled = typeof copy.ctaAction === 'function' && copy.ctaEnabled === true;\n  heroCta.disabled = !ctaEnabled;\n  heroCta.setAttribute('aria-disabled', ctaEnabled ? 'false' : 'true');\n  if(ctaEnabled){\n    heroCta.onclick = () => { try { copy.ctaAction(); } catch (err) { console.warn('[hero] Fallback CTA failed:', err?.message || err); } };\n    heroCta.setAttribute('aria-label', copy.ctaLabel || ctaLabel);\n  } else {\n    heroCta.onclick = null;\n    heroCta.removeAttribute('aria-label');\n  }\n\n  heroMeta.hidden = true;\n  if(metaPrimary) metaPrimary.innerHTML = '';\n  if(metaSecondary) metaSecondary.innerHTML = '';\n  if(metaTertiary) metaTertiary.innerHTML = '';\n\n  return true;\n}\n\nexport function refreshHero(listOverride){\n  const hero = document.getElementById('hero');\n  const heroTitle = document.getElementById('heroTitle');\n  const heroTagline = document.getElementById('heroTagline');\n  const heroOverview = document.getElementById('heroOverview');\n  const heroCta = document.getElementById('heroCta');\n  const heroMeta = document.getElementById('heroMeta');\n  const metaPrimary = document.getElementById('heroMetaPrimary');\n  const metaSecondary = document.getElementById('heroMetaSecondary');\n  const metaTertiary = document.getElementById('heroMetaTertiary');\n  const heroPicture = document.getElementById('heroPicture');\n  const heroImage = document.getElementById('heroBackdropImage');\n  const heroSourceLarge = document.getElementById('heroBackdropLarge');\n  const heroSourceMedium = document.getElementById('heroBackdropMedium');\n\n  if(!hero || !heroTitle || !heroTagline || !heroOverview || !heroCta || !heroMeta) return;\n\n  const defaults = ensureHeroDefaults();\n  const candidate = selectHeroEntry(listOverride);\n\n  if(!candidate){\n    setCurrentHeroItem(null);\n    lastFallbackReason = null;\n    hero.dataset.heroKind = '';\n    hero.dataset.heroId = '';\n    hero.dataset.state = 'empty';\n    hero.classList.remove('hero--has-media');\n    clearPicture(heroPicture, heroImage, heroSourceLarge, heroSourceMedium);\n    heroTitle.textContent = defaults.title;\n    heroTagline.textContent = defaults.tagline;\n    heroTagline.hidden = !defaults.tagline;\n    heroTagline.dataset.taglinePaused = '0';\n    delete heroTagline.dataset.heroBound;\n    heroTagline.classList.remove('is-fading');\n    heroOverview.textContent = defaults.overview;\n    heroOverview.hidden = !defaults.overview;\n    heroCta.textContent = defaults.cta || 'View details';\n    heroCta.disabled = true;\n    heroCta.setAttribute('aria-disabled', 'true');\n    heroCta.removeAttribute('aria-label');\n    heroCta.onclick = null;\n    heroMeta.hidden = true;\n    if(metaPrimary) metaPrimary.innerHTML = '';\n    if(metaSecondary) metaSecondary.innerHTML = '';\n    if(metaTertiary) metaTertiary.innerHTML = '';\n    return;\n  }\n\n  const normalized = ensureNormalizedEntry(candidate);\n  if(!normalized){\n    return refreshHero([]);\n  }\n\n  setCurrentHeroItem(normalized);\n  lastFallbackReason = null;\n\n  const kind = normalized.type === 'tv' ? 'show' : 'movie';\n  const targetId = normalized.cta?.id || normalized.id || '';\n\n  try {\n    recordHeroHistory(kind === 'show' ? 'series' : 'movies', normalized);\n  } catch (err) {\n    console.warn('[hero] Failed to record hero history:', err?.message || err);\n  }\n\n  hero.dataset.heroKind = kind;\n  hero.dataset.heroId = targetId;\n  hero.dataset.state = 'ready';\n\n  heroTitle.textContent = normalized.title || defaults.title;\n\n  if(heroTagline){\n    const tagline = normalized.tagline || '';\n    heroTagline.textContent = tagline;\n    heroTagline.hidden = !tagline;\n    heroTagline.dataset.taglinePaused = tagline ? '1' : '0';\n    if(tagline) heroTagline.dataset.heroBound = '1';\n    else delete heroTagline.dataset.heroBound;\n    heroTagline.classList.remove('is-fading');\n  }\n\n  if(heroOverview){\n    const overview = normalized.overview || '';\n    heroOverview.textContent = overview;\n    heroOverview.hidden = !overview;\n  }\n\n  const ctaLabel = normalized.cta?.label || (kind === 'show' ? 'View show details' : 'View movie details');\n  heroCta.textContent = ctaLabel;\n  heroCta.disabled = false;\n  heroCta.setAttribute('aria-disabled', 'false');\n  heroCta.setAttribute('aria-label', normalized.title ? `${ctaLabel}: ${normalized.title}` : ctaLabel);\n  heroCta.onclick = () => openHeroModal(normalized);\n\n  renderMeta(metaPrimary, metaSecondary, metaTertiary, heroMeta, normalized);\n  renderMedia(hero, heroPicture, heroImage, heroSourceLarge, heroSourceMedium, normalized);\n}\n\nfunction selectHeroEntry(listOverride){\n  if(Array.isArray(listOverride) && listOverride.length){\n    const normalizedOverride = ensureNormalizedList(listOverride);\n    if(normalizedOverride.length){\n      return chooseHeroCandidate(normalizedOverride);\n    }\n  }\n\n  const source = heroCandidatesFromState();\n  if(!source.length) return null;\n  return chooseHeroCandidate(source);\n}\n\nfunction ensureNormalizedList(list){\n  if(!Array.isArray(list)) return [];\n  const normalized = [];\n  list.forEach(item => {\n    if(!isPlayableHeroItem(item)) return;\n    const entry = ensureNormalizedEntry(item);\n    if(entry) normalized.push(entry);\n  });\n  return normalized;\n}\n\nfunction isPlayableHeroItem(item){\n  if(!item || typeof item !== 'object') return false;\n  if(item.isCollectionGroup) return false;\n  const type = typeof item.type === 'string' ? item.type.toLowerCase() : '';\n  if(type === 'collection') return false;\n  return true;\n}\n\nfunction chooseHeroCandidate(list){\n  if(list.length === 1) return list[0];\n  const index = Math.floor(Math.random() * list.length);\n  const candidate = list[index];\n  if(currentHeroEntry && list.length > 1 && candidate && currentHeroEntry && candidate.id === currentHeroEntry.id){\n    const alt = list.find(item => item && item.id !== currentHeroEntry.id);\n    return alt || candidate;\n  }\n  return candidate;\n}\n\nfunction heroCandidatesFromState(){\n  const state = getState();\n  const view = state.view === 'shows' ? 'series' : 'movies';\n  const stored = getStoredPool(view, { allowExpired: true }) || null;\n  const fromPool = Array.isArray(stored?.items) ? ensureNormalizedList(stored.items) : [];\n  if(fromPool.length) return fromPool;\n\n  const filtered = Array.isArray(state.filtered) && state.filtered.length ? state.filtered : null;\n  const pool = filtered || (view === 'series' ? state.shows : state.movies) || [];\n  return ensureNormalizedList(pool);\n}\n\nfunction ensureNormalizedEntry(item){\n  if(!item || typeof item !== 'object') return null;\n  if(isNormalized(item)){\n    return { ...item, cta: item.cta ? { ...item.cta } : null };\n  }\n  return normalizeLegacyItem(item);\n}\n\nfunction isNormalized(item){\n  if(!item || typeof item !== 'object') return false;\n  const ctaId = item?.cta?.id || item?.heroId;\n  return Boolean(item.title && ctaId);\n}\n\nfunction normalizeLegacyItem(raw){\n  if(!raw || typeof raw !== 'object') return null;\n  const type = raw.type === 'tv' ? 'tv' : 'movie';\n  const title = String(raw.title || raw.name || '').trim();\n  if(!title) return null;\n\n  const ids = collectIds(raw);\n  const targetId = ids.tmdb || ids.imdb || ids.ratingKey || '';\n  if(!targetId) return null;\n\n  const year = parseYear(raw);\n  const runtime = parseRuntime(raw, type);\n  const rating = parseRating(raw);\n  const genres = collectGenres(raw);\n  const certification = parseCertification(raw);\n  const overview = parseOverview(raw);\n  const tagline = parseTagline(raw);\n  const backdrops = collectLegacyBackdrops(raw);\n\n  const cta = {\n    id: targetId,\n    kind: type === 'tv' ? 'show' : 'movie',\n    label: type === 'tv' ? 'View show details' : 'View movie details',\n    target: `#/${type === 'tv' ? 'show' : 'movie'}/${targetId}`\n  };\n\n  return {\n    id: ids.ratingKey || `${type}-${targetId}`,\n    type,\n    title,\n    tagline,\n    overview,\n    year,\n    runtime,\n    rating,\n    genres,\n    certification,\n    cta,\n    ids,\n    backdrops\n  };\n}\n\nfunction collectIds(raw){\n  const ids = {};\n  if(raw?.ids && typeof raw.ids === 'object'){\n    if(raw.ids.tmdb) ids.tmdb = String(raw.ids.tmdb);\n    if(raw.ids.imdb) ids.imdb = String(raw.ids.imdb);\n    if(raw.ids.tvdb) ids.tvdb = String(raw.ids.tvdb);\n  }\n  if(raw?.ratingKey != null) ids.ratingKey = String(raw.ratingKey);\n  if(raw?.guid) ids.guid = String(raw.guid);\n  return ids;\n}\n\nfunction parseYear(raw){\n  const year = humanYear(raw);\n  return year ? Number(year) : null;\n}\n\nfunction parseRuntime(raw, type){\n  const minutes = raw?.runtimeMin ?? raw?.durationMin ?? (raw?.duration ? Math.round(Number(raw.duration) / 60000) : null);\n  if(!Number.isFinite(minutes) || minutes <= 0) return null;\n  if(type === 'tv') return Math.max(1, Math.round(minutes));\n  return Math.max(1, Math.round(minutes));\n}\n\nfunction parseRating(raw){\n  const rating = Number(raw?.rating ?? raw?.audienceRating);\n  return Number.isFinite(rating) ? rating : null;\n}\n\nfunction collectGenres(raw){\n  const source = Array.isArray(raw?.genres) ? raw.genres : [];\n  const names = [];\n  source.forEach(entry => {\n    if(!entry) return;\n    if(typeof entry === 'string'){\n      const trimmed = entry.trim();\n      if(trimmed) names.push(trimmed);\n      return;\n    }\n    const name = entry.tag || entry.title || entry.name || entry.label || '';\n    if(name) names.push(name);\n  });\n  return Array.from(new Set(names));\n}\n\nfunction parseCertification(raw){\n  const rating = typeof raw?.contentRating === 'string' ? raw.contentRating.trim() : '';\n  if(!rating) return '';\n  const segments = rating.split('/');\n  const last = segments[segments.length - 1];\n  return last ? last.trim() : rating;\n}\n\nfunction parseOverview(raw){\n  const sources = [raw?.summary, raw?.plot, raw?.description, raw?.tagline];\n  for(const value of sources){\n    if(typeof value !== 'string') continue;\n    const trimmed = value.trim();\n    if(trimmed) return trimmed;\n  }\n  return '';\n}\n\nfunction parseTagline(raw){\n  const sources = [raw?.tagline];\n  for(const value of sources){\n    if(typeof value !== 'string') continue;\n    const trimmed = value.trim();\n    if(trimmed) return trimmed;\n  }\n  return '';\n}\n\nfunction collectLegacyBackdrops(raw){\n  const preferTmdb = useTmdbOn();\n  const tmdbCandidates = [\n    raw?.tmdb?.backdrop,\n    raw?.tmdb?.backdrop_path,\n    raw?.tmdb?.backdropPath,\n    raw?.tmdb?.background,\n    raw?.tmdb?.art\n  ];\n  const localCandidates = [\n    raw?.art,\n    raw?.background,\n    raw?.thumbBackground,\n    raw?.coverArt,\n    raw?.thumb,\n    raw?.thumbFile\n  ];\n  const urls = [];\n  if(preferTmdb){\n    tmdbCandidates.forEach(candidate => {\n      const url = normalizeMediaPath(candidate, true);\n      if(url && !urls.includes(url)) urls.push(url);\n    });\n  }\n  localCandidates.forEach(candidate => {\n    const url = normalizeMediaPath(candidate, false);\n    if(url && !urls.includes(url)) urls.push(url);\n  });\n  return urls;\n}\n\nfunction normalizeMediaPath(path, preferTmdb){\n  if(typeof path !== 'string') return '';\n  const trimmed = path.trim();\n  if(!trimmed) return '';\n  if(trimmed.startsWith('http')) return trimmed;\n  if(trimmed.startsWith('/')){\n    if(preferTmdb && !trimmed.startsWith('/library/')){\n      return `https://image.tmdb.org/t/p/original${trimmed}`;\n    }\n    return trimmed;\n  }\n  return trimmed;\n}\n\nfunction renderMeta(primaryRoot, secondaryRoot, tertiaryRoot, container, entry){\n  const rows = buildMetaRows(entry);\n  const [primary = [], secondary = [], tertiary = []] = rows;\n\n  renderMetaRow(primaryRoot, primary);\n  renderMetaRow(secondaryRoot, secondary);\n  renderMetaRow(tertiaryRoot, tertiary);\n\n  const hasContent = primary.length || secondary.length || tertiary.length;\n  container.hidden = !hasContent;\n}\n\nfunction buildMetaRows(entry){\n  const rows = [];\n  const primary = [];\n  if(Number.isFinite(entry.year)) primary.push({ text: String(entry.year), label: 'Release year' });\n  if(Number.isFinite(entry.runtime)){\n    const runtimeText = entry.type === 'tv' ? `${entry.runtime} min/ep` : formatRuntime(entry.runtime);\n    primary.push({ text: runtimeText, label: entry.type === 'tv' ? 'Episode runtime' : 'Runtime' });\n  }\n  if(entry.certification){\n    primary.push({ text: entry.certification, label: 'Certification', kind: 'certification' });\n  }\n  if(primary.length) rows.push(primary);\n\n  const secondary = [];\n  if(entry.rating != null){\n    const ratingValue = formatRating(entry.rating);\n    secondary.push({ text: `\u2605 ${ratingValue}`, label: `Average rating ${ratingValue} out of 10`, kind: 'rating' });\n  }\n  if(entry.voteCount != null){\n    const votes = NUMBER_FORMAT.format(entry.voteCount);\n    secondary.push({ text: `${votes} votes`, label: `${votes} votes recorded` });\n  }\n  if(entry.type === 'tv'){\n    const parts = [];\n    if(Number.isFinite(entry.seasons) && entry.seasons > 0){\n      parts.push(`${entry.seasons} ${entry.seasons === 1 ? 'Season' : 'Seasons'}`);\n    }\n    if(Number.isFinite(entry.episodes) && entry.episodes > 0){\n      parts.push(`${entry.episodes} ${entry.episodes === 1 ? 'Episode' : 'Episodes'}`);\n    }\n    if(parts.length){\n      secondary.push({ text: parts.join(' \u2022 '), label: 'Episode availability' });\n    }\n  }\n  if(secondary.length) rows.push(secondary);\n\n  const tertiary = [];\n  if(Array.isArray(entry.genres)){\n    entry.genres.slice(0, 3).forEach(genre => {\n      const text = typeof genre === 'string' ? genre : '';\n      if(text) tertiary.push({ text, label: `Genre: ${text}` });\n    });\n  }\n  if(tertiary.length) rows.push(tertiary);\n\n  return rows;\n}\n\nfunction renderMetaRow(root, items){\n  if(!root){\n    return;\n  }\n  if(!items || !items.length){\n    root.innerHTML = '';\n    root.hidden = true;\n    return;\n  }\n  const fragment = document.createDocumentFragment();\n  items.forEach(item => {\n    const badge = document.createElement('span');\n    badge.className = 'hero__badge';\n    if(item.kind === 'certification') badge.classList.add('hero__badge--certification');\n    if(item.kind === 'rating') badge.classList.add('hero__badge--rating');\n    badge.textContent = item.text;\n    if(item.label) badge.setAttribute('aria-label', item.label);\n    fragment.appendChild(badge);\n  });\n  root.replaceChildren(fragment);\n  root.hidden = false;\n}\n\nfunction renderMedia(hero, picture, image, sourceLarge, sourceMedium, entry){\n  const backdrops = Array.isArray(entry.backdrops) ? entry.backdrops.filter(Boolean) : [];\n  const primary = backdrops[0] || '';\n  if(!picture || !image){\n    hero.classList.toggle('hero--has-media', Boolean(primary));\n    return;\n  }\n  if(!primary){\n    clearPicture(picture, image, sourceLarge, sourceMedium);\n    hero.classList.remove('hero--has-media');\n    return;\n  }\n  hero.classList.add('hero--has-media');\n  setSource(sourceLarge, primary);\n  setSource(sourceMedium, primary);\n  image.src = primary;\n  image.alt = entry.title ? `${entry.title} backdrop` : '';\n  image.removeAttribute('hidden');\n  picture.hidden = false;\n}\n\nfunction setSource(node, value){\n  if(!node) return;\n  if(value){\n    node.srcset = value;\n  } else {\n    node.removeAttribute('srcset');\n  }\n}\n\nfunction clearPicture(picture, image, sourceLarge, sourceMedium){\n  if(sourceLarge) sourceLarge.removeAttribute('srcset');\n  if(sourceMedium) sourceMedium.removeAttribute('srcset');\n  if(image){\n    image.removeAttribute('src');\n    image.setAttribute('hidden', '');\n  }\n  if(picture) picture.hidden = true;\n}\n\nfunction formatRuntime(minutes){\n  if(!Number.isFinite(minutes) || minutes <= 0) return '';\n  const hrs = Math.floor(minutes / 60);\n  const mins = Math.round(minutes % 60);\n  if(hrs && mins){\n    return `${hrs}h ${mins}m`;\n  }\n  if(hrs){\n    return `${hrs}h`;\n  }\n  return `${mins}m`;\n}\n\nfunction openHeroModal(entry){\n  const cta = entry?.cta;\n  const kind = cta?.kind || (entry.type === 'tv' ? 'show' : 'movie');\n  const id = cta?.id || entry.id;\n  if(!kind || !id) return;\n  navigateToItemHash(kind, id, cta?.target);\n  if(kind === 'show') openSeriesDetailV3(id);\n  else openMovieDetailV3(id);\n}\n\nfunction navigateToItemHash(kind, id, explicitTarget){\n  if(!kind || !id) return;\n  const hash = explicitTarget || `#/${kind}/${id}`;\n  const replace = (window.location.hash || '') === hash;\n  if(typeof navigateToHashHandler === 'function'){\n    try{\n      navigateToHashHandler(hash, { silent: true, replace });\n      return;\n    }catch(err){\n      console.warn('[hero] Failed to navigate via handler:', err?.message);\n    }\n  }\n  try{\n    window.location.hash = hash;\n  }catch(err){\n    console.warn('[hero] Failed to update hash directly:', err?.message);\n  }\n}\n", "import { refreshHero } from './hero.js';\nimport { getState, subscribe as subscribeState } from './state.js';\nimport * as HeroPipeline from './hero/pipeline.js';\n\nexport function initHeroAutoplay({ onRefresh = refreshHero } = {}){\n  const hero = document.getElementById('hero');\n  const timer = document.getElementById('heroTimer');\n  const bar = timer ? timer.querySelector('.hero-timer__bar') : null;\n  if(!hero || !timer || !bar) return null;\n  const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  if(reduce) { timer.hidden = true; return null; }\n  timer.removeAttribute('aria-hidden');\n  timer.dataset.state = 'running';\n\n  const DURATION = 15000; // 15s\n  const pauseReasons = new Set();\n  let wasPaused = false;\n  let elapsed = 0; // ms accumulated when not paused\n  let raf = null;\n  let lastTs = 0;\n  const pipelineEnabled = HeroPipeline.isEnabled();\n  let rotationKind = resolveKind();\n  let rotationItems = [];\n  let rotationIndex = 0;\n  let pipelinePaused = false;\n  let rotationSignature = '';\n  let unsubscribePipeline = null;\n  let unsubscribeState = null;\n\n  if(pipelineEnabled){\n    applyRotationPlan(HeroPipeline.getRotationPlan(rotationKind));\n    unsubscribePipeline = HeroPipeline.subscribe(() => {\n      applyRotationPlan(HeroPipeline.getRotationPlan(rotationKind));\n    });\n  }\n\n  unsubscribeState = subscribeState(() => {\n    const kind = resolveKind();\n    if(kind === rotationKind) return;\n    rotationKind = kind;\n    if(pipelineEnabled){\n      applyRotationPlan(HeroPipeline.getRotationPlan(rotationKind));\n    }\n  });\n\n  function resolveKind(){\n    const view = getState().view;\n    return view === 'shows' ? 'series' : 'movies';\n  }\n\n  function isPaused(){\n    return pauseReasons.size > 0;\n  }\n\n  function updatePausedState(){\n    const pausedNow = isPaused();\n    timer.dataset.state = pausedNow ? 'paused' : 'running';\n    if(wasPaused && !pausedNow){\n      lastTs = 0;\n    }\n    wasPaused = pausedNow;\n  }\n\n  function setPaused(reason, value){\n    if(value){\n      pauseReasons.add(reason);\n    }else{\n      pauseReasons.delete(reason);\n    }\n    updatePausedState();\n  }\n\n  function advanceRotation(){\n    if(!rotationItems.length) return null;\n    rotationIndex = (rotationIndex + 1) % rotationItems.length;\n    return rotationItems[rotationIndex];\n  }\n\n  function applyRotationPlan(plan){\n    if(!plan) return;\n    const items = Array.isArray(plan.items) ? plan.items : [];\n    const snapshot = plan.snapshot || HeroPipeline.getSnapshot();\n    const status = snapshot.status?.[rotationKind];\n    const busy = !HeroPipeline.isReady() || status?.regenerating;\n    const signature = `${rotationKind}:${status?.updatedAt || 0}:${items.length}`;\n    const hadItems = rotationItems.length > 0;\n    const previouslyPaused = pipelinePaused;\n\n    rotationItems = items;\n    rotationIndex = items.length ? (plan.startIndex % items.length) : 0;\n    pipelinePaused = busy || !items.length;\n    setPaused('pipeline', pipelinePaused);\n\n    if(!pipelinePaused && items.length){\n      if(!hadItems || previouslyPaused || rotationSignature !== signature){\n        try { onRefresh?.([items[rotationIndex]]); } catch (_err) {}\n        elapsed = 0;\n        bar.style.setProperty('--p', '0');\n      }\n    }\n\n    rotationSignature = signature;\n  }\n\n  function step(ts){\n    if(isPaused()){ lastTs = ts; raf = requestAnimationFrame(step); return; }\n    if(!lastTs) lastTs = ts;\n    const dt = Math.max(0, ts - lastTs);\n    lastTs = ts;\n    elapsed += dt;\n    const prog = Math.max(0, Math.min(1, elapsed / DURATION));\n    bar.style.setProperty('--p', String(prog));\n    if(prog >= 1){\n      // reset and ask app to refresh hero gently\n      elapsed = 0; lastTs = ts; bar.style.setProperty('--p','0');\n      try {\n        if(pipelineEnabled){\n          const next = advanceRotation();\n          if(next){ onRefresh?.([next]); }\n          else { onRefresh?.(); }\n        }else{\n          onRefresh?.();\n        }\n      } catch(_e) {\n        // no-op\n      }\n    }\n    raf = requestAnimationFrame(step);\n  }\n\n  function start(){ if(!raf) raf = requestAnimationFrame(step); }\n  // Pause on hover (without affecting layout)\n  hero.addEventListener('mouseenter', () => { setPaused('hover', true); });\n  hero.addEventListener('mouseleave', () => { setPaused('hover', false); });\n  document.addEventListener('visibilitychange', () => {\n    setPaused('hidden', document.hidden);\n  });\n\n  if(document.hidden){\n    setPaused('hidden', true);\n  } else {\n    updatePausedState();\n  }\n\n  start();\n\n  return {\n    pause(){ setPaused('manual', true); },\n    resume(){ setPaused('manual', false); },\n    reset(){ elapsed = 0; bar.style.setProperty('--p','0'); },\n    destroy(){\n      if(unsubscribePipeline) unsubscribePipeline();\n      if(unsubscribeState) unsubscribeState();\n    }\n  };\n}\n", "import { setState, getState } from './state.js';\nimport { showLoader, setLoader, hideLoader, showSkeleton, clearSkeleton } from './loader.js';\nimport * as Data from './data.js';\nimport * as Filter from './filter.js';\nimport { renderGrid } from './grid.js';\nimport { openMovieDetailV3, openSeriesDetailV3 } from './modalV3/index.js';\nimport { hydrateOptional } from './services/tmdb.js';\nimport * as Watch from './watchlist.js';\nimport * as Debug from './debug.js';\nimport { initErrorHandler, showError, showRetryableError } from './errorHandler.js';\nimport { initSettingsOverlay, setHeroRefreshHandler, setReduceMotionHandler } from './settingsOverlay.js';\nimport { refreshHero, setHeroNavigation, showHeroFallback } from './hero.js';\nimport { initHeroAutoplay } from './hero-autoplay.js';\nimport * as HeroPolicy from './hero/policy.js';\nimport * as HeroPipeline from './hero/pipeline.js';\nimport { syncDefaultMetadataService } from './metadataService.js';\n\nconst DEFAULT_FEATURE_FLAGS = { tmdbEnrichment: false };\nconst globalFeatures = (()=>{\n  const existing = typeof window !== 'undefined' && window.FEATURES ? window.FEATURES : {};\n  const merged = { ...DEFAULT_FEATURE_FLAGS, ...existing };\n  if(typeof window !== 'undefined'){\n    window.FEATURES = merged;\n  }\n  return merged;\n})();\n\nfunction applyFeatureFlags(cfg){\n  try{\n    if(globalFeatures){\n      globalFeatures.tmdbEnrichment = !!(cfg && cfg.tmdbEnabled);\n    }\n    if(typeof window !== 'undefined' && window.FEATURES && window.FEATURES !== globalFeatures){\n      window.FEATURES = { ...window.FEATURES, ...globalFeatures };\n    }\n  }catch(err){\n    console.warn('[main] Failed to apply feature flags:', err?.message || err);\n  }\n}\n\nlet taglineTicker = null;\nconst heroFallbackNotice = { reason: null };\n\nconst HERO_FALLBACK_MESSAGES = {\n  'rate-limit': () => showError('TMDb drosselt Anfragen', 'Highlights werden kurzzeitig langsamer aktualisiert.'),\n  error: detail => showError('Highlights vor\u00FCbergehend nicht verf\u00FCgbar', detail?.status?.lastError || 'TMDb-Daten konnten nicht geladen werden.'),\n  default: () => showError('Highlights vor\u00FCbergehend nicht verf\u00FCgbar', 'TMDb-Daten konnten nicht geladen werden.')\n};\n\nfunction announceHeroFallback(reason, detail){\n  if(heroFallbackNotice.reason === reason) return;\n  heroFallbackNotice.reason = reason;\n  const handler = HERO_FALLBACK_MESSAGES[reason] || HERO_FALLBACK_MESSAGES.default;\n  try {\n    handler(detail);\n  } catch (err) {\n    console.warn('[main] Failed to show hero fallback notification:', err?.message || err);\n  }\n}\n\nconst hashNavigation = (() => {\n  let lastHash = window.location.hash || '';\n  let suppressedHash = null;\n\n  function normalizeHash(raw){\n    if(typeof raw !== 'string') return '';\n    const trimmed = raw.trim();\n    if(!trimmed) return '';\n    return trimmed.startsWith('#') ? trimmed : `#${trimmed}`;\n  }\n\n  function updateHash(targetHash, options={}){\n    const { replace=false, silent=false } = options;\n    const hash = normalizeHash(targetHash);\n    if(!hash) return;\n\n    const current = window.location.hash || '';\n    if(hash === current){\n      if(replace && history && typeof history.replaceState === 'function'){\n        try{\n          history.replaceState(null, '', hash);\n        }catch(err){\n          console.warn('[main] Failed to replace hash via history:', err.message);\n        }\n      }\n      if(silent){\n        suppressedHash = hash;\n        lastHash = hash;\n      }\n      return;\n    }\n\n    const method = replace ? 'replaceState' : 'pushState';\n    let usedHistory = false;\n    try{\n      if(history && typeof history[method] === 'function'){\n        history[method](null, '', hash);\n        usedHistory = true;\n      }\n    }catch(err){\n      console.warn(`[main] Failed to ${replace ? 'replace' : 'push'} hash via history:`, err.message);\n    }\n\n    if(!usedHistory){\n      window.location.hash = hash;\n      if(silent){\n        suppressedHash = hash;\n        lastHash = hash;\n      }\n      return;\n    }\n\n    if(silent){\n      suppressedHash = hash;\n      lastHash = hash;\n      return;\n    }\n\n    try{\n      const event = typeof HashChangeEvent === 'function' ? new HashChangeEvent('hashchange') : new Event('hashchange');\n      window.dispatchEvent(event);\n    }catch(err){\n      console.warn('[main] Failed to dispatch hashchange event:', err.message);\n    }\n  }\n\n  function shouldHandle(hash){\n    const current = typeof hash === 'string' ? hash : '';\n    if(suppressedHash && current === suppressedHash){\n      suppressedHash = null;\n      return false;\n    }\n    suppressedHash = null;\n    if(current === lastHash) return false;\n    lastHash = current;\n    return true;\n  }\n\n  function markProcessed(hash){\n    lastHash = typeof hash === 'string' ? hash : '';\n    suppressedHash = null;\n  }\n\n  return { navigate: updateHash, shouldHandle, markProcessed };\n})();\n\nexport const navigateToHash = (hash, options) => hashNavigation.navigate(hash, options);\n\nsetHeroNavigation(navigateToHash);\n\nfunction refreshHeroWithPipeline(listOverride){\n  if(Array.isArray(listOverride) && listOverride.length){\n    heroFallbackNotice.reason = null;\n    refreshHero(listOverride);\n    return;\n  }\n  if(HeroPipeline.isEnabled()){\n    const currentView = getState().view === 'shows' ? 'series' : 'movies';\n    const plan = HeroPipeline.getRotationPlan(currentView);\n    const status = plan?.snapshot?.status?.[currentView];\n    const ready = HeroPipeline.isReady();\n    const busy = status?.regenerating;\n    const items = Array.isArray(plan?.items) ? plan.items : [];\n    const tmdbRateLimit = plan?.snapshot?.tmdb?.rateLimit;\n    const rateLimited = !!tmdbRateLimit?.active;\n    const pipelineError = status?.state === 'error';\n    const shouldFallback = (!items.length && (pipelineError || (rateLimited && ready && !busy)));\n    if(shouldFallback){\n      const reason = pipelineError ? 'error' : 'rate-limit';\n      const applied = showHeroFallback(reason);\n      if(applied){\n        announceHeroFallback(reason, { status, rateLimit: tmdbRateLimit });\n      }\n      return;\n    }\n    if(ready && !busy && items.length){\n      const index = plan.startIndex % items.length;\n      const entry = items[index];\n      if(entry){\n        heroFallbackNotice.reason = null;\n        refreshHero([entry]);\n        return;\n      }\n    }\n  }\n  heroFallbackNotice.reason = null;\n  refreshHero(listOverride);\n}\n\nfunction setFooterStatus(message, busy=true){\n  const footer = document.getElementById('footerMeta');\n  if(footer){\n    const status = footer.querySelector('#footerStatus');\n    if(status) status.textContent = message;\n    else footer.textContent = message;\n    footer.dataset.state = busy ? 'loading' : 'ready';\n  }\n  const grid = document.getElementById('grid');\n  if(grid){\n    grid.setAttribute('aria-busy', busy ? 'true' : 'false');\n  }\n}\n\nexport async function boot(){\n  const isTestEnv = !!globalThis.__PLEX_TEST_MODE__;\n  initErrorHandler();\n  applyReduceMotionPref();\n  showLoader();\n  setFooterStatus('Initialisiere \u2026', true);\n  setLoader('Initialisiere \u2026', 8);\n  showSkeleton(18);\n\n  const configPromise = fetch('config.json').then(r=>r.json()).catch((err)=>{\n    console.warn('[main] Failed to load config.json, using defaults:', err.message);\n    showError('Konfiguration konnte nicht geladen werden', 'Verwende Standardeinstellungen');\n    return { startView:'movies', tmdbEnabled:false };\n  });\n  const policyPromise = HeroPolicy.initHeroPolicy().catch((err)=>{\n    console.warn('[main] Failed to initialise hero policy:', err?.message || err);\n    return HeroPolicy.getHeroPolicy();\n  });\n\n  const [cfg, heroPolicy] = await Promise.all([configPromise, policyPromise]);\n  applyFeatureFlags(cfg);\n  syncDefaultMetadataService(cfg);\n  const heroPipelineInfo = HeroPipeline.configure({ cfg, policy: heroPolicy });\n  setState({\n    cfg,\n    view: cfg.startView || 'movies',\n    heroPolicy,\n    heroPolicyIssues: HeroPolicy.getValidationIssues(),\n    heroPipelineEnabled: heroPipelineInfo.enabled,\n    heroPipelineSource: heroPipelineInfo.source\n  });\n\n  try {\n    setFooterStatus('Filme laden \u2026', true);\n    setLoader('Filme laden \u2026', 25);\n    const movies = await Data.loadMovies();\n    setFooterStatus('Serien laden \u2026', true);\n    setLoader('Serien laden \u2026', 45);\n    const shows  = await Data.loadShows();\n\n    setFooterStatus('Filter vorbereiten \u2026', true);\n    setLoader('Filter vorbereiten \u2026', 60);\n    // build facets (richer set via Filter)\n    const facets = Filter.computeFacets(movies, shows);\n    setState({ movies, shows, facets });\n    HeroPipeline.setSources({ movies, shows });\n    HeroPipeline.setActiveView(getState().view);\n\n    if(HeroPipeline.isEnabled()){\n      setFooterStatus('Highlights vorbereiten \u2026', true);\n      setLoader('Highlights vorbereiten \u2026', 70);\n      try {\n        await HeroPipeline.primeAll();\n      } catch (err) {\n        console.warn('[main] Hero pipeline initial prime failed:', err?.message || err);\n      }\n    }\n\n    setFooterStatus('Ansicht aufbauen \u2026', true);\n    setLoader('Ansicht aufbauen \u2026', 85);\n    clearSkeleton();\n    renderSwitch();\n    Filter.renderFacets(facets);\n    Filter.initFilters();\n    const filtered = Filter.applyFilters();\n    renderStats(true);\n    renderGrid(getState().view);\n    renderFooterMeta();\n\n    hideLoader();\n\n    if(cfg.tmdbEnabled){\n      if(window.requestIdleCallback){\n        window.requestIdleCallback(()=> hydrateOptional?.(movies, shows, cfg), { timeout: 600 });\n      }else{\n        setTimeout(()=> hydrateOptional?.(movies, shows, cfg), 400);\n      }\n    }\n\n    if(!isTestEnv){\n      Watch.initUi();\n      initSettingsOverlay(cfg);\n      initAdvancedToggle();\n      initHeaderInteractions();\n      initScrollProgress();\n      initScrollTop();\n      initFilterBarAutoHideFallback();\n      refreshHeroWithPipeline(filtered);\n      initHeroAutoplay({ onRefresh: refreshHeroWithPipeline });\n      Debug.initDebugUi();\n    }else{\n      try{\n        refreshHeroWithPipeline(filtered);\n      }catch(err){\n        console.warn('[main] Test env hero refresh skipped:', err?.message || err);\n      }\n    }\n    handleHashChange(true);\n  } catch (error) {\n    console.error('[main] Boot failed:', error);\n    hideLoader();\n    clearSkeleton();\n    showRetryableError('Fehler beim Laden der Daten', () => window.location.reload());\n    throw error;\n  }\n  // Re-render grid on TMDB hydration progress to reveal new posters/data\n  // Note: Grid cards only re-render if user has enabled TMDB images\n  // Hero banner always uses TMDB data when credentials are available\n  let tmdbRaf;\n  window.addEventListener('tmdb:chunk', ()=>{\n    if(tmdbRaf) return; // throttle to animation frame\n    tmdbRaf = requestAnimationFrame(()=>{\n      tmdbRaf = null;\n      try{\n        const useTmdbCards = localStorage.getItem('useTmdb')==='1';\n        if(useTmdbCards){\n          renderGrid(getState().view);\n        }\n        // Always refresh hero when new TMDB data arrives (hero uses TMDB automatically)\n        refreshHeroWithPipeline();\n      }catch(err){\n        console.warn('[main] TMDB chunk render failed:', err.message);\n      }\n    });\n  });\n  window.addEventListener('tmdb:done', ()=>{\n    try{\n      const useTmdbCards = localStorage.getItem('useTmdb')==='1';\n      if(useTmdbCards){\n        renderGrid(getState().view);\n      }\n      // Always refresh hero when TMDB hydration is complete\n      refreshHeroWithPipeline();\n    }catch(err){\n      console.warn('[main] TMDB done render failed:', err.message);\n    }\n  });\n}\n\n// Debounced hashchange handler to prevent race conditions\nlet hashchangeTimeout = null;\n\nfunction applyHashNavigation(hash){\n  if(/^#\\/(movies|shows)$/.test(hash)){\n    const view = hash.includes('shows') ? 'shows' : 'movies';\n    setState({ view });\n    HeroPipeline.setActiveView(view);\n    HeroPipeline.ensureKind(view === 'shows' ? 'series' : 'movies').catch(err => {\n      console.warn('[main] Failed to ensure hero pool on hash navigation:', err?.message || err);\n    });\n    const result = Filter.applyFilters();\n    renderSwitch();\n    renderGrid(view);\n    refreshHeroWithPipeline(result);\n    return true;\n  }\n  const match = hash.match(/^#\\/(movie|show)\\/(.+)/);\n  if(!match) return false;\n  const [, kind, id ] = match;\n  const pool = kind === 'movie' ? getState().movies : getState().shows;\n  const item = (pool||[]).find(x => (x?.ids?.imdb===id || x?.ids?.tmdb===id || String(x?.ratingKey)===id));\n  if(!item) return false;\n  if(kind === 'show') openSeriesDetailV3(item);\n  else openMovieDetailV3(item);\n  return true;\n}\n\nfunction handleHashChange(force=false){\n  const currentHash = window.location.hash || '';\n  if(!force && !hashNavigation.shouldHandle(currentHash)) return;\n  if(force) hashNavigation.markProcessed(currentHash);\n  applyHashNavigation(currentHash);\n}\n\nwindow.addEventListener('hashchange', ()=>{\n  if(hashchangeTimeout){\n    clearTimeout(hashchangeTimeout);\n  }\n  hashchangeTimeout = setTimeout(()=>{\n    handleHashChange(false);\n  }, 50);\n});\n\nfunction renderSwitch(){\n  const root = document.getElementById('libraryTabs');\n  if(!root) return;\n  const buttons = Array.from(root.querySelectorAll('[data-lib]'));\n  const current = getState().view === 'shows' ? 'shows' : 'movies';\n  buttons.forEach(btn => {\n    const target = btn.dataset.lib === 'series' ? 'shows' : 'movies';\n    const isActive = current === target;\n    btn.classList.toggle('is-active', isActive);\n    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n    if(btn.dataset.bound === 'true') return;\n    btn.addEventListener('click', () => {\n      const view = btn.dataset.lib === 'series' ? 'shows' : 'movies';\n      if(getState().view === view) return;\n      setState({ view });\n      HeroPipeline.setActiveView(view);\n      if(HeroPipeline.isEnabled()){\n        const ensure = HeroPipeline.ensureKind(view === 'shows' ? 'series' : 'movies');\n        if(ensure && typeof ensure.catch === 'function'){\n          ensure.catch(err => {\n            console.warn('[main] Failed to ensure hero pool on view switch:', err?.message || err);\n          });\n        }\n      }\n      const target = view === 'movies' ? '#/movies' : '#/shows';\n      navigateToHash(target, { silent: true });\n      renderSwitch();\n      const result = Filter.applyFilters();\n      renderGrid(view);\n      refreshHeroWithPipeline(result);\n    });\n    btn.dataset.bound = 'true';\n  });\n}\n\nfunction renderStats(animate=false){\n  const root = document.getElementById('heroStats');\n  if(!root) return;\n  const s = getState();\n  const movies = (s.movies||[]).length;\n  const shows = (s.shows||[]).length;\n  const elM = root.querySelector('[data-stat=\"movies\"]');\n  const elS = root.querySelector('[data-stat=\"shows\"]');\n  if(!elM || !elS) return;\n  if(animate){ countTo(elM, movies); countTo(elS, shows); }\n  else { elM.textContent=String(movies); elS.textContent=String(shows); }\n}\n\nfunction countTo(el, target){\n  if(!el) return;\n  const start = Number(el.textContent)||0;\n  const end = Number(target)||0;\n  if(start===end){ el.textContent = String(end); return; }\n  const dur = 480; // ms\n  const t0 = performance.now();\n  function step(t){\n    const p = Math.min(1, (t - t0) / dur);\n    const val = Math.round(start + (end - start) * (p<0.5 ? 2*p*p : -1 + (4 - 2*p) * p));\n    el.textContent = String(val);\n    if(p < 1) requestAnimationFrame(step); else el.textContent = String(end);\n  }\n  requestAnimationFrame(step);\n}\n\nfunction renderFooterMeta(){\n  const el = document.getElementById('footerMeta');\n  if(!el) return;\n  const status = document.getElementById('footerStatus');\n  const s = getState();\n  const movies = (s.movies||[]); const shows=(s.shows||[]);\n  const times = movies.concat(shows).map(x=> new Date(x.addedAt||0).getTime()).filter(Number.isFinite);\n  const latest = times.length ? new Date(Math.max(...times)) : new Date();\n  const date = latest.toISOString().slice(0,10);\n  if(status){\n    status.textContent = `Stand: ${date}`;\n  }\n  el.dataset.state = 'ready';\n  const grid = document.getElementById('grid');\n  if(grid){ grid.setAttribute('aria-busy', 'false'); }\n}\n\nFilter.setFiltersUpdatedHandler(items => {\n  try{\n    refreshHeroWithPipeline(items);\n  }catch(err){\n    console.warn('[main] Failed to refresh hero from filters handler:', err?.message);\n  }\n});\n\nsetHeroRefreshHandler(items => {\n  try{\n    refreshHeroWithPipeline(items);\n  }catch(err){\n    console.warn('[main] Failed to refresh hero from settings handler:', err?.message);\n  }\n});\n\nsetReduceMotionHandler(enabled => {\n  try{\n    setReduceMotionClass(!!enabled);\n  }catch(err){\n    console.warn('[main] Failed to apply reduce motion setting from handler:', err?.message);\n  }\n});\n\nif(!globalThis.__PLEX_TEST_MODE__){\n  boot();\n}\n\n// Fallback: ensure the loading overlay is not left visible\n// in case an error interrupts the boot sequence.\nwindow.addEventListener('load', ()=>{\n  try{\n    hideLoader();\n  }catch(err){\n    console.warn('[main] Failed to hide loader on load event:', err.message);\n  }\n});\n\nfunction setReduceMotionClass(pref){\n  try{\n    const body = document.body;\n    if(body){\n      document.documentElement?.classList.remove('reduce-motion', 'reduced-motion');\n      body.classList.remove('reduced-motion');\n      body.classList.toggle('reduce-motion', pref);\n    } else {\n      document.documentElement?.classList.toggle('reduce-motion', pref);\n      window.addEventListener('DOMContentLoaded', ()=> setReduceMotionClass(pref), { once: true });\n    }\n  }catch(err){\n    console.warn('[main] Failed to update reduce motion class:', err.message);\n  }\n}\n\nfunction applyReduceMotionPref(){\n  try{\n    const pref = localStorage.getItem('prefReduceMotion')==='1';\n    setReduceMotionClass(pref);\n  }catch(err){\n    console.warn('[main] Failed to apply reduce motion preference:', err.message);\n  }\n}\n\nfunction initAdvancedToggle(){\n  const btn = document.getElementById('toggleAdvanced');\n  const panel = document.getElementById('advancedFilters');\n  if(!btn || !panel) return;\n  let animating = false;\n  let fallbackTimer = 0;\n\n  const finishAnimation = ()=>{\n    animating = false;\n    if(fallbackTimer){\n      clearTimeout(fallbackTimer);\n      fallbackTimer = 0;\n    }\n    if(panel.dataset.state === 'closing'){\n      panel.dataset.state = 'closed';\n      panel.hidden = true;\n      panel.style.removeProperty('--advanced-max');\n    }else if(panel.dataset.state === 'open'){\n      panel.style.removeProperty('--advanced-max');\n    }else if(panel.dataset.state === 'expanding'){\n      panel.dataset.state = 'open';\n      panel.style.removeProperty('--advanced-max');\n    }\n  };\n\n  const queueFinish = ()=>{\n    if(fallbackTimer){\n      clearTimeout(fallbackTimer);\n    }\n    fallbackTimer = window.setTimeout(finishAnimation, 320);\n  };\n\n  panel.addEventListener('transitionend', event=>{\n    if(event.target !== panel || event.propertyName !== 'max-height') return;\n    finishAnimation();\n  });\n\n  const openPanel = ()=>{\n    if(animating) return;\n    animating = true;\n    panel.hidden = false;\n    panel.dataset.state = 'expanding';\n    panel.setAttribute('aria-hidden', 'false');\n    panel.style.setProperty('--advanced-max', '0px');\n    requestAnimationFrame(()=>{\n      const height = panel.scrollHeight;\n      panel.style.setProperty('--advanced-max', height + 'px');\n      panel.dataset.state = 'open';\n      queueFinish();\n    });\n  };\n\n  const closePanel = ()=>{\n    if(animating) return;\n    animating = true;\n    const height = panel.scrollHeight;\n    panel.style.setProperty('--advanced-max', height + 'px');\n    panel.dataset.state = 'closing';\n    panel.setAttribute('aria-hidden', 'true');\n    requestAnimationFrame(()=>{\n      panel.style.setProperty('--advanced-max', '0px');\n      queueFinish();\n    });\n  };\n\n  btn.addEventListener('click', ()=>{\n    const expanded = btn.getAttribute('aria-expanded') === 'true';\n    if(expanded){\n      btn.setAttribute('aria-expanded', 'false');\n      closePanel();\n    }else{\n      btn.setAttribute('aria-expanded', 'true');\n      openPanel();\n    }\n  });\n}\n\nfunction initHeaderInteractions(){\n  const siteLogo = document.getElementById('siteLogo');\n  if(siteLogo){\n    siteLogo.addEventListener('error', ()=>{\n      siteLogo.classList.add('logo-missing');\n      const titleEl = document.querySelector('.site-header__brand-text .site-header__label');\n      if(titleEl) titleEl.classList.remove('sr-only');\n    });\n  }\n  const subtitle = document.getElementById('heroTagline');\n  const TAGLINES = [\n    'Curated spotlights and smart filters for every mood.',\n    'Bring Plex highlights on the road with offline browsing.',\n    'Plan your next movie night with shareable watchlists.'\n  ];\n  let idx = 0;\n  if(subtitle && !subtitle.textContent){\n    subtitle.textContent = TAGLINES[idx];\n  }\n  function rotate(){\n    if(!subtitle || subtitle.dataset.taglinePaused === '1') return;\n    subtitle.classList.add('is-fading');\n    setTimeout(()=>{\n      if(!subtitle || subtitle.dataset.taglinePaused === '1'){ subtitle && subtitle.classList.remove('is-fading'); return; }\n      idx = (idx + 1) % TAGLINES.length;\n      subtitle.textContent = TAGLINES[idx];\n      subtitle.classList.remove('is-fading');\n    }, 280);\n  }\n  if(subtitle){\n    subtitle.dataset.taglinePaused = subtitle.dataset.taglinePaused === '1' ? '1' : '0';\n    if(taglineTicker){\n      clearInterval(taglineTicker);\n    }\n    taglineTicker = setInterval(rotate, 6000);\n    setTimeout(rotate, 3000);\n  }else if(taglineTicker){\n    clearInterval(taglineTicker);\n    taglineTicker = null;\n  }\n}\n\nfunction initScrollProgress(){\n  const bar = document.getElementById('scrollProgress');\n  if(!bar) return;\n  const update = ()=>{\n    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop || 0;\n    const height = (document.documentElement.scrollHeight - document.documentElement.clientHeight) || 1;\n    const pct = Math.max(0, Math.min(100, (scrollTop/height)*100));\n    bar.style.width = pct + '%';\n  };\n  addEventListener('scroll', update, { passive:true });\n  update();\n}\n\nfunction initScrollTop(){\n  const btn = document.getElementById('scrollTop');\n  if(!btn) return;\n  const toggle = ()=>{ const y = window.scrollY||0; btn.style.display = y>300 ? 'block' : 'none'; };\n  addEventListener('scroll', toggle, { passive:true });\n  toggle();\n  btn.addEventListener('click', ()=> window.scrollTo({ top:0, behavior:'smooth' }));\n}\n\nfunction initFilterBarAutoHideFallback(){\n  const filters = document.querySelector('.filters');\n  if(!filters) return;\n\n  const supportsScrollTimeline = typeof CSS !== 'undefined'\n    && typeof CSS.supports === 'function'\n    && CSS.supports('animation-timeline: scroll()');\n\n  if(supportsScrollTimeline) return;\n\n  let lastY = window.scrollY || window.pageYOffset || 0;\n  let isHidden = false;\n  let ticking = false;\n  const MIN_SCROLL = 120;\n  const DELTA_HIDE = 8;\n\n  const setHidden = (nextHidden)=>{\n    if(isHidden === nextHidden) return;\n    isHidden = nextHidden;\n    filters.classList.toggle('is-hidden', isHidden);\n  };\n\n  const update = ()=>{\n    ticking = false;\n    const currentY = window.scrollY || window.pageYOffset || 0;\n\n    if(currentY <= MIN_SCROLL){\n      setHidden(false);\n      lastY = currentY;\n      return;\n    }\n\n    const delta = currentY - lastY;\n    lastY = currentY;\n\n    if(delta > DELTA_HIDE){\n      setHidden(true);\n    }else if(delta < -DELTA_HIDE){\n      setHidden(false);\n    }\n  };\n\n  const onScroll = ()=>{\n    if(ticking) return;\n    ticking = true;\n    requestAnimationFrame(update);\n  };\n\n  window.addEventListener('scroll', onScroll, { passive:true });\n  window.addEventListener('resize', update);\n\n  const reveal = ()=> setHidden(false);\n  filters.addEventListener('focusin', reveal);\n  filters.addEventListener('pointerenter', reveal, { passive:true });\n  filters.addEventListener('pointerdown', reveal, { passive:true });\n\n  update();\n}\n"],
  "mappings": "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",
  "names": ["setState", "patch", "S", "listeners", "fn", "subscribe", "getState", "init_state", "__esmMin", "el", "tag", "cls", "content", "n", "qs", "init_dom", "__esmMin", "s", "r", "ensure", "overlay", "qs", "el", "box", "msgEl", "bar", "showLoader", "setLoader", "msg", "p", "hideLoader", "showSkeleton", "count", "grid", "skeletonRoot", "i", "clearSkeleton", "init_loader", "__esmMin", "init_dom", "setCache", "key", "value", "ttl", "cacheKey", "CACHE_PREFIX", "item", "checkCacheSize", "error", "cleanOldestEntries", "getCache", "cached", "now", "clearAllCache", "clearExpiredCache", "keys", "cleared", "getCacheStats", "cacheKeys", "k", "totalSize", "validEntries", "expiredEntries", "stats", "percentage", "cacheEntries", "a", "b", "toRemove", "cleanupInterval", "init_cache", "__esmMin", "isPlainObject", "value", "matchesType", "type", "validateAgainstSchema", "schema", "path", "expectedTypes", "expected", "item", "index", "required", "key", "prop", "properties", "definition", "ensureArrayOfStrings", "list", "cloneWithDefaults", "entry", "defaults", "result", "defaultValue", "isMovieEntry", "ratingKey", "isShowEntry", "season", "sanitizeMovieEntry", "MOVIE_DEFAULTS", "thumbValue", "thumbFileValue", "sanitizeShowEntry", "SHOW_DEFAULTS", "seasonCopy", "episode", "validateLibraryList", "data", "kind", "SHOW_LIST_SCHEMA", "MOVIE_LIST_SCHEMA", "guard", "sanitizer", "MOVIE_ITEM_SCHEMA", "SEASON_SCHEMA", "SHOW_ITEM_SCHEMA", "init_validators", "__esmMin", "errorHandler_exports", "__export", "clearErrors", "initErrorHandler", "showError", "showRetryableError", "withErrorHandling", "errorContainer", "event", "_a", "title", "message", "duration", "errorEl", "escapeHtml", "fn", "errorTitle", "args", "error", "retryFn", "retryBtn", "closeBtn", "str", "div", "init_errorHandler", "__esmMin", "fetchJson", "url", "retries", "useCache", "cached", "getCache", "lastError", "attempt", "r", "data", "setCache", "DATA_CACHE_TTL", "err", "delay", "resolve", "message", "error", "embeddedJsonById", "id", "n", "fromGlobalBag", "key", "bag", "globalExporterBag", "fromWindow", "varName", "loadWithCompat", "primaryUrl", "opts", "markSource", "emb", "win", "alt", "altData", "notifyUiError", "title", "mod", "_a", "prefixThumbValue", "value", "base", "raw", "SCHEME_RE", "normalizedRaw", "normalizedBase", "decodeWarned", "encodePath", "path", "segment", "segments", "normalizedSegments", "normalizedPath", "relativeSegments", "baseDir", "cleaned", "encoded", "prefixThumb", "obj", "_b", "current", "prefixed", "str", "prefixMovieThumb", "MOVIE_THUMB_BASE", "prefixShowThumb", "SHOW_THUMB_BASE", "prefixShowTree", "show", "prefixSeasonTree", "season", "ep", "normalizeMovieThumbs", "list", "item", "normalizeShowThumbs", "loadMovies", "rawMovies", "movies", "validateLibraryList", "validationError", "loadShows", "rawShows", "shows", "loadShowDetail", "keys", "cacheKeys", "getCachedDetail", "urls", "detailUrlCandidates", "normalized", "normalizeShowDetail", "storeDetail", "cloneDetail", "label", "src", "lastSources", "getSources", "href", "normalizeHrefKey", "showDetailCache", "val", "rk", "detailKey", "detailHref", "hrefKey", "withoutData", "idPart", "normalizeGenres", "castList", "normalizePeople", "normalizeSeason", "out", "normalizeEpisode", "seen", "result", "entry", "tag", "detail", "EXPORTER_BAG_KEY", "init_data", "__esmMin", "init_cache", "init_validators", "utils_exports", "__export", "clearHeroCache", "collectionTags", "enableMoreChipBehavior", "formatRating", "getGenreNames", "humanYear", "isNew", "renderChipsLimited", "useTmdbForCards", "useTmdbForHero", "useTmdbOn", "genres", "seen", "names", "entry", "name", "str", "container", "values", "limit", "vals", "head", "rest", "chips", "text", "chip", "more", "root", "btn", "e", "card", "hidden", "ch", "item", "candidates", "value", "match", "val", "trimmed", "num", "s", "added", "cfg", "getState", "days", "hasTmdbCredentials", "_a", "_b", "token", "state", "backup", "heroKeys", "k", "tmdbCacheKeys", "key", "err", "init_utils", "__esmMin", "init_state", "load", "saved", "STORAGE_KEY", "persist", "idFor", "item", "_a", "_b", "kind", "id", "isSaved", "count", "toggle", "k", "renderCount", "panel", "renderPanel", "el", "openPanel", "p", "closePanel", "setExpanded", "clear", "exportJson", "items", "listItems", "data", "blob", "a", "s", "getState", "pool", "map", "it", "list", "empty", "frag", "li", "t", "rm", "open", "initUi", "openBtn", "toggleBtn", "closeBtn", "clearBtn", "exportBtn", "on", "init_watchlist", "__esmMin", "init_state", "isElementVisible", "el", "getFocusableElements", "container", "elementCtor", "selectors", "bindFocusTrap", "boundDialog", "focusTrapHandler", "handler", "ev", "focusables", "first", "last", "active", "unbindFocusTrap", "bindEscape", "callback", "escapeHandler", "escapeCallback", "unbindEscape", "focusInitial", "closeBtn", "target", "focusFn", "init_focusTrap", "__esmMin", "ensureContainer", "overlayContainer", "container", "dialogEl", "scrollContainer", "backdropEl", "rootEl", "ensureShell", "openShell", "onRequestClose", "shell", "overlay", "scroll", "dialog", "bindFocusTrap", "bindEscape", "closeShell", "unbindFocusTrap", "unbindEscape", "getShell", "focusInitial", "init_shell", "__esmMin", "init_focusTrap", "startRender", "kind", "item", "state", "isCurrentRender", "token", "cancelRender", "setActiveItem", "getActiveItem", "clearActiveItem", "captureLastFocused", "active", "elementCtor", "restoreLastFocused", "target", "init_state", "__esmMin", "runtimeText", "item", "_a", "sources", "minutes", "value", "parsed", "ratingText", "rating", "formatRating", "studioText", "_b", "first", "company", "net", "entry", "init_formatting", "__esmMin", "init_utils", "sanitizeUrl", "url", "str", "logoEntryToUrl", "entry", "logoEntryLanguage", "lang", "resolveBaseItem", "viewModel", "item", "tmdbDetail", "type", "deriveMeta", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "baseItem", "runtime", "runtimeText", "rating", "ratingText", "tmdbRating", "studio", "studioText", "contentRating", "seasonCount", "resolveDetail", "pickHeroLogo", "detail", "logos", "preferences", "pref", "match", "pickLogo", "excludeUrl", "candidates", "seen", "exclude", "push", "value", "itemLogos", "ratingBucket", "pickHeroRating", "_h", "_i", "tmdb", "tmdbVote", "formatRating", "fallback", "clearElement", "element", "ensureElement", "tag", "className", "el", "createHeadStructure", "root", "actions", "closeButton", "icon", "visual", "hero", "backdrop", "overlayLogo", "overlayMeta", "logoSlot", "status", "titlebar", "titlewrap", "badges", "title", "subtitle", "meta", "createPosterStructure", "media", "skeleton", "img", "quickfacts", "qTitle", "qList", "createHeadRefs", "createPosterRefs", "quickfactsRoot", "coerceHeadTarget", "target", "refs", "elementCtor", "coercePosterTarget", "resetBackdrop", "applyBackdrop", "source", "rawUrl", "sanitized", "applyHeroLogo", "slot", "onError", "logoUrl", "applyLogo", "applyHeroMeta", "ratingInfo", "chip", "label", "renderTitleSection", "head", "derivedMeta", "tagline", "metaParts", "text", "metaText", "renderBadgesSection", "container", "badge", "renderHeroSection", "heroBackdrop", "logo", "heroLogo", "setPosterState", "state", "renderPoster", "poster", "currentUrl", "altText", "newImg", "node", "formatSeasonCount", "num", "renderQuickfactsSection", "quickfactsList", "entries", "originalTitle", "dt", "dd", "hasEntries", "createHead", "renderHead", "createPosterCard", "renderQuickfacts", "setHeadStatus", "payload", "statusEl", "message", "hasMessage", "init_header", "__esmMin", "init_utils", "init_formatting", "nextParagraphId", "paragraphIdCounter", "ensureContainer", "target", "elementCtor", "sanitizeText", "value", "getPreferredLanguage", "_a", "_b", "_c", "state", "getState", "lang", "resolveOriginalLanguage", "viewModel", "_d", "_e", "tmdb", "candidates", "entry", "str", "determineLanguageBadge", "original", "preferred", "createFallback", "paragraph", "buildOverviewElements", "container", "text", "elements", "languageBadge", "badge", "paragraphId", "toggle", "scheduleMeasure", "fn", "setExpanded", "expanded", "isExpanded", "measureOverflow", "overflowing", "renderOverview", "previousExpanded", "node", "stateToApply", "init_overview", "__esmMin", "init_state", "ensureContainer", "target", "elementCtor", "toArray", "value", "cleanString", "resolveBaseItem", "viewModel", "item", "tmdbDetail", "type", "deriveMeta", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "baseItem", "runtimeText", "ratingText", "studioText", "mergeUniqueStrings", "lists", "result", "seen", "list", "entry", "str", "key", "namesFromList", "source", "crewByJob", "detail", "jobs", "jobSet", "job", "matches", "member", "creatorsFromDetail", "createdBy", "formatSeasonCount", "num", "gatherLanguages", "languages", "add", "tmdb", "spoken", "buildHighlightChips", "chips", "meta", "studio", "release", "rating", "wrapper", "chip", "buildDefinitionSection", "title", "entries", "section", "heading", "nodeCtor", "term", "dt", "dd", "gatherGeneralEntries", "seasonCount", "genres", "original", "gatherCreditEntries", "directors", "writers", "producers", "creators", "buildLink", "href", "link", "gatherMetadataEntries", "_h", "_i", "_j", "_k", "_l", "_m", "tmdbUrl", "tmdbId", "imdbId", "ratingKey", "renderDetails", "container", "highlights", "general", "credits", "metadata", "fallback", "init_details", "__esmMin", "init_formatting", "normalizeLocalCast", "person", "_a", "_b", "_c", "name", "role", "rawRole", "tmdbProfile", "val", "thumb", "normalizeTmdbCast", "buildCastList", "item", "seen", "combined", "entry", "lowerName", "init_castData", "__esmMin", "resolveContainer", "target", "elementCtor", "ensureCastRoot", "container", "root", "ensureList", "list", "listIdCounter", "getState", "state", "castState", "normalizeTmdbProfile", "path", "str", "normalizeLocalImage", "resolveCastImage", "entry", "tmdbEnabled", "_a", "_b", "_c", "raw", "tmdbCandidates", "candidate", "url", "localCandidates", "castInitials", "name", "chars", "part", "createCastCard", "role", "card", "avatar", "imageUrl", "img", "initials", "meta", "nameLine", "roleLine", "renderEntries", "entries", "expanded", "useTmdbOn", "visible", "MAX_INITIAL_CAST", "ensureMoreButton", "button", "updateMoreButton", "removeMoreButton", "ensureStatusPlacement", "status", "moreButton", "desiredPrevious", "setCastLoading", "loading", "isLoading", "setCastStatus", "statusEl", "renderCast", "payload", "source", "buildCastList", "init_cast", "__esmMin", "init_castData", "init_utils", "now", "hoursToMs", "hours", "num", "safeParse", "raw", "safeStringify", "payload", "createStore", "storageKey", "STORAGE_KEY", "memory", "loaded", "persistedSignature", "rebuildFromStorage", "parsed", "next", "nowTs", "entry", "key", "expiresAt", "syncFromStorage", "force", "load", "persist", "serialisable", "get", "set", "value", "ttlHours", "clear", "prefix", "target", "changed", "clearExpired", "size", "defaultStore", "createCacheStore", "options", "cacheStore_default", "init_cacheStore", "__esmMin", "delay", "ms", "resolve", "parseRetryAfter", "value", "num", "date", "computeRetryDelay", "attempt", "retryAfter", "DELAY_CAP", "factor", "BASE_DELAY", "normaliseAppend", "append", "str", "resolveCredential", "options", "_a", "_b", "_c", "_d", "preferred", "key", "token", "createRequestInit", "credential", "headers", "applyCredentialToUrl", "url", "u", "buildUrl", "path", "params", "config", "base", "DEFAULT_API_BASE", "cleanPath", "search", "language", "DEFAULT_LANGUAGE", "region", "DEFAULT_REGION", "finalUrl", "_", "fetchJson", "init", "retries", "MAX_RETRIES", "lastError", "response", "error", "err", "status", "shouldRetry", "createTmdbClient", "cache", "store", "createCacheStore", "getCacheKey", "method", "sorted", "get", "opts", "requestParams", "baseAppend", "nextAppend", "combined", "authedUrl", "cacheKey", "cached", "data", "defaultClient", "init_tmdbClient", "__esmMin", "init_cacheStore", "normaliseBase", "base", "raw", "DEFAULT_IMAGE_BASE", "ensurePath", "path", "str", "buildUrl", "size", "cleaned", "encodeSvg", "svg", "pickBackground", "type", "pickForeground", "makeInitials", "text", "limit", "parts", "part", "fallbackSvg", "width", "height", "fontSize", "fontWeight", "radius", "background", "foreground", "content", "fallbackPoster", "title", "fallbackBackdrop", "fallbackProfile", "name", "fallbackLogo", "fallbackEpisode", "normaliseOptions", "options", "_a", "_b", "_c", "_d", "urlPoster", "imageBase", "DEFAULT_SIZES", "urlBackdrop", "urlProfile", "urlLogo", "urlEpisode", "buildFallbackPoster", "buildFallbackBackdrop", "buildFallbackProfile", "init_imageHelper", "__esmMin", "normaliseOptions", "options", "DEFAULT_OPTIONS", "normaliseId", "id", "num", "str", "parsed", "scoreImage", "entry", "votes", "normaliseLanguage", "lang", "pickBestImage", "images", "preferredLanguages", "fallbackPath", "sorted", "a", "b", "language", "candidate", "extractCollection", "detail", "collection", "urlPoster", "urlBackdrop", "mapGenres", "list", "mapProductionCompanies", "company", "urlLogo", "mapProvider", "_a", "_b", "_c", "cfg", "name", "mapWatchProviderRegion", "regionData", "types", "mapped", "type", "mapWatchProviders", "payload", "results", "region", "data", "regionKey", "mappedRegion", "defaultRegion", "mapNetworks", "network", "mapSeasons", "season", "mapSpokenLanguages", "pickCharacter", "role", "r", "pickJob", "job", "j", "mapCredits", "rawCredits", "castSource", "crewSource", "cast", "person", "urlProfile", "makeInitials", "crew", "selectReleaseCertification", "priorityCountries", "country", "item", "candidates", "release", "typeA", "typeB", "dateA", "dateB", "getContentRatingDE", "cert", "german", "us", "buildImageCollection", "mapper", "mapMovieDetail", "_d", "posterPath", "backdropPath", "mapTvDetail", "_e", "source", "mapSeasonDetail", "seasonDetail", "show", "episodes", "episode", "stillPath", "urlEpisode", "init_tmdbMapper", "__esmMin", "init_imageHelper", "normaliseConfig", "input", "DEFAULT_IMAGE_BASE", "DEFAULT_TTL_HOURS", "createLogger", "args", "ensureArray", "value", "part", "combineAppend", "base", "extras", "values", "createFetcher", "client", "cache", "config", "log", "defaultAppend", "fetchWithCache", "key", "ttlHours", "loader", "cached", "err", "data", "getMovieEnriched", "id", "options", "_a", "movieId", "cacheKey", "ttl", "_b", "_c", "append", "detail", "mapMovieDetail", "getTvEnriched", "tvId", "mapTvDetail", "getSeasonEnriched", "seasonNumber", "show", "mapSeasonDetail", "createMetadataService", "inputOptions", "createCacheStore", "createTmdbClient", "fetcher", "prefix", "ensureDefaultCache", "defaultCacheStore", "ensureDefaultService", "defaultService", "configureMetadataServiceDefaults", "merged", "readStoredToken", "token", "syncDefaultMetadataService", "cfg", "overrides", "preferStoredToken", "overrideToken", "overrideApiKey", "overrideLanguage", "overrideRegion", "overrideTtl", "overrideImageBase", "lang", "region", "ttlCandidates", "candidate", "ttlNum", "imageBase", "apiKey", "metadataServiceFacade", "metadataService_default", "init_metadataService", "__esmMin", "init_cacheStore", "init_tmdbClient", "init_tmdbMapper", "ensureContainer", "target", "elementCtor", "asArray", "value", "sanitizeText", "resolveSeasonNumber", "season", "fallback", "candidates", "candidate", "num", "resolveShowIdentifiers", "viewModel", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "item", "tmdb", "ids", "tmdbId", "name", "buildSeasonMeta", "parts", "year", "count", "suffix", "createPoster", "figure", "posterUrl", "alt", "img", "initials", "makeInitials", "buildSeasonSummary", "summary", "paragraph", "setExpanded", "card", "button", "panel", "expanded", "isExpanded", "combineEpisodeData", "ep", "seasonNumber", "episodeNumber", "code", "durationMin", "runtimeTextValue", "runtimeText", "rating", "airDate", "overview", "stillPath", "stillUrl", "createEpisodeStill", "data", "context", "wrapper", "small", "urlEpisode", "medium", "placeholder", "buildEpisodeTitle", "formatRating", "createBadge", "text", "variant", "badge", "createEpisodeRow", "row", "media", "body", "header", "title", "badges", "runtimeBadge", "ratingBadge", "meta", "renderEpisodeList", "container", "episodes", "list", "attachKeyboardNavigation", "event", "toggles", "currentIndex", "next", "prev", "createSeasonCard", "index", "headingId", "seasonInstanceCounter", "panelId", "heading", "poster", "label", "chevron", "episodesRoot", "initialEpisodes", "loaded", "loading", "abortController", "applyLoadingState", "isLoading", "loadingMessage", "cancelRequest", "fetchEpisodes", "metadataService_default", "detail", "err", "toggle", "renderSeasons", "seasons", "show", "init_seasons", "__esmMin", "init_metadataService", "init_imageHelper", "init_formatting", "getButtons", "container", "elementCtor", "TAB_SELECTOR", "btn", "resolvePanel", "root", "button", "doc", "controlId", "byId", "dataTab", "selector", "withinRoot", "fallback", "selectButton", "buttons", "target", "targetButton", "_a", "isActive", "panel", "moveFocus", "current", "delta", "currentIndex", "fallbackIndex", "nextIndex", "nextButton", "focusButton", "applyTabs", "scope", "ev", "last", "initiallySelected", "init_tabs", "__esmMin", "isObject", "value", "parseGuidEntry", "entry", "_a", "_b", "raw", "str", "lower", "result", "key", "patterns", "GUID_PATTERNS", "pattern", "marker", "idx", "start", "ensureIds", "target", "_c", "ids", "assign", "guidSources", "source", "parsed", "deepClone", "out", "mapMovie", "item", "clone", "mapShow", "normalizeShow", "mapDetail", "detail", "mergeShowDetail", "mapped", "show", "normalizeThumbField", "normalizeGenresList", "cast", "normalizePeopleList", "normalizeSeasonEntry", "sc", "season", "normalizeEpisodeEntry", "ep", "obj", "prefixShowThumb", "list", "tag", "normalized", "rawName", "name", "seen", "init_mapping", "__esmMin", "init_data", "isObject", "value", "asArray", "trimString", "extractImageCandidate", "candidate", "entry", "found", "normaliseImageUrl", "size", "raw", "TMDB_IMAGE_BASE", "suffix", "selectImage", "candidates", "fallbackBuilder", "title", "url", "source", "firstString", "values", "trimmed", "str", "parseYear", "match", "year", "pickTitle", "item", "tmdb", "pickOriginalTitle", "pickTagline", "pickOverview", "pickSummary", "pickReleaseDate", "kind", "pickYear", "buildPosterEntry", "_a", "buildFallbackPoster", "IMAGE_SIZES", "buildBackdropEntry", "buildFallbackBackdrop", "buildProfileImage", "name", "resolved", "buildFallbackProfile", "createBadge", "id", "label", "text", "cleaned", "resolveContentRating", "resolveSeasonCount", "num", "buildRuntimeBadge", "runtime", "runtimeText", "buildSeasonBadge", "count", "buildRatingBadge", "ratingText", "formatTmdbRating", "rating", "buildContentRatingBadge", "buildStudioBadge", "studio", "studioText", "buildBadges", "badges", "runtimeBadge", "seasonBadge", "ratingBadge", "contentBadge", "studioBadge", "tmdbBadgeText", "tmdbBadge", "buildTabs", "hasCast", "seasons", "tabs", "DEFAULT_TABS", "normalizeCastName", "person", "normalizeCastRole", "buildCastEntries", "_b", "_c", "entries", "seen", "localCast", "tmdbCredits", "pushEntry", "key", "index", "subtitle", "image", "makeInitials", "character", "a", "b", "normalizeSeasonTitle", "season", "fallbackNumber", "resolveSeasonKey", "_d", "number", "resolveEpisodeCount", "fromField", "episodes", "resolveSeasonPoster", "mergeSeasonEntry", "base", "update", "merged", "buildSeasonSummaries", "show", "results", "lookup", "pushSeason", "numberRaw", "seasonNumber", "airDate", "overview", "poster", "existingIndex", "existing", "buildGenreList", "result", "add", "normalizeGenresList", "buildMeta", "tmdbRating", "contentRating", "seasonCount", "resolveMovieInput", "payload", "resolveShowInput", "fetchTmdbMovie", "options", "explicit", "tmdbId", "metadataService_default", "fetchTmdbShow", "normalizeMovieItem", "mapped", "mapMovie", "normalizeShowItem", "detail", "mapShow", "mergeShowDetail", "assignTmdbDetail", "target", "buildBaseViewModel", "backdrop", "cast", "defaultTab", "meta", "releaseDate", "originalTitle", "tagline", "summary", "genres", "buildMovieViewModel", "rawItem", "buildSeriesViewModel", "init_viewModel", "__esmMin", "init_metadataService", "init_formatting", "init_mapping", "init_imageHelper", "demoData_exports", "__export", "DEMO_MOVIE", "DEMO_SERIES", "init_demoData", "__esmMin", "normalizeTabId", "rawId", "index", "fallback", "str", "normalizeTabLabel", "rawLabel", "isViewModelCandidate", "content", "matchesIdentifier", "item", "_a", "_b", "ensureDemoModule", "demoModule", "err", "ensureMovies", "moviesCache", "loadMovies", "ensureShows", "showsCache", "loadShows", "findInList", "list", "id", "entry", "resolveMoviePayload", "input", "DEMO_MOVIE", "state", "getState", "match", "library", "resolveSeriesPayload", "DEMO_SERIES", "base", "detail", "loadShowDetail", "loadMovieDetailViewModel", "payload", "options", "resolved", "buildMovieViewModel", "loadSeriesDetailViewModel", "buildSeriesViewModel", "createPaneStack", "viewModel", "article", "head", "createHead", "headRoot", "closeButton", "closeDetailV3", "body", "columns", "aside", "poster", "createPosterCard", "posterRoot", "main", "tabs", "stack", "tabEntries", "defaultTab", "paneMap", "tab", "label", "button", "tabId", "paneId", "isDefault", "panel", "paneTitle", "paneContent", "renderOverview", "renderDetails", "renderCast", "renderSeasons", "ensureOverlayListeners", "shell", "getShell", "overlay", "onOverlayClick", "ev", "target", "showLoading", "message", "openShell", "root", "loading", "focusInitial", "resolveNodes", "nodeCtor", "nodes", "resolveTargetElement", "elementCtor", "renderMediaDetail", "container", "layout", "replace", "className", "onRendered", "view", "cls", "applyTabs", "renderDetail", "token", "media", "kind", "isCurrentRender", "current", "getActiveItem", "resolvedKind", "resolvedMedia", "setActiveItem", "handledByViewModel", "renderDetailError", "clearActiveItem", "openMovieDetailV3", "captureLastFocused", "startRender", "openSeriesDetailV3", "cancelRender", "closeShell", "restoreLastFocused", "init_modalV3", "__esmMin", "init_shell", "init_state", "init_header", "init_overview", "init_details", "init_cast", "init_seasons", "init_tabs", "init_data", "init_viewModel", "noop", "parsePx", "value", "num", "raf", "caf", "VirtualList", "init_virtualList", "__esmMin", "cb", "id", "container", "renderItem", "getKey", "updateItem", "getSignature", "overscan", "estimatedItemHeight", "minItemWidth", "force", "width", "list", "sampleItem", "sample", "rect", "node", "allowed", "nextSignatures", "item", "idx", "key", "signature", "prev", "index", "raw", "containerStyle", "hostStyle", "rowGap", "colGap", "gapFallback", "rawColumns", "el", "top", "viewportTop", "viewportBottom", "listStart", "listEnd", "startRow", "endRow", "start", "end", "needsRefresh", "i", "offsetY", "nextRendered", "toRender", "updated", "currentChildren", "same", "currentMap", "desired", "current", "grid_exports", "__export", "renderGrid", "cardEl", "item", "card", "el", "media", "img", "src", "resolvePoster", "gradient", "badges", "buildItemBadges", "badgeContainer", "badge", "pct", "progressPercent", "track", "fill", "body", "title", "sub", "metaPieces", "buildMetaPieces", "actions", "chips", "genres", "getGenreNames", "renderChipsLimited", "watchBtn", "updateWatchButtonState", "ev", "toggle", "openDetail", "createCollectionGroup", "name", "members", "list", "a", "b", "ay", "humanYear", "by", "years", "year", "addedTimestamps", "latestAdded", "ratings", "_a", "rating", "sum", "val", "posterItem", "entry", "groupCollectionsIfEnabled", "items", "togg", "colSel", "selected", "membership", "collectionTags", "groups", "collectionCardEl", "baseItem", "buildCollectionBadges", "pieces", "collectionMetaPieces", "sel", "ensureVirtualList", "grid", "virtualListInstance", "VirtualList", "itemKey", "gridItemSignature", "renderGridItemNode", "node", "refreshGridItemNode", "index", "key", "id", "resolveItemId", "CARD_SIGNATURE_PROP", "current", "signature", "replacement", "replaceCardNode", "view", "movies", "shows", "filtered", "getState", "base", "shouldAnimate", "lastRenderedView", "beginGridTransition", "finishGridTransition", "empty", "tmdbPoster", "useTmdbForCards", "fallback", "itemBadgeTexts", "isNew", "contentRating", "ratingNum", "formatRating", "createBadge", "collectionBadgeTexts", "text", "button", "saved", "isSaved", "runtime", "formatRuntime", "studio", "count", "_b", "raw", "minutes", "offset", "duration", "preferred", "collectionSignature", "itemSignature", "meta", "ratingValue", "parent", "hadFocus", "updateHash", "kind", "hash", "replace", "navigateToHash", "openSeriesDetailV3", "openMovieDetailV3", "init_grid", "__esmMin", "init_state", "init_dom", "init_utils", "init_watchlist", "init_modalV3", "init_main", "init_virtualList", "filter_exports", "__export", "applyFilters", "computeFacets", "initFilters", "renderFacets", "setFiltersUpdatedHandler", "updateFiltersAndGrid", "norm", "s", "matches", "item", "opts", "query", "onlyNew", "yearFrom", "yearTo", "genresActive", "selectedCollection", "getGenreNames", "r", "collectionTags", "isNew", "year", "humanYear", "itemGenres", "g", "sortItems", "items", "key", "arr", "a", "b", "movies", "shows", "genres", "years", "collections", "add", "x", "name", "y", "c", "ys", "f", "yFrom", "qs", "yTo", "col", "gRoot", "chips", "updateGenreFilterState", "getFilterOpts", "_a", "_b", "_c", "_d", "_e", "searchInput", "collection", "sort", "n", "getState", "pool", "filtered", "ordered", "setState", "renderGridForCurrentView", "gridModulePromise", "mod", "fn", "handler", "filtersUpdatedHandler", "result", "payload", "root", "activeCount", "sortSel", "v", "l", "bind", "sel", "ev", "yrReset", "t", "init_filter", "__esmMin", "init_state", "init_dom", "init_utils", "tmdb_exports", "__export", "clearCache", "hydrateOptional", "validateToken", "logWarn", "args", "normalizeConfig", "cfg", "language", "region", "ttlHours", "imageBase", "buildSignature", "auth", "authSig", "ensureMetadata", "signature", "metadataInstance", "metadataSignature", "options", "cacheStore_default", "createMetadataService", "keyFor", "item", "_a", "_b", "type", "imdb", "tmdb", "title", "year", "err", "SESSION_CACHE", "clear", "tokenFromEnv", "token", "val", "resolveByExternalId", "imdbId", "_c", "_d", "_e", "_f", "json", "resolveBySearch", "name", "client", "params", "result", "hydrateItem", "cacheKey", "service", "tmdbId", "detail", "enriched", "movies", "shows", "work", "limit", "index", "processChunk", "chunk", "it", "data", "withAuth", "url", "separator", "raw", "looksLikeV3", "looksLikeJwt", "decodeJwtPayload", "t", "part", "s", "init", "API_V3", "payload", "iss", "init_tmdb", "__esmMin", "init_cacheStore", "init_metadataService", "initHeroPolicy", "validationIssues", "raw", "loadError", "response", "POLICY_URL", "safeJson", "error", "addIssue", "showError", "activePolicy", "sanitizePolicy", "policyLoadedAt", "reportValidationIssues", "getHeroPolicy", "clone", "getPoolSizes", "getSlotConfig", "slots", "SLOT_KEYS", "key", "getDiversityWeights", "getRotationConfig", "getTextClampConfig", "getFallbackPreference", "getPolicyLanguage", "getCacheTtl", "hours", "grace", "getValidationIssues", "getPolicyLoadedAt", "target", "DEFAULT_POLICY", "ensurePositiveInt", "rawSlots", "slot", "quota", "ensureNumberInRange", "rawDiversity", "rawRotation", "rawClamp", "rawFallback", "ensureFallbackPreference", "rawCache", "ttlHours", "graceMinutes", "value", "fallback", "field", "allowZero", "num", "min", "max", "source", "message", "followUps", "init_policy", "__esmMin", "init_errorHandler", "logWarn", "args", "now", "delay", "ms", "resolve", "shallowEqual", "a", "b", "keysA", "keysB", "key", "getRateLimitSnapshot", "_a", "rateLimitState", "notifyRateLimitListeners", "snapshot", "listener", "rateLimitListeners", "err", "updateRateLimitState", "patch", "next", "computeRetryDelay", "attempt", "computeRateLimitDelay", "strikes", "fallback", "scaled", "candidate", "registerRateLimitHit", "retryAfterMs", "status", "nowTs", "delayMs", "throttlePenaltyUntil", "decayRateLimitStrikes", "refreshRateLimit", "getCacheKey", "type", "id", "language", "t", "lang", "ensureCacheLoaded", "cacheLoaded", "raw", "STORAGE_KEY", "parsed", "entry", "_b", "_c", "_d", "ts", "memoryCache", "pruneExpired", "changed", "schedulePersist", "getCacheEntry", "setCacheEntry", "data", "pruneOverflow", "entries", "at", "trimmed", "persistTimer", "persistCache", "parseRetryAfter", "value", "num", "date", "shouldRetryStatus", "isAbortError", "shouldRetryError", "withAuth", "url", "auth", "sep", "throttle", "waitInterval", "lastRequestAt", "waitPenalty", "wait", "fetchJson", "signal", "finalUrl", "init", "requestInit", "response", "retryable", "retryAfter", "text", "classifyCredential", "forcedKind", "readLocalStorageToken", "parseCfg", "json", "out", "line", "clean", "idx", "loadConfigCfg", "configPromise", "cachedConfig", "extractCredentialFromSettings", "settings", "token", "extractCredentialFromLocalStorage", "extractCredentialFromConfig", "cfg", "resolveAuth", "options", "classified", "fromSettings", "fromLocalStorage", "fromCfg", "getRateLimitState", "addRateLimitListener", "tmdbImageUrl", "path", "size", "normalizedPath", "variant", "IMG_BASE", "cleanId", "fetchDetails", "normalizedType", "normalizedId", "cached", "API_BASE", "APPEND_FIELDS", "extractRawTitle", "item", "candidates", "str", "parseYear", "match", "extractRawYear", "direct", "dateCandidate", "fromDate", "fetchByExternalId", "imdbId", "hit", "resolvedId", "details", "buildSearchUrl", "title", "year", "encodedTitle", "base", "fetchBySearch", "results", "extractIds", "ids", "merge", "guid", "schemePart", "restPart", "scheme", "tail", "buildSearchTitleOverride", "preferred", "fetchDetailsForItem", "baseOptions", "attempts", "searchTitle", "searchYear", "result", "init_tmdbClient", "__esmMin", "logWarn", "args", "cleanString", "value", "nonEmptyString", "str", "parseYear", "match", "parseDateYear", "date", "y", "clampRating", "num", "minutesFromDuration", "raw", "collectGenres", "tmdb", "names", "entry", "rawGenres", "seen", "result", "name", "key", "extractIds", "ids", "set", "input", "mergeGuid", "guid", "rawGuid", "schemePart", "restPart", "scheme", "tail", "chooseTitle", "type", "candidates", "c", "chooseTagline", "chooseOverview", "chooseYear", "_a", "_b", "_c", "primary", "secondary", "y2", "fromRaw", "chooseRuntime", "first", "v", "minutes", "season", "ep", "fallback", "chooseRating", "fromTmdb", "chooseVoteCount", "chooseCertification", "us", "sorted", "a", "b", "at", "bt", "cert", "rating", "rawRating", "cleaned", "extractBackdrops", "urls", "tmdbList", "backdrop", "BACKDROP_MIN_WIDTH", "url", "tmdbImageUrl", "TMDB_BACKDROP_SIZE", "plexBackdrop", "trimmed", "computeTvCounts", "count", "buildCta", "preferred", "targetId", "kind", "finalizeIds", "out", "ensureId", "normalizeItem", "options", "language", "tmdbBundle", "fetchDetailsForItem", "err", "tmdbData", "title", "normalized", "tagline", "overview", "year", "runtime", "voteCount", "genres", "certification", "backdrops", "counts", "cta", "tmdbMeta", "init_normalizer", "__esmMin", "init_tmdbClient", "now", "safeArea", "name", "readRaw", "area", "key", "writeRaw", "value", "parseJson", "raw", "stringifyJson", "normalizeKind", "kind", "poolKey", "POOL_PREFIX", "sessionPoolKey", "SESSION_SUFFIX", "historyKey", "HISTORY_PREFIX", "memoryKey", "MEMORY_PREFIX", "failureKey", "FAILURE_PREFIX", "readPoolFrom", "parsed", "readMemory", "local", "resolveAreas", "entry", "_a", "_b", "_c", "writeMemory", "entries", "payload", "json", "session", "readFailures", "writeFailures", "clonePoolData", "data", "copy", "getStoredPool", "nowTs", "policyHash", "allowExpired", "sessionKey", "sessionPool", "localPool", "source", "pool", "valid", "matchesPolicy", "storePool", "invalidatePool", "readHistory", "writeHistory", "resolveEntryKey", "suffix", "resolveHistoryId", "recordHeroHistory", "timestamp", "limit", "id", "filtered", "item", "pruned", "getHeroHistory", "windowMs", "list", "threshold", "seen", "recordHeroMemory", "ttlMs", "preserved", "additions", "additionIds", "slot", "filteredPreserved", "limited", "deduped", "finalSeen", "getHeroMemory", "clearHeroMemory", "recordHeroFailure", "reason", "hits", "resolveHeroFailure", "getHeroFailures", "clearHeroFailures", "init_storage", "__esmMin", "now", "logWarn", "args", "normalizeKind", "kind", "policySignature", "policy", "fragment", "err", "clamp", "value", "min", "max", "parseDate", "ts", "parseYear", "num", "match", "parseGenres", "raw", "out", "push", "val", "trimmed", "normalized", "g", "parseRating", "candidates", "candidate", "parseVoteCount", "resolveId", "key", "suffix", "computeSlotPlan", "poolSize", "slots", "plan", "remaining", "quotas", "SLOT_KEYS", "index", "_a", "quota", "count", "cursor", "computeCaps", "diversity", "genreWeight", "yearWeight", "genreCap", "yearCap", "prepareCandidates", "items", "nowTs", "seen", "prepared", "id", "addedAt", "year", "rating", "voteCount", "genres", "NEW_WINDOW_MS", "OLD_THRESHOLD_YEARS", "sortNew", "list", "a", "b", "sortTopRated", "ra", "rb", "vc", "sortOld", "ya", "yb", "shuffle", "arr", "i", "j", "passesCaps", "context", "caps", "genreCounts", "yearCounts", "genre", "applySelection", "slot", "attemptSelection", "allowHistory", "filter", "deferredHistory", "deferredMemory", "deferredFailures", "applyQueue", "queue", "ensureMinimum", "emitProgress", "detail", "payload", "listener", "listeners", "PROGRESS_EVENT", "normalizeSelection", "selection", "language", "options", "total", "settings", "auth", "authOptions", "signal", "disableTmdb", "failureTtlMs", "entry", "normalizedItem", "failureReason", "rateLimited", "normalizeItem", "recordHeroFailure", "resolveHeroFailure", "classifyCandidates", "history", "memory", "failures", "sum", "newList", "topList", "oldList", "randomList", "remainingRandom", "leftovers", "shouldReusePool", "policyHash", "cached", "getStoredPool", "graceMs", "getCacheTtl", "buildPool", "getHeroPolicy", "normalizedKind", "reuse", "clearHeroMemory", "clearHeroFailures", "ttlInfo", "memoryWindow", "base", "HISTORY_WINDOW_MS", "getHeroHistory", "HISTORY_LIMIT", "getHeroMemory", "getHeroFailures", "fallbackHistory", "FALLBACK_HISTORY_WINDOW_MS", "trimmedSelection", "finalItems", "updatedAt", "expiresAt", "recordHeroMemory", "storePool", "ensureHeroPool", "forceRegeneratePool", "init_pool", "__esmMin", "init_normalizer", "init_policy", "init_storage", "logWarn", "args", "now", "normalizeKind", "kind", "rateLimitEquals", "a", "b", "attachRateLimitListener", "detachRateLimitListener", "state", "getRateLimitState", "addRateLimitListener", "info", "next", "notify", "createStatus", "cloneStatus", "status", "copy", "readFeatureFlag", "raw", "FEATURE_FLAG_KEY", "err", "computeFeatureState", "cfg", "stored", "buildSnapshot", "snapshot", "listener", "listeners", "UPDATE_EVENT", "updateStatus", "patch", "normalized", "refreshReadyState", "ready", "loadStored", "getStoredPool", "ensureSources", "buildTmdbOptions", "hasCredentials", "useTmdbForHero", "disableTmdb", "authOptions", "fallback", "runPoolBuilder", "force", "items", "builder", "forceRegeneratePool", "ensureHeroPool", "options", "promise", "result", "payload", "poolItems", "computeDaySeed", "nowDate", "year", "startOfYear", "today", "diff", "comparePoolEntries", "ka", "kb", "computeRotation", "_a", "_b", "pool", "sorted", "freshnessSeed", "offset", "seed", "startIndex", "configure", "policy", "feature", "setSources", "movies", "shows", "setActiveView", "view", "primeAll", "tasks", "results", "ensureKind", "refreshKind", "refreshAll", "updateTmdbActive", "active", "isEnabled", "isReady", "getSnapshot", "getRotationPlan", "subscribe", "getDebugSnapshot", "init_pipeline", "__esmMin", "init_pool", "init_storage", "init_utils", "init_tmdbClient", "initDebugUi", "open", "openPanel", "_a", "_b", "_c", "_d", "overlay", "render", "ev", "closePanel", "copyReport", "clearExpiredCache", "clearAllCache", "_e", "_f", "_g", "_h", "pre", "s", "getState", "src", "getSources", "cfg", "cacheStats", "getCacheStats", "heroPolicy", "getHeroPolicy", "heroPolicyIssues", "getValidationIssues", "heroPipeline", "getDebugSnapshot", "report", "getPolicyLanguage", "getPoolSizes", "getSlotConfig", "getDiversityWeights", "getRotationConfig", "getTextClampConfig", "getFallbackPreference", "getCacheTtl", "getPolicyLoadedAt", "statsEl", "heroMovies", "heroSeries", "formatTs", "ts", "heroFeature", "txt", "err", "ta", "init_debug", "__esmMin", "init_state", "init_data", "init_cache", "init_policy", "init_pipeline", "setHeroRefreshHandler", "handler", "heroRefreshHandler", "setReduceMotionHandler", "reduceMotionHandler", "notifyHeroRefresh", "items", "notifyReduceMotion", "enabled", "initSettingsOverlay", "cfg", "overlay", "dialog", "open1", "open2", "headerSettingsBtn", "close2", "tmdbInput", "tmdbSave", "tmdbTest", "tmdbStatus", "tmdbClear", "tmdbBadge", "reduce", "useTmdb", "resetFilters", "body", "heroStatus", "heroRefreshMovies", "heroRefreshShows", "heroRefreshAll", "heroRow", "heroButtons", "heroTask", "setHeroButtonsDisabled", "disabled", "reason", "btn", "isEnabled", "formatUpdated", "ts", "formatExpiry", "diff", "minutes", "hours", "days", "describeHeroStatus", "label", "status", "updated", "expiry", "updateHeroStatus", "snapshot", "_a", "_b", "_c", "_d", "_e", "_f", "busy", "segments", "runHeroRegeneration", "kind", "refreshKind", "refreshAll", "err", "subscribe", "restoreFocus", "previousOverflow", "isOpen", "backgroundState", "focusSelector", "getFocusable", "el", "focusDialog", "setBackgroundInert", "active", "nodes", "node", "state", "openOverlay", "syncSettingsUi", "closeOverlay", "handleKeydown", "ev", "focusable", "first", "last", "setTmdbStatus", "msg", "stored", "currentInput", "setUseTmdbAvailability", "m", "allowed", "renderGrid", "getState", "token", "svc", "res", "raw", "syncDefaultMetadataService", "updateTmdbActive", "result", "tmdbHydrationStarted", "s", "search", "q", "onlyNew", "yf", "yt", "col", "n", "genreRoot", "F", "init_settingsOverlay", "__esmMin", "init_state", "init_grid", "init_pipeline", "init_metadataService", "setCurrentHeroItem", "item", "currentHeroEntry", "ensureHeroDefaults", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "heroDefaults", "defaults", "setHeroNavigation", "handler", "navigateToHashHandler", "showHeroFallback", "reason", "overrides", "hero", "heroTitle", "heroTagline", "heroOverview", "heroCta", "heroMeta", "metaPrimary", "metaSecondary", "metaTertiary", "heroPicture", "heroImage", "heroSourceLarge", "heroSourceMedium", "copy", "HERO_FALLBACK_COPY", "lastFallbackReason", "clearPicture", "taglineText", "overviewText", "ctaLabel", "ctaEnabled", "refreshHero", "listOverride", "candidate", "selectHeroEntry", "normalized", "ensureNormalizedEntry", "kind", "targetId", "recordHeroHistory", "tagline", "overview", "openHeroModal", "renderMeta", "renderMedia", "normalizedOverride", "ensureNormalizedList", "chooseHeroCandidate", "source", "heroCandidatesFromState", "list", "isPlayableHeroItem", "entry", "index", "state", "getState", "view", "stored", "getStoredPool", "fromPool", "pool", "isNormalized", "normalizeLegacyItem", "ctaId", "raw", "type", "title", "ids", "collectIds", "year", "parseYear", "runtime", "parseRuntime", "rating", "parseRating", "genres", "collectGenres", "certification", "parseCertification", "parseOverview", "parseTagline", "backdrops", "collectLegacyBackdrops", "cta", "humanYear", "minutes", "names", "trimmed", "name", "segments", "last", "sources", "value", "preferTmdb", "useTmdbOn", "tmdbCandidates", "localCandidates", "urls", "url", "normalizeMediaPath", "path", "primaryRoot", "secondaryRoot", "tertiaryRoot", "container", "rows", "buildMetaRows", "primary", "secondary", "tertiary", "renderMetaRow", "hasContent", "runtimeText", "formatRuntime", "ratingValue", "formatRating", "votes", "NUMBER_FORMAT", "parts", "genre", "text", "root", "items", "fragment", "badge", "picture", "image", "sourceLarge", "sourceMedium", "setSource", "node", "hrs", "mins", "id", "navigateToItemHash", "openSeriesDetailV3", "openMovieDetailV3", "explicitTarget", "hash", "replace", "init_hero", "__esmMin", "init_state", "init_modalV3", "init_utils", "init_storage", "initHeroAutoplay", "onRefresh", "refreshHero", "hero", "timer", "bar", "DURATION", "pauseReasons", "wasPaused", "elapsed", "raf", "lastTs", "pipelineEnabled", "isEnabled", "rotationKind", "resolveKind", "rotationItems", "rotationIndex", "pipelinePaused", "rotationSignature", "unsubscribePipeline", "unsubscribeState", "applyRotationPlan", "getRotationPlan", "subscribe", "kind", "getState", "isPaused", "updatePausedState", "pausedNow", "setPaused", "reason", "value", "advanceRotation", "plan", "_a", "items", "status", "getSnapshot", "busy", "isReady", "signature", "hadItems", "previouslyPaused", "step", "ts", "dt", "prog", "next", "start", "init_hero_autoplay", "__esmMin", "init_hero", "init_state", "init_pipeline", "applyFeatureFlags", "cfg", "globalFeatures", "announceHeroFallback", "reason", "detail", "heroFallbackNotice", "handler", "HERO_FALLBACK_MESSAGES", "refreshHeroWithPipeline", "listOverride", "_a", "_b", "_c", "_d", "refreshHero", "isEnabled", "currentView", "getState", "plan", "getRotationPlan", "status", "ready", "isReady", "busy", "items", "tmdbRateLimit", "rateLimited", "pipelineError", "showHeroFallback", "index", "entry", "setFooterStatus", "message", "footer", "grid", "boot", "isTestEnv", "initErrorHandler", "applyReduceMotionPref", "showLoader", "setLoader", "showSkeleton", "configPromise", "r", "err", "showError", "policyPromise", "initHeroPolicy", "getHeroPolicy", "heroPolicy", "syncDefaultMetadataService", "heroPipelineInfo", "configure", "setState", "getValidationIssues", "movies", "loadMovies", "shows", "loadShows", "facets", "computeFacets", "setSources", "setActiveView", "primeAll", "clearSkeleton", "renderSwitch", "renderFacets", "initFilters", "filtered", "applyFilters", "renderStats", "renderGrid", "renderFooterMeta", "hideLoader", "hydrateOptional", "initUi", "initSettingsOverlay", "initAdvancedToggle", "initHeaderInteractions", "initScrollProgress", "initScrollTop", "initFilterBarAutoHideFallback", "initHeroAutoplay", "initDebugUi", "handleHashChange", "error", "showRetryableError", "tmdbRaf", "applyHashNavigation", "hash", "view", "ensureKind", "result", "match", "kind", "id", "item", "x", "openSeriesDetailV3", "openMovieDetailV3", "force", "currentHash", "hashNavigation", "root", "buttons", "current", "btn", "target", "isActive", "ensure", "navigateToHash", "animate", "s", "elM", "elS", "countTo", "el", "start", "end", "dur", "t0", "step", "t", "p", "val", "times", "date", "setReduceMotionClass", "pref", "body", "panel", "animating", "fallbackTimer", "finishAnimation", "queueFinish", "event", "openPanel", "height", "closePanel", "siteLogo", "titleEl", "subtitle", "TAGLINES", "idx", "rotate", "taglineTicker", "bar", "update", "scrollTop", "pct", "toggle", "y", "filters", "lastY", "isHidden", "ticking", "MIN_SCROLL", "DELTA_HIDE", "setHidden", "nextHidden", "currentY", "delta", "onScroll", "reveal", "DEFAULT_FEATURE_FLAGS", "hashchangeTimeout", "init_main", "__esmMin", "init_state", "init_loader", "init_data", "init_filter", "init_grid", "init_modalV3", "init_tmdb", "init_watchlist", "init_debug", "init_errorHandler", "init_settingsOverlay", "init_hero", "init_hero_autoplay", "init_policy", "init_pipeline", "init_metadataService", "existing", "merged", "lastHash", "suppressedHash", "normalizeHash", "raw", "trimmed", "updateHash", "targetHash", "options", "replace", "silent", "method", "usedHistory", "shouldHandle", "markProcessed", "setHeroNavigation", "setFiltersUpdatedHandler", "setHeroRefreshHandler", "setReduceMotionHandler", "enabled"]
}
