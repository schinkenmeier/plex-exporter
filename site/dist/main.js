var Wc=Object.defineProperty;var _=(e,t)=>()=>(e&&(t=e(e=0)),t);var Ze=(e,t)=>{for(var n in t)Wc(e,n,{get:t[n],enumerable:!0})};function Pe(e){Object.assign(pr,e),br.forEach(t=>t(pr))}function oi(e){return br.add(e),()=>br.delete(e)}var pr,br,x,Z=_(()=>{pr={view:"movies",movies:[],shows:[],facets:{},filtered:[],cfg:{},heroPolicy:null,heroPolicyIssues:[]},br=new Set,x=()=>pr});function M(e,t,n){let r=document.createElement(e);return t&&(r.className=t),n!=null&&(r.textContent=n),r}var R,an=_(()=>{R=(e,t=document)=>t.querySelector(e)});function yr(){if(!ie&&(ie=R("#loaderOverlay"),!ie)){ie=M("div","loader-overlay"),ie.id="loaderOverlay",ie.hidden=!0;let e=M("div","loader");ln=M("div","msg",""),cn=M("div","bar"),e.append(ln,cn),ie.append(e),document.body.append(ie)}}function ii(){yr(),ie.hidden=!1}function Ne(e,t){yr(),ln&&(ln.textContent=e||""),cn&&(cn.style.width=(t||0)+"%")}function un(){yr(),ie.hidden=!0}function si(e=18){let t=R("#grid");if(t){we=M("div","skeleton");for(let n=0;n<e;n++)we.append(M("div","skel"));t.replaceChildren(we)}}function vr(){we&&we.parentElement&&we.parentElement.removeChild(we),we=null}var ie,cn,ln,we,ai=_(()=>{an()});function ci(e,t,n=864e5){try{let r=Be+e,o={value:t,timestamp:Date.now(),ttl:n};localStorage.setItem(r,JSON.stringify(o)),Vc()}catch(r){if(r.name==="QuotaExceededError"){di();try{let o=Be+e,i={value:t,timestamp:Date.now(),ttl:n};localStorage.setItem(o,JSON.stringify(i))}catch{}}}}function li(e){try{let t=Be+e,n=localStorage.getItem(t);if(!n)return null;let r=JSON.parse(n);if(typeof r.timestamp!="number"||typeof r.ttl!="number")return localStorage.removeItem(t),null;let o=Date.now();return r.timestamp+r.ttl<o?(localStorage.removeItem(t),null):r.value}catch{return null}}function ui(){try{Object.keys(localStorage).forEach(t=>{t.startsWith(Be)&&localStorage.removeItem(t)})}catch{}}function dn(){try{let e=Object.keys(localStorage),t=Date.now(),n=0;e.forEach(r=>{if(r.startsWith(Be))try{let o=JSON.parse(localStorage.getItem(r));o.timestamp+o.ttl<t&&(localStorage.removeItem(r),n++)}catch{localStorage.removeItem(r),n++}}),n>0}catch{}}function Sr(){try{let t=Object.keys(localStorage).filter(s=>s.startsWith(Be)),n=Date.now(),r=0,o=0,i=0;return t.forEach(s=>{let a=localStorage.getItem(s);r+=a.length*2;try{let c=JSON.parse(a);c.timestamp+c.ttl>=n?o++:i++}catch{i++}}),{totalEntries:t.length,validEntries:o,expiredEntries:i,totalSize:r,totalSizeMB:(r/1024/1024).toFixed(2)}}catch{return null}}function Vc(){try{let e=Sr();e&&e.totalSize>5242880&&di(.3)}catch{}}function di(e=.3){try{let t=Object.keys(localStorage),n=[];t.forEach(o=>{if(o.startsWith(Be))try{let i=JSON.parse(localStorage.getItem(o));n.push({key:o,timestamp:i.timestamp})}catch{n.push({key:o,timestamp:0})}}),n.sort((o,i)=>o.timestamp-i.timestamp);let r=Math.ceil(n.length*e);for(let o=0;o<r;o++)localStorage.removeItem(n[o].key)}catch{}}var Be,Xc,Er=_(()=>{Be="plex_cache_";Xc=null;typeof window!="undefined"&&typeof window.document!="undefined"&&window===globalThis&&(dn(),Xc=setInterval(dn,5*60*1e3))});function Qe(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function rl(e,t){switch(t){case"string":return typeof e=="string";case"number":return typeof e=="number"&&Number.isFinite(e);case"boolean":return typeof e=="boolean";case"array":return Array.isArray(e);case"object":return Qe(e);default:return!1}}function Ar(e,t,n="value"){if(!t)return;if(e==null){if(t.nullable)return;throw new Error(`${n} darf nicht null oder undefined sein.`)}let r=Array.isArray(t.type)?t.type:[t.type];if(r&&r.length&&!r.some(i=>rl(e,i))){let i=r.join(" oder ");throw new Error(`${n} erwartet Typ ${i}, erhielt ${typeof e}.`)}if(r.includes("array")){if(!Array.isArray(e))throw new Error(`${n} erwartet eine Liste.`);t.items&&e.forEach((o,i)=>{n.includes(".genres")||n.includes("List")&&t.items.type&&Array.isArray(t.items.type)&&t.items.type.includes("string")&&t.items.type.includes("object")||Ar(o,t.items,`${n}[${i}]`)});return}if(r.includes("object")){if(!Qe(e))throw new Error(`${n} erwartet ein Objekt.`);let o=t.required||[];for(let s of o){let a=e[s];if(a==null||typeof a=="string"&&!a.trim())throw new Error(`${n}.${s} ist ein Pflichtfeld.`)}let i=t.properties||{};for(let[s,a]of Object.entries(i))e[s]!=null&&Ar(e[s],a,`${n}.${s}`)}}function fi(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():t&&typeof t=="object"&&typeof t.tag=="string"?t.tag.trim():null).filter(t=>t&&t.length>0):[]}function gi(e,t){let n={...e};for(let[r,o]of Object.entries(t))n[r]==null?n[r]=Array.isArray(o)?[...o]:o:Array.isArray(o)&&(n[r]=Array.isArray(n[r])?[...n[r]]:[...o]);return n}function hi(e){if(!Qe(e)||typeof e.title!="string"||!e.title.trim())return!1;let t=e.ratingKey;return typeof t=="string"||typeof t=="number"}function ol(e){return hi(e)?e.seasons==null?!0:Array.isArray(e.seasons)?e.seasons.every(t=>Qe(t)):!1:!1}function il(e){let t=gi(e,Yc);t.title=t.title.trim(),t.ratingKey=String(e.ratingKey).trim();let n=typeof t.thumb=="string"?t.thumb:"",r=typeof t.thumbFile=="string"?t.thumbFile:"";return t.thumb=n,t.thumbFile=r||n,t.summary=typeof t.summary=="string"?t.summary:"",t.href=typeof t.href=="string"?t.href:"",t.tagline=typeof t.tagline=="string"?t.tagline:"",t.genres=fi(t.genres),t}function sl(e){let t=gi(e,Jc);t.title=t.title.trim(),t.ratingKey=String(e.ratingKey).trim();let n=typeof t.thumb=="string"?t.thumb:"",r=typeof t.thumbFile=="string"?t.thumbFile:"";return t.thumb=n,t.thumbFile=r||n,t.summary=typeof t.summary=="string"?t.summary:"",t.href=typeof t.href=="string"?t.href:"",t.tagline=typeof t.tagline=="string"?t.tagline:"",t.genres=fi(t.genres),Array.isArray(e.seasons)?t.seasons=e.seasons.filter(Qe).map(o=>{let i={...o};return i.episodes=Array.isArray(o.episodes)?o.episodes.filter(Qe).map(s=>({...s})):[],typeof i.thumb!="string"&&(i.thumb=""),typeof i.thumbFile!="string"&&(i.thumbFile=""),i}):t.seasons=[],t}function wr(e,t="movie"){if(Ar(e,t==="show"?nl:tl,`${t}List`),!Array.isArray(e))throw new Error("Datensatz ist keine Liste.");let r=t==="show"?ol:hi,o=t==="show"?sl:il;return e.map((i,s)=>{if(!r(i))throw new Error(`Ung\xFCltiger ${t}-Eintrag an Index ${s}.`);return o(i)})}var Yc,Jc,Zc,Qc,el,tl,nl,mi=_(()=>{Yc=Object.freeze({thumb:"",thumbFile:"",summary:"",href:"",tagline:"",genres:[]}),Jc=Object.freeze({thumb:"",thumbFile:"",summary:"",href:"",tagline:"",genres:[],seasons:[]}),Zc=Object.freeze({type:"object",required:["title","ratingKey"],properties:{title:{type:"string"},ratingKey:{type:["string","number"]},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0},summary:{type:"string",nullable:!0},href:{type:"string",nullable:!0},tagline:{type:"string",nullable:!0},genres:{type:"array",items:{type:["string","object"]},nullable:!0}}}),Qc=Object.freeze({type:"object",properties:{episodes:{type:"array",items:{type:"object"},nullable:!0},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0}}}),el=Object.freeze({type:"object",required:["title","ratingKey"],properties:{title:{type:"string"},ratingKey:{type:["string","number"]},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0},summary:{type:"string",nullable:!0},href:{type:"string",nullable:!0},tagline:{type:"string",nullable:!0},genres:{type:"array",items:{type:["string","object"]},nullable:!0},seasons:{type:"array",items:Qc,nullable:!0}}}),tl=Object.freeze({type:"array",items:Zc}),nl=Object.freeze({type:"array",items:el})});var pi={};Ze(pi,{clearErrors:()=>cl,initErrorHandler:()=>Mt,showError:()=>q,showRetryableError:()=>Cr,withErrorHandling:()=>al});function Mt(){G||(G=document.createElement("div"),G.id="errorContainer",G.className="error-container",G.setAttribute("role","alert"),G.setAttribute("aria-live","polite"),document.body.appendChild(G)),window.addEventListener("unhandledrejection",e=>{var t;q("Ein unerwarteter Fehler ist aufgetreten",(t=e.reason)==null?void 0:t.message),e.preventDefault()}),window.addEventListener("error",e=>{var t;q("Ein Fehler ist aufgetreten",(t=e.error)==null?void 0:t.message)})}function q(e,t="",n=5e3){G||Mt();let r=document.createElement("div");return r.className="error-toast",r.innerHTML=`
    <div class="error-toast-content">
      <div class="error-toast-icon">\u26A0\uFE0F</div>
      <div class="error-toast-text">
        <div class="error-toast-title">${kr(e)}</div>
        ${t?`<div class="error-toast-message">${kr(t)}</div>`:""}
      </div>
      <button class="error-toast-close" aria-label="Schlie\xDFen">\xD7</button>
    </div>
  `,r.querySelector(".error-toast-close").addEventListener("click",()=>{r.classList.add("error-toast-exit"),setTimeout(()=>r.remove(),300)}),G.appendChild(r),n>0&&setTimeout(()=>{r.parentNode&&(r.classList.add("error-toast-exit"),setTimeout(()=>r.remove(),300))},n),requestAnimationFrame(()=>{r.classList.add("error-toast-show")}),r}function al(e,t="Ein Fehler ist aufgetreten"){return async(...n)=>{try{return await e(...n)}catch(r){throw q(t,r.message),r}}}function Cr(e,t){G||Mt();let n=document.createElement("div");n.className="error-toast error-toast-retryable",n.innerHTML=`
    <div class="error-toast-content">
      <div class="error-toast-icon">\u26A0\uFE0F</div>
      <div class="error-toast-text">
        <div class="error-toast-title">${kr(e)}</div>
      </div>
      <button class="error-toast-retry">Erneut versuchen</button>
      <button class="error-toast-close" aria-label="Schlie\xDFen">\xD7</button>
    </div>
  `;let r=n.querySelector(".error-toast-retry"),o=n.querySelector(".error-toast-close");return r.addEventListener("click",async()=>{n.remove();try{await t()}catch{}}),o.addEventListener("click",()=>{n.classList.add("error-toast-exit"),setTimeout(()=>n.remove(),300)}),G.appendChild(n),requestAnimationFrame(()=>{n.classList.add("error-toast-show")}),n}function cl(){G&&(G.innerHTML="")}function kr(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}var G,fn=_(()=>{G=null});async function Tr(e,t=2,n=!0){if(n){let s=li(e);if(s!==null)return s}let r=null;for(let s=0;s<=t;s++){try{let a=await fetch(e,{cache:"no-store"});if(a&&a.ok){let c=await a.json();return n&&c&&ci(e,c,ll),c}if(a&&a.status===404)return null;r=new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(a){r=a}if(s<t){let a=Math.min(1e3*Math.pow(2,s),5e3);await new Promise(c=>setTimeout(c,a))}}let o=(r==null?void 0:r.message)||"Unbekannter Fehler",i=new Error(`Daten konnten nicht geladen werden: ${e} (${o})`);throw r&&typeof r=="object"&&(i.cause=r),i}function hl(e){try{let t=document.getElementById(e);if(t&&t.textContent)return JSON.parse(t.textContent)}catch{}return null}function ml(e){try{let t=ul;return(t&&Array.isArray(t[e])?t[e]:null)||null}catch{return null}}function pl(e){try{return(Array.isArray(window[e])?window[e]:null)||null}catch{return null}}async function vi(e,t){let n=null;try{n=await Tr(e)}catch{n=null}if(Array.isArray(n)&&n.length)return et(t==null?void 0:t.label,`primary:${e}`),n;if(t!=null&&t.embedId){let r=hl(t.embedId);if(Array.isArray(r)&&r.length)return et(t==null?void 0:t.label,`embedded:${t.embedId}`),r}if(t!=null&&t.exportKey){let r=ml(t.exportKey);if(Array.isArray(r)&&r.length)return et(t==null?void 0:t.label,`globalBag:${t.exportKey}`),r}if(t!=null&&t.globalVar){let r=pl(t.globalVar);if(Array.isArray(r)&&r.length)return et(t==null?void 0:t.label,`window:${t.globalVar}`),r}for(let r of(t==null?void 0:t.altUrls)||[]){let o=null;try{o=await Tr(r)}catch{o=null}if(Array.isArray(o)&&o.length)return et(t==null?void 0:t.label,`alt:${r}`),o}return et(t==null?void 0:t.label,"empty"),Array.isArray(n)?n:[]}function xr(e,t){typeof window=="undefined"||typeof document=="undefined"||typeof document.createElement!="function"||Promise.resolve().then(()=>(fn(),pi)).then(n=>{var r;try{(r=n.showError)==null||r.call(n,e,t,8e3)}catch{}}).catch(n=>{})}function bl(e,t){let n=e==null?"":String(e).trim();if(!n)return"";if(n.startsWith("//")||n.startsWith("/")||gl.test(n))return n;let r=n.replace(/\\/g,"/"),o=t?t.endsWith("/")?t:`${t}/`:"",i=!1,s=m=>m.split("/").map(p=>{if(!p)return"";try{return encodeURIComponent(decodeURIComponent(p))}catch{return i||(i=!0),encodeURIComponent(p)}}).join("/"),c=r.replace(/^\/+/,"").split("/"),l=[];for(let m of c)if(!(!m||m===".")){if(m===".."){l.length&&l.pop();continue}l.push(m)}let u=l.join("/");if(u.startsWith("data/"))return s(u);let d=l;if(o&&d.length){let m=o.replace(/\/+$/,"").split("/").pop();m&&d[0]===m&&(d=d.slice(1))}let f=d.join("/"),g=s(f);return`${o}${g}`}function Si(e,t){var o,i;if(!e||typeof e!="object")return e;let n=(i=(o=e.thumbFile)!=null?o:e.thumb)!=null?i:"",r=bl(n,t);if(r)e.thumbFile=r,e.thumb=r;else if(n){let s=String(n);e.thumbFile=s,e.thumb==null&&(e.thumb=s)}return e}function yl(e){return Si(e,dl)}function te(e){return Si(e,fl)}function Ei(e){return!e||typeof e!="object"||(te(e),Array.isArray(e.seasons)&&e.seasons.forEach(Ai)),e}function Ai(e){return!e||typeof e!="object"||(te(e),Array.isArray(e.episodes)&&e.episodes.forEach(t=>te(t))),e}function vl(e){return Array.isArray(e)?(e.forEach(t=>{t&&typeof t=="object"&&yl(t)}),e):[]}function Sl(e){return Array.isArray(e)?(e.forEach(t=>{t&&typeof t=="object"&&Ei(t)}),e):[]}async function wi(){try{let e=await vi("data/movies/movies.json",{label:"movies",embedId:"movies-json",exportKey:"movies",globalVar:"__PLEX_MOVIES__",altUrls:["movies/movies.json","data/movies.json","Filme/movies.json","movies.json"]}),t;try{t=wr(e,"movie")}catch(n){let r=(n==null?void 0:n.message)||"Unbekannte Validierungsfehler",o=new Error(`Ung\xFCltige Filmdaten: ${r}`);throw n instanceof Error&&(o.cause=n),o}return vl(t)}catch(e){return xr("Filme konnten nicht geladen werden",(e==null?void 0:e.message)||"Unbekannter Fehler"),[]}}async function ki(){try{let e=await vi("data/series/series_index.json",{label:"shows",embedId:"series-json",exportKey:"shows",globalVar:"__PLEX_SHOWS__",altUrls:["series/series_index.json","data/shows.json","data/series.json","Serien/series.json","series/series.json","series.json","shows.json"]}),t;try{t=wr(e,"show")}catch(n){let r=(n==null?void 0:n.message)||"Unbekannte Validierungsfehler",o=new Error(`Ung\xFCltige Seriendaten: ${r}`);throw n instanceof Error&&(o.cause=n),o}return Sl(t)}catch(e){return xr("Serien konnten nicht geladen werden",(e==null?void 0:e.message)||"Unbekannter Fehler"),[]}}async function Ci(e){if(!e)return null;let t=El(e),n=Al(t);if(n!==void 0)return n;let r=wl(e),o=null;for(let i of r)try{let s=await Tr(i);if(s&&typeof s=="object"){let a=kl(s);return bi(t,a,e),xi(a)}}catch(s){o=s}return o&&xr("Details konnten nicht geladen werden",(o==null?void 0:o.message)||"Bitte sp\xE4ter erneut versuchen."),bi(t,null,e),null}function et(e,t){if(e)try{yi[e]=t}catch{}}function Ti(){return{...yi}}function El(e){let t=[];(e==null?void 0:e.ratingKey)!==void 0&&(e==null?void 0:e.ratingKey)!==null&&(e==null?void 0:e.ratingKey)!==""&&t.push(`rk:${String(e.ratingKey)}`);let n=hn(e==null?void 0:e.href);return n&&t.push(`href:${n}`),t}function hn(e){return e?String(e).trim().replace(/^\.\//,"").replace(/^\/+/,""):""}function Al(e){for(let t of e)if(He.has(t)){let n=He.get(t);return n?xi(n):null}}function bi(e,t,n){let r=t;e.forEach(c=>{He.set(c,r)});let o=n==null?void 0:n.ratingKey;o!=null&&He.set(`rk:${String(o)}`,r);let i=t&&typeof t=="object"?t.ratingKey:void 0;i!=null&&He.set(`rk:${String(i)}`,r);let s=hn(n==null?void 0:n.href);s&&He.set(`href:${s}`,r);let a=t&&typeof t=="object"?hn(t.href):"";a&&He.set(`href:${a}`,r)}function wl(e){let t=new Set,n=hn(e==null?void 0:e.href);if(n)if(/^https?:/i.test(n))t.add(n);else{n.startsWith("data/")?t.add(n):t.add(`data/${n}`);let o=n.replace(/^data\//,"");o.startsWith("series/")||t.add(`data/series/${o}`);let i=o.replace(/^series\//,"").replace(/^details\//,"").replace(/\.json$/,"");i&&t.add(`data/series/details/${i}.json`)}let r=e==null?void 0:e.ratingKey;return r!=null&&t.add(`data/series/details/${String(r)}.json`),Array.from(t)}function kl(e){if(!e||typeof e!="object")return null;let t={...e};te(t),t.genres=_r(t.genres);let n=xl(t.cast||t.roles||[]);return t.cast=n,t.roles=n,t.seasons=Array.isArray(t.seasons)?t.seasons.map(Cl).filter(Boolean):[],t.seasonCount=Number.isFinite(t.seasonCount)?t.seasonCount:t.seasons.length,Ei(t),t}function Cl(e){if(!e||typeof e!="object")return null;let t={...e};return te(t),t.genres=_r(t.genres),t.episodes=Array.isArray(t.episodes)?t.episodes.map(Tl).filter(Boolean):[],Ai(t),t}function Tl(e){if(!e||typeof e!="object")return null;let t={...e};return te(t),t.genres=_r(t.genres),t}function _r(e){if(!Array.isArray(e))return[];let t=new Set,n=[];return e.forEach(r=>{let o=null;if(typeof r=="string"){let i=r.trim();i&&(o={tag:i})}else if(r&&typeof r=="object"){let i=String(r.tag||r.title||r.name||r.label||"").trim();i&&(o={...r,tag:i})}o&&!t.has(o.tag)&&(t.add(o.tag),n.push(o))}),n}function xl(e){return Array.isArray(e)?e.map(t=>{if(!t)return null;if(typeof t=="string"){let n=t.trim();return n?{tag:n}:null}if(typeof t=="object"){let n=String(t.tag||t.name||t.role||"").trim();return n?{...t,tag:n}:{...t}}return null}).filter(Boolean):[]}function xi(e){if(e==null)return e;try{return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}return e}var yi,He,ll,gn,ul,dl,fl,gl,tt=_(()=>{Er();mi();yi={movies:null,shows:null},He=new Map,ll=1e3*60*30,gn="__PLEX_EXPORTER__",ul=(()=>{try{if(typeof globalThis!="undefined"){if(globalThis[gn])return globalThis[gn];if(globalThis.window&&globalThis.window[gn])return globalThis.window[gn]}}catch{}return null})(),dl="data/movies/",fl="data/series/",gl=/^[a-z][a-z0-9+.-]*:/i});var Ii={};Ze(Ii,{clearHeroCache:()=>Ll,collectionTags:()=>Re,enableMoreChipBehavior:()=>_i,formatRating:()=>O,getGenreNames:()=>ue,humanYear:()=>$,isNew:()=>$e,renderChipsLimited:()=>pn,useTmdbForCards:()=>bn,useTmdbForHero:()=>Ft,useTmdbOn:()=>De});function ue(e){let t=new Set,n=[];return(e||[]).forEach(r=>{let o="";typeof r=="string"?o=r:r&&typeof r=="object"&&(o=r.tag||r.title||r.name||"");let i=String(o||"").trim();i&&!t.has(i)&&(t.add(i),n.push(i))}),n}function pn(e,t,n=3){if(!e)return;let r=(t||[]).filter(Boolean);if(r.length>n){let o=r.slice(0,n),i=r.slice(n),s=o.map(c=>mn(c)),a=mn(`+ ${i.length}`);a.classList.add("more","card__chip--more"),a.setAttribute("data-more",i.length),a.setAttribute("title",`${i.length} weitere Genres: ${i.join(", ")}`),a._extraChips=i.map(c=>mn(c)),s.push(a),e.replaceChildren(...s)}else{let o=r.map(i=>mn(i));e.replaceChildren(...o)}_i(e)}function _i(e=document){try{e.querySelectorAll(".chip.more, .card__chip--more").forEach(t=>{t.dataset.bound||(t.dataset.bound="1",t.addEventListener("click",n=>{n.stopPropagation();let r=t.closest(".card");if(r)r.click();else{let o=t._extraChips||[];try{o.forEach(i=>t.before(i))}catch{}t.remove()}}))})}catch{}}function Re(e){return(e&&e.collections||[]).map(t=>t&&(t.tag||t.title||t.name||"")).filter(Boolean)}function $(e){if(!e)return"";let t=[e.originallyAvailableAt,e.year,e.releaseDate,e.premiereDate];for(let n of t){if(n==null)continue;let r=String(n);if(!r)continue;let o=r.match(/\d{4}/);if(o)return o[0]}return""}function O(e){if(e instanceof Number)return O(e.valueOf());if(typeof e=="number")return Number.isFinite(e)?e.toFixed(1):"0.0";if(typeof e=="string"){let t=e.trim();if(!t)return"0.0";let n=Number(t);return Number.isFinite(n)?n.toFixed(1):"0.0"}return"0.0"}function mn(e){let t=document.createElement("span");return t.className="chip",t.textContent=String(e||""),t}function $e(e){if(!(e!=null&&e.addedAt))return!1;let t=new Date(e.addedAt).getTime();if(!Number.isFinite(t))return!1;let n=x().cfg||{},r=Number(n.newDays||30);return Date.now()-t<=r*24*60*60*1e3}function Il(){var e,t;try{let n=localStorage.getItem("tmdbToken");if(n&&n.trim())return!0;let r=x();return!!((e=r.cfg)!=null&&e.tmdbToken||(t=r.cfg)!=null&&t.tmdbApiKey)}catch{return!1}}function bn(){try{return localStorage.getItem("useTmdb")==="1"}catch{return!1}}function Ft(){return Il()}function De(){return bn()}function Ll(){try{let e={tmdbToken:localStorage.getItem("tmdbToken"),useTmdb:localStorage.getItem("useTmdb"),prefReduceMotion:localStorage.getItem("prefReduceMotion"),watchlist:localStorage.getItem("watchlist:v1"),modalLayout:localStorage.getItem("modalLayout"),scrollOrchestratorEnabled:localStorage.getItem("scrollOrchestratorEnabled")},t=Object.keys(localStorage).filter(r=>r.startsWith("hero")||r.startsWith("Hero")),n=Object.keys(localStorage).filter(r=>r.includes("tmdbCache")||r==="hero.tmdbCache.v1");return t.forEach(r=>localStorage.removeItem(r)),n.forEach(r=>localStorage.removeItem(r)),Object.entries(e).forEach(([r,o])=>{o!==null&&localStorage.setItem(r,o)}),{heroEntries:t.length,tmdbCacheEntries:n.length,preserved:Object.keys(e).filter(r=>e[r]!==null)}}catch(e){return{error:e.message}}}var de=_(()=>{Z()});function Ml(){try{se=new Set(JSON.parse(localStorage.getItem(Fi)||"[]"))}catch{se=new Set}}function Pi(){try{localStorage.setItem(Fi,JSON.stringify(Array.from(se.values())))}catch{}}function Lr(e){var r,o;if(!e)return"";let t=e.type==="tv"||e.libraryType==="show"?"show":"movie",n=((r=e.ids)==null?void 0:r.imdb)||((o=e.ids)==null?void 0:o.tmdb)||String(e.ratingKey||"");return n?`${t}:${n}`:""}function Mr(e){return se.has(Lr(e))}function Fl(){return se.size}function Fr(e){let t=Lr(e);if(!t)return;se.has(t)?se.delete(t):se.add(t),Pi(),Pr();let n=document.getElementById("watchlistPanel");n&&!n.hidden&&yn()}function Pr(){let e=document.getElementById("watchlistCount");e&&(e.textContent=String(Fl()))}function Li(){let e=document.getElementById("watchlistPanel");e&&(e.hidden=!1,e.setAttribute("aria-hidden","false"),yn())}function Mi(){let e=document.getElementById("watchlistPanel");e&&(e.hidden=!0,e.setAttribute("aria-hidden","true")),Ir(!1)}function Pl(){se.clear(),Pi(),Pr(),yn()}function Nl(){let e=Ni(),t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="watchlist.json",document.body.append(r),r.click(),r.remove(),setTimeout(()=>URL.revokeObjectURL(r.href),1e3)}function Ni(){let e=x(),t=(e.movies||[]).concat(e.shows||[]),n=new Map(t.map(r=>[Lr(r),r]));return Array.from(se.values()).map(r=>n.get(r)).filter(Boolean)}function yn(){let e=document.getElementById("watchlistItems"),t=document.getElementById("watchlistEmpty");if(!e||!t)return;let n=Ni();if(n.length===0){e.replaceChildren(),t.hidden=!1;return}t.hidden=!0;let r=document.createDocumentFragment();n.forEach(o=>{let i=document.createElement("li");i.className="watchlist-item";let s=document.createElement("span");s.className="title",s.textContent=o.title||"";let a=document.createElement("button");a.textContent="Entfernen",a.addEventListener("click",()=>{Fr(o),yn()});let c=document.createElement("button");c.textContent="\xD6ffnen",c.addEventListener("click",()=>{var d,f;let l=o.type==="tv"?"show":"movie",u=((d=o.ids)==null?void 0:d.imdb)||((f=o.ids)==null?void 0:f.tmdb)||String(o.ratingKey||"");u&&(location.hash=`#/${l}/${u}`)}),i.append(s,c,a),r.append(i)}),e.replaceChildren(r)}function Bi(){Ml(),Pr();let e=document.getElementById("openWatchlist"),t=document.getElementById("watchlistToggle"),n=document.getElementById("closeWatchlist"),r=document.getElementById("clearWatchlist"),o=document.getElementById("exportWatchlist");e&&e.addEventListener("click",()=>{Li(),Ir(!0)}),t&&t.addEventListener("click",()=>{let i=document.getElementById("watchlistPanel");i&&!i.hidden?Mi():(Li(),Ir(!0))}),n&&n.addEventListener("click",()=>{Mi()}),r&&r.addEventListener("click",()=>{Pl()}),o&&o.addEventListener("click",()=>{Nl()})}function Ir(e){let t=document.getElementById("watchlistToggle");t&&t.setAttribute("aria-expanded",e?"true":"false")}var Fi,se,Nr=_(()=>{Z();Fi="watchlist:v1",se=new Set});function Ri(e){let t=e.querySelector(".v2-tabs");if(!t)return;let n=Array.from(t.querySelectorAll("button[data-t]")),r=s=>{n.forEach(a=>{let c=a.dataset.t===s;a.classList.toggle("active",c),a.setAttribute("aria-selected",c?"true":"false"),a.tabIndex=c?0:-1;let l=e.querySelector(`.v2-pane[data-pane="${a.dataset.t}"]`);l&&(l.hidden=!c,l.setAttribute("aria-hidden",l.hidden?"true":"false"))})},o=(s,a)=>{if(!n.length)return;let c=n.indexOf(s),l=a>0?0:n.length-1,u=c===-1?l:(c+a+n.length)%n.length,d=n[u];d&&(d.focus(),r(d.dataset.t))};t.addEventListener("click",s=>{let a=s.target.closest("button[data-t]");a&&(s.preventDefault(),r(a.dataset.t))}),t.addEventListener("keydown",s=>{let a=s.target.closest("button[data-t]");if(a)switch(s.key){case"ArrowLeft":case"ArrowUp":s.preventDefault(),o(a,-1);break;case"ArrowRight":case"ArrowDown":s.preventDefault(),o(a,1);break;case"Home":s.preventDefault(),n[0]&&(n[0].focus(),r(n[0].dataset.t));break;case"End":if(s.preventDefault(),n.length){let c=n[n.length-1];c.focus(),r(c.dataset.t)}break;default:break}});let i=n.find(s=>s.classList.contains("active"))||n[0];i&&r(i.dataset.t)}var $i=_(()=>{});function Bl(e){var r,o;let t=((r=e==null?void 0:e.tmdbDetail)==null?void 0:r.poster)||((o=e==null?void 0:e.tmdb)==null?void 0:o.poster)||(e==null?void 0:e.tmdbPoster),n=(e==null?void 0:e.poster)||(e==null?void 0:e.thumbFile)||(e==null?void 0:e.art)||"";return De()&&t?t:n}function Sn(e){var r;let t=[e==null?void 0:e.runtimeMin,e==null?void 0:e.durationMin,(r=e==null?void 0:e.tmdbDetail)==null?void 0:r.runtime,e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null],n=null;for(let o of t){let i=Number(o);if(Number.isFinite(i)&&i>0){n=i;break}}return n===null?"":(e==null?void 0:e.type)==="tv"?`~${n} min/Ep`:`${n} min`}function Ki(e){var n;let t=Number((n=e==null?void 0:e.rating)!=null?n:e==null?void 0:e.audienceRating);return Number.isFinite(t)?`\u2605 ${O(t)}`:""}function En(e){var t,n;if(e!=null&&e.studio)return e.studio;if(e!=null&&e.network)return e.network;if(e!=null&&e.studioName)return e.studioName;if((t=e==null?void 0:e.tmdbDetail)!=null&&t.productionCompanies){let r=e.tmdbDetail.productionCompanies.find(o=>o==null?void 0:o.name);if(r&&r.name)return r.name}if((n=e==null?void 0:e.tmdbDetail)!=null&&n.networks){let r=e.tmdbDetail.networks.find(o=>o==null?void 0:o.name);if(r&&r.name)return r.name}return""}function Hl(e){var s;let t=[];$e(e)&&t.push("Neu"),(e==null?void 0:e.type)==="tv"&&Number.isFinite(Number(e==null?void 0:e.seasonCount))&&t.push(`Staffeln: ${e.seasonCount}`);let n=(e==null?void 0:e.genres)||[],r=Array.isArray((s=e==null?void 0:e.tmdbDetail)==null?void 0:s.genres)?e.tmdbDetail.genres:[],o=[...n,...r].map(a=>a?typeof a=="string"?a:a.tag||a.title||a.name||"":"").filter(Boolean),i=new Set;return o.forEach(a=>{i.has(a.toLowerCase())||(i.add(a.toLowerCase()),t.push(a))}),t}function Rl(e){var n;let t=(((n=e==null?void 0:e.tmdbDetail)==null?void 0:n.tagline)||"").trim();return t||((e==null?void 0:e.tagline)||"").trim()}function Ui(e){var n;let t=(((n=e==null?void 0:e.tmdbDetail)==null?void 0:n.contentRating)||"").trim();return t||((e==null?void 0:e.contentRating)||"").trim()}function $l(e){var t,n;return(t=e==null?void 0:e.tmdbDetail)!=null&&t.backdrop?e.tmdbDetail.backdrop:(n=e==null?void 0:e.tmdb)!=null&&n.backdrop?e.tmdb.backdrop:(e==null?void 0:e.art)||(e==null?void 0:e.background)||""}function Hr(e){return e?typeof e=="string"?e:e.url||e.file_path||e.filePath||e.path||e.logo||"":""}function Dl(e){if(!e||typeof e!="object")return"";let t=e.iso6391||e.iso_639_1||e.language||"";return typeof t=="string"?t.toLowerCase():""}function zl(e){var o;let t=e==null?void 0:e.tmdbDetail,n=Array.isArray((o=t==null?void 0:t.images)==null?void 0:o.logos)?t.images.logos:[];if(!n.length)return"";let r=["de","en",""];for(let i of r){let s=n.find(l=>{let u=Dl(l);return i?u===i:!u}),a=Hr(s),c=nt(a);if(c)return c}for(let i of n){let s=nt(Hr(i));if(s)return s}return""}function Ol(e,t=""){var a;let n=new Set,r=nt(t);r&&n.add(r);let o=[],i=e==null?void 0:e.tmdbDetail,s=c=>{let l=nt(Hr(c));!l||n.has(l)||(n.add(l),o.push(l))};return(a=i==null?void 0:i.images)!=null&&a.logos&&i.images.logos.forEach(s),i!=null&&i.networks&&i.networks.forEach(s),i!=null&&i.productionCompanies&&i.productionCompanies.forEach(s),o[0]||""}function nt(e){if(!e)return"";let t=String(e).trim();return t?/^https?:\/\//i.test(t)||/^data:image\//i.test(t)?t:t.replace(/["'()]/g,""):""}function jl(e,t){let n=e.querySelector("[data-head-backdrop]");if(!n)return;let r=$l(t),o=nt(r),i=()=>{n.style.backgroundImage="",n.dataset.state="",n.dataset.src=""};if(!o){i();return}if(typeof Image=="undefined"){n.dataset.src=o,n.dataset.state="ready",n.style.backgroundImage=`url("${o}")`;return}n.dataset.state="loading",n.style.backgroundImage="",n.dataset.src=o;let s=new Image;s.decoding="async",s.referrerPolicy="no-referrer";let a=()=>{n.dataset.src===o&&(n.style.backgroundImage=`url("${o}")`,n.dataset.state="ready")},c=()=>{n.dataset.src===o&&i()};s.addEventListener("load",a,{once:!0}),s.addEventListener("error",c,{once:!0}),s.src=o}function Gi(e,t,n=""){let r=e.querySelector("[data-head-logo]");if(!r)return;let o=Ol(t,n);if(o){let i=r.querySelector("img");i||(i=document.createElement("img"),i.alt=(t==null?void 0:t.title)||(t==null?void 0:t.name)||"Logo",i.decoding="async",i.loading="lazy",i.referrerPolicy="no-referrer",r.replaceChildren(i)),i.src=o,i.alt=t!=null&&t.title?`Logo: ${t.title}`:i.alt,r.hidden=!1}else r.hidden=!0,r.replaceChildren()}function Kl(e,t){let n=e.querySelector("[data-head-overlay-logo]");if(!n)return"";let r=zl(t);if(n.dataset.src="",!r)return n.hidden=!0,n.dataset.state="",n.replaceChildren(),"";let o=document.createElement("img");if(o.alt=t!=null&&t.title?`Hero Logo: ${t.title}`:"Hero Logo",o.decoding="async",o.loading="lazy",o.referrerPolicy="no-referrer",n.replaceChildren(o),n.dataset.src=r,typeof Image=="undefined")return o.src=r,n.hidden=!1,n.dataset.state="ready",r;n.hidden=!0,n.dataset.state="loading";let i=()=>{n.dataset.src===r&&(n.hidden=!1,n.dataset.state="ready")},s=()=>{n.dataset.src===r&&(n.hidden=!0,n.dataset.state="",n.dataset.src="",n.replaceChildren(),Gi(e,t,""))};return o.addEventListener("load",i,{once:!0}),o.addEventListener("error",s,{once:!0}),o.src=r,r}function Di(e){return Number.isFinite(e)?e>=7.5?"high":e>=5.5?"medium":e>0?"low":"":""}function qi(e){var o,i,s;let t=(e==null?void 0:e.tmdbDetail)||{},n=Number((o=t.voteAverage)!=null?o:t.vote_average);if(Number.isFinite(n)&&n>0)return{label:"TMDB",value:n,text:O(n),bucket:Di(n)};let r=Number((s=(i=e==null?void 0:e.rating)!=null?i:e==null?void 0:e.audienceRating)!=null?s:e==null?void 0:e.userRating);return Number.isFinite(r)&&r>0?{label:"Bewertung",value:r,text:O(r),bucket:Di(r)}:null}function Ul(e,t){let n=e.querySelector("[data-head-overlay-meta]");if(!n)return;n.replaceChildren();let r=qi(t);if(!r){n.hidden=!0;return}let o=document.createElement("span");o.className="v2-chip--rating",r.bucket&&(o.dataset.score=r.bucket);let i=document.createElement("span");i.textContent=r.label;let s=document.createElement("strong");s.textContent=r.text,o.append(i,s),o.setAttribute("aria-label",`${r.label} Bewertung ${r.text} von 10`),n.appendChild(o),n.hidden=!1}function zi(e,t,n){if(!e)return;let r=!!t;if(e.hidden=!r,e.setAttribute("aria-hidden",r?"false":"true"),!r){e.textContent="",e.removeAttribute("aria-label"),e.removeAttribute("data-score");return}e.textContent=t.text,t.bucket?e.dataset.score=t.bucket:e.removeAttribute("data-score"),n?e.setAttribute("aria-label",n):e.removeAttribute("aria-label")}function Rr(e,t){var I;if(!e)return;let{rootEl:n,titleEl:r,sublineEl:o,metaEl:i,chipsEl:s,tmdbBadgeEl:a,certificationBadgeEl:c,badgesGroupEl:l,footerEl:u,footerLogosEl:d,footerNoteEl:f}=e;r&&(r.textContent=(t==null?void 0:t.title)||(t==null?void 0:t.name)||"");let g=Rl(t),m=$(t),p=Sn(t),h=Ki(t),b=En(t),v=[m,p,h,b].filter(Boolean);if(o){let w=v.join(" \u2022 ");o.textContent=g||w,o.hidden=!(g||w)}i&&(i.textContent=g&&v.length?v.join(" \u2022 "):"",i.hidden=!(g&&v.length)),s&&(s.replaceChildren(),Hl(t).forEach(w=>{let T=document.createElement("span");T.className="chip",T.textContent=w,s.appendChild(T)}),s.hidden=!s.childElementCount,s.setAttribute("aria-hidden",s.childElementCount?"false":"true"));let k=qi(t);if(a){let w=k?{text:`${((I=k.label)==null?void 0:I.toUpperCase())||"TMDB"} ${k.text}`,bucket:k.bucket}:null,T=k?`${k.label==="TMDB"?"TMDB Bewertung":k.label} ${k.text} von 10`:"";zi(a,w,T||null)}if(c){let w=Ui(t),T=w?{text:w,bucket:""}:null,J=w?`Altersfreigabe ${w}`:"";zi(c,T,J||null)}if(l){let w=!!(a&&!a.hidden||c&&!c.hidden);l.hidden=!w,w?l.setAttribute("aria-hidden","false"):l.setAttribute("aria-hidden","true")}if(n){jl(n,t);let w=Kl(n,t);Ul(n,t),Gi(n,t,w)}Xl({footerEl:u,footerLogosEl:d,footerNoteEl:f},t)}function $r({posterEl:e,quickfactsEl:t},n){if(e){let i=Bl(n);e.src=i||"",e.alt=n!=null&&n.title?`Poster: ${n.title}`:"",e.loading="lazy",e.decoding="async",e.classList.remove("is-ready"),i?(e.addEventListener("load",Oi,{once:!0}),e.addEventListener("error",Oi,{once:!0})):e.classList.add("is-ready")}let r=(t==null?void 0:t.root)||t,o=t==null?void 0:t.list;if(r&&o){let i=$(n),s=Sn(n),a=Ki(n),c=En(n),l=Ui(n),u=[];i&&u.push(["Jahr",i]),l&&u.push(["Freigabe",l]),s&&u.push(["Laufzeit",s]),a&&u.push(["Bewertung",a]),c&&u.push(["Studio",c]),o.replaceChildren(),u.forEach(([d,f])=>{let g=document.createElement("dt");g.textContent=d;let m=document.createElement("dd");m.textContent=f,o.append(g,m)}),r.hidden=!u.length,r.setAttribute("aria-hidden",u.length?"false":"true")}}function Oi(e){var t;(t=e.currentTarget)==null||t.classList.add("is-ready")}function Gl(e=""){let t=String(e||"").trim();return t&&t.split(/\s+/).map(r=>r[0]).filter(Boolean).join("").slice(0,3).toUpperCase()||"TMDB"}function ql(e=""){let t=Gl(e),n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"svg");r.setAttribute("viewBox","0 0 160 60"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false");let o=document.createElementNS(n,"rect");o.setAttribute("x","2"),o.setAttribute("y","2"),o.setAttribute("width","156"),o.setAttribute("height","56"),o.setAttribute("rx","14"),o.setAttribute("fill","#15243b"),o.setAttribute("stroke","rgba(87, 116, 164, 0.6)"),o.setAttribute("stroke-width","2");let i=document.createElementNS(n,"text");return i.setAttribute("x","80"),i.setAttribute("y","38"),i.setAttribute("fill","#b8c7e6"),i.setAttribute("font-size","28"),i.setAttribute("font-weight","600"),i.setAttribute("text-anchor","middle"),i.setAttribute("font-family",'Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'),i.textContent=t,r.append(o,i),r}function Wl(e){let t=ji[e.type]||{label:"TMDB"},n=e.name?`${e.name} (${t.label})`:t.label,r=document.createElement("a");r.className="v2-logo",r.href=e.link||vn,r.target="_blank",r.rel="noopener noreferrer",r.title=e.name?`${e.name} \u2013 TMDB`:"TMDB";let o=e.hasSpecificLink?" \u2013 \xF6ffnet externes TMDB-Profil":" \u2013 \xF6ffnet externe TMDB-Seite";if(r.setAttribute("aria-label",`${n}${o}`),e.logo){let i=document.createElement("img");i.src=e.logo,i.alt=e.name?`${e.name} Logo`:"TMDB Logo",i.loading="lazy",i.decoding="async",i.referrerPolicy="no-referrer",r.appendChild(i)}else r.appendChild(ql(e.name||t.label));return r}function Vl(e){var a,c,l;let t=e==null?void 0:e.tmdbDetail;if(!t)return[];let n=[],r=new Set,o=(u,d)=>{var T,J,Se;if(!u)return;let f=ji[d];if(!f)return;let g=(Se=(J=(T=u.id)!=null?T:u.tmdbId)!=null?J:u.tmdb_id)!=null?Se:"",m=g==null?"":String(g).trim(),p=String(u.name||u.title||"").trim(),h=[u.logo,u.logoPath,u.poster,u.backdrop],b="";for(let Le of h){let Me=nt(Le);if(Me){b=Me;break}}if(!b&&!p)return;let v=[d];m?v.push(m):p?v.push(p.toLowerCase()):b&&v.push(b);let k=v.join(":");if(r.has(k))return;r.add(k);let I=f.path,w=m?`${vn}/${I}/${encodeURIComponent(m)}`:vn;n.push({type:d,name:p,logo:b,link:w,hasSpecificLink:!!m})};if((Array.isArray(t==null?void 0:t.networks)?t.networks:[]).forEach(u=>o(u,"network")),(Array.isArray(t==null?void 0:t.productionCompanies)?t.productionCompanies:[]).forEach(u=>o(u,"company")),t!=null&&t.collection){let u={...t.collection,logo:(a=t.collection)==null?void 0:a.logo,poster:(c=t.collection)==null?void 0:c.poster,backdrop:(l=t.collection)==null?void 0:l.backdrop};o(u,"collection")}return n}function Br(e){return e&&(typeof HTMLElement=="undefined"||e instanceof HTMLElement)?e:null}function Xl(e,t){let n=Br(e==null?void 0:e.footerEl),r=Br(e==null?void 0:e.footerLogosEl),o=Br(e==null?void 0:e.footerNoteEl);if(!n||!r||!o){n&&(n.hidden=!0,n.setAttribute("aria-hidden","true"));return}r.replaceChildren(),o.replaceChildren();let i=Vl(t);if(!i.length){n.hidden=!0,n.setAttribute("aria-hidden","true");return}let s=document.createDocumentFragment();i.forEach(l=>s.appendChild(Wl(l))),r.appendChild(s);let a=document.createElement("a");a.href=vn,a.target="_blank",a.rel="noopener noreferrer",a.textContent="TMDB",a.setAttribute("aria-label","The Movie Database (TMDB) \u2013 externe Seite");let c=document.createElement("strong");c.appendChild(a),o.append("Logos & Daten bereitgestellt von ",c,". Dieses Produkt nutzt die TMDB API, ist jedoch nicht von TMDB zertifiziert oder unterst\xFCtzt."),n.hidden=!1,n.setAttribute("aria-hidden","false")}var vn,ji,Dr=_(()=>{de();vn="https://www.themoviedb.org",ji={network:{path:"network",label:"Netzwerk"},company:{path:"company",label:"Produktionsfirma"},collection:{path:"collection",label:"Sammlung"}}});function Vi(e){return Wi+=1,`${e?`overview-${e}`:"overview-card"}-${Wi}`}function Yl(e){return e?e instanceof HTMLElement?e.classList.contains("v2-overview")?e:e.querySelector(".v2-overview"):(e==null?void 0:e.overview)instanceof HTMLElement?e.overview:null:null}function Jl(e){if(!e)return{expanded:!1};let t=e.querySelector(".v2-overview-text"),n=e.querySelector(".v2-overview-toggle");return{expanded:!!(!!(t!=null&&t.classList.contains("is-expanded"))||(n==null?void 0:n.getAttribute("aria-expanded"))==="true")}}function An(e,t){let n=document.createElement("section");n.className="card",n.dataset.section=t,n.setAttribute("role","group");let r=Vi(t),o=document.createElement("h3");o.className="card-title",o.id=r,o.textContent=e,n.setAttribute("aria-labelledby",r);let i=document.createElement("div");return i.className="card-content",n.append(o,i),{section:n,content:i,heading:o}}function wn(e){let t=document.createElement("p");return t.className="card-empty",t.textContent=e,t}function Zl(e,t){var p;let{section:n,content:r}=An("Handlung","plot"),o=(((p=e==null?void 0:e.tmdbDetail)==null?void 0:p.overview)||"").trim(),i=((e==null?void 0:e.summary)||(e==null?void 0:e.overview)||"").trim(),s=o||i;if(!s)return r.append(wn("Keine Inhaltsangabe verf\xFCgbar.")),{section:n};let a=Vi("plot-text"),c=document.createElement("p");c.className="v2-overview-text line-clamp line-clamp-5",c.id=a,c.textContent=s;let l=document.createElement("button");l.type="button",l.className="v2-overview-toggle",l.setAttribute("aria-controls",a);let u=h=>{c.classList.toggle("is-expanded",h),l.setAttribute("aria-expanded",String(h)),l.textContent=h?"Weniger anzeigen":"Mehr anzeigen"};l.addEventListener("click",()=>{let h=l.getAttribute("aria-expanded")==="true";u(!h)});let d=iu(e,o?"tmdb":"local");if(d){let h=document.createElement("span");h.className="v2-lang-badge",h.textContent=d,h.setAttribute("aria-label",`Sprache: ${d}`),r.appendChild(h)}r.append(c,l);let f=()=>{c.scrollHeight>c.clientHeight+1?l.hidden=!1:(c.classList.add("is-expanded"),l.hidden=!0)},g=typeof requestAnimationFrame=="function"?requestAnimationFrame:h=>setTimeout(h,0);return{section:n,afterRender:()=>{u(!!(t!=null&&t.expanded)),g(f)}}}function Ql(e){var o;let t=Array.isArray(e==null?void 0:e.genres)?e.genres:[],n=Array.isArray((o=e==null?void 0:e.tmdbDetail)==null?void 0:o.genres)?e.tmdbDetail.genres:[],r=[...t,...n].map(i=>i?typeof i=="string"?i:i.tag||i.title||i.name||"":"").filter(Boolean);return Array.from(new Set(r))}function eu(e){let{section:t,content:n}=An("Genres","genres"),r=Ql(e);if(r.length){let o=document.createElement("div");o.className="v2-chip-group",r.forEach(i=>{let s=document.createElement("span");s.className="chip",s.textContent=i,s.setAttribute("aria-label",`Genre: ${i}`),o.appendChild(s)}),n.appendChild(o)}else n.append(wn("Keine Genres vorhanden."));return{section:t}}function tu(e){var a,c,l,u,d;let t=e==null?void 0:e.tmdbDetail;if(!(t!=null&&t.watchProviders))return[];let n=x(),r=(((a=n==null?void 0:n.cfg)==null?void 0:a.iso)||((c=n==null?void 0:n.cfg)==null?void 0:c.region)||"DE").toUpperCase(),o=((l=t.watchProviders)==null?void 0:l[r])||((u=t.watchProviders)==null?void 0:u.DE)||((d=t.watchProviders)==null?void 0:d.default)||null;if(!o)return[];let i=[["flatrate","Streaming"],["rent","Leihen"],["buy","Kaufen"],["free","Kostenlos"],["ads","Mit Werbung"]],s=[];for(let[f,g]of i){let p=(Array.isArray(o[f])?o[f]:[]).map(h=>({id:(h==null?void 0:h.id)||(h==null?void 0:h.provider_id)||(h==null?void 0:h.providerId)||"",name:(h==null?void 0:h.provider_name)||(h==null?void 0:h.name)||"",logo:(h==null?void 0:h.logo)||(h==null?void 0:h.logo_path)||(h==null?void 0:h.logoPath)||""})).filter(h=>h.name);p.length&&s.push({label:g,providers:p})}return s}function nu(e){let{section:t,content:n}=An("Verf\xFCgbarkeit","providers"),r=tu(e);if(r.length){let o=document.createElement("div");o.className="v2-provider-groups",r.forEach(i=>{let s=document.createElement("div");s.className="v2-provider-group";let a=document.createElement("p");a.className="v2-provider-label",a.textContent=i.label;let c=document.createElement("div");c.className="v2-provider-list",i.providers.forEach(l=>{let u=document.createElement("span");if(u.className="v2-provider",u.setAttribute("data-provider",l.id||l.name),l.logo){let f=document.createElement("img");f.src=l.logo,f.alt=l.name,f.loading="lazy",f.decoding="async",u.appendChild(f)}let d=document.createElement("span");d.className="v2-provider-name",d.textContent=l.name,u.appendChild(d),c.appendChild(u)}),s.append(a,c),o.appendChild(s)}),n.appendChild(o)}else n.append(wn("Keine Anbieterinformationen verf\xFCgbar."));return{section:t}}function ru(e){var o;let t=[];Array.isArray((o=e==null?void 0:e.tmdbDetail)==null?void 0:o.spokenLanguages)&&e.tmdbDetail.spokenLanguages.forEach(i=>{let s=String((i==null?void 0:i.name)||"").trim(),a=String((i==null?void 0:i.code)||(i==null?void 0:i.iso6391)||(i==null?void 0:i.iso_639_1)||"").trim();(s||a)&&t.push({name:s,code:a,source:"tmdb"})});let n=[];Array.isArray(e==null?void 0:e.audioLanguages)&&n.push(...e.audioLanguages),Array.isArray(e==null?void 0:e.languages)&&n.push(...e.languages),e!=null&&e.audioLanguage&&n.push(e.audioLanguage),e!=null&&e.language&&n.push(e.language),n.forEach(i=>{let s=String(i||"").trim();s&&t.push({name:s,code:"",source:"local"})});let r=new Set;return t.filter(i=>{let s=i.name.toLowerCase(),a=i.code.toLowerCase(),c=`${s}|${a}`;return r.has(c)?!1:(r.add(c),!0)}).map(i=>({name:i.name,code:i.code,source:i.source}))}function ou(e){let{section:t,content:n}=An("Sprachen","languages"),r=ru(e);if(r.length){let o=document.createElement("div");o.className="v2-chip-group",r.forEach(i=>{let s=document.createElement("span");s.className="chip";let a=[];i.name&&a.push(i.name);let c=i.code?i.code.toUpperCase():"";c&&(!i.name||i.name.toUpperCase()!==c)&&a.push(c);let l=a.join(" \u2022 ")||"Unbekannte Sprache";s.textContent=l,s.setAttribute("aria-label",`Sprache: ${l}`),i.source&&(s.dataset.source=i.source),o.appendChild(s)}),n.appendChild(o)}else n.append(wn("Keine Sprachinformationen verf\xFCgbar."));return{section:t}}function zr(e,t){let n=Yl(e);if(!n)return;let r=Jl(n),o=Zl(t,r),i=eu(t),s=nu(t),a=ou(t),c=document.createElement("div");c.className="grid-2",c.append(o.section,i.section,s.section,a.section),n.replaceChildren(c),[o.afterRender,i.afterRender,s.afterRender,a.afterRender].filter(Boolean).forEach(l=>l())}function iu(e,t){var s,a,c,l,u,d;if(t!=="tmdb")return"";let n=String(((l=(c=(a=(s=e==null?void 0:e.tmdbDetail)==null?void 0:s.raw)==null?void 0:a.spoken_languages)==null?void 0:c[0])==null?void 0:l.iso_639_1)||"").toLowerCase(),r=String(((d=(u=e==null?void 0:e.tmdbDetail)==null?void 0:u.raw)==null?void 0:d.original_language)||"").toLowerCase(),o=String(su()).toLowerCase();return(r||n)==="en"&&o&&!o.startsWith("en")?"EN":""}function su(){var t;let e=x();return(t=e==null?void 0:e.cfg)!=null&&t.lang?e.cfg.lang:"de-DE"}var Wi,Xi=_(()=>{Z();Wi=0});function au(e){return Yi+=1,`${e?`details-${e}`:"details-card"}-${Yi}`}function cu(e){let t=e==null?void 0:e.tmdbDetail,n=[t==null?void 0:t.releaseDate,t==null?void 0:t.firstAirDate,t==null?void 0:t.lastAirDate,e==null?void 0:e.originallyAvailableAt,e==null?void 0:e.releaseDate,e==null?void 0:e.premiereDate,e==null?void 0:e.firstAired,e==null?void 0:e.airDate];for(let o of n){let i=o==null?"":String(o).trim();if(!i)continue;let s=new Date(i);if(Number.isFinite(s.getTime()))try{return s.toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{}let a=i.match(/^\d{4}-\d{2}-\d{2}/);if(a&&a[0])return a[0];if(i.length>=4)return i.slice(0,10)}let r=$(e);return r?String(r):""}function ae(e){return Array.isArray(e)?e.map(t=>t?typeof t=="string"?t:t.tag||t.title||t.name||"":"").filter(Boolean):[]}function Or(e,t){if(!(e!=null&&e.credits)||!Array.isArray(e.credits.crew))return[];let n=Array.isArray(t)?new Set(t):new Set([t]),r=e.credits.crew.filter(o=>o&&n.has(o.job)).map(o=>o.name||o.originalName||o.tag).filter(Boolean);return Array.from(new Set(r))}function fe(...e){let t=new Set,n=[];return e.filter(Array.isArray).forEach(r=>{r.forEach(o=>{let i=String(o||"").trim();if(!i)return;let s=i.toLowerCase();t.has(s)||(t.add(s),n.push(i))})}),n}function lu(e){var n;let t=(((n=e==null?void 0:e.tmdbDetail)==null?void 0:n.contentRating)||"").trim();return t||((e==null?void 0:e.contentRating)||"").trim()}function uu(e){let t=[],n=e==null?void 0:e.tmdbDetail;return n!=null&&n.voteAverage&&t.push(["TMDB",`\u2605 ${Pt(n.voteAverage)}`]),e!=null&&e.rating&&t.push(["Bewertung",`\u2605 ${Pt(e.rating)}`]),e!=null&&e.audienceRating&&t.push(["Publikum",`\u2605 ${Pt(e.audienceRating)}`]),e!=null&&e.userRating&&t.push(["Eigene Wertung",`\u2605 ${Pt(e.userRating)}`]),t}function Pt(e){if(e instanceof Number)return Pt(e.valueOf());if(typeof e=="number")return Number.isFinite(e)?O(e):"";if(typeof e=="string"){let t=e.trim();if(!t)return"";let n=Number(t);return Number.isFinite(n)?O(n):""}return""}function Nt(e,t){let n=document.createElement("section");n.className="card",n.dataset.section=t,n.setAttribute("role","group");let r=au(t),o=document.createElement("h3");o.className="card-title",o.id=r,o.textContent=e,n.setAttribute("aria-labelledby",r);let i=document.createElement("div");return i.className="card-content",n.append(o,i),{section:n,content:i}}function ke(e){let t=document.createElement("p");return t.className="card-empty",t.textContent=e,t}function du(e){var u,d;let{section:t,content:n}=Nt("Allgemein","general"),r=[],o=cu(e);o&&r.push(["Ver\xF6ffentlichung",o]);let i=Sn(e);i&&r.push(["Laufzeit",i]);let s=En(e);s&&r.push(["Studio",s]);let a=lu(e);if(a&&r.push(["Freigabe",a]),uu(e).forEach(f=>{let[g,m]=f;g&&m&&r.push([g,m])}),(e==null?void 0:e.type)==="tv"){let f=Number(e==null?void 0:e.seasonCount),g=Number.isFinite(f)?f:Array.isArray(e==null?void 0:e.seasons)?e.seasons.length:null;Number.isFinite(g)&&g>0&&r.push(["Staffeln",String(g)]);let m=Array.isArray(e==null?void 0:e.seasons)?e.seasons.reduce((p,h)=>{if(!h)return p;let b=Array.isArray(h.episodes)?h.episodes.length:0;return p+(Number.isFinite(b)?b:0)},0):null;Number.isFinite(m)&&m>0&&r.push(["Episoden",String(m)])}let c=fe(ae(e==null?void 0:e.collections),(d=(u=e==null?void 0:e.tmdbDetail)==null?void 0:u.collection)!=null&&d.name?[e.tmdbDetail.collection.name]:[]);c.length&&r.push(["Sammlungen",c.join(", ")]);let l=ae(e==null?void 0:e.labels);if(l.length&&r.push(["Labels",l.join(", ")]),e!=null&&e.editionTitle&&r.push(["Edition",e.editionTitle]),e!=null&&e.originalTitle&&e.originalTitle!==e.title&&r.push(["Originaltitel",e.originalTitle]),r.length){let f=document.createElement("dl");f.className="card-definition-list",r.forEach(([g,m])=>{if(!g||!m)return;let p=document.createElement("dt");p.textContent=g;let h=document.createElement("dd");h.textContent=m,f.append(p,h)}),f.childElementCount?n.appendChild(f):n.append(ke("Keine allgemeinen Details verf\xFCgbar."))}else n.append(ke("Keine allgemeinen Details verf\xFCgbar."));return{section:t}}function fu(e){var c;let{section:t,content:n}=Nt("Credits","credits"),r=[],o=fe(ae(e==null?void 0:e.directors),Or(e==null?void 0:e.tmdbDetail,["Director"]));o.length&&r.push(["Regie",o.join(", ")]);let i=fe(ae(e==null?void 0:e.writers),Or(e==null?void 0:e.tmdbDetail,["Writer","Screenplay","Story"]));i.length&&r.push(["Drehbuch",i.join(", ")]);let s=fe(ae(e==null?void 0:e.producers),Or(e==null?void 0:e.tmdbDetail,["Producer","Executive Producer"]));s.length&&r.push(["Produktion",s.join(", ")]);let a=fe(ae((e==null?void 0:e.creators)||(e==null?void 0:e.showrunners)),Array.isArray((c=e==null?void 0:e.tmdbDetail)==null?void 0:c.createdBy)?e.tmdbDetail.createdBy.map(l=>(l==null?void 0:l.name)||""):[]);if((e==null?void 0:e.type)==="tv"&&a.length&&r.push(["Creator",a.join(", ")]),r.length){let l=document.createElement("div");l.className="credits-grid",r.forEach(([u,d])=>{if(!u||!d)return;let f=document.createElement("div");f.className="credit-item";let g=document.createElement("p");g.className="credit-label",g.textContent=u;let m=document.createElement("p");m.className="credit-value",m.textContent=d,f.append(g,m),l.appendChild(f)}),l.childElementCount?n.appendChild(l):n.append(ke("Keine Credits verf\xFCgbar."))}else n.append(ke("Keine Credits verf\xFCgbar."));return{section:t}}function gu(e){var s;let{section:t,content:n}=Nt("Produktionsfirmen","companies"),r=fe(ae(e==null?void 0:e.studios),e!=null&&e.studio?[e.studio]:[]),o=ae((s=e==null?void 0:e.tmdbDetail)==null?void 0:s.productionCompanies),i=fe(r,o);if(i.length){let a=document.createElement("ul");a.className="card-list",i.forEach(c=>{let l=document.createElement("li");l.textContent=c,a.appendChild(l)}),n.appendChild(a)}else n.append(ke("Keine Produktionsfirmen hinterlegt."));return{section:t}}function hu(e){var s,a;let{section:t,content:n}=Nt("L\xE4nder","countries"),r=fe(ae(e==null?void 0:e.countries),ae((s=e==null?void 0:e.tmdbDetail)==null?void 0:s.productionCountries)),o=fe(Array.isArray((a=e==null?void 0:e.tmdbDetail)==null?void 0:a.originCountry)?e.tmdbDetail.originCountry:[],e!=null&&e.country?[e.country]:[]),i=[];if(r.length&&i.push(["Produktion",r]),o.length&&i.push(["Original",o]),i.length){let c=document.createElement("div");c.className="card-stack",i.forEach(([l,u])=>{let d=document.createElement("div");d.className="card-subsection";let f=document.createElement("p");f.className="card-subtitle",f.textContent=l;let g=document.createElement("p");g.className="card-meta",g.textContent=u.join(", "),d.append(f,g),c.appendChild(d)}),n.appendChild(c)}else n.append(ke("Keine L\xE4nderinformationen verf\xFCgbar."));return{section:t}}function mu(e){var o,i;let t=[],n=(s,a,c)=>{let l=String(s||"").trim(),u=String(a||"").trim();l&&t.push({logo:l,name:u||"Unbenannt",type:c})};Array.isArray((o=e==null?void 0:e.tmdbDetail)==null?void 0:o.networks)&&e.tmdbDetail.networks.forEach(s=>{n((s==null?void 0:s.logo)||(s==null?void 0:s.logoPath)||(s==null?void 0:s.logo_path)||"",(s==null?void 0:s.name)||"","network")}),Array.isArray((i=e==null?void 0:e.tmdbDetail)==null?void 0:i.productionCompanies)&&e.tmdbDetail.productionCompanies.forEach(s=>{n((s==null?void 0:s.logo)||(s==null?void 0:s.logoPath)||(s==null?void 0:s.logo_path)||"",(s==null?void 0:s.name)||"","company")});let r=new Set;return t.filter(s=>{let a=`${s.logo}|${s.name}`.toLowerCase();return r.has(a)?!1:(r.add(a),!0)})}function pu(e){let{section:t,content:n}=Nt("Logos","logos"),r=mu(e);if(r.length){let o=document.createElement("ul");o.className="logo-grid",r.forEach(i=>{let s=document.createElement("li");if(s.className="logo-grid-item",i.logo){let c=document.createElement("img");c.src=i.logo,c.alt=i.name||"Logo",c.loading="lazy",c.decoding="async",s.appendChild(c)}let a=document.createElement("span");a.textContent=i.name||"Unbekannt",s.appendChild(a),o.appendChild(s)}),n.appendChild(o)}else n.append(ke("Keine Logos verf\xFCgbar."));return{section:t}}function bu(e){return e?e instanceof HTMLElement?e.classList.contains("v2-details")?e:e.querySelector(".v2-details"):(e==null?void 0:e.details)instanceof HTMLElement?e.details:null:null}function yu(e,t){e.replaceChildren();let n=[du(t),fu(t),gu(t),hu(t),pu(t)],r=document.createElement("div");r.className="grid-2",n.forEach(o=>{o!=null&&o.section&&r.appendChild(o.section)}),r.childElementCount?e.appendChild(r):e.appendChild(ke("Keine zus\xE4tzlichen Details verf\xFCgbar."))}function jr(e,t){let n=bu(e);n&&yu(n,t)}var Yi,Ji=_(()=>{de();Dr();Yi=0});function kn(){return Date.now()}function Su(e){let t=Number(e),n=Number.isFinite(t)?t:24;return Math.max(.01,n)*60*60*1e3}function Eu(e){try{return JSON.parse(e)}catch{return[]}}function Au(e){try{return JSON.stringify(e)}catch{return"[]"}}function Zi({storageKey:e=vu}={}){let t=new Map,n=!1;function r(){if(n||(n=!0,typeof localStorage=="undefined"))return;let u;try{if(u=localStorage.getItem(e),!u){t=new Map;return}}catch{t=new Map;return}let d=Eu(u),f=new Map,g=kn();if(Array.isArray(d))for(let m of d){if(!Array.isArray(m)||m.length<2)continue;let[p,h]=m;if(!p||!h)continue;let b=Number(h.expiresAt);Number.isFinite(b)&&b>g&&f.set(String(p),{value:h.value,expiresAt:b})}t=f}function o(){if(typeof localStorage=="undefined")return;let u=Array.from(t.entries()).map(([d,f])=>[d,{value:f.value,expiresAt:f.expiresAt}]);try{localStorage.setItem(e,Au(u))}catch{}}function i(u){if(!u)return null;r();let d=t.get(String(u));return d?Number.isFinite(d.expiresAt)&&d.expiresAt<=kn()?(t.delete(String(u)),o(),null):d.value:null}function s(u,d,f=24){if(!u)return d;r();let g=kn()+Su(f);return t.set(String(u),{value:d,expiresAt:g}),o(),d}function a(u){if(r(),!u){t.clear(),o();return}let d=String(u),f=!1;for(let g of t.keys())g.startsWith(d)&&(t.delete(g),f=!0);f&&o()}function c(){r();let u=kn(),d=!1;for(let[f,g]of t.entries())Number.isFinite(g.expiresAt)&&g.expiresAt<=u&&(t.delete(f),d=!0);return d&&o(),d}function l(){return r(),t.size}return{get:i,set:s,clear:a,clearExpired:c,size:l}}function wu(e){return Bt.get(e)}function ku(e,t,n){return Bt.set(e,t,n)}function Kr(e){return Bt.clear(e)}function Cu(){return Bt.clearExpired()}function Tu(){return Bt.size()}function rt(e){return Zi(e)}var vu,Bt,Qi,Cn=_(()=>{vu="tmdb.metadata.cache.v1";Bt=Zi();Qi={get:wu,set:ku,clear:Kr,clearExpired:Cu,size:Tu,createCacheStore:rt}});function ts(e){return new Promise(t=>setTimeout(t,Math.max(0,e||0)))}function _u(e){if(!e)return null;let t=Number(e);if(Number.isFinite(t))return t*1e3;let n=Date.parse(e);return Number.isFinite(n)?Math.max(0,n-Date.now()):null}function ns(e,t){if(Number.isFinite(t)&&t>0)return Math.min(t,es);let n=Math.pow(2,Math.max(0,e));return Math.min(es,xu*n)}function Ur(e){return e?Array.isArray(e)?e.filter(Boolean).join(","):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean).join(","):"":""}function Iu(e={}){var r,o,i,s;let t=[e.token,e.tmdbToken,(r=e==null?void 0:e.credentials)==null?void 0:r.token,(o=e==null?void 0:e.settings)==null?void 0:o.tmdbToken].find(a=>typeof a=="string"&&a.trim());if(t)return{kind:"bearer",value:t.trim()};let n=[e.apiKey,e.tmdbApiKey,(i=e==null?void 0:e.credentials)==null?void 0:i.apiKey,(s=e==null?void 0:e.settings)==null?void 0:s.tmdbApiKey].find(a=>typeof a=="string"&&a.trim());if(n)return{kind:"apikey",value:n.trim()};if(typeof localStorage!="undefined")try{let a=localStorage.getItem("tmdbToken");if(a&&a.trim())return{kind:"bearer",value:a.trim()}}catch{}return{kind:"none",value:""}}function Lu(e){let t={Accept:"application/json;charset=utf-8"};return(e==null?void 0:e.kind)==="bearer"&&e.value&&(t.Authorization=`Bearer ${e.value}`),{headers:t}}function Mu(e,t){if((t==null?void 0:t.kind)!=="apikey"||!t.value)return e;let n=new URL(e);return n.searchParams.set("api_key",t.value),n.toString()}function Fu(e,t,n){let r=String(n.apiBase||rs).replace(/\/$/,""),o=e.startsWith("/")?e:`/${e}`,i=new URL(`${r}${o}`),s=i.searchParams,a=Ur(t.append_to_response);a&&s.set("append_to_response",a);let c=t.language||n.language||os;c&&s.set("language",c);let l=t.region||n.region||is;l&&s.set("region",l);for(let[u,d]of Object.entries(t))if(d!=null&&!(u==="append_to_response"||u==="language"||u==="region")){if(Array.isArray(d)){d.length&&s.set(u,d.join(","));continue}s.set(u,String(d))}return i.toString()}async function Pu(e,t,{retries:n=ss}={}){let r=0,o=null;for(;r<=n;)try{let i=await fetch(e,t);if(i.status===204)return null;if(i.status===429&&r<n){let a=_u(i.headers.get("Retry-After"));await ts(ns(r,a)),r+=1;continue}if(!i.ok){let a=new Error(`TMDB request failed with status ${i.status}`);a.status=i.status,a.url=e;try{a.body=await i.text()}catch{a.body=null}throw a}return await i.json()}catch(i){if(o=i,r>=n)break;await ts(ns(r,null)),r+=1}throw o||new Error("TMDB request failed")}function Gr(e={}){let t=e.cache instanceof Map?e.cache:null,n={apiBase:e.apiBase||rs,language:e.language||os,region:e.region||is,ttlHours:e.ttlHours||e.ttl||0},r=Iu(e),o=e.cacheStore||(e.useCache?rt():null);function i(a,c){if(!t&&!o)return"";let l=Object.keys(c).sort().map(u=>`${u}=${JSON.stringify(c[u])}`).join("&");return`${a}?${l}`}async function s(a,c={},l={}){var h;let u={...c};if(l.append){let b=Ur(u.append_to_response),v=Ur(l.append),k=[b,v].filter(Boolean).join(",");k&&(u.append_to_response=k)}l.language&&(u.language=l.language),l.region&&(u.region=l.region);let d=Fu(a,u,n),f=Mu(d,r),g=Lu(r),m=i(a,u);if(m){if(t&&t.has(m))return t.get(m);if(o){let b=o.get(m);if(b)return b}}let p=await Pu(f,g,{retries:(h=l.retries)!=null?h:ss});if(m&&(t&&t.set(m,p),o))try{o.set(m,p,e.ttlHours||0)}catch{}return p}return{get:s,get credential(){return r},get config(){return{...n}}}}var rs,os,is,ss,xu,es,ym,as=_(()=>{Cn();rs="https://api.themoviedb.org/3",os="de-DE",is="DE",ss=4,xu=500,es=1e4;ym=Gr()});function Nu(e){let t=String(e||qr).trim();return t?t.replace(/\/$/,""):qr}function Bu(e){if(!e)return"";let t=String(e);return t?t.startsWith("/")?t:`/${t}`:""}function Rt(e,t,n){let r=Bu(e);return r?`${Nu(n)}/${t}${r}`:""}function Hu(e){return`data:image/svg+xml,${encodeURIComponent(e)}`}function Ru(e){switch(e){case"poster":return"#1f2933";case"profile":return"#111827";case"logo":return"#0f172a";case"episode":return"#0b1120";default:return"#101827"}}function $u(e){return e==="logo"?"#e5e7eb":"#f9fafb"}function ze(e,t=2){let n=String(e||"").trim();if(!n)return"";let r=n.split(/\s+/u).filter(Boolean);return r.length?r.slice(0,t).map(i=>i.charAt(0)).join("").toUpperCase():n.slice(0,t).toUpperCase()}function $t({type:e,text:t="",width:n,height:r,fontSize:o,fontWeight:i="600",radius:s=0}){let a=Ru(e),c=$u(e),l=ze(t,2)||"\u2205",u=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${r}" viewBox="0 0 ${n} ${r}">
  <rect x="0" y="0" width="${n}" height="${r}" rx="${s}" ry="${s}" fill="${a}"/>
  <text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" fill="${c}" font-family="'Inter', 'Segoe UI', sans-serif" font-size="${o}" font-weight="${i}" letter-spacing="0.08em">${l}</text>
</svg>`;return Hu(u)}function Du(e){return $t({type:"poster",text:e,width:500,height:750,fontSize:140,radius:24})}function zu(e){return $t({type:"backdrop",text:e,width:780,height:439,fontSize:120,radius:16})}function Ou(e){return $t({type:"profile",text:e,width:400,height:600,fontSize:140,radius:32})}function ju(e){return $t({type:"logo",text:e,width:500,height:281,fontSize:96,radius:24})}function Ku(e){return $t({type:"episode",text:e,width:780,height:439,fontSize:110,radius:24})}function Dt(e){var t,n,r,o;return{imageBase:(n=(t=e==null?void 0:e.imageBase)!=null?t:e==null?void 0:e.base)!=null?n:qr,title:(o=(r=e==null?void 0:e.title)!=null?r:e==null?void 0:e.fallbackTitle)!=null?o:"",size:e==null?void 0:e.size}}function Ce(e,t={}){let{imageBase:n,title:r,size:o}=Dt(t);return Rt(e,o||Ht.poster,n)||Du(r)}function ot(e,t={}){let{imageBase:n,title:r,size:o}=Dt(t);return Rt(e,o||Ht.backdrop,n)||zu(r)}function Tn(e,t={}){let{imageBase:n,title:r,size:o}=Dt(t);return Rt(e,o||Ht.profile,n)||Ou(r)}function zt(e,t={}){let{imageBase:n,title:r,size:o}=Dt(t);return Rt(e,o||Ht.logo,n)||ju(r)}function Ot(e,t={}){let{imageBase:n,title:r,size:o}=Dt(t);return Rt(e,o||Ht.episode,n)||Ku(r)}var qr,Ht,Wr=_(()=>{qr="https://image.tmdb.org/t/p",Ht={poster:"w500",backdrop:"w780",profile:"h632",logo:"w500",episode:"w780"}});function Oe(e={}){return{...Uu,...e}}function W(e){if(e==null)return"";let t=Number(e);if(Number.isFinite(t)&&t>0)return String(Math.floor(t));let n=String(e).trim();if(/^\d+$/.test(n)){let r=parseInt(n,10);if(r>0)return String(r)}return""}function Gu(e){let t=Number(e.vote_count||e.voteCount||0);return Number(e.vote_average||e.voteAverage||0)*10+t}function cs(e){if(!e)return"any";let t=String(e).toLowerCase();return t==="xx"||t==="null"?"any":t}function it(e=[],{preferredLanguages:t=["de","en","any"],fallbackPath:n=""}={}){if(!Array.isArray(e)||e.length===0)return n||"";let r=e.filter(o=>o&&o.file_path).map(o=>({...o,language:cs(o.iso_639_1||o.language||""),score:Gu(o)})).sort((o,i)=>i.score-o.score);for(let o of t){let i=r.find(s=>s.language===cs(o));if(i)return i.file_path||n||""}return r.length?r[0].file_path||n||"":n||""}function qu(e,t){if(!(e!=null&&e.belongs_to_collection))return null;let n=e.belongs_to_collection;return{id:W(n.id),name:n.name||"",poster:Ce(n.poster_path,{imageBase:t.imageBase,size:t.posterSize,title:n.name}),backdrop:ot(n.backdrop_path,{imageBase:t.imageBase,size:t.backdropSize,title:n.name})}}function ls(e){return Array.isArray(e)?e.map(t=>t&&(t.name||t.title||t.tag)).filter(Boolean).map(String):[]}function us(e,t){return Array.isArray(e)?e.map(n=>({id:W(n==null?void 0:n.id),name:(n==null?void 0:n.name)||"",originCountry:(n==null?void 0:n.origin_country)||"",logo:zt(n==null?void 0:n.logo_path,{imageBase:t.imageBase,size:t.logoSize,title:n==null?void 0:n.name})})):[]}function Wu(e,t){var i,s,a;if(!e)return null;let n=Oe(t),r=W((i=e.provider_id)!=null?i:e.id),o=e.provider_name||e.name||"";return o?{id:r,providerId:r,name:o,logoPath:e.logo_path||"",logo:zt(e.logo_path,{imageBase:n.imageBase,size:n.logoSize,title:o}),displayPriority:(a=(s=e.display_priority)!=null?s:e.displayPriority)!=null?a:null}:null}function Vu(e,t){if(!e)return null;let n=Oe(t),r=["flatrate","rent","buy","free","ads"],o={link:e.link||""};for(let i of r){let s=Array.isArray(e[i])?e[i]:[];o[i]=s.map(a=>Wu(a,n)).filter(Boolean)}return o}function ds(e,t={}){let n=Oe(t),r=e==null?void 0:e.results;if(!r||typeof r!="object")return{};let o={};for(let[s,a]of Object.entries(r)){let c=String(s||"").toUpperCase();if(!c)continue;let l=Vu(a,n);l&&(o[c]=l)}let i=String(t.region||n.region||"").toUpperCase();return i&&o[i]&&(o.default=o[i]),o}function Xu(e,t){return Array.isArray(e)?e.map(n=>({id:W(n==null?void 0:n.id),name:(n==null?void 0:n.name)||"",logo:zt(n==null?void 0:n.logo_path,{imageBase:t.imageBase,size:t.logoSize,title:n==null?void 0:n.name}),originCountry:(n==null?void 0:n.origin_country)||""})):[]}function Yu(e,t){return Array.isArray(e)?e.map(n=>{var r,o;return{id:W(n==null?void 0:n.id),name:(n==null?void 0:n.name)||"",seasonNumber:(r=n==null?void 0:n.season_number)!=null?r:null,episodeCount:(o=n==null?void 0:n.episode_count)!=null?o:null,airDate:(n==null?void 0:n.air_date)||"",poster:Ce(n==null?void 0:n.poster_path,{imageBase:t.imageBase,size:t.posterSize,title:n==null?void 0:n.name})}}):[]}function Ju(e){return Array.isArray(e)?e.map(t=>({code:(t==null?void 0:t.iso_639_1)||"",name:(t==null?void 0:t.english_name)||(t==null?void 0:t.name)||""})):[]}function Zu(e){if(e!=null&&e.character)return e.character;if(Array.isArray(e==null?void 0:e.roles)&&e.roles.length){let t=e.roles.find(n=>n==null?void 0:n.character)||e.roles[0];return(t==null?void 0:t.character)||""}return""}function Qu(e){if(e!=null&&e.job)return e.job;if(Array.isArray(e==null?void 0:e.jobs)&&e.jobs.length){let t=e.jobs.find(n=>n==null?void 0:n.job)||e.jobs[0];return(t==null?void 0:t.job)||""}return""}function jt(e,t={}){var a,c;let n=Oe(t);if(!e)return{cast:[],crew:[]};let r=Array.isArray(e.cast)&&e.cast.length?e.cast:Array.isArray((a=e==null?void 0:e.aggregate)==null?void 0:a.cast)?e.aggregate.cast:[],o=Array.isArray(e.crew)&&e.crew.length?e.crew:Array.isArray((c=e==null?void 0:e.aggregate)==null?void 0:c.crew)?e.aggregate.crew:[],i=r.slice(0,n.castLimit).map(l=>{var u;return{id:W(l==null?void 0:l.id),name:(l==null?void 0:l.name)||(l==null?void 0:l.original_name)||"",character:Zu(l),order:(u=l==null?void 0:l.order)!=null?u:0,profile:Tn(l==null?void 0:l.profile_path,{imageBase:n.imageBase,size:n.profileSize,title:l==null?void 0:l.name}),initials:ze((l==null?void 0:l.name)||(l==null?void 0:l.original_name)||""),knownForDepartment:(l==null?void 0:l.known_for_department)||""}}),s=o.slice(0,n.crewLimit).map(l=>({id:W(l==null?void 0:l.id),name:(l==null?void 0:l.name)||(l==null?void 0:l.original_name)||"",job:Qu(l),department:(l==null?void 0:l.department)||"",profile:Tn(l==null?void 0:l.profile_path,{imageBase:n.imageBase,size:n.profileSize,title:l==null?void 0:l.name}),initials:ze((l==null?void 0:l.name)||(l==null?void 0:l.original_name)||"")}));return{cast:i,crew:s}}function ed(e=[]){let t=["DE","AT","CH","US"];for(let n of t){let r=e.find(s=>(s==null?void 0:s.iso_3166_1)===n);if(!r)continue;let i=(Array.isArray(r.release_dates)?r.release_dates:[]).filter(s=>s&&typeof s.certification=="string"&&s.certification.trim()).sort((s,a)=>{var f,g;let c=(f=s.type)!=null?f:0,l=(g=a.type)!=null?g:0;if(c!==l)return c-l;let u=Date.parse(s.release_date||"")||0,d=Date.parse(a.release_date||"")||0;return u-d});if(i.length)return i[0].certification.trim()}return""}function fs(e={}){var t,n;if((t=e.release_dates)!=null&&t.results){let r=ed(e.release_dates.results);if(r)return r}if((n=e.content_ratings)!=null&&n.results){let r=Array.isArray(e.content_ratings.results)?e.content_ratings.results:[],o=r.find(s=>(s==null?void 0:s.iso_3166_1)==="DE"&&(s==null?void 0:s.rating));if(o)return String(o.rating).trim();let i=r.find(s=>(s==null?void 0:s.iso_3166_1)==="US"&&(s==null?void 0:s.rating));if(i)return String(i.rating).trim()}return""}function Kt(e=[],t){return Array.isArray(e)?e.filter(n=>n&&n.file_path).map(t):[]}function gs(e,t={}){var i,s,a,c;if(!e)return null;let n=Oe(t),r=it((i=e.images)==null?void 0:i.posters,{fallbackPath:e.poster_path}),o=it((s=e.images)==null?void 0:s.backdrops,{fallbackPath:e.backdrop_path,preferredLanguages:["de","en","any"]});return{type:"movie",id:W(e.id),title:e.title||e.original_title||"",originalTitle:e.original_title||"",overview:e.overview||"",tagline:e.tagline||"",releaseDate:e.release_date||"",runtime:Number(e.runtime)||null,status:e.status||"",homepage:e.homepage||"",imdbId:e.imdb_id||"",collection:qu(e,n),poster:Ce(r,{imageBase:n.imageBase,size:n.posterSize,title:e.title}),posterPath:r,backdrop:ot(o,{imageBase:n.imageBase,size:n.backdropSize,title:e.title}),backdropPath:o,genres:ls(e.genres),voteAverage:Number(e.vote_average)||0,voteCount:Number(e.vote_count)||0,popularity:Number(e.popularity)||0,productionCountries:Array.isArray(e.production_countries)?e.production_countries.map(l=>(l==null?void 0:l.iso_3166_1)||(l==null?void 0:l.name)||"").filter(Boolean):[],productionCompanies:us(e.production_companies,n),spokenLanguages:Ju(e.spoken_languages),contentRating:fs(e),credits:jt(e.credits,n),images:{posters:Kt((a=e.images)==null?void 0:a.posters,l=>({path:l.file_path,url:Ce(l.file_path,{imageBase:n.imageBase,size:n.posterSize,title:e.title}),width:l.width,height:l.height,voteAverage:l.vote_average,voteCount:l.vote_count,language:l.iso_639_1||""})),backdrops:Kt((c=e.images)==null?void 0:c.backdrops,l=>({path:l.file_path,url:ot(l.file_path,{imageBase:n.imageBase,size:n.backdropSize,title:e.title}),width:l.width,height:l.height,voteAverage:l.vote_average,voteCount:l.vote_count,language:l.iso_639_1||""}))},watchProviders:ds(e["watch/providers"],n),url:e.id?`https://www.themoviedb.org/movie/${e.id}`:"",raw:e}}function hs(e,t={}){var i,s,a,c,l;if(!e)return null;let n=Oe(t),r=it((i=e.images)==null?void 0:i.posters,{fallbackPath:e.poster_path}),o=it((s=e.images)==null?void 0:s.backdrops,{fallbackPath:e.backdrop_path,preferredLanguages:["de","en","any"]});return{type:"tv",id:W(e.id),name:e.name||e.original_name||"",originalName:e.original_name||"",overview:e.overview||"",tagline:e.tagline||"",firstAirDate:e.first_air_date||"",lastAirDate:e.last_air_date||"",numberOfEpisodes:Number(e.number_of_episodes)||0,numberOfSeasons:Number(e.number_of_seasons)||0,status:e.status||"",homepage:e.homepage||"",inProduction:!!e.in_production,poster:Ce(r,{imageBase:n.imageBase,size:n.posterSize,title:e.name}),posterPath:r,backdrop:ot(o,{imageBase:n.imageBase,size:n.backdropSize,title:e.name}),backdropPath:o,genres:ls(e.genres),voteAverage:Number(e.vote_average)||0,voteCount:Number(e.vote_count)||0,popularity:Number(e.popularity)||0,createdBy:Array.isArray(e.created_by)?e.created_by.map(u=>({id:W(u==null?void 0:u.id),name:(u==null?void 0:u.name)||"",profile:Tn(u==null?void 0:u.profile_path,{imageBase:n.imageBase,size:n.profileSize,title:u==null?void 0:u.name}),initials:ze((u==null?void 0:u.name)||"")})):[],networks:Xu(e.networks,n),productionCompanies:us(e.production_companies,n),seasons:Yu(e.seasons,n),contentRating:fs(e),credits:jt(e.aggregate_credits||e.credits,n),images:{posters:Kt((a=e.images)==null?void 0:a.posters,u=>({path:u.file_path,url:Ce(u.file_path,{imageBase:n.imageBase,size:n.posterSize,title:e.name}),width:u.width,height:u.height,voteAverage:u.vote_average,voteCount:u.vote_count,language:u.iso_639_1||""})),backdrops:Kt((c=e.images)==null?void 0:c.backdrops,u=>({path:u.file_path,url:ot(u.file_path,{imageBase:n.imageBase,size:n.backdropSize,title:e.name}),width:u.width,height:u.height,voteAverage:u.vote_average,voteCount:u.vote_count,language:u.iso_639_1||""})),logos:Kt((l=e.images)==null?void 0:l.logos,u=>({path:u.file_path,url:zt(u.file_path,{imageBase:n.imageBase,size:n.logoSize,title:e.name}),width:u.width,height:u.height,language:u.iso_639_1||""}))},watchProviders:ds(e["watch/providers"],n),url:e.id?`https://www.themoviedb.org/tv/${e.id}`:"",raw:e}}function ms(e,t={}){var s,a,c;if(!e)return null;let n=Oe(t),r=t.show||{},o=it((s=e.images)==null?void 0:s.posters,{fallbackPath:e.poster_path}),i=Array.isArray(e.episodes)?e.episodes.map(l=>{var d,f,g,m;let u=it((d=l==null?void 0:l.images)==null?void 0:d.stills,{fallbackPath:l==null?void 0:l.still_path});return{id:W(l==null?void 0:l.id),episodeNumber:(f=l==null?void 0:l.episode_number)!=null?f:null,seasonNumber:(m=(g=l==null?void 0:l.season_number)!=null?g:e.season_number)!=null?m:null,name:(l==null?void 0:l.name)||"",overview:(l==null?void 0:l.overview)||"",airDate:(l==null?void 0:l.air_date)||"",runtime:Number(l==null?void 0:l.runtime)||null,voteAverage:Number(l==null?void 0:l.vote_average)||0,voteCount:Number(l==null?void 0:l.vote_count)||0,still:Ot(u,{imageBase:n.imageBase,size:n.stillSize,title:(l==null?void 0:l.name)||e.name}),stillPath:u,crew:jt({crew:(l==null?void 0:l.crew)||[]},n).crew,guestStars:jt({cast:(l==null?void 0:l.guest_stars)||[]},{...n,castLimit:10}).cast}}):[];return{type:"season",id:W(e.id),showId:W(r.id||e.show_id||""),name:e.name||"",overview:e.overview||"",airDate:e.air_date||"",seasonNumber:(a=e.season_number)!=null?a:null,episodeCount:e.episodes?e.episodes.length:e.episode_count||0,poster:Ce(o,{imageBase:n.imageBase,size:n.posterSize,title:e.name||r.name}),posterPath:o,episodes:i,credits:jt(e.credits,n),url:r.id?`https://www.themoviedb.org/tv/${r.id}/season/${(c=e.season_number)!=null?c:""}`:"",raw:e}}var Uu,ps=_(()=>{Wr();Uu={imageBase:"https://image.tmdb.org/t/p",posterSize:"w500",backdropSize:"w780",profileSize:"h632",logoSize:"w500",stillSize:"w780",castLimit:20,crewLimit:40,region:"DE"}});function nd(e={}){return{apiKey:e.apiKey||e.tmdbApiKey||"",token:e.token||e.tmdbToken||"",language:e.language||e.lang||"de-DE",region:e.region||e.iso||"DE",imageBase:e.imageBase||td,ttlHours:Number(e.ttlHours||e.ttl||bs)||bs}}function rd(){return{warn(...e){try{}catch{}}}}function ys(e){return e?Array.isArray(e)?e:String(e).split(",").map(t=>t.trim()).filter(Boolean):[]}function Vr(e,t){let n=new Set([...ys(e),...ys(t)]);return n.size?Array.from(n).join(","):""}function od(e,t,n,r){let o={movie:"images,credits,release_dates,watch/providers",tv:"images,content_ratings,aggregate_credits,credits,watch/providers",season:"images,credits"};async function i(l,u,d){try{let g=t.get(l);if(g)return g}catch(g){r.warn("Cache read failed for",l,(g==null?void 0:g.message)||g)}let f=null;try{f=await d()}catch(g){throw r.warn("Request failed for",l,(g==null?void 0:g.message)||g),g}try{f!=null&&t.set(l,f,u)}catch(g){r.warn("Cache write failed for",l,(g==null?void 0:g.message)||g)}return f}async function s(l,u={}){var m;let d=l!=null?l:u.id;if(d==null)return null;let f=`tmdb:movie:${d}:v1`,g=(m=u.ttlHours)!=null?m:n.ttlHours;return i(f,g,async()=>{var b,v,k;let p=Vr(o.movie,u.append),h=await e.get(`/movie/${d}`,{append_to_response:p},{language:(b=u.language)!=null?b:n.language,region:(v=u.region)!=null?v:n.region});return gs(h,{imageBase:n.imageBase,posterSize:u.posterSize,backdropSize:u.backdropSize,profileSize:u.profileSize,logoSize:u.logoSize,region:(k=u.region)!=null?k:n.region})})}async function a(l,u={}){var m;let d=l!=null?l:u.id;if(d==null)return null;let f=`tmdb:tv:${d}:v1`,g=(m=u.ttlHours)!=null?m:n.ttlHours;return i(f,g,async()=>{var b,v,k;let p=Vr(o.tv,u.append),h=await e.get(`/tv/${d}`,{append_to_response:p},{language:(b=u.language)!=null?b:n.language,region:(v=u.region)!=null?v:n.region});return hs(h,{imageBase:n.imageBase,posterSize:u.posterSize,backdropSize:u.backdropSize,profileSize:u.profileSize,logoSize:u.logoSize,region:(k=u.region)!=null?k:n.region})})}async function c(l,u,d={}){var m;if(l==null||u==null)return null;let f=`tmdb:tv:${l}:season:${u}:v1`,g=(m=d.ttlHours)!=null?m:n.ttlHours;return i(f,g,async()=>{var v,k;let p=Vr(o.season,d.append),h=await e.get(`/tv/${l}/season/${u}`,{append_to_response:p},{language:(v=d.language)!=null?v:n.language,region:(k=d.region)!=null?k:n.region}),b=d.show||null;if(!b&&!d.skipShowLookup)try{b=await a(l,{ttlHours:g})}catch(I){r.warn("Failed to load parent show for season",l,u,(I==null?void 0:I.message)||I),b={id:l,name:"",type:"tv"}}return b||(b={id:l,name:"",type:"tv"}),ms(h,{imageBase:n.imageBase,posterSize:d.posterSize,backdropSize:d.backdropSize,profileSize:d.profileSize,logoSize:d.logoSize,show:b})})}return{getMovieEnriched:s,getTvEnriched:a,getSeasonEnriched:c}}function xn(e={}){let t=nd(e),n=e.cacheStore||rt({storageKey:e.storageKey}),r=Gr({apiBase:e.apiBase||t.apiBase,apiKey:t.apiKey,token:t.token,language:t.language,region:t.region,ttlHours:t.ttlHours}),o=rd(),i=od(r,n,t,o);return{getMovieEnriched:i.getMovieEnriched,getTvEnriched:i.getTvEnriched,getSeasonEnriched:i.getSeasonEnriched,get client(){return r},get cache(){return n},get config(){return{...t}},clear(s){n.clear(s)}}}function vs(){return Xr||(Xr=rt()),Xr}function ge(){return Ut||(Ut=xn({cacheStore:vs()})),Ut}function Ss(e={}){let t={...e};return t.cacheStore||(t.cacheStore=vs()),Ut=xn(t),Ut}function id(){try{let e=localStorage.getItem("tmdbToken");if(e&&e.trim())return e.trim()}catch{}return""}function st(e={},t={}){try{let{preferStoredToken:n=!0,token:r,apiKey:o,language:i,region:s,ttlHours:a,imageBase:c}=t||{},l={},u=i||e.lang||e.language;u&&(l.language=u);let d=s||e.region||e.iso;d&&(l.region=d);let f=[a,e.ttlHours,e.tmdbTtlHours];for(let h of f){if(h==null||typeof h=="string"&&h.trim()==="")continue;let b=Number(h);if(Number.isFinite(b)){l.ttlHours=b;break}}let g=c||e.imageBase||e.tmdbImageBase;g&&(l.imageBase=g);let m=typeof r=="string"?r.trim():r!=null?r:"";typeof m!="string"&&(m=""),!m&&n&&(m=id()),!m&&typeof e.tmdbToken=="string"&&(m=e.tmdbToken.trim());let p=typeof o=="string"?o.trim():o!=null?o:"";typeof p!="string"&&(p=""),!p&&typeof e.tmdbApiKey=="string"&&(p=e.tmdbApiKey.trim()),m?l.token=m:p&&(l.apiKey=p),Ss(l)}catch{}}var bs,td,Xr,Ut,Es,As,ws,Yr,at=_(()=>{Cn();as();ps();bs=24,td="https://image.tmdb.org/t/p";Xr=null,Ut=null;Es=(...e)=>ge().getMovieEnriched(...e),As=(...e)=>ge().getTvEnriched(...e),ws={getMovieEnriched:(...e)=>ge().getMovieEnriched(...e),getTvEnriched:(...e)=>ge().getTvEnriched(...e),getSeasonEnriched:(...e)=>ge().getSeasonEnriched(...e),clear(e){return ge().clear(e)},configure:Ss,sync:st};Object.defineProperties(ws,{client:{get(){return ge().client}},cache:{get(){return ge().cache}},config:{get(){return ge().config}}});Yr=ws});function xs(e,t,n){let{root:r,seasons:o,options:i}=sd(e,t,n);if(!r)return;r.querySelectorAll(".season-card").forEach(a=>{typeof a._cleanup=="function"&&a._cleanup()}),r.replaceChildren(),(o||[]).forEach((a,c)=>r.append(ad(a,c,i)))}function ks(e){return e instanceof Element||typeof e=="string"}function Jr(e){return e instanceof Element?e:typeof e=="string"?document.querySelector(e):null}function sd(e,t,n){let r=null,o=[],i={};return ks(e)?(r=Jr(e),Array.isArray(t)?(o=t,i=Gt(n)?n:{}):(o=Array.isArray(e)?e:[],i=Gt(t)?t:{})):Array.isArray(e)?(o=e,ks(t)?(r=Jr(t),i=Gt(n)?n:{}):i=Gt(t)?t:{}):(r=Jr(e),o=Array.isArray(t)?t:[],i=Gt(n)?n:{}),r||(r=document.getElementById("seasonsAccordion")),{root:r,seasons:o,options:i}}function Gt(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}function ad(e,t,n={}){te(e);let r=document.createElement("article");r.className="season-card";let o=document.createElement("div");o.className="season-head";let i=document.createElement("div");i.className="season-thumb";let s=new Image;s.loading="lazy",s.decoding="async",s.src=e.thumbFile||"",s.alt=e.title||`Staffel ${e.seasonNumber||t+1}`,i.append(s);let a=document.createElement("div"),c=document.createElement("div");c.className="season-title",c.textContent=e.title||`Staffel ${e.seasonNumber||t+1}`;let l=document.createElement("div");l.className="season-sub";let u=e.year||e.releaseYear||"",d=Array.isArray(e.episodes)?e.episodes.length:e.episodeCount||0;l.textContent=[u,d?`${d} Episoden`:""].filter(Boolean).join(" \u2022 "),a.append(c,l);let f=document.createElement("div");f.className="chev",f.textContent="\u203A",o.append(i,a,f);let g=document.createElement("div");g.className="season-body",Cs(g,e.episodes||[],{show:n.show});let m=gd(e,t),p=hd(e,n.show),h=!1,b=!1,v=null,k=()=>{if(!(!r.classList.toggle("open")||h||b)){if(!pd(p,m)){h=!0;return}b=!0,v=new AbortController,Yr.getSeasonEnriched(p,m,{stillSize:"w300",show:n.show||null}).then(w=>{v!=null&&v.signal.aborted||!w||!Array.isArray(w.episodes)||(fd(e,w.episodes),Cs(g,e.episodes||[],{show:n.show}),h=!0)}).catch(w=>{v!=null&&v.signal.aborted||Zr("Failed to enrich season",p,m,(w==null?void 0:w.message)||w)}).finally(()=>{b=!1,v=null})}};return o.addEventListener("click",k),r._cleanup=()=>{o.removeEventListener("click",k),v&&!v.signal.aborted&&v.abort()},r.append(o,g),r}function Cs(e,t,n={}){e.replaceChildren();let r=Array.isArray(t)?t:[];if(!r.length){let o=document.createElement("p");o.className="episode-empty",o.textContent="Keine Episoden verf\xFCgbar.",e.append(o);return}r.forEach(o=>{te(o),e.append(cd(o,n))})}function cd(e,t={}){let n=dd(e),r=document.createElement("div");r.className="episode";let o=document.createElement("div");o.className="ep-media",o.append(ud(n,t));let i=document.createElement("div");i.className="ep-content";let s=document.createElement("div");s.className="ep-header";let a=document.createElement("div");a.className="ep-title",a.textContent=ld(n),s.append(a);let c=document.createElement("div");c.className="badges";let l=Number(n.rating);if(Number.isFinite(l)){let g=document.createElement("span");g.className="badge",g.textContent=l.toFixed(1),c.append(g)}c.childElementCount&&s.append(c);let u=document.createElement("div");u.className="ep-meta";let d=[];n.runtimeText&&d.push(n.runtimeText),n.airDate&&d.push(n.airDate),u.textContent=d.join(" \u2022 ");let f=document.createElement("p");return f.className="ep-overview",f.textContent=n.overview||"Keine Beschreibung verf\xFCgbar.",i.append(s,u,f),r.append(o,i),r}function ld(e){let t=[];return e.code&&t.push(e.code),e.title&&t.push(e.title),t.join(" \u2022 ")}function ud(e,t={}){var a,c;let n=document.createElement("div");n.className="ep-still";let r=e.tmdbStillPath,o=e.tmdbStill||e.localStill,i=e.title||((a=t==null?void 0:t.show)==null?void 0:a.title)||"Episode";if(r||o){let l=new Image;if(l.loading="lazy",l.decoding="async",r){let u=Ot(r,{size:"w300",title:i}),d=Ot(r,{size:"w780",title:i});l.src=u,l.srcset=`${u} 300w, ${d} 780w`}else l.src=o;return l.alt=i,n.append(l),n}n.dataset.state="empty";let s=document.createElement("div");return s.className="ep-still-initials",s.textContent=ze(e.title||((c=t==null?void 0:t.show)==null?void 0:c.title)||"",2)||"\u2205",n.append(s),n}function dd(e){var f,g,m;let t=(e==null?void 0:e.tmdb)||{},n=he(e==null?void 0:e.seasonNumber,t==null?void 0:t.seasonNumber),r=he(e==null?void 0:e.episodeNumber,t==null?void 0:t.episodeNumber,e==null?void 0:e.index),o=(e==null?void 0:e.seasonEpisode)&&String(e.seasonEpisode).toUpperCase()||(Number.isFinite(n)&&Number.isFinite(r)?`S${String(n).padStart(2,"0")}E${String(r).padStart(2,"0")}`:""),i=(e==null?void 0:e.durationMin)||(Number.isFinite(e==null?void 0:e.duration)?Math.round(Number(e.duration)/6e4):null)||(Number.isFinite(t==null?void 0:t.runtime)?Number(t.runtime):null),s=(e==null?void 0:e.durationHuman)||(Number.isFinite(i)&&i>0?`${i} min`:""),a=Number.isFinite(t==null?void 0:t.voteAverage)?Number(t.voteAverage):Number((m=(g=(f=e==null?void 0:e.audienceRating)!=null?f:e==null?void 0:e.rating)!=null?g:e==null?void 0:e.score)!=null?m:NaN),c=(t==null?void 0:t.overview)||(e==null?void 0:e.summary)||(e==null?void 0:e.overview)||(e==null?void 0:e.description)||(e==null?void 0:e.plot)||"",l=(t==null?void 0:t.airDate)||(e==null?void 0:e.originallyAvailableAt)||(e==null?void 0:e.date)||(e==null?void 0:e.airDate)||"",u=(t==null?void 0:t.stillPath)||(e==null?void 0:e.stillPath)||"",d=(t==null?void 0:t.still)||(e==null?void 0:e.still)||(e==null?void 0:e.thumbFile)||(e==null?void 0:e.thumb)||"";return{title:(t==null?void 0:t.name)||(e==null?void 0:e.title)||(e==null?void 0:e.name)||"",code:o,runtimeText:s,rating:a,overview:c,airDate:l,tmdbStillPath:u,tmdbStill:(t==null?void 0:t.still)||"",localStill:d}}function fd(e,t){if(!e||typeof e!="object")return;let n=Array.isArray(e.episodes)?e.episodes:[],r=new Map;n.forEach(o=>{let i=Ts(o);i&&r.set(i,o)}),t.forEach(o=>{var a,c,l;let i=Ts(o);if(!i||!r.has(i))return;let s=r.get(i);s.tmdb={id:o.id||"",seasonNumber:he(o.seasonNumber),episodeNumber:he(o.episodeNumber),name:o.name||"",overview:o.overview||"",airDate:o.airDate||"",runtime:he(o.runtime),voteAverage:Number((c=(a=o.voteAverage)!=null?a:o.vote_average)!=null?c:NaN),voteCount:he((l=o.voteCount)!=null?l:o.vote_count),still:o.still||"",stillPath:o.stillPath||""}})}function Ts(e){if(!e)return"";let t=he(e.seasonNumber,e.parentIndex,e.parentSeason,e.season),n=he(e.episodeNumber,e.index,e.episode,e.indexNumber);return!Number.isFinite(t)||!Number.isFinite(n)?"":`${t}:${n}`}function he(...e){for(let t of e){let n=Number(t);if(Number.isFinite(n))return n}return null}function gd(e,t){let n=he(e==null?void 0:e.seasonNumber,e==null?void 0:e.index,e==null?void 0:e.indexNumber);return Number.isFinite(n)?n:(t!=null?t:0)+1}function hd(e,t){var a,c,l,u,d;let n=(t==null?void 0:t.ids)||{},r=(n==null?void 0:n.tmdb)||(t==null?void 0:t.tmdbId)||((a=t==null?void 0:t.tmdb)==null?void 0:a.id)||(t==null?void 0:t.id),o=(e==null?void 0:e.tmdbShowId)||((l=(c=e==null?void 0:e.parent)==null?void 0:c.ids)==null?void 0:l.tmdb)||((u=e==null?void 0:e.parent)==null?void 0:u.tmdbId)||((d=e==null?void 0:e.ids)==null?void 0:d.tmdbShow),i=r||o;if(i==null)return null;let s=String(i).trim();return s||null}function md(){var e;try{let t=((e=Yr)==null?void 0:e.config)||{};if(typeof t.token=="string"&&t.token.trim()||typeof t.apiKey=="string"&&t.apiKey.trim())return!0}catch(t){Zr("Failed to inspect metadata service config for credentials",(t==null?void 0:t.message)||t)}try{let t=typeof(localStorage==null?void 0:localStorage.getItem)=="function"?localStorage.getItem("tmdbToken"):"";if(typeof t=="string"&&t.trim())return!0}catch(t){Zr("Failed to read TMDB credentials from storage",(t==null?void 0:t.message)||t)}return!1}function pd(e,t){var n;return!(!((n=window==null?void 0:window.FEATURES)!=null&&n.tmdbEnrichment)||!md()||!e||t==null)}function Zr(...e){try{}catch{}}var _s=_(()=>{tt();at();Wr()});function Qr(e,t){let n=e.querySelector(".v2-seasons");if(!n)return;let r=Array.isArray(t==null?void 0:t.seasons)?t.seasons:[];if(!r.length){n.innerHTML='<p class="modalv2-loading">Keine Staffel-Informationen verf\xFCgbar.</p>';return}n.innerHTML="",xs(n,r,{show:t})}var Is=_(()=>{_s()});function eo(e,t){var l,u,d,f,g,m,p,h,b;let n=e.querySelector("#action-tmdb, #v2Tmdb"),r=e.querySelector("#action-imdb, #v2Imdb"),o=e.querySelector("#action-trailer, #v2Trailer"),i=((l=t==null?void 0:t.ids)==null?void 0:l.tmdb)||(t==null?void 0:t.tmdbId)||((u=t==null?void 0:t.tmdbDetail)==null?void 0:u.id)||((d=t==null?void 0:t.tmdb)==null?void 0:d.id),s=((f=t==null?void 0:t.ids)==null?void 0:f.imdb)||(t==null?void 0:t.imdbId)||((g=t==null?void 0:t.tmdbDetail)==null?void 0:g.imdbId)||((h=(p=(m=t==null?void 0:t.tmdbDetail)==null?void 0:m.raw)==null?void 0:p.external_ids)==null?void 0:h.imdb_id),a=(t==null?void 0:t.trailer)||(t==null?void 0:t.trailerUrl)||((b=t==null?void 0:t.tmdbDetail)==null?void 0:b.trailer),c=(t==null?void 0:t.type)==="tv"?"tv":"movie";Ls(n,i?`https://www.themoviedb.org/${c}/${i}`:""),Ls(r,s?`https://www.imdb.com/title/${s}/`:""),o&&(a?(o.hidden=!1,o.setAttribute("aria-hidden","false"),o.removeAttribute("aria-disabled"),o.removeAttribute("tabindex"),o.onclick=()=>window.open(a,"_blank","noopener")):(o.hidden=!0,o.setAttribute("aria-hidden","true"),o.setAttribute("aria-disabled","true"),o.setAttribute("tabindex","-1"),o.onclick=null))}function Ls(e,t){if(!e)return;let n=e.tagName==="A",r=!!t;e.hidden=!r,e.setAttribute("aria-hidden",r?"false":"true"),n?r?(e.href=t,e.removeAttribute("aria-disabled"),e.removeAttribute("tabindex")):(e.removeAttribute("href"),e.setAttribute("aria-disabled","true"),e.setAttribute("tabindex","-1")):r?(e.removeAttribute("aria-disabled"),e.removeAttribute("tabindex")):(e.setAttribute("aria-disabled","true"),e.setAttribute("tabindex","-1"))}var Ms=_(()=>{});function vd(e){var i,s,a;if(!e)return null;if(typeof e=="string"){let c=String(e).trim();return c?{name:c,role:"",thumb:"",tmdbProfile:"",raw:null}:null}let t=String(e.tag||e.name||e.role||"").trim();if(!t)return null;let n=(()=>{let c=String(e.role||"").trim();return c?c.toLowerCase()===t.toLowerCase()?"":c:""})(),r=[(i=e==null?void 0:e.tmdb)==null?void 0:i.profile,(s=e==null?void 0:e.tmdb)==null?void 0:s.profile_path,(a=e==null?void 0:e.tmdb)==null?void 0:a.profilePath,e==null?void 0:e.tmdbProfile,e==null?void 0:e.profile,e==null?void 0:e.profile_path,e==null?void 0:e.profilePath].find(c=>typeof c=="string"&&c.trim()),o=[e==null?void 0:e.thumb,e==null?void 0:e.photo,e==null?void 0:e.image].find(c=>typeof c=="string"&&c.trim())||"";return{name:t,role:n,thumb:o,tmdbProfile:r?String(r).trim():"",raw:e}}function Sd(e){if(!e)return null;let t=String(e.name||e.original_name||"").trim();if(!t)return null;let n=String(e.character||"").trim();return{name:t,role:n,thumb:"",tmdbProfile:e.profile||e.profile_path||e.profilePath||"",raw:{tmdb:e}}}function no(e){var i,s;let t=new Map,n=[];return(Array.isArray(e==null?void 0:e.cast)?e.cast:Array.isArray(e==null?void 0:e.roles)?e.roles:[]).forEach(a=>{let c=vd(a);if(!c)return;let l=c.name.toLowerCase();t.has(l)||(t.set(l,!0),n.push(c))}),(Array.isArray((s=(i=e==null?void 0:e.tmdbDetail)==null?void 0:i.credits)==null?void 0:s.cast)?e.tmdbDetail.credits.cast:[]).forEach(a=>{let c=Sd(a);if(!c)return;let l=c.name.toLowerCase();t.has(l)||(t.set(l,!0),n.push(c))}),n}function Ed(e,t,n){if(!e||!n)return;n.innerHTML="";let r=Array.isArray(t)?t.slice(0,12):[];if(!r.length){n.innerHTML='<span class="modalv2-loading">Keine Besetzungsdaten verf\xFCgbar.</span>',n.removeAttribute("role"),to(e);return}n.setAttribute("role","list");let o=De();r.forEach(i=>{let s=i&&typeof i=="object"&&"name"in i?i:(()=>{let f=String(i||"").trim();return f?{name:f,role:"",thumb:"",tmdbProfile:"",raw:null}:null})();if(!s||!s.name)return;let a=document.createElement("article");a.className="cast-card",a.tabIndex=0,a.setAttribute("role","listitem");let c=String(s.role||"").trim();a.setAttribute("aria-label",c?`${s.name} \u2013 ${c}`:s.name);let l=document.createElement("div");l.className="cast-avatar";let u=Td(s,o);if(u){l.classList.add("has-image");let f=document.createElement("img");f.src=u,f.alt=s.name,f.loading="lazy",f.decoding="async",l.appendChild(f)}else{let f=document.createElement("span");f.className="cast-initials",f.textContent=xd(s.name),f.setAttribute("aria-hidden","true"),l.appendChild(f)}let d=document.createElement("p");if(d.className="cast-name",d.textContent=s.name,a.append(l,d),c){let f=document.createElement("p");f.className="cast-role",f.textContent=c,a.append(f)}else a.classList.add("cast-card--no-role");n.appendChild(a)}),n.children.length?wd(n):(n.innerHTML='<span class="modalv2-loading">Keine Besetzungsdaten verf\xFCgbar.</span>',n.removeAttribute("role")),to(e)}function ro(e,t){Ad(e,t)}function Ad(e,t){let n=oo(e);if(!n)return;let r=Fs(n);Ed(n,t,r)}function ct(e,t){let n=oo(e);n&&(n.dataset.loading=t?"true":"false",t?n.setAttribute("aria-busy","true"):n.removeAttribute("aria-busy"))}function lt(e,t){let n=oo(e);if(!n)return;Fs(n);let r=n.querySelector(".v2-cast-status");if(!t||!t.message){r&&r.remove(),n.dataset.status="";return}if(!r){r=document.createElement("p"),r.className="v2-cast-status",r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true");let o=n.querySelector(".cast-row");o&&o.nextSibling?n.insertBefore(r,o.nextSibling):n.appendChild(r)}r.dataset.state=t.state||"",r.textContent=t.message,n.dataset.status=t.state||"",to(n)}function to(e){if(!e)return;let t=e.querySelector(".v2-cast-status");if(!t)return;let n=e.querySelector(".cast-row");n&&t.previousElementSibling!==n?n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t):!n&&t.parentElement!==e&&e.appendChild(t)}function Fs(e){if(!e)return null;let t=e.querySelector(".cast-row");if(t)return t;t=document.createElement("div"),t.className="cast-row";let n=e.querySelector(".v2-cast-status");return n?e.insertBefore(t,n):e.appendChild(t),t}function wd(e){if(!e)return;let t=()=>{let n=Array.from(e.querySelectorAll(".cast-card"));if(!n.length)return;let r=0;if(n.forEach(o=>{o.style.minHeight="";let i=o.offsetHeight;i>r&&(r=i)}),r){let o=`${r}px`;n.forEach(i=>{i.style.minHeight=o})}};typeof requestAnimationFrame=="function"?requestAnimationFrame(t):t()}function oo(e){return e instanceof HTMLElement?e.classList.contains("v2-cast")?e:e.querySelector(".v2-cast"):(e==null?void 0:e.cast)instanceof HTMLElement?e.cast:document.querySelector(".v2-pane.v2-cast")}function kd(e){let t=String(e||"").trim();if(!t)return"";if(/^https?:\/\//i.test(t))return t;if(t.startsWith("//"))return`https:${t}`;let n=t.startsWith("/")?t:`/${t}`;return`${bd}${yd}${n}`}function Cd(e){let t=String(e||"").trim();return t?/^https?:\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("//")?`https:${t}`:t:""}function Td(e,t){var o,i,s;if(!e)return"";let n=e.raw||{};if(t){let a=[e.tmdbProfile,(o=n==null?void 0:n.tmdb)==null?void 0:o.profile,(i=n==null?void 0:n.tmdb)==null?void 0:i.profile_path,(s=n==null?void 0:n.tmdb)==null?void 0:s.profilePath,n==null?void 0:n.tmdbProfile,n==null?void 0:n.profile,n==null?void 0:n.profile_path,n==null?void 0:n.profilePath];for(let c of a){let l=kd(c);if(l)return l}}let r=[e.thumb,n==null?void 0:n.thumb,n==null?void 0:n.photo,n==null?void 0:n.image];for(let a of r){let c=Cd(a);if(c)return c}return""}function xd(e){let t=String(e||"").trim();if(!t)return"?";let r=t.split(/\s+/).slice(0,2).map(o=>o.charAt(0)).filter(Boolean);return r.length?r.join("").toUpperCase():t.charAt(0).toUpperCase()}var bd,yd,Ps=_(()=>{de();bd="https://image.tmdb.org/t/p/",yd="w185"});function Id(e){return e!==null&&typeof e=="object"}function Ld(e){var i,s;let t=Id(e)?(s=(i=e.id)!=null?i:e.guid)!=null?s:"":e,n=typeof t=="string"?t.trim():"";if(!n)return{};let r=n.toLowerCase(),o={};for(let[a,c]of Object.entries(_d))if(!o[a])for(let l of c){let u=l.toLowerCase(),d=r.indexOf(u);if(d===-1)continue;let f=d+u.length,g=n.slice(f);if(g=g.replace(/^\/+/,""),g=g.split(/[?#]/)[0],!!g&&(g.includes("/")&&(g=g.split("/").find(Boolean)||""),g=g.trim(),g)){o[a]=g;break}}return o}function _n(e){var o,i,s;if(!e||typeof e!="object")return e;let t={...e.ids||{}},n=(a,c)=>{if(t[a])return;let l=c==null?"":String(c).trim();l&&(t[a]=l)};n("tmdb",e.tmdbId),n("tmdb",(o=e==null?void 0:e.tmdb)==null?void 0:o.id),n("imdb",e.imdbId),n("imdb",(i=e==null?void 0:e.tmdb)==null?void 0:i.imdbId),n("tvdb",e.tvdbId),n("tvdb",(s=e==null?void 0:e.tmdb)==null?void 0:s.tvdbId);let r=[];return Array.isArray(e==null?void 0:e.guids)&&r.push(...e.guids),e!=null&&e.guid&&r.push(e.guid),r.forEach(a=>{let c=Ld(a);Object.entries(c).forEach(([l,u])=>n(l,u))}),Object.keys(t).length&&(e.ids=t,t.tmdb&&!e.tmdbId&&(e.tmdbId=t.tmdb)),e}function qt(e){if(e==null||typeof e!="object")return e;if(typeof structuredClone=="function")try{return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}if(Array.isArray(e))return e.map(n=>qt(n));let t={};for(let n of Object.keys(e))t[n]=qt(e[n]);return t}function In(e){if(!e||typeof e!="object")return null;let t=qt(e);return t.type==="show"&&(t.type="tv"),t.type||(t.type="movie"),_n(t),t}function Ln(e){if(!e||typeof e!="object")return null;let t=qt(e);return t.type!=="tv"&&(t.type="tv"),_n(t),io(t),t}function Md(e){if(!e||typeof e!="object")return null;let t=qt(e);return _n(t),io(t),t}function Ns(e){let t=Array.isArray(e==null?void 0:e.seasons)?e.seasons:[],n=t.some(o=>Array.isArray(o==null?void 0:o.episodes)&&o.episodes.length),r=Array.isArray(e==null?void 0:e.cast)?e.cast:Array.isArray(e==null?void 0:e.roles)?e.roles:[];return!t.length||!n||!r.length}function Bs(e,t){if(!e)return e;if(t&&typeof t=="object"){let n=Md(t);Object.assign(e,n),_n(e)}return io(e),e}function io(e){if(!e||typeof e!="object")return;so(e),e.genres=ao(e.genres);let t=Nd(e.cast||e.roles||[]);e.cast=t,e.roles=t,e.seasons=Array.isArray(e.seasons)?e.seasons.map(Fd).filter(Boolean):[];let n=Number(e.seasonCount);e.seasonCount=Number.isFinite(n)&&n>0?n:e.seasons.length}function Fd(e){if(!e||typeof e!="object")return null;let t={...e};return so(t),t.genres=ao(t.genres),t.episodes=Array.isArray(t.episodes)?t.episodes.map(Pd).filter(Boolean):[],t}function Pd(e){if(!e||typeof e!="object")return null;let t={...e};return so(t),t.genres=ao(t.genres),t}function so(e){te(e)}function ao(e){if(!Array.isArray(e))return[];let t=new Set,n=[];return e.forEach(r=>{let o=null;if(typeof r=="string"){let i=r.trim();i&&(o={tag:i})}else if(r&&typeof r=="object"){let i=String(r.tag||r.title||r.name||r.label||"").trim();i&&(o={...r,tag:i})}o&&!t.has(o.tag)&&(t.add(o.tag),n.push(o))}),n}function Nd(e){return Array.isArray(e)?e.map(t=>{if(!t)return null;if(typeof t=="string"){let n=t.trim();return n?{tag:n}:null}if(typeof t=="object"){let n=String(t.tag||t.name||t.role||"").trim();return n?{...t,tag:n}:{...t}}return null}).filter(Boolean):[]}var _d,Hs=_(()=>{tt();_d={tmdb:["tmdb://","themoviedb://","com.plexapp.agents.themoviedb://"],imdb:["imdb://","com.plexapp.agents.imdb://"],tvdb:["tvdb://","thetvdb://","com.plexapp.agents.thetvdb://"]}});var Rs={};Ze(Rs,{DEMO_MOVIE:()=>Bd,DEMO_SERIES:()=>Hd});var Bd,Hd,$s=_(()=>{Bd={type:"movie",title:"Lumen: Der Aufbruch",tagline:"Eine cineastische Demo f\xFCr das neue Modal",overview:"Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\xFCllt dabei eine Energiequelle, die alles ver\xE4ndern k\xF6nnte. Zwischen Loyalit\xE4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\xFCr das Cinematic-Layout entworfen wurde.",summary:"Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\xE4ndern k\xF6nnte.",runtimeMin:142,contentRating:"FSK 12",studio:"Aurora Pictures",rating:8.4,audienceRating:8,userRating:8.7,originallyAvailableAt:"2024-05-17",countries:[{tag:"Deutschland"},{tag:"Kanada"}],genres:[{tag:"Science-Fiction"},{tag:"Drama"},{tag:"Abenteuer"}],cast:[{name:"Mara Lenz",role:"Captain Alys Vega",tmdbProfile:"/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg"},{name:"Tariq Benassi",role:"Navigator Elian Soh",tmdbProfile:"/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg"},{name:"Hannah Ko",role:"Wissenschaftlerin Dr. Mira Han",tmdbProfile:"/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg"}],directors:[{tag:"Jonas Falk"}],writers:[{tag:"Lea Winter"}],producers:[{tag:"Studio Atlas"}],labels:[{tag:"Dolby Atmos"},{tag:"4K"}],collections:[{tag:"Aurora-Saga"}],trailer:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",tmdbPoster:"https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg",ids:{tmdb:"demo-lumen",imdb:"tt0000001"},addedAt:"2024-06-01T12:00:00Z"},Hd={type:"tv",title:"Aurora Station",tagline:"Neue Horizonte in Serie",overview:"Die Besatzung der Aurora Station sch\xFCtzt eine Au\xDFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\xE4tsel mit pers\xF6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.",summary:"Ein orbitaler Au\xDFenposten ringt um Hoffnung und Zusammenhalt, w\xE4hrend eine fremde Macht erwacht.",contentRating:"TV-14",studio:"Nebula Network",originallyAvailableAt:"2023-09-14",seasonCount:2,genres:[{tag:"Science-Fiction"},{tag:"Drama"}],countries:[{tag:"USA"},{tag:"Island"}],creators:[{tag:"Elina S\xF8rensen"}],cast:[{name:"Noah Adler",role:"Commander Ivar Hale",tmdbProfile:"/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg"},{name:"Sofia Idris",role:"Ingenieurin Kaia Rhee",tmdbProfile:"/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg"},{name:"Helena Ruiz",role:"Strategin Tala Voss",tmdbProfile:"/ziEuG1ESSofxDCspotYlrwz3Tq.png"}],seasons:[{title:"Staffel 1",seasonNumber:1,year:2023,thumbFile:"https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg",episodes:[{title:"Kapitel Eins: Erwachen",seasonNumber:1,episodeNumber:1,durationMin:54,originallyAvailableAt:"2023-09-14",audienceRating:8.6},{title:"Kapitel Zwei: Grenzwelten",seasonNumber:1,episodeNumber:2,durationMin:52,originallyAvailableAt:"2023-09-21",audienceRating:8.2}]},{title:"Staffel 2",seasonNumber:2,year:2024,thumbFile:"https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg",episodes:[{title:"Kapitel Dreizehn: Resonanz",seasonNumber:2,episodeNumber:1,durationMin:56,originallyAvailableAt:"2024-02-08",audienceRating:8.9},{title:"Kapitel Vierzehn: Echo",seasonNumber:2,episodeNumber:2,durationMin:55,originallyAvailableAt:"2024-02-15",audienceRating:8.7}]}],tmdbPoster:"https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg",ids:{tmdb:"demo-aurora-station",imdb:"tt0000002"}}});function zs(){return co||(co=Promise.resolve().then(()=>($s(),Rs)).catch(e=>({DEMO_MOVIE:null,DEMO_SERIES:null}))),co}function Rd(){if(H)return H;let e=document.getElementById("modal-root-v2");if(!e)return null;if(me=e,e.classList.add("modalv2-overlay"),e.hasAttribute("hidden")||e.setAttribute("hidden",""),e.dataset.modalv2Ready||(e.innerHTML=`
      <div class="modalv2-backdrop" data-modalv2-backdrop="1"></div>
      <div class="modalv2-dialog" role="dialog" aria-modal="true">
        <div class="modalv2-scroll" data-modalv2-scroll></div>
      </div>
    `,e.dataset.modalv2Ready="1",e.addEventListener("click",$d)),z=e.querySelector(".modalv2-dialog"),z&&!z.hasAttribute("tabindex")&&z.setAttribute("tabindex","-1"),Te=e.querySelector("[data-modalv2-scroll]"),Te&&!H){let t=Te.querySelector(".modalv2");t?H=t:(H=document.createElement("div"),H.className="modalv2",H.setAttribute("hidden",""),Te.appendChild(H))}return H}function $d(e){if(!me)return;let t=e.target;(t===me||t&&t.dataset&&t.dataset.modalv2Backdrop)&&uo()}function Os(){return z?Array.from(z.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(t=>t.hasAttribute("disabled")||t.getAttribute("aria-hidden")==="true"||t.hasAttribute("hidden")?!1:t.offsetParent!==null):[]}function Dd(){z&&(je&&z.removeEventListener("keydown",je),je=e=>{if(e.key!=="Tab")return;let t=Os();if(!t.length)return;let n=t[0],r=t[t.length-1];e.shiftKey?document.activeElement===n&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),n.focus())},z.addEventListener("keydown",je))}function zd(){!z||!je||(z.removeEventListener("keydown",je),je=null)}function Od(){dt||(dt=e=>{e.key==="Escape"&&(e.preventDefault(),uo())},window.addEventListener("keydown",dt))}function jd(){dt&&(window.removeEventListener("keydown",dt),dt=null)}function Mn(){let e=Rd();return!e||!me?null:(me.hidden=!1,me.setAttribute("aria-hidden","false"),document.body.classList.add("modalv2-open"),Te&&(Te.scrollTop=0),Dd(),Od(),e)}function lo(){if(!z)return;let e=z.querySelector("#action-close, #v2Close"),t=Os(),n=e&&!e.hasAttribute("hidden")?e:t[0];if(n||(n=z),n){let r=()=>{try{n.focus()}catch{}};(window.requestAnimationFrame||setTimeout)(r,0)}}function Wt(e,t){let n=e,r=t;n instanceof HTMLElement||(r=e,n=null);let o=n instanceof HTMLElement?n:H;if(!o)return;let i=o.querySelector("[data-head-status]");if(!i)return;if(!r){i.hidden=!0,i.textContent="",i.dataset.state="";return}let{state:s="",message:a=""}=r;i.dataset.state=s||"",i.textContent=a||"",i.hidden=!a}function Kd(e="Details werden geladen \u2026"){let t=Mn();if(!t)return;t.hidden=!1;let n=document.createElement("div");n.className="modalv2-loading",n.textContent=String(e||"Details werden geladen \u2026"),t.replaceChildren(n)}function js(e){var i,s;let t=Mn();if(!t)return;t.hidden=!1;let n=(e==null?void 0:e.type)==="tv";t.innerHTML=`
    <article class="v2-shell">
      <header class="v2-head" id="modal-head" data-tmdb-section>
        <div class="v2-head-visual" data-head-visual>
          <div class="v2-head-hero" data-head-hero>
            <div class="v2-head-backdrop" data-head-backdrop></div>
            <div class="v2-head-overlay-logo" data-head-overlay-logo hidden></div>
            <div class="v2-head-overlay-meta" data-head-overlay-meta hidden></div>
          </div>
          <div class="v2-head-logo" data-head-logo hidden></div>
        </div>
        <p class="v2-head-status" data-head-status hidden aria-live="polite" aria-atomic="true"></p>
        <div class="v2-titlebar">
          <div class="v2-title-wrap">
            <div class="v2-badges" id="modal-badges" aria-label="Bewertungen & Zertifikate" hidden>
              <span class="badge badge--tmdb" data-badge-tmdb hidden></span>
              <span class="badge badge--certification" data-badge-certification hidden></span>
            </div>
            <h2 class="v2-title" id="modal-title"></h2>
            <div class="v2-subline" id="modal-subline"></div>
            <div class="v2-meta" id="modal-meta"></div>
          </div>
          <div class="v2-actions" aria-label="Externe Aktionen">
            <button class="v2-icon-btn" id="action-close" type="button" aria-label="Schlie\xDFen">
              <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M6 6l12 12M6 18L18 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
              </svg>
            </button>
            <a class="v2-icon-btn" id="action-tmdb" target="_blank" rel="noopener noreferrer" aria-label="Auf TMDB \xF6ffnen" hidden>
              <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"></path>
                <path d="M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </a>
            <a class="v2-icon-btn" id="action-imdb" target="_blank" rel="noopener noreferrer" aria-label="Auf IMDb \xF6ffnen" hidden>
              <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"></path>
              </svg>
            </a>
            <button class="v2-icon-btn" id="action-trailer" type="button" aria-label="Trailer abspielen" hidden>
              <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M9 6l8 6-8 6V6z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round" stroke-linecap="round"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="v2-chips" id="modal-chips" aria-label="Attribute"></div>
      </header>
      <div class="v2-body">
        <section class="v2-layout">
          <aside class="v2-side" id="modal-aside">
            <div class="v2-poster-card" id="modal-poster-card">
              <div class="v2-poster-media" id="modal-poster" aria-hidden="true">
                <img id="modal-poster-img" alt="">
              </div>
              <section class="v2-quickfacts" id="modal-quickfacts" aria-label="Schnellinfos" hidden>
                <h3 class="v2-quickfacts-title">Schnellinfos</h3>
                <dl class="v2-quickfacts-list" id="modal-quickfacts-list"></dl>
              </section>
            </div>
          </aside>
          <main class="v2-info" id="modal-main">
            <nav class="v2-tabs" aria-label="Details Navigation" role="tablist">
              <button type="button" data-t="overview" class="active" id="tab-overview" role="tab" aria-controls="pane-overview" aria-selected="true">\xDCberblick</button>
              <button type="button" data-t="details" id="tab-details" role="tab" aria-controls="pane-details" aria-selected="false">Details</button>
              ${n?'<button type="button" data-t="seasons" id="tab-seasons" role="tab" aria-controls="pane-seasons" aria-selected="false">Staffeln</button>':""}
              <button type="button" data-t="cast" id="tab-cast" role="tab" aria-controls="pane-cast" aria-selected="false">Cast</button>
            </nav>
            <section class="v2-body" id="modal-panes">
              <div class="v2-pane v2-overview" data-pane="overview" id="pane-overview" role="tabpanel" aria-labelledby="tab-overview"></div>
              <div class="v2-pane v2-details" data-pane="details" id="pane-details" role="tabpanel" aria-labelledby="tab-details" hidden></div>
              ${n?'<div class="v2-pane v2-seasons" data-pane="seasons" id="pane-seasons" role="tabpanel" aria-labelledby="tab-seasons" hidden></div>':""}
              <div class="v2-pane v2-cast" data-pane="cast" id="pane-cast" role="tabpanel" aria-labelledby="tab-cast" hidden></div>
            </section>
            <footer class="v2-foot" id="modal-footer" aria-label="Produktionslogos & Attribution" hidden>
              <div class="v2-logos" id="modal-footer-logos" aria-label="Produktionsfirmen und Netzwerke"></div>
              <p class="v2-footnote" id="modal-footer-note"></p>
            </footer>
          </main>
        </section>
      </div>
    </article>
  `;let r={head:{rootEl:t.querySelector("#modal-head"),titleEl:t.querySelector("#modal-title"),sublineEl:t.querySelector("#modal-subline"),metaEl:t.querySelector("#modal-meta"),chipsEl:t.querySelector("#modal-chips"),badgesGroupEl:t.querySelector("#modal-badges"),tmdbBadgeEl:t.querySelector("[data-badge-tmdb]"),certificationBadgeEl:t.querySelector("[data-badge-certification]"),footerEl:t.querySelector("#modal-footer"),footerLogosEl:t.querySelector("#modal-footer-logos"),footerNoteEl:t.querySelector("#modal-footer-note")},poster:{posterEl:t.querySelector("#modal-poster-img"),quickfactsEl:{root:t.querySelector("#modal-quickfacts"),list:t.querySelector("#modal-quickfacts-list")}},panes:{overview:t.querySelector("#pane-overview"),details:t.querySelector("#pane-details"),seasons:t.querySelector("#pane-seasons"),cast:t.querySelector("#pane-cast")},actions:{close:t.querySelector("#action-close"),tmdb:t.querySelector("#action-tmdb"),imdb:t.querySelector("#action-imdb"),trailer:t.querySelector("#action-trailer")}};N=r,Rr(r.head,e),$r(r.poster,e),eo(t,e),zr(r.panes.overview,e),jr(r.panes.details,e),n&&Qr(t,e),ro(r.panes.cast,no(e)),ct(r.panes.cast,!1),lt(r.panes.cast,null),Wt(t,null),Ri(t);let o=r.actions.close;if(o&&o.addEventListener("click",uo),z){let a=((s=(i=r.head)==null?void 0:i.titleEl)==null?void 0:s.id)||"modal-title";z.setAttribute("aria-labelledby",a)}lo()}function Ds(e){!H||!N||(Rr(N.head,e),$r(N.poster,e),eo(H,e),zr(N.panes.overview,e),jr(N.panes.details,e),(e==null?void 0:e.type)==="tv"&&N.panes.seasons&&Qr(H,e),ro(N.panes.cast,no(e)))}function Ks(e,t,n){var a;if(!Ud(t))return;if(t!=null&&t.tmdbDetail){Ds(t);return}let r=Us(t);if(!r)return;let o=n!=null?n:ne;Wt({state:"loading",message:"TMDB-Daten werden geladen \u2026"});let i=((a=N==null?void 0:N.panes)==null?void 0:a.cast)||H;ct(i,!0),lt(i,{state:"loading",message:"Cast wird angereichert \u2026"}),(e==="tv"?As:Es)(r).then(c=>{var d,f;if(o!==ne)return;if(!c){Wt({state:"error",message:"Keine zus\xE4tzlichen TMDB-Daten gefunden."});let g=((d=N==null?void 0:N.panes)==null?void 0:d.cast)||H;ct(g,!1),lt(g,null);return}let l=qd(t,c);l&&(Ke=l,Ds(l)),Wt(null);let u=((f=N==null?void 0:N.panes)==null?void 0:f.cast)||H;ct(u,!1),lt(u,null)}).catch(c=>{var d,f,g;if(o!==ne)return;let l="TMDB-Daten konnten nicht geladen werden.";(c==null?void 0:c.status)===429?l="TMDB-Rate-Limit erreicht. Bitte versuchen Sie es sp\xE4ter erneut.":(c==null?void 0:c.status)===404?l="Inhalt nicht in TMDB gefunden.":((d=c==null?void 0:c.message)!=null&&d.includes("network")||(f=c==null?void 0:c.message)!=null&&f.includes("fetch"))&&(l="Netzwerkfehler. Bitte \xFCberpr\xFCfen Sie Ihre Verbindung."),Wt({state:"error",message:l});let u=((g=N==null?void 0:N.panes)==null?void 0:g.cast)||H;ct(u,!1),lt(u,{state:"error",message:"Zus\xE4tzliche Besetzung konnte nicht geladen werden."})})}function Ud(e){var t;return!(!e||!((t=window==null?void 0:window.FEATURES)!=null&&t.tmdbEnrichment)||!Gd()||!Us(e))}function Gd(){try{let t=localStorage.getItem("tmdbToken");if(t&&t.trim())return!0}catch{}let e=x().cfg||{};return!!(e.tmdbToken||e.tmdbApiKey)}function Us(e){var n;return e&&((e.ids||{}).tmdb||e.tmdbId||((n=e==null?void 0:e.tmdb)==null?void 0:n.id))||""}function qd(e,t){if(!e||!t)return e;let n={...e};return n.tmdbDetail=t,n.tmdb={...e.tmdb||{}},t.poster&&!n.tmdb.poster&&(n.tmdb.poster=t.poster),t.backdrop&&!n.tmdb.backdrop&&(n.tmdb.backdrop=t.backdrop),t.url&&(n.tmdb.url=t.url),n.ids={...e.ids||{}},t.id&&(n.ids.tmdb=String(t.id)),t.imdbId&&!n.ids.imdb&&(n.ids.imdb=String(t.imdbId)),n}async function ft(e){let t=++ne;ut=document.activeElement instanceof HTMLElement?document.activeElement:null;let n=Mn();if(!n)return;let r=await Wd(e);if(t===ne){if(!r){n.hidden=!1;let o=document.createElement("div");o.className="modalv2-loading",o.textContent="Film konnte nicht geladen werden.",n.replaceChildren(o),Ke=null,Vt=null,lo();return}Ke=r,Vt="movie",js(r),Ks("movie",r,t)}}async function gt(e){let t=++ne;ut=document.activeElement instanceof HTMLElement?document.activeElement:null;let n=await Vd(e),r=Mn();if(!r||t!==ne)return;if(!n){r.hidden=!1;let i=document.createElement("div");i.className="modalv2-loading",i.textContent="Seriendetails konnten nicht geladen werden.",r.replaceChildren(i),Ke=null,Vt=null,lo();return}Ke=n,Vt="show";let o=n;if(Ns(o)){if(Kd(),t!==ne)return;let i=null;try{i=await Ci(o)}catch{i=null}if(t!==ne)return;i&&(Bs(o,i),Ke=o)}t===ne&&(js(o),Ks("tv",o,t))}function uo(){if(ne++,!!me){if(me.hidden=!0,me.setAttribute("aria-hidden","true"),document.body.classList.remove("modalv2-open"),zd(),jd(),H&&(H.innerHTML="",H.setAttribute("hidden","")),Te&&(Te.scrollTop=0),ut&&typeof ut.focus=="function")try{ut.focus()}catch{}ut=null,Ke=null,Vt=null,N=null}}async function Wd(e){if(e==="demo"){let{DEMO_MOVIE:i}=await zs();return In(i)}if(e&&typeof e=="object")return In(e);let t=e==null?"":String(e).trim();if(!t)return null;let n=x(),o=(Array.isArray(n==null?void 0:n.movies)?n.movies:[]).find(i=>Gs(i,t));return o?In(o):null}async function Vd(e){if(e==="demo"){let{DEMO_SERIES:i}=await zs();return Ln(i)}if(e&&typeof e=="object")return Ln(e);let t=e==null?"":String(e).trim();if(!t)return null;let n=x(),o=(Array.isArray(n==null?void 0:n.shows)?n.shows:[]).find(i=>Gs(i,t));return o?Ln(o):null}function Gs(e,t){var r,o;if(!e)return!1;let n=String(t||"").trim();return n?!!((r=e==null?void 0:e.ids)!=null&&r.imdb&&String(e.ids.imdb)===n||(o=e==null?void 0:e.ids)!=null&&o.tmdb&&String(e.ids.tmdb)===n||(e==null?void 0:e.ratingKey)!=null&&String(e.ratingKey)===n):!1}var me,z,Te,H,ut,je,dt,ne,Vt,Ke,N,co,Fn=_(()=>{$i();Dr();Xi();Ji();Is();Ms();Ps();Z();tt();Hs();at();me=null,z=null,Te=null,H=null,ut=null,je=null,dt=null,ne=0,Vt=null,Ke=null,N=null,co=null});function Yd(){}function Pn(e){let t=parseFloat(e);return Number.isFinite(t)?t:0}var qs,Xd,Nn,Ws=_(()=>{qs=typeof requestAnimationFrame=="function"?requestAnimationFrame:e=>setTimeout(e,16),Xd=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:e=>clearTimeout(e);Nn=class{constructor({container:t,renderItem:n,getKey:r=Yd,updateItem:o=null,getSignature:i=null,overscan:s=2,estimatedItemHeight:a=420,minItemWidth:c=190}){if(!t)throw new Error("VirtualList requires a container element");if(typeof n!="function")throw new Error("VirtualList requires a renderItem function");this.container=t,this.renderItem=n,this.getKey=r,this.updateItem=typeof o=="function"?o:null,this.getSignature=typeof i=="function"?i:null,this.overscan=Math.max(0,s|0),this.estimatedItemHeight=a,this.minItemWidth=c,this.items=[],this.range={start:0,end:0},this.columns=1,this.rowCount=0,this.rowHeight=this.estimatedItemHeight,this.totalHeight=0,this.itemHeight=this.estimatedItemHeight,this.containerTop=0,this.paddingTop=0,this.paddingBottom=0,this.gapY=0,this.gapX=0,this.metricsDirty=!0,this.pendingFrame=0,this.lastWidth=0,this.nodeCache=new Map,this.renderedKeys=new Set,this.itemSignatures=new Map,this.scrollTicking=!1,this.spacer=document.createElement("div"),this.spacer.className="grid-virtual__spacer",this.windowEl=document.createElement("div"),this.windowEl.className="grid-virtual__window",this.itemsHost=document.createElement("div"),this.itemsHost.className="grid-virtual__items",this.container.textContent="",this.windowEl.append(this.itemsHost),this.container.append(this.spacer,this.windowEl),this.measureRoot=document.createElement("div"),this.measureRoot.className="grid-virtual__measure",this.measureRoot.setAttribute("aria-hidden","true"),Object.assign(this.measureRoot.style,{position:"absolute",visibility:"hidden",pointerEvents:"none",inset:"0 auto auto 0",zIndex:"-1"}),this.container.append(this.measureRoot),this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.update=this.update.bind(this),window.addEventListener("scroll",this.handleScroll,{passive:!0}),window.addEventListener("resize",this.handleResize),typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.container)):this.resizeObserver=null}destroy(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),this.resizeObserver&&this.resizeObserver.disconnect(),this.pendingFrame&&(Xd(this.pendingFrame),this.pendingFrame=0),this.nodeCache.clear(),this.renderedKeys.clear(),this.itemSignatures.clear(),this.items=[],this.spacer.remove(),this.windowEl.remove(),this.measureRoot.remove()}schedule(t=!1){t&&(this.metricsDirty=!0),!this.pendingFrame&&(this.pendingFrame=qs(()=>{this.pendingFrame=0,this.update()}))}handleScroll(){this.scrollTicking||(this.scrollTicking=!0,this.schedule(!1),qs(()=>{this.scrollTicking=!1}))}handleResize(){let t=this.container.clientWidth;t!==this.lastWidth&&(this.metricsDirty=!0,this.lastWidth=t),this.schedule(!0)}setItems(t){this.items=Array.isArray(t)?t.slice():[],this.metricsDirty=!0,this.pruneCache(),this.measureItems(),this.update()}measureItems(){if(!this.items.length){this.itemHeight=this.estimatedItemHeight;return}let t=this.items[0];this.measureRoot.textContent="";let n=this.renderItem(t,0);if(n instanceof HTMLElement)if(this.measureRoot.append(n),typeof n.getBoundingClientRect=="function"){let r=n.getBoundingClientRect();r&&r.height>0&&(this.itemHeight=r.height)}else n.offsetHeight&&(this.itemHeight=n.offsetHeight);this.measureRoot.textContent=""}pruneCache(){if(!this.items.length){this.nodeCache.forEach(r=>r.remove()),this.nodeCache.clear(),this.itemSignatures.clear(),this.renderedKeys.clear();return}let t=new Set,n=this.getSignature?new Map:null;this.items.forEach((r,o)=>{let i=this.keyFor(r,o);if(t.add(i),n){let s=this.signatureFor(r,o);n.set(i,s);let a=this.itemSignatures.get(i);if(a!==void 0&&a!==s){let c=this.nodeCache.get(i);c&&(c.parentNode&&c.parentNode.removeChild(c),this.nodeCache.delete(i),this.renderedKeys.delete(i))}}}),this.nodeCache.forEach((r,o)=>{t.has(o)||(r.parentNode&&r.parentNode.removeChild(r),this.nodeCache.delete(o),this.renderedKeys.delete(o))}),n?this.itemSignatures=n:this.itemSignatures.clear()}keyFor(t,n){let r=this.getKey?this.getKey(t,n):null;return r==null||r===""?`index-${n}`:String(r)}signatureFor(t,n){if(this.getSignature)try{return this.getSignature(t,n)}catch{return}}refreshMetrics(){let t=getComputedStyle(this.container);this.paddingTop=Pn(t.paddingTop),this.paddingBottom=Pn(t.paddingBottom);let n=getComputedStyle(this.itemsHost),r=n.getPropertyValue?n.getPropertyValue("row-gap"):n.rowGap,o=n.getPropertyValue?n.getPropertyValue("column-gap"):n.columnGap,i=n.getPropertyValue?n.getPropertyValue("gap"):n.gap;this.gapY=Pn(r||i),this.gapX=Pn(o||i);let s=Math.floor((this.container.clientWidth+this.gapX)/(this.minItemWidth+this.gapX));this.columns=Math.max(1,s||1),this.rowHeight=this.itemHeight+this.gapY,this.rowHeight<=0&&(this.rowHeight=this.itemHeight||this.estimatedItemHeight),this.rowCount=this.columns>0?Math.ceil(this.items.length/this.columns):this.items.length,this.totalHeight=Math.max(0,this.rowCount*this.rowHeight),this.updateContainerPosition(),this.spacer.style.height=`${this.totalHeight}px`,this.windowEl.style.top=`${this.paddingTop}px`,this.windowEl.style.paddingBottom=`${this.paddingBottom}px`,this.metricsDirty=!1}updateContainerPosition(){let t=this.container,n=0;for(;t&&t!==document.body;)n+=t.offsetTop,t=t.offsetParent;this.containerTop=n}update(){this.metricsDirty&&this.refreshMetrics(),this.syncVisibleRange()}syncVisibleRange(){if(!this.items.length){this.windowEl.style.transform="translate3d(0, 0, 0)",this.itemsHost.replaceChildren(),this.range={start:0,end:0};return}let t=window.scrollY,n=t+window.innerHeight,r=this.containerTop+this.paddingTop,o=r+this.totalHeight;window.__VLIST_DEBUG;let i;t<=r?i=0:t>=o?i=Math.max(0,this.rowCount-1):i=Math.floor((t-r)/this.rowHeight);let s;n>=o?s=Math.max(0,this.rowCount-1):n<=r?s=0:s=Math.ceil((n-r)/this.rowHeight),i=Math.max(0,Math.min(i,Math.max(0,this.rowCount-1))-this.overscan),s=Math.min(Math.max(0,this.rowCount-1),s+this.overscan);let a=Math.max(0,Math.min(this.items.length,i*this.columns)),c=Math.max(a,Math.min(this.items.length,(s+1)*this.columns));if(a===this.range.start&&c===this.range.end){let p=!1;for(let h=a;h<c;h++){let b=this.keyFor(this.items[h],h);if(!this.renderedKeys.has(b)){p=!0;break}}if(!p)return}this.range={start:a,end:c};let u=Math.floor(a/this.columns)*this.rowHeight;this.windowEl.style.transform=`translate3d(0, ${u}px, 0)`;let d=new Set,f=[];for(let p=a;p<c;p++){let h=this.items[p],b=this.keyFor(h,p),v=this.nodeCache.get(b);if(v){if(this.updateItem){let k=this.updateItem(v,h,p);if(k instanceof HTMLElement&&k!==v)v=k,this.nodeCache.set(b,v);else if(!(k instanceof HTMLElement))continue}}else{if(v=this.renderItem(h,p),!(v instanceof HTMLElement))continue;this.nodeCache.set(b,v)}d.add(b),f.push(v)}let g=this.itemsHost.children;if(g.length===f.length){let p=!0;for(let h=0;h<f.length;h++)if(g[h]!==f[h]){p=!1;break}if(p){this.renderedKeys=d;return}}let m=new Map;for(let p=0;p<g.length;p++)m.set(g[p],p);for(let p=0;p<f.length;p++){let h=f[p],b=g[p];b!==h&&(m.has(h)?this.itemsHost.insertBefore(h,b||null):this.itemsHost.insertBefore(h,b||null))}for(;this.itemsHost.children.length>f.length;)this.itemsHost.lastChild.remove();this.renderedKeys=d}}});var oa={};Ze(oa,{renderGrid:()=>V});function Jd(e){let t=M("article","card");t.dataset.kind=(e==null?void 0:e.type)==="tv"?"show":"movie",t.tabIndex=0,t.setAttribute("role","button"),e!=null&&e.title&&t.setAttribute("aria-label",e.title);let n=M("div","card__media"),r=new Image;r.loading="lazy",r.decoding="async",r.className="card__img",r.alt=(e==null?void 0:e.title)||"",r.style.aspectRatio="2 / 3";let o=Hn(e);o&&(r.src=o);let i=M("div","card__media-gradient");i.setAttribute("aria-hidden","true");let s=af(e),a=M("div","card__badges");s.forEach(b=>{b instanceof HTMLElement&&a.append(b)}),n.append(r,i),a.childElementCount&&n.append(a);let c=ra(e);if(c>0){let b=M("div","card__progress"),v=document.createElement("span");v.style.width=`${Math.max(0,Math.min(100,c))}%`,b.append(v),n.append(b)}let l=M("div","card__body"),u=document.createElement("h3");u.className="card__title",u.textContent=(e==null?void 0:e.title)||"",e!=null&&e.title&&u.setAttribute("title",e.title);let d=M("div","card__meta"),f=ta(e);d.textContent=f.join(" \u2022 "),l.append(u,d);let g=M("div","card__actions"),m=M("div","card__chips"),p=ue(e==null?void 0:e.genres);pn(m,p,3);let h=document.createElement("button");return h.type="button",h.className="card__primary",Xs(h,e),h.addEventListener("click",b=>{b.stopPropagation(),Fr(e),Xs(h,e)}),g.append(m,h),t.append(n,l,g),t.addEventListener("click",()=>Ys(e)),t.addEventListener("keydown",b=>{b.target===t&&(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),Ys(e))}),t}function Zd(e,t){let n=(t||[]).slice().sort((d,f)=>{let g=Number($(d))||0,m=Number($(f))||0;return g!==m?g-m:(d.title||"").localeCompare(f.title||"","de")}),r=n.map(d=>Number($(d))||0).filter(Boolean),o=r.length?Math.min(...r):"",i=n.map(d=>new Date(d.addedAt||0).getTime()).filter(Number.isFinite),s=i.length?new Date(Math.max(...i)).toISOString():null,a=n.map(d=>{var f;return Number((f=d.rating)!=null?f:d.audienceRating)}).filter(Number.isFinite),c=a.length?a.reduce((d,f)=>d+f,0)/a.length:null,l=n.find(d=>d.thumbFile)||n[0]||null,u=Array.from(new Set(n.flatMap(d=>ue(d.genres)))).slice(0,4);return{isCollectionGroup:!0,type:"collection",title:e,collectionName:e,items:n,itemCount:n.length,year:o||"",addedAt:s,rating:c,posterItem:l,genres:u}}function Qd(e){let t=document.getElementById("groupCollections"),n=document.getElementById("collectionFilter"),r=n&&n.value;if(!t||!t.checked||r)return e;let o=new Map;e.forEach(s=>{Re(s).forEach(a=>{o.has(a)||o.set(a,[]),o.get(a).push(s)})});let i=[];return o.forEach((s,a)=>{i.push(Zd(a,s))}),i.sort((s,a)=>s.title.localeCompare(a.title,"de")),i}function ef(e){let t=M("article","card card--collection");t.dataset.kind="collection",t.tabIndex=0,t.setAttribute("role","button"),e!=null&&e.title&&t.setAttribute("aria-label",e.title);let n=M("div","card__media"),r=e.posterItem||{},o=new Image;o.loading="lazy",o.decoding="async",o.className="card__img",o.alt=(e==null?void 0:e.title)||"",o.style.aspectRatio="2 / 3";let i=Hn(r);i&&(o.src=i);let s=M("div","card__media-gradient");s.setAttribute("aria-hidden","true");let a=cf(e),c=M("div","card__badges");a.forEach(p=>{p instanceof HTMLElement&&c.append(p)}),n.append(o,s),c.childElementCount&&n.append(c);let l=M("div","card__body"),u=document.createElement("h3");u.className="card__title",u.textContent=e.title||"",e!=null&&e.title&&u.setAttribute("title",e.title);let d=M("div","card__meta"),f=na(e);d.textContent=f.filter(Boolean).join(" \u2022 "),l.append(u,d);let g=M("div","card__actions"),m=M("div","card__chips");return pn(m,e.genres||[],3),g.append(m),t.append(n,l,g),t.addEventListener("click",()=>{let p=document.getElementById("collectionFilter");p&&(p.value=e.collectionName||e.title||"",p.dispatchEvent(new Event("change",{bubbles:!0})))}),t.addEventListener("keydown",p=>{if(p.target===t&&(p.key==="Enter"||p.key===" ")){p.preventDefault();let h=document.getElementById("collectionFilter");h&&(h.value=e.collectionName||e.title||"",h.dispatchEvent(new Event("change",{bubbles:!0})))}}),t}function tf(e){return Bn||(Bn=new Nn({container:e,overscan:1,estimatedItemHeight:460,minItemWidth:190,getKey:nf,getSignature:ho,renderItem(t){return Js(t)},updateItem(t,n){return rf(t,n)}}),Bn)}function nf(e,t){if(e!=null&&e.isCollectionGroup){let r=e.collectionName||e.title||"";return r?`collection:${r}`:`collection-index-${t}`}let n=go(e);return n?`item:${n}`:`item-index-${t}`}function Js(e){let t=e!=null&&e.isCollectionGroup?ef(e):Jd(e);return t instanceof HTMLElement&&(t[fo]=ho(e)),t}function rf(e,t){if(e instanceof HTMLElement){let r=ho(t);if(e[fo]===r)return e[fo]=r,e}let n=Js(t);return n instanceof HTMLElement?ff(e,n):e}function V(e){let{movies:t,shows:n,filtered:r}=x(),o=(e==="shows"?n:t)||[],i=Array.isArray(r)?r:o,s=Qd(i),a=document.getElementById("grid");if(!a)return;let c=Vs!==e;Vs=e,c&&of(a),tf(a).setItems(s),c&&sf(a);let u=document.getElementById("empty");u&&(u.hidden=s.length>0),a.setAttribute("aria-busy","false")}function of(e){e&&(e.classList.remove("is-entering","is-ready"),e.classList.add("is-leaving"))}function sf(e){e&&(e.classList.remove("is-leaving"),e.classList.add("is-entering"),requestAnimationFrame(()=>{e.classList.add("is-ready"),setTimeout(()=>e.classList.remove("is-entering","is-ready"),240)}))}function Hn(e){var r;if(!e)return"";let t=bn()&&(((r=e==null?void 0:e.tmdb)==null?void 0:r.poster)||(e==null?void 0:e.tmdbPoster)),n=(e==null?void 0:e.thumbFile)||(e==null?void 0:e.poster)||(e==null?void 0:e.art)||(e==null?void 0:e.thumb)||"";return t||n||""}function Zs(e){var o;let t=[];$e(e)&&t.push("Neu");let n=String((e==null?void 0:e.contentRating)||"").trim();n&&t.push(n);let r=Number((o=e==null?void 0:e.rating)!=null?o:e==null?void 0:e.audienceRating);return Number.isFinite(r)&&t.push(`\u2605 ${O(r)}`),t.slice(0,3)}function af(e){return Zs(e).map(ea)}function Qs(e){let t=[];return Number.isFinite(e==null?void 0:e.itemCount)&&e.itemCount>0&&t.push(`${e.itemCount} Titel`),e!=null&&e.year&&t.push(String(e.year)),t}function cf(e){return Qs(e).map(ea)}function ea(e){let t=document.createElement("span");return t.className="badge",t.textContent=String(e||""),t}function Xs(e,t){if(!e)return;let n=Mr(t);e.textContent=n?"Gemerkt":"Merken",e.classList.toggle("active",n),e.setAttribute("aria-pressed",n?"true":"false")}function ta(e){var s;let t=[],n=$(e);n&&t.push(String(n));let r=lf(e);r&&t.push(r);let o=Number((s=e==null?void 0:e.rating)!=null?s:e==null?void 0:e.audienceRating);Number.isFinite(o)&&t.push(`\u2605 ${O(o)}`);let i=(e==null?void 0:e.studio)||(e==null?void 0:e.network)||"";return i&&t.push(i),t}function na(e){let t=[];e!=null&&e.year&&t.push(String(e.year));let n=Number(e==null?void 0:e.itemCount);Number.isFinite(n)&&t.push(`${n} Titel`);let r=Number(e==null?void 0:e.rating);return Number.isFinite(r)&&t.push(`\u2605 ${O(r)}`),t}function lf(e){var r,o;let t=(o=(r=e==null?void 0:e.runtimeMin)!=null?r:e==null?void 0:e.durationMin)!=null?o:e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null,n=Number(t);return!Number.isFinite(n)||n<=0?"":(e==null?void 0:e.type)==="tv"?`~${n} min/Ep`:`${n} min`}function ra(e){var r;let t=Number((r=e==null?void 0:e.viewOffset)!=null?r:e==null?void 0:e.viewoffset),n=Number(e==null?void 0:e.duration);return!Number.isFinite(t)||!Number.isFinite(n)||n<=0?0:Math.max(1,Math.min(100,Math.round(t/n*100)))}function go(e){var n,r;if(!e)return"";let t=((n=e==null?void 0:e.ids)==null?void 0:n.imdb)||((r=e==null?void 0:e.ids)==null?void 0:r.tmdb);return t?String(t):e!=null&&e.ratingKey?String(e.ratingKey):""}function ho(e){return e!=null&&e.isCollectionGroup?df(e):uf(e)}function uf(e){let t=ue(e==null?void 0:e.genres).slice(0,3),n=Zs(e),r=ta(e);return JSON.stringify({id:go(e),title:(e==null?void 0:e.title)||"",poster:Hn(e),badges:n,meta:r,progress:ra(e),watch:Mr(e),genres:t})}function df(e){let t=(e==null?void 0:e.posterItem)||null,n=Array.isArray(e==null?void 0:e.genres)?e.genres.slice(0,3).map(String):[],r=Qs(e),o=na(e),i=Number(e==null?void 0:e.itemCount),s=Number(e==null?void 0:e.rating);return JSON.stringify({name:(e==null?void 0:e.collectionName)||(e==null?void 0:e.title)||"",title:(e==null?void 0:e.title)||"",itemCount:Number.isFinite(i)?i:null,year:(e==null?void 0:e.year)||"",rating:Number.isFinite(s)?s:null,poster:Hn(t),badges:r,meta:o,genres:n})}function ff(e,t){if(!(t instanceof HTMLElement))return e;if(!(e instanceof HTMLElement))return t;let n=e.parentNode,r=document.activeElement===e;return n&&n.replaceChild(t,e),r&&typeof t.focus=="function"&&requestAnimationFrame(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}}),t}function gf(e,t){if(!e||!t)return;let n=`#/${e}/${t}`,r=(window.location.hash||"")===n;$n(n,{silent:!0,replace:r})}function Ys(e){if(!e)return;let t=(e==null?void 0:e.type)==="tv"?"show":"movie",n=go(e);n&&gf(t,n),t==="show"?gt(e):ft(e)}var fo,Bn,Vs,Rn=_(()=>{Z();an();de();Nr();Fn();ia();Ws();fo="__gridVirtualSignature";Bn=null;Vs=null});var Ao={};Ze(Ao,{applyFilters:()=>ht,computeFacets:()=>yo,initFilters:()=>Eo,renderFacets:()=>vo,setFiltersUpdatedHandler:()=>So,updateFiltersAndGrid:()=>Xt});function sa(e){return String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function hf(e,t){let n=sa(t.query||""),r=!!t.onlyNew,o=Number(t.yearFrom)||null,i=Number(t.yearTo)||null,s=t.genres||new Set,a=t.collection||"";if(n&&!sa([e.title,e.originalTitle,e.summary,e.studio,ue(e.genres).join(" "),(e.roles||[]).map(u=>u&&(u.tag||u.role||u.name)).join(" "),Re(e).join(" ")].filter(Boolean).join(" ")).includes(n)||r&&!$e(e))return!1;let c=Number($(e))||null;if(o&&(!c||c<o)||i&&(!c||c>i))return!1;if(s.size){let l=new Set(ue(e.genres));for(let u of s)if(!l.has(u))return!1}return!(a&&!new Set(Re(e)).has(a))}function mf(e,t){let n=e.slice();switch(t){case"year-desc":n.sort((r,o)=>(Number($(o))||0)-(Number($(r))||0)||String(r.title||"").localeCompare(String(o.title||""),"de"));break;case"year-asc":n.sort((r,o)=>(Number($(r))||0)-(Number($(o))||0)||String(r.title||"").localeCompare(String(o.title||""),"de"));break;case"title-desc":n.sort((r,o)=>String(o.title||"").localeCompare(String(r.title||""),"de"));break;case"added-desc":n.sort((r,o)=>new Date(o.addedAt||0)-new Date(r.addedAt||0));break;case"title-asc":default:n.sort((r,o)=>String(r.title||"").localeCompare(String(o.title||""),"de"))}return n}function yo(e,t){let n=new Set,r=new Set,o=new Set,i=a=>(a||[]).forEach(c=>{ue(c.genres).forEach(u=>n.add(u));let l=c.year||(c.originallyAvailableAt?String(c.originallyAvailableAt).slice(0,4):"");l&&r.add(Number(l)),Re(c).forEach(u=>o.add(u))});i(e),i(t);let s=[...r].sort((a,c)=>a-c);return{genres:[...n].sort(),years:s,collections:[...o].sort((a,c)=>a.localeCompare(c,"de"))}}function vo(e){let t=R("#yearFrom"),n=R("#yearTo");t&&t.replaceChildren(new Option("Ab Jahr",""),...e.years.map(i=>new Option(String(i),String(i)))),n&&n.replaceChildren(new Option("Bis Jahr",""),...e.years.map(i=>new Option(String(i),String(i))));let r=R("#collectionFilter");r&&r.replaceChildren(new Option("Alle Collections",""),...e.collections.map(i=>new Option(i,i)));let o=R("#genreFilters");if(o){let i=e.genres.map(s=>{let a=document.createElement("button");return a.type="button",a.className="chip",a.textContent=s,a.dataset.name=s,a});o.replaceChildren(...i),bo()}}function pf(){var c,l,u,d,f;let e=document.getElementById("search")||document.getElementById("q"),t=((e==null?void 0:e.value)||"").trim(),n=((c=R("#onlyNew"))==null?void 0:c.checked)||!1,r=((l=R("#yearFrom"))==null?void 0:l.value)||"",o=((u=R("#yearTo"))==null?void 0:u.value)||"",i=((d=R("#collectionFilter"))==null?void 0:d.value)||"",s=((f=R("#sort"))==null?void 0:f.value)||"title-asc",a=new Set;return document.querySelectorAll("#genreFilters .chip.active").forEach(g=>a.add(g.dataset.name)),{query:t,onlyNew:n,yearFrom:r,yearTo:o,collection:i,genres:a,sort:s}}function ht(){let e=x(),n=e.view==="shows"?e.shows:e.movies,r=pf(),o=(n||[]).filter(s=>hf(s,r)),i=mf(o,r.sort);return Pe({filtered:i}),i}function bf(){mo||(mo=Promise.resolve().then(()=>(Rn(),oa))),mo.then(e=>{let t=e&&e.renderGrid;typeof t=="function"&&t(x().view)}).catch(console.error)}function So(e){po=typeof e=="function"?e:null}function Xt(){let e=ht();if(bf(),po)try{let t=Array.isArray(e)?e.slice():[];po(t,x().view)}catch{}return e}function bo(){let e=document.getElementById("genreFilters");if(!e)return;let t=e.querySelectorAll(".chip.active").length;e.dataset.state=t>0?"active":"empty",e.dataset.count=String(t)}function Eo(){let e=R("#sort");e&&e.options.length===0&&[["title-asc","Titel A\u2013Z"],["title-desc","Titel Z\u2013A"],["year-desc","Jahr \u2193"],["year-asc","Jahr \u2191"],["added-desc","Zuletzt hinzugef\xFCgt"]].forEach(([o,i])=>e.add(new Option(i,o)));let t=(o,i="input")=>{let s=R(o);s&&(s.addEventListener(i,()=>{Xt()}),i==="input"&&s instanceof HTMLInputElement&&s.type==="search"&&s.addEventListener("search",()=>{Xt()}))};t("#search"),t("#q"),t("#onlyNew","change"),t("#yearFrom","change"),t("#yearTo","change"),t("#collectionFilter","change"),t("#sort","change"),t("#groupCollections","change");let n=R("#yearReset");n&&n.addEventListener("click",()=>{let o=R("#yearFrom"),i=R("#yearTo");o&&(o.value=""),i&&(i.value=""),Xt()});let r=R("#genreFilters");r&&(r.addEventListener("click",o=>{let i=o.target;i instanceof HTMLElement&&i.classList.contains("chip")&&(i.classList.toggle("active"),bo(),Xt())}),bo())}var mo,po,wo=_(()=>{Z();an();de();mo=null;po=null});var mt={};Ze(mt,{clearCache:()=>Sf,hydrateOptional:()=>zn,validateToken:()=>Cf});function Q(...e){try{}catch{}}function ua(e={}){let t=e.lang||e.language||"de-DE",n=e.region||e.iso||"DE",r=Number(e.ttlHours||e.tmdbTtlHours||24)||24,o=e.imageBase||e.tmdbImageBase;return{language:t,region:n,ttlHours:r,imageBase:o}}function yf(e,t){let{language:n,region:r,ttlHours:o,imageBase:i}=ua(e),s=t!=null&&t.kind?`${t.kind}:${t.value||""}`:"none";return JSON.stringify({language:n,region:r,ttlHours:o,imageBase:i,auth:s})}function Dn(e={},t){let n=yf(e,t);if(xe&&ca===n)return xe;let{language:r,region:o,ttlHours:i,imageBase:s}=ua(e),a={cacheStore:Qi,language:r,region:o,ttlHours:i};return s&&(a.imageBase=s),(t==null?void 0:t.kind)==="bearer"&&t.value?a.token=t.value:(t==null?void 0:t.kind)==="apikey"&&t.value&&(a.apiKey=t.value),xe=xn(a),ca=n,xe}function vf(e){var s,a;let t=(e==null?void 0:e.type)==="tv"?"tv":"movie",n=((s=e==null?void 0:e.ids)==null?void 0:s.imdb)||"",r=((a=e==null?void 0:e.ids)==null?void 0:a.tmdb)||"",o=((e==null?void 0:e.title)||(e==null?void 0:e.name)||"").toLowerCase(),i=String((e==null?void 0:e.year)||"").slice(0,4);return[t,n,r,o,i].filter(Boolean).join("|")}function Sf(){var e;try{localStorage.removeItem("tmdbCache")}catch(t){Q("Failed to clear legacy TMDB cache from storage:",t)}Ue.clear();try{Kr("tmdb:")}catch(t){Q("Failed to clear metadata cache store:",t)}if(xe)try{(e=xe.clear)==null||e.call(xe,"tmdb:")}catch(t){Q("Failed to clear metadata service cache:",t)}}function Ef(e){try{let t=localStorage.getItem("tmdbToken");if(t&&t.trim())return{kind:"bearer",value:t.trim()}}catch(t){Q("Failed to read TMDB token from storage:",t)}if(e!=null&&e.tmdbToken){let t=String(e.tmdbToken).trim();if(t)return{kind:"bearer",value:t}}if(e!=null&&e.tmdbApiKey){let t=String(e.tmdbApiKey).trim();if(t)return{kind:"apikey",value:t}}return{kind:"none",value:""}}async function Af(e,t,n,r){var o,i,s,a,c,l;if(!t)return null;try{let f=await Dn(n,r).client.get(`/find/${encodeURIComponent(t)}`,{external_source:"imdb_id"});return e==="movie"?(s=(i=(o=f==null?void 0:f.movie_results)==null?void 0:o[0])==null?void 0:i.id)!=null?s:null:(l=(c=(a=f==null?void 0:f.tv_results)==null?void 0:a[0])==null?void 0:c.id)!=null?l:null}catch(u){return Q(`Failed to resolve external id ${t}:`,u),null}}async function wf(e,t,n,r,o){var s;let i=String(t||"").trim();if(!i)return null;try{let c=Dn(r,o).client,l={query:i,include_adult:!1};n&&(e==="movie"?l.year=n:l.first_air_date_year=n);let u=await c.get(`/search/${e}`,l),d=Array.isArray(u==null?void 0:u.results)?u.results[0]:null;return(s=d==null?void 0:d.id)!=null?s:null}catch(a){return Q(`Search failed for ${e} ${t}:`,a),null}}async function kf(e,t,n){var a,c;let r=(e==null?void 0:e.type)==="tv"?"tv":"movie",o=vf(e);if(Ue.has(o))return Ue.get(o);let i=Dn(t,n),s=(a=e==null?void 0:e.ids)==null?void 0:a.tmdb;if(!s&&((c=e==null?void 0:e.ids)!=null&&c.imdb)&&(s=await Af(r,e.ids.imdb,t,n)),!s){let l=e!=null&&e.year?Number(String(e.year).slice(0,4)):void 0;s=await wf(r,(e==null?void 0:e.title)||(e==null?void 0:e.name),l,t,n)}if(!s)return Ue.set(o,null),null;try{let l=r==="tv"?await i.getTvEnriched(s):await i.getMovieEnriched(s);if(!l)return Ue.set(o,null),null;let u={id:l.id||String(s),poster:l.poster||"",backdrop:l.backdrop||"",url:l.url||`https://www.themoviedb.org/${r}/${s}`};return Ue.set(o,u),u}catch(l){return Q(`Hydration failed for ${r} ${s}:`,l),Ue.set(o,null),null}}async function zn(e,t,n={}){try{let r=Ef(n);if(!r.value)return;Dn(n,r);let o=[...e||[],...t||[]],i=40,s=0,a=async()=>{let c=o.slice(s,s+4);s+=4,await Promise.all(c.map(async u=>{let d=await kf(u,n,r);d&&(u.tmdb={id:d.id,poster:d.poster,backdrop:d.backdrop,url:d.url},u.ids=u.ids||{},!u.ids.tmdb&&d.id&&(u.ids.tmdb=String(d.id)))}));try{window.dispatchEvent(new CustomEvent("tmdb:chunk",{detail:{updated:c.length,index:s}}))}catch(u){Q("Failed to dispatch tmdb:chunk event:",u)}if(s<Math.min(o.length,i))window.requestIdleCallback?window.requestIdleCallback(a,{timeout:500}):setTimeout(a,250);else try{window.dispatchEvent(new CustomEvent("tmdb:done",{detail:{total:Math.min(o.length,i)}}))}catch(u){Q("Failed to dispatch tmdb:done event:",u)}};a()}catch(r){Q("hydrateOptional failed to start:",r)}}function la(e,t){if(!t||t.kind==="none")return{url:e,init:{}};if(t.kind==="bearer")return{url:e,init:{headers:{Authorization:`Bearer ${t.value}`,Accept:"application/json"}}};let n=e.includes("?")?"&":"?";return{url:`${e}${n}api_key=${encodeURIComponent(t.value)}`,init:{headers:{Accept:"application/json"}}}}async function Cf(e){let t=String(e||"").trim();if(!t)throw new Error("empty");let n=/^[a-f0-9]{32}$/i.test(t),r=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(t),o=i=>{try{let s=i.split(".")[1],c=atob((l=>l+"=".repeat((4-l.length%4)%4))(s.replace(/-/g,"+").replace(/_/g,"/")));return JSON.parse(c)}catch(s){return Q("Failed to decode TMDB JWT payload:",s),null}};if(n){let{url:i,init:s}=la(`${aa}/configuration`,{kind:"apikey",value:t});return(await fetch(i,s)).ok?{ok:!0,as:"apikey",hint:"v3Key"}:{ok:!1,as:"apikey",hint:"looksV3"}}if(r){let i=o(t);if(i&&typeof i=="object"){let c=String(i.iss||"");if(c&&!/themoviedb\.org/i.test(c))return{ok:!1,as:"bearer",hint:"issMismatch"}}let{url:s,init:a}=la(`${aa}/trending/movie/day`,{kind:"bearer",value:t});try{if((await fetch(s,a)).ok)return{ok:!0,as:"bearer",hint:null}}catch(c){Q("Bearer token validation request failed:",c)}return{ok:!0,as:"bearer",hint:"structOnly"}}return{ok:!1,as:"bearer",hint:null}}var aa,Ue,xe,ca,Ge=_(()=>{Cn();at();aa="https://api.themoviedb.org/3",Ue=new Map,xe=null,ca=""});async function ha(){pt=[];let e=null,t=null;try{let n=await fetch(Tf,{cache:"no-cache"});if(!n.ok)throw new Error(`HTTP ${n.status}`);e=await If(n)}catch(n){t=n,qe(`Failed to load policy (${(n==null?void 0:n.message)||"unknown error"})`),q("Hero-Policy konnte nicht geladen werden",(n==null?void 0:n.message)||"Unbekannter Fehler")}return X=xf(e),ga=Date.now(),Lf(t),X}function bt(){return ko(X)}function ma(){return{movies:X.poolSizeMovies,series:X.poolSizeSeries}}function pa(){let e={};return fa.forEach(t=>{e[t]={quota:X.slots[t].quota}}),e}function ba(){return{...X.diversity}}function ya(){return{...X.rotation}}function va(){return{...X.textClamp}}function Sa(){return{...X.fallback}}function Ea(){return X.language}function Yt(){let e=Number(X.cache.ttlHours),t=Number(X.cache.graceMinutes);return{ttlHours:e,ttlMs:e*60*60*1e3,graceMinutes:t,graceMs:t*60*1e3}}function jn(){return pt.slice()}function Aa(){return ga}function xf(e){let t=ko(da);if(!e||typeof e!="object")return qe("Policy payload missing or invalid, using defaults."),t;t.poolSizeMovies=pe(e.poolSizeMovies,t.poolSizeMovies,"poolSizeMovies"),t.poolSizeSeries=pe(e.poolSizeSeries,t.poolSizeSeries,"poolSizeSeries");let n=e.slots&&typeof e.slots=="object"?e.slots:{};fa.forEach(u=>{let d=n[u],f=On(d==null?void 0:d.quota,0,1,t.slots[u].quota,`slots.${u}.quota`);t.slots[u]={quota:f}});let r=e.diversity&&typeof e.diversity=="object"?e.diversity:{};t.diversity={genre:On(r.genre,0,1,t.diversity.genre,"diversity.genre"),year:On(r.year,0,1,t.diversity.year,"diversity.year"),antiRepeat:On(r.antiRepeat,0,1,t.diversity.antiRepeat,"diversity.antiRepeat")};let o=e.rotation&&typeof e.rotation=="object"?e.rotation:{};t.rotation={intervalMinutes:pe(o.intervalMinutes,t.rotation.intervalMinutes,"rotation.intervalMinutes"),minPoolSize:pe(o.minPoolSize,t.rotation.minPoolSize,"rotation.minPoolSize")};let i=e.textClamp&&typeof e.textClamp=="object"?e.textClamp:{};t.textClamp={title:pe(i.title,t.textClamp.title,"textClamp.title"),subtitle:pe(i.subtitle,t.textClamp.subtitle,"textClamp.subtitle"),summary:pe(i.summary,t.textClamp.summary,"textClamp.summary")};let s=e.fallback&&typeof e.fallback=="object"?e.fallback:{};t.fallback={prefer:_f(s.prefer,t.fallback.prefer),allowDuplicates:typeof s.allowDuplicates=="boolean"?s.allowDuplicates:t.fallback.allowDuplicates},t.language=typeof e.language=="string"&&e.language.trim()?e.language.trim():t.language,t.language!==(e.language||"").trim()&&qe("language missing or invalid, defaulted to en-US.");let a=e.cache&&typeof e.cache=="object"?e.cache:{},c=pe(a.ttlHours,t.cache.ttlHours,"cache.ttlHours"),l=pe(a.graceMinutes,t.cache.graceMinutes,"cache.graceMinutes",!0);return t.cache={ttlHours:c,graceMinutes:l},t}function pe(e,t,n,r){let o=Number(e);return Number.isFinite(o)&&(r?o>=0:o>0)?Math.floor(o):(e!=null&&qe(`${n} invalid (${e}), using default (${t}).`),t)}function On(e,t,n,r,o){let i=Number(e);return Number.isFinite(i)&&i>=t&&i<=n?i:(e!=null&&qe(`${o} invalid (${e}), using default (${r}).`),r)}function _f(e,t){return e==="movies"||e==="series"||e==="shows"?e==="shows"?"series":e:(e!=null&&qe(`fallback.prefer invalid (${e}), using default (${t}).`),t)}function ko(e){return JSON.parse(JSON.stringify(e))}async function If(e){try{return await e.json()}catch(t){return qe(`Failed to parse hero policy JSON (${(t==null?void 0:t.message)||t}).`),null}}function qe(e){e&&pt.push(e)}function Lf(e){if(pt.length){if(e){let t=pt.slice(1);t.length&&q("Hero-Policy Hinweise",t.join(" \u2022 "));return}q("Hero-Policy Hinweise",pt.join(" \u2022 "))}}var Tf,da,fa,X,ga,pt,Kn=_(()=>{fn();Tf="hero.policy.json",da=Object.freeze({poolSizeMovies:10,poolSizeSeries:10,slots:{new:{quota:.3},topRated:{quota:.3},oldButGold:{quota:.2},random:{quota:.2}},diversity:{genre:.4,year:.35,antiRepeat:.25},rotation:{intervalMinutes:360,minPoolSize:6},textClamp:{title:96,subtitle:240,summary:220},fallback:{prefer:"movies",allowDuplicates:!1},language:"en-US",cache:{ttlHours:24,graceMinutes:15}}),fa=["new","topRated","oldButGold","random"],X=ko(da),ga=0,pt=[]});function Y(...e){try{}catch{}}function ee(){return Date.now()}function Gn(e){return new Promise(t=>setTimeout(t,Math.max(0,e||0)))}function Pf(e,t){if(e===t)return!0;if(!e||!t)return!1;let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let o of n)if(e[o]!==t[o])return!1;return!0}function Wn(){var e;return{active:!!B.active,until:Number(B.until)||0,retryAfterMs:Number(B.retryAfterMs)||0,lastStatus:(e=B.lastStatus)!=null?e:null,lastHitAt:Number(B.lastHitAt)||0,strikes:Number(B.strikes)||0}}function Nf(){let e=Wn();for(let t of xo)try{t(e)}catch(n){Y("Rate limit listener failed:",(n==null?void 0:n.message)||n)}}function qn(e){let t={...Wn(),...e};return Pf(B,t)||(B=t,Nf()),B}function Ta(e){return Math.min(8e3,400*Math.pow(2,Math.max(0,e)))}function Bf(e,t){let n=1200*Math.pow(2,Math.max(0,e-1)),r=Math.max(t||0,n);return Math.min(6e4,r)}function Hf(e,t=429){let n=ee(),r=Math.min(5,(B.strikes||0)+1),o=Bf(r,e);return yt=Math.max(yt,n+o),qn({active:!0,strikes:r,retryAfterMs:o,until:n+o,lastStatus:t,lastHitAt:n}),o}function Rf(){if(!B.strikes)return;let e=Math.max(0,B.strikes-1);qn({strikes:e,active:B.active&&B.until>ee()})}function Fa(){let e=ee();B.active&&e>=B.until?qn({active:!1,retryAfterMs:0,until:0}):!B.active&&B.strikes>0&&e-B.lastHitAt>9e4&&qn({strikes:Math.max(0,B.strikes-1)}),yt&&e>=yt&&(yt=0)}function $f(e,t,n){let r=e==="tv"?"tv":"movie",o=String(n||"en-US").trim()||"en-US";return`${r}:${String(t||"").trim()}:${o}`}function Pa(){if(ka||(ka=!0,typeof localStorage=="undefined"))return;let e;try{if(e=localStorage.getItem(Ma),!e)return}catch(r){Y("Failed to read TMDB cache from storage:",(r==null?void 0:r.message)||r);return}let t;try{t=JSON.parse(e)}catch(r){Y("Stored TMDB cache invalid JSON:",(r==null?void 0:r.message)||r);return}if(!Array.isArray(t))return;let n=ee();t.forEach(([r,o])=>{var s,a,c,l;if(!r||!o)return;let i=Number((a=(s=o.ts)!=null?s:o.timestamp)!=null?a:o.fetchedAt);Number.isFinite(i)&&(n-i>864e5||re.set(String(r),{ts:i,data:(l=(c=o.data)!=null?c:o.payload)!=null?l:null}))})}function Df(){let e=ee(),t=!1;for(let[n,r]of re.entries()){if(!r||typeof r!="object"){re.delete(n),t=!0;continue}let o=Number(r.ts);(!Number.isFinite(o)||e-o>864e5)&&(re.delete(n),t=!0)}t&&Io()}function xa(e){Pa();let t=re.get(e);if(!t)return null;let n=Number(t.ts);return!Number.isFinite(n)||ee()-n>864e5?(re.delete(e),Io(),null):t}function zf(e,t){Pa(),re.set(e,{ts:ee(),data:t}),Of(),Io()}function Of(){if(re.size<=60)return;let e=Array.from(re.entries());e.sort((n,r)=>{var s,a;let o=Number(((s=n[1])==null?void 0:s.ts)||0);return Number(((a=r[1])==null?void 0:a.ts)||0)-o});let t=e.slice(0,60);re=new Map(t)}function Io(){typeof localStorage!="undefined"&&(Co||(Co=setTimeout(()=>{Co=null,jf()},120)))}function jf(){if(typeof localStorage=="undefined")return;let e=Array.from(re.entries()).map(([t,n])=>{var r,o;return[t,{ts:(r=n==null?void 0:n.ts)!=null?r:ee(),data:(o=n==null?void 0:n.data)!=null?o:null}]});try{localStorage.setItem(Ma,JSON.stringify(e))}catch(t){Y("Failed to persist TMDB cache:",(t==null?void 0:t.message)||t)}}function Kf(e){if(!e)return 0;let t=Number(e);if(Number.isFinite(t))return Math.max(0,t*1e3);let n=Date.parse(e);return Number.isFinite(n)?Math.max(0,n-ee()):0}function Uf(e){return e===429||e>=500&&e<600}function Gf(e){return e&&(e.name==="AbortError"||e.code==="ABORT_ERR")}function qf(e){return Gf(e)?!1:!!(e&&typeof e=="object"&&(e.name==="TypeError"&&/network/i.test(e.message||"")||/network/i.test((e==null?void 0:e.message)||"")))}function Wf(e,t){if(!t||!t.value)return{url:e,init:{headers:{Accept:"application/json"}}};if(t.kind==="apikey"){let n=e.includes("?")?"&":"?";return{url:`${e}${n}api_key=${encodeURIComponent(t.value)}`,init:{headers:{Accept:"application/json"}}}}return{url:e,init:{headers:{Accept:"application/json",Authorization:`Bearer ${t.value}`}}}}async function Vf(){Fa();let e=ee(),t=Math.max(0,Ca+400-e),n=Math.max(0,yt-e),r=Math.max(t,n);r>0&&await Gn(r),Ca=ee()}async function vt(e,t,{signal:n}={},r=0){let{url:o,init:i}=Wf(e,t),s={...i,signal:n};await Vf();let a;try{a=await fetch(o,s)}catch(c){if(r<4&&qf(c)){let l=Ta(r);return await Gn(l),vt(e,t,{signal:n},r+1)}throw c}if(!a.ok){let c=a.status,l=Uf(c)&&r<4;if(c===429){let f=Kf(a.headers.get("retry-after")),g=Hf(f,c);if(l)return await Gn(g),vt(e,t,{signal:n},r+1)}else if(l){let f=Ta(r);return await Gn(f),vt(e,t,{signal:n},r+1)}let u=await a.text().catch(()=>""),d=new Error(`HTTP ${c}${u?`: ${u}`:""}`);throw d.status=c,c===429&&(d.code="RATE_LIMIT"),d}return Rf(),Fa(),a.json()}function be(e,t){if(!e&&e!==0)return null;let n=String(e||"").trim();return n?{kind:t||(/^[a-f0-9]{32}$/i.test(n)?"apikey":"bearer"),value:n}:null}function Xf(){if(typeof localStorage=="undefined")return"";try{return localStorage.getItem("tmdbToken")||""}catch(e){return Y("Failed to read tmdbToken from storage:",(e==null?void 0:e.message)||e),""}}function Yf(e){if(!e)return{};let t=e.trim();if(!t)return{};if(t.startsWith("{")||t.startsWith("["))try{let r=JSON.parse(t);if(r&&typeof r=="object")return r}catch(r){Y("Failed to parse config.cfg JSON:",(r==null?void 0:r.message)||r)}let n={};return t.split(/\r?\n/).forEach(r=>{let o=r.trim();if(!o||o.startsWith("#")||o.startsWith(";"))return;let i=o.indexOf("=");if(i===-1)return;let s=o.slice(0,i).trim(),a=o.slice(i+1).trim();s&&(n[s]=a)}),n}async function Jf(){return Un||(Un=(async()=>{if(typeof fetch!="function")return{};try{let e=await fetch("config.cfg",{cache:"no-cache"});if(!e.ok)return e.status!==404&&Y(`Failed to load config.cfg (HTTP ${e.status})`),{};let t=await e.text();return To=Yf(t),To}catch(e){return Y("Error loading config.cfg:",(e==null?void 0:e.message)||e),{}}})(),Un)}function Zf(e){if(!e||typeof e!="object")return null;if(e.tmdbToken){let t=be(e.tmdbToken,"bearer");if(t)return{...t,source:"settings.tmdbToken"}}if(e.tmdbApiKey){let t=be(e.tmdbApiKey,"apikey");if(t)return{...t,source:"settings.tmdbApiKey"}}return null}function Qf(){let e=be(Xf(),"bearer");return e?{...e,source:"localStorage.tmdbToken"}:null}function eg(e){if(!e||typeof e!="object")return null;if(e.tmdbToken){let t=be(e.tmdbToken,"bearer");if(t)return{...t,source:"config.cfg.tmdbToken"}}if(e.tmdbApiKey){let t=be(e.tmdbApiKey,"apikey");if(t)return{...t,source:"config.cfg.tmdbApiKey"}}return null}async function Na(e={},t={}){if(t.credentials){if(typeof t.credentials=="string"||typeof t.credentials=="number"){let s=be(t.credentials);if(s)return{...s,source:"explicit"}}else if(t.credentials&&typeof t.credentials=="object"&&t.credentials.value){let s=be(t.credentials.value,t.credentials.kind);if(s)return{...s,source:t.credentials.source||"explicit"}}}let n=Zf(e);if(n)return n;let r=Qf();if(r)return r;if(e&&e.tmdbApiKey){let s=be(e.tmdbApiKey,"apikey");if(s)return{...s,source:"settings.tmdbApiKey"}}let o=await Jf().catch(()=>To||{}),i=eg(o);if(i)return i;if(t.fallbackCredential){let s=be(t.fallbackCredential);if(s)return{...s,source:"fallback"}}return null}function Ba(){return Wn()}function Ha(e){if(typeof e!="function")return()=>{};xo.add(e);try{e(Wn())}catch(t){Y("Rate limit listener threw during init:",(t==null?void 0:t.message)||t)}return()=>xo.delete(e)}function Ra(e,t="original"){let r=(typeof e=="string"?e:"").trim();if(!r)return"";let o=r.startsWith("/")?r:`/${r}`,i=String(t||"original").trim()||"original";return`${Mf}${i}${o}`}function St(e){return e==null?"":String(e).trim()}async function Lo(e,t,n={}){let r=e==="tv"?"tv":"movie",o=St(t);if(!o)return null;let i=St(n.language)||"en-US",s=$f(r,o,i);if(!n.forceRefresh){let d=xa(s);if(d)return{id:o,type:r,language:i,data:d.data,fetchedAt:d.ts,source:"cache"}}let a=n.auth||await Na(n.settings,n.authOptions||{});if(!a)return Y("TMDB credentials missing; cannot fetch details."),null;let c=`${_o}/${r}/${encodeURIComponent(o)}?language=${encodeURIComponent(i)}&append_to_response=${Ff}`,l;try{l=await vt(c,a,{signal:n.signal})}catch(d){throw Y(`Failed to fetch TMDB ${r}#${o}:`,(d==null?void 0:d.message)||d),d}zf(s,l);let u=xa(s);return{id:o,type:r,language:i,data:l,fetchedAt:(u==null?void 0:u.ts)||ee(),source:"network"}}function tg(e){if(!e||typeof e!="object")return"";let t=[e.title,e.name,e.originalTitle,e.original_name,e.original_title];for(let n of t){let r=typeof n=="string"?n.trim():"";if(r)return r}return""}function _a(e){if(e==null)return null;let t=Number(e);if(Number.isFinite(t)&&t>1800)return Math.trunc(t);if(typeof e=="string"){let n=e.match(/(19|20|21)\d{2}/);if(n)return Number(n[0])}return null}function ng(e){var o;if(!e||typeof e!="object")return null;let t=_a((o=e.year)!=null?o:e.startYear);if(t)return t;let n=e.originallyAvailableAt||e.premieredAt||e.releaseDate||e.firstAirDate,r=_a(n);return r||null}async function rg(e,t,n){let r=n.language||"en-US",o=`${_o}/find/${encodeURIComponent(t)}?external_source=imdb_id&language=${encodeURIComponent(r)}`,i=await vt(o,n.auth,{signal:n.signal}),s=e==="tv"?"tv_results":"movie_results",c=(Array.isArray(i==null?void 0:i[s])?i[s]:[]).find(d=>d&&d.id!=null);if(!c||c.id==null)return null;let l=String(c.id),u=await Lo(e,l,n);return u&&(u.id=l,u.resolvedId=l),u}function og(e,t,n,r){let o=encodeURIComponent(t),i=encodeURIComponent(n||"en-US"),s=`${_o}/search/${e}?query=${o}&language=${i}`;return r?`${s}&${e==="tv"?"first_air_date_year":"year"}=${encodeURIComponent(String(r))}`:s}async function ig(e,t,n,r){if(!t)return null;let o=r.language||"en-US",i=og(e,t,o,n),s=await vt(i,r.auth,{signal:r.signal}),a=Array.isArray(s==null?void 0:s.results)?s.results:[];if(!a.length)return null;let c=a.find(d=>d&&d.id!=null)||a[0];if(!c||c.id==null)return null;let l=String(c.id),u=await Lo(e,l,r);return u&&(u.id=l,u.resolvedId=l),u}function sg(e){let t={tmdb:"",imdb:""};if(!e||typeof e!="object")return t;let n=r=>{let o=typeof r=="string"?r:r==null?void 0:r.id;if(!o)return;let i=String(o).trim();if(!i)return;let[s,a]=i.split("://");if(!a){i.startsWith("tt")&&(t.imdb=i);return}let c=s.toLowerCase(),u=a.split("?")[0].replace(/^\//,"").split("/").pop();if(c==="imdb"||c.includes("imdb")){t.imdb=u||t.imdb;return}if(c==="tmdb"||c.includes("themoviedb")){t.tmdb=u||t.tmdb;return}};return e.ids&&typeof e.ids=="object"&&(e.ids.tmdb&&(t.tmdb=St(e.ids.tmdb)),e.ids.imdb&&(t.imdb=St(e.ids.imdb))),n(e.guid),Array.isArray(e.guids)&&e.guids.forEach(n),t}function ag(e,t){let n=St(t==null?void 0:t.searchTitle);return n||tg(e)}async function $a(e,t={}){var l;if(!e||typeof e!="object")return null;let n=e.type==="tv"?"tv":"movie",r=St(t.language)||"en-US",o=t.auth||await Na(t.settings,t.authOptions||{});if(!o)return Y("Skipping TMDB lookup (missing credentials)."),null;let i={...t,auth:o,language:r},s=sg(e),a=[];s.tmdb&&a.push({label:"direct id",fn:()=>Lo(n,s.tmdb,i)}),s.imdb&&a.push({label:"imdb find",fn:()=>rg(n,s.imdb,i)});let c=ag(e,t);if(c){let u=(l=t.searchYear)!=null?l:ng(e);a.push({label:"search",fn:()=>ig(n,c,u,i)})}for(let u of a)try{let d=await u.fn();if(d)return!d.resolvedId&&d.id&&(d.resolvedId=d.id),d}catch(d){Y(`TMDB ${u.label} lookup failed:`,(d==null?void 0:d.message)||d)}return null}var _o,Mf,Ff,Ma,re,ka,Co,Ca,Un,To,yt,B,xo,Ia,La,Mo=_(()=>{_o="https://api.themoviedb.org/3",Mf="https://image.tmdb.org/t/p/",Ff="images,release_dates,content_ratings,credits",Ma="hero.tmdbCache.v1",re=new Map,ka=!1,Co=null,Ca=0,Un=null,To={},yt=0,B={active:!1,until:0,retryAfterMs:0,lastStatus:null,lastHitAt:0,strikes:0},xo=new Set;(La=(Ia=setInterval(()=>{try{Df()}catch{}},864e5/6)).unref)==null||La.call(Ia)});function Da(...e){try{}catch{}}function Vn(e){return typeof e!="string"?"":e.trim()}function j(e){let t=Vn(e);return t||""}function Fo(e){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e)&&e>1800&&e<9999)return Math.trunc(e);if(typeof e=="string"){let t=e.match(/(19|20|21)\d{2}/);if(t)return Number(t[0])}return null}function Po(e){if(!e)return null;try{let t=new Date(e);if(Number.isNaN(t.getTime()))return null;let n=t.getUTCFullYear();return n>1800&&n<9999?n:null}catch{return null}}function za(e){let t=Number(e);return!Number.isFinite(t)||t<=0?null:Math.round(t*10)/10}function Et(e){if(e==null)return null;let t=Number(e);return Number.isFinite(t)&&t>0?t>1e3?Math.max(1,Math.round(t/6e4)):Math.round(t):null}function ug(e,t){let n=[];if(t&&Array.isArray(t.genres)){for(let s of t.genres)if(s&&typeof s=="object"&&s.name){let a=Vn(s.name);a&&n.push(a)}}let r=e==null?void 0:e.genres;Array.isArray(r)&&r.forEach(s=>{if(!s)return;if(typeof s=="string"){let c=Vn(s);c&&n.push(c);return}let a=Vn(s.tag||s.title||s.label||s.name);a&&n.push(a)});let o=new Set,i=[];for(let s of n){let a=s.toLowerCase();o.has(a)||(o.add(a),i.push(s))}return i.slice(0,2)}function dg(e){let t={},n=(r,o)=>{if(o==null)return;let i=typeof o=="string"?o:String(o),s=j(i);s&&(t[r]=s)};if(e&&typeof e=="object"){e.ratingKey!=null&&n("ratingKey",e.ratingKey),e.ids&&typeof e.ids=="object"&&(n("tmdb",e.ids.tmdb),n("imdb",e.ids.imdb));let r=o=>{let i=typeof o=="string"?o:o==null?void 0:o.id,s=j(i);if(!s)return;let[a,c]=s.split("://");if(c){let l=a.toLowerCase(),d=c.split("?")[0].replace(/^\//,"").split("/").pop();if(l==="imdb"||l.includes("imdb")){n("imdb",d);return}if(l==="tmdb"||l.includes("themoviedb")){n("tmdb",d);return}if(l==="tvdb"||l.includes("thetvdb")){n("tvdb",d);return}}else s.startsWith("tt")&&n("imdb",s)};r(e.guid),Array.isArray(e.guids)&&e.guids.forEach(r)}return t}function fg(e,t,n){if(t)if(n==="tv"){let r=[t.name,t.original_name];for(let o of r){let i=j(o);if(i)return i}}else{let r=[t.title,t.original_title];for(let o of r){let i=j(o);if(i)return i}}if(e){let r=[e.title,e.name,e.originalTitle];for(let o of r){let i=j(o);if(i)return i}}return""}function gg(e,t){let n=[t==null?void 0:t.tagline,e==null?void 0:e.tagline];for(let r of n){let o=j(r);if(o)return o}return""}function hg(e,t){let n=[t==null?void 0:t.overview,e==null?void 0:e.summary,e==null?void 0:e.plot,e==null?void 0:e.description];for(let r of n){let o=j(r);if(o)return o}return""}function mg(e,t,n){var o,i,s;if(t){let a=n==="tv"?t.first_air_date:t.release_date,c=(o=Fo(a))!=null?o:Po(a);if(c)return c;let l=n==="tv"?t.last_air_date:t.release_date,u=(i=Fo(l))!=null?i:Po(l);if(u)return u}let r=(s=Fo(e==null?void 0:e.year))!=null?s:Po(e==null?void 0:e.originallyAvailableAt);return r||null}function pg(e,t,n){var r,o,i;if(t){if(n==="tv"&&Array.isArray(t.episode_run_time)&&t.episode_run_time.length){let s=Et(t.episode_run_time.find(a=>Et(a)));if(s)return s}if(n==="movie"){let s=Et(t.runtime);if(s)return s}}if(n==="movie"){let s=Et((r=e==null?void 0:e.durationMin)!=null?r:e==null?void 0:e.duration);if(s)return s}else if(n==="tv"){if(Array.isArray(e==null?void 0:e.seasons)){for(let a of e.seasons)if(Array.isArray(a==null?void 0:a.episodes))for(let c of a.episodes){let l=Et((o=c==null?void 0:c.durationMin)!=null?o:c==null?void 0:c.duration);if(l)return l}}let s=Et((i=e==null?void 0:e.durationMin)!=null?i:e==null?void 0:e.duration);if(s)return s}return null}function bg(e,t){var o;let n=za(t==null?void 0:t.vote_average);if(n)return n;let r=za((o=e==null?void 0:e.rating)!=null?o:e==null?void 0:e.audienceRating);return r||null}function yg(e){let t=Number(e==null?void 0:e.vote_count);return Number.isFinite(t)&&t>0?Math.round(t):null}function vg(e,t,n){var o,i,s;if(n==="movie"&&((o=t==null?void 0:t.release_dates)!=null&&o.results)){let c=(Array.isArray(t.release_dates.results)?t.release_dates.results:[]).find(d=>d&&d.iso_3166_1==="US"),u=(Array.isArray(c==null?void 0:c.release_dates)?c.release_dates:[]).filter(d=>j(d==null?void 0:d.certification)).sort((d,f)=>{var p,h;let g=Number((p=d==null?void 0:d.type)!=null?p:0),m=Number((h=f==null?void 0:f.type)!=null?h:0);return g-m});if(u.length){let d=j(((i=u.find(f=>f.type===3))==null?void 0:i.certification)||u[0].certification);if(d)return d}}if(n==="tv"&&Array.isArray((s=t==null?void 0:t.content_ratings)==null?void 0:s.results)){let a=t.content_ratings.results.find(l=>l&&l.iso_3166_1==="US"),c=j(a==null?void 0:a.rating);if(c)return c}let r=j(e==null?void 0:e.contentRating);if(r){let a=r.split("/").pop(),c=j(a);if(c)return c}return""}function Sg(e,t){var o;let n=[],r=Array.isArray((o=e==null?void 0:e.images)==null?void 0:o.backdrops)?e.images.backdrops:[];for(let i of r){if(!i||!i.file_path||i.width&&i.width<cg)continue;let s=Ra(i.file_path,lg);s&&(n.includes(s)||n.push(s))}if(n.length===0&&t){let i=t.art||t.thumb||t.thumbFile||t.backdrop;if(i&&typeof i=="string"){let s=i.trim();s&&!n.includes(s)&&n.push(s)}}return n}function Eg(e,t){let n={seasons:null,episodes:null};if(Number.isFinite(t==null?void 0:t.number_of_seasons)&&(n.seasons=Math.max(0,Math.round(t.number_of_seasons))),Number.isFinite(t==null?void 0:t.number_of_episodes)&&(n.episodes=Math.max(0,Math.round(t.number_of_episodes))),n.seasons==null&&Array.isArray(e==null?void 0:e.seasons)&&(n.seasons=e.seasons.length),n.episodes==null&&Array.isArray(e==null?void 0:e.seasons)){let r=0;e.seasons.forEach(o=>{Array.isArray(o==null?void 0:o.episodes)&&(r+=o.episodes.length)}),r>0&&(n.episodes=r)}return n}function Ag(e,t){if(!t||typeof t!="object")return null;let n=t.tmdb||t.imdb||t.ratingKey,r=j(n);if(!r)return null;let o=e==="tv"?"show":"movie";return{id:r,kind:o,label:o==="show"?"Show details":"Movie details",target:`#/${o}/${r}`}}function wg(e){let t={};return Object.entries(e||{}).forEach(([n,r])=>{let o=j(r);o&&(t[n]=o)}),t}function kg(e,t){return e.ratingKey?e.ratingKey:e.tmdb?`${t}-${e.tmdb}`:e.imdb?`${t}-${e.imdb}`:""}async function Oa(e,t={}){var k,I;if(!e||typeof e!="object")return null;let n=e.type==="tv"?"tv":"movie",r=j(t.language)||"en-US",o=dg(e),i=null;if(t.disableTmdb!==!0)try{i=await $a(e,{language:r,settings:t.settings,auth:t.auth,authOptions:t.authOptions,signal:t.signal,searchTitle:t.searchTitle,searchYear:t.searchYear})}catch(w){Da("TMDB lookup failed:",(w==null?void 0:w.message)||w)}let s=i==null?void 0:i.data;i!=null&&i.resolvedId&&(o.tmdb||(o.tmdb=String(i.resolvedId))),s!=null&&s.id&&!o.tmdb&&(o.tmdb=String(s.id)),s!=null&&s.imdb_id&&!o.imdb&&(o.imdb=String(s.imdb_id).trim()),o=wg(o);let a=fg(e,s,n);if(!a)return Da("Skipping item without title",(e==null?void 0:e.ratingKey)||(e==null?void 0:e.title)||(e==null?void 0:e.guid)||"unknown"),null;let c={id:kg(o,n)||String((I=(k=e.ratingKey)!=null?k:e.guid)!=null?I:a),type:n,title:a},l=gg(e,s);l&&(c.tagline=l);let u=hg(e,s);u&&(c.overview=u);let d=mg(e,s,n);d&&(c.year=d);let f=pg(e,s,n);f&&(c.runtime=f);let g=bg(e,s);g!=null&&(c.rating=g);let m=yg(s);m!=null&&(c.voteCount=m);let p=ug(e,s);p.length&&(c.genres=p);let h=vg(e,s,n);h&&(c.certification=h);let b=Sg(s,e);if(b.length&&(c.backdrops=b),n==="tv"){let w=Eg(e,s);w.seasons!=null&&(c.seasons=w.seasons),w.episodes!=null&&(c.episodes=w.episodes)}let v=Ag(n,o);if(v&&(c.cta=v),Object.keys(o).length&&(c.ids=o),c.language=r,i){let w={id:o.tmdb||(i.id?String(i.id):""),fetchedAt:i.fetchedAt||Date.now(),source:i.source};w.id||delete w.id,w.source||delete w.source,t.includeTmdbRaw&&s&&(w.raw=s),Object.keys(w).length&&(c.tmdb=w)}return t.includeSource&&(c.source=e),c}var cg,lg,ja=_(()=>{Mo();cg=1920,lg="original"});function _e(){return Date.now()}function Ka(e){try{if(typeof globalThis!="undefined"&&globalThis[e])return globalThis[e]}catch{}return null}function Ig(e,t){if(!e)return null;try{return e.getItem(t)}catch{return null}}function K(e,t,n){if(e)try{n==null?e.removeItem(t):e.setItem(t,n)}catch{}}function Lg(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function Xn(e){try{return JSON.stringify(e)}catch{return null}}function Zt(e){return e==="shows"||e==="show"||e==="series"?"series":"movies"}function Yn(e){return`${Cg}${Zt(e)}`}function No(e){return`${Yn(e)}${At}`}function Ua(e){return`${Tg}${Zt(e)}`}function Bo(e){return`${xg}${Zt(e)}`}function Ho(e){return`${_g}${Zt(e)}`}function Jt(e,t){let n=Ig(e,t);if(!n)return null;let r=Lg(n);return!r||typeof r!="object"?null:r}function Ga(e){let{local:t}=oe(),n=Bo(e),r=Jt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:0),slot:typeof(o==null?void 0:o.slot)=="string"?o.slot:(o==null?void 0:o.slot)!=null?String(o.slot):void 0}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function Mg(e,t){let n=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts,slot:a.slot})):[],r=Xn(n);if(r==null)return;let{local:o,session:i}=oe(),s=Bo(e);K(o,s,r),K(i,`${s}${At}`,r)}function Ro(e){let{local:t}=oe(),n=Ho(e),r=Jt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:0),reason:typeof(o==null?void 0:o.reason)=="string"?o.reason:"",hits:Number(o==null?void 0:o.hits)||0}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function qa(e,t){let n=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts,reason:a.reason||"",hits:Number(a.hits)||0})):[],r=Xn(n);if(r==null)return;let{local:o,session:i}=oe(),s=Ho(e);K(o,s,r),K(i,`${s}${At}`,r)}function oe(){return{local:Ka("localStorage"),session:Ka("sessionStorage")}}function Wa(e){if(!e||typeof e!="object")return null;let t={kind:Zt(e.kind||e.library||e.type),items:Array.isArray(e.items)?e.items.slice():[],updatedAt:Number(e.updatedAt)||_e(),expiresAt:Number(e.expiresAt)||0,policyHash:typeof e.policyHash=="string"?e.policyHash:"",slotSummary:e.slotSummary&&typeof e.slotSummary=="object"?{...e.slotSummary}:{},meta:e.meta&&typeof e.meta=="object"?{...e.meta}:void 0};return e.generatedAt&&!t.updatedAt&&(t.updatedAt=Number(e.generatedAt)||t.updatedAt),t}function wt(e,{now:t=_e(),policyHash:n=null,allowExpired:r=!1}={}){let{local:o,session:i}=oe(),s=Yn(e),a=No(e),c=Jt(i,a),l=Jt(o,s),u=c||l||null;if(!u)return null;let d=Wa(u);if(!d)return null;let g=(Number(d.expiresAt)||0)>t,m=n?d.policyHash===n:!0;return!r&&!g||n&&!m?null:(d.isExpired=!g,d.matchesPolicy=m,d.source=c?"session":"local",d)}function Va(e,t){let{local:n,session:r}=oe();if(!t||typeof t!="object"){Xa(e);return}let o=Wa({...t,kind:e});if(!o)return;let i=Yn(e),s=No(e),a=Xn(o);a!=null&&(K(n,i,a),K(r,s,a))}function Xa(e){let{local:t,session:n}=oe(),r=Yn(e),o=No(e);K(t,r,null),K(n,o,null)}function Ya(e){let{local:t}=oe(),n=Ua(e),r=Jt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:o==null?void 0:o.at)}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function Fg(e,t){let{local:n,session:r}=oe(),o=Ua(e),i=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts})):[],s=Xn(i);s!=null&&(K(n,o,s),K(r,`${o}${At}`,s))}function Jn(e){if(!e)return null;if(typeof e=="string")return e.trim()||null;if(typeof e=="number")return`#${e}`;if(e&&typeof e=="object"){if(e.poolId!=null)return String(e.poolId);if(e.poolEntryId!=null)return String(e.poolEntryId);if(e.heroId!=null)return String(e.heroId);if(e.cta&&e.cta.id!=null)return String(e.cta.id);if(e.ids&&typeof e.ids=="object"){if(e.ids.imdb)return`imdb:${e.ids.imdb}`;if(e.ids.tmdb)return`tmdb:${e.ids.tmdb}`;if(e.ids.tvdb)return`tvdb:${e.ids.tvdb}`}if(e.guid)return String(e.guid);if(e.ratingKey!=null)return`rk:${e.ratingKey}`;if(e.id!=null)return String(e.id);if(e.slug)return String(e.slug);if(e.key)return String(e.key);if(e.title){let t=e.year?`:${e.year}`:"";return`title:${e.title}${t}`}}return null}function Pg(e){return Jn(e)}function Ja(e,t,{timestamp:n=_e(),limit:r=80}={}){let o=Pg(t);if(!o)return null;let s=Ya(e).filter(c=>c.id!==o);s.unshift({id:o,ts:n});let a=s.filter(c=>n-c.ts<=12096e5).slice(0,Math.max(1,r));return Fg(e,a),a}function $o(e,{now:t=_e(),windowMs:n=12096e5,limit:r=80}={}){let o=Ya(e);if(!o.length)return{entries:[],set:new Set};let i=t-Math.max(0,n),s=new Set,a=[];for(let c of o)if(!(!c||!c.id)&&!(c.ts<i)&&!s.has(c.id)&&(s.add(c.id),a.push({id:c.id,ts:c.ts}),a.length>=r))break;return{entries:a,set:s}}function Za(e,t,{timestamp:n=_e(),ttlMs:r=0,limit:o=120}={}){if(!Array.isArray(t)||!t.length)return[];let i=r>0?Math.max(0,n-r):0,s=Ga(e),a=new Set,c=[];for(let h of s)!h||!h.id||i&&h.ts<i||a.has(h.id)||(a.add(h.id),c.push(h));let l=[],u=new Set;for(let h of t){let b=Jn(h);if(!b)continue;let v=typeof(h==null?void 0:h.slot)=="string"?h.slot:h!=null&&h.poolSlot?String(h.poolSlot):void 0;l.push({id:b,ts:n,slot:v}),u.add(b)}let d=c.filter(h=>!u.has(h.id)),g=[...l,...d].filter(h=>h&&h.id).slice(0,Math.max(1,o)),m=[],p=new Set;for(let h of g)p.has(h.id)||(p.add(h.id),m.push(h));return Mg(e,m),m}function Qa(e,{now:t=_e(),windowMs:n=0,limit:r=120}={}){let o=Ga(e);if(!o.length)return{entries:[],set:new Set};let i=n>0?Math.max(0,t-n):0,s=new Set,a=[];for(let c of o)if(!(!c||!c.id)&&!(i&&c.ts<i)&&!s.has(c.id)&&(s.add(c.id),a.push({id:c.id,ts:c.ts,slot:c.slot}),a.length>=r))break;return{entries:a,set:s}}function ec(e){let{local:t,session:n}=oe(),r=Bo(e);K(t,r,null),K(n,`${r}${At}`,null)}function tc(e,t,{timestamp:n=_e(),ttlMs:r=0,limit:o=80,reason:i=""}={}){let s=Jn(t);if(!s)return null;let a=r>0?Math.max(0,n-r):0,c=Ro(e),l=[],u=0;for(let g of c)if(!(!g||!g.id)){if(g.id===s){u=(g.hits||0)+1;continue}a&&g.ts<a||l.push(g)}let d={id:s,ts:n,reason:i||"",hits:u};l.unshift(d);let f=l.slice(0,Math.max(1,o));return qa(e,f),d}function nc(e,t){let n=Jn(t);if(!n)return;let r=Ro(e),o=r.filter(i=>i&&i.id!==n);o.length!==r.length&&qa(e,o)}function rc(e,{now:t=_e(),windowMs:n=0,limit:r=80}={}){let o=Ro(e);if(!o.length)return{entries:[],set:new Set};let i=n>0?Math.max(0,t-n):0,s=new Set,a=[];for(let c of o)if(!(!c||!c.id)&&!(i&&c.ts<i)&&!s.has(c.id)&&(s.add(c.id),a.push({id:c.id,ts:c.ts,reason:c.reason||"",hits:c.hits||0}),a.length>=r))break;return{entries:a,set:s}}function oc(e){let{local:t,session:n}=oe(),r=Ho(e);K(t,r,null),K(n,`${r}${At}`,null)}var Cg,Tg,xg,_g,At,Zn=_(()=>{Cg="heroPool:",Tg="heroHistory:",xg="heroMemory:",_g="heroFailures:",At=":session"});function We(){return Date.now()}function tr(...e){try{}catch{}}function cc(e){return e==="series"||e==="show"||e==="shows"?"series":"movies"}function Dg(e,t){if(!e||typeof e!="object")return"";try{let r={poolSize:cc(t)==="series"?e.poolSizeSeries:e.poolSizeMovies,slots:e.slots,diversity:e.diversity,language:e.language||"en-US"};return JSON.stringify(r)}catch(n){return tr("Failed to compute policy signature:",(n==null?void 0:n.message)||n),""}}function kt(e,t,n){return Math.min(n,Math.max(t,e))}function zg(e){if(!e)return 0;if(typeof e=="number"&&Number.isFinite(e))return e>1e12?Math.trunc(e):Math.trunc(e*1e3);if(typeof e=="string"){let t=Date.parse(e);if(Number.isFinite(t))return t}return 0}function Og(e){if(!e)return null;let t=Number(e);if(Number.isFinite(t)&&t>1800&&t<2100)return Math.trunc(t);if(typeof e=="string"){let n=e.match(/(19|20|21)\d{2}/);if(n)return Number(n[0])}return null}function jg(e){let t=[],n=r=>{if(!r||typeof r!="string")return;let o=r.trim();if(!o)return;let i=o.replace(/\s+/g," ");t.includes(i)||t.push(i)};if(Array.isArray(e==null?void 0:e.genres)){for(let r of e.genres)if(r){if(typeof r=="string"){n(r);continue}typeof r=="object"&&n(r.tag||r.title||r.label||r.name||"")}}if(Array.isArray(e==null?void 0:e.Genre))for(let r of e.Genre)n(typeof r=="string"?r:r==null?void 0:r.tag);return t.slice(0,3)}function Kg(e){let t=[e==null?void 0:e.rating,e==null?void 0:e.audienceRating,e==null?void 0:e.userRating];for(let n of t){let r=Number(n);if(Number.isFinite(r)&&r>0)return kt(Math.round(r*10)/10,0,10)}return null}function Ug(e){let t=[e==null?void 0:e.ratingCount,e==null?void 0:e.audienceRatingCount,e==null?void 0:e.userRatingCount,e==null?void 0:e.viewCount];for(let n of t){let r=Number(n);if(Number.isFinite(r)&&r>=0)return Math.trunc(r)}return 0}function Gg(e){if(!e||typeof e!="object")return null;if(e.heroId!=null)return String(e.heroId);if(e.ids&&typeof e.ids=="object"){if(e.ids.imdb)return`imdb:${e.ids.imdb}`;if(e.ids.tmdb)return`tmdb:${e.ids.tmdb}`;if(e.ids.tvdb)return`tvdb:${e.ids.tvdb}`}if(e.guid)return String(e.guid);if(e.ratingKey!=null)return`rk:${e.ratingKey}`;if(e.id!=null)return String(e.id);if(e.slug)return String(e.slug);if(e.key!=null){let t=typeof e.key=="string"?e.key.trim():String(e.key);if(t)return t}if(e.title){let t=e.year?`:${e.year}`:"";return`title:${e.title}${t}`}return null}function qg(e,t){let n={new:0,topRated:0,oldButGold:0,random:0},r=e,o=t&&typeof t=="object"?t:{};er.forEach((s,a)=>{var u;if(a===er.length-1){n[s]=Math.max(0,r),r=0;return}let c=Number((u=o[s])==null?void 0:u.quota);if(!Number.isFinite(c)||c<=0){n[s]=0;return}let l=Math.max(0,Math.round(e*kt(c,0,1)));n[s]=Math.min(r,l),r-=n[s]});let i=0;for(;r>0;){let s=er[i%er.length];n[s]+=1,r-=1,i+=1}return n}function Wg(e,t){let n=kt(Number(t==null?void 0:t.genre)||.4,.1,.9),r=kt(Number(t==null?void 0:t.year)||.35,.1,.9),o=Math.max(1,Math.round(e*kt(n*.5,.1,.35))),i=Math.max(1,Math.round(e*kt(r*.5,.1,.35)));return{perGenre:o,perYear:i}}function Vg(e){if(!Array.isArray(e)||!e.length)return[];let t=We(),n=new Set,r=[];for(let o of e){if(!o||typeof o!="object")continue;let i=Gg(o);if(!i||n.has(i))continue;n.add(i);let s=zg(o.addedAt||o.createdAt||o.added),a=Og(o.year||o.originallyAvailableAt),c=Kg(o),l=Ug(o),u=jg(o),d={id:i,raw:o,addedAt:s,year:a,rating:c!=null?c:0,voteCount:l,genres:u,isNew:s&&t-s<=Bg,isOld:a?new Date().getUTCFullYear()-a>=Hg:!1};r.push(d)}return r}function Xg(e){return e.slice().sort((t,n)=>(n.addedAt||0)-(t.addedAt||0))}function Yg(e){return e.slice().sort((t,n)=>{let r=Number.isFinite(t.rating)?t.rating:0,o=Number.isFinite(n.rating)?n.rating:0;if(o!==r)return o-r;let i=(n.voteCount||0)-(t.voteCount||0);return i!==0?i:(n.addedAt||0)-(t.addedAt||0)})}function Jg(e){return e.slice().sort((t,n)=>{let r=t.year||0,o=n.year||0;if(r&&o&&r!==o)return r-o;let i=(n.rating||0)-(t.rating||0);return i!==0?i:(n.addedAt||0)-(t.addedAt||0)})}function Zg(e){let t=e.slice();for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function sc(e,t){let{caps:n,genreCounts:r,yearCounts:o}=e;if(n.perGenre>0&&t.genres&&t.genres.length){for(let i of t.genres)if((r.get(i)||0)>=n.perGenre)return!1}return!(n.perYear>0&&t.year&&(o.get(t.year)||0)>=n.perYear)}function Do(e,t,n){if(e.selected.push({...t,slot:n}),e.selectedIds.add(t.id),e.summary[n]=(e.summary[n]||0)+1,t.genres)for(let r of t.genres)e.genreCounts.set(r,(e.genreCounts.get(r)||0)+1);t.year&&e.yearCounts.set(t.year,(e.yearCounts.get(t.year)||0)+1)}function ye(e,t,n,r,{allowHistory:o=!1,filter:i}={}){if(t<=0)return 0;let s=[],a=[],c=[];for(let u of e){if(r.selected.length>=r.poolSize||r.summary[n]>=t)break;if(!r.selectedIds.has(u.id)&&!(i&&!i(u))&&sc(r,u)){if(r.failureSet&&r.failureSet.has(u.id)){c.push(u);continue}if(r.memorySet&&r.memorySet.has(u.id)){a.push(u);continue}if(!o&&r.historySet&&r.historySet.has(u.id)){s.push(u);continue}Do(r,u,n)}}if(r.summary[n]>=t||r.selected.length>=r.poolSize)return r.summary[n];let l=u=>{for(let d of u){if(r.selected.length>=r.poolSize||r.summary[n]>=t)break;r.selectedIds.has(d.id)||sc(r,d)&&Do(r,d,n)}};return a.length&&l(a),r.summary[n]<t&&s.length&&l(s),r.summary[n]<t&&c.length&&l(c),r.summary[n]}function Qg(e,t){for(let n of t){if(e.selected.length>=e.poolSize)break;e.selectedIds.has(n.id)||Do(e,n,"random")}}function Qt(e){let t={...e,timestamp:We()};for(let n of $g)try{n(t)}catch(r){tr("Progress listener failed:",(r==null?void 0:r.message)||r)}try{typeof window!="undefined"&&typeof window.dispatchEvent=="function"&&typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent(Ng,{detail:t}))}catch(n){tr("Failed to dispatch progress event:",(n==null?void 0:n.message)||n)}}async function eh(e,t,n={}){let r=[],o=e.length,{settings:i,auth:s,authOptions:a,signal:c,disableTmdb:l,kind:u,failureTtlMs:d}=n;for(let f=0;f<e.length;f++){let g=e[f];Qt({stage:"normalizing",index:f+1,total:o,slot:g.slot,id:g.id});let m=null,p="",h=!1;try{m=await Oa(g.raw,{language:t,settings:i,auth:s,authOptions:a,signal:c,disableTmdb:l})}catch(b){tr("Failed to normalize hero candidate:",(b==null?void 0:b.message)||b),p=(b==null?void 0:b.message)||"",(b==null?void 0:b.code)==="RATE_LIMIT"&&(h=!0)}if(!m){if(u&&!h)try{tc(u,g.raw||g,{timestamp:We(),ttlMs:d,reason:p||"normalize"})}catch{}continue}if(u)try{nc(u,g.raw||m)}catch{}m.slot=g.slot,m.poolSlot=g.slot,m.poolId=g.id,r.push(m)}return r}function ac(e,t,n,r,o,i){let s=Object.values(t).reduce((m,p)=>m+p,0),a={poolSize:s,caps:Wg(s,n),selected:[],summary:{new:0,topRated:0,oldButGold:0,random:0},genreCounts:new Map,yearCounts:new Map,selectedIds:new Set,historySet:(r==null?void 0:r.set)||new Set,memorySet:(o==null?void 0:o.set)||new Set,failureSet:(i==null?void 0:i.set)||new Set},c=Vg(e),l=Xg(c),u=Yg(c),d=Jg(c.filter(m=>m.isOld)),f=Zg(c);ye(l,t.new,"new",a,{allowHistory:!1,filter:m=>m.isNew}),ye(l,t.new,"new",a,{allowHistory:!1}),ye(l,t.new,"new",a,{allowHistory:!0}),ye(u,t.topRated,"topRated",a,{allowHistory:!1}),ye(u,t.topRated,"topRated",a,{allowHistory:!0}),ye(d,t.oldButGold,"oldButGold",a,{allowHistory:!1}),ye(d,t.oldButGold,"oldButGold",a,{allowHistory:!0});let g=f.filter(m=>!a.selectedIds.has(m.id));if(ye(g,t.random,"random",a,{allowHistory:!1}),ye(g,t.random,"random",a,{allowHistory:!0}),a.selected.length<s){let m=c.filter(p=>!a.selectedIds.has(p.id));Qg(a,m)}return a}function th(e,t,n={}){let r=We(),o=wt(e,{now:r,policyHash:t});if(!o||!Array.isArray(o.items)||!o.items.length)return null;if(o.isExpired){if(n.allowGrace){let{graceMs:i}=Yt();if(i&&i>0&&o.expiresAt+i>r)return Qt({stage:"cache",status:"grace",kind:e,size:o.items.length}),{...o,fromCache:!0}}return null}return Qt({stage:"cache",status:"hit",kind:e,size:o.items.length}),{...o,fromCache:!0}}async function lc(e,t,n={}){let r=n.policy||bt(),o=cc(e),i=Dg(r,o),s=!n.force&&th(o,i,{allowGrace:!0});if(s)return s;if(n.force){try{ec(o)}catch{}try{oc(o)}catch{}}let a=o==="series"?r.poolSizeSeries:r.poolSizeMovies;if(!a||a<=0)return{items:[],summary:{},fromCache:!1,updatedAt:We(),expiresAt:0};Qt({stage:"start",kind:o,total:a});let c=qg(a,r.slots),l=Yt(),u=We(),d=(()=>{let T=Math.max(0,l.ttlMs||0)+Math.max(0,l.graceMs||0);return T>0?T:ic})(),f=$o(o,{windowMs:ic,limit:Qn}),g=Qa(o,{now:u,windowMs:d,limit:Math.max(Qn*2,a*2)}),m=rc(o,{now:u,windowMs:d}),p=ac(t,c,{...r.diversity,kind:o},f,g,m);if(p.selected.length<a&&f.entries.length){let T=$o(o,{windowMs:Rg,limit:Qn});p=ac(t,c,{...r.diversity,kind:o},T,g,m)}let h=p.selected.slice(0,a),v=(await eh(h,r.language||"en-US",{...n.tmdb,kind:o,failureTtlMs:d})).slice(0,a),k=We(),I=k+(l.ttlMs||0),w={kind:o,items:v,updatedAt:k,expiresAt:I,policyHash:i,slotSummary:p.summary,meta:{plan:c,totalCandidates:(t==null?void 0:t.length)||0,selectionCount:v.length}};try{Za(o,v,{timestamp:k,ttlMs:d,limit:Math.max(Qn*2,a*2)})}catch{}return Va(o,w),Qt({stage:"done",kind:o,size:v.length,updatedAt:k}),{...w,fromCache:!1}}async function uc(e,t,n={}){return lc(e,t,n)}function dc(e,t,n={}){return lc(e,t,{...n,force:!0})}var Ng,ic,Qn,Bg,Hg,Rg,er,$g,fc=_(()=>{ja();Kn();Zn();Ng="hero:pool-progress",ic=1e3*60*60*24*7,Qn=60,Bg=1e3*60*60*24*90,Hg=12,Rg=1e3*60*60*24*30,er=["new","topRated","oldButGold","random"],$g=new Set});function tn(...e){try{}catch{}}function hc(){return Date.now()}function rr(e){return e==="show"||e==="shows"||e==="series"?"series":"movies"}function oh(e,t){return e===t?!0:!e||!t?!1:e.active===t.active&&e.until===t.until&&e.retryAfterMs===t.retryAfterMs&&e.lastStatus===t.lastStatus&&e.strikes===t.strikes}function ih(){if(gc)return;try{A.tmdb.rateLimit={...Ba()}}catch{A.tmdb.rateLimit={active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}}gc=Ha(t=>{let n=t?{...t}:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0};oh(A.tmdb.rateLimit,n)||(A.tmdb.rateLimit=n,Ie())})}function mc(e){return{kind:e,state:"idle",regenerating:!1,size:0,updatedAt:0,expiresAt:0,fromCache:!1,source:"",policyHash:"",slotSummary:{},matchesPolicy:!0,isExpired:!1,lastError:null,lastRefresh:0}}function pc(e){if(!e)return null;let t={...e};return t.slotSummary=e.slotSummary?{...e.slotSummary}:{},t}function sh(){if(typeof localStorage=="undefined")return null;try{let e=localStorage.getItem(nh);if(e==="1"||e==="0")return e}catch(e){tn("Failed to read feature flag:",(e==null?void 0:e.message)||e)}return null}function ah(e){let t=sh();return t!=null?{enabled:t==="1",source:"localStorage"}:e&&typeof e.heroPipelineEnabled=="boolean"?{enabled:!!e.heroPipelineEnabled,source:"config.heroPipelineEnabled"}:e&&e.features&&typeof e.features.heroPipeline=="boolean"?{enabled:!!e.features.heroPipeline,source:"config.features.heroPipeline"}:{enabled:!0,source:"default"}}function nn(){return{enabled:A.enabled,featureSource:A.featureSource,ready:A.ready,activeKind:A.activeKind,tmdb:{allowed:A.tmdb.allowed,active:A.tmdb.active,rateLimit:A.tmdb.rateLimit?{...A.tmdb.rateLimit}:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}},status:{movies:pc(A.status.movies),series:pc(A.status.series)},pools:{movies:A.pools.movies.slice(),series:A.pools.series.slice()}}}function Ie(){let e=nn();for(let t of zo)try{t(e)}catch(n){tn("Listener failed:",(n==null?void 0:n.message)||n)}try{typeof window!="undefined"&&typeof window.dispatchEvent=="function"&&typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent(rh,{detail:e}))}catch(t){tn("Failed to dispatch pipeline event:",(t==null?void 0:t.message)||t)}return e}function en(e,t){let n=rr(e),r=A.status[n];if(!r)return;let o={...t};o.slotSummary&&(o.slotSummary={...o.slotSummary}),A.status[n]={...r,...o}}function Ct(){if(!A.enabled){A.ready=!0;return}let t=["movies","series"].every(n=>{let r=A.status[n];return r?r.state==="ready"||r.state==="error"||r.state==="stale":!1});A.ready=t}function bc(e){let t=rr(e),n=wt(t,{allowExpired:!0});n&&(A.pools[t]=Array.isArray(n.items)?n.items.slice():[],en(t,{state:n.isExpired?"stale":"ready",regenerating:!1,size:A.pools[t].length,updatedAt:Number(n.updatedAt)||0,expiresAt:Number(n.expiresAt)||0,fromCache:!0,source:n.source||"cache",policyHash:n.policyHash||"",slotSummary:n.slotSummary||{},matchesPolicy:n.matchesPolicy!==!1,isExpired:!!n.isExpired}))}function ch(){A.sources.movies||(A.sources.movies=[]),A.sources.series||(A.sources.series=[])}function lh(){let e=Ft(),n=!(A.tmdb.allowed&&e),r={};if(A.cfg&&typeof A.cfg=="object"){let o=A.cfg.tmdbToken||A.cfg.tmdbApiKey;o&&(r.fallbackCredential=o)}return{disableTmdb:n,settings:A.cfg,authOptions:Object.keys(r).length?r:void 0}}async function Oo(e,{force:t=!1}={}){let n=rr(e);if(!A.enabled)return en(n,{state:"disabled",regenerating:!1}),Ct(),null;if(ch(),A.inFlight.has(n))return A.inFlight.get(n);let r=n==="series"?A.sources.series:A.sources.movies;en(n,{state:"loading",regenerating:!0,lastError:null}),Ie();let o=t?dc:uc,i={policy:A.policy||void 0,tmdb:lh()},s=o(n,r,i).then(a=>{let c=a||{},l=Array.isArray(c.items)?c.items.slice():[];return A.pools[n]=l,en(n,{state:(c.items,"ready"),regenerating:!1,size:l.length,updatedAt:Number(c.updatedAt)||hc(),expiresAt:Number(c.expiresAt)||0,fromCache:!!c.fromCache,source:c.source||(c.fromCache?"cache":"fresh"),policyHash:c.policyHash||"",slotSummary:c.slotSummary||{},matchesPolicy:c.matchesPolicy!==!1,isExpired:!1,lastError:null,lastRefresh:hc()}),Ct(),Ie(),c}).catch(a=>{throw tn("Failed to build hero pool for",n,(a==null?void 0:a.message)||a),en(n,{state:"error",regenerating:!1,lastError:(a==null?void 0:a.message)||String(a)}),Ct(),Ie(),a}).finally(()=>{A.inFlight.delete(n)});return A.inFlight.set(n,s),s}function uh(){let e=new Date,t=e.getUTCFullYear(),n=Date.UTC(t,0,1),r=Date.UTC(t,e.getUTCMonth(),e.getUTCDate()),o=Math.max(0,r-n);return Math.floor(o/(24*60*60*1e3))}function dh(e,t){let n=String((e==null?void 0:e.poolId)||(e==null?void 0:e.id)||"").toLowerCase(),r=String((t==null?void 0:t.poolId)||(t==null?void 0:t.id)||"").toLowerCase();return n<r?-1:n>r?1:0}function fh(e,t){var u,d;let n=rr(e),r=((u=t==null?void 0:t.pools)==null?void 0:u[n])||[];if(!Array.isArray(r)||!r.length)return{items:[],startIndex:0};let o=r.slice().sort(dh),i=((d=t.status)==null?void 0:d[n])||{},s=i.updatedAt?Math.floor(Number(i.updatedAt)/(24*60*60*1e3)):0,a=n==="series"?7:0,c=uh()+s+a,l=o.length?c%o.length:0;return{items:o,startIndex:l}}function yc({cfg:e,policy:t}={}){A.cfg=e||{},A.policy=t||null;let n=ah(e);return A.enabled=!!n.enabled,A.featureSource=n.source,A.tmdb.allowed=!!(e!=null&&e.tmdbEnabled),A.tmdb.active=A.tmdb.allowed&&Ft(),ih(),bc("movies"),bc("series"),Ct(),Ie(),{enabled:A.enabled,source:A.featureSource}}function vc({movies:e=[],shows:t=[]}={}){A.sources={movies:Array.isArray(e)?e:[],series:Array.isArray(t)?t:[]}}function or(e){let t=e==="shows"||e==="series"?"series":"movies";A.activeKind!==t&&(A.activeKind=t,Ie())}async function Sc(e={}){if(!A.enabled)return Ct(),{skipped:!0};let n=(e.kinds||["movies","series"]).map(o=>Oo(o)),r=await Promise.allSettled(n);return Ct(),Ie(),r}function jo(e,t={}){return Oo(e,t)}function nr(e,t={}){return Oo(e,{...t,force:!0})}function Ec(){return A.enabled?Promise.all([nr("movies"),nr("series")]):Promise.resolve({skipped:!0})}function ir(e){let t=!!(A.tmdb.allowed&&Ft());A.tmdb.active!==t&&(A.tmdb.active=t,Ie())}function ce(){return!!A.enabled}function sr(){return!!A.ready}function Ac(){return nn()}function Tt(e){let t=nn();return{...fh(e,t),snapshot:t}}function ar(e){if(typeof e!="function")return()=>{};zo.add(e);try{e(nn())}catch(t){tn("Initial listener invocation failed:",(t==null?void 0:t.message)||t)}return()=>zo.delete(e)}function wc(){let e=nn();return{enabled:e.enabled,featureSource:e.featureSource,ready:e.ready,tmdb:e.tmdb,status:e.status,poolSizes:{movies:e.pools.movies.length,series:e.pools.series.length}}}var nh,rh,zo,gc,A,rn=_(()=>{fc();Zn();de();Mo();nh="feature.heroPipeline",rh="hero:pipeline-update",zo=new Set,gc=null,A={cfg:{},policy:null,enabled:!0,featureSource:"default",ready:!1,sources:{movies:[],series:[]},pools:{movies:[],series:[]},status:{movies:mc("movies"),series:mc("series")},tmdb:{allowed:!1,active:!1,rateLimit:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}},activeKind:"movies",inFlight:new Map}});function Cc(){let e=document.getElementById("openDebug");e&&e.addEventListener("click",()=>{gh()})}function gh(){var t,n,r,o;let e=document.getElementById("debugOverlay");e||(e=document.createElement("div"),e.id="debugOverlay",e.className="debug-overlay",e.innerHTML=`
      <div class="debug-dialog">
        <div class="debug-header"><h2>Debug</h2></div>
        <div class="debug-body">
          <pre id="debugPre" class="debug-pre"></pre>
          <div class="debug-cache-controls">
            <h3>Cache-Verwaltung</h3>
            <div id="cacheStats" class="cache-stats"></div>
            <div class="cache-buttons">
              <button id="debugClearExpired" class="btn">Abgelaufene l\xF6schen</button>
              <button id="debugClearAll" class="btn">Alles l\xF6schen</button>
            </div>
          </div>
        </div>
        <div class="debug-actions">
          <button id="debugCopy" class="btn">Copy report</button>
          <button id="debugClose" class="btn">Schlie\xDFen</button>
        </div>
      </div>`,document.body.append(e)),e.hidden=!1,Ko(),e.addEventListener("click",i=>{i.target===e&&kc()}),(t=document.getElementById("debugClose"))==null||t.addEventListener("click",kc,{once:!0}),(n=document.getElementById("debugCopy"))==null||n.addEventListener("click",hh,{once:!0}),(r=document.getElementById("debugClearExpired"))==null||r.addEventListener("click",()=>{dn(),Ko()},{once:!0}),(o=document.getElementById("debugClearAll"))==null||o.addEventListener("click",()=>{confirm("Wirklich den gesamten Cache l\xF6schen?")&&(ui(),Ko())},{once:!0})}function kc(){let e=document.getElementById("debugOverlay");e&&(e.hidden=!0)}function Ko(){var u,d,f,g,m,p,h,b;let e=document.getElementById("debugPre");if(!e)return;let t=x(),n=Ti(),r=t.cfg||{},o=Sr(),i=bt(),s=jn(),a=wc(),c={view:t.view,counts:{movies:(t.movies||[]).length,shows:(t.shows||[]).length,filtered:(t.filtered||[]).length},dataSources:n,cache:o,heroPolicy:{policy:i,language:Ea(),pools:ma(),slots:pa(),diversity:ba(),rotation:ya(),textClamp:va(),fallback:Sa(),cache:Yt(),loadedAt:Aa(),issues:s},heroCache:a,tmdb:{enabled:!!r.tmdbEnabled,lang:r.lang,tokenPresent:!!(localStorage.getItem("tmdbToken")||r.tmdbApiKey)},useTmdbImages:localStorage.getItem("useTmdb")==="1",reduceMotion:localStorage.getItem("prefReduceMotion")==="1",locationHash:location.hash,userAgent:navigator.userAgent};e.textContent=JSON.stringify(c,null,2);let l=document.getElementById("cacheStats");if(l&&o){let v=((u=a==null?void 0:a.status)==null?void 0:u.movies)||{},k=((d=a==null?void 0:a.status)==null?void 0:d.series)||{},I=T=>{if(!Number.isFinite(T)||T<=0)return"n/a";try{return new Date(T).toLocaleString()}catch{return"n/a"}},w=a!=null&&a.enabled?`aktiv (Quelle: ${a.featureSource||"default"})`:`deaktiviert (Quelle: ${(a==null?void 0:a.featureSource)||"default"})`;l.innerHTML=`
      <p>Eintr\xE4ge gesamt: <strong>${o.totalEntries}</strong></p>
      <p>G\xFCltig: <strong>${o.validEntries}</strong> | Abgelaufen: <strong>${o.expiredEntries}</strong></p>
      <p>Gr\xF6\xDFe: <strong>${o.totalSizeMB} MB</strong></p>
      <p>Hero-Pipeline: <strong>${w}</strong></p>
      <p>Filme: <strong>${(m=(g=v.size)!=null?g:(f=a==null?void 0:a.poolSizes)==null?void 0:f.movies)!=null?m:0}</strong> Eintr\xE4ge \xB7 Update: <strong>${I(v.updatedAt)}</strong> \xB7 Ablauf: <strong>${I(v.expiresAt)}</strong></p>
      <p>Serien: <strong>${(b=(h=k.size)!=null?h:(p=a==null?void 0:a.poolSizes)==null?void 0:p.series)!=null?b:0}</strong> Eintr\xE4ge \xB7 Update: <strong>${I(k.updatedAt)}</strong> \xB7 Ablauf: <strong>${I(k.expiresAt)}</strong></p>
    `}}function hh(){var n;let e=document.getElementById("debugPre");if(!e)return;let t=e.textContent||"";(n=navigator.clipboard)==null||n.writeText(t).catch(r=>{try{let o=document.createElement("textarea");o.value=t,document.body.append(o),o.select(),document.execCommand("copy"),o.remove()}catch{}})}var Tc=_(()=>{Z();tt();Er();Kn();rn()});function _c(e){Uo=typeof e=="function"?e:null}function Ic(e){Go=typeof e=="function"?e:null}function lr(e){if(Uo)try{Uo(e)}catch{}}function ph(e){if(Go)try{Go(e)}catch{}}function Lc(e){let t=document.getElementById("settingsOverlay"),n=t==null?void 0:t.querySelector(".settings-dialog"),r=document.getElementById("settingsBtn"),o=document.getElementById("openSettings"),i=document.getElementById("headerSettingsBtn"),s=document.getElementById("settingsClose2"),a=document.getElementById("tmdbTokenInput"),c=document.getElementById("tmdbSave"),l=document.getElementById("tmdbTest"),u=document.getElementById("tmdbStatus"),d=document.getElementById("tmdbClearCache"),f=document.getElementById("tmdbStatusBadge"),g=document.getElementById("prefReduceMotion"),m=document.getElementById("useTmdbSetting"),p=document.getElementById("resetFilters"),h=t==null?void 0:t.querySelector(".settings-body"),b=document.getElementById("heroCacheStatus"),v=document.getElementById("heroRefreshMovies"),k=document.getElementById("heroRefreshShows"),I=document.getElementById("heroRefreshAll");if(!b&&h){let y=document.createElement("div");y.className="settings-row",y.innerHTML=`
      <div class="settings-inline" id="heroRefreshControls">
        <button type="button" id="heroRefreshMovies" class="secondary">Highlights Filme aktualisieren</button>
        <button type="button" id="heroRefreshShows" class="secondary">Highlights Serien aktualisieren</button>
        <button type="button" id="heroRefreshAll" class="secondary">Alle Highlights aktualisieren</button>
      </div>
      <p class="settings-help" id="heroCacheStatus" aria-live="polite"></p>
    `,h.append(y),b=y.querySelector("#heroCacheStatus"),v=y.querySelector("#heroRefreshMovies"),k=y.querySelector("#heroRefreshShows"),I=y.querySelector("#heroRefreshAll")}let w=[v,k,I].filter(Boolean),T=null;function J(y,E){w.forEach(S=>{S&&(S.disabled=y||!ce(),S.disabled&&E?S.dataset.heroBusy=E:S.removeAttribute("data-hero-busy"))})}function Se(y){if(!Number.isFinite(y)||y<=0)return"unbekannt";try{return new Date(y).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return"unbekannt"}}function Le(y){if(!Number.isFinite(y)||y<=0)return"kein Ablauf";let E=y-Date.now();if(E<=0)return"abgelaufen";let S=E/6e4;if(S<1)return"l\xE4uft in <1 Min ab";if(S<60)return`l\xE4uft in ${Math.round(S)} Min ab`;let C=S/60;if(C<24)return`l\xE4uft in ${Math.round(C)} Std ab`;let P=C/24;return`l\xE4uft in ${Math.round(P)} Tg ab`}function Me(y,E){if(!E)return`${y}: keine Daten`;if(E.state==="disabled")return`${y}: deaktiviert`;if(E.state==="loading"||E.regenerating)return`${y}: wird aktualisiert \u2026`;if(E.state==="error")return`${y}: Fehler (${E.lastError||"unbekannt"})`;if(E.state==="stale")return`${y}: ${E.size} Eintr\xE4ge (Cache abgelaufen)`;let S=Se(E.updatedAt),C=Le(E.expiresAt);return`${y}: ${E.size} Eintr\xE4ge (Update ${S}, ${C})`}function F(y){var C,P,Xe,Ye,Je,sn;if(!b)return;if(!y||!ce()||y.enabled===!1){b.textContent="Hero-Pipeline deaktiviert \u2013 Legacy-Hero aktiv.",J(!0,"disabled");return}let E=!!((P=(C=y.status)==null?void 0:C.movies)!=null&&P.regenerating||(Ye=(Xe=y.status)==null?void 0:Xe.series)!=null&&Ye.regenerating);J(E,E?"busy":"");let S=[];S.push(Me("Filme",(Je=y.status)==null?void 0:Je.movies)),S.push(Me("Serien",(sn=y.status)==null?void 0:sn.series)),y.tmdb&&(y.tmdb.allowed?S.push(`TMDb ${y.tmdb.active?"aktiv":"aus (Toggle)"}`):S.push("TMDb deaktiviert")),y.featureSource&&S.push(`Feature-Flag: ${y.featureSource}`),b.textContent=S.join(" \u2022 ")}async function D(y="all",E="Highlights aktualisieren \u2026"){if(!ce())return;if(T)try{await T}catch{}return b&&E&&(b.textContent=E),J(!0,"busy"),T=(y==="movies"||y==="series"?nr(y):Ec()).then(()=>{lr()}).catch(C=>{}).finally(()=>{T=null,J(!1)}),T}ar(F),t&&t.hidden&&t.setAttribute("aria-hidden","true");let le=null,U="",Fe=!1,Ee=new Map,dr='a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])';function fr(){return t?Array.from(t.querySelectorAll(dr)).filter(y=>!y.hasAttribute("disabled")&&y.getAttribute("aria-hidden")!=="true"):[]}function Lt(){n&&typeof n.focus=="function"?n.focus({preventScroll:!0}):t&&typeof t.focus=="function"&&t.focus({preventScroll:!0})}function gr(y){if(!t)return;let E=Array.from(document.body.children).filter(S=>S!==t);y?E.forEach(S=>{Ee.has(S)||Ee.set(S,{ariaHidden:S.hasAttribute("aria-hidden")?S.getAttribute("aria-hidden"):null,inert:S.hasAttribute("inert")}),S.setAttribute("aria-hidden","true"),S.setAttribute("inert","")}):(E.forEach(S=>{let C=Ee.get(S);C?(C.ariaHidden===null||C.ariaHidden===void 0?S.removeAttribute("aria-hidden"):S.setAttribute("aria-hidden",C.ariaHidden),C.inert?S.setAttribute("inert",""):S.removeAttribute("inert"),Ee.delete(S)):(S.removeAttribute("aria-hidden"),S.removeAttribute("inert"))}),Ee.clear())}function hr(){!t||Fe||(Fe=!0,t.hidden=!1,t.setAttribute("aria-hidden","false"),le=document.activeElement instanceof HTMLElement?document.activeElement:null,U=document.body.style.overflow,document.body.style.overflow="hidden",gr(!0),qc(),requestAnimationFrame(Lt))}function mr(){!t||!Fe||(Fe=!1,t.hidden=!0,t.setAttribute("aria-hidden","true"),gr(!1),document.body.style.overflow=U,le&&typeof le.focus=="function"&&le.focus(),le=null)}function Gc(y){if(!Fe)return;if(y.key==="Escape"){y.preventDefault(),mr();return}if(y.key!=="Tab")return;let E=fr();if(!E.length){y.preventDefault(),Lt();return}let S=E[0],C=E[E.length-1],P=document.activeElement;y.shiftKey?(P===S||!t.contains(P))&&(y.preventDefault(),C.focus()):P===C&&(y.preventDefault(),S.focus())}r&&r.addEventListener("click",hr),o&&o.addEventListener("click",()=>{hr()}),i&&i.addEventListener("click",hr),s&&s.addEventListener("click",mr),t&&t.addEventListener("click",y=>{y.target===t&&mr()}),t&&t.addEventListener("keydown",Gc);function L(y="",E=""){if(u){u.textContent=y,u.dataset.kind=E,f&&(f.dataset.kind=E||"",f.title=y||"");try{if(E==="error"&&e&&e.tmdbApiKey){let S=String(localStorage.getItem("tmdbToken")||"").trim(),C=String((a==null?void 0:a.value)||"").trim();if(S&&C){try{localStorage.removeItem("tmdbToken")}catch{}a&&(a.value=""),Ae(!0);let P="Ung\xFCltiger Token entfernt. Verwende API Key aus config.json.";u.textContent=P,u.dataset.kind="info",f&&(f.dataset.kind="info",f.title=P)}}}catch{}}}function Ae(y){if(m&&(m.disabled=!y,m.title=m.disabled?"Nur verf\xFCgbar mit g\xFCltigem Token oder API Key.":"",!y&&m.checked)){try{localStorage.setItem("useTmdb","0")}catch{}m.checked=!1,V(x().view),lr()}}function qc(){let y="";try{a&&(a.value=y=localStorage.getItem("tmdbToken")||"")}catch{}try{g&&(g.checked=localStorage.getItem("prefReduceMotion")==="1")}catch{}try{m&&(m.checked=localStorage.getItem("useTmdb")==="1",m.disabled=!y,m.title=m.disabled?"Nur verf\xFCgbar mit g\xFCltigem Token.":"")}catch{}try{Ae(!!y||!!(e&&e.tmdbApiKey))}catch{}L("",""),e&&e.tmdbEnabled===!1?L("\u26A0\uFE0F TMDB ist in config.json deaktiviert (tmdbEnabled: false). Hero-Banner ben\xF6tigt TMDB!","error"):y||L("Kein Token hinterlegt. TMDB ist deaktiviert.","info"),y?(async()=>{var E;L("Pr\xFCfe Token...","pending");try{let S=await Promise.resolve().then(()=>(Ge(),mt)),C=await((E=S.validateToken)==null?void 0:E.call(S,y));C&&C.ok?(Ae(!0),C.as==="bearer"?L("Token g\xFCltig (v4 Bearer).","success"):C.as==="apikey"&&L('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success")):(Ae(!1),(C==null?void 0:C.hint)==="looksV3"?L('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):L("Token ung\xFCltig oder keine Berechtigung (401).","error"))}catch{L("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}})():Ae(!!(e&&e.tmdbApiKey))}v&&v.addEventListener("click",()=>{D("movies","Aktualisiere Film-Highlights \u2026")}),k&&k.addEventListener("click",()=>{D("series","Aktualisiere Serien-Highlights \u2026")}),I&&I.addEventListener("click",()=>{D("all","Aktualisiere alle Highlights \u2026")}),c&&c.addEventListener("click",async()=>{var E,S;let y=String((a==null?void 0:a.value)||"").trim();try{localStorage.setItem("tmdbToken",y)}catch{}if(!y){st(e,{preferStoredToken:!1,token:""}),L("Kein Token hinterlegt. TMDB ist deaktiviert.","info"),Ae(!!(e&&e.tmdbApiKey)),ir((E=m==null?void 0:m.checked)!=null?E:!1),D("all","Highlights aktualisieren (Token entfernt)\u2026");return}st(e,{preferStoredToken:!1,token:y}),L("Pr\xFCfe Token...","pending");try{let C=await Promise.resolve().then(()=>(Ge(),mt)),P=await((S=C.validateToken)==null?void 0:S.call(C,y));P&&P.ok?(Ae(!0),P.as==="bearer"?L("Token g\xFCltig (v4 Bearer).","success"):P.as==="apikey"&&L('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success")):(Ae(!1),(P==null?void 0:P.hint)==="looksV3"?L('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):L("Token ung\xFCltig oder keine Berechtigung (401).","error"))}catch{L("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}e&&e.tmdbEnabled===!1&&y&&L('\u26A0\uFE0F Token gespeichert, aber TMDB in config.json deaktiviert. Bitte "tmdbEnabled": true setzen!',"error"),ir(!0),D("all","Highlights aktualisieren (Token ge\xE4ndert)\u2026")}),l&&l.addEventListener("click",async()=>{var E;let y=String((a==null?void 0:a.value)||"").trim();if(!y){L("Bitte Token eingeben.","error");return}L("Pr\xFCfe Token...","pending");try{let S=await Promise.resolve().then(()=>(Ge(),mt)),C=await((E=S.validateToken)==null?void 0:E.call(S,y));C&&C.ok?C.as==="bearer"?L("Token g\xFCltig (v4 Bearer).","success"):C.as==="apikey"&&L('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success"):(C==null?void 0:C.hint)==="looksV3"?L('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):L("Token ung\xFCltig oder keine Berechtigung (401).","error")}catch{L("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}}),d&&d.addEventListener("click",()=>{Promise.resolve().then(()=>(de(),Ii)).then(y=>{var S;let E=(S=y.clearHeroCache)==null?void 0:S.call(y);E&&!E.error&&L(`Cache geleert: ${E.heroEntries} Hero-Eintr\xE4ge, ${E.tmdbCacheEntries} TMDB-Eintr\xE4ge. Token erhalten.`,"success")}),Promise.resolve().then(()=>(Ge(),mt)).then(y=>{var E;return(E=y.clearCache)==null?void 0:E.call(y)}),D("all","Highlights aktualisieren (TMDB-Cache geleert)\u2026")}),g&&g.addEventListener("change",()=>{try{localStorage.setItem("prefReduceMotion",g.checked?"1":"0")}catch{}ph(g.checked)}),m&&m.addEventListener("change",()=>{try{localStorage.setItem("useTmdb",m.checked?"1":"0")}catch{}m.checked&&!xc&&(xc=!0,Promise.resolve().then(()=>(Ge(),mt)).then(y=>{var S;let E=x();(S=y.hydrateOptional)==null||S.call(y,E.movies,E.shows,E.cfg)}).catch(y=>{}),setTimeout(()=>{m.checked&&V(x().view)},1200),setTimeout(()=>{m.checked&&V(x().view)},3e3)),ir(!0),V(x().view),lr()}),p&&p.addEventListener("click",()=>{let y=document.getElementById("search");y&&(y.value="");let E=document.getElementById("q");E&&(E.value="");let S=document.getElementById("onlyNew");S&&(S.checked=!1);let C=document.getElementById("yearFrom"),P=document.getElementById("yearTo");C&&(C.value=""),P&&(P.value="");let Xe=document.getElementById("collectionFilter");Xe&&(Xe.value=""),document.querySelectorAll("#genreFilters .chip.active").forEach(Je=>Je.classList.remove("active"));let Ye=document.getElementById("genreFilters");Ye&&(Ye.dataset.state="empty",Ye.dataset.count="0"),Promise.resolve().then(()=>(wo(),Ao)).then(Je=>{let sn=Je.applyFilters();V(x().view),lr(sn)})})}var Uo,Go,xc,Mc=_(()=>{Z();Rn();rn();at();Uo=null,Go=null,xc=!1});function Yo(e){return xt=e||null,xt}function Hc(){var t,n,r,o,i,s,a,c;if(qo)return qo;let e={title:((n=(t=document.getElementById("heroTitle"))==null?void 0:t.textContent)==null?void 0:n.trim())||"",tagline:((o=(r=document.getElementById("heroTagline"))==null?void 0:r.textContent)==null?void 0:o.trim())||"",overview:((s=(i=document.getElementById("heroOverview"))==null?void 0:i.textContent)==null?void 0:s.trim())||"",cta:((c=(a=document.getElementById("heroCta"))==null?void 0:a.textContent)==null?void 0:c.trim())||""};return qo=e,e}function Rc(e){Vo=typeof e=="function"?e:null}function $c(e="default",t={}){let n=document.getElementById("hero"),r=document.getElementById("heroTitle"),o=document.getElementById("heroTagline"),i=document.getElementById("heroOverview"),s=document.getElementById("heroCta"),a=document.getElementById("heroMeta"),c=document.getElementById("heroMetaPrimary"),l=document.getElementById("heroMetaSecondary"),u=document.getElementById("heroMetaTertiary"),d=document.getElementById("heroPicture"),f=document.getElementById("heroBackdropImage"),g=document.getElementById("heroBackdropLarge"),m=document.getElementById("heroBackdropMedium");if(!n||!r||!o||!i||!s||!a)return!1;let p=Hc(),h={...Fc.default,...Fc[e]||{},...t||{}};Yo(null),Xo=e,n.dataset.heroKind="fallback",n.dataset.heroId="",n.dataset.state="fallback",n.classList.remove("hero--has-media"),Zo(d,f,g,m),r.textContent=h.title||p.title;let b=h.tagline||"";o.textContent=b||p.tagline,o.hidden=!b,o.dataset.taglinePaused="0",delete o.dataset.heroBound,o.classList.remove("is-fading");let v=h.overview||"";i.textContent=v,i.hidden=!v;let k=h.cta||p.cta||s.textContent||"Browse featured titles";s.textContent=k;let I=typeof h.ctaAction=="function"&&h.ctaEnabled===!0;return s.disabled=!I,s.setAttribute("aria-disabled",I?"false":"true"),I?(s.onclick=()=>{try{h.ctaAction()}catch{}},s.setAttribute("aria-label",h.ctaLabel||k)):(s.onclick=null,s.removeAttribute("aria-label")),a.hidden=!0,c&&(c.innerHTML=""),l&&(l.innerHTML=""),u&&(u.innerHTML=""),!0}function Ve(e){var I,w;let t=document.getElementById("hero"),n=document.getElementById("heroTitle"),r=document.getElementById("heroTagline"),o=document.getElementById("heroOverview"),i=document.getElementById("heroCta"),s=document.getElementById("heroMeta"),a=document.getElementById("heroMetaPrimary"),c=document.getElementById("heroMetaSecondary"),l=document.getElementById("heroMetaTertiary"),u=document.getElementById("heroPicture"),d=document.getElementById("heroBackdropImage"),f=document.getElementById("heroBackdropLarge"),g=document.getElementById("heroBackdropMedium");if(!t||!n||!r||!o||!i||!s)return;let m=Hc(),p=yh(e);if(!p){Yo(null),Xo=null,t.dataset.heroKind="",t.dataset.heroId="",t.dataset.state="empty",t.classList.remove("hero--has-media"),Zo(u,d,f,g),n.textContent=m.title,r.textContent=m.tagline,r.hidden=!m.tagline,r.dataset.taglinePaused="0",delete r.dataset.heroBound,r.classList.remove("is-fading"),o.textContent=m.overview,o.hidden=!m.overview,i.textContent=m.cta||"View details",i.disabled=!0,i.setAttribute("aria-disabled","true"),i.removeAttribute("aria-label"),i.onclick=null,s.hidden=!0,a&&(a.innerHTML=""),c&&(c.innerHTML=""),l&&(l.innerHTML="");return}let h=Dc(p);if(!h)return Ve([]);Yo(h),Xo=null;let b=h.type==="tv"?"show":"movie",v=((I=h.cta)==null?void 0:I.id)||h.id||"";try{Ja(b==="show"?"series":"movies",h)}catch{}if(t.dataset.heroKind=b,t.dataset.heroId=v,t.dataset.state="ready",n.textContent=h.title||m.title,r){let T=h.tagline||"";r.textContent=T,r.hidden=!T,r.dataset.taglinePaused=T?"1":"0",T?r.dataset.heroBound="1":delete r.dataset.heroBound,r.classList.remove("is-fading")}if(o){let T=h.overview||"";o.textContent=T,o.hidden=!T}let k=((w=h.cta)==null?void 0:w.label)||(b==="show"?"View show details":"View movie details");i.textContent=k,i.disabled=!1,i.setAttribute("aria-disabled","false"),i.setAttribute("aria-label",h.title?`${k}: ${h.title}`:k),i.onclick=()=>Hh(h),Fh(a,c,l,s,h),Nh(t,u,d,f,g,h)}function yh(e){if(Array.isArray(e)&&e.length){let n=Jo(e);if(n.length)return Pc(n)}let t=Sh();return t.length?Pc(t):null}function Jo(e){if(!Array.isArray(e))return[];let t=[];return e.forEach(n=>{if(!vh(n))return;let r=Dc(n);r&&t.push(r)}),t}function vh(e){return!(!e||typeof e!="object"||e.isCollectionGroup||(typeof e.type=="string"?e.type.toLowerCase():"")==="collection")}function Pc(e){if(e.length===1)return e[0];let t=Math.floor(Math.random()*e.length),n=e[t];return xt&&e.length>1&&n&&xt&&n.id===xt.id&&e.find(o=>o&&o.id!==xt.id)||n}function Sh(){let e=x(),t=e.view==="shows"?"series":"movies",n=wt(t,{allowExpired:!0})||null,r=Array.isArray(n==null?void 0:n.items)?Jo(n.items):[];if(r.length)return r;let i=(Array.isArray(e.filtered)&&e.filtered.length?e.filtered:null)||(t==="series"?e.shows:e.movies)||[];return Jo(i)}function Dc(e){return!e||typeof e!="object"?null:Eh(e)?{...e,cta:e.cta?{...e.cta}:null}:Ah(e)}function Eh(e){var n;if(!e||typeof e!="object")return!1;let t=((n=e==null?void 0:e.cta)==null?void 0:n.id)||(e==null?void 0:e.heroId);return!!(e.title&&t)}function Ah(e){if(!e||typeof e!="object")return null;let t=e.type==="tv"?"tv":"movie",n=String(e.title||e.name||"").trim();if(!n)return null;let r=wh(e),o=r.tmdb||r.imdb||r.ratingKey||"";if(!o)return null;let i=kh(e),s=Ch(e,t),a=Th(e),c=xh(e),l=_h(e),u=Ih(e),d=Lh(e),f=Mh(e),g={id:o,kind:t==="tv"?"show":"movie",label:t==="tv"?"View show details":"View movie details",target:`#/${t==="tv"?"show":"movie"}/${o}`};return{id:r.ratingKey||`${t}-${o}`,type:t,title:n,tagline:d,overview:u,year:i,runtime:s,rating:a,genres:c,certification:l,cta:g,ids:r,backdrops:f}}function wh(e){let t={};return e!=null&&e.ids&&typeof e.ids=="object"&&(e.ids.tmdb&&(t.tmdb=String(e.ids.tmdb)),e.ids.imdb&&(t.imdb=String(e.ids.imdb)),e.ids.tvdb&&(t.tvdb=String(e.ids.tvdb))),(e==null?void 0:e.ratingKey)!=null&&(t.ratingKey=String(e.ratingKey)),e!=null&&e.guid&&(t.guid=String(e.guid)),t}function kh(e){let t=$(e);return t?Number(t):null}function Ch(e,t){var r,o;let n=(o=(r=e==null?void 0:e.runtimeMin)!=null?r:e==null?void 0:e.durationMin)!=null?o:e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null;return!Number.isFinite(n)||n<=0?null:Math.max(1,Math.round(n))}function Th(e){var n;let t=Number((n=e==null?void 0:e.rating)!=null?n:e==null?void 0:e.audienceRating);return Number.isFinite(t)?t:null}function xh(e){let t=Array.isArray(e==null?void 0:e.genres)?e.genres:[],n=[];return t.forEach(r=>{if(!r)return;if(typeof r=="string"){let i=r.trim();i&&n.push(i);return}let o=r.tag||r.title||r.name||r.label||"";o&&n.push(o)}),Array.from(new Set(n))}function _h(e){let t=typeof(e==null?void 0:e.contentRating)=="string"?e.contentRating.trim():"";if(!t)return"";let n=t.split("/"),r=n[n.length-1];return r?r.trim():t}function Ih(e){let t=[e==null?void 0:e.summary,e==null?void 0:e.plot,e==null?void 0:e.description,e==null?void 0:e.tagline];for(let n of t){if(typeof n!="string")continue;let r=n.trim();if(r)return r}return""}function Lh(e){let t=[e==null?void 0:e.tagline];for(let n of t){if(typeof n!="string")continue;let r=n.trim();if(r)return r}return""}function Mh(e){var i,s,a,c,l;let t=De(),n=[(i=e==null?void 0:e.tmdb)==null?void 0:i.backdrop,(s=e==null?void 0:e.tmdb)==null?void 0:s.backdrop_path,(a=e==null?void 0:e.tmdb)==null?void 0:a.backdropPath,(c=e==null?void 0:e.tmdb)==null?void 0:c.background,(l=e==null?void 0:e.tmdb)==null?void 0:l.art],r=[e==null?void 0:e.art,e==null?void 0:e.background,e==null?void 0:e.thumbBackground,e==null?void 0:e.coverArt,e==null?void 0:e.thumb,e==null?void 0:e.thumbFile],o=[];return t&&n.forEach(u=>{let d=Nc(u,!0);d&&!o.includes(d)&&o.push(d)}),r.forEach(u=>{let d=Nc(u,!1);d&&!o.includes(d)&&o.push(d)}),o}function Nc(e,t){if(typeof e!="string")return"";let n=e.trim();return n?n.startsWith("http")?n:n.startsWith("/")&&t&&!n.startsWith("/library/")?`https://image.tmdb.org/t/p/original${n}`:n:""}function Fh(e,t,n,r,o){let i=Ph(o),[s=[],a=[],c=[]]=i;Wo(e,s),Wo(t,a),Wo(n,c);let l=s.length||a.length||c.length;r.hidden=!l}function Ph(e){let t=[],n=[];if(Number.isFinite(e.year)&&n.push({text:String(e.year),label:"Release year"}),Number.isFinite(e.runtime)){let i=e.type==="tv"?`${e.runtime} min/ep`:Bh(e.runtime);n.push({text:i,label:e.type==="tv"?"Episode runtime":"Runtime"})}e.certification&&n.push({text:e.certification,label:"Certification",kind:"certification"}),n.length&&t.push(n);let r=[];if(e.rating!=null){let i=O(e.rating);r.push({text:`\u2605 ${i}`,label:`Average rating ${i} out of 10`,kind:"rating"})}if(e.voteCount!=null){let i=bh.format(e.voteCount);r.push({text:`${i} votes`,label:`${i} votes recorded`})}if(e.type==="tv"){let i=[];Number.isFinite(e.seasons)&&e.seasons>0&&i.push(`${e.seasons} ${e.seasons===1?"Season":"Seasons"}`),Number.isFinite(e.episodes)&&e.episodes>0&&i.push(`${e.episodes} ${e.episodes===1?"Episode":"Episodes"}`),i.length&&r.push({text:i.join(" \u2022 "),label:"Episode availability"})}r.length&&t.push(r);let o=[];return Array.isArray(e.genres)&&e.genres.slice(0,3).forEach(i=>{let s=typeof i=="string"?i:"";s&&o.push({text:s,label:`Genre: ${s}`})}),o.length&&t.push(o),t}function Wo(e,t){if(!e)return;if(!t||!t.length){e.innerHTML="",e.hidden=!0;return}let n=document.createDocumentFragment();t.forEach(r=>{let o=document.createElement("span");o.className="hero__badge",r.kind==="certification"&&o.classList.add("hero__badge--certification"),r.kind==="rating"&&o.classList.add("hero__badge--rating"),o.textContent=r.text,r.label&&o.setAttribute("aria-label",r.label),n.appendChild(o)}),e.replaceChildren(n),e.hidden=!1}function Nh(e,t,n,r,o,i){let a=(Array.isArray(i.backdrops)?i.backdrops.filter(Boolean):[])[0]||"";if(!t||!n){e.classList.toggle("hero--has-media",!!a);return}if(!a){Zo(t,n,r,o),e.classList.remove("hero--has-media");return}e.classList.add("hero--has-media"),Bc(r,a),Bc(o,a),n.src=a,n.alt=i.title?`${i.title} backdrop`:"",n.removeAttribute("hidden"),t.hidden=!1}function Bc(e,t){e&&(t?e.srcset=t:e.removeAttribute("srcset"))}function Zo(e,t,n,r){n&&n.removeAttribute("srcset"),r&&r.removeAttribute("srcset"),t&&(t.removeAttribute("src"),t.setAttribute("hidden","")),e&&(e.hidden=!0)}function Bh(e){if(!Number.isFinite(e)||e<=0)return"";let t=Math.floor(e/60),n=Math.round(e%60);return t&&n?`${t}h ${n}m`:t?`${t}h`:`${n}m`}function Hh(e){let t=e==null?void 0:e.cta,n=(t==null?void 0:t.kind)||(e.type==="tv"?"show":"movie"),r=(t==null?void 0:t.id)||e.id;!n||!r||(Rh(n,r,t==null?void 0:t.target),n==="show"?gt(r):ft(r))}function Rh(e,t,n){if(!e||!t)return;let r=n||`#/${e}/${t}`,o=(window.location.hash||"")===r;if(typeof Vo=="function")try{Vo(r,{silent:!0,replace:o});return}catch{}try{window.location.hash=r}catch{}}var bh,xt,qo,Vo,Xo,Fc,Qo=_(()=>{Z();Fn();de();Zn();bh=typeof Intl!="undefined"?new Intl.NumberFormat("en-US"):{format:e=>String(e)},xt=null,qo=null,Vo=null,Xo=null,Fc={default:{title:"Highlights temporarily unavailable",tagline:"TMDb data could not be loaded just now.",overview:"The hero banner falls back to a neutral gradient until artwork and metadata are available again. Feel free to keep browsing and refresh later."},"rate-limit":{title:"Highlights are catching their breath",tagline:"TMDb is currently rate limiting our artwork requests.",overview:"We are slowing down hero generation until the limit resets. Your library stays accessible in the meantime."},error:{title:"Highlights paused",tagline:"Fresh TMDb data is temporarily unavailable.",overview:"We will automatically retry fetching artwork. You can also trigger a manual refresh from the settings when you are ready."}}});function zc({onRefresh:e=Ve}={}){let t=document.getElementById("hero"),n=document.getElementById("heroTimer"),r=n?n.querySelector(".hero-timer__bar"):null;if(!t||!n||!r)return null;if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return n.hidden=!0,null;n.removeAttribute("aria-hidden"),n.dataset.state="running";let i=15e3,s=new Set,a=!1,c=0,l=null,u=0,d=ce(),f=k(),g=[],m=0,p=!1,h="",b=null,v=null;d&&(Se(Tt(f)),b=ar(()=>{Se(Tt(f))})),v=oi(()=>{let F=k();F!==f&&(f=F,d&&Se(Tt(f)))});function k(){return x().view==="shows"?"series":"movies"}function I(){return s.size>0}function w(){let F=I();n.dataset.state=F?"paused":"running",a&&!F&&(u=0),a=F}function T(F,D){D?s.add(F):s.delete(F),w()}function J(){return g.length?(m=(m+1)%g.length,g[m]):null}function Se(F){var Lt;if(!F)return;let D=Array.isArray(F.items)?F.items:[],U=(Lt=(F.snapshot||Ac()).status)==null?void 0:Lt[f],Fe=!sr()||(U==null?void 0:U.regenerating),Ee=`${f}:${(U==null?void 0:U.updatedAt)||0}:${D.length}`,dr=g.length>0,fr=p;if(g=D,m=D.length?F.startIndex%D.length:0,p=Fe||!D.length,T("pipeline",p),!p&&D.length&&(!dr||fr||h!==Ee)){try{e==null||e([D[m]])}catch{}c=0,r.style.setProperty("--p","0")}h=Ee}function Le(F){if(I()){u=F,l=requestAnimationFrame(Le);return}u||(u=F);let D=Math.max(0,F-u);u=F,c+=D;let le=Math.max(0,Math.min(1,c/i));if(r.style.setProperty("--p",String(le)),le>=1){c=0,u=F,r.style.setProperty("--p","0");try{if(d){let U=J();U?e==null||e([U]):e==null||e()}else e==null||e()}catch{}}l=requestAnimationFrame(Le)}function Me(){l||(l=requestAnimationFrame(Le))}return t.addEventListener("mouseenter",()=>{T("hover",!0)}),t.addEventListener("mouseleave",()=>{T("hover",!1)}),document.addEventListener("visibilitychange",()=>{T("hidden",document.hidden)}),document.hidden?T("hidden",!0):w(),Me(),{pause(){T("manual",!0)},resume(){T("manual",!1)},reset(){c=0,r.style.setProperty("--p","0")},destroy(){b&&b(),v&&v()}}}var Oc=_(()=>{Qo();Z();rn()});function Dh(e){try{ur&&(ur.tmdbEnrichment=!!(e&&e.tmdbEnabled)),typeof window!="undefined"&&window.FEATURES&&window.FEATURES!==ur&&(window.FEATURES={...window.FEATURES,...ur})}catch{}}function zh(e,t){if(on.reason===e)return;on.reason=e;let n=jc[e]||jc.default;try{n(t)}catch{}}function ve(e){var t,n,r,o;if(Array.isArray(e)&&e.length){on.reason=null,Ve(e);return}if(ce()){let i=x().view==="shows"?"series":"movies",s=Tt(i),a=(n=(t=s==null?void 0:s.snapshot)==null?void 0:t.status)==null?void 0:n[i],c=sr(),l=a==null?void 0:a.regenerating,u=Array.isArray(s==null?void 0:s.items)?s.items:[],d=(o=(r=s==null?void 0:s.snapshot)==null?void 0:r.tmdb)==null?void 0:o.rateLimit,f=!!(d!=null&&d.active),g=(a==null?void 0:a.state)==="error";if(!u.length&&(g||f&&c&&!l)){let p=g?"error":"rate-limit";$c(p)&&zh(p,{status:a,rateLimit:d});return}if(c&&!l&&u.length){let p=s.startIndex%u.length,h=u[p];if(h){on.reason=null,Ve([h]);return}}}on.reason=null,Ve(e)}function It(e,t=!0){let n=document.getElementById("footerMeta");if(n){let o=n.querySelector("#footerStatus");o?o.textContent=e:n.textContent=e,n.dataset.state=t?"loading":"ready"}let r=document.getElementById("grid");r&&r.setAttribute("aria-busy",t?"true":"false")}async function Oh(){let e=!!globalThis.__PLEX_TEST_MODE__;Mt(),Gh(),ii(),It("Initialisiere \u2026",!0),Ne("Initialisiere \u2026",8),si(18);let t=fetch("config.json").then(a=>a.json()).catch(a=>(q("Konfiguration konnte nicht geladen werden","Verwende Standardeinstellungen"),{startView:"movies",tmdbEnabled:!1})),n=ha().catch(a=>bt()),[r,o]=await Promise.all([t,n]);Dh(r),st(r);let i=yc({cfg:r,policy:o});Pe({cfg:r,view:r.startView||"movies",heroPolicy:o,heroPolicyIssues:jn(),heroPipelineEnabled:i.enabled,heroPipelineSource:i.source});try{It("Filme laden \u2026",!0),Ne("Filme laden \u2026",25);let a=await wi();It("Serien laden \u2026",!0),Ne("Serien laden \u2026",45);let c=await ki();It("Filter vorbereiten \u2026",!0),Ne("Filter vorbereiten \u2026",60);let l=yo(a,c);if(Pe({movies:a,shows:c,facets:l}),vc({movies:a,shows:c}),or(x().view),ce()){It("Highlights vorbereiten \u2026",!0),Ne("Highlights vorbereiten \u2026",70);try{await Sc()}catch{}}It("Ansicht aufbauen \u2026",!0),Ne("Ansicht aufbauen \u2026",85),vr(),ni(),vo(l),Eo();let u=ht();if(Kh(!0),V(x().view),Uh(),un(),r.tmdbEnabled&&(window.requestIdleCallback?window.requestIdleCallback(()=>{var d;return(d=zn)==null?void 0:d(a,c,r)},{timeout:600}):setTimeout(()=>{var d;return(d=zn)==null?void 0:d(a,c,r)},400)),!e)Bi(),Lc(r),qh(),Wh(),Vh(),Xh(),Yh(),ve(u),zc({onRefresh:ve}),Cc();else try{ve(u)}catch{}Uc(!0)}catch(a){throw un(),vr(),Cr("Fehler beim Laden der Daten",()=>window.location.reload()),a}let s;window.addEventListener("tmdb:chunk",()=>{s||(s=requestAnimationFrame(()=>{s=null;try{localStorage.getItem("useTmdb")==="1"&&V(x().view),ve()}catch{}}))}),window.addEventListener("tmdb:done",()=>{try{localStorage.getItem("useTmdb")==="1"&&V(x().view),ve()}catch{}})}function jh(e){if(/^#\/(movies|shows)$/.test(e)){let s=e.includes("shows")?"shows":"movies";Pe({view:s}),or(s),jo(s==="shows"?"series":"movies").catch(c=>{});let a=ht();return ni(),V(s),ve(a),!0}let t=e.match(/^#\/(movie|show)\/(.+)/);if(!t)return!1;let[,n,r]=t,i=((n==="movie"?x().movies:x().shows)||[]).find(s=>{var a,c;return((a=s==null?void 0:s.ids)==null?void 0:a.imdb)===r||((c=s==null?void 0:s.ids)==null?void 0:c.tmdb)===r||String(s==null?void 0:s.ratingKey)===r});return i?(n==="show"?gt(i):ft(i),!0):!1}function Uc(e=!1){let t=window.location.hash||"";!e&&!ti.shouldHandle(t)||(e&&ti.markProcessed(t),jh(t))}function ni(){let e=document.getElementById("libraryTabs");if(!e)return;let t=Array.from(e.querySelectorAll("[data-lib]")),n=x().view==="shows"?"shows":"movies";t.forEach(r=>{let o=r.dataset.lib==="series"?"shows":"movies",i=n===o;r.classList.toggle("is-active",i),r.setAttribute("aria-pressed",i?"true":"false"),r.dataset.bound!=="true"&&(r.addEventListener("click",()=>{let s=r.dataset.lib==="series"?"shows":"movies";if(x().view===s)return;if(Pe({view:s}),or(s),ce()){let l=jo(s==="shows"?"series":"movies");l&&typeof l.catch=="function"&&l.catch(u=>{})}$n(s==="movies"?"#/movies":"#/shows",{silent:!0}),ni();let c=ht();V(s),ve(c)}),r.dataset.bound="true")})}function Kh(e=!1){let t=document.getElementById("heroStats");if(!t)return;let n=x(),r=(n.movies||[]).length,o=(n.shows||[]).length,i=t.querySelector('[data-stat="movies"]'),s=t.querySelector('[data-stat="shows"]');!i||!s||(e?(Kc(i,r),Kc(s,o)):(i.textContent=String(r),s.textContent=String(o)))}function Kc(e,t){if(!e)return;let n=Number(e.textContent)||0,r=Number(t)||0;if(n===r){e.textContent=String(r);return}let o=480,i=performance.now();function s(a){let c=Math.min(1,(a-i)/o),l=Math.round(n+(r-n)*(c<.5?2*c*c:-1+(4-2*c)*c));e.textContent=String(l),c<1?requestAnimationFrame(s):e.textContent=String(r)}requestAnimationFrame(s)}function Uh(){let e=document.getElementById("footerMeta");if(!e)return;let t=document.getElementById("footerStatus"),n=x(),r=n.movies||[],o=n.shows||[],i=r.concat(o).map(l=>new Date(l.addedAt||0).getTime()).filter(Number.isFinite),a=(i.length?new Date(Math.max(...i)):new Date).toISOString().slice(0,10);t&&(t.textContent=`Stand: ${a}`),e.dataset.state="ready";let c=document.getElementById("grid");c&&c.setAttribute("aria-busy","false")}function ri(e){var t,n;try{let r=document.body;r?((t=document.documentElement)==null||t.classList.remove("reduce-motion","reduced-motion"),r.classList.remove("reduced-motion"),r.classList.toggle("reduce-motion",e)):((n=document.documentElement)==null||n.classList.toggle("reduce-motion",e),window.addEventListener("DOMContentLoaded",()=>ri(e),{once:!0}))}catch{}}function Gh(){try{let e=localStorage.getItem("prefReduceMotion")==="1";ri(e)}catch{}}function qh(){let e=document.getElementById("toggleAdvanced"),t=document.getElementById("advancedFilters");if(!e||!t)return;let n=!1,r=0,o=()=>{n=!1,r&&(clearTimeout(r),r=0),t.dataset.state==="closing"?(t.dataset.state="closed",t.hidden=!0,t.style.removeProperty("--advanced-max")):t.dataset.state==="open"?t.style.removeProperty("--advanced-max"):t.dataset.state==="expanding"&&(t.dataset.state="open",t.style.removeProperty("--advanced-max"))},i=()=>{r&&clearTimeout(r),r=window.setTimeout(o,320)};t.addEventListener("transitionend",c=>{c.target!==t||c.propertyName!=="max-height"||o()});let s=()=>{n||(n=!0,t.hidden=!1,t.dataset.state="expanding",t.setAttribute("aria-hidden","false"),t.style.setProperty("--advanced-max","0px"),requestAnimationFrame(()=>{let c=t.scrollHeight;t.style.setProperty("--advanced-max",c+"px"),t.dataset.state="open",i()}))},a=()=>{if(n)return;n=!0;let c=t.scrollHeight;t.style.setProperty("--advanced-max",c+"px"),t.dataset.state="closing",t.setAttribute("aria-hidden","true"),requestAnimationFrame(()=>{t.style.setProperty("--advanced-max","0px"),i()})};e.addEventListener("click",()=>{e.getAttribute("aria-expanded")==="true"?(e.setAttribute("aria-expanded","false"),a()):(e.setAttribute("aria-expanded","true"),s())})}function Wh(){let e=document.getElementById("siteLogo");e&&e.addEventListener("error",()=>{e.classList.add("logo-missing");let i=document.querySelector(".site-header__brand-text .site-header__label");i&&i.classList.remove("sr-only")});let t=document.getElementById("heroTagline"),n=["Curated spotlights and smart filters for every mood.","Bring Plex highlights on the road with offline browsing.","Plan your next movie night with shareable watchlists."],r=0;t&&!t.textContent&&(t.textContent=n[r]);function o(){!t||t.dataset.taglinePaused==="1"||(t.classList.add("is-fading"),setTimeout(()=>{if(!t||t.dataset.taglinePaused==="1"){t&&t.classList.remove("is-fading");return}r=(r+1)%n.length,t.textContent=n[r],t.classList.remove("is-fading")},280))}t?(t.dataset.taglinePaused=t.dataset.taglinePaused==="1"?"1":"0",_t&&clearInterval(_t),_t=setInterval(o,6e3),setTimeout(o,3e3)):_t&&(clearInterval(_t),_t=null)}function Vh(){let e=document.getElementById("scrollProgress");if(!e)return;let t=()=>{let n=document.documentElement.scrollTop||document.body.scrollTop||0,r=document.documentElement.scrollHeight-document.documentElement.clientHeight||1,o=Math.max(0,Math.min(100,n/r*100));e.style.width=o+"%"};addEventListener("scroll",t,{passive:!0}),t()}function Xh(){let e=document.getElementById("scrollTop");if(!e)return;let t=()=>{let n=window.scrollY||0;e.style.display=n>300?"block":"none"};addEventListener("scroll",t,{passive:!0}),t(),e.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"}))}function Yh(){let e=document.querySelector(".filters");if(!e||typeof CSS!="undefined"&&typeof CSS.supports=="function"&&CSS.supports("animation-timeline: scroll()"))return;let n=window.scrollY||window.pageYOffset||0,r=!1,o=!1,i=120,s=8,a=d=>{r!==d&&(r=d,e.classList.toggle("is-hidden",r))},c=()=>{o=!1;let d=window.scrollY||window.pageYOffset||0;if(d<=i){a(!1),n=d;return}let f=d-n;n=d,f>s?a(!0):f<-s&&a(!1)},l=()=>{o||(o=!0,requestAnimationFrame(c))};window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",c);let u=()=>a(!1);e.addEventListener("focusin",u),e.addEventListener("pointerenter",u,{passive:!0}),e.addEventListener("pointerdown",u,{passive:!0}),c()}var $h,ur,_t,on,jc,ti,$n,ei,ia=_(()=>{Z();ai();tt();wo();Rn();Fn();Ge();Nr();Tc();fn();Mc();Qo();Oc();Kn();rn();at();$h={tmdbEnrichment:!1},ur=(()=>{let e=typeof window!="undefined"&&window.FEATURES?window.FEATURES:{},t={...$h,...e};return typeof window!="undefined"&&(window.FEATURES=t),t})();_t=null,on={reason:null},jc={"rate-limit":()=>q("TMDb drosselt Anfragen","Highlights werden kurzzeitig langsamer aktualisiert."),error:e=>{var t;return q("Highlights vor\xFCbergehend nicht verf\xFCgbar",((t=e==null?void 0:e.status)==null?void 0:t.lastError)||"TMDb-Daten konnten nicht geladen werden.")},default:()=>q("Highlights vor\xFCbergehend nicht verf\xFCgbar","TMDb-Daten konnten nicht geladen werden.")};ti=(()=>{let e=window.location.hash||"",t=null;function n(s){if(typeof s!="string")return"";let a=s.trim();return a?a.startsWith("#")?a:`#${a}`:""}function r(s,a={}){let{replace:c=!1,silent:l=!1}=a,u=n(s);if(!u)return;let d=window.location.hash||"";if(u===d){if(c&&history&&typeof history.replaceState=="function")try{history.replaceState(null,"",u)}catch{}l&&(t=u,e=u);return}let f=c?"replaceState":"pushState",g=!1;try{history&&typeof history[f]=="function"&&(history[f](null,"",u),g=!0)}catch{}if(!g){window.location.hash=u,l&&(t=u,e=u);return}if(l){t=u,e=u;return}try{let m=typeof HashChangeEvent=="function"?new HashChangeEvent("hashchange"):new Event("hashchange");window.dispatchEvent(m)}catch{}}function o(s){let a=typeof s=="string"?s:"";return t&&a===t?(t=null,!1):(t=null,a===e?!1:(e=a,!0))}function i(s){e=typeof s=="string"?s:"",t=null}return{navigate:r,shouldHandle:o,markProcessed:i}})(),$n=(e,t)=>ti.navigate(e,t);Rc($n);ei=null;window.addEventListener("hashchange",()=>{ei&&clearTimeout(ei),ei=setTimeout(()=>{Uc(!1)},50)});So(e=>{try{ve(e)}catch{}});_c(e=>{try{ve(e)}catch{}});Ic(e=>{try{ri(!!e)}catch{}});globalThis.__PLEX_TEST_MODE__||Oh();window.addEventListener("load",()=>{try{un()}catch{}})});ia();export{Oh as boot,$n as navigateToHash};
//# sourceMappingURL=main.js.map
