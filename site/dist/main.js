var Mc=Object.defineProperty;var M=(e,t)=>()=>(e&&(t=e(e=0)),t);var et=(e,t)=>{for(var n in t)Mc(e,n,{get:t[n],enumerable:!0})};function Pe(e){Object.assign(lr,e),ur.forEach(t=>t(lr))}function Vo(e){return ur.add(e),()=>ur.delete(e)}var lr,ur,I,Y=M(()=>{lr={view:"movies",movies:[],shows:[],facets:{},filtered:[],cfg:{},heroPolicy:null,heroPolicyIssues:[]},ur=new Set,I=()=>lr});function H(e,t,n){let r=document.createElement(e);return t&&(r.className=t),n!=null&&(r.textContent=n),r}var K,cn=M(()=>{K=(e,t=document)=>t.querySelector(e)});function dr(){if(!ge&&(ge=K("#loaderOverlay"),!ge)){ge=H("div","loader-overlay"),ge.id="loaderOverlay",ge.hidden=!0;let e=H("div","loader");un=H("div","msg",""),ln=H("div","bar"),e.append(un,ln),ge.append(e),document.body.append(ge)}}function Xo(){dr(),ge.hidden=!1}function Be(e,t){dr(),un&&(un.textContent=e||""),ln&&(ln.style.width=(t||0)+"%")}function dn(){dr(),ge.hidden=!0}function Yo(e=18){let t=K("#grid");if(t){_e=H("div","skeleton");for(let n=0;n<e;n++)_e.append(H("div","skel"));t.replaceChildren(_e)}}function fr(){_e&&_e.parentElement&&_e.parentElement.removeChild(_e),_e=null}var ge,ln,un,_e,Jo=M(()=>{cn()});function Zo(e,t,n=864e5){try{let r=Re+e,o={value:t,timestamp:Date.now(),ttl:n};localStorage.setItem(r,JSON.stringify(o)),Lc()}catch(r){if(r.name==="QuotaExceededError"){ti();try{let o=Re+e,i={value:t,timestamp:Date.now(),ttl:n};localStorage.setItem(o,JSON.stringify(i))}catch{}}}}function Qo(e){try{let t=Re+e,n=localStorage.getItem(t);if(!n)return null;let r=JSON.parse(n);if(typeof r.timestamp!="number"||typeof r.ttl!="number")return localStorage.removeItem(t),null;let o=Date.now();return r.timestamp+r.ttl<o?(localStorage.removeItem(t),null):r.value}catch{return null}}function ei(){try{Object.keys(localStorage).forEach(t=>{t.startsWith(Re)&&localStorage.removeItem(t)})}catch{}}function fn(){try{let e=Object.keys(localStorage),t=Date.now(),n=0;e.forEach(r=>{if(r.startsWith(Re))try{let o=JSON.parse(localStorage.getItem(r));o.timestamp+o.ttl<t&&(localStorage.removeItem(r),n++)}catch{localStorage.removeItem(r),n++}}),n>0}catch{}}function gr(){try{let t=Object.keys(localStorage).filter(s=>s.startsWith(Re)),n=Date.now(),r=0,o=0,i=0;return t.forEach(s=>{let a=localStorage.getItem(s);r+=a.length*2;try{let c=JSON.parse(a);c.timestamp+c.ttl>=n?o++:i++}catch{i++}}),{totalEntries:t.length,validEntries:o,expiredEntries:i,totalSize:r,totalSizeMB:(r/1024/1024).toFixed(2)}}catch{return null}}function Lc(){try{let e=gr();e&&e.totalSize>5242880&&ti(.3)}catch{}}function ti(e=.3){try{let t=Object.keys(localStorage),n=[];t.forEach(o=>{if(o.startsWith(Re))try{let i=JSON.parse(localStorage.getItem(o));n.push({key:o,timestamp:i.timestamp})}catch{n.push({key:o,timestamp:0})}}),n.sort((o,i)=>o.timestamp-i.timestamp);let r=Math.ceil(n.length*e);for(let o=0;o<r;o++)localStorage.removeItem(n[o].key)}catch{}}var Re,Nc,hr=M(()=>{Re="plex_cache_";Nc=null;typeof window!="undefined"&&typeof window.document!="undefined"&&window===globalThis&&(fn(),Nc=setInterval(fn,5*60*1e3))});function tt(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function Oc(e,t){switch(t){case"string":return typeof e=="string";case"number":return typeof e=="number"&&Number.isFinite(e);case"boolean":return typeof e=="boolean";case"array":return Array.isArray(e);case"object":return tt(e);default:return!1}}function mr(e,t,n="value"){if(!t)return;if(e==null){if(t.nullable)return;throw new Error(`${n} darf nicht null oder undefined sein.`)}let r=Array.isArray(t.type)?t.type:[t.type];if(r&&r.length&&!r.some(i=>Oc(e,i))){let i=r.join(" oder ");throw new Error(`${n} erwartet Typ ${i}, erhielt ${typeof e}.`)}if(r.includes("array")){if(!Array.isArray(e))throw new Error(`${n} erwartet eine Liste.`);t.items&&e.forEach((o,i)=>{n.includes(".genres")||n.includes("List")&&t.items.type&&Array.isArray(t.items.type)&&t.items.type.includes("string")&&t.items.type.includes("object")||mr(o,t.items,`${n}[${i}]`)});return}if(r.includes("object")){if(!tt(e))throw new Error(`${n} erwartet ein Objekt.`);let o=t.required||[];for(let s of o){let a=e[s];if(a==null||typeof a=="string"&&!a.trim())throw new Error(`${n}.${s} ist ein Pflichtfeld.`)}let i=t.properties||{};for(let[s,a]of Object.entries(i))e[s]!=null&&mr(e[s],a,`${n}.${s}`)}}function ni(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():t&&typeof t=="object"&&typeof t.tag=="string"?t.tag.trim():null).filter(t=>t&&t.length>0):[]}function ri(e,t){let n={...e};for(let[r,o]of Object.entries(t))n[r]==null?n[r]=Array.isArray(o)?[...o]:o:Array.isArray(o)&&(n[r]=Array.isArray(n[r])?[...n[r]]:[...o]);return n}function oi(e){if(!tt(e)||typeof e.title!="string"||!e.title.trim())return!1;let t=e.ratingKey;return typeof t=="string"||typeof t=="number"}function jc(e){return oi(e)?e.seasons==null?!0:Array.isArray(e.seasons)?e.seasons.every(t=>tt(t)):!1:!1}function Kc(e){let t=ri(e,Pc);t.title=t.title.trim(),t.ratingKey=String(e.ratingKey).trim();let n=typeof t.thumb=="string"?t.thumb:"",r=typeof t.thumbFile=="string"?t.thumbFile:"";return t.thumb=n,t.thumbFile=r||n,t.summary=typeof t.summary=="string"?t.summary:"",t.href=typeof t.href=="string"?t.href:"",t.tagline=typeof t.tagline=="string"?t.tagline:"",t.genres=ni(t.genres),t}function Uc(e){let t=ri(e,Bc);t.title=t.title.trim(),t.ratingKey=String(e.ratingKey).trim();let n=typeof t.thumb=="string"?t.thumb:"",r=typeof t.thumbFile=="string"?t.thumbFile:"";return t.thumb=n,t.thumbFile=r||n,t.summary=typeof t.summary=="string"?t.summary:"",t.href=typeof t.href=="string"?t.href:"",t.tagline=typeof t.tagline=="string"?t.tagline:"",t.genres=ni(t.genres),Array.isArray(e.seasons)?t.seasons=e.seasons.filter(tt).map(o=>{let i={...o};return i.episodes=Array.isArray(o.episodes)?o.episodes.filter(tt).map(s=>({...s})):[],typeof i.thumb!="string"&&(i.thumb=""),typeof i.thumbFile!="string"&&(i.thumbFile=""),i}):t.seasons=[],t}function pr(e,t="movie"){if(mr(e,t==="show"?zc:Dc,`${t}List`),!Array.isArray(e))throw new Error("Datensatz ist keine Liste.");let r=t==="show"?jc:oi,o=t==="show"?Uc:Kc;return e.map((i,s)=>{if(!r(i))throw new Error(`Ung\xFCltiger ${t}-Eintrag an Index ${s}.`);return o(i)})}var Pc,Bc,Rc,Hc,$c,Dc,zc,ii=M(()=>{Pc=Object.freeze({thumb:"",thumbFile:"",summary:"",href:"",tagline:"",genres:[]}),Bc=Object.freeze({thumb:"",thumbFile:"",summary:"",href:"",tagline:"",genres:[],seasons:[]}),Rc=Object.freeze({type:"object",required:["title","ratingKey"],properties:{title:{type:"string"},ratingKey:{type:["string","number"]},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0},summary:{type:"string",nullable:!0},href:{type:"string",nullable:!0},tagline:{type:"string",nullable:!0},genres:{type:"array",items:{type:["string","object"]},nullable:!0}}}),Hc=Object.freeze({type:"object",properties:{episodes:{type:"array",items:{type:"object"},nullable:!0},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0}}}),$c=Object.freeze({type:"object",required:["title","ratingKey"],properties:{title:{type:"string"},ratingKey:{type:["string","number"]},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0},summary:{type:"string",nullable:!0},href:{type:"string",nullable:!0},tagline:{type:"string",nullable:!0},genres:{type:"array",items:{type:["string","object"]},nullable:!0},seasons:{type:"array",items:Hc,nullable:!0}}}),Dc=Object.freeze({type:"array",items:Rc}),zc=Object.freeze({type:"array",items:$c})});var si={};et(si,{clearErrors:()=>qc,initErrorHandler:()=>Nt,showError:()=>Z,showRetryableError:()=>yr,withErrorHandling:()=>Gc});function Nt(){J||(J=document.createElement("div"),J.id="errorContainer",J.className="error-container",J.setAttribute("role","alert"),J.setAttribute("aria-live","polite"),document.body.appendChild(J)),window.addEventListener("unhandledrejection",e=>{var t;Z("Ein unerwarteter Fehler ist aufgetreten",(t=e.reason)==null?void 0:t.message),e.preventDefault()}),window.addEventListener("error",e=>{var t;Z("Ein Fehler ist aufgetreten",(t=e.error)==null?void 0:t.message)})}function Z(e,t="",n=5e3){J||Nt();let r=document.createElement("div");return r.className="error-toast",r.innerHTML=`
    <div class="error-toast-content">
      <div class="error-toast-icon">\u26A0\uFE0F</div>
      <div class="error-toast-text">
        <div class="error-toast-title">${br(e)}</div>
        ${t?`<div class="error-toast-message">${br(t)}</div>`:""}
      </div>
      <button class="error-toast-close" aria-label="Schlie\xDFen">\xD7</button>
    </div>
  `,r.querySelector(".error-toast-close").addEventListener("click",()=>{r.classList.add("error-toast-exit"),setTimeout(()=>r.remove(),300)}),J.appendChild(r),n>0&&setTimeout(()=>{r.parentNode&&(r.classList.add("error-toast-exit"),setTimeout(()=>r.remove(),300))},n),requestAnimationFrame(()=>{r.classList.add("error-toast-show")}),r}function Gc(e,t="Ein Fehler ist aufgetreten"){return async(...n)=>{try{return await e(...n)}catch(r){throw Z(t,r.message),r}}}function yr(e,t){J||Nt();let n=document.createElement("div");n.className="error-toast error-toast-retryable",n.innerHTML=`
    <div class="error-toast-content">
      <div class="error-toast-icon">\u26A0\uFE0F</div>
      <div class="error-toast-text">
        <div class="error-toast-title">${br(e)}</div>
      </div>
      <button class="error-toast-retry">Erneut versuchen</button>
      <button class="error-toast-close" aria-label="Schlie\xDFen">\xD7</button>
    </div>
  `;let r=n.querySelector(".error-toast-retry"),o=n.querySelector(".error-toast-close");return r.addEventListener("click",async()=>{n.remove();try{await t()}catch{}}),o.addEventListener("click",()=>{n.classList.add("error-toast-exit"),setTimeout(()=>n.remove(),300)}),J.appendChild(n),requestAnimationFrame(()=>{n.classList.add("error-toast-show")}),n}function qc(){J&&(J.innerHTML="")}function br(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}var J,gn=M(()=>{J=null});async function vr(e,t=2,n=!0){if(n){let s=Qo(e);if(s!==null)return s}let r=null;for(let s=0;s<=t;s++){try{let a=await fetch(e,{cache:"no-store"});if(a&&a.ok){let c=await a.json();return n&&c&&Zo(e,c,Wc),c}if(a&&a.status===404)return null;r=new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(a){r=a}if(s<t){let a=Math.min(1e3*Math.pow(2,s),5e3);await new Promise(c=>setTimeout(c,a))}}let o=(r==null?void 0:r.message)||"Unbekannter Fehler",i=new Error(`Daten konnten nicht geladen werden: ${e} (${o})`);throw r&&typeof r=="object"&&(i.cause=r),i}function Zc(e){try{let t=document.getElementById(e);if(t&&t.textContent)return JSON.parse(t.textContent)}catch{}return null}function Qc(e){try{let t=Vc;return(t&&Array.isArray(t[e])?t[e]:null)||null}catch{return null}}function el(e){try{return(Array.isArray(window[e])?window[e]:null)||null}catch{return null}}async function li(e,t){let n=null;try{n=await vr(e)}catch{n=null}if(Array.isArray(n)&&n.length)return nt(t==null?void 0:t.label,`primary:${e}`),n;if(t!=null&&t.embedId){let r=Zc(t.embedId);if(Array.isArray(r)&&r.length)return nt(t==null?void 0:t.label,`embedded:${t.embedId}`),r}if(t!=null&&t.exportKey){let r=Qc(t.exportKey);if(Array.isArray(r)&&r.length)return nt(t==null?void 0:t.label,`globalBag:${t.exportKey}`),r}if(t!=null&&t.globalVar){let r=el(t.globalVar);if(Array.isArray(r)&&r.length)return nt(t==null?void 0:t.label,`window:${t.globalVar}`),r}for(let r of(t==null?void 0:t.altUrls)||[]){let o=null;try{o=await vr(r)}catch{o=null}if(Array.isArray(o)&&o.length)return nt(t==null?void 0:t.label,`alt:${r}`),o}return nt(t==null?void 0:t.label,"empty"),Array.isArray(n)?n:[]}function Sr(e,t){typeof window=="undefined"||typeof document=="undefined"||typeof document.createElement!="function"||Promise.resolve().then(()=>(gn(),si)).then(n=>{var r;try{(r=n.showError)==null||r.call(n,e,t,8e3)}catch{}}).catch(n=>{})}function tl(e,t){let n=e==null?"":String(e).trim();if(!n)return"";if(n.startsWith("//")||n.startsWith("/")||Jc.test(n))return n;let r=n.replace(/\\/g,"/"),o=t?t.endsWith("/")?t:`${t}/`:"",i=!1,s=g=>g.split("/").map(p=>{if(!p)return"";try{return encodeURIComponent(decodeURIComponent(p))}catch{return i||(i=!0),encodeURIComponent(p)}}).join("/"),c=r.replace(/^\/+/,"").split("/"),l=[];for(let g of c)if(!(!g||g===".")){if(g===".."){l.length&&l.pop();continue}l.push(g)}let u=l.join("/");if(u.startsWith("data/"))return s(u);let d=l;if(o&&d.length){let g=o.replace(/\/+$/,"").split("/").pop();g&&d[0]===g&&(d=d.slice(1))}let h=d.join("/"),f=s(h);return`${o}${f}`}function ui(e,t){var o,i;if(!e||typeof e!="object")return e;let n=(i=(o=e.thumbFile)!=null?o:e.thumb)!=null?i:"",r=tl(n,t);if(r)e.thumbFile=r,e.thumb=r;else if(n){let s=String(n);e.thumbFile=s,e.thumb==null&&(e.thumb=s)}return e}function nl(e){return ui(e,Xc)}function ae(e){return ui(e,Yc)}function di(e){return!e||typeof e!="object"||(ae(e),Array.isArray(e.seasons)&&e.seasons.forEach(fi)),e}function fi(e){return!e||typeof e!="object"||(ae(e),Array.isArray(e.episodes)&&e.episodes.forEach(t=>ae(t))),e}function rl(e){return Array.isArray(e)?(e.forEach(t=>{t&&typeof t=="object"&&nl(t)}),e):[]}function ol(e){return Array.isArray(e)?(e.forEach(t=>{t&&typeof t=="object"&&di(t)}),e):[]}async function gi(){try{let e=await li("data/movies/movies.json",{label:"movies",embedId:"movies-json",exportKey:"movies",globalVar:"__PLEX_MOVIES__",altUrls:["movies/movies.json","data/movies.json","Filme/movies.json","movies.json"]}),t;try{t=pr(e,"movie")}catch(n){let r=(n==null?void 0:n.message)||"Unbekannte Validierungsfehler",o=new Error(`Ung\xFCltige Filmdaten: ${r}`);throw n instanceof Error&&(o.cause=n),o}return rl(t)}catch(e){return Sr("Filme konnten nicht geladen werden",(e==null?void 0:e.message)||"Unbekannter Fehler"),[]}}async function hi(){try{let e=await li("data/series/series_index.json",{label:"shows",embedId:"series-json",exportKey:"shows",globalVar:"__PLEX_SHOWS__",altUrls:["series/series_index.json","data/shows.json","data/series.json","Serien/series.json","series/series.json","series.json","shows.json"]}),t;try{t=pr(e,"show")}catch(n){let r=(n==null?void 0:n.message)||"Unbekannte Validierungsfehler",o=new Error(`Ung\xFCltige Seriendaten: ${r}`);throw n instanceof Error&&(o.cause=n),o}return ol(t)}catch(e){return Sr("Serien konnten nicht geladen werden",(e==null?void 0:e.message)||"Unbekannter Fehler"),[]}}async function mi(e){if(!e)return null;let t=il(e),n=sl(t);if(n!==void 0)return n;let r=al(e),o=null;for(let i of r)try{let s=await vr(i);if(s&&typeof s=="object"){let a=cl(s);return ai(t,a,e),bi(a)}}catch(s){o=s}return o&&Sr("Details konnten nicht geladen werden",(o==null?void 0:o.message)||"Bitte sp\xE4ter erneut versuchen."),ai(t,null,e),null}function nt(e,t){if(e)try{ci[e]=t}catch{}}function pi(){return{...ci}}function il(e){let t=[];(e==null?void 0:e.ratingKey)!==void 0&&(e==null?void 0:e.ratingKey)!==null&&(e==null?void 0:e.ratingKey)!==""&&t.push(`rk:${String(e.ratingKey)}`);let n=mn(e==null?void 0:e.href);return n&&t.push(`href:${n}`),t}function mn(e){return e?String(e).trim().replace(/^\.\//,"").replace(/^\/+/,""):""}function sl(e){for(let t of e)if(He.has(t)){let n=He.get(t);return n?bi(n):null}}function ai(e,t,n){let r=t;e.forEach(c=>{He.set(c,r)});let o=n==null?void 0:n.ratingKey;o!=null&&He.set(`rk:${String(o)}`,r);let i=t&&typeof t=="object"?t.ratingKey:void 0;i!=null&&He.set(`rk:${String(i)}`,r);let s=mn(n==null?void 0:n.href);s&&He.set(`href:${s}`,r);let a=t&&typeof t=="object"?mn(t.href):"";a&&He.set(`href:${a}`,r)}function al(e){let t=new Set,n=mn(e==null?void 0:e.href);if(n)if(/^https?:/i.test(n))t.add(n);else{n.startsWith("data/")?t.add(n):t.add(`data/${n}`);let o=n.replace(/^data\//,"");o.startsWith("series/")||t.add(`data/series/${o}`);let i=o.replace(/^series\//,"").replace(/^details\//,"").replace(/\.json$/,"");i&&t.add(`data/series/details/${i}.json`)}let r=e==null?void 0:e.ratingKey;return r!=null&&t.add(`data/series/details/${String(r)}.json`),Array.from(t)}function cl(e){if(!e||typeof e!="object")return null;let t={...e};ae(t),t.genres=Er(t.genres);let n=dl(t.cast||t.roles||[]);return t.cast=n,t.roles=n,t.seasons=Array.isArray(t.seasons)?t.seasons.map(ll).filter(Boolean):[],t.seasonCount=Number.isFinite(t.seasonCount)?t.seasonCount:t.seasons.length,di(t),t}function ll(e){if(!e||typeof e!="object")return null;let t={...e};return ae(t),t.genres=Er(t.genres),t.episodes=Array.isArray(t.episodes)?t.episodes.map(ul).filter(Boolean):[],fi(t),t}function ul(e){if(!e||typeof e!="object")return null;let t={...e};return ae(t),t.genres=Er(t.genres),t}function Er(e){if(!Array.isArray(e))return[];let t=new Set,n=[];return e.forEach(r=>{let o=null;if(typeof r=="string"){let i=r.trim();i&&(o={tag:i})}else if(r&&typeof r=="object"){let i=String(r.tag||r.title||r.name||r.label||"").trim();i&&(o={...r,tag:i})}o&&!t.has(o.tag)&&(t.add(o.tag),n.push(o))}),n}function dl(e){return Array.isArray(e)?e.map(t=>{if(!t)return null;if(typeof t=="string"){let n=t.trim();return n?{tag:n}:null}if(typeof t=="object"){let n=String(t.tag||t.name||t.role||"").trim();return n?{...t,tag:n}:{...t}}return null}).filter(Boolean):[]}function bi(e){if(e==null)return e;try{return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}return e}var ci,He,Wc,hn,Vc,Xc,Yc,Jc,rt=M(()=>{hr();ii();ci={movies:null,shows:null},He=new Map,Wc=1e3*60*30,hn="__PLEX_EXPORTER__",Vc=(()=>{try{if(typeof globalThis!="undefined"){if(globalThis[hn])return globalThis[hn];if(globalThis.window&&globalThis.window[hn])return globalThis.window[hn]}}catch{}return null})(),Xc="data/movies/",Yc="data/series/",Jc=/^[a-z][a-z0-9+.-]*:/i});var vi={};et(vi,{clearHeroCache:()=>hl,collectionTags:()=>$e,enableMoreChipBehavior:()=>yi,formatRating:()=>q,getGenreNames:()=>be,humanYear:()=>U,isNew:()=>De,renderChipsLimited:()=>bn,useTmdbForCards:()=>yn,useTmdbForHero:()=>Pt,useTmdbOn:()=>ze});function be(e){let t=new Set,n=[];return(e||[]).forEach(r=>{let o="";typeof r=="string"?o=r:r&&typeof r=="object"&&(o=r.tag||r.title||r.name||"");let i=String(o||"").trim();i&&!t.has(i)&&(t.add(i),n.push(i))}),n}function bn(e,t,n=3){if(!e)return;let r=(t||[]).filter(Boolean);if(r.length>n){let o=r.slice(0,n),i=r.slice(n),s=o.map(c=>pn(c)),a=pn(`+ ${i.length}`);a.classList.add("more","card__chip--more"),a.setAttribute("data-more",i.length),a.setAttribute("title",`${i.length} weitere Genres: ${i.join(", ")}`),a._extraChips=i.map(c=>pn(c)),s.push(a),e.replaceChildren(...s)}else{let o=r.map(i=>pn(i));e.replaceChildren(...o)}yi(e)}function yi(e=document){try{e.querySelectorAll(".chip.more, .card__chip--more").forEach(t=>{t.dataset.bound||(t.dataset.bound="1",t.addEventListener("click",n=>{n.stopPropagation();let r=t.closest(".card");if(r)r.click();else{let o=t._extraChips||[];try{o.forEach(i=>t.before(i))}catch{}t.remove()}}))})}catch{}}function $e(e){return(e&&e.collections||[]).map(t=>t&&(t.tag||t.title||t.name||"")).filter(Boolean)}function U(e){if(!e)return"";let t=[e.originallyAvailableAt,e.year,e.releaseDate,e.premiereDate];for(let n of t){if(n==null)continue;let r=String(n);if(!r)continue;let o=r.match(/\d{4}/);if(o)return o[0]}return""}function q(e){if(e instanceof Number)return q(e.valueOf());if(typeof e=="number")return Number.isFinite(e)?e.toFixed(1):"0.0";if(typeof e=="string"){let t=e.trim();if(!t)return"0.0";let n=Number(t);return Number.isFinite(n)?n.toFixed(1):"0.0"}return"0.0"}function pn(e){let t=document.createElement("span");return t.className="chip",t.textContent=String(e||""),t}function De(e){if(!(e!=null&&e.addedAt))return!1;let t=new Date(e.addedAt).getTime();if(!Number.isFinite(t))return!1;let n=I().cfg||{},r=Number(n.newDays||30);return Date.now()-t<=r*24*60*60*1e3}function gl(){var e,t;try{let n=localStorage.getItem("tmdbToken");if(n&&n.trim())return!0;let r=I();return!!((e=r.cfg)!=null&&e.tmdbToken||(t=r.cfg)!=null&&t.tmdbApiKey)}catch{return!1}}function yn(){try{return localStorage.getItem("useTmdb")==="1"}catch{return!1}}function Pt(){return gl()}function ze(){return yn()}function hl(){try{let e={tmdbToken:localStorage.getItem("tmdbToken"),useTmdb:localStorage.getItem("useTmdb"),prefReduceMotion:localStorage.getItem("prefReduceMotion"),watchlist:localStorage.getItem("watchlist:v1"),modalLayout:localStorage.getItem("modalLayout"),scrollOrchestratorEnabled:localStorage.getItem("scrollOrchestratorEnabled")},t=Object.keys(localStorage).filter(r=>r.startsWith("hero")||r.startsWith("Hero")),n=Object.keys(localStorage).filter(r=>r.includes("tmdbCache")||r==="hero.tmdbCache.v1");return t.forEach(r=>localStorage.removeItem(r)),n.forEach(r=>localStorage.removeItem(r)),Object.entries(e).forEach(([r,o])=>{o!==null&&localStorage.setItem(r,o)}),{heroEntries:t.length,tmdbCacheEntries:n.length,preserved:Object.keys(e).filter(r=>e[r]!==null)}}catch(e){return{error:e.message}}}var ye=M(()=>{Y()});function ml(){try{he=new Set(JSON.parse(localStorage.getItem(Ai)||"[]"))}catch{he=new Set}}function wi(){try{localStorage.setItem(Ai,JSON.stringify(Array.from(he.values())))}catch{}}function wr(e){var r,o;if(!e)return"";let t=e.type==="tv"||e.libraryType==="show"?"show":"movie",n=((r=e.ids)==null?void 0:r.imdb)||((o=e.ids)==null?void 0:o.tmdb)||String(e.ratingKey||"");return n?`${t}:${n}`:""}function kr(e){return he.has(wr(e))}function pl(){return he.size}function Tr(e){let t=wr(e);if(!t)return;he.has(t)?he.delete(t):he.add(t),wi(),Cr();let n=document.getElementById("watchlistPanel");n&&!n.hidden&&vn()}function Cr(){let e=document.getElementById("watchlistCount");e&&(e.textContent=String(pl()))}function Si(){let e=document.getElementById("watchlistPanel");e&&(e.hidden=!1,e.setAttribute("aria-hidden","false"),vn())}function Ei(){let e=document.getElementById("watchlistPanel");e&&(e.hidden=!0,e.setAttribute("aria-hidden","true")),Ar(!1)}function bl(){he.clear(),wi(),Cr(),vn()}function yl(){let e=ki(),t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="watchlist.json",document.body.append(r),r.click(),r.remove(),setTimeout(()=>URL.revokeObjectURL(r.href),1e3)}function ki(){let e=I(),t=(e.movies||[]).concat(e.shows||[]),n=new Map(t.map(r=>[wr(r),r]));return Array.from(he.values()).map(r=>n.get(r)).filter(Boolean)}function vn(){let e=document.getElementById("watchlistItems"),t=document.getElementById("watchlistEmpty");if(!e||!t)return;let n=ki();if(n.length===0){e.replaceChildren(),t.hidden=!1;return}t.hidden=!0;let r=document.createDocumentFragment();n.forEach(o=>{let i=document.createElement("li");i.className="watchlist-item";let s=document.createElement("span");s.className="title",s.textContent=o.title||"";let a=document.createElement("button");a.textContent="Entfernen",a.addEventListener("click",()=>{Tr(o),vn()});let c=document.createElement("button");c.textContent="\xD6ffnen",c.addEventListener("click",()=>{var d,h;let l=o.type==="tv"?"show":"movie",u=((d=o.ids)==null?void 0:d.imdb)||((h=o.ids)==null?void 0:h.tmdb)||String(o.ratingKey||"");u&&(location.hash=`#/${l}/${u}`)}),i.append(s,c,a),r.append(i)}),e.replaceChildren(r)}function Ti(){ml(),Cr();let e=document.getElementById("openWatchlist"),t=document.getElementById("watchlistToggle"),n=document.getElementById("closeWatchlist"),r=document.getElementById("clearWatchlist"),o=document.getElementById("exportWatchlist");e&&e.addEventListener("click",()=>{Si(),Ar(!0)}),t&&t.addEventListener("click",()=>{let i=document.getElementById("watchlistPanel");i&&!i.hidden?Ei():(Si(),Ar(!0))}),n&&n.addEventListener("click",()=>{Ei()}),r&&r.addEventListener("click",()=>{bl()}),o&&o.addEventListener("click",()=>{yl()})}function Ar(e){let t=document.getElementById("watchlistToggle");t&&t.setAttribute("aria-expanded",e?"true":"false")}var Ai,he,_r=M(()=>{Y();Ai="watchlist:v1",he=new Set});function _i(e){let t=e.querySelector(".v2-tabs");if(!t)return;let n=Array.from(t.querySelectorAll("button[data-t]")),r=s=>{n.forEach(a=>{let c=a.dataset.t===s;a.classList.toggle("active",c),a.setAttribute("aria-selected",c?"true":"false"),a.tabIndex=c?0:-1;let l=e.querySelector(`.v2-pane[data-pane="${a.dataset.t}"]`);l&&(l.hidden=!c,l.setAttribute("aria-hidden",l.hidden?"true":"false"))})},o=(s,a)=>{if(!n.length)return;let c=n.indexOf(s),l=a>0?0:n.length-1,u=c===-1?l:(c+a+n.length)%n.length,d=n[u];d&&(d.focus(),r(d.dataset.t))};t.addEventListener("click",s=>{let a=s.target.closest("button[data-t]");a&&(s.preventDefault(),r(a.dataset.t))}),t.addEventListener("keydown",s=>{let a=s.target.closest("button[data-t]");if(a)switch(s.key){case"ArrowLeft":case"ArrowUp":s.preventDefault(),o(a,-1);break;case"ArrowRight":case"ArrowDown":s.preventDefault(),o(a,1);break;case"Home":s.preventDefault(),n[0]&&(n[0].focus(),r(n[0].dataset.t));break;case"End":if(s.preventDefault(),n.length){let c=n[n.length-1];c.focus(),r(c.dataset.t)}break;default:break}});let i=n.find(s=>s.classList.contains("active"))||n[0];i&&r(i.dataset.t)}var Ii=M(()=>{});function vl(e){var r,o;let t=((r=e==null?void 0:e.tmdbDetail)==null?void 0:r.poster)||((o=e==null?void 0:e.tmdb)==null?void 0:o.poster)||(e==null?void 0:e.tmdbPoster),n=(e==null?void 0:e.poster)||(e==null?void 0:e.thumbFile)||(e==null?void 0:e.art)||"";return ze()&&t?t:n}function xr(e){var r;let t=[e==null?void 0:e.runtimeMin,e==null?void 0:e.durationMin,(r=e==null?void 0:e.tmdbDetail)==null?void 0:r.runtime,e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null],n=null;for(let o of t){let i=Number(o);if(Number.isFinite(i)&&i>0){n=i;break}}return n===null?"":(e==null?void 0:e.type)==="tv"?`~${n} min/Ep`:`${n} min`}function Sl(e){var n;let t=Number((n=e==null?void 0:e.rating)!=null?n:e==null?void 0:e.audienceRating);return Number.isFinite(t)?`\u2605 ${q(t)}`:""}function Fr(e){var t,n;if(e!=null&&e.studio)return e.studio;if(e!=null&&e.network)return e.network;if(e!=null&&e.studioName)return e.studioName;if((t=e==null?void 0:e.tmdbDetail)!=null&&t.productionCompanies){let r=e.tmdbDetail.productionCompanies.find(o=>o==null?void 0:o.name);if(r&&r.name)return r.name}if((n=e==null?void 0:e.tmdbDetail)!=null&&n.networks){let r=e.tmdbDetail.networks.find(o=>o==null?void 0:o.name);if(r&&r.name)return r.name}return""}function El(e){var s;let t=[];De(e)&&t.push("Neu"),(e==null?void 0:e.type)==="tv"&&Number.isFinite(Number(e==null?void 0:e.seasonCount))&&t.push(`Staffeln: ${e.seasonCount}`);let n=(e==null?void 0:e.genres)||[],r=Array.isArray((s=e==null?void 0:e.tmdbDetail)==null?void 0:s.genres)?e.tmdbDetail.genres:[],o=[...n,...r].map(a=>a?typeof a=="string"?a:a.tag||a.title||a.name||"":"").filter(Boolean),i=new Set;return o.forEach(a=>{i.has(a.toLowerCase())||(i.add(a.toLowerCase()),t.push(a))}),t}function Al(e){var n;let t=(((n=e==null?void 0:e.tmdbDetail)==null?void 0:n.tagline)||"").trim();return t||((e==null?void 0:e.tagline)||"").trim()}function wl(e){var n;let t=(((n=e==null?void 0:e.tmdbDetail)==null?void 0:n.contentRating)||"").trim();return t||((e==null?void 0:e.contentRating)||"").trim()}function kl(e){var t,n;return(t=e==null?void 0:e.tmdbDetail)!=null&&t.backdrop?e.tmdbDetail.backdrop:(n=e==null?void 0:e.tmdb)!=null&&n.backdrop?e.tmdb.backdrop:(e==null?void 0:e.art)||(e==null?void 0:e.background)||""}function Ir(e){return e?typeof e=="string"?e:e.url||e.file_path||e.filePath||e.path||e.logo||"":""}function Tl(e){if(!e||typeof e!="object")return"";let t=e.iso6391||e.iso_639_1||e.language||"";return typeof t=="string"?t.toLowerCase():""}function Cl(e){var o;let t=e==null?void 0:e.tmdbDetail,n=Array.isArray((o=t==null?void 0:t.images)==null?void 0:o.logos)?t.images.logos:[];if(!n.length)return"";let r=["de","en",""];for(let i of r){let s=n.find(l=>{let u=Tl(l);return i?u===i:!u}),a=Ir(s),c=ot(a);if(c)return c}for(let i of n){let s=ot(Ir(i));if(s)return s}return""}function _l(e,t=""){var a;let n=new Set,r=ot(t);r&&n.add(r);let o=[],i=e==null?void 0:e.tmdbDetail,s=c=>{let l=ot(Ir(c));!l||n.has(l)||(n.add(l),o.push(l))};return(a=i==null?void 0:i.images)!=null&&a.logos&&i.images.logos.forEach(s),i!=null&&i.networks&&i.networks.forEach(s),i!=null&&i.productionCompanies&&i.productionCompanies.forEach(s),o[0]||""}function ot(e){if(!e)return"";let t=String(e).trim();return t?/^https?:\/\//i.test(t)||/^data:image\//i.test(t)?t:t.replace(/["'()]/g,""):""}function Il(e,t){let n=e.querySelector("[data-head-backdrop]");if(!n)return;let r=kl(t),o=ot(r),i=()=>{n.style.backgroundImage="",n.dataset.state="",n.dataset.src=""};if(!o){i();return}if(typeof Image=="undefined"){n.dataset.src=o,n.dataset.state="ready",n.style.backgroundImage=`url("${o}")`;return}n.dataset.state="loading",n.style.backgroundImage="",n.dataset.src=o;let s=new Image;s.decoding="async",s.referrerPolicy="no-referrer";let a=()=>{n.dataset.src===o&&(n.style.backgroundImage=`url("${o}")`,n.dataset.state="ready")},c=()=>{n.dataset.src===o&&i()};s.addEventListener("load",a,{once:!0}),s.addEventListener("error",c,{once:!0}),s.src=o}function Li(e,t,n=""){let r=e.querySelector("[data-head-logo]");if(!r)return;let o=_l(t,n);if(o){let i=r.querySelector("img");i||(i=document.createElement("img"),i.alt=(t==null?void 0:t.title)||(t==null?void 0:t.name)||"Logo",i.decoding="async",i.loading="lazy",i.referrerPolicy="no-referrer",r.replaceChildren(i)),i.src=o,i.alt=t!=null&&t.title?`Logo: ${t.title}`:i.alt,r.hidden=!1}else r.hidden=!0,r.replaceChildren()}function xl(e,t){let n=e.querySelector("[data-head-overlay-logo]");if(!n)return"";let r=Cl(t);if(n.dataset.src="",!r)return n.hidden=!0,n.dataset.state="",n.replaceChildren(),"";let o=document.createElement("img");if(o.alt=t!=null&&t.title?`Hero Logo: ${t.title}`:"Hero Logo",o.decoding="async",o.loading="lazy",o.referrerPolicy="no-referrer",n.replaceChildren(o),n.dataset.src=r,typeof Image=="undefined")return o.src=r,n.hidden=!1,n.dataset.state="ready",r;n.hidden=!0,n.dataset.state="loading";let i=()=>{n.dataset.src===r&&(n.hidden=!1,n.dataset.state="ready")},s=()=>{n.dataset.src===r&&(n.hidden=!0,n.dataset.state="",n.dataset.src="",n.replaceChildren(),Li(e,t,""))};return o.addEventListener("load",i,{once:!0}),o.addEventListener("error",s,{once:!0}),o.src=r,r}function xi(e){return Number.isFinite(e)?e>=7.5?"high":e>=5.5?"medium":e>0?"low":"":""}function Fl(e){var o,i,s;let t=(e==null?void 0:e.tmdbDetail)||{},n=Number((o=t.voteAverage)!=null?o:t.vote_average);if(Number.isFinite(n)&&n>0)return{label:"TMDB",value:n,text:q(n),bucket:xi(n)};let r=Number((s=(i=e==null?void 0:e.rating)!=null?i:e==null?void 0:e.audienceRating)!=null?s:e==null?void 0:e.userRating);return Number.isFinite(r)&&r>0?{label:"Bewertung",value:r,text:q(r),bucket:xi(r)}:null}function Ml(e,t){let n=e.querySelector("[data-head-overlay-meta]");if(!n)return;n.replaceChildren();let r=Fl(t);if(!r){n.hidden=!0;return}let o=document.createElement("span");o.className="v2-chip--rating",r.bucket&&(o.dataset.score=r.bucket);let i=document.createElement("span");i.textContent=r.label;let s=document.createElement("strong");s.textContent=r.text,o.append(i,s),o.setAttribute("aria-label",`${r.label} Bewertung ${r.text} von 10`),n.appendChild(o),n.hidden=!1}function Mr(e,t){let n=e.querySelector(".v2-title");n&&(n.textContent=(t==null?void 0:t.title)||(t==null?void 0:t.name)||"");let r=Al(t),o=e.querySelector(".v2-meta"),i=e.querySelector(".v2-subline"),s=U(t),a=xr(t),c=Sl(t),l=Fr(t),u=[s,a,c,l].filter(Boolean);if(i){let m=u.join(" \u2022 ");i.textContent=r||m,i.hidden=!(r||m)}o&&(o.textContent=r&&u.length?u.join(" \u2022 "):"",o.hidden=!(r&&u.length));let d=e.querySelector(".v2-chips");d&&(d.replaceChildren(),El(t).forEach(m=>{let b=document.createElement("span");b.className="chip",b.textContent=m,d.appendChild(b)}),d.hidden=!d.childElementCount);let h=e.querySelector(".v2-facts"),f=e.querySelector(".v2-facts-list");if(h&&f){let m=[];s&&m.push(["Jahr",s]);let b=wl(t);b&&m.push(["Freigabe",b]),a&&m.push(["Laufzeit",a]),c&&m.push(["Bewertung",c]),l&&m.push(["Studio",l]),f.replaceChildren(),m.forEach(([S,k])=>{let L=document.createElement("dt");L.textContent=S;let C=document.createElement("dd");C.textContent=k,f.append(L,C)}),h.hidden=!m.length}let g=e.querySelector(".v2-poster img");if(g){let m=vl(t);g.src=m||"",g.alt=t!=null&&t.title?`Poster: ${t.title}`:"",g.loading="lazy",g.decoding="async",g.classList.remove("is-ready"),m?(g.addEventListener("load",Fi,{once:!0}),g.addEventListener("error",Fi,{once:!0})):g.classList.add("is-ready")}Il(e,t);let p=xl(e,t);Ml(e,t),Li(e,t,p),Rl(e,t)}function Fi(e){var t;(t=e.currentTarget)==null||t.classList.add("is-ready")}function Ll(e=""){let t=String(e||"").trim();return t&&t.split(/\s+/).map(r=>r[0]).filter(Boolean).join("").slice(0,3).toUpperCase()||"TMDB"}function Nl(e=""){let t=Ll(e),n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"svg");r.setAttribute("viewBox","0 0 160 60"),r.setAttribute("aria-hidden","true"),r.setAttribute("focusable","false");let o=document.createElementNS(n,"rect");o.setAttribute("x","2"),o.setAttribute("y","2"),o.setAttribute("width","156"),o.setAttribute("height","56"),o.setAttribute("rx","14"),o.setAttribute("fill","#15243b"),o.setAttribute("stroke","rgba(87, 116, 164, 0.6)"),o.setAttribute("stroke-width","2");let i=document.createElementNS(n,"text");return i.setAttribute("x","80"),i.setAttribute("y","38"),i.setAttribute("fill","#b8c7e6"),i.setAttribute("font-size","28"),i.setAttribute("font-weight","600"),i.setAttribute("text-anchor","middle"),i.setAttribute("font-family",'Inter, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'),i.textContent=t,r.append(o,i),r}function Pl(e){let t=Mi[e.type]||{label:"TMDB"},n=e.name?`${e.name} (${t.label})`:t.label,r=document.createElement("a");r.className="v2-footer-logo",r.href=e.link||Sn,r.target="_blank",r.rel="noopener noreferrer",r.title=e.name?`${e.name} \u2013 TMDB`:"TMDB";let o=e.hasSpecificLink?" \u2013 \xF6ffnet externes TMDB-Profil":" \u2013 \xF6ffnet externe TMDB-Seite";if(r.setAttribute("aria-label",`${n}${o}`),e.logo){let i=document.createElement("img");i.src=e.logo,i.alt=e.name?`${e.name} Logo`:"TMDB Logo",i.loading="lazy",i.decoding="async",i.referrerPolicy="no-referrer",r.appendChild(i)}else r.appendChild(Nl(e.name||t.label));return r}function Bl(e){var a,c,l;let t=e==null?void 0:e.tmdbDetail;if(!t)return[];let n=[],r=new Set,o=(u,d)=>{var F,X,ie;if(!u)return;let h=Mi[d];if(!h)return;let f=(ie=(X=(F=u.id)!=null?F:u.tmdbId)!=null?X:u.tmdb_id)!=null?ie:"",g=f==null?"":String(f).trim(),p=String(u.name||u.title||"").trim(),m=[u.logo,u.logoPath,u.poster,u.backdrop],b="";for(let de of m){let fe=ot(de);if(fe){b=fe;break}}if(!b&&!p)return;let S=[d];g?S.push(g):p?S.push(p.toLowerCase()):b&&S.push(b);let k=S.join(":");if(r.has(k))return;r.add(k);let L=h.path,C=g?`${Sn}/${L}/${encodeURIComponent(g)}`:Sn;n.push({type:d,name:p,logo:b,link:C,hasSpecificLink:!!g})};if((Array.isArray(t==null?void 0:t.networks)?t.networks:[]).forEach(u=>o(u,"network")),(Array.isArray(t==null?void 0:t.productionCompanies)?t.productionCompanies:[]).forEach(u=>o(u,"company")),t!=null&&t.collection){let u={...t.collection,logo:(a=t.collection)==null?void 0:a.logo,poster:(c=t.collection)==null?void 0:c.poster,backdrop:(l=t.collection)==null?void 0:l.backdrop};o(u,"collection")}return n}function Rl(e,t){let n=e.querySelector(".v2-footer");if(!n)return;let r=n.querySelector(".v2-footer-logos"),o=n.querySelector(".v2-footer-note");if(!r||!o){n.hidden=!0;return}r.replaceChildren(),o.replaceChildren();let i=Bl(t);if(!i.length){n.hidden=!0;return}let s=document.createDocumentFragment();i.forEach(l=>s.appendChild(Pl(l))),r.appendChild(s);let a=document.createElement("a");a.href=Sn,a.target="_blank",a.rel="noopener noreferrer",a.textContent="TMDB",a.setAttribute("aria-label","The Movie Database (TMDB) \u2013 externe Seite");let c=document.createElement("strong");c.appendChild(a),o.append("Logos & Daten bereitgestellt von ",c,". Dieses Produkt nutzt die TMDB API, ist jedoch nicht von TMDB zertifiziert oder unterst\xFCtzt."),n.hidden=!1}var Sn,Mi,Lr=M(()=>{ye();Sn="https://www.themoviedb.org",Mi={network:{path:"network",label:"Netzwerk"},company:{path:"company",label:"Produktionsfirma"},collection:{path:"collection",label:"Sammlung"}}});function Nr(e,t){var m,b;let n=e.querySelector(".v2-overview");if(!n)return;let r=(((m=t==null?void 0:t.tmdbDetail)==null?void 0:m.overview)||"").trim(),o=((t==null?void 0:t.summary)||(t==null?void 0:t.overview)||"").trim(),i=r||o;if(!i){n.textContent="";return}let s=n.querySelector(".v2-overview-text"),a=(s==null?void 0:s.classList.contains("is-expanded"))||((b=n.querySelector(".v2-overview-toggle"))==null?void 0:b.getAttribute("aria-expanded"))==="true",c=document.createElement("p");c.className="v2-overview-text line-clamp line-clamp-5",c.textContent=i;let l=document.createElement("button");l.type="button",l.className="v2-overview-toggle";let u=S=>{c.classList.toggle("is-expanded",S),l.setAttribute("aria-expanded",String(S)),l.textContent=S?"Weniger anzeigen":"Mehr anzeigen"};l.addEventListener("click",()=>{let S=l.getAttribute("aria-expanded")==="true";u(!S)});let d=Hl(t,r?"tmdb":"local"),h=null;d&&(h=document.createElement("span"),h.className="v2-lang-badge",h.textContent=d);let f=[];h&&f.push(h),f.push(c,l),n.replaceChildren(...f),u(!!a),(typeof requestAnimationFrame=="function"?requestAnimationFrame:S=>setTimeout(S,0))(()=>{c.scrollHeight>c.clientHeight+1?l.hidden=!1:(c.classList.add("is-expanded"),l.hidden=!0)})}function Hl(e,t){var s,a,c,l,u,d;if(t!=="tmdb")return"";let n=String(((l=(c=(a=(s=e==null?void 0:e.tmdbDetail)==null?void 0:s.raw)==null?void 0:a.spoken_languages)==null?void 0:c[0])==null?void 0:l.iso_639_1)||"").toLowerCase(),r=String(((d=(u=e==null?void 0:e.tmdbDetail)==null?void 0:u.raw)==null?void 0:d.original_language)||"").toLowerCase(),o=String($l()).toLowerCase();return(r||n)==="en"&&o&&!o.startsWith("en")?"EN":""}function $l(){var t;let e=I();return(t=e==null?void 0:e.cfg)!=null&&t.lang?e.cfg.lang:"de-DE"}var Ni=M(()=>{Y()});function Dl(e){let t=e==null?void 0:e.tmdbDetail,n=[t==null?void 0:t.releaseDate,t==null?void 0:t.firstAirDate,t==null?void 0:t.lastAirDate,e==null?void 0:e.originallyAvailableAt,e==null?void 0:e.releaseDate,e==null?void 0:e.premiereDate,e==null?void 0:e.firstAired,e==null?void 0:e.airDate];for(let o of n){let i=o==null?"":String(o).trim();if(!i)continue;let s=new Date(i);if(Number.isFinite(s.getTime()))try{return s.toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{}let a=i.match(/^\d{4}-\d{2}-\d{2}/);if(a&&a[0])return a[0];if(i.length>=4)return i.slice(0,10)}let r=U(e);return r?String(r):""}function Oe(e){return Array.isArray(e)?e.map(t=>t?typeof t=="string"?t:t.tag||t.title||t.name||"":"").filter(Boolean):[]}function zl(e){var o;let t=Array.isArray(e==null?void 0:e.genres)?e.genres:[],n=Array.isArray((o=e==null?void 0:e.tmdbDetail)==null?void 0:o.genres)?e.tmdbDetail.genres:[],r=[...t,...n].map(i=>i?typeof i=="string"?i:i.tag||i.title||i.name||"":"").filter(Boolean);return Array.from(new Set(r))}function Pr(e,t){if(!(e!=null&&e.credits)||!Array.isArray(e.credits.crew))return[];let n=Array.isArray(t)?new Set(t):new Set([t]),r=e.credits.crew.filter(o=>o&&n.has(o.job)).map(o=>o.name||o.originalName||o.tag).filter(Boolean);return Array.from(new Set(r))}function it(e,t){let n=new Set,r=[];return[...e,...t].forEach(o=>{let i=String(o||"").trim();!i||n.has(i.toLowerCase())||(n.add(i.toLowerCase()),r.push(i))}),r}function Ol(e){var n;let t=(((n=e==null?void 0:e.tmdbDetail)==null?void 0:n.contentRating)||"").trim();return t||((e==null?void 0:e.contentRating)||"").trim()}function jl(e){let t=[],n=e==null?void 0:e.tmdbDetail;return n!=null&&n.voteAverage&&t.push(["TMDB",`\u2605 ${Bt(n.voteAverage)}`]),e!=null&&e.rating&&t.push(["Bewertung",`\u2605 ${Bt(e.rating)}`]),e!=null&&e.audienceRating&&t.push(["Publikum",`\u2605 ${Bt(e.audienceRating)}`]),e!=null&&e.userRating&&t.push(["Eigene Wertung",`\u2605 ${Bt(e.userRating)}`]),t}function Kl(e){var s,a,c,l,u;let t=e==null?void 0:e.tmdbDetail;if(!(t!=null&&t.watchProviders))return[];let n=(((s=I().cfg)==null?void 0:s.iso)||((a=I().cfg)==null?void 0:a.region)||"DE").toUpperCase(),r=((c=t.watchProviders)==null?void 0:c[n])||((l=t.watchProviders)==null?void 0:l.DE)||((u=t.watchProviders)==null?void 0:u.default)||null;if(!r)return[];let o=[["flatrate","Streaming"],["rent","Leihen"],["buy","Kaufen"],["free","Kostenlos"],["ads","Mit Werbung"]],i=[];for(let[d,h]of o){let g=(Array.isArray(r[d])?r[d]:[]).map(p=>({id:(p==null?void 0:p.id)||(p==null?void 0:p.provider_id)||(p==null?void 0:p.providerId)||"",name:(p==null?void 0:p.provider_name)||(p==null?void 0:p.name)||"",logo:(p==null?void 0:p.logo)||(p==null?void 0:p.logo_path)||(p==null?void 0:p.logoPath)||""})).filter(p=>p.name);g.length&&i.push({label:h,providers:g})}return i}function Bt(e){if(e instanceof Number)return Bt(e.valueOf());if(typeof e=="number")return Number.isFinite(e)?q(e):"";if(typeof e=="string"){let t=e.trim();if(!t)return"";let n=Number(t);return Number.isFinite(n)?q(n):""}return""}function Br(e,t){var C,F,X,ie,de,fe;let n=e.querySelector(".v2-details");if(!n)return;n.replaceChildren();let r=document.createElement("div");r.className="v2-details-grid";let o=[],i=Dl(t);i&&o.push(["Ver\xF6ffentlichung",i]);let s=xr(t);s&&o.push(["Laufzeit",s]);let a=Fr(t);a&&o.push(["Studio",a]);let c=Ol(t);if(c&&o.push(["Freigabe",c]),jl(t).forEach(y=>{let[T,x]=y;T&&x&&o.push([T,x])}),(t==null?void 0:t.type)==="tv"){let y=Number(t==null?void 0:t.seasonCount),T=Number.isFinite(y)?y:Array.isArray(t==null?void 0:t.seasons)?t.seasons.length:null;Number.isFinite(T)&&T>0&&o.push(["Staffeln",String(T)]);let x=Array.isArray(t==null?void 0:t.seasons)?t.seasons.reduce((N,P)=>{if(!P)return N;let B=Array.isArray(P.episodes)?P.episodes.length:0;return N+(Number.isFinite(B)?B:0)},0):null;Number.isFinite(x)&&x>0&&o.push(["Episoden",String(x)])}let l=it(Oe(t==null?void 0:t.countries),Array.isArray((C=t==null?void 0:t.tmdbDetail)==null?void 0:C.productionCountries)?t.tmdbDetail.productionCountries:[]);l.length&&o.push(["L\xE4nder",l.join(", ")]);let u=it(Oe(t==null?void 0:t.collections),(X=(F=t==null?void 0:t.tmdbDetail)==null?void 0:F.collection)!=null&&X.name?[t.tmdbDetail.collection.name]:[]);u.length&&o.push(["Sammlungen",u.join(", ")]);let d=Oe(t==null?void 0:t.labels);if(d.length&&o.push(["Labels",d.join(", ")]),t!=null&&t.editionTitle&&o.push(["Edition",t.editionTitle]),t!=null&&t.originalTitle&&t.originalTitle!==t.title&&o.push(["Originaltitel",t.originalTitle]),o.length){let y=document.createElement("section");y.className="v2-details-section",y.dataset.section="general";let T=document.createElement("h3");T.className="v2-details-heading",T.textContent="Allgemein";let x=document.createElement("dl");x.className="v2-details-list",o.forEach(([N,P])=>{if(!N||!P)return;let B=document.createElement("dt");B.textContent=N;let O=document.createElement("dd");O.textContent=P,x.append(B,O)}),x.childElementCount&&(y.append(T,x),r.append(y))}let h=zl(t);if(h.length){let y=document.createElement("section");y.className="v2-details-section",y.dataset.section="genres";let T=document.createElement("h3");T.className="v2-details-heading",T.textContent="Genres";let x=document.createElement("div");x.className="v2-chip-group",h.forEach(N=>{let P=document.createElement("span");P.className="chip",P.textContent=N,x.appendChild(P)}),y.append(T,x),r.append(y)}let f=[],g=it(Oe(t==null?void 0:t.directors),Pr(t==null?void 0:t.tmdbDetail,["Director"]));g.length&&f.push(["Regie",g.join(", ")]);let p=it(Oe(t==null?void 0:t.writers),Pr(t==null?void 0:t.tmdbDetail,["Writer","Screenplay","Story"]));p.length&&f.push(["Drehbuch",p.join(", ")]);let m=it(Oe(t==null?void 0:t.producers),Pr(t==null?void 0:t.tmdbDetail,["Producer","Executive Producer"]));m.length&&f.push(["Produktion",m.join(", ")]);let b=it(Oe((t==null?void 0:t.creators)||(t==null?void 0:t.showrunners)),Array.isArray((ie=t==null?void 0:t.tmdbDetail)==null?void 0:ie.createdBy)?t.tmdbDetail.createdBy.map(y=>(y==null?void 0:y.name)||""):[]);if((t==null?void 0:t.type)==="tv"&&b.length&&f.push(["Creator",b.join(", ")]),f.length){let y=document.createElement("section");y.className="v2-details-section",y.dataset.section="crew";let T=document.createElement("h3");T.className="v2-details-heading",T.textContent="Credits";let x=document.createElement("dl");x.className="v2-details-list",f.forEach(([N,P])=>{if(!N||!P)return;let B=document.createElement("dt");B.textContent=N;let O=document.createElement("dd");O.textContent=P,x.append(B,O)}),x.childElementCount&&(y.append(T,x),r.append(y))}let S=Kl(t);if(S.length){let y=document.createElement("section");y.className="v2-details-section",y.dataset.section="providers";let T=document.createElement("h3");T.className="v2-details-heading",T.textContent="Verf\xFCgbarkeit";let x=document.createElement("div");x.className="v2-provider-groups",S.forEach(N=>{let P=document.createElement("div");P.className="v2-provider-group";let B=document.createElement("p");B.className="v2-provider-label",B.textContent=N.label;let O=document.createElement("div");O.className="v2-provider-list",N.providers.forEach(j=>{let se=document.createElement("span");if(se.className="v2-provider",se.setAttribute("data-provider",j.id||j.name),j.logo){let pe=document.createElement("img");pe.src=j.logo,pe.alt=j.name,pe.loading="lazy",pe.decoding="async",se.appendChild(pe)}let Ne=document.createElement("span");Ne.className="v2-provider-name",Ne.textContent=j.name,se.appendChild(Ne),O.appendChild(se)}),P.append(B,O),x.appendChild(P)}),y.append(T,x),r.append(y)}let k=Array.isArray((de=t==null?void 0:t.tmdbDetail)==null?void 0:de.networks)?t.tmdbDetail.networks.map(y=>({name:String((y==null?void 0:y.name)||"").trim(),logo:String((y==null?void 0:y.logo)||(y==null?void 0:y.logoPath)||(y==null?void 0:y.logo_path)||"").trim()})).filter(y=>y.name||y.logo):[];if(k.length){let y=document.createElement("section");y.className="v2-details-section",y.dataset.section="networks";let T=document.createElement("h3");T.className="v2-details-heading",T.textContent="Netzwerke";let x=document.createElement("div");x.className="v2-chip-group network-chip-group",k.forEach(N=>{let P=document.createElement("span");P.className="network-chip";let B=N.name||"Unbekanntes Netzwerk";if(N.logo){let j=document.createElement("img");j.src=N.logo,j.alt=B,j.loading="lazy",j.decoding="async",P.appendChild(j)}let O=document.createElement("span");O.textContent=B,P.appendChild(O),P.title=B,x.appendChild(P)}),x.childElementCount&&(y.append(T,x),r.append(y))}let L=Array.isArray((fe=t==null?void 0:t.tmdbDetail)==null?void 0:fe.spokenLanguages)?t.tmdbDetail.spokenLanguages.map(y=>({code:String((y==null?void 0:y.code)||(y==null?void 0:y.iso6391)||"").trim(),name:String((y==null?void 0:y.name)||"").trim()})).filter(y=>y.name||y.code):[];if(L.length){let y=document.createElement("section");y.className="v2-details-section",y.dataset.section="languages";let T=document.createElement("h3");T.className="v2-details-heading",T.textContent="Sprachen";let x=document.createElement("div");x.className="v2-chip-group network-chip-group",L.forEach(N=>{let P=document.createElement("span");P.className="network-chip";let B=[];N.name&&B.push(N.name);let O=N.code?N.code.toUpperCase():"";O&&(!N.name||O!==N.name.toUpperCase())&&B.push(O);let j=B.join(" \u2022 ")||"Unbekannte Sprache";P.textContent=j,P.title=j,x.appendChild(P)}),x.childElementCount&&(y.append(T,x),r.append(y))}if(r.childElementCount)n.appendChild(r);else{let y=document.createElement("p");y.className="v2-details-empty",y.textContent="Keine zus\xE4tzlichen Details verf\xFCgbar.",n.appendChild(y)}}var Pi=M(()=>{ye();Lr();Y()});function En(){return Date.now()}function Gl(e){let t=Number(e),n=Number.isFinite(t)?t:24;return Math.max(.01,n)*60*60*1e3}function ql(e){try{return JSON.parse(e)}catch{return[]}}function Wl(e){try{return JSON.stringify(e)}catch{return"[]"}}function Bi({storageKey:e=Ul}={}){let t=new Map,n=!1;function r(){if(n||(n=!0,typeof localStorage=="undefined"))return;let u;try{if(u=localStorage.getItem(e),!u){t=new Map;return}}catch{t=new Map;return}let d=ql(u),h=new Map,f=En();if(Array.isArray(d))for(let g of d){if(!Array.isArray(g)||g.length<2)continue;let[p,m]=g;if(!p||!m)continue;let b=Number(m.expiresAt);Number.isFinite(b)&&b>f&&h.set(String(p),{value:m.value,expiresAt:b})}t=h}function o(){if(typeof localStorage=="undefined")return;let u=Array.from(t.entries()).map(([d,h])=>[d,{value:h.value,expiresAt:h.expiresAt}]);try{localStorage.setItem(e,Wl(u))}catch{}}function i(u){if(!u)return null;r();let d=t.get(String(u));return d?Number.isFinite(d.expiresAt)&&d.expiresAt<=En()?(t.delete(String(u)),o(),null):d.value:null}function s(u,d,h=24){if(!u)return d;r();let f=En()+Gl(h);return t.set(String(u),{value:d,expiresAt:f}),o(),d}function a(u){if(r(),!u){t.clear(),o();return}let d=String(u),h=!1;for(let f of t.keys())f.startsWith(d)&&(t.delete(f),h=!0);h&&o()}function c(){r();let u=En(),d=!1;for(let[h,f]of t.entries())Number.isFinite(f.expiresAt)&&f.expiresAt<=u&&(t.delete(h),d=!0);return d&&o(),d}function l(){return r(),t.size}return{get:i,set:s,clear:a,clearExpired:c,size:l}}function Vl(e){return Rt.get(e)}function Xl(e,t,n){return Rt.set(e,t,n)}function Rr(e){return Rt.clear(e)}function Yl(){return Rt.clearExpired()}function Jl(){return Rt.size()}function st(e){return Bi(e)}var Ul,Rt,Ri,An=M(()=>{Ul="tmdb.metadata.cache.v1";Rt=Bi();Ri={get:Vl,set:Xl,clear:Rr,clearExpired:Yl,size:Jl,createCacheStore:st}});function $i(e){return new Promise(t=>setTimeout(t,Math.max(0,e||0)))}function Ql(e){if(!e)return null;let t=Number(e);if(Number.isFinite(t))return t*1e3;let n=Date.parse(e);return Number.isFinite(n)?Math.max(0,n-Date.now()):null}function Di(e,t){if(Number.isFinite(t)&&t>0)return Math.min(t,Hi);let n=Math.pow(2,Math.max(0,e));return Math.min(Hi,Zl*n)}function Hr(e){return e?Array.isArray(e)?e.filter(Boolean).join(","):typeof e=="string"?e.split(",").map(t=>t.trim()).filter(Boolean).join(","):"":""}function eu(e={}){var r,o,i,s;let t=[e.token,e.tmdbToken,(r=e==null?void 0:e.credentials)==null?void 0:r.token,(o=e==null?void 0:e.settings)==null?void 0:o.tmdbToken].find(a=>typeof a=="string"&&a.trim());if(t)return{kind:"bearer",value:t.trim()};let n=[e.apiKey,e.tmdbApiKey,(i=e==null?void 0:e.credentials)==null?void 0:i.apiKey,(s=e==null?void 0:e.settings)==null?void 0:s.tmdbApiKey].find(a=>typeof a=="string"&&a.trim());if(n)return{kind:"apikey",value:n.trim()};if(typeof localStorage!="undefined")try{let a=localStorage.getItem("tmdbToken");if(a&&a.trim())return{kind:"bearer",value:a.trim()}}catch{}return{kind:"none",value:""}}function tu(e){let t={Accept:"application/json;charset=utf-8"};return(e==null?void 0:e.kind)==="bearer"&&e.value&&(t.Authorization=`Bearer ${e.value}`),{headers:t}}function nu(e,t){if((t==null?void 0:t.kind)!=="apikey"||!t.value)return e;let n=new URL(e);return n.searchParams.set("api_key",t.value),n.toString()}function ru(e,t,n){let r=String(n.apiBase||zi).replace(/\/$/,""),o=e.startsWith("/")?e:`/${e}`,i=new URL(`${r}${o}`),s=i.searchParams,a=Hr(t.append_to_response);a&&s.set("append_to_response",a);let c=t.language||n.language||Oi;c&&s.set("language",c);let l=t.region||n.region||ji;l&&s.set("region",l);for(let[u,d]of Object.entries(t))if(d!=null&&!(u==="append_to_response"||u==="language"||u==="region")){if(Array.isArray(d)){d.length&&s.set(u,d.join(","));continue}s.set(u,String(d))}return i.toString()}async function ou(e,t,{retries:n=Ki}={}){let r=0,o=null;for(;r<=n;)try{let i=await fetch(e,t);if(i.status===204)return null;if(i.status===429&&r<n){let a=Ql(i.headers.get("Retry-After"));await $i(Di(r,a)),r+=1;continue}if(!i.ok){let a=new Error(`TMDB request failed with status ${i.status}`);a.status=i.status,a.url=e;try{a.body=await i.text()}catch{a.body=null}throw a}return await i.json()}catch(i){if(o=i,r>=n)break;await $i(Di(r,null)),r+=1}throw o||new Error("TMDB request failed")}function $r(e={}){let t=e.cache instanceof Map?e.cache:null,n={apiBase:e.apiBase||zi,language:e.language||Oi,region:e.region||ji,ttlHours:e.ttlHours||e.ttl||0},r=eu(e),o=e.cacheStore||(e.useCache?st():null);function i(a,c){if(!t&&!o)return"";let l=Object.keys(c).sort().map(u=>`${u}=${JSON.stringify(c[u])}`).join("&");return`${a}?${l}`}async function s(a,c={},l={}){var m;let u={...c};if(l.append){let b=Hr(u.append_to_response),S=Hr(l.append),k=[b,S].filter(Boolean).join(",");k&&(u.append_to_response=k)}l.language&&(u.language=l.language),l.region&&(u.region=l.region);let d=ru(a,u,n),h=nu(d,r),f=tu(r),g=i(a,u);if(g){if(t&&t.has(g))return t.get(g);if(o){let b=o.get(g);if(b)return b}}let p=await ou(h,f,{retries:(m=l.retries)!=null?m:Ki});if(g&&(t&&t.set(g,p),o))try{o.set(g,p,e.ttlHours||0)}catch{}return p}return{get:s,get credential(){return r},get config(){return{...n}}}}var zi,Oi,ji,Ki,Zl,Hi,Oh,Ui=M(()=>{An();zi="https://api.themoviedb.org/3",Oi="de-DE",ji="DE",Ki=4,Zl=500,Hi=1e4;Oh=$r()});function iu(e){let t=String(e||Dr).trim();return t?t.replace(/\/$/,""):Dr}function su(e){if(!e)return"";let t=String(e);return t?t.startsWith("/")?t:`/${t}`:""}function $t(e,t,n){let r=su(e);return r?`${iu(n)}/${t}${r}`:""}function au(e){return`data:image/svg+xml,${encodeURIComponent(e)}`}function cu(e){switch(e){case"poster":return"#1f2933";case"profile":return"#111827";case"logo":return"#0f172a";case"episode":return"#0b1120";default:return"#101827"}}function lu(e){return e==="logo"?"#e5e7eb":"#f9fafb"}function je(e,t=2){let n=String(e||"").trim();if(!n)return"";let r=n.split(/\s+/u).filter(Boolean);return r.length?r.slice(0,t).map(i=>i.charAt(0)).join("").toUpperCase():n.slice(0,t).toUpperCase()}function Dt({type:e,text:t="",width:n,height:r,fontSize:o,fontWeight:i="600",radius:s=0}){let a=cu(e),c=lu(e),l=je(t,2)||"\u2205",u=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${r}" viewBox="0 0 ${n} ${r}">
  <rect x="0" y="0" width="${n}" height="${r}" rx="${s}" ry="${s}" fill="${a}"/>
  <text x="50%" y="50%" dominant-baseline="central" text-anchor="middle" fill="${c}" font-family="'Inter', 'Segoe UI', sans-serif" font-size="${o}" font-weight="${i}" letter-spacing="0.08em">${l}</text>
</svg>`;return au(u)}function uu(e){return Dt({type:"poster",text:e,width:500,height:750,fontSize:140,radius:24})}function du(e){return Dt({type:"backdrop",text:e,width:780,height:439,fontSize:120,radius:16})}function fu(e){return Dt({type:"profile",text:e,width:400,height:600,fontSize:140,radius:32})}function gu(e){return Dt({type:"logo",text:e,width:500,height:281,fontSize:96,radius:24})}function hu(e){return Dt({type:"episode",text:e,width:780,height:439,fontSize:110,radius:24})}function zt(e){var t,n,r,o;return{imageBase:(n=(t=e==null?void 0:e.imageBase)!=null?t:e==null?void 0:e.base)!=null?n:Dr,title:(o=(r=e==null?void 0:e.title)!=null?r:e==null?void 0:e.fallbackTitle)!=null?o:"",size:e==null?void 0:e.size}}function Ie(e,t={}){let{imageBase:n,title:r,size:o}=zt(t);return $t(e,o||Ht.poster,n)||uu(r)}function at(e,t={}){let{imageBase:n,title:r,size:o}=zt(t);return $t(e,o||Ht.backdrop,n)||du(r)}function wn(e,t={}){let{imageBase:n,title:r,size:o}=zt(t);return $t(e,o||Ht.profile,n)||fu(r)}function Ot(e,t={}){let{imageBase:n,title:r,size:o}=zt(t);return $t(e,o||Ht.logo,n)||gu(r)}function jt(e,t={}){let{imageBase:n,title:r,size:o}=zt(t);return $t(e,o||Ht.episode,n)||hu(r)}var Dr,Ht,zr=M(()=>{Dr="https://image.tmdb.org/t/p",Ht={poster:"w500",backdrop:"w780",profile:"h632",logo:"w500",episode:"w780"}});function Ke(e={}){return{...mu,...e}}function Q(e){if(e==null)return"";let t=Number(e);if(Number.isFinite(t)&&t>0)return String(Math.floor(t));let n=String(e).trim();if(/^\d+$/.test(n)){let r=parseInt(n,10);if(r>0)return String(r)}return""}function pu(e){let t=Number(e.vote_count||e.voteCount||0);return Number(e.vote_average||e.voteAverage||0)*10+t}function Gi(e){if(!e)return"any";let t=String(e).toLowerCase();return t==="xx"||t==="null"?"any":t}function ct(e=[],{preferredLanguages:t=["de","en","any"],fallbackPath:n=""}={}){if(!Array.isArray(e)||e.length===0)return n||"";let r=e.filter(o=>o&&o.file_path).map(o=>({...o,language:Gi(o.iso_639_1||o.language||""),score:pu(o)})).sort((o,i)=>i.score-o.score);for(let o of t){let i=r.find(s=>s.language===Gi(o));if(i)return i.file_path||n||""}return r.length?r[0].file_path||n||"":n||""}function bu(e,t){if(!(e!=null&&e.belongs_to_collection))return null;let n=e.belongs_to_collection;return{id:Q(n.id),name:n.name||"",poster:Ie(n.poster_path,{imageBase:t.imageBase,size:t.posterSize,title:n.name}),backdrop:at(n.backdrop_path,{imageBase:t.imageBase,size:t.backdropSize,title:n.name})}}function qi(e){return Array.isArray(e)?e.map(t=>t&&(t.name||t.title||t.tag)).filter(Boolean).map(String):[]}function Wi(e,t){return Array.isArray(e)?e.map(n=>({id:Q(n==null?void 0:n.id),name:(n==null?void 0:n.name)||"",originCountry:(n==null?void 0:n.origin_country)||"",logo:Ot(n==null?void 0:n.logo_path,{imageBase:t.imageBase,size:t.logoSize,title:n==null?void 0:n.name})})):[]}function yu(e,t){var i,s,a;if(!e)return null;let n=Ke(t),r=Q((i=e.provider_id)!=null?i:e.id),o=e.provider_name||e.name||"";return o?{id:r,providerId:r,name:o,logoPath:e.logo_path||"",logo:Ot(e.logo_path,{imageBase:n.imageBase,size:n.logoSize,title:o}),displayPriority:(a=(s=e.display_priority)!=null?s:e.displayPriority)!=null?a:null}:null}function vu(e,t){if(!e)return null;let n=Ke(t),r=["flatrate","rent","buy","free","ads"],o={link:e.link||""};for(let i of r){let s=Array.isArray(e[i])?e[i]:[];o[i]=s.map(a=>yu(a,n)).filter(Boolean)}return o}function Vi(e,t={}){let n=Ke(t),r=e==null?void 0:e.results;if(!r||typeof r!="object")return{};let o={};for(let[s,a]of Object.entries(r)){let c=String(s||"").toUpperCase();if(!c)continue;let l=vu(a,n);l&&(o[c]=l)}let i=String(t.region||n.region||"").toUpperCase();return i&&o[i]&&(o.default=o[i]),o}function Su(e,t){return Array.isArray(e)?e.map(n=>({id:Q(n==null?void 0:n.id),name:(n==null?void 0:n.name)||"",logo:Ot(n==null?void 0:n.logo_path,{imageBase:t.imageBase,size:t.logoSize,title:n==null?void 0:n.name}),originCountry:(n==null?void 0:n.origin_country)||""})):[]}function Eu(e,t){return Array.isArray(e)?e.map(n=>{var r,o;return{id:Q(n==null?void 0:n.id),name:(n==null?void 0:n.name)||"",seasonNumber:(r=n==null?void 0:n.season_number)!=null?r:null,episodeCount:(o=n==null?void 0:n.episode_count)!=null?o:null,airDate:(n==null?void 0:n.air_date)||"",poster:Ie(n==null?void 0:n.poster_path,{imageBase:t.imageBase,size:t.posterSize,title:n==null?void 0:n.name})}}):[]}function Au(e){return Array.isArray(e)?e.map(t=>({code:(t==null?void 0:t.iso_639_1)||"",name:(t==null?void 0:t.english_name)||(t==null?void 0:t.name)||""})):[]}function wu(e){if(e!=null&&e.character)return e.character;if(Array.isArray(e==null?void 0:e.roles)&&e.roles.length){let t=e.roles.find(n=>n==null?void 0:n.character)||e.roles[0];return(t==null?void 0:t.character)||""}return""}function ku(e){if(e!=null&&e.job)return e.job;if(Array.isArray(e==null?void 0:e.jobs)&&e.jobs.length){let t=e.jobs.find(n=>n==null?void 0:n.job)||e.jobs[0];return(t==null?void 0:t.job)||""}return""}function Kt(e,t={}){var a,c;let n=Ke(t);if(!e)return{cast:[],crew:[]};let r=Array.isArray(e.cast)&&e.cast.length?e.cast:Array.isArray((a=e==null?void 0:e.aggregate)==null?void 0:a.cast)?e.aggregate.cast:[],o=Array.isArray(e.crew)&&e.crew.length?e.crew:Array.isArray((c=e==null?void 0:e.aggregate)==null?void 0:c.crew)?e.aggregate.crew:[],i=r.slice(0,n.castLimit).map(l=>{var u;return{id:Q(l==null?void 0:l.id),name:(l==null?void 0:l.name)||(l==null?void 0:l.original_name)||"",character:wu(l),order:(u=l==null?void 0:l.order)!=null?u:0,profile:wn(l==null?void 0:l.profile_path,{imageBase:n.imageBase,size:n.profileSize,title:l==null?void 0:l.name}),initials:je((l==null?void 0:l.name)||(l==null?void 0:l.original_name)||""),knownForDepartment:(l==null?void 0:l.known_for_department)||""}}),s=o.slice(0,n.crewLimit).map(l=>({id:Q(l==null?void 0:l.id),name:(l==null?void 0:l.name)||(l==null?void 0:l.original_name)||"",job:ku(l),department:(l==null?void 0:l.department)||"",profile:wn(l==null?void 0:l.profile_path,{imageBase:n.imageBase,size:n.profileSize,title:l==null?void 0:l.name}),initials:je((l==null?void 0:l.name)||(l==null?void 0:l.original_name)||"")}));return{cast:i,crew:s}}function Tu(e=[]){let t=["DE","AT","CH","US"];for(let n of t){let r=e.find(s=>(s==null?void 0:s.iso_3166_1)===n);if(!r)continue;let i=(Array.isArray(r.release_dates)?r.release_dates:[]).filter(s=>s&&typeof s.certification=="string"&&s.certification.trim()).sort((s,a)=>{var h,f;let c=(h=s.type)!=null?h:0,l=(f=a.type)!=null?f:0;if(c!==l)return c-l;let u=Date.parse(s.release_date||"")||0,d=Date.parse(a.release_date||"")||0;return u-d});if(i.length)return i[0].certification.trim()}return""}function Xi(e={}){var t,n;if((t=e.release_dates)!=null&&t.results){let r=Tu(e.release_dates.results);if(r)return r}if((n=e.content_ratings)!=null&&n.results){let r=Array.isArray(e.content_ratings.results)?e.content_ratings.results:[],o=r.find(s=>(s==null?void 0:s.iso_3166_1)==="DE"&&(s==null?void 0:s.rating));if(o)return String(o.rating).trim();let i=r.find(s=>(s==null?void 0:s.iso_3166_1)==="US"&&(s==null?void 0:s.rating));if(i)return String(i.rating).trim()}return""}function Ut(e=[],t){return Array.isArray(e)?e.filter(n=>n&&n.file_path).map(t):[]}function Yi(e,t={}){var i,s,a,c;if(!e)return null;let n=Ke(t),r=ct((i=e.images)==null?void 0:i.posters,{fallbackPath:e.poster_path}),o=ct((s=e.images)==null?void 0:s.backdrops,{fallbackPath:e.backdrop_path,preferredLanguages:["de","en","any"]});return{type:"movie",id:Q(e.id),title:e.title||e.original_title||"",originalTitle:e.original_title||"",overview:e.overview||"",tagline:e.tagline||"",releaseDate:e.release_date||"",runtime:Number(e.runtime)||null,status:e.status||"",homepage:e.homepage||"",imdbId:e.imdb_id||"",collection:bu(e,n),poster:Ie(r,{imageBase:n.imageBase,size:n.posterSize,title:e.title}),posterPath:r,backdrop:at(o,{imageBase:n.imageBase,size:n.backdropSize,title:e.title}),backdropPath:o,genres:qi(e.genres),voteAverage:Number(e.vote_average)||0,voteCount:Number(e.vote_count)||0,popularity:Number(e.popularity)||0,productionCountries:Array.isArray(e.production_countries)?e.production_countries.map(l=>(l==null?void 0:l.iso_3166_1)||(l==null?void 0:l.name)||"").filter(Boolean):[],productionCompanies:Wi(e.production_companies,n),spokenLanguages:Au(e.spoken_languages),contentRating:Xi(e),credits:Kt(e.credits,n),images:{posters:Ut((a=e.images)==null?void 0:a.posters,l=>({path:l.file_path,url:Ie(l.file_path,{imageBase:n.imageBase,size:n.posterSize,title:e.title}),width:l.width,height:l.height,voteAverage:l.vote_average,voteCount:l.vote_count,language:l.iso_639_1||""})),backdrops:Ut((c=e.images)==null?void 0:c.backdrops,l=>({path:l.file_path,url:at(l.file_path,{imageBase:n.imageBase,size:n.backdropSize,title:e.title}),width:l.width,height:l.height,voteAverage:l.vote_average,voteCount:l.vote_count,language:l.iso_639_1||""}))},watchProviders:Vi(e["watch/providers"],n),url:e.id?`https://www.themoviedb.org/movie/${e.id}`:"",raw:e}}function Ji(e,t={}){var i,s,a,c,l;if(!e)return null;let n=Ke(t),r=ct((i=e.images)==null?void 0:i.posters,{fallbackPath:e.poster_path}),o=ct((s=e.images)==null?void 0:s.backdrops,{fallbackPath:e.backdrop_path,preferredLanguages:["de","en","any"]});return{type:"tv",id:Q(e.id),name:e.name||e.original_name||"",originalName:e.original_name||"",overview:e.overview||"",tagline:e.tagline||"",firstAirDate:e.first_air_date||"",lastAirDate:e.last_air_date||"",numberOfEpisodes:Number(e.number_of_episodes)||0,numberOfSeasons:Number(e.number_of_seasons)||0,status:e.status||"",homepage:e.homepage||"",inProduction:!!e.in_production,poster:Ie(r,{imageBase:n.imageBase,size:n.posterSize,title:e.name}),posterPath:r,backdrop:at(o,{imageBase:n.imageBase,size:n.backdropSize,title:e.name}),backdropPath:o,genres:qi(e.genres),voteAverage:Number(e.vote_average)||0,voteCount:Number(e.vote_count)||0,popularity:Number(e.popularity)||0,createdBy:Array.isArray(e.created_by)?e.created_by.map(u=>({id:Q(u==null?void 0:u.id),name:(u==null?void 0:u.name)||"",profile:wn(u==null?void 0:u.profile_path,{imageBase:n.imageBase,size:n.profileSize,title:u==null?void 0:u.name}),initials:je((u==null?void 0:u.name)||"")})):[],networks:Su(e.networks,n),productionCompanies:Wi(e.production_companies,n),seasons:Eu(e.seasons,n),contentRating:Xi(e),credits:Kt(e.aggregate_credits||e.credits,n),images:{posters:Ut((a=e.images)==null?void 0:a.posters,u=>({path:u.file_path,url:Ie(u.file_path,{imageBase:n.imageBase,size:n.posterSize,title:e.name}),width:u.width,height:u.height,voteAverage:u.vote_average,voteCount:u.vote_count,language:u.iso_639_1||""})),backdrops:Ut((c=e.images)==null?void 0:c.backdrops,u=>({path:u.file_path,url:at(u.file_path,{imageBase:n.imageBase,size:n.backdropSize,title:e.name}),width:u.width,height:u.height,voteAverage:u.vote_average,voteCount:u.vote_count,language:u.iso_639_1||""})),logos:Ut((l=e.images)==null?void 0:l.logos,u=>({path:u.file_path,url:Ot(u.file_path,{imageBase:n.imageBase,size:n.logoSize,title:e.name}),width:u.width,height:u.height,language:u.iso_639_1||""}))},watchProviders:Vi(e["watch/providers"],n),url:e.id?`https://www.themoviedb.org/tv/${e.id}`:"",raw:e}}function Zi(e,t={}){var s,a,c;if(!e)return null;let n=Ke(t),r=t.show||{},o=ct((s=e.images)==null?void 0:s.posters,{fallbackPath:e.poster_path}),i=Array.isArray(e.episodes)?e.episodes.map(l=>{var d,h,f,g;let u=ct((d=l==null?void 0:l.images)==null?void 0:d.stills,{fallbackPath:l==null?void 0:l.still_path});return{id:Q(l==null?void 0:l.id),episodeNumber:(h=l==null?void 0:l.episode_number)!=null?h:null,seasonNumber:(g=(f=l==null?void 0:l.season_number)!=null?f:e.season_number)!=null?g:null,name:(l==null?void 0:l.name)||"",overview:(l==null?void 0:l.overview)||"",airDate:(l==null?void 0:l.air_date)||"",runtime:Number(l==null?void 0:l.runtime)||null,voteAverage:Number(l==null?void 0:l.vote_average)||0,voteCount:Number(l==null?void 0:l.vote_count)||0,still:jt(u,{imageBase:n.imageBase,size:n.stillSize,title:(l==null?void 0:l.name)||e.name}),stillPath:u,crew:Kt({crew:(l==null?void 0:l.crew)||[]},n).crew,guestStars:Kt({cast:(l==null?void 0:l.guest_stars)||[]},{...n,castLimit:10}).cast}}):[];return{type:"season",id:Q(e.id),showId:Q(r.id||e.show_id||""),name:e.name||"",overview:e.overview||"",airDate:e.air_date||"",seasonNumber:(a=e.season_number)!=null?a:null,episodeCount:e.episodes?e.episodes.length:e.episode_count||0,poster:Ie(o,{imageBase:n.imageBase,size:n.posterSize,title:e.name||r.name}),posterPath:o,episodes:i,credits:Kt(e.credits,n),url:r.id?`https://www.themoviedb.org/tv/${r.id}/season/${(c=e.season_number)!=null?c:""}`:"",raw:e}}var mu,Qi=M(()=>{zr();mu={imageBase:"https://image.tmdb.org/t/p",posterSize:"w500",backdropSize:"w780",profileSize:"h632",logoSize:"w500",stillSize:"w780",castLimit:20,crewLimit:40,region:"DE"}});function _u(e={}){return{apiKey:e.apiKey||e.tmdbApiKey||"",token:e.token||e.tmdbToken||"",language:e.language||e.lang||"de-DE",region:e.region||e.iso||"DE",imageBase:e.imageBase||Cu,ttlHours:Number(e.ttlHours||e.ttl||es)||es}}function Iu(){return{warn(...e){try{}catch{}}}}function ts(e){return e?Array.isArray(e)?e:String(e).split(",").map(t=>t.trim()).filter(Boolean):[]}function Or(e,t){let n=new Set([...ts(e),...ts(t)]);return n.size?Array.from(n).join(","):""}function xu(e,t,n,r){let o={movie:"images,credits,release_dates,watch/providers",tv:"images,content_ratings,aggregate_credits,credits,watch/providers",season:"images,credits"};async function i(l,u,d){try{let f=t.get(l);if(f)return f}catch(f){r.warn("Cache read failed for",l,(f==null?void 0:f.message)||f)}let h=null;try{h=await d()}catch(f){throw r.warn("Request failed for",l,(f==null?void 0:f.message)||f),f}try{h!=null&&t.set(l,h,u)}catch(f){r.warn("Cache write failed for",l,(f==null?void 0:f.message)||f)}return h}async function s(l,u={}){var g;let d=l!=null?l:u.id;if(d==null)return null;let h=`tmdb:movie:${d}:v1`,f=(g=u.ttlHours)!=null?g:n.ttlHours;return i(h,f,async()=>{var b,S,k;let p=Or(o.movie,u.append),m=await e.get(`/movie/${d}`,{append_to_response:p},{language:(b=u.language)!=null?b:n.language,region:(S=u.region)!=null?S:n.region});return Yi(m,{imageBase:n.imageBase,posterSize:u.posterSize,backdropSize:u.backdropSize,profileSize:u.profileSize,logoSize:u.logoSize,region:(k=u.region)!=null?k:n.region})})}async function a(l,u={}){var g;let d=l!=null?l:u.id;if(d==null)return null;let h=`tmdb:tv:${d}:v1`,f=(g=u.ttlHours)!=null?g:n.ttlHours;return i(h,f,async()=>{var b,S,k;let p=Or(o.tv,u.append),m=await e.get(`/tv/${d}`,{append_to_response:p},{language:(b=u.language)!=null?b:n.language,region:(S=u.region)!=null?S:n.region});return Ji(m,{imageBase:n.imageBase,posterSize:u.posterSize,backdropSize:u.backdropSize,profileSize:u.profileSize,logoSize:u.logoSize,region:(k=u.region)!=null?k:n.region})})}async function c(l,u,d={}){var g;if(l==null||u==null)return null;let h=`tmdb:tv:${l}:season:${u}:v1`,f=(g=d.ttlHours)!=null?g:n.ttlHours;return i(h,f,async()=>{var S,k;let p=Or(o.season,d.append),m=await e.get(`/tv/${l}/season/${u}`,{append_to_response:p},{language:(S=d.language)!=null?S:n.language,region:(k=d.region)!=null?k:n.region}),b=d.show||null;if(!b&&!d.skipShowLookup)try{b=await a(l,{ttlHours:f})}catch(L){r.warn("Failed to load parent show for season",l,u,(L==null?void 0:L.message)||L),b={id:l,name:"",type:"tv"}}return b||(b={id:l,name:"",type:"tv"}),Zi(m,{imageBase:n.imageBase,posterSize:d.posterSize,backdropSize:d.backdropSize,profileSize:d.profileSize,logoSize:d.logoSize,show:b})})}return{getMovieEnriched:s,getTvEnriched:a,getSeasonEnriched:c}}function kn(e={}){let t=_u(e),n=e.cacheStore||st({storageKey:e.storageKey}),r=$r({apiBase:e.apiBase||t.apiBase,apiKey:t.apiKey,token:t.token,language:t.language,region:t.region,ttlHours:t.ttlHours}),o=Iu(),i=xu(r,n,t,o);return{getMovieEnriched:i.getMovieEnriched,getTvEnriched:i.getTvEnriched,getSeasonEnriched:i.getSeasonEnriched,get client(){return r},get cache(){return n},get config(){return{...t}},clear(s){n.clear(s)}}}function ns(){return jr||(jr=st()),jr}function ve(){return Gt||(Gt=kn({cacheStore:ns()})),Gt}function rs(e={}){let t={...e};return t.cacheStore||(t.cacheStore=ns()),Gt=kn(t),Gt}function Fu(){try{let e=localStorage.getItem("tmdbToken");if(e&&e.trim())return e.trim()}catch{}return""}function lt(e={},t={}){try{let{preferStoredToken:n=!0,token:r,apiKey:o,language:i,region:s,ttlHours:a,imageBase:c}=t||{},l={},u=i||e.lang||e.language;u&&(l.language=u);let d=s||e.region||e.iso;d&&(l.region=d);let h=[a,e.ttlHours,e.tmdbTtlHours];for(let m of h){if(m==null||typeof m=="string"&&m.trim()==="")continue;let b=Number(m);if(Number.isFinite(b)){l.ttlHours=b;break}}let f=c||e.imageBase||e.tmdbImageBase;f&&(l.imageBase=f);let g=typeof r=="string"?r.trim():r!=null?r:"";typeof g!="string"&&(g=""),!g&&n&&(g=Fu()),!g&&typeof e.tmdbToken=="string"&&(g=e.tmdbToken.trim());let p=typeof o=="string"?o.trim():o!=null?o:"";typeof p!="string"&&(p=""),!p&&typeof e.tmdbApiKey=="string"&&(p=e.tmdbApiKey.trim()),g?l.token=g:p&&(l.apiKey=p),rs(l)}catch{}}var es,Cu,jr,Gt,os,is,ss,Kr,ut=M(()=>{An();Ui();Qi();es=24,Cu="https://image.tmdb.org/t/p";jr=null,Gt=null;os=(...e)=>ve().getMovieEnriched(...e),is=(...e)=>ve().getTvEnriched(...e),ss={getMovieEnriched:(...e)=>ve().getMovieEnriched(...e),getTvEnriched:(...e)=>ve().getTvEnriched(...e),getSeasonEnriched:(...e)=>ve().getSeasonEnriched(...e),clear(e){return ve().clear(e)},configure:rs,sync:lt};Object.defineProperties(ss,{client:{get(){return ve().client}},cache:{get(){return ve().cache}},config:{get(){return ve().config}}});Kr=ss});function us(e,t,n){let{root:r,seasons:o,options:i}=Mu(e,t,n);if(!r)return;r.querySelectorAll(".season-card").forEach(a=>{typeof a._cleanup=="function"&&a._cleanup()}),r.replaceChildren(),(o||[]).forEach((a,c)=>r.append(Lu(a,c,i)))}function as(e){return e instanceof Element||typeof e=="string"}function Ur(e){return e instanceof Element?e:typeof e=="string"?document.querySelector(e):null}function Mu(e,t,n){let r=null,o=[],i={};return as(e)?(r=Ur(e),Array.isArray(t)?(o=t,i=qt(n)?n:{}):(o=Array.isArray(e)?e:[],i=qt(t)?t:{})):Array.isArray(e)?(o=e,as(t)?(r=Ur(t),i=qt(n)?n:{}):i=qt(t)?t:{}):(r=Ur(e),o=Array.isArray(t)?t:[],i=qt(n)?n:{}),r||(r=document.getElementById("seasonsAccordion")),{root:r,seasons:o,options:i}}function qt(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}function Lu(e,t,n={}){ae(e);let r=document.createElement("article");r.className="season-card";let o=document.createElement("div");o.className="season-head";let i=document.createElement("div");i.className="season-thumb";let s=new Image;s.loading="lazy",s.decoding="async",s.src=e.thumbFile||"",s.alt=e.title||`Staffel ${e.seasonNumber||t+1}`,i.append(s);let a=document.createElement("div"),c=document.createElement("div");c.className="season-title",c.textContent=e.title||`Staffel ${e.seasonNumber||t+1}`;let l=document.createElement("div");l.className="season-sub";let u=e.year||e.releaseYear||"",d=Array.isArray(e.episodes)?e.episodes.length:e.episodeCount||0;l.textContent=[u,d?`${d} Episoden`:""].filter(Boolean).join(" \u2022 "),a.append(c,l);let h=document.createElement("div");h.className="chev",h.textContent="\u203A",o.append(i,a,h);let f=document.createElement("div");f.className="season-body",cs(f,e.episodes||[],{show:n.show});let g=$u(e,t),p=Du(e,n.show),m=!1,b=!1,S=null,k=()=>{if(!(!r.classList.toggle("open")||m||b)){if(!Ou(p,g)){m=!0;return}b=!0,S=new AbortController,Kr.getSeasonEnriched(p,g,{stillSize:"w300",show:n.show||null}).then(C=>{S!=null&&S.signal.aborted||!C||!Array.isArray(C.episodes)||(Hu(e,C.episodes),cs(f,e.episodes||[],{show:n.show}),m=!0)}).catch(C=>{S!=null&&S.signal.aborted||Gr("Failed to enrich season",p,g,(C==null?void 0:C.message)||C)}).finally(()=>{b=!1,S=null})}};return o.addEventListener("click",k),r._cleanup=()=>{o.removeEventListener("click",k),S&&!S.signal.aborted&&S.abort()},r.append(o,f),r}function cs(e,t,n={}){e.replaceChildren();let r=Array.isArray(t)?t:[];if(!r.length){let o=document.createElement("p");o.className="episode-empty",o.textContent="Keine Episoden verf\xFCgbar.",e.append(o);return}r.forEach(o=>{ae(o),e.append(Nu(o,n))})}function Nu(e,t={}){let n=Ru(e),r=document.createElement("div");r.className="episode";let o=document.createElement("div");o.className="ep-media",o.append(Bu(n,t));let i=document.createElement("div");i.className="ep-content";let s=document.createElement("div");s.className="ep-header";let a=document.createElement("div");a.className="ep-title",a.textContent=Pu(n),s.append(a);let c=document.createElement("div");c.className="badges";let l=Number(n.rating);if(Number.isFinite(l)){let f=document.createElement("span");f.className="badge",f.textContent=l.toFixed(1),c.append(f)}c.childElementCount&&s.append(c);let u=document.createElement("div");u.className="ep-meta";let d=[];n.runtimeText&&d.push(n.runtimeText),n.airDate&&d.push(n.airDate),u.textContent=d.join(" \u2022 ");let h=document.createElement("p");return h.className="ep-overview",h.textContent=n.overview||"Keine Beschreibung verf\xFCgbar.",i.append(s,u,h),r.append(o,i),r}function Pu(e){let t=[];return e.code&&t.push(e.code),e.title&&t.push(e.title),t.join(" \u2022 ")}function Bu(e,t={}){var a,c;let n=document.createElement("div");n.className="ep-still";let r=e.tmdbStillPath,o=e.tmdbStill||e.localStill,i=e.title||((a=t==null?void 0:t.show)==null?void 0:a.title)||"Episode";if(r||o){let l=new Image;if(l.loading="lazy",l.decoding="async",r){let u=jt(r,{size:"w300",title:i}),d=jt(r,{size:"w780",title:i});l.src=u,l.srcset=`${u} 300w, ${d} 780w`}else l.src=o;return l.alt=i,n.append(l),n}n.dataset.state="empty";let s=document.createElement("div");return s.className="ep-still-initials",s.textContent=je(e.title||((c=t==null?void 0:t.show)==null?void 0:c.title)||"",2)||"\u2205",n.append(s),n}function Ru(e){var h,f,g;let t=(e==null?void 0:e.tmdb)||{},n=Se(e==null?void 0:e.seasonNumber,t==null?void 0:t.seasonNumber),r=Se(e==null?void 0:e.episodeNumber,t==null?void 0:t.episodeNumber,e==null?void 0:e.index),o=(e==null?void 0:e.seasonEpisode)&&String(e.seasonEpisode).toUpperCase()||(Number.isFinite(n)&&Number.isFinite(r)?`S${String(n).padStart(2,"0")}E${String(r).padStart(2,"0")}`:""),i=(e==null?void 0:e.durationMin)||(Number.isFinite(e==null?void 0:e.duration)?Math.round(Number(e.duration)/6e4):null)||(Number.isFinite(t==null?void 0:t.runtime)?Number(t.runtime):null),s=(e==null?void 0:e.durationHuman)||(Number.isFinite(i)&&i>0?`${i} min`:""),a=Number.isFinite(t==null?void 0:t.voteAverage)?Number(t.voteAverage):Number((g=(f=(h=e==null?void 0:e.audienceRating)!=null?h:e==null?void 0:e.rating)!=null?f:e==null?void 0:e.score)!=null?g:NaN),c=(t==null?void 0:t.overview)||(e==null?void 0:e.summary)||(e==null?void 0:e.overview)||(e==null?void 0:e.description)||(e==null?void 0:e.plot)||"",l=(t==null?void 0:t.airDate)||(e==null?void 0:e.originallyAvailableAt)||(e==null?void 0:e.date)||(e==null?void 0:e.airDate)||"",u=(t==null?void 0:t.stillPath)||(e==null?void 0:e.stillPath)||"",d=(t==null?void 0:t.still)||(e==null?void 0:e.still)||(e==null?void 0:e.thumbFile)||(e==null?void 0:e.thumb)||"";return{title:(t==null?void 0:t.name)||(e==null?void 0:e.title)||(e==null?void 0:e.name)||"",code:o,runtimeText:s,rating:a,overview:c,airDate:l,tmdbStillPath:u,tmdbStill:(t==null?void 0:t.still)||"",localStill:d}}function Hu(e,t){if(!e||typeof e!="object")return;let n=Array.isArray(e.episodes)?e.episodes:[],r=new Map;n.forEach(o=>{let i=ls(o);i&&r.set(i,o)}),t.forEach(o=>{var a,c,l;let i=ls(o);if(!i||!r.has(i))return;let s=r.get(i);s.tmdb={id:o.id||"",seasonNumber:Se(o.seasonNumber),episodeNumber:Se(o.episodeNumber),name:o.name||"",overview:o.overview||"",airDate:o.airDate||"",runtime:Se(o.runtime),voteAverage:Number((c=(a=o.voteAverage)!=null?a:o.vote_average)!=null?c:NaN),voteCount:Se((l=o.voteCount)!=null?l:o.vote_count),still:o.still||"",stillPath:o.stillPath||""}})}function ls(e){if(!e)return"";let t=Se(e.seasonNumber,e.parentIndex,e.parentSeason,e.season),n=Se(e.episodeNumber,e.index,e.episode,e.indexNumber);return!Number.isFinite(t)||!Number.isFinite(n)?"":`${t}:${n}`}function Se(...e){for(let t of e){let n=Number(t);if(Number.isFinite(n))return n}return null}function $u(e,t){let n=Se(e==null?void 0:e.seasonNumber,e==null?void 0:e.index,e==null?void 0:e.indexNumber);return Number.isFinite(n)?n:(t!=null?t:0)+1}function Du(e,t){var a,c,l,u,d;let n=(t==null?void 0:t.ids)||{},r=(n==null?void 0:n.tmdb)||(t==null?void 0:t.tmdbId)||((a=t==null?void 0:t.tmdb)==null?void 0:a.id)||(t==null?void 0:t.id),o=(e==null?void 0:e.tmdbShowId)||((l=(c=e==null?void 0:e.parent)==null?void 0:c.ids)==null?void 0:l.tmdb)||((u=e==null?void 0:e.parent)==null?void 0:u.tmdbId)||((d=e==null?void 0:e.ids)==null?void 0:d.tmdbShow),i=r||o;if(i==null)return null;let s=String(i).trim();return s||null}function zu(){var e;try{let t=((e=Kr)==null?void 0:e.config)||{};if(typeof t.token=="string"&&t.token.trim()||typeof t.apiKey=="string"&&t.apiKey.trim())return!0}catch(t){Gr("Failed to inspect metadata service config for credentials",(t==null?void 0:t.message)||t)}try{let t=typeof(localStorage==null?void 0:localStorage.getItem)=="function"?localStorage.getItem("tmdbToken"):"";if(typeof t=="string"&&t.trim())return!0}catch(t){Gr("Failed to read TMDB credentials from storage",(t==null?void 0:t.message)||t)}return!1}function Ou(e,t){var n;return!(!((n=window==null?void 0:window.FEATURES)!=null&&n.tmdbEnrichment)||!zu()||!e||t==null)}function Gr(...e){try{}catch{}}var ds=M(()=>{rt();ut();zr()});function fs(e,t){let n=e.querySelector(".v2-seasons");if(!n)return;let r=Array.isArray(t==null?void 0:t.seasons)?t.seasons:[];if(!r.length){n.innerHTML='<p class="modalv2-loading">Keine Staffel-Informationen verf\xFCgbar.</p>';return}n.innerHTML="",us(n,r,{show:t})}var gs=M(()=>{ds()});function qr(e,t){var l,u,d,h,f,g,p,m,b;let n=e.querySelector("#v2Tmdb"),r=e.querySelector("#v2Imdb"),o=e.querySelector("#v2Trailer"),i=((l=t==null?void 0:t.ids)==null?void 0:l.tmdb)||(t==null?void 0:t.tmdbId)||((u=t==null?void 0:t.tmdbDetail)==null?void 0:u.id)||((d=t==null?void 0:t.tmdb)==null?void 0:d.id),s=((h=t==null?void 0:t.ids)==null?void 0:h.imdb)||(t==null?void 0:t.imdbId)||((f=t==null?void 0:t.tmdbDetail)==null?void 0:f.imdbId)||((m=(p=(g=t==null?void 0:t.tmdbDetail)==null?void 0:g.raw)==null?void 0:p.external_ids)==null?void 0:m.imdb_id),a=(t==null?void 0:t.trailer)||(t==null?void 0:t.trailerUrl)||((b=t==null?void 0:t.tmdbDetail)==null?void 0:b.trailer),c=(t==null?void 0:t.type)==="tv"?"tv":"movie";n&&(i?(n.hidden=!1,n.href=`https://www.themoviedb.org/${c}/${i}`):(n.hidden=!0,n.removeAttribute("href"))),r&&(s?(r.hidden=!1,r.href=`https://www.imdb.com/title/${s}/`):(r.hidden=!0,r.removeAttribute("href"))),o&&(a?(o.hidden=!1,o.onclick=()=>window.open(a,"_blank","noopener")):(o.hidden=!0,o.onclick=null))}var hs=M(()=>{});function Uu(e){var i,s,a;if(!e)return null;if(typeof e=="string"){let c=String(e).trim();return c?{name:c,role:"",thumb:"",tmdbProfile:"",raw:null}:null}let t=String(e.tag||e.name||e.role||"").trim();if(!t)return null;let n=(()=>{let c=String(e.role||"").trim();return c?c.toLowerCase()===t.toLowerCase()?"":c:""})(),r=[(i=e==null?void 0:e.tmdb)==null?void 0:i.profile,(s=e==null?void 0:e.tmdb)==null?void 0:s.profile_path,(a=e==null?void 0:e.tmdb)==null?void 0:a.profilePath,e==null?void 0:e.tmdbProfile,e==null?void 0:e.profile,e==null?void 0:e.profile_path,e==null?void 0:e.profilePath].find(c=>typeof c=="string"&&c.trim()),o=[e==null?void 0:e.thumb,e==null?void 0:e.photo,e==null?void 0:e.image].find(c=>typeof c=="string"&&c.trim())||"";return{name:t,role:n,thumb:o,tmdbProfile:r?String(r).trim():"",raw:e}}function Gu(e){if(!e)return null;let t=String(e.name||e.original_name||"").trim();if(!t)return null;let n=String(e.character||"").trim();return{name:t,role:n,thumb:"",tmdbProfile:e.profile||e.profile_path||e.profilePath||"",raw:{tmdb:e}}}function Wr(e){var i,s;let t=new Map,n=[];return(Array.isArray(e==null?void 0:e.cast)?e.cast:Array.isArray(e==null?void 0:e.roles)?e.roles:[]).forEach(a=>{let c=Uu(a);if(!c)return;let l=c.name.toLowerCase();t.has(l)||(t.set(l,!0),n.push(c))}),(Array.isArray((s=(i=e==null?void 0:e.tmdbDetail)==null?void 0:i.credits)==null?void 0:s.cast)?e.tmdbDetail.credits.cast:[]).forEach(a=>{let c=Gu(a);if(!c)return;let l=c.name.toLowerCase();t.has(l)||(t.set(l,!0),n.push(c))}),n}function Vr(e,t){let n=e.querySelector(".v2-cast");if(!n)return;let r=n.querySelector(".v2-cast-scroll");if(r?r.innerHTML="":(r=document.createElement("div"),r.className="v2-cast-scroll",n.prepend(r)),!r)return;let o=Array.isArray(t)?t.slice(0,12):[];if(!o.length){r.innerHTML='<span class="modalv2-loading">Keine Besetzungsdaten verf\xFCgbar.</span>',r.removeAttribute("role");return}r.setAttribute("role","list");let i=ze();o.forEach(s=>{let a=s&&typeof s=="object"&&"name"in s?s:(()=>{let f=String(s||"").trim();return f?{name:f,role:"",thumb:"",tmdbProfile:"",raw:null}:null})();if(!a||!a.name)return;let c=document.createElement("article");c.className="v2-cast-card",c.tabIndex=0,c.setAttribute("role","listitem");let l=String(a.role||"").trim();c.setAttribute("aria-label",l?`${a.name} \u2013 ${l}`:a.name);let u=document.createElement("div");u.className="v2-cast-avatar";let d=Vu(a,i);if(d){u.classList.add("has-image");let f=document.createElement("img");f.src=d,f.alt=a.name,f.loading="lazy",f.decoding="async",u.appendChild(f)}else{let f=document.createElement("span");f.className="v2-cast-initials",f.textContent=Xu(a.name),f.setAttribute("aria-hidden","true"),u.appendChild(f)}let h=document.createElement("p");if(h.className="v2-cast-name",h.textContent=a.name,c.append(u,h),l){let f=document.createElement("p");f.className="v2-cast-role",f.textContent=l,c.append(f)}else c.classList.add("v2-cast-card--no-role");r.appendChild(c)}),r.children.length||(r.innerHTML='<span class="modalv2-loading">Keine Besetzungsdaten verf\xFCgbar.</span>',r.removeAttribute("role")),ms(n)}function dt(e,t){let n=ps(e);n&&(n.dataset.loading=t?"true":"false",t?n.setAttribute("aria-busy","true"):n.removeAttribute("aria-busy"))}function ft(e,t){let n=ps(e);if(!n)return;let r=n.querySelector(".v2-cast-status");if(!t||!t.message){r&&r.remove(),n.dataset.status="";return}r||(r=document.createElement("p"),r.className="v2-cast-status",r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true"),n.appendChild(r)),r.dataset.state=t.state||"",r.textContent=t.message,n.dataset.status=t.state||"",ms(n)}function ms(e){let t=e.querySelector(".v2-cast-status"),n=e.querySelector(".v2-cast-scroll");t&&n&&t.previousElementSibling!==n&&e.appendChild(t)}function ps(e){return e instanceof HTMLElement?e.querySelector(".v2-cast"):document.querySelector(".v2-pane.v2-cast")}function qu(e){let t=String(e||"").trim();if(!t)return"";if(/^https?:\/\//i.test(t))return t;if(t.startsWith("//"))return`https:${t}`;let n=t.startsWith("/")?t:`/${t}`;return`${ju}${Ku}${n}`}function Wu(e){let t=String(e||"").trim();return t?/^https?:\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("//")?`https:${t}`:t:""}function Vu(e,t){var o,i,s;if(!e)return"";let n=e.raw||{};if(t){let a=[e.tmdbProfile,(o=n==null?void 0:n.tmdb)==null?void 0:o.profile,(i=n==null?void 0:n.tmdb)==null?void 0:i.profile_path,(s=n==null?void 0:n.tmdb)==null?void 0:s.profilePath,n==null?void 0:n.tmdbProfile,n==null?void 0:n.profile,n==null?void 0:n.profile_path,n==null?void 0:n.profilePath];for(let c of a){let l=qu(c);if(l)return l}}let r=[e.thumb,n==null?void 0:n.thumb,n==null?void 0:n.photo,n==null?void 0:n.image];for(let a of r){let c=Wu(a);if(c)return c}return""}function Xu(e){let t=String(e||"").trim();if(!t)return"?";let r=t.split(/\s+/).slice(0,2).map(o=>o.charAt(0)).filter(Boolean);return r.length?r.join("").toUpperCase():t.charAt(0).toUpperCase()}var ju,Ku,bs=M(()=>{ye();ju="https://image.tmdb.org/t/p/",Ku="w185"});function Ju(e){return e!==null&&typeof e=="object"}function Zu(e){var i,s;let t=Ju(e)?(s=(i=e.id)!=null?i:e.guid)!=null?s:"":e,n=typeof t=="string"?t.trim():"";if(!n)return{};let r=n.toLowerCase(),o={};for(let[a,c]of Object.entries(Yu))if(!o[a])for(let l of c){let u=l.toLowerCase(),d=r.indexOf(u);if(d===-1)continue;let h=d+u.length,f=n.slice(h);if(f=f.replace(/^\/+/,""),f=f.split(/[?#]/)[0],!!f&&(f.includes("/")&&(f=f.split("/").find(Boolean)||""),f=f.trim(),f)){o[a]=f;break}}return o}function Tn(e){var o,i,s;if(!e||typeof e!="object")return e;let t={...e.ids||{}},n=(a,c)=>{if(t[a])return;let l=c==null?"":String(c).trim();l&&(t[a]=l)};n("tmdb",e.tmdbId),n("tmdb",(o=e==null?void 0:e.tmdb)==null?void 0:o.id),n("imdb",e.imdbId),n("imdb",(i=e==null?void 0:e.tmdb)==null?void 0:i.imdbId),n("tvdb",e.tvdbId),n("tvdb",(s=e==null?void 0:e.tmdb)==null?void 0:s.tvdbId);let r=[];return Array.isArray(e==null?void 0:e.guids)&&r.push(...e.guids),e!=null&&e.guid&&r.push(e.guid),r.forEach(a=>{let c=Zu(a);Object.entries(c).forEach(([l,u])=>n(l,u))}),Object.keys(t).length&&(e.ids=t,t.tmdb&&!e.tmdbId&&(e.tmdbId=t.tmdb)),e}function Wt(e){if(e==null||typeof e!="object")return e;if(typeof structuredClone=="function")try{return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}if(Array.isArray(e))return e.map(n=>Wt(n));let t={};for(let n of Object.keys(e))t[n]=Wt(e[n]);return t}function Cn(e){if(!e||typeof e!="object")return null;let t=Wt(e);return t.type==="show"&&(t.type="tv"),t.type||(t.type="movie"),Tn(t),t}function _n(e){if(!e||typeof e!="object")return null;let t=Wt(e);return t.type!=="tv"&&(t.type="tv"),Tn(t),Xr(t),t}function Qu(e){if(!e||typeof e!="object")return null;let t=Wt(e);return Tn(t),Xr(t),t}function ys(e){let t=Array.isArray(e==null?void 0:e.seasons)?e.seasons:[],n=t.some(o=>Array.isArray(o==null?void 0:o.episodes)&&o.episodes.length),r=Array.isArray(e==null?void 0:e.cast)?e.cast:Array.isArray(e==null?void 0:e.roles)?e.roles:[];return!t.length||!n||!r.length}function vs(e,t){if(!e)return e;if(t&&typeof t=="object"){let n=Qu(t);Object.assign(e,n),Tn(e)}return Xr(e),e}function Xr(e){if(!e||typeof e!="object")return;Yr(e),e.genres=Jr(e.genres);let t=nd(e.cast||e.roles||[]);e.cast=t,e.roles=t,e.seasons=Array.isArray(e.seasons)?e.seasons.map(ed).filter(Boolean):[];let n=Number(e.seasonCount);e.seasonCount=Number.isFinite(n)&&n>0?n:e.seasons.length}function ed(e){if(!e||typeof e!="object")return null;let t={...e};return Yr(t),t.genres=Jr(t.genres),t.episodes=Array.isArray(t.episodes)?t.episodes.map(td).filter(Boolean):[],t}function td(e){if(!e||typeof e!="object")return null;let t={...e};return Yr(t),t.genres=Jr(t.genres),t}function Yr(e){ae(e)}function Jr(e){if(!Array.isArray(e))return[];let t=new Set,n=[];return e.forEach(r=>{let o=null;if(typeof r=="string"){let i=r.trim();i&&(o={tag:i})}else if(r&&typeof r=="object"){let i=String(r.tag||r.title||r.name||r.label||"").trim();i&&(o={...r,tag:i})}o&&!t.has(o.tag)&&(t.add(o.tag),n.push(o))}),n}function nd(e){return Array.isArray(e)?e.map(t=>{if(!t)return null;if(typeof t=="string"){let n=t.trim();return n?{tag:n}:null}if(typeof t=="object"){let n=String(t.tag||t.name||t.role||"").trim();return n?{...t,tag:n}:{...t}}return null}).filter(Boolean):[]}var Yu,Ss=M(()=>{rt();Yu={tmdb:["tmdb://","themoviedb://","com.plexapp.agents.themoviedb://"],imdb:["imdb://","com.plexapp.agents.imdb://"],tvdb:["tvdb://","thetvdb://","com.plexapp.agents.thetvdb://"]}});var Es={};et(Es,{DEMO_MOVIE:()=>rd,DEMO_SERIES:()=>od});var rd,od,As=M(()=>{rd={type:"movie",title:"Lumen: Der Aufbruch",tagline:"Eine cineastische Demo f\xFCr das neue Modal",overview:"Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\xFCllt dabei eine Energiequelle, die alles ver\xE4ndern k\xF6nnte. Zwischen Loyalit\xE4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\xFCr das Cinematic-Layout entworfen wurde.",summary:"Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\xE4ndern k\xF6nnte.",runtimeMin:142,contentRating:"FSK 12",studio:"Aurora Pictures",rating:8.4,audienceRating:8,userRating:8.7,originallyAvailableAt:"2024-05-17",countries:[{tag:"Deutschland"},{tag:"Kanada"}],genres:[{tag:"Science-Fiction"},{tag:"Drama"},{tag:"Abenteuer"}],cast:[{name:"Mara Lenz",role:"Captain Alys Vega",tmdbProfile:"/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg"},{name:"Tariq Benassi",role:"Navigator Elian Soh",tmdbProfile:"/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg"},{name:"Hannah Ko",role:"Wissenschaftlerin Dr. Mira Han",tmdbProfile:"/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg"}],directors:[{tag:"Jonas Falk"}],writers:[{tag:"Lea Winter"}],producers:[{tag:"Studio Atlas"}],labels:[{tag:"Dolby Atmos"},{tag:"4K"}],collections:[{tag:"Aurora-Saga"}],trailer:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",tmdbPoster:"https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg",ids:{tmdb:"demo-lumen",imdb:"tt0000001"},addedAt:"2024-06-01T12:00:00Z"},od={type:"tv",title:"Aurora Station",tagline:"Neue Horizonte in Serie",overview:"Die Besatzung der Aurora Station sch\xFCtzt eine Au\xDFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\xE4tsel mit pers\xF6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.",summary:"Ein orbitaler Au\xDFenposten ringt um Hoffnung und Zusammenhalt, w\xE4hrend eine fremde Macht erwacht.",contentRating:"TV-14",studio:"Nebula Network",originallyAvailableAt:"2023-09-14",seasonCount:2,genres:[{tag:"Science-Fiction"},{tag:"Drama"}],countries:[{tag:"USA"},{tag:"Island"}],creators:[{tag:"Elina S\xF8rensen"}],cast:[{name:"Noah Adler",role:"Commander Ivar Hale",tmdbProfile:"/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg"},{name:"Sofia Idris",role:"Ingenieurin Kaia Rhee",tmdbProfile:"/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg"},{name:"Helena Ruiz",role:"Strategin Tala Voss",tmdbProfile:"/ziEuG1ESSofxDCspotYlrwz3Tq.png"}],seasons:[{title:"Staffel 1",seasonNumber:1,year:2023,thumbFile:"https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg",episodes:[{title:"Kapitel Eins: Erwachen",seasonNumber:1,episodeNumber:1,durationMin:54,originallyAvailableAt:"2023-09-14",audienceRating:8.6},{title:"Kapitel Zwei: Grenzwelten",seasonNumber:1,episodeNumber:2,durationMin:52,originallyAvailableAt:"2023-09-21",audienceRating:8.2}]},{title:"Staffel 2",seasonNumber:2,year:2024,thumbFile:"https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg",episodes:[{title:"Kapitel Dreizehn: Resonanz",seasonNumber:2,episodeNumber:1,durationMin:56,originallyAvailableAt:"2024-02-08",audienceRating:8.9},{title:"Kapitel Vierzehn: Echo",seasonNumber:2,episodeNumber:2,durationMin:55,originallyAvailableAt:"2024-02-15",audienceRating:8.7}]}],tmdbPoster:"https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg",ids:{tmdb:"demo-aurora-station",imdb:"tt0000002"}}});function ks(){return Zr||(Zr=Promise.resolve().then(()=>(As(),Es)).catch(e=>({DEMO_MOVIE:null,DEMO_SERIES:null}))),Zr}function id(){if(D)return D;let e=document.getElementById("modal-root-v2");if(!e)return null;if(Ee=e,e.classList.add("modalv2-overlay"),e.hasAttribute("hidden")||e.setAttribute("hidden",""),e.dataset.modalv2Ready||(e.innerHTML=`
      <div class="modalv2-backdrop" data-modalv2-backdrop="1"></div>
      <div class="modalv2-dialog" role="dialog" aria-modal="true">
        <div class="modalv2-scroll" data-modalv2-scroll></div>
      </div>
    `,e.dataset.modalv2Ready="1",e.addEventListener("click",sd)),G=e.querySelector(".modalv2-dialog"),G&&!G.hasAttribute("tabindex")&&G.setAttribute("tabindex","-1"),xe=e.querySelector("[data-modalv2-scroll]"),xe&&!D){let t=xe.querySelector(".modalv2");t?D=t:(D=document.createElement("div"),D.className="modalv2",D.setAttribute("hidden",""),xe.appendChild(D))}return D}function sd(e){if(!Ee)return;let t=e.target;(t===Ee||t&&t.dataset&&t.dataset.modalv2Backdrop)&&eo()}function Ts(){return G?Array.from(G.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(t=>t.hasAttribute("disabled")||t.getAttribute("aria-hidden")==="true"||t.hasAttribute("hidden")?!1:t.offsetParent!==null):[]}function ad(){G&&(Ue&&G.removeEventListener("keydown",Ue),Ue=e=>{if(e.key!=="Tab")return;let t=Ts();if(!t.length)return;let n=t[0],r=t[t.length-1];e.shiftKey?document.activeElement===n&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),n.focus())},G.addEventListener("keydown",Ue))}function cd(){!G||!Ue||(G.removeEventListener("keydown",Ue),Ue=null)}function ld(){ht||(ht=e=>{e.key==="Escape"&&(e.preventDefault(),eo())},window.addEventListener("keydown",ht))}function ud(){ht&&(window.removeEventListener("keydown",ht),ht=null)}function In(){let e=id();return!e||!Ee?null:(Ee.hidden=!1,Ee.setAttribute("aria-hidden","false"),document.body.classList.add("modalv2-open"),xe&&(xe.scrollTop=0),ad(),ld(),e)}function Qr(){if(!G)return;let e=G.querySelector("#v2Close"),t=Ts(),n=e&&!e.hasAttribute("hidden")?e:t[0];if(n||(n=G),n){let r=()=>{try{n.focus()}catch{}};(window.requestAnimationFrame||setTimeout)(r,0)}}function Vt(e,t){let n=e,r=t;n instanceof HTMLElement||(r=e,n=null);let o=n instanceof HTMLElement?n:D;if(!o)return;let i=o.querySelector("[data-head-status]");if(!i)return;if(!r){i.hidden=!0,i.textContent="",i.dataset.state="";return}let{state:s="",message:a=""}=r;i.dataset.state=s||"",i.textContent=a||"",i.hidden=!a}function dd(e="Details werden geladen \u2026"){let t=In();if(!t)return;t.hidden=!1;let n=document.createElement("div");n.className="modalv2-loading",n.textContent=String(e||"Details werden geladen \u2026"),t.replaceChildren(n)}function Cs(e){let t=In();if(!t)return;t.hidden=!1;let n=(e==null?void 0:e.type)==="tv";t.innerHTML=`
    <section class="v2-layout">
      <aside class="v2-side">
        <div class="v2-poster"><img alt=""></div>
        <div class="v2-facts" aria-label="Schnellinfos" hidden>
          <h3 class="v2-facts-title">Schnellinfos</h3>
          <dl class="v2-facts-list"></dl>
        </div>
      </aside>
      <div class="v2-info">
        <header class="v2-head" data-tmdb-section>
          <div class="v2-head-visual" data-head-visual>
            <div class="v2-head-hero" data-head-hero>
              <div class="v2-head-backdrop" data-head-backdrop></div>
              <div class="v2-head-overlay-logo" data-head-overlay-logo hidden></div>
              <div class="v2-head-overlay-meta" data-head-overlay-meta hidden></div>
            </div>
            <div class="v2-head-logo" data-head-logo hidden></div>
          </div>
          <p class="v2-head-status" data-head-status hidden aria-live="polite" aria-atomic="true"></p>
          <div class="v2-titlebar">
            <div class="v2-title-wrap">
              <h2 class="v2-title" id="modalV2Title"></h2>
              <div class="v2-subline"></div>
              <div class="v2-meta"></div>
            </div>
            <div class="v2-actions" aria-label="Externe Aktionen">
              <button class="v2-icon-btn" id="v2Close" type="button" aria-label="Schlie\xDFen">
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M6 6l12 12M6 18L18 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                </svg>
              </button>
              <a class="v2-icon-btn" id="v2Tmdb" target="_blank" rel="noopener noreferrer" aria-label="Auf TMDB \xF6ffnen" hidden>
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"></path>
                  <path d="M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </a>
              <a class="v2-icon-btn" id="v2Imdb" target="_blank" rel="noopener noreferrer" aria-label="Auf IMDb \xF6ffnen" hidden>
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"></path>
                </svg>
              </a>
              <button class="v2-icon-btn" id="v2Trailer" type="button" aria-label="Trailer abspielen" hidden>
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M9 6l8 6-8 6V6z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round" stroke-linecap="round"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="v2-chips" aria-label="Attribute"></div>
        </header>
        <nav class="v2-tabs" aria-label="Details Navigation" role="tablist">
          <button type="button" data-t="overview" class="active" id="v2TabOverview" role="tab" aria-controls="v2PaneOverview" aria-selected="true">\xDCberblick</button>
          <button type="button" data-t="details" id="v2TabDetails" role="tab" aria-controls="v2PaneDetails" aria-selected="false">Details</button>
          ${n?'<button type="button" data-t="seasons" id="v2TabSeasons" role="tab" aria-controls="v2PaneSeasons" aria-selected="false">Staffeln</button>':""}
          <button type="button" data-t="cast" id="v2TabCast" role="tab" aria-controls="v2PaneCast" aria-selected="false">Cast</button>
        </nav>
        <section class="v2-body">
          <div class="v2-pane v2-overview" data-pane="overview" id="v2PaneOverview" role="tabpanel" aria-labelledby="v2TabOverview"></div>
          <div class="v2-pane v2-details" data-pane="details" id="v2PaneDetails" role="tabpanel" aria-labelledby="v2TabDetails" hidden></div>
          ${n?'<div class="v2-pane v2-seasons" data-pane="seasons" id="v2PaneSeasons" role="tabpanel" aria-labelledby="v2TabSeasons" hidden></div>':""}
          <div class="v2-pane v2-cast" data-pane="cast" id="v2PaneCast" role="tabpanel" aria-labelledby="v2TabCast" hidden></div>
        </section>
        <footer class="v2-footer" aria-label="Produktionslogos & Attribution" hidden>
          <div class="v2-footer-logos" aria-label="Produktionsfirmen und Netzwerke"></div>
          <p class="v2-footer-note"></p>
        </footer>
      </div>
    </section>
  `,Mr(t,e),qr(t,e),Nr(t,e),Br(t,e),(e==null?void 0:e.type)==="tv"&&fs(t,e),Vr(t,Wr(e)),dt(t,!1),ft(t,null),Vt(t,null),_i(t);let r=t.querySelector("#v2Close");r&&r.addEventListener("click",eo),G&&G.setAttribute("aria-labelledby","modalV2Title"),Qr()}function ws(e){let t=D;t&&(Mr(t,e),qr(t,e),Nr(t,e),Br(t,e),Vr(t,Wr(e)))}function _s(e,t,n){if(!fd(t))return;if(t!=null&&t.tmdbDetail){ws(t);return}let r=Is(t);if(!r)return;let o=n!=null?n:ce;Vt({state:"loading",message:"TMDB-Daten werden geladen \u2026"}),dt(D,!0),ft(D,{state:"loading",message:"Cast wird angereichert \u2026"}),(e==="tv"?is:os)(r).then(s=>{if(o!==ce)return;if(!s){Vt({state:"error",message:"Keine zus\xE4tzlichen TMDB-Daten gefunden."}),dt(D,!1),ft(D,null);return}let a=hd(t,s);a&&(Ge=a,ws(a)),Vt(null),dt(D,!1),ft(D,null)}).catch(s=>{var c,l;if(o!==ce)return;let a="TMDB-Daten konnten nicht geladen werden.";(s==null?void 0:s.status)===429?a="TMDB-Rate-Limit erreicht. Bitte versuchen Sie es sp\xE4ter erneut.":(s==null?void 0:s.status)===404?a="Inhalt nicht in TMDB gefunden.":((c=s==null?void 0:s.message)!=null&&c.includes("network")||(l=s==null?void 0:s.message)!=null&&l.includes("fetch"))&&(a="Netzwerkfehler. Bitte \xFCberpr\xFCfen Sie Ihre Verbindung."),Vt({state:"error",message:a}),dt(D,!1),ft(D,{state:"error",message:"Zus\xE4tzliche Besetzung konnte nicht geladen werden."})})}function fd(e){var t;return!(!e||!((t=window==null?void 0:window.FEATURES)!=null&&t.tmdbEnrichment)||!gd()||!Is(e))}function gd(){try{let t=localStorage.getItem("tmdbToken");if(t&&t.trim())return!0}catch{}let e=I().cfg||{};return!!(e.tmdbToken||e.tmdbApiKey)}function Is(e){var n;return e&&((e.ids||{}).tmdb||e.tmdbId||((n=e==null?void 0:e.tmdb)==null?void 0:n.id))||""}function hd(e,t){if(!e||!t)return e;let n={...e};return n.tmdbDetail=t,n.tmdb={...e.tmdb||{}},t.poster&&!n.tmdb.poster&&(n.tmdb.poster=t.poster),t.backdrop&&!n.tmdb.backdrop&&(n.tmdb.backdrop=t.backdrop),t.url&&(n.tmdb.url=t.url),n.ids={...e.ids||{}},t.id&&(n.ids.tmdb=String(t.id)),t.imdbId&&!n.ids.imdb&&(n.ids.imdb=String(t.imdbId)),n}async function mt(e){let t=++ce;gt=document.activeElement instanceof HTMLElement?document.activeElement:null;let n=In();if(!n)return;let r=await md(e);if(t===ce){if(!r){n.hidden=!1;let o=document.createElement("div");o.className="modalv2-loading",o.textContent="Film konnte nicht geladen werden.",n.replaceChildren(o),Ge=null,Xt=null,Qr();return}Ge=r,Xt="movie",Cs(r),_s("movie",r,t)}}async function pt(e){let t=++ce;gt=document.activeElement instanceof HTMLElement?document.activeElement:null;let n=await pd(e),r=In();if(!r||t!==ce)return;if(!n){r.hidden=!1;let i=document.createElement("div");i.className="modalv2-loading",i.textContent="Seriendetails konnten nicht geladen werden.",r.replaceChildren(i),Ge=null,Xt=null,Qr();return}Ge=n,Xt="show";let o=n;if(ys(o)){if(dd(),t!==ce)return;let i=null;try{i=await mi(o)}catch{i=null}if(t!==ce)return;i&&(vs(o,i),Ge=o)}t===ce&&(Cs(o),_s("tv",o,t))}function eo(){if(ce++,!!Ee){if(Ee.hidden=!0,Ee.setAttribute("aria-hidden","true"),document.body.classList.remove("modalv2-open"),cd(),ud(),D&&(D.innerHTML="",D.setAttribute("hidden","")),xe&&(xe.scrollTop=0),gt&&typeof gt.focus=="function")try{gt.focus()}catch{}gt=null,Ge=null,Xt=null}}async function md(e){if(e==="demo"){let{DEMO_MOVIE:i}=await ks();return Cn(i)}if(e&&typeof e=="object")return Cn(e);let t=e==null?"":String(e).trim();if(!t)return null;let n=I(),o=(Array.isArray(n==null?void 0:n.movies)?n.movies:[]).find(i=>xs(i,t));return o?Cn(o):null}async function pd(e){if(e==="demo"){let{DEMO_SERIES:i}=await ks();return _n(i)}if(e&&typeof e=="object")return _n(e);let t=e==null?"":String(e).trim();if(!t)return null;let n=I(),o=(Array.isArray(n==null?void 0:n.shows)?n.shows:[]).find(i=>xs(i,t));return o?_n(o):null}function xs(e,t){var r,o;if(!e)return!1;let n=String(t||"").trim();return n?!!((r=e==null?void 0:e.ids)!=null&&r.imdb&&String(e.ids.imdb)===n||(o=e==null?void 0:e.ids)!=null&&o.tmdb&&String(e.ids.tmdb)===n||(e==null?void 0:e.ratingKey)!=null&&String(e.ratingKey)===n):!1}var Ee,G,xe,D,gt,Ue,ht,ce,Xt,Ge,Zr,xn=M(()=>{Ii();Lr();Ni();Pi();gs();hs();bs();Y();rt();Ss();ut();Ee=null,G=null,xe=null,D=null,gt=null,Ue=null,ht=null,ce=0,Xt=null,Ge=null,Zr=null});function yd(){}function Fn(e){let t=parseFloat(e);return Number.isFinite(t)?t:0}var Fs,bd,Mn,Ms=M(()=>{Fs=typeof requestAnimationFrame=="function"?requestAnimationFrame:e=>setTimeout(e,16),bd=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:e=>clearTimeout(e);Mn=class{constructor({container:t,renderItem:n,getKey:r=yd,updateItem:o=null,getSignature:i=null,overscan:s=2,estimatedItemHeight:a=420,minItemWidth:c=190}){if(!t)throw new Error("VirtualList requires a container element");if(typeof n!="function")throw new Error("VirtualList requires a renderItem function");this.container=t,this.renderItem=n,this.getKey=r,this.updateItem=typeof o=="function"?o:null,this.getSignature=typeof i=="function"?i:null,this.overscan=Math.max(0,s|0),this.estimatedItemHeight=a,this.minItemWidth=c,this.items=[],this.range={start:0,end:0},this.columns=1,this.rowCount=0,this.rowHeight=this.estimatedItemHeight,this.totalHeight=0,this.itemHeight=this.estimatedItemHeight,this.containerTop=0,this.paddingTop=0,this.paddingBottom=0,this.gapY=0,this.gapX=0,this.metricsDirty=!0,this.pendingFrame=0,this.lastWidth=0,this.nodeCache=new Map,this.renderedKeys=new Set,this.itemSignatures=new Map,this.scrollTicking=!1,this.spacer=document.createElement("div"),this.spacer.className="grid-virtual__spacer",this.windowEl=document.createElement("div"),this.windowEl.className="grid-virtual__window",this.itemsHost=document.createElement("div"),this.itemsHost.className="grid-virtual__items",this.container.textContent="",this.windowEl.append(this.itemsHost),this.container.append(this.spacer,this.windowEl),this.measureRoot=document.createElement("div"),this.measureRoot.className="grid-virtual__measure",this.measureRoot.setAttribute("aria-hidden","true"),Object.assign(this.measureRoot.style,{position:"absolute",visibility:"hidden",pointerEvents:"none",inset:"0 auto auto 0",zIndex:"-1"}),this.container.append(this.measureRoot),this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.update=this.update.bind(this),window.addEventListener("scroll",this.handleScroll,{passive:!0}),window.addEventListener("resize",this.handleResize),typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.container)):this.resizeObserver=null}destroy(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),this.resizeObserver&&this.resizeObserver.disconnect(),this.pendingFrame&&(bd(this.pendingFrame),this.pendingFrame=0),this.nodeCache.clear(),this.renderedKeys.clear(),this.itemSignatures.clear(),this.items=[],this.spacer.remove(),this.windowEl.remove(),this.measureRoot.remove()}schedule(t=!1){t&&(this.metricsDirty=!0),!this.pendingFrame&&(this.pendingFrame=Fs(()=>{this.pendingFrame=0,this.update()}))}handleScroll(){this.scrollTicking||(this.scrollTicking=!0,this.schedule(!1),Fs(()=>{this.scrollTicking=!1}))}handleResize(){let t=this.container.clientWidth;t!==this.lastWidth&&(this.metricsDirty=!0,this.lastWidth=t),this.schedule(!0)}setItems(t){this.items=Array.isArray(t)?t.slice():[],this.metricsDirty=!0,this.pruneCache(),this.measureItems(),this.update()}measureItems(){if(!this.items.length){this.itemHeight=this.estimatedItemHeight;return}let t=this.items[0];this.measureRoot.textContent="";let n=this.renderItem(t,0);if(n instanceof HTMLElement)if(this.measureRoot.append(n),typeof n.getBoundingClientRect=="function"){let r=n.getBoundingClientRect();r&&r.height>0&&(this.itemHeight=r.height)}else n.offsetHeight&&(this.itemHeight=n.offsetHeight);this.measureRoot.textContent=""}pruneCache(){if(!this.items.length){this.nodeCache.forEach(r=>r.remove()),this.nodeCache.clear(),this.itemSignatures.clear(),this.renderedKeys.clear();return}let t=new Set,n=this.getSignature?new Map:null;this.items.forEach((r,o)=>{let i=this.keyFor(r,o);if(t.add(i),n){let s=this.signatureFor(r,o);n.set(i,s);let a=this.itemSignatures.get(i);if(a!==void 0&&a!==s){let c=this.nodeCache.get(i);c&&(c.parentNode&&c.parentNode.removeChild(c),this.nodeCache.delete(i),this.renderedKeys.delete(i))}}}),this.nodeCache.forEach((r,o)=>{t.has(o)||(r.parentNode&&r.parentNode.removeChild(r),this.nodeCache.delete(o),this.renderedKeys.delete(o))}),n?this.itemSignatures=n:this.itemSignatures.clear()}keyFor(t,n){let r=this.getKey?this.getKey(t,n):null;return r==null||r===""?`index-${n}`:String(r)}signatureFor(t,n){if(this.getSignature)try{return this.getSignature(t,n)}catch{return}}refreshMetrics(){let t=getComputedStyle(this.container);this.paddingTop=Fn(t.paddingTop),this.paddingBottom=Fn(t.paddingBottom);let n=getComputedStyle(this.itemsHost),r=n.getPropertyValue?n.getPropertyValue("row-gap"):n.rowGap,o=n.getPropertyValue?n.getPropertyValue("column-gap"):n.columnGap,i=n.getPropertyValue?n.getPropertyValue("gap"):n.gap;this.gapY=Fn(r||i),this.gapX=Fn(o||i);let s=Math.floor((this.container.clientWidth+this.gapX)/(this.minItemWidth+this.gapX));this.columns=Math.max(1,s||1),this.rowHeight=this.itemHeight+this.gapY,this.rowHeight<=0&&(this.rowHeight=this.itemHeight||this.estimatedItemHeight),this.rowCount=this.columns>0?Math.ceil(this.items.length/this.columns):this.items.length,this.totalHeight=Math.max(0,this.rowCount*this.rowHeight),this.updateContainerPosition(),this.spacer.style.height=`${this.totalHeight}px`,this.windowEl.style.top=`${this.paddingTop}px`,this.windowEl.style.paddingBottom=`${this.paddingBottom}px`,this.metricsDirty=!1}updateContainerPosition(){let t=this.container,n=0;for(;t&&t!==document.body;)n+=t.offsetTop,t=t.offsetParent;this.containerTop=n}update(){this.metricsDirty&&this.refreshMetrics(),this.syncVisibleRange()}syncVisibleRange(){if(!this.items.length){this.windowEl.style.transform="translate3d(0, 0, 0)",this.itemsHost.replaceChildren(),this.range={start:0,end:0};return}let t=window.scrollY,n=t+window.innerHeight,r=this.containerTop+this.paddingTop,o=r+this.totalHeight;window.__VLIST_DEBUG;let i;t<=r?i=0:t>=o?i=Math.max(0,this.rowCount-1):i=Math.floor((t-r)/this.rowHeight);let s;n>=o?s=Math.max(0,this.rowCount-1):n<=r?s=0:s=Math.ceil((n-r)/this.rowHeight),i=Math.max(0,Math.min(i,Math.max(0,this.rowCount-1))-this.overscan),s=Math.min(Math.max(0,this.rowCount-1),s+this.overscan);let a=Math.max(0,Math.min(this.items.length,i*this.columns)),c=Math.max(a,Math.min(this.items.length,(s+1)*this.columns));if(a===this.range.start&&c===this.range.end){let p=!1;for(let m=a;m<c;m++){let b=this.keyFor(this.items[m],m);if(!this.renderedKeys.has(b)){p=!0;break}}if(!p)return}this.range={start:a,end:c};let u=Math.floor(a/this.columns)*this.rowHeight;this.windowEl.style.transform=`translate3d(0, ${u}px, 0)`;let d=new Set,h=[];for(let p=a;p<c;p++){let m=this.items[p],b=this.keyFor(m,p),S=this.nodeCache.get(b);if(S){if(this.updateItem){let k=this.updateItem(S,m,p);if(k instanceof HTMLElement&&k!==S)S=k,this.nodeCache.set(b,S);else if(!(k instanceof HTMLElement))continue}}else{if(S=this.renderItem(m,p),!(S instanceof HTMLElement))continue;this.nodeCache.set(b,S)}d.add(b),h.push(S)}let f=this.itemsHost.children;if(f.length===h.length){let p=!0;for(let m=0;m<h.length;m++)if(f[m]!==h[m]){p=!1;break}if(p){this.renderedKeys=d;return}}let g=new Map;for(let p=0;p<f.length;p++)g.set(f[p],p);for(let p=0;p<h.length;p++){let m=h[p],b=f[p];b!==m&&(g.has(m)?this.itemsHost.insertBefore(m,b||null):this.itemsHost.insertBefore(m,b||null))}for(;this.itemsHost.children.length>h.length;)this.itemsHost.lastChild.remove();this.renderedKeys=d}}});var js={};et(js,{renderGrid:()=>ee});function vd(e){let t=H("article","card");t.dataset.kind=(e==null?void 0:e.type)==="tv"?"show":"movie",t.tabIndex=0,t.setAttribute("role","button"),e!=null&&e.title&&t.setAttribute("aria-label",e.title);let n=H("div","card__media"),r=new Image;r.loading="lazy",r.decoding="async",r.className="card__img",r.alt=(e==null?void 0:e.title)||"",r.style.aspectRatio="2 / 3";let o=Nn(e);o&&(r.src=o);let i=H("div","card__media-gradient");i.setAttribute("aria-hidden","true");let s=Id(e),a=H("div","card__badges");s.forEach(b=>{b instanceof HTMLElement&&a.append(b)}),n.append(r,i),a.childElementCount&&n.append(a);let c=Os(e);if(c>0){let b=H("div","card__progress"),S=document.createElement("span");S.style.width=`${Math.max(0,Math.min(100,c))}%`,b.append(S),n.append(b)}let l=H("div","card__body"),u=document.createElement("h3");u.className="card__title",u.textContent=(e==null?void 0:e.title)||"",e!=null&&e.title&&u.setAttribute("title",e.title);let d=H("div","card__meta"),h=Ds(e);d.textContent=h.join(" \u2022 "),l.append(u,d);let f=H("div","card__actions"),g=H("div","card__chips"),p=be(e==null?void 0:e.genres);bn(g,p,3);let m=document.createElement("button");return m.type="button",m.className="card__primary",Ns(m,e),m.addEventListener("click",b=>{b.stopPropagation(),Tr(e),Ns(m,e)}),f.append(g,m),t.append(n,l,f),t.addEventListener("click",()=>Ps(e)),t.addEventListener("keydown",b=>{b.target===t&&(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),Ps(e))}),t}function Sd(e,t){let n=(t||[]).slice().sort((d,h)=>{let f=Number(U(d))||0,g=Number(U(h))||0;return f!==g?f-g:(d.title||"").localeCompare(h.title||"","de")}),r=n.map(d=>Number(U(d))||0).filter(Boolean),o=r.length?Math.min(...r):"",i=n.map(d=>new Date(d.addedAt||0).getTime()).filter(Number.isFinite),s=i.length?new Date(Math.max(...i)).toISOString():null,a=n.map(d=>{var h;return Number((h=d.rating)!=null?h:d.audienceRating)}).filter(Number.isFinite),c=a.length?a.reduce((d,h)=>d+h,0)/a.length:null,l=n.find(d=>d.thumbFile)||n[0]||null,u=Array.from(new Set(n.flatMap(d=>be(d.genres)))).slice(0,4);return{isCollectionGroup:!0,type:"collection",title:e,collectionName:e,items:n,itemCount:n.length,year:o||"",addedAt:s,rating:c,posterItem:l,genres:u}}function Ed(e){let t=document.getElementById("groupCollections"),n=document.getElementById("collectionFilter"),r=n&&n.value;if(!t||!t.checked||r)return e;let o=new Map;e.forEach(s=>{$e(s).forEach(a=>{o.has(a)||o.set(a,[]),o.get(a).push(s)})});let i=[];return o.forEach((s,a)=>{i.push(Sd(a,s))}),i.sort((s,a)=>s.title.localeCompare(a.title,"de")),i}function Ad(e){let t=H("article","card card--collection");t.dataset.kind="collection",t.tabIndex=0,t.setAttribute("role","button"),e!=null&&e.title&&t.setAttribute("aria-label",e.title);let n=H("div","card__media"),r=e.posterItem||{},o=new Image;o.loading="lazy",o.decoding="async",o.className="card__img",o.alt=(e==null?void 0:e.title)||"",o.style.aspectRatio="2 / 3";let i=Nn(r);i&&(o.src=i);let s=H("div","card__media-gradient");s.setAttribute("aria-hidden","true");let a=xd(e),c=H("div","card__badges");a.forEach(p=>{p instanceof HTMLElement&&c.append(p)}),n.append(o,s),c.childElementCount&&n.append(c);let l=H("div","card__body"),u=document.createElement("h3");u.className="card__title",u.textContent=e.title||"",e!=null&&e.title&&u.setAttribute("title",e.title);let d=H("div","card__meta"),h=zs(e);d.textContent=h.filter(Boolean).join(" \u2022 "),l.append(u,d);let f=H("div","card__actions"),g=H("div","card__chips");return bn(g,e.genres||[],3),f.append(g),t.append(n,l,f),t.addEventListener("click",()=>{let p=document.getElementById("collectionFilter");p&&(p.value=e.collectionName||e.title||"",p.dispatchEvent(new Event("change",{bubbles:!0})))}),t.addEventListener("keydown",p=>{if(p.target===t&&(p.key==="Enter"||p.key===" ")){p.preventDefault();let m=document.getElementById("collectionFilter");m&&(m.value=e.collectionName||e.title||"",m.dispatchEvent(new Event("change",{bubbles:!0})))}}),t}function wd(e){return Ln||(Ln=new Mn({container:e,overscan:1,estimatedItemHeight:460,minItemWidth:190,getKey:kd,getSignature:ro,renderItem(t){return Bs(t)},updateItem(t,n){return Td(t,n)}}),Ln)}function kd(e,t){if(e!=null&&e.isCollectionGroup){let r=e.collectionName||e.title||"";return r?`collection:${r}`:`collection-index-${t}`}let n=no(e);return n?`item:${n}`:`item-index-${t}`}function Bs(e){let t=e!=null&&e.isCollectionGroup?Ad(e):vd(e);return t instanceof HTMLElement&&(t[to]=ro(e)),t}function Td(e,t){if(e instanceof HTMLElement){let r=ro(t);if(e[to]===r)return e[to]=r,e}let n=Bs(t);return n instanceof HTMLElement?Nd(e,n):e}function ee(e){let{movies:t,shows:n,filtered:r}=I(),o=(e==="shows"?n:t)||[],i=Array.isArray(r)?r:o,s=Ed(i),a=document.getElementById("grid");if(!a)return;let c=Ls!==e;Ls=e,c&&Cd(a),wd(a).setItems(s),c&&_d(a);let u=document.getElementById("empty");u&&(u.hidden=s.length>0),a.setAttribute("aria-busy","false")}function Cd(e){e&&(e.classList.remove("is-entering","is-ready"),e.classList.add("is-leaving"))}function _d(e){e&&(e.classList.remove("is-leaving"),e.classList.add("is-entering"),requestAnimationFrame(()=>{e.classList.add("is-ready"),setTimeout(()=>e.classList.remove("is-entering","is-ready"),240)}))}function Nn(e){var r;if(!e)return"";let t=yn()&&(((r=e==null?void 0:e.tmdb)==null?void 0:r.poster)||(e==null?void 0:e.tmdbPoster)),n=(e==null?void 0:e.thumbFile)||(e==null?void 0:e.poster)||(e==null?void 0:e.art)||(e==null?void 0:e.thumb)||"";return t||n||""}function Rs(e){var o;let t=[];De(e)&&t.push("Neu");let n=String((e==null?void 0:e.contentRating)||"").trim();n&&t.push(n);let r=Number((o=e==null?void 0:e.rating)!=null?o:e==null?void 0:e.audienceRating);return Number.isFinite(r)&&t.push(`\u2605 ${q(r)}`),t.slice(0,3)}function Id(e){return Rs(e).map($s)}function Hs(e){let t=[];return Number.isFinite(e==null?void 0:e.itemCount)&&e.itemCount>0&&t.push(`${e.itemCount} Titel`),e!=null&&e.year&&t.push(String(e.year)),t}function xd(e){return Hs(e).map($s)}function $s(e){let t=document.createElement("span");return t.className="badge",t.textContent=String(e||""),t}function Ns(e,t){if(!e)return;let n=kr(t);e.textContent=n?"Gemerkt":"Merken",e.classList.toggle("active",n),e.setAttribute("aria-pressed",n?"true":"false")}function Ds(e){var s;let t=[],n=U(e);n&&t.push(String(n));let r=Fd(e);r&&t.push(r);let o=Number((s=e==null?void 0:e.rating)!=null?s:e==null?void 0:e.audienceRating);Number.isFinite(o)&&t.push(`\u2605 ${q(o)}`);let i=(e==null?void 0:e.studio)||(e==null?void 0:e.network)||"";return i&&t.push(i),t}function zs(e){let t=[];e!=null&&e.year&&t.push(String(e.year));let n=Number(e==null?void 0:e.itemCount);Number.isFinite(n)&&t.push(`${n} Titel`);let r=Number(e==null?void 0:e.rating);return Number.isFinite(r)&&t.push(`\u2605 ${q(r)}`),t}function Fd(e){var r,o;let t=(o=(r=e==null?void 0:e.runtimeMin)!=null?r:e==null?void 0:e.durationMin)!=null?o:e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null,n=Number(t);return!Number.isFinite(n)||n<=0?"":(e==null?void 0:e.type)==="tv"?`~${n} min/Ep`:`${n} min`}function Os(e){var r;let t=Number((r=e==null?void 0:e.viewOffset)!=null?r:e==null?void 0:e.viewoffset),n=Number(e==null?void 0:e.duration);return!Number.isFinite(t)||!Number.isFinite(n)||n<=0?0:Math.max(1,Math.min(100,Math.round(t/n*100)))}function no(e){var n,r;if(!e)return"";let t=((n=e==null?void 0:e.ids)==null?void 0:n.imdb)||((r=e==null?void 0:e.ids)==null?void 0:r.tmdb);return t?String(t):e!=null&&e.ratingKey?String(e.ratingKey):""}function ro(e){return e!=null&&e.isCollectionGroup?Ld(e):Md(e)}function Md(e){let t=be(e==null?void 0:e.genres).slice(0,3),n=Rs(e),r=Ds(e);return JSON.stringify({id:no(e),title:(e==null?void 0:e.title)||"",poster:Nn(e),badges:n,meta:r,progress:Os(e),watch:kr(e),genres:t})}function Ld(e){let t=(e==null?void 0:e.posterItem)||null,n=Array.isArray(e==null?void 0:e.genres)?e.genres.slice(0,3).map(String):[],r=Hs(e),o=zs(e),i=Number(e==null?void 0:e.itemCount),s=Number(e==null?void 0:e.rating);return JSON.stringify({name:(e==null?void 0:e.collectionName)||(e==null?void 0:e.title)||"",title:(e==null?void 0:e.title)||"",itemCount:Number.isFinite(i)?i:null,year:(e==null?void 0:e.year)||"",rating:Number.isFinite(s)?s:null,poster:Nn(t),badges:r,meta:o,genres:n})}function Nd(e,t){if(!(t instanceof HTMLElement))return e;if(!(e instanceof HTMLElement))return t;let n=e.parentNode,r=document.activeElement===e;return n&&n.replaceChild(t,e),r&&typeof t.focus=="function"&&requestAnimationFrame(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}}),t}function Pd(e,t){if(!e||!t)return;let n=`#/${e}/${t}`,r=(window.location.hash||"")===n;Bn(n,{silent:!0,replace:r})}function Ps(e){if(!e)return;let t=(e==null?void 0:e.type)==="tv"?"show":"movie",n=no(e);n&&Pd(t,n),t==="show"?pt(e):mt(e)}var to,Ln,Ls,Pn=M(()=>{Y();cn();ye();_r();xn();Ks();Ms();to="__gridVirtualSignature";Ln=null;Ls=null});var fo={};et(fo,{applyFilters:()=>bt,computeFacets:()=>ao,initFilters:()=>uo,renderFacets:()=>co,setFiltersUpdatedHandler:()=>lo,updateFiltersAndGrid:()=>Yt});function Us(e){return String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Bd(e,t){let n=Us(t.query||""),r=!!t.onlyNew,o=Number(t.yearFrom)||null,i=Number(t.yearTo)||null,s=t.genres||new Set,a=t.collection||"";if(n&&!Us([e.title,e.originalTitle,e.summary,e.studio,be(e.genres).join(" "),(e.roles||[]).map(u=>u&&(u.tag||u.role||u.name)).join(" "),$e(e).join(" ")].filter(Boolean).join(" ")).includes(n)||r&&!De(e))return!1;let c=Number(U(e))||null;if(o&&(!c||c<o)||i&&(!c||c>i))return!1;if(s.size){let l=new Set(be(e.genres));for(let u of s)if(!l.has(u))return!1}return!(a&&!new Set($e(e)).has(a))}function Rd(e,t){let n=e.slice();switch(t){case"year-desc":n.sort((r,o)=>(Number(U(o))||0)-(Number(U(r))||0)||String(r.title||"").localeCompare(String(o.title||""),"de"));break;case"year-asc":n.sort((r,o)=>(Number(U(r))||0)-(Number(U(o))||0)||String(r.title||"").localeCompare(String(o.title||""),"de"));break;case"title-desc":n.sort((r,o)=>String(o.title||"").localeCompare(String(r.title||""),"de"));break;case"added-desc":n.sort((r,o)=>new Date(o.addedAt||0)-new Date(r.addedAt||0));break;case"title-asc":default:n.sort((r,o)=>String(r.title||"").localeCompare(String(o.title||""),"de"))}return n}function ao(e,t){let n=new Set,r=new Set,o=new Set,i=a=>(a||[]).forEach(c=>{be(c.genres).forEach(u=>n.add(u));let l=c.year||(c.originallyAvailableAt?String(c.originallyAvailableAt).slice(0,4):"");l&&r.add(Number(l)),$e(c).forEach(u=>o.add(u))});i(e),i(t);let s=[...r].sort((a,c)=>a-c);return{genres:[...n].sort(),years:s,collections:[...o].sort((a,c)=>a.localeCompare(c,"de"))}}function co(e){let t=K("#yearFrom"),n=K("#yearTo");t&&t.replaceChildren(new Option("Ab Jahr",""),...e.years.map(i=>new Option(String(i),String(i)))),n&&n.replaceChildren(new Option("Bis Jahr",""),...e.years.map(i=>new Option(String(i),String(i))));let r=K("#collectionFilter");r&&r.replaceChildren(new Option("Alle Collections",""),...e.collections.map(i=>new Option(i,i)));let o=K("#genreFilters");if(o){let i=e.genres.map(s=>{let a=document.createElement("button");return a.type="button",a.className="chip",a.textContent=s,a.dataset.name=s,a});o.replaceChildren(...i),so()}}function Hd(){var c,l,u,d,h;let e=document.getElementById("search")||document.getElementById("q"),t=((e==null?void 0:e.value)||"").trim(),n=((c=K("#onlyNew"))==null?void 0:c.checked)||!1,r=((l=K("#yearFrom"))==null?void 0:l.value)||"",o=((u=K("#yearTo"))==null?void 0:u.value)||"",i=((d=K("#collectionFilter"))==null?void 0:d.value)||"",s=((h=K("#sort"))==null?void 0:h.value)||"title-asc",a=new Set;return document.querySelectorAll("#genreFilters .chip.active").forEach(f=>a.add(f.dataset.name)),{query:t,onlyNew:n,yearFrom:r,yearTo:o,collection:i,genres:a,sort:s}}function bt(){let e=I(),n=e.view==="shows"?e.shows:e.movies,r=Hd(),o=(n||[]).filter(s=>Bd(s,r)),i=Rd(o,r.sort);return Pe({filtered:i}),i}function $d(){oo||(oo=Promise.resolve().then(()=>(Pn(),js))),oo.then(e=>{let t=e&&e.renderGrid;typeof t=="function"&&t(I().view)}).catch(console.error)}function lo(e){io=typeof e=="function"?e:null}function Yt(){let e=bt();if($d(),io)try{let t=Array.isArray(e)?e.slice():[];io(t,I().view)}catch{}return e}function so(){let e=document.getElementById("genreFilters");if(!e)return;let t=e.querySelectorAll(".chip.active").length;e.dataset.state=t>0?"active":"empty",e.dataset.count=String(t)}function uo(){let e=K("#sort");e&&e.options.length===0&&[["title-asc","Titel A\u2013Z"],["title-desc","Titel Z\u2013A"],["year-desc","Jahr \u2193"],["year-asc","Jahr \u2191"],["added-desc","Zuletzt hinzugef\xFCgt"]].forEach(([o,i])=>e.add(new Option(i,o)));let t=(o,i="input")=>{let s=K(o);s&&(s.addEventListener(i,()=>{Yt()}),i==="input"&&s instanceof HTMLInputElement&&s.type==="search"&&s.addEventListener("search",()=>{Yt()}))};t("#search"),t("#q"),t("#onlyNew","change"),t("#yearFrom","change"),t("#yearTo","change"),t("#collectionFilter","change"),t("#sort","change"),t("#groupCollections","change");let n=K("#yearReset");n&&n.addEventListener("click",()=>{let o=K("#yearFrom"),i=K("#yearTo");o&&(o.value=""),i&&(i.value=""),Yt()});let r=K("#genreFilters");r&&(r.addEventListener("click",o=>{let i=o.target;i instanceof HTMLElement&&i.classList.contains("chip")&&(i.classList.toggle("active"),so(),Yt())}),so())}var oo,io,go=M(()=>{Y();cn();ye();oo=null;io=null});var yt={};et(yt,{clearCache:()=>Od,hydrateOptional:()=>Hn,validateToken:()=>qd});function re(...e){try{}catch{}}function Vs(e={}){let t=e.lang||e.language||"de-DE",n=e.region||e.iso||"DE",r=Number(e.ttlHours||e.tmdbTtlHours||24)||24,o=e.imageBase||e.tmdbImageBase;return{language:t,region:n,ttlHours:r,imageBase:o}}function Dd(e,t){let{language:n,region:r,ttlHours:o,imageBase:i}=Vs(e),s=t!=null&&t.kind?`${t.kind}:${t.value||""}`:"none";return JSON.stringify({language:n,region:r,ttlHours:o,imageBase:i,auth:s})}function Rn(e={},t){let n=Dd(e,t);if(Fe&&qs===n)return Fe;let{language:r,region:o,ttlHours:i,imageBase:s}=Vs(e),a={cacheStore:Ri,language:r,region:o,ttlHours:i};return s&&(a.imageBase=s),(t==null?void 0:t.kind)==="bearer"&&t.value?a.token=t.value:(t==null?void 0:t.kind)==="apikey"&&t.value&&(a.apiKey=t.value),Fe=kn(a),qs=n,Fe}function zd(e){var s,a;let t=(e==null?void 0:e.type)==="tv"?"tv":"movie",n=((s=e==null?void 0:e.ids)==null?void 0:s.imdb)||"",r=((a=e==null?void 0:e.ids)==null?void 0:a.tmdb)||"",o=((e==null?void 0:e.title)||(e==null?void 0:e.name)||"").toLowerCase(),i=String((e==null?void 0:e.year)||"").slice(0,4);return[t,n,r,o,i].filter(Boolean).join("|")}function Od(){var e;try{localStorage.removeItem("tmdbCache")}catch(t){re("Failed to clear legacy TMDB cache from storage:",t)}qe.clear();try{Rr("tmdb:")}catch(t){re("Failed to clear metadata cache store:",t)}if(Fe)try{(e=Fe.clear)==null||e.call(Fe,"tmdb:")}catch(t){re("Failed to clear metadata service cache:",t)}}function jd(e){try{let t=localStorage.getItem("tmdbToken");if(t&&t.trim())return{kind:"bearer",value:t.trim()}}catch(t){re("Failed to read TMDB token from storage:",t)}if(e!=null&&e.tmdbToken){let t=String(e.tmdbToken).trim();if(t)return{kind:"bearer",value:t}}if(e!=null&&e.tmdbApiKey){let t=String(e.tmdbApiKey).trim();if(t)return{kind:"apikey",value:t}}return{kind:"none",value:""}}async function Kd(e,t,n,r){var o,i,s,a,c,l;if(!t)return null;try{let h=await Rn(n,r).client.get(`/find/${encodeURIComponent(t)}`,{external_source:"imdb_id"});return e==="movie"?(s=(i=(o=h==null?void 0:h.movie_results)==null?void 0:o[0])==null?void 0:i.id)!=null?s:null:(l=(c=(a=h==null?void 0:h.tv_results)==null?void 0:a[0])==null?void 0:c.id)!=null?l:null}catch(u){return re(`Failed to resolve external id ${t}:`,u),null}}async function Ud(e,t,n,r,o){var s;let i=String(t||"").trim();if(!i)return null;try{let c=Rn(r,o).client,l={query:i,include_adult:!1};n&&(e==="movie"?l.year=n:l.first_air_date_year=n);let u=await c.get(`/search/${e}`,l),d=Array.isArray(u==null?void 0:u.results)?u.results[0]:null;return(s=d==null?void 0:d.id)!=null?s:null}catch(a){return re(`Search failed for ${e} ${t}:`,a),null}}async function Gd(e,t,n){var a,c;let r=(e==null?void 0:e.type)==="tv"?"tv":"movie",o=zd(e);if(qe.has(o))return qe.get(o);let i=Rn(t,n),s=(a=e==null?void 0:e.ids)==null?void 0:a.tmdb;if(!s&&((c=e==null?void 0:e.ids)!=null&&c.imdb)&&(s=await Kd(r,e.ids.imdb,t,n)),!s){let l=e!=null&&e.year?Number(String(e.year).slice(0,4)):void 0;s=await Ud(r,(e==null?void 0:e.title)||(e==null?void 0:e.name),l,t,n)}if(!s)return qe.set(o,null),null;try{let l=r==="tv"?await i.getTvEnriched(s):await i.getMovieEnriched(s);if(!l)return qe.set(o,null),null;let u={id:l.id||String(s),poster:l.poster||"",backdrop:l.backdrop||"",url:l.url||`https://www.themoviedb.org/${r}/${s}`};return qe.set(o,u),u}catch(l){return re(`Hydration failed for ${r} ${s}:`,l),qe.set(o,null),null}}async function Hn(e,t,n={}){try{let r=jd(n);if(!r.value)return;Rn(n,r);let o=[...e||[],...t||[]],i=40,s=0,a=async()=>{let c=o.slice(s,s+4);s+=4,await Promise.all(c.map(async u=>{let d=await Gd(u,n,r);d&&(u.tmdb={id:d.id,poster:d.poster,backdrop:d.backdrop,url:d.url},u.ids=u.ids||{},!u.ids.tmdb&&d.id&&(u.ids.tmdb=String(d.id)))}));try{window.dispatchEvent(new CustomEvent("tmdb:chunk",{detail:{updated:c.length,index:s}}))}catch(u){re("Failed to dispatch tmdb:chunk event:",u)}if(s<Math.min(o.length,i))window.requestIdleCallback?window.requestIdleCallback(a,{timeout:500}):setTimeout(a,250);else try{window.dispatchEvent(new CustomEvent("tmdb:done",{detail:{total:Math.min(o.length,i)}}))}catch(u){re("Failed to dispatch tmdb:done event:",u)}};a()}catch(r){re("hydrateOptional failed to start:",r)}}function Ws(e,t){if(!t||t.kind==="none")return{url:e,init:{}};if(t.kind==="bearer")return{url:e,init:{headers:{Authorization:`Bearer ${t.value}`,Accept:"application/json"}}};let n=e.includes("?")?"&":"?";return{url:`${e}${n}api_key=${encodeURIComponent(t.value)}`,init:{headers:{Accept:"application/json"}}}}async function qd(e){let t=String(e||"").trim();if(!t)throw new Error("empty");let n=/^[a-f0-9]{32}$/i.test(t),r=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(t),o=i=>{try{let s=i.split(".")[1],c=atob((l=>l+"=".repeat((4-l.length%4)%4))(s.replace(/-/g,"+").replace(/_/g,"/")));return JSON.parse(c)}catch(s){return re("Failed to decode TMDB JWT payload:",s),null}};if(n){let{url:i,init:s}=Ws(`${Gs}/configuration`,{kind:"apikey",value:t});return(await fetch(i,s)).ok?{ok:!0,as:"apikey",hint:"v3Key"}:{ok:!1,as:"apikey",hint:"looksV3"}}if(r){let i=o(t);if(i&&typeof i=="object"){let c=String(i.iss||"");if(c&&!/themoviedb\.org/i.test(c))return{ok:!1,as:"bearer",hint:"issMismatch"}}let{url:s,init:a}=Ws(`${Gs}/trending/movie/day`,{kind:"bearer",value:t});try{if((await fetch(s,a)).ok)return{ok:!0,as:"bearer",hint:null}}catch(c){re("Bearer token validation request failed:",c)}return{ok:!0,as:"bearer",hint:"structOnly"}}return{ok:!1,as:"bearer",hint:null}}var Gs,qe,Fe,qs,We=M(()=>{An();ut();Gs="https://api.themoviedb.org/3",qe=new Map,Fe=null,qs=""});async function Zs(){vt=[];let e=null,t=null;try{let n=await fetch(Wd,{cache:"no-cache"});if(!n.ok)throw new Error(`HTTP ${n.status}`);e=await Yd(n)}catch(n){t=n,Ve(`Failed to load policy (${(n==null?void 0:n.message)||"unknown error"})`),Z("Hero-Policy konnte nicht geladen werden",(n==null?void 0:n.message)||"Unbekannter Fehler")}return te=Vd(e),Js=Date.now(),Jd(t),te}function St(){return ho(te)}function Qs(){return{movies:te.poolSizeMovies,series:te.poolSizeSeries}}function ea(){let e={};return Ys.forEach(t=>{e[t]={quota:te.slots[t].quota}}),e}function ta(){return{...te.diversity}}function na(){return{...te.rotation}}function ra(){return{...te.textClamp}}function oa(){return{...te.fallback}}function ia(){return te.language}function Jt(){let e=Number(te.cache.ttlHours),t=Number(te.cache.graceMinutes);return{ttlHours:e,ttlMs:e*60*60*1e3,graceMinutes:t,graceMs:t*60*1e3}}function Dn(){return vt.slice()}function sa(){return Js}function Vd(e){let t=ho(Xs);if(!e||typeof e!="object")return Ve("Policy payload missing or invalid, using defaults."),t;t.poolSizeMovies=Ae(e.poolSizeMovies,t.poolSizeMovies,"poolSizeMovies"),t.poolSizeSeries=Ae(e.poolSizeSeries,t.poolSizeSeries,"poolSizeSeries");let n=e.slots&&typeof e.slots=="object"?e.slots:{};Ys.forEach(u=>{let d=n[u],h=$n(d==null?void 0:d.quota,0,1,t.slots[u].quota,`slots.${u}.quota`);t.slots[u]={quota:h}});let r=e.diversity&&typeof e.diversity=="object"?e.diversity:{};t.diversity={genre:$n(r.genre,0,1,t.diversity.genre,"diversity.genre"),year:$n(r.year,0,1,t.diversity.year,"diversity.year"),antiRepeat:$n(r.antiRepeat,0,1,t.diversity.antiRepeat,"diversity.antiRepeat")};let o=e.rotation&&typeof e.rotation=="object"?e.rotation:{};t.rotation={intervalMinutes:Ae(o.intervalMinutes,t.rotation.intervalMinutes,"rotation.intervalMinutes"),minPoolSize:Ae(o.minPoolSize,t.rotation.minPoolSize,"rotation.minPoolSize")};let i=e.textClamp&&typeof e.textClamp=="object"?e.textClamp:{};t.textClamp={title:Ae(i.title,t.textClamp.title,"textClamp.title"),subtitle:Ae(i.subtitle,t.textClamp.subtitle,"textClamp.subtitle"),summary:Ae(i.summary,t.textClamp.summary,"textClamp.summary")};let s=e.fallback&&typeof e.fallback=="object"?e.fallback:{};t.fallback={prefer:Xd(s.prefer,t.fallback.prefer),allowDuplicates:typeof s.allowDuplicates=="boolean"?s.allowDuplicates:t.fallback.allowDuplicates},t.language=typeof e.language=="string"&&e.language.trim()?e.language.trim():t.language,t.language!==(e.language||"").trim()&&Ve("language missing or invalid, defaulted to en-US.");let a=e.cache&&typeof e.cache=="object"?e.cache:{},c=Ae(a.ttlHours,t.cache.ttlHours,"cache.ttlHours"),l=Ae(a.graceMinutes,t.cache.graceMinutes,"cache.graceMinutes",!0);return t.cache={ttlHours:c,graceMinutes:l},t}function Ae(e,t,n,r){let o=Number(e);return Number.isFinite(o)&&(r?o>=0:o>0)?Math.floor(o):(e!=null&&Ve(`${n} invalid (${e}), using default (${t}).`),t)}function $n(e,t,n,r,o){let i=Number(e);return Number.isFinite(i)&&i>=t&&i<=n?i:(e!=null&&Ve(`${o} invalid (${e}), using default (${r}).`),r)}function Xd(e,t){return e==="movies"||e==="series"||e==="shows"?e==="shows"?"series":e:(e!=null&&Ve(`fallback.prefer invalid (${e}), using default (${t}).`),t)}function ho(e){return JSON.parse(JSON.stringify(e))}async function Yd(e){try{return await e.json()}catch(t){return Ve(`Failed to parse hero policy JSON (${(t==null?void 0:t.message)||t}).`),null}}function Ve(e){e&&vt.push(e)}function Jd(e){if(vt.length){if(e){let t=vt.slice(1);t.length&&Z("Hero-Policy Hinweise",t.join(" \u2022 "));return}Z("Hero-Policy Hinweise",vt.join(" \u2022 "))}}var Wd,Xs,Ys,te,Js,vt,zn=M(()=>{gn();Wd="hero.policy.json",Xs=Object.freeze({poolSizeMovies:10,poolSizeSeries:10,slots:{new:{quota:.3},topRated:{quota:.3},oldButGold:{quota:.2},random:{quota:.2}},diversity:{genre:.4,year:.35,antiRepeat:.25},rotation:{intervalMinutes:360,minPoolSize:6},textClamp:{title:96,subtitle:240,summary:220},fallback:{prefer:"movies",allowDuplicates:!1},language:"en-US",cache:{ttlHours:24,graceMinutes:15}}),Ys=["new","topRated","oldButGold","random"],te=ho(Xs),Js=0,vt=[]});function ne(...e){try{}catch{}}function oe(){return Date.now()}function jn(e){return new Promise(t=>setTimeout(t,Math.max(0,e||0)))}function ef(e,t){if(e===t)return!0;if(!e||!t)return!1;let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let o of n)if(e[o]!==t[o])return!1;return!0}function Un(){var e;return{active:!!z.active,until:Number(z.until)||0,retryAfterMs:Number(z.retryAfterMs)||0,lastStatus:(e=z.lastStatus)!=null?e:null,lastHitAt:Number(z.lastHitAt)||0,strikes:Number(z.strikes)||0}}function tf(){let e=Un();for(let t of bo)try{t(e)}catch(n){ne("Rate limit listener failed:",(n==null?void 0:n.message)||n)}}function Kn(e){let t={...Un(),...e};return ef(z,t)||(z=t,tf()),z}function ua(e){return Math.min(8e3,400*Math.pow(2,Math.max(0,e)))}function nf(e,t){let n=1200*Math.pow(2,Math.max(0,e-1)),r=Math.max(t||0,n);return Math.min(6e4,r)}function rf(e,t=429){let n=oe(),r=Math.min(5,(z.strikes||0)+1),o=nf(r,e);return Et=Math.max(Et,n+o),Kn({active:!0,strikes:r,retryAfterMs:o,until:n+o,lastStatus:t,lastHitAt:n}),o}function of(){if(!z.strikes)return;let e=Math.max(0,z.strikes-1);Kn({strikes:e,active:z.active&&z.until>oe()})}function pa(){let e=oe();z.active&&e>=z.until?Kn({active:!1,retryAfterMs:0,until:0}):!z.active&&z.strikes>0&&e-z.lastHitAt>9e4&&Kn({strikes:Math.max(0,z.strikes-1)}),Et&&e>=Et&&(Et=0)}function sf(e,t,n){let r=e==="tv"?"tv":"movie",o=String(n||"en-US").trim()||"en-US";return`${r}:${String(t||"").trim()}:${o}`}function ba(){if(ca||(ca=!0,typeof localStorage=="undefined"))return;let e;try{if(e=localStorage.getItem(ma),!e)return}catch(r){ne("Failed to read TMDB cache from storage:",(r==null?void 0:r.message)||r);return}let t;try{t=JSON.parse(e)}catch(r){ne("Stored TMDB cache invalid JSON:",(r==null?void 0:r.message)||r);return}if(!Array.isArray(t))return;let n=oe();t.forEach(([r,o])=>{var s,a,c,l;if(!r||!o)return;let i=Number((a=(s=o.ts)!=null?s:o.timestamp)!=null?a:o.fetchedAt);Number.isFinite(i)&&(n-i>864e5||le.set(String(r),{ts:i,data:(l=(c=o.data)!=null?c:o.payload)!=null?l:null}))})}function af(){let e=oe(),t=!1;for(let[n,r]of le.entries()){if(!r||typeof r!="object"){le.delete(n),t=!0;continue}let o=Number(r.ts);(!Number.isFinite(o)||e-o>864e5)&&(le.delete(n),t=!0)}t&&vo()}function da(e){ba();let t=le.get(e);if(!t)return null;let n=Number(t.ts);return!Number.isFinite(n)||oe()-n>864e5?(le.delete(e),vo(),null):t}function cf(e,t){ba(),le.set(e,{ts:oe(),data:t}),lf(),vo()}function lf(){if(le.size<=60)return;let e=Array.from(le.entries());e.sort((n,r)=>{var s,a;let o=Number(((s=n[1])==null?void 0:s.ts)||0);return Number(((a=r[1])==null?void 0:a.ts)||0)-o});let t=e.slice(0,60);le=new Map(t)}function vo(){typeof localStorage!="undefined"&&(mo||(mo=setTimeout(()=>{mo=null,uf()},120)))}function uf(){if(typeof localStorage=="undefined")return;let e=Array.from(le.entries()).map(([t,n])=>{var r,o;return[t,{ts:(r=n==null?void 0:n.ts)!=null?r:oe(),data:(o=n==null?void 0:n.data)!=null?o:null}]});try{localStorage.setItem(ma,JSON.stringify(e))}catch(t){ne("Failed to persist TMDB cache:",(t==null?void 0:t.message)||t)}}function df(e){if(!e)return 0;let t=Number(e);if(Number.isFinite(t))return Math.max(0,t*1e3);let n=Date.parse(e);return Number.isFinite(n)?Math.max(0,n-oe()):0}function ff(e){return e===429||e>=500&&e<600}function gf(e){return e&&(e.name==="AbortError"||e.code==="ABORT_ERR")}function hf(e){return gf(e)?!1:!!(e&&typeof e=="object"&&(e.name==="TypeError"&&/network/i.test(e.message||"")||/network/i.test((e==null?void 0:e.message)||"")))}function mf(e,t){if(!t||!t.value)return{url:e,init:{headers:{Accept:"application/json"}}};if(t.kind==="apikey"){let n=e.includes("?")?"&":"?";return{url:`${e}${n}api_key=${encodeURIComponent(t.value)}`,init:{headers:{Accept:"application/json"}}}}return{url:e,init:{headers:{Accept:"application/json",Authorization:`Bearer ${t.value}`}}}}async function pf(){pa();let e=oe(),t=Math.max(0,la+400-e),n=Math.max(0,Et-e),r=Math.max(t,n);r>0&&await jn(r),la=oe()}async function At(e,t,{signal:n}={},r=0){let{url:o,init:i}=mf(e,t),s={...i,signal:n};await pf();let a;try{a=await fetch(o,s)}catch(c){if(r<4&&hf(c)){let l=ua(r);return await jn(l),At(e,t,{signal:n},r+1)}throw c}if(!a.ok){let c=a.status,l=ff(c)&&r<4;if(c===429){let h=df(a.headers.get("retry-after")),f=rf(h,c);if(l)return await jn(f),At(e,t,{signal:n},r+1)}else if(l){let h=ua(r);return await jn(h),At(e,t,{signal:n},r+1)}let u=await a.text().catch(()=>""),d=new Error(`HTTP ${c}${u?`: ${u}`:""}`);throw d.status=c,c===429&&(d.code="RATE_LIMIT"),d}return of(),pa(),a.json()}function we(e,t){if(!e&&e!==0)return null;let n=String(e||"").trim();return n?{kind:t||(/^[a-f0-9]{32}$/i.test(n)?"apikey":"bearer"),value:n}:null}function bf(){if(typeof localStorage=="undefined")return"";try{return localStorage.getItem("tmdbToken")||""}catch(e){return ne("Failed to read tmdbToken from storage:",(e==null?void 0:e.message)||e),""}}function yf(e){if(!e)return{};let t=e.trim();if(!t)return{};if(t.startsWith("{")||t.startsWith("["))try{let r=JSON.parse(t);if(r&&typeof r=="object")return r}catch(r){ne("Failed to parse config.cfg JSON:",(r==null?void 0:r.message)||r)}let n={};return t.split(/\r?\n/).forEach(r=>{let o=r.trim();if(!o||o.startsWith("#")||o.startsWith(";"))return;let i=o.indexOf("=");if(i===-1)return;let s=o.slice(0,i).trim(),a=o.slice(i+1).trim();s&&(n[s]=a)}),n}async function vf(){return On||(On=(async()=>{if(typeof fetch!="function")return{};try{let e=await fetch("config.cfg",{cache:"no-cache"});if(!e.ok)return e.status!==404&&ne(`Failed to load config.cfg (HTTP ${e.status})`),{};let t=await e.text();return po=yf(t),po}catch(e){return ne("Error loading config.cfg:",(e==null?void 0:e.message)||e),{}}})(),On)}function Sf(e){if(!e||typeof e!="object")return null;if(e.tmdbToken){let t=we(e.tmdbToken,"bearer");if(t)return{...t,source:"settings.tmdbToken"}}if(e.tmdbApiKey){let t=we(e.tmdbApiKey,"apikey");if(t)return{...t,source:"settings.tmdbApiKey"}}return null}function Ef(){let e=we(bf(),"bearer");return e?{...e,source:"localStorage.tmdbToken"}:null}function Af(e){if(!e||typeof e!="object")return null;if(e.tmdbToken){let t=we(e.tmdbToken,"bearer");if(t)return{...t,source:"config.cfg.tmdbToken"}}if(e.tmdbApiKey){let t=we(e.tmdbApiKey,"apikey");if(t)return{...t,source:"config.cfg.tmdbApiKey"}}return null}async function ya(e={},t={}){if(t.credentials){if(typeof t.credentials=="string"||typeof t.credentials=="number"){let s=we(t.credentials);if(s)return{...s,source:"explicit"}}else if(t.credentials&&typeof t.credentials=="object"&&t.credentials.value){let s=we(t.credentials.value,t.credentials.kind);if(s)return{...s,source:t.credentials.source||"explicit"}}}let n=Sf(e);if(n)return n;let r=Ef();if(r)return r;if(e&&e.tmdbApiKey){let s=we(e.tmdbApiKey,"apikey");if(s)return{...s,source:"settings.tmdbApiKey"}}let o=await vf().catch(()=>po||{}),i=Af(o);if(i)return i;if(t.fallbackCredential){let s=we(t.fallbackCredential);if(s)return{...s,source:"fallback"}}return null}function va(){return Un()}function Sa(e){if(typeof e!="function")return()=>{};bo.add(e);try{e(Un())}catch(t){ne("Rate limit listener threw during init:",(t==null?void 0:t.message)||t)}return()=>bo.delete(e)}function Ea(e,t="original"){let r=(typeof e=="string"?e:"").trim();if(!r)return"";let o=r.startsWith("/")?r:`/${r}`,i=String(t||"original").trim()||"original";return`${Zd}${i}${o}`}function wt(e){return e==null?"":String(e).trim()}async function So(e,t,n={}){let r=e==="tv"?"tv":"movie",o=wt(t);if(!o)return null;let i=wt(n.language)||"en-US",s=sf(r,o,i);if(!n.forceRefresh){let d=da(s);if(d)return{id:o,type:r,language:i,data:d.data,fetchedAt:d.ts,source:"cache"}}let a=n.auth||await ya(n.settings,n.authOptions||{});if(!a)return ne("TMDB credentials missing; cannot fetch details."),null;let c=`${yo}/${r}/${encodeURIComponent(o)}?language=${encodeURIComponent(i)}&append_to_response=${Qd}`,l;try{l=await At(c,a,{signal:n.signal})}catch(d){throw ne(`Failed to fetch TMDB ${r}#${o}:`,(d==null?void 0:d.message)||d),d}cf(s,l);let u=da(s);return{id:o,type:r,language:i,data:l,fetchedAt:(u==null?void 0:u.ts)||oe(),source:"network"}}function wf(e){if(!e||typeof e!="object")return"";let t=[e.title,e.name,e.originalTitle,e.original_name,e.original_title];for(let n of t){let r=typeof n=="string"?n.trim():"";if(r)return r}return""}function fa(e){if(e==null)return null;let t=Number(e);if(Number.isFinite(t)&&t>1800)return Math.trunc(t);if(typeof e=="string"){let n=e.match(/(19|20|21)\d{2}/);if(n)return Number(n[0])}return null}function kf(e){var o;if(!e||typeof e!="object")return null;let t=fa((o=e.year)!=null?o:e.startYear);if(t)return t;let n=e.originallyAvailableAt||e.premieredAt||e.releaseDate||e.firstAirDate,r=fa(n);return r||null}async function Tf(e,t,n){let r=n.language||"en-US",o=`${yo}/find/${encodeURIComponent(t)}?external_source=imdb_id&language=${encodeURIComponent(r)}`,i=await At(o,n.auth,{signal:n.signal}),s=e==="tv"?"tv_results":"movie_results",c=(Array.isArray(i==null?void 0:i[s])?i[s]:[]).find(d=>d&&d.id!=null);if(!c||c.id==null)return null;let l=String(c.id),u=await So(e,l,n);return u&&(u.id=l,u.resolvedId=l),u}function Cf(e,t,n,r){let o=encodeURIComponent(t),i=encodeURIComponent(n||"en-US"),s=`${yo}/search/${e}?query=${o}&language=${i}`;return r?`${s}&${e==="tv"?"first_air_date_year":"year"}=${encodeURIComponent(String(r))}`:s}async function _f(e,t,n,r){if(!t)return null;let o=r.language||"en-US",i=Cf(e,t,o,n),s=await At(i,r.auth,{signal:r.signal}),a=Array.isArray(s==null?void 0:s.results)?s.results:[];if(!a.length)return null;let c=a.find(d=>d&&d.id!=null)||a[0];if(!c||c.id==null)return null;let l=String(c.id),u=await So(e,l,r);return u&&(u.id=l,u.resolvedId=l),u}function If(e){let t={tmdb:"",imdb:""};if(!e||typeof e!="object")return t;let n=r=>{let o=typeof r=="string"?r:r==null?void 0:r.id;if(!o)return;let i=String(o).trim();if(!i)return;let[s,a]=i.split("://");if(!a){i.startsWith("tt")&&(t.imdb=i);return}let c=s.toLowerCase(),u=a.split("?")[0].replace(/^\//,"").split("/").pop();if(c==="imdb"||c.includes("imdb")){t.imdb=u||t.imdb;return}if(c==="tmdb"||c.includes("themoviedb")){t.tmdb=u||t.tmdb;return}};return e.ids&&typeof e.ids=="object"&&(e.ids.tmdb&&(t.tmdb=wt(e.ids.tmdb)),e.ids.imdb&&(t.imdb=wt(e.ids.imdb))),n(e.guid),Array.isArray(e.guids)&&e.guids.forEach(n),t}function xf(e,t){let n=wt(t==null?void 0:t.searchTitle);return n||wf(e)}async function Aa(e,t={}){var l;if(!e||typeof e!="object")return null;let n=e.type==="tv"?"tv":"movie",r=wt(t.language)||"en-US",o=t.auth||await ya(t.settings,t.authOptions||{});if(!o)return ne("Skipping TMDB lookup (missing credentials)."),null;let i={...t,auth:o,language:r},s=If(e),a=[];s.tmdb&&a.push({label:"direct id",fn:()=>So(n,s.tmdb,i)}),s.imdb&&a.push({label:"imdb find",fn:()=>Tf(n,s.imdb,i)});let c=xf(e,t);if(c){let u=(l=t.searchYear)!=null?l:kf(e);a.push({label:"search",fn:()=>_f(n,c,u,i)})}for(let u of a)try{let d=await u.fn();if(d)return!d.resolvedId&&d.id&&(d.resolvedId=d.id),d}catch(d){ne(`TMDB ${u.label} lookup failed:`,(d==null?void 0:d.message)||d)}return null}var yo,Zd,Qd,ma,le,ca,mo,la,On,po,Et,z,bo,ga,ha,Eo=M(()=>{yo="https://api.themoviedb.org/3",Zd="https://image.tmdb.org/t/p/",Qd="images,release_dates,content_ratings,credits",ma="hero.tmdbCache.v1",le=new Map,ca=!1,mo=null,la=0,On=null,po={},Et=0,z={active:!1,until:0,retryAfterMs:0,lastStatus:null,lastHitAt:0,strikes:0},bo=new Set;(ha=(ga=setInterval(()=>{try{af()}catch{}},864e5/6)).unref)==null||ha.call(ga)});function wa(...e){try{}catch{}}function Gn(e){return typeof e!="string"?"":e.trim()}function W(e){let t=Gn(e);return t||""}function Ao(e){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e)&&e>1800&&e<9999)return Math.trunc(e);if(typeof e=="string"){let t=e.match(/(19|20|21)\d{2}/);if(t)return Number(t[0])}return null}function wo(e){if(!e)return null;try{let t=new Date(e);if(Number.isNaN(t.getTime()))return null;let n=t.getUTCFullYear();return n>1800&&n<9999?n:null}catch{return null}}function ka(e){let t=Number(e);return!Number.isFinite(t)||t<=0?null:Math.round(t*10)/10}function kt(e){if(e==null)return null;let t=Number(e);return Number.isFinite(t)&&t>0?t>1e3?Math.max(1,Math.round(t/6e4)):Math.round(t):null}function Lf(e,t){let n=[];if(t&&Array.isArray(t.genres)){for(let s of t.genres)if(s&&typeof s=="object"&&s.name){let a=Gn(s.name);a&&n.push(a)}}let r=e==null?void 0:e.genres;Array.isArray(r)&&r.forEach(s=>{if(!s)return;if(typeof s=="string"){let c=Gn(s);c&&n.push(c);return}let a=Gn(s.tag||s.title||s.label||s.name);a&&n.push(a)});let o=new Set,i=[];for(let s of n){let a=s.toLowerCase();o.has(a)||(o.add(a),i.push(s))}return i.slice(0,2)}function Nf(e){let t={},n=(r,o)=>{if(o==null)return;let i=typeof o=="string"?o:String(o),s=W(i);s&&(t[r]=s)};if(e&&typeof e=="object"){e.ratingKey!=null&&n("ratingKey",e.ratingKey),e.ids&&typeof e.ids=="object"&&(n("tmdb",e.ids.tmdb),n("imdb",e.ids.imdb));let r=o=>{let i=typeof o=="string"?o:o==null?void 0:o.id,s=W(i);if(!s)return;let[a,c]=s.split("://");if(c){let l=a.toLowerCase(),d=c.split("?")[0].replace(/^\//,"").split("/").pop();if(l==="imdb"||l.includes("imdb")){n("imdb",d);return}if(l==="tmdb"||l.includes("themoviedb")){n("tmdb",d);return}if(l==="tvdb"||l.includes("thetvdb")){n("tvdb",d);return}}else s.startsWith("tt")&&n("imdb",s)};r(e.guid),Array.isArray(e.guids)&&e.guids.forEach(r)}return t}function Pf(e,t,n){if(t)if(n==="tv"){let r=[t.name,t.original_name];for(let o of r){let i=W(o);if(i)return i}}else{let r=[t.title,t.original_title];for(let o of r){let i=W(o);if(i)return i}}if(e){let r=[e.title,e.name,e.originalTitle];for(let o of r){let i=W(o);if(i)return i}}return""}function Bf(e,t){let n=[t==null?void 0:t.tagline,e==null?void 0:e.tagline];for(let r of n){let o=W(r);if(o)return o}return""}function Rf(e,t){let n=[t==null?void 0:t.overview,e==null?void 0:e.summary,e==null?void 0:e.plot,e==null?void 0:e.description];for(let r of n){let o=W(r);if(o)return o}return""}function Hf(e,t,n){var o,i,s;if(t){let a=n==="tv"?t.first_air_date:t.release_date,c=(o=Ao(a))!=null?o:wo(a);if(c)return c;let l=n==="tv"?t.last_air_date:t.release_date,u=(i=Ao(l))!=null?i:wo(l);if(u)return u}let r=(s=Ao(e==null?void 0:e.year))!=null?s:wo(e==null?void 0:e.originallyAvailableAt);return r||null}function $f(e,t,n){var r,o,i;if(t){if(n==="tv"&&Array.isArray(t.episode_run_time)&&t.episode_run_time.length){let s=kt(t.episode_run_time.find(a=>kt(a)));if(s)return s}if(n==="movie"){let s=kt(t.runtime);if(s)return s}}if(n==="movie"){let s=kt((r=e==null?void 0:e.durationMin)!=null?r:e==null?void 0:e.duration);if(s)return s}else if(n==="tv"){if(Array.isArray(e==null?void 0:e.seasons)){for(let a of e.seasons)if(Array.isArray(a==null?void 0:a.episodes))for(let c of a.episodes){let l=kt((o=c==null?void 0:c.durationMin)!=null?o:c==null?void 0:c.duration);if(l)return l}}let s=kt((i=e==null?void 0:e.durationMin)!=null?i:e==null?void 0:e.duration);if(s)return s}return null}function Df(e,t){var o;let n=ka(t==null?void 0:t.vote_average);if(n)return n;let r=ka((o=e==null?void 0:e.rating)!=null?o:e==null?void 0:e.audienceRating);return r||null}function zf(e){let t=Number(e==null?void 0:e.vote_count);return Number.isFinite(t)&&t>0?Math.round(t):null}function Of(e,t,n){var o,i,s;if(n==="movie"&&((o=t==null?void 0:t.release_dates)!=null&&o.results)){let c=(Array.isArray(t.release_dates.results)?t.release_dates.results:[]).find(d=>d&&d.iso_3166_1==="US"),u=(Array.isArray(c==null?void 0:c.release_dates)?c.release_dates:[]).filter(d=>W(d==null?void 0:d.certification)).sort((d,h)=>{var p,m;let f=Number((p=d==null?void 0:d.type)!=null?p:0),g=Number((m=h==null?void 0:h.type)!=null?m:0);return f-g});if(u.length){let d=W(((i=u.find(h=>h.type===3))==null?void 0:i.certification)||u[0].certification);if(d)return d}}if(n==="tv"&&Array.isArray((s=t==null?void 0:t.content_ratings)==null?void 0:s.results)){let a=t.content_ratings.results.find(l=>l&&l.iso_3166_1==="US"),c=W(a==null?void 0:a.rating);if(c)return c}let r=W(e==null?void 0:e.contentRating);if(r){let a=r.split("/").pop(),c=W(a);if(c)return c}return""}function jf(e,t){var o;let n=[],r=Array.isArray((o=e==null?void 0:e.images)==null?void 0:o.backdrops)?e.images.backdrops:[];for(let i of r){if(!i||!i.file_path||i.width&&i.width<Ff)continue;let s=Ea(i.file_path,Mf);s&&(n.includes(s)||n.push(s))}if(n.length===0&&t){let i=t.art||t.thumb||t.thumbFile||t.backdrop;if(i&&typeof i=="string"){let s=i.trim();s&&!n.includes(s)&&n.push(s)}}return n}function Kf(e,t){let n={seasons:null,episodes:null};if(Number.isFinite(t==null?void 0:t.number_of_seasons)&&(n.seasons=Math.max(0,Math.round(t.number_of_seasons))),Number.isFinite(t==null?void 0:t.number_of_episodes)&&(n.episodes=Math.max(0,Math.round(t.number_of_episodes))),n.seasons==null&&Array.isArray(e==null?void 0:e.seasons)&&(n.seasons=e.seasons.length),n.episodes==null&&Array.isArray(e==null?void 0:e.seasons)){let r=0;e.seasons.forEach(o=>{Array.isArray(o==null?void 0:o.episodes)&&(r+=o.episodes.length)}),r>0&&(n.episodes=r)}return n}function Uf(e,t){if(!t||typeof t!="object")return null;let n=t.tmdb||t.imdb||t.ratingKey,r=W(n);if(!r)return null;let o=e==="tv"?"show":"movie";return{id:r,kind:o,label:o==="show"?"Show details":"Movie details",target:`#/${o}/${r}`}}function Gf(e){let t={};return Object.entries(e||{}).forEach(([n,r])=>{let o=W(r);o&&(t[n]=o)}),t}function qf(e,t){return e.ratingKey?e.ratingKey:e.tmdb?`${t}-${e.tmdb}`:e.imdb?`${t}-${e.imdb}`:""}async function Ta(e,t={}){var k,L;if(!e||typeof e!="object")return null;let n=e.type==="tv"?"tv":"movie",r=W(t.language)||"en-US",o=Nf(e),i=null;if(t.disableTmdb!==!0)try{i=await Aa(e,{language:r,settings:t.settings,auth:t.auth,authOptions:t.authOptions,signal:t.signal,searchTitle:t.searchTitle,searchYear:t.searchYear})}catch(C){wa("TMDB lookup failed:",(C==null?void 0:C.message)||C)}let s=i==null?void 0:i.data;i!=null&&i.resolvedId&&(o.tmdb||(o.tmdb=String(i.resolvedId))),s!=null&&s.id&&!o.tmdb&&(o.tmdb=String(s.id)),s!=null&&s.imdb_id&&!o.imdb&&(o.imdb=String(s.imdb_id).trim()),o=Gf(o);let a=Pf(e,s,n);if(!a)return wa("Skipping item without title",(e==null?void 0:e.ratingKey)||(e==null?void 0:e.title)||(e==null?void 0:e.guid)||"unknown"),null;let c={id:qf(o,n)||String((L=(k=e.ratingKey)!=null?k:e.guid)!=null?L:a),type:n,title:a},l=Bf(e,s);l&&(c.tagline=l);let u=Rf(e,s);u&&(c.overview=u);let d=Hf(e,s,n);d&&(c.year=d);let h=$f(e,s,n);h&&(c.runtime=h);let f=Df(e,s);f!=null&&(c.rating=f);let g=zf(s);g!=null&&(c.voteCount=g);let p=Lf(e,s);p.length&&(c.genres=p);let m=Of(e,s,n);m&&(c.certification=m);let b=jf(s,e);if(b.length&&(c.backdrops=b),n==="tv"){let C=Kf(e,s);C.seasons!=null&&(c.seasons=C.seasons),C.episodes!=null&&(c.episodes=C.episodes)}let S=Uf(n,o);if(S&&(c.cta=S),Object.keys(o).length&&(c.ids=o),c.language=r,i){let C={id:o.tmdb||(i.id?String(i.id):""),fetchedAt:i.fetchedAt||Date.now(),source:i.source};C.id||delete C.id,C.source||delete C.source,t.includeTmdbRaw&&s&&(C.raw=s),Object.keys(C).length&&(c.tmdb=C)}return t.includeSource&&(c.source=e),c}var Ff,Mf,Ca=M(()=>{Eo();Ff=1920,Mf="original"});function Me(){return Date.now()}function _a(e){try{if(typeof globalThis!="undefined"&&globalThis[e])return globalThis[e]}catch{}return null}function Jf(e,t){if(!e)return null;try{return e.getItem(t)}catch{return null}}function V(e,t,n){if(e)try{n==null?e.removeItem(t):e.setItem(t,n)}catch{}}function Zf(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function qn(e){try{return JSON.stringify(e)}catch{return null}}function Qt(e){return e==="shows"||e==="show"||e==="series"?"series":"movies"}function Wn(e){return`${Wf}${Qt(e)}`}function ko(e){return`${Wn(e)}${Tt}`}function Ia(e){return`${Vf}${Qt(e)}`}function To(e){return`${Xf}${Qt(e)}`}function Co(e){return`${Yf}${Qt(e)}`}function Zt(e,t){let n=Jf(e,t);if(!n)return null;let r=Zf(n);return!r||typeof r!="object"?null:r}function xa(e){let{local:t}=ue(),n=To(e),r=Zt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:0),slot:typeof(o==null?void 0:o.slot)=="string"?o.slot:(o==null?void 0:o.slot)!=null?String(o.slot):void 0}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function Qf(e,t){let n=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts,slot:a.slot})):[],r=qn(n);if(r==null)return;let{local:o,session:i}=ue(),s=To(e);V(o,s,r),V(i,`${s}${Tt}`,r)}function _o(e){let{local:t}=ue(),n=Co(e),r=Zt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:0),reason:typeof(o==null?void 0:o.reason)=="string"?o.reason:"",hits:Number(o==null?void 0:o.hits)||0}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function Fa(e,t){let n=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts,reason:a.reason||"",hits:Number(a.hits)||0})):[],r=qn(n);if(r==null)return;let{local:o,session:i}=ue(),s=Co(e);V(o,s,r),V(i,`${s}${Tt}`,r)}function ue(){return{local:_a("localStorage"),session:_a("sessionStorage")}}function Ma(e){if(!e||typeof e!="object")return null;let t={kind:Qt(e.kind||e.library||e.type),items:Array.isArray(e.items)?e.items.slice():[],updatedAt:Number(e.updatedAt)||Me(),expiresAt:Number(e.expiresAt)||0,policyHash:typeof e.policyHash=="string"?e.policyHash:"",slotSummary:e.slotSummary&&typeof e.slotSummary=="object"?{...e.slotSummary}:{},meta:e.meta&&typeof e.meta=="object"?{...e.meta}:void 0};return e.generatedAt&&!t.updatedAt&&(t.updatedAt=Number(e.generatedAt)||t.updatedAt),t}function Ct(e,{now:t=Me(),policyHash:n=null,allowExpired:r=!1}={}){let{local:o,session:i}=ue(),s=Wn(e),a=ko(e),c=Zt(i,a),l=Zt(o,s),u=c||l||null;if(!u)return null;let d=Ma(u);if(!d)return null;let f=(Number(d.expiresAt)||0)>t,g=n?d.policyHash===n:!0;return!r&&!f||n&&!g?null:(d.isExpired=!f,d.matchesPolicy=g,d.source=c?"session":"local",d)}function La(e,t){let{local:n,session:r}=ue();if(!t||typeof t!="object"){Na(e);return}let o=Ma({...t,kind:e});if(!o)return;let i=Wn(e),s=ko(e),a=qn(o);a!=null&&(V(n,i,a),V(r,s,a))}function Na(e){let{local:t,session:n}=ue(),r=Wn(e),o=ko(e);V(t,r,null),V(n,o,null)}function Pa(e){let{local:t}=ue(),n=Ia(e),r=Zt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:o==null?void 0:o.at)}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function eg(e,t){let{local:n,session:r}=ue(),o=Ia(e),i=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts})):[],s=qn(i);s!=null&&(V(n,o,s),V(r,`${o}${Tt}`,s))}function Vn(e){if(!e)return null;if(typeof e=="string")return e.trim()||null;if(typeof e=="number")return`#${e}`;if(e&&typeof e=="object"){if(e.poolId!=null)return String(e.poolId);if(e.poolEntryId!=null)return String(e.poolEntryId);if(e.heroId!=null)return String(e.heroId);if(e.cta&&e.cta.id!=null)return String(e.cta.id);if(e.ids&&typeof e.ids=="object"){if(e.ids.imdb)return`imdb:${e.ids.imdb}`;if(e.ids.tmdb)return`tmdb:${e.ids.tmdb}`;if(e.ids.tvdb)return`tvdb:${e.ids.tvdb}`}if(e.guid)return String(e.guid);if(e.ratingKey!=null)return`rk:${e.ratingKey}`;if(e.id!=null)return String(e.id);if(e.slug)return String(e.slug);if(e.key)return String(e.key);if(e.title){let t=e.year?`:${e.year}`:"";return`title:${e.title}${t}`}}return null}function tg(e){return Vn(e)}function Ba(e,t,{timestamp:n=Me(),limit:r=80}={}){let o=tg(t);if(!o)return null;let s=Pa(e).filter(c=>c.id!==o);s.unshift({id:o,ts:n});let a=s.filter(c=>n-c.ts<=12096e5).slice(0,Math.max(1,r));return eg(e,a),a}function Io(e,{now:t=Me(),windowMs:n=12096e5,limit:r=80}={}){let o=Pa(e);if(!o.length)return{entries:[],set:new Set};let i=t-Math.max(0,n),s=new Set,a=[];for(let c of o)if(!(!c||!c.id)&&!(c.ts<i)&&!s.has(c.id)&&(s.add(c.id),a.push({id:c.id,ts:c.ts}),a.length>=r))break;return{entries:a,set:s}}function Ra(e,t,{timestamp:n=Me(),ttlMs:r=0,limit:o=120}={}){if(!Array.isArray(t)||!t.length)return[];let i=r>0?Math.max(0,n-r):0,s=xa(e),a=new Set,c=[];for(let m of s)!m||!m.id||i&&m.ts<i||a.has(m.id)||(a.add(m.id),c.push(m));let l=[],u=new Set;for(let m of t){let b=Vn(m);if(!b)continue;let S=typeof(m==null?void 0:m.slot)=="string"?m.slot:m!=null&&m.poolSlot?String(m.poolSlot):void 0;l.push({id:b,ts:n,slot:S}),u.add(b)}let d=c.filter(m=>!u.has(m.id)),f=[...l,...d].filter(m=>m&&m.id).slice(0,Math.max(1,o)),g=[],p=new Set;for(let m of f)p.has(m.id)||(p.add(m.id),g.push(m));return Qf(e,g),g}function Ha(e,{now:t=Me(),windowMs:n=0,limit:r=120}={}){let o=xa(e);if(!o.length)return{entries:[],set:new Set};let i=n>0?Math.max(0,t-n):0,s=new Set,a=[];for(let c of o)if(!(!c||!c.id)&&!(i&&c.ts<i)&&!s.has(c.id)&&(s.add(c.id),a.push({id:c.id,ts:c.ts,slot:c.slot}),a.length>=r))break;return{entries:a,set:s}}function $a(e){let{local:t,session:n}=ue(),r=To(e);V(t,r,null),V(n,`${r}${Tt}`,null)}function Da(e,t,{timestamp:n=Me(),ttlMs:r=0,limit:o=80,reason:i=""}={}){let s=Vn(t);if(!s)return null;let a=r>0?Math.max(0,n-r):0,c=_o(e),l=[],u=0;for(let f of c)if(!(!f||!f.id)){if(f.id===s){u=(f.hits||0)+1;continue}a&&f.ts<a||l.push(f)}let d={id:s,ts:n,reason:i||"",hits:u};l.unshift(d);let h=l.slice(0,Math.max(1,o));return Fa(e,h),d}function za(e,t){let n=Vn(t);if(!n)return;let r=_o(e),o=r.filter(i=>i&&i.id!==n);o.length!==r.length&&Fa(e,o)}function Oa(e,{now:t=Me(),windowMs:n=0,limit:r=80}={}){let o=_o(e);if(!o.length)return{entries:[],set:new Set};let i=n>0?Math.max(0,t-n):0,s=new Set,a=[];for(let c of o)if(!(!c||!c.id)&&!(i&&c.ts<i)&&!s.has(c.id)&&(s.add(c.id),a.push({id:c.id,ts:c.ts,reason:c.reason||"",hits:c.hits||0}),a.length>=r))break;return{entries:a,set:s}}function ja(e){let{local:t,session:n}=ue(),r=Co(e);V(t,r,null),V(n,`${r}${Tt}`,null)}var Wf,Vf,Xf,Yf,Tt,Xn=M(()=>{Wf="heroPool:",Vf="heroHistory:",Xf="heroMemory:",Yf="heroFailures:",Tt=":session"});function Xe(){return Date.now()}function Zn(...e){try{}catch{}}function qa(e){return e==="series"||e==="show"||e==="shows"?"series":"movies"}function ag(e,t){if(!e||typeof e!="object")return"";try{let r={poolSize:qa(t)==="series"?e.poolSizeSeries:e.poolSizeMovies,slots:e.slots,diversity:e.diversity,language:e.language||"en-US"};return JSON.stringify(r)}catch(n){return Zn("Failed to compute policy signature:",(n==null?void 0:n.message)||n),""}}function _t(e,t,n){return Math.min(n,Math.max(t,e))}function cg(e){if(!e)return 0;if(typeof e=="number"&&Number.isFinite(e))return e>1e12?Math.trunc(e):Math.trunc(e*1e3);if(typeof e=="string"){let t=Date.parse(e);if(Number.isFinite(t))return t}return 0}function lg(e){if(!e)return null;let t=Number(e);if(Number.isFinite(t)&&t>1800&&t<2100)return Math.trunc(t);if(typeof e=="string"){let n=e.match(/(19|20|21)\d{2}/);if(n)return Number(n[0])}return null}function ug(e){let t=[],n=r=>{if(!r||typeof r!="string")return;let o=r.trim();if(!o)return;let i=o.replace(/\s+/g," ");t.includes(i)||t.push(i)};if(Array.isArray(e==null?void 0:e.genres)){for(let r of e.genres)if(r){if(typeof r=="string"){n(r);continue}typeof r=="object"&&n(r.tag||r.title||r.label||r.name||"")}}if(Array.isArray(e==null?void 0:e.Genre))for(let r of e.Genre)n(typeof r=="string"?r:r==null?void 0:r.tag);return t.slice(0,3)}function dg(e){let t=[e==null?void 0:e.rating,e==null?void 0:e.audienceRating,e==null?void 0:e.userRating];for(let n of t){let r=Number(n);if(Number.isFinite(r)&&r>0)return _t(Math.round(r*10)/10,0,10)}return null}function fg(e){let t=[e==null?void 0:e.ratingCount,e==null?void 0:e.audienceRatingCount,e==null?void 0:e.userRatingCount,e==null?void 0:e.viewCount];for(let n of t){let r=Number(n);if(Number.isFinite(r)&&r>=0)return Math.trunc(r)}return 0}function gg(e){if(!e||typeof e!="object")return null;if(e.heroId!=null)return String(e.heroId);if(e.ids&&typeof e.ids=="object"){if(e.ids.imdb)return`imdb:${e.ids.imdb}`;if(e.ids.tmdb)return`tmdb:${e.ids.tmdb}`;if(e.ids.tvdb)return`tvdb:${e.ids.tvdb}`}if(e.guid)return String(e.guid);if(e.ratingKey!=null)return`rk:${e.ratingKey}`;if(e.id!=null)return String(e.id);if(e.slug)return String(e.slug);if(e.key!=null){let t=typeof e.key=="string"?e.key.trim():String(e.key);if(t)return t}if(e.title){let t=e.year?`:${e.year}`:"";return`title:${e.title}${t}`}return null}function hg(e,t){let n={new:0,topRated:0,oldButGold:0,random:0},r=e,o=t&&typeof t=="object"?t:{};Jn.forEach((s,a)=>{var u;if(a===Jn.length-1){n[s]=Math.max(0,r),r=0;return}let c=Number((u=o[s])==null?void 0:u.quota);if(!Number.isFinite(c)||c<=0){n[s]=0;return}let l=Math.max(0,Math.round(e*_t(c,0,1)));n[s]=Math.min(r,l),r-=n[s]});let i=0;for(;r>0;){let s=Jn[i%Jn.length];n[s]+=1,r-=1,i+=1}return n}function mg(e,t){let n=_t(Number(t==null?void 0:t.genre)||.4,.1,.9),r=_t(Number(t==null?void 0:t.year)||.35,.1,.9),o=Math.max(1,Math.round(e*_t(n*.5,.1,.35))),i=Math.max(1,Math.round(e*_t(r*.5,.1,.35)));return{perGenre:o,perYear:i}}function pg(e){if(!Array.isArray(e)||!e.length)return[];let t=Xe(),n=new Set,r=[];for(let o of e){if(!o||typeof o!="object")continue;let i=gg(o);if(!i||n.has(i))continue;n.add(i);let s=cg(o.addedAt||o.createdAt||o.added),a=lg(o.year||o.originallyAvailableAt),c=dg(o),l=fg(o),u=ug(o),d={id:i,raw:o,addedAt:s,year:a,rating:c!=null?c:0,voteCount:l,genres:u,isNew:s&&t-s<=rg,isOld:a?new Date().getUTCFullYear()-a>=og:!1};r.push(d)}return r}function bg(e){return e.slice().sort((t,n)=>(n.addedAt||0)-(t.addedAt||0))}function yg(e){return e.slice().sort((t,n)=>{let r=Number.isFinite(t.rating)?t.rating:0,o=Number.isFinite(n.rating)?n.rating:0;if(o!==r)return o-r;let i=(n.voteCount||0)-(t.voteCount||0);return i!==0?i:(n.addedAt||0)-(t.addedAt||0)})}function vg(e){return e.slice().sort((t,n)=>{let r=t.year||0,o=n.year||0;if(r&&o&&r!==o)return r-o;let i=(n.rating||0)-(t.rating||0);return i!==0?i:(n.addedAt||0)-(t.addedAt||0)})}function Sg(e){let t=e.slice();for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function Ua(e,t){let{caps:n,genreCounts:r,yearCounts:o}=e;if(n.perGenre>0&&t.genres&&t.genres.length){for(let i of t.genres)if((r.get(i)||0)>=n.perGenre)return!1}return!(n.perYear>0&&t.year&&(o.get(t.year)||0)>=n.perYear)}function xo(e,t,n){if(e.selected.push({...t,slot:n}),e.selectedIds.add(t.id),e.summary[n]=(e.summary[n]||0)+1,t.genres)for(let r of t.genres)e.genreCounts.set(r,(e.genreCounts.get(r)||0)+1);t.year&&e.yearCounts.set(t.year,(e.yearCounts.get(t.year)||0)+1)}function ke(e,t,n,r,{allowHistory:o=!1,filter:i}={}){if(t<=0)return 0;let s=[],a=[],c=[];for(let u of e){if(r.selected.length>=r.poolSize||r.summary[n]>=t)break;if(!r.selectedIds.has(u.id)&&!(i&&!i(u))&&Ua(r,u)){if(r.failureSet&&r.failureSet.has(u.id)){c.push(u);continue}if(r.memorySet&&r.memorySet.has(u.id)){a.push(u);continue}if(!o&&r.historySet&&r.historySet.has(u.id)){s.push(u);continue}xo(r,u,n)}}if(r.summary[n]>=t||r.selected.length>=r.poolSize)return r.summary[n];let l=u=>{for(let d of u){if(r.selected.length>=r.poolSize||r.summary[n]>=t)break;r.selectedIds.has(d.id)||Ua(r,d)&&xo(r,d,n)}};return a.length&&l(a),r.summary[n]<t&&s.length&&l(s),r.summary[n]<t&&c.length&&l(c),r.summary[n]}function Eg(e,t){for(let n of t){if(e.selected.length>=e.poolSize)break;e.selectedIds.has(n.id)||xo(e,n,"random")}}function en(e){let t={...e,timestamp:Xe()};for(let n of sg)try{n(t)}catch(r){Zn("Progress listener failed:",(r==null?void 0:r.message)||r)}try{typeof window!="undefined"&&typeof window.dispatchEvent=="function"&&typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent(ng,{detail:t}))}catch(n){Zn("Failed to dispatch progress event:",(n==null?void 0:n.message)||n)}}async function Ag(e,t,n={}){let r=[],o=e.length,{settings:i,auth:s,authOptions:a,signal:c,disableTmdb:l,kind:u,failureTtlMs:d}=n;for(let h=0;h<e.length;h++){let f=e[h];en({stage:"normalizing",index:h+1,total:o,slot:f.slot,id:f.id});let g=null,p="",m=!1;try{g=await Ta(f.raw,{language:t,settings:i,auth:s,authOptions:a,signal:c,disableTmdb:l})}catch(b){Zn("Failed to normalize hero candidate:",(b==null?void 0:b.message)||b),p=(b==null?void 0:b.message)||"",(b==null?void 0:b.code)==="RATE_LIMIT"&&(m=!0)}if(!g){if(u&&!m)try{Da(u,f.raw||f,{timestamp:Xe(),ttlMs:d,reason:p||"normalize"})}catch{}continue}if(u)try{za(u,f.raw||g)}catch{}g.slot=f.slot,g.poolSlot=f.slot,g.poolId=f.id,r.push(g)}return r}function Ga(e,t,n,r,o,i){let s=Object.values(t).reduce((g,p)=>g+p,0),a={poolSize:s,caps:mg(s,n),selected:[],summary:{new:0,topRated:0,oldButGold:0,random:0},genreCounts:new Map,yearCounts:new Map,selectedIds:new Set,historySet:(r==null?void 0:r.set)||new Set,memorySet:(o==null?void 0:o.set)||new Set,failureSet:(i==null?void 0:i.set)||new Set},c=pg(e),l=bg(c),u=yg(c),d=vg(c.filter(g=>g.isOld)),h=Sg(c);ke(l,t.new,"new",a,{allowHistory:!1,filter:g=>g.isNew}),ke(l,t.new,"new",a,{allowHistory:!1}),ke(l,t.new,"new",a,{allowHistory:!0}),ke(u,t.topRated,"topRated",a,{allowHistory:!1}),ke(u,t.topRated,"topRated",a,{allowHistory:!0}),ke(d,t.oldButGold,"oldButGold",a,{allowHistory:!1}),ke(d,t.oldButGold,"oldButGold",a,{allowHistory:!0});let f=h.filter(g=>!a.selectedIds.has(g.id));if(ke(f,t.random,"random",a,{allowHistory:!1}),ke(f,t.random,"random",a,{allowHistory:!0}),a.selected.length<s){let g=c.filter(p=>!a.selectedIds.has(p.id));Eg(a,g)}return a}function wg(e,t,n={}){let r=Xe(),o=Ct(e,{now:r,policyHash:t});if(!o||!Array.isArray(o.items)||!o.items.length)return null;if(o.isExpired){if(n.allowGrace){let{graceMs:i}=Jt();if(i&&i>0&&o.expiresAt+i>r)return en({stage:"cache",status:"grace",kind:e,size:o.items.length}),{...o,fromCache:!0}}return null}return en({stage:"cache",status:"hit",kind:e,size:o.items.length}),{...o,fromCache:!0}}async function Wa(e,t,n={}){let r=n.policy||St(),o=qa(e),i=ag(r,o),s=!n.force&&wg(o,i,{allowGrace:!0});if(s)return s;if(n.force){try{$a(o)}catch{}try{ja(o)}catch{}}let a=o==="series"?r.poolSizeSeries:r.poolSizeMovies;if(!a||a<=0)return{items:[],summary:{},fromCache:!1,updatedAt:Xe(),expiresAt:0};en({stage:"start",kind:o,total:a});let c=hg(a,r.slots),l=Jt(),u=Xe(),d=(()=>{let F=Math.max(0,l.ttlMs||0)+Math.max(0,l.graceMs||0);return F>0?F:Ka})(),h=Io(o,{windowMs:Ka,limit:Yn}),f=Ha(o,{now:u,windowMs:d,limit:Math.max(Yn*2,a*2)}),g=Oa(o,{now:u,windowMs:d}),p=Ga(t,c,{...r.diversity,kind:o},h,f,g);if(p.selected.length<a&&h.entries.length){let F=Io(o,{windowMs:ig,limit:Yn});p=Ga(t,c,{...r.diversity,kind:o},F,f,g)}let m=p.selected.slice(0,a),S=(await Ag(m,r.language||"en-US",{...n.tmdb,kind:o,failureTtlMs:d})).slice(0,a),k=Xe(),L=k+(l.ttlMs||0),C={kind:o,items:S,updatedAt:k,expiresAt:L,policyHash:i,slotSummary:p.summary,meta:{plan:c,totalCandidates:(t==null?void 0:t.length)||0,selectionCount:S.length}};try{Ra(o,S,{timestamp:k,ttlMs:d,limit:Math.max(Yn*2,a*2)})}catch{}return La(o,C),en({stage:"done",kind:o,size:S.length,updatedAt:k}),{...C,fromCache:!1}}async function Va(e,t,n={}){return Wa(e,t,n)}function Xa(e,t,n={}){return Wa(e,t,{...n,force:!0})}var ng,Ka,Yn,rg,og,ig,Jn,sg,Ya=M(()=>{Ca();zn();Xn();ng="hero:pool-progress",Ka=1e3*60*60*24*7,Yn=60,rg=1e3*60*60*24*90,og=12,ig=1e3*60*60*24*30,Jn=["new","topRated","oldButGold","random"],sg=new Set});function nn(...e){try{}catch{}}function Za(){return Date.now()}function er(e){return e==="show"||e==="shows"||e==="series"?"series":"movies"}function Cg(e,t){return e===t?!0:!e||!t?!1:e.active===t.active&&e.until===t.until&&e.retryAfterMs===t.retryAfterMs&&e.lastStatus===t.lastStatus&&e.strikes===t.strikes}function _g(){if(Ja)return;try{w.tmdb.rateLimit={...va()}}catch{w.tmdb.rateLimit={active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}}Ja=Sa(t=>{let n=t?{...t}:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0};Cg(w.tmdb.rateLimit,n)||(w.tmdb.rateLimit=n,Le())})}function Qa(e){return{kind:e,state:"idle",regenerating:!1,size:0,updatedAt:0,expiresAt:0,fromCache:!1,source:"",policyHash:"",slotSummary:{},matchesPolicy:!0,isExpired:!1,lastError:null,lastRefresh:0}}function ec(e){if(!e)return null;let t={...e};return t.slotSummary=e.slotSummary?{...e.slotSummary}:{},t}function Ig(){if(typeof localStorage=="undefined")return null;try{let e=localStorage.getItem(kg);if(e==="1"||e==="0")return e}catch(e){nn("Failed to read feature flag:",(e==null?void 0:e.message)||e)}return null}function xg(e){let t=Ig();return t!=null?{enabled:t==="1",source:"localStorage"}:e&&typeof e.heroPipelineEnabled=="boolean"?{enabled:!!e.heroPipelineEnabled,source:"config.heroPipelineEnabled"}:e&&e.features&&typeof e.features.heroPipeline=="boolean"?{enabled:!!e.features.heroPipeline,source:"config.features.heroPipeline"}:{enabled:!0,source:"default"}}function rn(){return{enabled:w.enabled,featureSource:w.featureSource,ready:w.ready,activeKind:w.activeKind,tmdb:{allowed:w.tmdb.allowed,active:w.tmdb.active,rateLimit:w.tmdb.rateLimit?{...w.tmdb.rateLimit}:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}},status:{movies:ec(w.status.movies),series:ec(w.status.series)},pools:{movies:w.pools.movies.slice(),series:w.pools.series.slice()}}}function Le(){let e=rn();for(let t of Fo)try{t(e)}catch(n){nn("Listener failed:",(n==null?void 0:n.message)||n)}try{typeof window!="undefined"&&typeof window.dispatchEvent=="function"&&typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent(Tg,{detail:e}))}catch(t){nn("Failed to dispatch pipeline event:",(t==null?void 0:t.message)||t)}return e}function tn(e,t){let n=er(e),r=w.status[n];if(!r)return;let o={...t};o.slotSummary&&(o.slotSummary={...o.slotSummary}),w.status[n]={...r,...o}}function It(){if(!w.enabled){w.ready=!0;return}let t=["movies","series"].every(n=>{let r=w.status[n];return r?r.state==="ready"||r.state==="error"||r.state==="stale":!1});w.ready=t}function tc(e){let t=er(e),n=Ct(t,{allowExpired:!0});n&&(w.pools[t]=Array.isArray(n.items)?n.items.slice():[],tn(t,{state:n.isExpired?"stale":"ready",regenerating:!1,size:w.pools[t].length,updatedAt:Number(n.updatedAt)||0,expiresAt:Number(n.expiresAt)||0,fromCache:!0,source:n.source||"cache",policyHash:n.policyHash||"",slotSummary:n.slotSummary||{},matchesPolicy:n.matchesPolicy!==!1,isExpired:!!n.isExpired}))}function Fg(){w.sources.movies||(w.sources.movies=[]),w.sources.series||(w.sources.series=[])}function Mg(){let e=Pt(),n=!(w.tmdb.allowed&&e),r={};if(w.cfg&&typeof w.cfg=="object"){let o=w.cfg.tmdbToken||w.cfg.tmdbApiKey;o&&(r.fallbackCredential=o)}return{disableTmdb:n,settings:w.cfg,authOptions:Object.keys(r).length?r:void 0}}async function Mo(e,{force:t=!1}={}){let n=er(e);if(!w.enabled)return tn(n,{state:"disabled",regenerating:!1}),It(),null;if(Fg(),w.inFlight.has(n))return w.inFlight.get(n);let r=n==="series"?w.sources.series:w.sources.movies;tn(n,{state:"loading",regenerating:!0,lastError:null}),Le();let o=t?Xa:Va,i={policy:w.policy||void 0,tmdb:Mg()},s=o(n,r,i).then(a=>{let c=a||{},l=Array.isArray(c.items)?c.items.slice():[];return w.pools[n]=l,tn(n,{state:(c.items,"ready"),regenerating:!1,size:l.length,updatedAt:Number(c.updatedAt)||Za(),expiresAt:Number(c.expiresAt)||0,fromCache:!!c.fromCache,source:c.source||(c.fromCache?"cache":"fresh"),policyHash:c.policyHash||"",slotSummary:c.slotSummary||{},matchesPolicy:c.matchesPolicy!==!1,isExpired:!1,lastError:null,lastRefresh:Za()}),It(),Le(),c}).catch(a=>{throw nn("Failed to build hero pool for",n,(a==null?void 0:a.message)||a),tn(n,{state:"error",regenerating:!1,lastError:(a==null?void 0:a.message)||String(a)}),It(),Le(),a}).finally(()=>{w.inFlight.delete(n)});return w.inFlight.set(n,s),s}function Lg(){let e=new Date,t=e.getUTCFullYear(),n=Date.UTC(t,0,1),r=Date.UTC(t,e.getUTCMonth(),e.getUTCDate()),o=Math.max(0,r-n);return Math.floor(o/(24*60*60*1e3))}function Ng(e,t){let n=String((e==null?void 0:e.poolId)||(e==null?void 0:e.id)||"").toLowerCase(),r=String((t==null?void 0:t.poolId)||(t==null?void 0:t.id)||"").toLowerCase();return n<r?-1:n>r?1:0}function Pg(e,t){var u,d;let n=er(e),r=((u=t==null?void 0:t.pools)==null?void 0:u[n])||[];if(!Array.isArray(r)||!r.length)return{items:[],startIndex:0};let o=r.slice().sort(Ng),i=((d=t.status)==null?void 0:d[n])||{},s=i.updatedAt?Math.floor(Number(i.updatedAt)/(24*60*60*1e3)):0,a=n==="series"?7:0,c=Lg()+s+a,l=o.length?c%o.length:0;return{items:o,startIndex:l}}function nc({cfg:e,policy:t}={}){w.cfg=e||{},w.policy=t||null;let n=xg(e);return w.enabled=!!n.enabled,w.featureSource=n.source,w.tmdb.allowed=!!(e!=null&&e.tmdbEnabled),w.tmdb.active=w.tmdb.allowed&&Pt(),_g(),tc("movies"),tc("series"),It(),Le(),{enabled:w.enabled,source:w.featureSource}}function rc({movies:e=[],shows:t=[]}={}){w.sources={movies:Array.isArray(e)?e:[],series:Array.isArray(t)?t:[]}}function tr(e){let t=e==="shows"||e==="series"?"series":"movies";w.activeKind!==t&&(w.activeKind=t,Le())}async function oc(e={}){if(!w.enabled)return It(),{skipped:!0};let n=(e.kinds||["movies","series"]).map(o=>Mo(o)),r=await Promise.allSettled(n);return It(),Le(),r}function Lo(e,t={}){return Mo(e,t)}function Qn(e,t={}){return Mo(e,{...t,force:!0})}function ic(){return w.enabled?Promise.all([Qn("movies"),Qn("series")]):Promise.resolve({skipped:!0})}function nr(e){let t=!!(w.tmdb.allowed&&Pt());w.tmdb.active!==t&&(w.tmdb.active=t,Le())}function me(){return!!w.enabled}function rr(){return!!w.ready}function sc(){return rn()}function xt(e){let t=rn();return{...Pg(e,t),snapshot:t}}function or(e){if(typeof e!="function")return()=>{};Fo.add(e);try{e(rn())}catch(t){nn("Initial listener invocation failed:",(t==null?void 0:t.message)||t)}return()=>Fo.delete(e)}function ac(){let e=rn();return{enabled:e.enabled,featureSource:e.featureSource,ready:e.ready,tmdb:e.tmdb,status:e.status,poolSizes:{movies:e.pools.movies.length,series:e.pools.series.length}}}var kg,Tg,Fo,Ja,w,on=M(()=>{Ya();Xn();ye();Eo();kg="feature.heroPipeline",Tg="hero:pipeline-update",Fo=new Set,Ja=null,w={cfg:{},policy:null,enabled:!0,featureSource:"default",ready:!1,sources:{movies:[],series:[]},pools:{movies:[],series:[]},status:{movies:Qa("movies"),series:Qa("series")},tmdb:{allowed:!1,active:!1,rateLimit:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}},activeKind:"movies",inFlight:new Map}});function lc(){let e=document.getElementById("openDebug");e&&e.addEventListener("click",()=>{Bg()})}function Bg(){var t,n,r,o;let e=document.getElementById("debugOverlay");e||(e=document.createElement("div"),e.id="debugOverlay",e.className="debug-overlay",e.innerHTML=`
      <div class="debug-dialog">
        <div class="debug-header"><h2>Debug</h2></div>
        <div class="debug-body">
          <pre id="debugPre" class="debug-pre"></pre>
          <div class="debug-cache-controls">
            <h3>Cache-Verwaltung</h3>
            <div id="cacheStats" class="cache-stats"></div>
            <div class="cache-buttons">
              <button id="debugClearExpired" class="btn">Abgelaufene l\xF6schen</button>
              <button id="debugClearAll" class="btn">Alles l\xF6schen</button>
            </div>
          </div>
        </div>
        <div class="debug-actions">
          <button id="debugCopy" class="btn">Copy report</button>
          <button id="debugClose" class="btn">Schlie\xDFen</button>
        </div>
      </div>`,document.body.append(e)),e.hidden=!1,No(),e.addEventListener("click",i=>{i.target===e&&cc()}),(t=document.getElementById("debugClose"))==null||t.addEventListener("click",cc,{once:!0}),(n=document.getElementById("debugCopy"))==null||n.addEventListener("click",Rg,{once:!0}),(r=document.getElementById("debugClearExpired"))==null||r.addEventListener("click",()=>{fn(),No()},{once:!0}),(o=document.getElementById("debugClearAll"))==null||o.addEventListener("click",()=>{confirm("Wirklich den gesamten Cache l\xF6schen?")&&(ei(),No())},{once:!0})}function cc(){let e=document.getElementById("debugOverlay");e&&(e.hidden=!0)}function No(){var u,d,h,f,g,p,m,b;let e=document.getElementById("debugPre");if(!e)return;let t=I(),n=pi(),r=t.cfg||{},o=gr(),i=St(),s=Dn(),a=ac(),c={view:t.view,counts:{movies:(t.movies||[]).length,shows:(t.shows||[]).length,filtered:(t.filtered||[]).length},dataSources:n,cache:o,heroPolicy:{policy:i,language:ia(),pools:Qs(),slots:ea(),diversity:ta(),rotation:na(),textClamp:ra(),fallback:oa(),cache:Jt(),loadedAt:sa(),issues:s},heroCache:a,tmdb:{enabled:!!r.tmdbEnabled,lang:r.lang,tokenPresent:!!(localStorage.getItem("tmdbToken")||r.tmdbApiKey)},useTmdbImages:localStorage.getItem("useTmdb")==="1",reduceMotion:localStorage.getItem("prefReduceMotion")==="1",locationHash:location.hash,userAgent:navigator.userAgent};e.textContent=JSON.stringify(c,null,2);let l=document.getElementById("cacheStats");if(l&&o){let S=((u=a==null?void 0:a.status)==null?void 0:u.movies)||{},k=((d=a==null?void 0:a.status)==null?void 0:d.series)||{},L=F=>{if(!Number.isFinite(F)||F<=0)return"n/a";try{return new Date(F).toLocaleString()}catch{return"n/a"}},C=a!=null&&a.enabled?`aktiv (Quelle: ${a.featureSource||"default"})`:`deaktiviert (Quelle: ${(a==null?void 0:a.featureSource)||"default"})`;l.innerHTML=`
      <p>Eintr\xE4ge gesamt: <strong>${o.totalEntries}</strong></p>
      <p>G\xFCltig: <strong>${o.validEntries}</strong> | Abgelaufen: <strong>${o.expiredEntries}</strong></p>
      <p>Gr\xF6\xDFe: <strong>${o.totalSizeMB} MB</strong></p>
      <p>Hero-Pipeline: <strong>${C}</strong></p>
      <p>Filme: <strong>${(g=(f=S.size)!=null?f:(h=a==null?void 0:a.poolSizes)==null?void 0:h.movies)!=null?g:0}</strong> Eintr\xE4ge \xB7 Update: <strong>${L(S.updatedAt)}</strong> \xB7 Ablauf: <strong>${L(S.expiresAt)}</strong></p>
      <p>Serien: <strong>${(b=(m=k.size)!=null?m:(p=a==null?void 0:a.poolSizes)==null?void 0:p.series)!=null?b:0}</strong> Eintr\xE4ge \xB7 Update: <strong>${L(k.updatedAt)}</strong> \xB7 Ablauf: <strong>${L(k.expiresAt)}</strong></p>
    `}}function Rg(){var n;let e=document.getElementById("debugPre");if(!e)return;let t=e.textContent||"";(n=navigator.clipboard)==null||n.writeText(t).catch(r=>{try{let o=document.createElement("textarea");o.value=t,document.body.append(o),o.select(),document.execCommand("copy"),o.remove()}catch{}})}var uc=M(()=>{Y();rt();hr();zn();on()});function fc(e){Po=typeof e=="function"?e:null}function gc(e){Bo=typeof e=="function"?e:null}function sr(e){if(Po)try{Po(e)}catch{}}function $g(e){if(Bo)try{Bo(e)}catch{}}function hc(e){let t=document.getElementById("settingsOverlay"),n=t==null?void 0:t.querySelector(".settings-dialog"),r=document.getElementById("settingsBtn"),o=document.getElementById("openSettings"),i=document.getElementById("headerSettingsBtn"),s=document.getElementById("settingsClose2"),a=document.getElementById("tmdbTokenInput"),c=document.getElementById("tmdbSave"),l=document.getElementById("tmdbTest"),u=document.getElementById("tmdbStatus"),d=document.getElementById("tmdbClearCache"),h=document.getElementById("tmdbStatusBadge"),f=document.getElementById("prefReduceMotion"),g=document.getElementById("useTmdbSetting"),p=document.getElementById("resetFilters"),m=t==null?void 0:t.querySelector(".settings-body"),b=document.getElementById("heroCacheStatus"),S=document.getElementById("heroRefreshMovies"),k=document.getElementById("heroRefreshShows"),L=document.getElementById("heroRefreshAll");if(!b&&m){let v=document.createElement("div");v.className="settings-row",v.innerHTML=`
      <div class="settings-inline" id="heroRefreshControls">
        <button type="button" id="heroRefreshMovies" class="secondary">Highlights Filme aktualisieren</button>
        <button type="button" id="heroRefreshShows" class="secondary">Highlights Serien aktualisieren</button>
        <button type="button" id="heroRefreshAll" class="secondary">Alle Highlights aktualisieren</button>
      </div>
      <p class="settings-help" id="heroCacheStatus" aria-live="polite"></p>
    `,m.append(v),b=v.querySelector("#heroCacheStatus"),S=v.querySelector("#heroRefreshMovies"),k=v.querySelector("#heroRefreshShows"),L=v.querySelector("#heroRefreshAll")}let C=[S,k,L].filter(Boolean),F=null;function X(v,A){C.forEach(E=>{E&&(E.disabled=v||!me(),E.disabled&&A?E.dataset.heroBusy=A:E.removeAttribute("data-hero-busy"))})}function ie(v){if(!Number.isFinite(v)||v<=0)return"unbekannt";try{return new Date(v).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return"unbekannt"}}function de(v){if(!Number.isFinite(v)||v<=0)return"kein Ablauf";let A=v-Date.now();if(A<=0)return"abgelaufen";let E=A/6e4;if(E<1)return"l\xE4uft in <1 Min ab";if(E<60)return`l\xE4uft in ${Math.round(E)} Min ab`;let _=E/60;if(_<24)return`l\xE4uft in ${Math.round(_)} Std ab`;let $=_/24;return`l\xE4uft in ${Math.round($)} Tg ab`}function fe(v,A){if(!A)return`${v}: keine Daten`;if(A.state==="disabled")return`${v}: deaktiviert`;if(A.state==="loading"||A.regenerating)return`${v}: wird aktualisiert \u2026`;if(A.state==="error")return`${v}: Fehler (${A.lastError||"unbekannt"})`;if(A.state==="stale")return`${v}: ${A.size} Eintr\xE4ge (Cache abgelaufen)`;let E=ie(A.updatedAt),_=de(A.expiresAt);return`${v}: ${A.size} Eintr\xE4ge (Update ${E}, ${_})`}function y(v){var _,$,Je,Ze,Qe,an;if(!b)return;if(!v||!me()||v.enabled===!1){b.textContent="Hero-Pipeline deaktiviert \u2013 Legacy-Hero aktiv.",X(!0,"disabled");return}let A=!!(($=(_=v.status)==null?void 0:_.movies)!=null&&$.regenerating||(Ze=(Je=v.status)==null?void 0:Je.series)!=null&&Ze.regenerating);X(A,A?"busy":"");let E=[];E.push(fe("Filme",(Qe=v.status)==null?void 0:Qe.movies)),E.push(fe("Serien",(an=v.status)==null?void 0:an.series)),v.tmdb&&(v.tmdb.allowed?E.push(`TMDb ${v.tmdb.active?"aktiv":"aus (Toggle)"}`):E.push("TMDb deaktiviert")),v.featureSource&&E.push(`Feature-Flag: ${v.featureSource}`),b.textContent=E.join(" \u2022 ")}async function T(v="all",A="Highlights aktualisieren \u2026"){if(!me())return;if(F)try{await F}catch{}return b&&A&&(b.textContent=A),X(!0,"busy"),F=(v==="movies"||v==="series"?Qn(v):ic()).then(()=>{sr()}).catch(_=>{}).finally(()=>{F=null,X(!1)}),F}or(y),t&&t.hidden&&t.setAttribute("aria-hidden","true");let x=null,N="",P=!1,B=new Map,O='a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])';function j(){return t?Array.from(t.querySelectorAll(O)).filter(v=>!v.hasAttribute("disabled")&&v.getAttribute("aria-hidden")!=="true"):[]}function se(){n&&typeof n.focus=="function"?n.focus({preventScroll:!0}):t&&typeof t.focus=="function"&&t.focus({preventScroll:!0})}function Ne(v){if(!t)return;let A=Array.from(document.body.children).filter(E=>E!==t);v?A.forEach(E=>{B.has(E)||B.set(E,{ariaHidden:E.hasAttribute("aria-hidden")?E.getAttribute("aria-hidden"):null,inert:E.hasAttribute("inert")}),E.setAttribute("aria-hidden","true"),E.setAttribute("inert","")}):(A.forEach(E=>{let _=B.get(E);_?(_.ariaHidden===null||_.ariaHidden===void 0?E.removeAttribute("aria-hidden"):E.setAttribute("aria-hidden",_.ariaHidden),_.inert?E.setAttribute("inert",""):E.removeAttribute("inert"),B.delete(E)):(E.removeAttribute("aria-hidden"),E.removeAttribute("inert"))}),B.clear())}function pe(){!t||P||(P=!0,t.hidden=!1,t.setAttribute("aria-hidden","false"),x=document.activeElement instanceof HTMLElement?document.activeElement:null,N=document.body.style.overflow,document.body.style.overflow="hidden",Ne(!0),Fc(),requestAnimationFrame(se))}function cr(){!t||!P||(P=!1,t.hidden=!0,t.setAttribute("aria-hidden","true"),Ne(!1),document.body.style.overflow=N,x&&typeof x.focus=="function"&&x.focus(),x=null)}function xc(v){if(!P)return;if(v.key==="Escape"){v.preventDefault(),cr();return}if(v.key!=="Tab")return;let A=j();if(!A.length){v.preventDefault(),se();return}let E=A[0],_=A[A.length-1],$=document.activeElement;v.shiftKey?($===E||!t.contains($))&&(v.preventDefault(),_.focus()):$===_&&(v.preventDefault(),E.focus())}r&&r.addEventListener("click",pe),o&&o.addEventListener("click",()=>{pe()}),i&&i.addEventListener("click",pe),s&&s.addEventListener("click",cr),t&&t.addEventListener("click",v=>{v.target===t&&cr()}),t&&t.addEventListener("keydown",xc);function R(v="",A=""){if(u){u.textContent=v,u.dataset.kind=A,h&&(h.dataset.kind=A||"",h.title=v||"");try{if(A==="error"&&e&&e.tmdbApiKey){let E=String(localStorage.getItem("tmdbToken")||"").trim(),_=String((a==null?void 0:a.value)||"").trim();if(E&&_){try{localStorage.removeItem("tmdbToken")}catch{}a&&(a.value=""),Ce(!0);let $="Ung\xFCltiger Token entfernt. Verwende API Key aus config.json.";u.textContent=$,u.dataset.kind="info",h&&(h.dataset.kind="info",h.title=$)}}}catch{}}}function Ce(v){if(g&&(g.disabled=!v,g.title=g.disabled?"Nur verf\xFCgbar mit g\xFCltigem Token oder API Key.":"",!v&&g.checked)){try{localStorage.setItem("useTmdb","0")}catch{}g.checked=!1,ee(I().view),sr()}}function Fc(){let v="";try{a&&(a.value=v=localStorage.getItem("tmdbToken")||"")}catch{}try{f&&(f.checked=localStorage.getItem("prefReduceMotion")==="1")}catch{}try{g&&(g.checked=localStorage.getItem("useTmdb")==="1",g.disabled=!v,g.title=g.disabled?"Nur verf\xFCgbar mit g\xFCltigem Token.":"")}catch{}try{Ce(!!v||!!(e&&e.tmdbApiKey))}catch{}R("",""),e&&e.tmdbEnabled===!1?R("\u26A0\uFE0F TMDB ist in config.json deaktiviert (tmdbEnabled: false). Hero-Banner ben\xF6tigt TMDB!","error"):v||R("Kein Token hinterlegt. TMDB ist deaktiviert.","info"),v?(async()=>{var A;R("Pr\xFCfe Token...","pending");try{let E=await Promise.resolve().then(()=>(We(),yt)),_=await((A=E.validateToken)==null?void 0:A.call(E,v));_&&_.ok?(Ce(!0),_.as==="bearer"?R("Token g\xFCltig (v4 Bearer).","success"):_.as==="apikey"&&R('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success")):(Ce(!1),(_==null?void 0:_.hint)==="looksV3"?R('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):R("Token ung\xFCltig oder keine Berechtigung (401).","error"))}catch{R("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}})():Ce(!!(e&&e.tmdbApiKey))}S&&S.addEventListener("click",()=>{T("movies","Aktualisiere Film-Highlights \u2026")}),k&&k.addEventListener("click",()=>{T("series","Aktualisiere Serien-Highlights \u2026")}),L&&L.addEventListener("click",()=>{T("all","Aktualisiere alle Highlights \u2026")}),c&&c.addEventListener("click",async()=>{var A,E;let v=String((a==null?void 0:a.value)||"").trim();try{localStorage.setItem("tmdbToken",v)}catch{}if(!v){lt(e,{preferStoredToken:!1,token:""}),R("Kein Token hinterlegt. TMDB ist deaktiviert.","info"),Ce(!!(e&&e.tmdbApiKey)),nr((A=g==null?void 0:g.checked)!=null?A:!1),T("all","Highlights aktualisieren (Token entfernt)\u2026");return}lt(e,{preferStoredToken:!1,token:v}),R("Pr\xFCfe Token...","pending");try{let _=await Promise.resolve().then(()=>(We(),yt)),$=await((E=_.validateToken)==null?void 0:E.call(_,v));$&&$.ok?(Ce(!0),$.as==="bearer"?R("Token g\xFCltig (v4 Bearer).","success"):$.as==="apikey"&&R('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success")):(Ce(!1),($==null?void 0:$.hint)==="looksV3"?R('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):R("Token ung\xFCltig oder keine Berechtigung (401).","error"))}catch{R("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}e&&e.tmdbEnabled===!1&&v&&R('\u26A0\uFE0F Token gespeichert, aber TMDB in config.json deaktiviert. Bitte "tmdbEnabled": true setzen!',"error"),nr(!0),T("all","Highlights aktualisieren (Token ge\xE4ndert)\u2026")}),l&&l.addEventListener("click",async()=>{var A;let v=String((a==null?void 0:a.value)||"").trim();if(!v){R("Bitte Token eingeben.","error");return}R("Pr\xFCfe Token...","pending");try{let E=await Promise.resolve().then(()=>(We(),yt)),_=await((A=E.validateToken)==null?void 0:A.call(E,v));_&&_.ok?_.as==="bearer"?R("Token g\xFCltig (v4 Bearer).","success"):_.as==="apikey"&&R('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success"):(_==null?void 0:_.hint)==="looksV3"?R('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):R("Token ung\xFCltig oder keine Berechtigung (401).","error")}catch{R("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}}),d&&d.addEventListener("click",()=>{Promise.resolve().then(()=>(ye(),vi)).then(v=>{var E;let A=(E=v.clearHeroCache)==null?void 0:E.call(v);A&&!A.error&&R(`Cache geleert: ${A.heroEntries} Hero-Eintr\xE4ge, ${A.tmdbCacheEntries} TMDB-Eintr\xE4ge. Token erhalten.`,"success")}),Promise.resolve().then(()=>(We(),yt)).then(v=>{var A;return(A=v.clearCache)==null?void 0:A.call(v)}),T("all","Highlights aktualisieren (TMDB-Cache geleert)\u2026")}),f&&f.addEventListener("change",()=>{try{localStorage.setItem("prefReduceMotion",f.checked?"1":"0")}catch{}$g(f.checked)}),g&&g.addEventListener("change",()=>{try{localStorage.setItem("useTmdb",g.checked?"1":"0")}catch{}g.checked&&!dc&&(dc=!0,Promise.resolve().then(()=>(We(),yt)).then(v=>{var E;let A=I();(E=v.hydrateOptional)==null||E.call(v,A.movies,A.shows,A.cfg)}).catch(v=>{}),setTimeout(()=>{g.checked&&ee(I().view)},1200),setTimeout(()=>{g.checked&&ee(I().view)},3e3)),nr(!0),ee(I().view),sr()}),p&&p.addEventListener("click",()=>{let v=document.getElementById("search");v&&(v.value="");let A=document.getElementById("q");A&&(A.value="");let E=document.getElementById("onlyNew");E&&(E.checked=!1);let _=document.getElementById("yearFrom"),$=document.getElementById("yearTo");_&&(_.value=""),$&&($.value="");let Je=document.getElementById("collectionFilter");Je&&(Je.value=""),document.querySelectorAll("#genreFilters .chip.active").forEach(Qe=>Qe.classList.remove("active"));let Ze=document.getElementById("genreFilters");Ze&&(Ze.dataset.state="empty",Ze.dataset.count="0"),Promise.resolve().then(()=>(go(),fo)).then(Qe=>{let an=Qe.applyFilters();ee(I().view),sr(an)})})}var Po,Bo,dc,mc=M(()=>{Y();Pn();on();ut();Po=null,Bo=null,dc=!1});function zo(e){return Ft=e||null,Ft}function Sc(){var t,n,r,o,i,s,a,c;if(Ro)return Ro;let e={title:((n=(t=document.getElementById("heroTitle"))==null?void 0:t.textContent)==null?void 0:n.trim())||"",tagline:((o=(r=document.getElementById("heroTagline"))==null?void 0:r.textContent)==null?void 0:o.trim())||"",overview:((s=(i=document.getElementById("heroOverview"))==null?void 0:i.textContent)==null?void 0:s.trim())||"",cta:((c=(a=document.getElementById("heroCta"))==null?void 0:a.textContent)==null?void 0:c.trim())||""};return Ro=e,e}function Ec(e){$o=typeof e=="function"?e:null}function Ac(e="default",t={}){let n=document.getElementById("hero"),r=document.getElementById("heroTitle"),o=document.getElementById("heroTagline"),i=document.getElementById("heroOverview"),s=document.getElementById("heroCta"),a=document.getElementById("heroMeta"),c=document.getElementById("heroMetaPrimary"),l=document.getElementById("heroMetaSecondary"),u=document.getElementById("heroMetaTertiary"),d=document.getElementById("heroPicture"),h=document.getElementById("heroBackdropImage"),f=document.getElementById("heroBackdropLarge"),g=document.getElementById("heroBackdropMedium");if(!n||!r||!o||!i||!s||!a)return!1;let p=Sc(),m={...pc.default,...pc[e]||{},...t||{}};zo(null),Do=e,n.dataset.heroKind="fallback",n.dataset.heroId="",n.dataset.state="fallback",n.classList.remove("hero--has-media"),jo(d,h,f,g),r.textContent=m.title||p.title;let b=m.tagline||"";o.textContent=b||p.tagline,o.hidden=!b,o.dataset.taglinePaused="0",delete o.dataset.heroBound,o.classList.remove("is-fading");let S=m.overview||"";i.textContent=S,i.hidden=!S;let k=m.cta||p.cta||s.textContent||"Browse featured titles";s.textContent=k;let L=typeof m.ctaAction=="function"&&m.ctaEnabled===!0;return s.disabled=!L,s.setAttribute("aria-disabled",L?"false":"true"),L?(s.onclick=()=>{try{m.ctaAction()}catch{}},s.setAttribute("aria-label",m.ctaLabel||k)):(s.onclick=null,s.removeAttribute("aria-label")),a.hidden=!0,c&&(c.innerHTML=""),l&&(l.innerHTML=""),u&&(u.innerHTML=""),!0}function Ye(e){var L,C;let t=document.getElementById("hero"),n=document.getElementById("heroTitle"),r=document.getElementById("heroTagline"),o=document.getElementById("heroOverview"),i=document.getElementById("heroCta"),s=document.getElementById("heroMeta"),a=document.getElementById("heroMetaPrimary"),c=document.getElementById("heroMetaSecondary"),l=document.getElementById("heroMetaTertiary"),u=document.getElementById("heroPicture"),d=document.getElementById("heroBackdropImage"),h=document.getElementById("heroBackdropLarge"),f=document.getElementById("heroBackdropMedium");if(!t||!n||!r||!o||!i||!s)return;let g=Sc(),p=zg(e);if(!p){zo(null),Do=null,t.dataset.heroKind="",t.dataset.heroId="",t.dataset.state="empty",t.classList.remove("hero--has-media"),jo(u,d,h,f),n.textContent=g.title,r.textContent=g.tagline,r.hidden=!g.tagline,r.dataset.taglinePaused="0",delete r.dataset.heroBound,r.classList.remove("is-fading"),o.textContent=g.overview,o.hidden=!g.overview,i.textContent=g.cta||"View details",i.disabled=!0,i.setAttribute("aria-disabled","true"),i.removeAttribute("aria-label"),i.onclick=null,s.hidden=!0,a&&(a.innerHTML=""),c&&(c.innerHTML=""),l&&(l.innerHTML="");return}let m=wc(p);if(!m)return Ye([]);zo(m),Do=null;let b=m.type==="tv"?"show":"movie",S=((L=m.cta)==null?void 0:L.id)||m.id||"";try{Ba(b==="show"?"series":"movies",m)}catch{}if(t.dataset.heroKind=b,t.dataset.heroId=S,t.dataset.state="ready",n.textContent=m.title||g.title,r){let F=m.tagline||"";r.textContent=F,r.hidden=!F,r.dataset.taglinePaused=F?"1":"0",F?r.dataset.heroBound="1":delete r.dataset.heroBound,r.classList.remove("is-fading")}if(o){let F=m.overview||"";o.textContent=F,o.hidden=!F}let k=((C=m.cta)==null?void 0:C.label)||(b==="show"?"View show details":"View movie details");i.textContent=k,i.disabled=!1,i.setAttribute("aria-disabled","false"),i.setAttribute("aria-label",m.title?`${k}: ${m.title}`:k),i.onclick=()=>oh(m),eh(a,c,l,s,m),nh(t,u,d,h,f,m)}function zg(e){if(Array.isArray(e)&&e.length){let n=Oo(e);if(n.length)return bc(n)}let t=jg();return t.length?bc(t):null}function Oo(e){if(!Array.isArray(e))return[];let t=[];return e.forEach(n=>{if(!Og(n))return;let r=wc(n);r&&t.push(r)}),t}function Og(e){return!(!e||typeof e!="object"||e.isCollectionGroup||(typeof e.type=="string"?e.type.toLowerCase():"")==="collection")}function bc(e){if(e.length===1)return e[0];let t=Math.floor(Math.random()*e.length),n=e[t];return Ft&&e.length>1&&n&&Ft&&n.id===Ft.id&&e.find(o=>o&&o.id!==Ft.id)||n}function jg(){let e=I(),t=e.view==="shows"?"series":"movies",n=Ct(t,{allowExpired:!0})||null,r=Array.isArray(n==null?void 0:n.items)?Oo(n.items):[];if(r.length)return r;let i=(Array.isArray(e.filtered)&&e.filtered.length?e.filtered:null)||(t==="series"?e.shows:e.movies)||[];return Oo(i)}function wc(e){return!e||typeof e!="object"?null:Kg(e)?{...e,cta:e.cta?{...e.cta}:null}:Ug(e)}function Kg(e){var n;if(!e||typeof e!="object")return!1;let t=((n=e==null?void 0:e.cta)==null?void 0:n.id)||(e==null?void 0:e.heroId);return!!(e.title&&t)}function Ug(e){if(!e||typeof e!="object")return null;let t=e.type==="tv"?"tv":"movie",n=String(e.title||e.name||"").trim();if(!n)return null;let r=Gg(e),o=r.tmdb||r.imdb||r.ratingKey||"";if(!o)return null;let i=qg(e),s=Wg(e,t),a=Vg(e),c=Xg(e),l=Yg(e),u=Jg(e),d=Zg(e),h=Qg(e),f={id:o,kind:t==="tv"?"show":"movie",label:t==="tv"?"View show details":"View movie details",target:`#/${t==="tv"?"show":"movie"}/${o}`};return{id:r.ratingKey||`${t}-${o}`,type:t,title:n,tagline:d,overview:u,year:i,runtime:s,rating:a,genres:c,certification:l,cta:f,ids:r,backdrops:h}}function Gg(e){let t={};return e!=null&&e.ids&&typeof e.ids=="object"&&(e.ids.tmdb&&(t.tmdb=String(e.ids.tmdb)),e.ids.imdb&&(t.imdb=String(e.ids.imdb)),e.ids.tvdb&&(t.tvdb=String(e.ids.tvdb))),(e==null?void 0:e.ratingKey)!=null&&(t.ratingKey=String(e.ratingKey)),e!=null&&e.guid&&(t.guid=String(e.guid)),t}function qg(e){let t=U(e);return t?Number(t):null}function Wg(e,t){var r,o;let n=(o=(r=e==null?void 0:e.runtimeMin)!=null?r:e==null?void 0:e.durationMin)!=null?o:e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null;return!Number.isFinite(n)||n<=0?null:Math.max(1,Math.round(n))}function Vg(e){var n;let t=Number((n=e==null?void 0:e.rating)!=null?n:e==null?void 0:e.audienceRating);return Number.isFinite(t)?t:null}function Xg(e){let t=Array.isArray(e==null?void 0:e.genres)?e.genres:[],n=[];return t.forEach(r=>{if(!r)return;if(typeof r=="string"){let i=r.trim();i&&n.push(i);return}let o=r.tag||r.title||r.name||r.label||"";o&&n.push(o)}),Array.from(new Set(n))}function Yg(e){let t=typeof(e==null?void 0:e.contentRating)=="string"?e.contentRating.trim():"";if(!t)return"";let n=t.split("/"),r=n[n.length-1];return r?r.trim():t}function Jg(e){let t=[e==null?void 0:e.summary,e==null?void 0:e.plot,e==null?void 0:e.description,e==null?void 0:e.tagline];for(let n of t){if(typeof n!="string")continue;let r=n.trim();if(r)return r}return""}function Zg(e){let t=[e==null?void 0:e.tagline];for(let n of t){if(typeof n!="string")continue;let r=n.trim();if(r)return r}return""}function Qg(e){var i,s,a,c,l;let t=ze(),n=[(i=e==null?void 0:e.tmdb)==null?void 0:i.backdrop,(s=e==null?void 0:e.tmdb)==null?void 0:s.backdrop_path,(a=e==null?void 0:e.tmdb)==null?void 0:a.backdropPath,(c=e==null?void 0:e.tmdb)==null?void 0:c.background,(l=e==null?void 0:e.tmdb)==null?void 0:l.art],r=[e==null?void 0:e.art,e==null?void 0:e.background,e==null?void 0:e.thumbBackground,e==null?void 0:e.coverArt,e==null?void 0:e.thumb,e==null?void 0:e.thumbFile],o=[];return t&&n.forEach(u=>{let d=yc(u,!0);d&&!o.includes(d)&&o.push(d)}),r.forEach(u=>{let d=yc(u,!1);d&&!o.includes(d)&&o.push(d)}),o}function yc(e,t){if(typeof e!="string")return"";let n=e.trim();return n?n.startsWith("http")?n:n.startsWith("/")&&t&&!n.startsWith("/library/")?`https://image.tmdb.org/t/p/original${n}`:n:""}function eh(e,t,n,r,o){let i=th(o),[s=[],a=[],c=[]]=i;Ho(e,s),Ho(t,a),Ho(n,c);let l=s.length||a.length||c.length;r.hidden=!l}function th(e){let t=[],n=[];if(Number.isFinite(e.year)&&n.push({text:String(e.year),label:"Release year"}),Number.isFinite(e.runtime)){let i=e.type==="tv"?`${e.runtime} min/ep`:rh(e.runtime);n.push({text:i,label:e.type==="tv"?"Episode runtime":"Runtime"})}e.certification&&n.push({text:e.certification,label:"Certification",kind:"certification"}),n.length&&t.push(n);let r=[];if(e.rating!=null){let i=q(e.rating);r.push({text:`\u2605 ${i}`,label:`Average rating ${i} out of 10`,kind:"rating"})}if(e.voteCount!=null){let i=Dg.format(e.voteCount);r.push({text:`${i} votes`,label:`${i} votes recorded`})}if(e.type==="tv"){let i=[];Number.isFinite(e.seasons)&&e.seasons>0&&i.push(`${e.seasons} ${e.seasons===1?"Season":"Seasons"}`),Number.isFinite(e.episodes)&&e.episodes>0&&i.push(`${e.episodes} ${e.episodes===1?"Episode":"Episodes"}`),i.length&&r.push({text:i.join(" \u2022 "),label:"Episode availability"})}r.length&&t.push(r);let o=[];return Array.isArray(e.genres)&&e.genres.slice(0,3).forEach(i=>{let s=typeof i=="string"?i:"";s&&o.push({text:s,label:`Genre: ${s}`})}),o.length&&t.push(o),t}function Ho(e,t){if(!e)return;if(!t||!t.length){e.innerHTML="",e.hidden=!0;return}let n=document.createDocumentFragment();t.forEach(r=>{let o=document.createElement("span");o.className="hero__badge",r.kind==="certification"&&o.classList.add("hero__badge--certification"),r.kind==="rating"&&o.classList.add("hero__badge--rating"),o.textContent=r.text,r.label&&o.setAttribute("aria-label",r.label),n.appendChild(o)}),e.replaceChildren(n),e.hidden=!1}function nh(e,t,n,r,o,i){let a=(Array.isArray(i.backdrops)?i.backdrops.filter(Boolean):[])[0]||"";if(!t||!n){e.classList.toggle("hero--has-media",!!a);return}if(!a){jo(t,n,r,o),e.classList.remove("hero--has-media");return}e.classList.add("hero--has-media"),vc(r,a),vc(o,a),n.src=a,n.alt=i.title?`${i.title} backdrop`:"",n.removeAttribute("hidden"),t.hidden=!1}function vc(e,t){e&&(t?e.srcset=t:e.removeAttribute("srcset"))}function jo(e,t,n,r){n&&n.removeAttribute("srcset"),r&&r.removeAttribute("srcset"),t&&(t.removeAttribute("src"),t.setAttribute("hidden","")),e&&(e.hidden=!0)}function rh(e){if(!Number.isFinite(e)||e<=0)return"";let t=Math.floor(e/60),n=Math.round(e%60);return t&&n?`${t}h ${n}m`:t?`${t}h`:`${n}m`}function oh(e){let t=e==null?void 0:e.cta,n=(t==null?void 0:t.kind)||(e.type==="tv"?"show":"movie"),r=(t==null?void 0:t.id)||e.id;!n||!r||(ih(n,r,t==null?void 0:t.target),n==="show"?pt(r):mt(r))}function ih(e,t,n){if(!e||!t)return;let r=n||`#/${e}/${t}`,o=(window.location.hash||"")===r;if(typeof $o=="function")try{$o(r,{silent:!0,replace:o});return}catch{}try{window.location.hash=r}catch{}}var Dg,Ft,Ro,$o,Do,pc,Ko=M(()=>{Y();xn();ye();Xn();Dg=typeof Intl!="undefined"?new Intl.NumberFormat("en-US"):{format:e=>String(e)},Ft=null,Ro=null,$o=null,Do=null,pc={default:{title:"Highlights temporarily unavailable",tagline:"TMDb data could not be loaded just now.",overview:"The hero banner falls back to a neutral gradient until artwork and metadata are available again. Feel free to keep browsing and refresh later."},"rate-limit":{title:"Highlights are catching their breath",tagline:"TMDb is currently rate limiting our artwork requests.",overview:"We are slowing down hero generation until the limit resets. Your library stays accessible in the meantime."},error:{title:"Highlights paused",tagline:"Fresh TMDb data is temporarily unavailable.",overview:"We will automatically retry fetching artwork. You can also trigger a manual refresh from the settings when you are ready."}}});function kc({onRefresh:e=Ye}={}){let t=document.getElementById("hero"),n=document.getElementById("heroTimer"),r=n?n.querySelector(".hero-timer__bar"):null;if(!t||!n||!r)return null;if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return n.hidden=!0,null;n.removeAttribute("aria-hidden"),n.dataset.state="running";let i=15e3,s=new Set,a=!1,c=0,l=null,u=0,d=me(),h=k(),f=[],g=0,p=!1,m="",b=null,S=null;d&&(ie(xt(h)),b=or(()=>{ie(xt(h))})),S=Vo(()=>{let y=k();y!==h&&(h=y,d&&ie(xt(h)))});function k(){return I().view==="shows"?"series":"movies"}function L(){return s.size>0}function C(){let y=L();n.dataset.state=y?"paused":"running",a&&!y&&(u=0),a=y}function F(y,T){T?s.add(y):s.delete(y),C()}function X(){return f.length?(g=(g+1)%f.length,f[g]):null}function ie(y){var se;if(!y)return;let T=Array.isArray(y.items)?y.items:[],N=(se=(y.snapshot||sc()).status)==null?void 0:se[h],P=!rr()||(N==null?void 0:N.regenerating),B=`${h}:${(N==null?void 0:N.updatedAt)||0}:${T.length}`,O=f.length>0,j=p;if(f=T,g=T.length?y.startIndex%T.length:0,p=P||!T.length,F("pipeline",p),!p&&T.length&&(!O||j||m!==B)){try{e==null||e([T[g]])}catch{}c=0,r.style.setProperty("--p","0")}m=B}function de(y){if(L()){u=y,l=requestAnimationFrame(de);return}u||(u=y);let T=Math.max(0,y-u);u=y,c+=T;let x=Math.max(0,Math.min(1,c/i));if(r.style.setProperty("--p",String(x)),x>=1){c=0,u=y,r.style.setProperty("--p","0");try{if(d){let N=X();N?e==null||e([N]):e==null||e()}else e==null||e()}catch{}}l=requestAnimationFrame(de)}function fe(){l||(l=requestAnimationFrame(de))}return t.addEventListener("mouseenter",()=>{F("hover",!0)}),t.addEventListener("mouseleave",()=>{F("hover",!1)}),document.addEventListener("visibilitychange",()=>{F("hidden",document.hidden)}),document.hidden?F("hidden",!0):C(),fe(),{pause(){F("manual",!0)},resume(){F("manual",!1)},reset(){c=0,r.style.setProperty("--p","0")},destroy(){b&&b(),S&&S()}}}var Tc=M(()=>{Ko();Y();on()});function ah(e){try{ar&&(ar.tmdbEnrichment=!!(e&&e.tmdbEnabled)),typeof window!="undefined"&&window.FEATURES&&window.FEATURES!==ar&&(window.FEATURES={...window.FEATURES,...ar})}catch{}}function ch(e,t){if(sn.reason===e)return;sn.reason=e;let n=Cc[e]||Cc.default;try{n(t)}catch{}}function Te(e){var t,n,r,o;if(Array.isArray(e)&&e.length){sn.reason=null,Ye(e);return}if(me()){let i=I().view==="shows"?"series":"movies",s=xt(i),a=(n=(t=s==null?void 0:s.snapshot)==null?void 0:t.status)==null?void 0:n[i],c=rr(),l=a==null?void 0:a.regenerating,u=Array.isArray(s==null?void 0:s.items)?s.items:[],d=(o=(r=s==null?void 0:s.snapshot)==null?void 0:r.tmdb)==null?void 0:o.rateLimit,h=!!(d!=null&&d.active),f=(a==null?void 0:a.state)==="error";if(!u.length&&(f||h&&c&&!l)){let p=f?"error":"rate-limit";Ac(p)&&ch(p,{status:a,rateLimit:d});return}if(c&&!l&&u.length){let p=s.startIndex%u.length,m=u[p];if(m){sn.reason=null,Ye([m]);return}}}sn.reason=null,Ye(e)}function Lt(e,t=!0){let n=document.getElementById("footerMeta");if(n){let o=n.querySelector("#footerStatus");o?o.textContent=e:n.textContent=e,n.dataset.state=t?"loading":"ready"}let r=document.getElementById("grid");r&&r.setAttribute("aria-busy",t?"true":"false")}async function lh(){let e=!!globalThis.__PLEX_TEST_MODE__;Nt(),gh(),Xo(),Lt("Initialisiere \u2026",!0),Be("Initialisiere \u2026",8),Yo(18);let t=fetch("config.json").then(a=>a.json()).catch(a=>(Z("Konfiguration konnte nicht geladen werden","Verwende Standardeinstellungen"),{startView:"movies",tmdbEnabled:!1})),n=Zs().catch(a=>St()),[r,o]=await Promise.all([t,n]);ah(r),lt(r);let i=nc({cfg:r,policy:o});Pe({cfg:r,view:r.startView||"movies",heroPolicy:o,heroPolicyIssues:Dn(),heroPipelineEnabled:i.enabled,heroPipelineSource:i.source});try{Lt("Filme laden \u2026",!0),Be("Filme laden \u2026",25);let a=await gi();Lt("Serien laden \u2026",!0),Be("Serien laden \u2026",45);let c=await hi();Lt("Filter vorbereiten \u2026",!0),Be("Filter vorbereiten \u2026",60);let l=ao(a,c);if(Pe({movies:a,shows:c,facets:l}),rc({movies:a,shows:c}),tr(I().view),me()){Lt("Highlights vorbereiten \u2026",!0),Be("Highlights vorbereiten \u2026",70);try{await oc()}catch{}}Lt("Ansicht aufbauen \u2026",!0),Be("Ansicht aufbauen \u2026",85),fr(),qo(),co(l),uo();let u=bt();if(dh(!0),ee(I().view),fh(),dn(),r.tmdbEnabled&&(window.requestIdleCallback?window.requestIdleCallback(()=>{var d;return(d=Hn)==null?void 0:d(a,c,r)},{timeout:600}):setTimeout(()=>{var d;return(d=Hn)==null?void 0:d(a,c,r)},400)),!e)Ti(),hc(r),hh(),mh(),ph(),bh(),yh(),Te(u),kc({onRefresh:Te}),lc();else try{Te(u)}catch{}Ic(!0)}catch(a){throw dn(),fr(),yr("Fehler beim Laden der Daten",()=>window.location.reload()),a}let s;window.addEventListener("tmdb:chunk",()=>{s||(s=requestAnimationFrame(()=>{s=null;try{localStorage.getItem("useTmdb")==="1"&&ee(I().view),Te()}catch{}}))}),window.addEventListener("tmdb:done",()=>{try{localStorage.getItem("useTmdb")==="1"&&ee(I().view),Te()}catch{}})}function uh(e){if(/^#\/(movies|shows)$/.test(e)){let s=e.includes("shows")?"shows":"movies";Pe({view:s}),tr(s),Lo(s==="shows"?"series":"movies").catch(c=>{});let a=bt();return qo(),ee(s),Te(a),!0}let t=e.match(/^#\/(movie|show)\/(.+)/);if(!t)return!1;let[,n,r]=t,i=((n==="movie"?I().movies:I().shows)||[]).find(s=>{var a,c;return((a=s==null?void 0:s.ids)==null?void 0:a.imdb)===r||((c=s==null?void 0:s.ids)==null?void 0:c.tmdb)===r||String(s==null?void 0:s.ratingKey)===r});return i?(n==="show"?pt(i):mt(i),!0):!1}function Ic(e=!1){let t=window.location.hash||"";!e&&!Go.shouldHandle(t)||(e&&Go.markProcessed(t),uh(t))}function qo(){let e=document.getElementById("libraryTabs");if(!e)return;let t=Array.from(e.querySelectorAll("[data-lib]")),n=I().view==="shows"?"shows":"movies";t.forEach(r=>{let o=r.dataset.lib==="series"?"shows":"movies",i=n===o;r.classList.toggle("is-active",i),r.setAttribute("aria-pressed",i?"true":"false"),r.dataset.bound!=="true"&&(r.addEventListener("click",()=>{let s=r.dataset.lib==="series"?"shows":"movies";if(I().view===s)return;if(Pe({view:s}),tr(s),me()){let l=Lo(s==="shows"?"series":"movies");l&&typeof l.catch=="function"&&l.catch(u=>{})}Bn(s==="movies"?"#/movies":"#/shows",{silent:!0}),qo();let c=bt();ee(s),Te(c)}),r.dataset.bound="true")})}function dh(e=!1){let t=document.getElementById("heroStats");if(!t)return;let n=I(),r=(n.movies||[]).length,o=(n.shows||[]).length,i=t.querySelector('[data-stat="movies"]'),s=t.querySelector('[data-stat="shows"]');!i||!s||(e?(_c(i,r),_c(s,o)):(i.textContent=String(r),s.textContent=String(o)))}function _c(e,t){if(!e)return;let n=Number(e.textContent)||0,r=Number(t)||0;if(n===r){e.textContent=String(r);return}let o=480,i=performance.now();function s(a){let c=Math.min(1,(a-i)/o),l=Math.round(n+(r-n)*(c<.5?2*c*c:-1+(4-2*c)*c));e.textContent=String(l),c<1?requestAnimationFrame(s):e.textContent=String(r)}requestAnimationFrame(s)}function fh(){let e=document.getElementById("footerMeta");if(!e)return;let t=document.getElementById("footerStatus"),n=I(),r=n.movies||[],o=n.shows||[],i=r.concat(o).map(l=>new Date(l.addedAt||0).getTime()).filter(Number.isFinite),a=(i.length?new Date(Math.max(...i)):new Date).toISOString().slice(0,10);t&&(t.textContent=`Stand: ${a}`),e.dataset.state="ready";let c=document.getElementById("grid");c&&c.setAttribute("aria-busy","false")}function Wo(e){var t,n;try{let r=document.body;r?((t=document.documentElement)==null||t.classList.remove("reduce-motion","reduced-motion"),r.classList.remove("reduced-motion"),r.classList.toggle("reduce-motion",e)):((n=document.documentElement)==null||n.classList.toggle("reduce-motion",e),window.addEventListener("DOMContentLoaded",()=>Wo(e),{once:!0}))}catch{}}function gh(){try{let e=localStorage.getItem("prefReduceMotion")==="1";Wo(e)}catch{}}function hh(){let e=document.getElementById("toggleAdvanced"),t=document.getElementById("advancedFilters");if(!e||!t)return;let n=!1,r=0,o=()=>{n=!1,r&&(clearTimeout(r),r=0),t.dataset.state==="closing"?(t.dataset.state="closed",t.hidden=!0,t.style.removeProperty("--advanced-max")):t.dataset.state==="open"?t.style.removeProperty("--advanced-max"):t.dataset.state==="expanding"&&(t.dataset.state="open",t.style.removeProperty("--advanced-max"))},i=()=>{r&&clearTimeout(r),r=window.setTimeout(o,320)};t.addEventListener("transitionend",c=>{c.target!==t||c.propertyName!=="max-height"||o()});let s=()=>{n||(n=!0,t.hidden=!1,t.dataset.state="expanding",t.setAttribute("aria-hidden","false"),t.style.setProperty("--advanced-max","0px"),requestAnimationFrame(()=>{let c=t.scrollHeight;t.style.setProperty("--advanced-max",c+"px"),t.dataset.state="open",i()}))},a=()=>{if(n)return;n=!0;let c=t.scrollHeight;t.style.setProperty("--advanced-max",c+"px"),t.dataset.state="closing",t.setAttribute("aria-hidden","true"),requestAnimationFrame(()=>{t.style.setProperty("--advanced-max","0px"),i()})};e.addEventListener("click",()=>{e.getAttribute("aria-expanded")==="true"?(e.setAttribute("aria-expanded","false"),a()):(e.setAttribute("aria-expanded","true"),s())})}function mh(){let e=document.getElementById("siteLogo");e&&e.addEventListener("error",()=>{e.classList.add("logo-missing");let i=document.querySelector(".site-header__brand-text .site-header__label");i&&i.classList.remove("sr-only")});let t=document.getElementById("heroTagline"),n=["Curated spotlights and smart filters for every mood.","Bring Plex highlights on the road with offline browsing.","Plan your next movie night with shareable watchlists."],r=0;t&&!t.textContent&&(t.textContent=n[r]);function o(){!t||t.dataset.taglinePaused==="1"||(t.classList.add("is-fading"),setTimeout(()=>{if(!t||t.dataset.taglinePaused==="1"){t&&t.classList.remove("is-fading");return}r=(r+1)%n.length,t.textContent=n[r],t.classList.remove("is-fading")},280))}t?(t.dataset.taglinePaused=t.dataset.taglinePaused==="1"?"1":"0",Mt&&clearInterval(Mt),Mt=setInterval(o,6e3),setTimeout(o,3e3)):Mt&&(clearInterval(Mt),Mt=null)}function ph(){let e=document.getElementById("scrollProgress");if(!e)return;let t=()=>{let n=document.documentElement.scrollTop||document.body.scrollTop||0,r=document.documentElement.scrollHeight-document.documentElement.clientHeight||1,o=Math.max(0,Math.min(100,n/r*100));e.style.width=o+"%"};addEventListener("scroll",t,{passive:!0}),t()}function bh(){let e=document.getElementById("scrollTop");if(!e)return;let t=()=>{let n=window.scrollY||0;e.style.display=n>300?"block":"none"};addEventListener("scroll",t,{passive:!0}),t(),e.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"}))}function yh(){let e=document.querySelector(".filters");if(!e||typeof CSS!="undefined"&&typeof CSS.supports=="function"&&CSS.supports("animation-timeline: scroll()"))return;let n=window.scrollY||window.pageYOffset||0,r=!1,o=!1,i=120,s=8,a=d=>{r!==d&&(r=d,e.classList.toggle("is-hidden",r))},c=()=>{o=!1;let d=window.scrollY||window.pageYOffset||0;if(d<=i){a(!1),n=d;return}let h=d-n;n=d,h>s?a(!0):h<-s&&a(!1)},l=()=>{o||(o=!0,requestAnimationFrame(c))};window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",c);let u=()=>a(!1);e.addEventListener("focusin",u),e.addEventListener("pointerenter",u,{passive:!0}),e.addEventListener("pointerdown",u,{passive:!0}),c()}var sh,ar,Mt,sn,Cc,Go,Bn,Uo,Ks=M(()=>{Y();Jo();rt();go();Pn();xn();We();_r();uc();gn();mc();Ko();Tc();zn();on();ut();sh={tmdbEnrichment:!1},ar=(()=>{let e=typeof window!="undefined"&&window.FEATURES?window.FEATURES:{},t={...sh,...e};return typeof window!="undefined"&&(window.FEATURES=t),t})();Mt=null,sn={reason:null},Cc={"rate-limit":()=>Z("TMDb drosselt Anfragen","Highlights werden kurzzeitig langsamer aktualisiert."),error:e=>{var t;return Z("Highlights vor\xFCbergehend nicht verf\xFCgbar",((t=e==null?void 0:e.status)==null?void 0:t.lastError)||"TMDb-Daten konnten nicht geladen werden.")},default:()=>Z("Highlights vor\xFCbergehend nicht verf\xFCgbar","TMDb-Daten konnten nicht geladen werden.")};Go=(()=>{let e=window.location.hash||"",t=null;function n(s){if(typeof s!="string")return"";let a=s.trim();return a?a.startsWith("#")?a:`#${a}`:""}function r(s,a={}){let{replace:c=!1,silent:l=!1}=a,u=n(s);if(!u)return;let d=window.location.hash||"";if(u===d){if(c&&history&&typeof history.replaceState=="function")try{history.replaceState(null,"",u)}catch{}l&&(t=u,e=u);return}let h=c?"replaceState":"pushState",f=!1;try{history&&typeof history[h]=="function"&&(history[h](null,"",u),f=!0)}catch{}if(!f){window.location.hash=u,l&&(t=u,e=u);return}if(l){t=u,e=u;return}try{let g=typeof HashChangeEvent=="function"?new HashChangeEvent("hashchange"):new Event("hashchange");window.dispatchEvent(g)}catch{}}function o(s){let a=typeof s=="string"?s:"";return t&&a===t?(t=null,!1):(t=null,a===e?!1:(e=a,!0))}function i(s){e=typeof s=="string"?s:"",t=null}return{navigate:r,shouldHandle:o,markProcessed:i}})(),Bn=(e,t)=>Go.navigate(e,t);Ec(Bn);Uo=null;window.addEventListener("hashchange",()=>{Uo&&clearTimeout(Uo),Uo=setTimeout(()=>{Ic(!1)},50)});lo(e=>{try{Te(e)}catch{}});fc(e=>{try{Te(e)}catch{}});gc(e=>{try{Wo(!!e)}catch{}});globalThis.__PLEX_TEST_MODE__||lh();window.addEventListener("load",()=>{try{dn()}catch{}})});Ks();export{lh as boot,Bn as navigateToHash};
//# sourceMappingURL=main.js.map
