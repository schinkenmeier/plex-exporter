var ta=Object.defineProperty;var x=(e,t)=>()=>(e&&(t=e(e=0)),t);var ft=(e,t)=>{for(var n in t)ta(e,n,{get:t[n],enumerable:!0})};function we(e){Object.assign(Cn,e),xn.forEach(t=>t(Cn))}function Zr(e){return xn.add(e),()=>xn.delete(e)}var Cn,xn,k,ee=x(()=>{Cn={view:"movies",movies:[],shows:[],facets:{},filtered:[],cfg:{},heroPolicy:null,heroPolicyIssues:[]},xn=new Set,k=()=>Cn});function _(e,t,n){let r=document.createElement(e);return t&&(r.className=t),n!=null&&(r.textContent=n),r}var $,Ct=x(()=>{$=(e,t=document)=>t.querySelector(e)});function Mn(){if(!oe&&(oe=$("#loaderOverlay"),!oe)){oe=_("div","loader-overlay"),oe.id="loaderOverlay",oe.hidden=!0;let e=_("div","loader");Mt=_("div","msg",""),xt=_("div","bar"),e.append(Mt,xt),oe.append(e),document.body.append(oe)}}function Qr(){Mn(),oe.hidden=!1}function Ie(e,t){Mn(),Mt&&(Mt.textContent=e||""),xt&&(xt.style.width=(t||0)+"%")}function Ft(){Mn(),oe.hidden=!0}function eo(e=18){let t=$("#grid");if(t){me=_("div","skeleton");for(let n=0;n<e;n++)me.append(_("div","skel"));t.replaceChildren(me)}}function Fn(){me&&me.parentElement&&me.parentElement.removeChild(me),me=null}var oe,xt,Mt,me,to=x(()=>{Ct()});function no(e,t,n=864e5){try{let r=Te+e,o={value:t,timestamp:Date.now(),ttl:n};localStorage.setItem(r,JSON.stringify(o)),na()}catch(r){if(r.name==="QuotaExceededError"){io();try{let o=Te+e,i={value:t,timestamp:Date.now(),ttl:n};localStorage.setItem(o,JSON.stringify(i))}catch{}}}}function ro(e){try{let t=Te+e,n=localStorage.getItem(t);if(!n)return null;let r=JSON.parse(n);if(typeof r.timestamp!="number"||typeof r.ttl!="number")return localStorage.removeItem(t),null;let o=Date.now();return r.timestamp+r.ttl<o?(localStorage.removeItem(t),null):r.value}catch{return null}}function oo(){try{Object.keys(localStorage).forEach(t=>{t.startsWith(Te)&&localStorage.removeItem(t)})}catch{}}function Lt(){try{let e=Object.keys(localStorage),t=Date.now(),n=0;e.forEach(r=>{if(r.startsWith(Te))try{let o=JSON.parse(localStorage.getItem(r));o.timestamp+o.ttl<t&&(localStorage.removeItem(r),n++)}catch{localStorage.removeItem(r),n++}}),n>0}catch{}}function Ln(){try{let t=Object.keys(localStorage).filter(s=>s.startsWith(Te)),n=Date.now(),r=0,o=0,i=0;return t.forEach(s=>{let a=localStorage.getItem(s);r+=a.length*2;try{let l=JSON.parse(a);l.timestamp+l.ttl>=n?o++:i++}catch{i++}}),{totalEntries:t.length,validEntries:o,expiredEntries:i,totalSize:r,totalSizeMB:(r/1024/1024).toFixed(2)}}catch{return null}}function na(){try{let e=Ln();e&&e.totalSize>5242880&&io(.3)}catch{}}function io(e=.3){try{let t=Object.keys(localStorage),n=[];t.forEach(o=>{if(o.startsWith(Te))try{let i=JSON.parse(localStorage.getItem(o));n.push({key:o,timestamp:i.timestamp})}catch{n.push({key:o,timestamp:0})}}),n.sort((o,i)=>o.timestamp-i.timestamp);let r=Math.ceil(n.length*e);for(let o=0;o<r;o++)localStorage.removeItem(n[o].key)}catch{}}var Te,ra,_n=x(()=>{Te="plex_cache_";ra=null;typeof window!="undefined"&&typeof window.document!="undefined"&&window===globalThis&&(Lt(),ra=setInterval(Lt,5*60*1e3))});function $e(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function da(e,t){switch(t){case"string":return typeof e=="string";case"number":return typeof e=="number"&&Number.isFinite(e);case"boolean":return typeof e=="boolean";case"array":return Array.isArray(e);case"object":return $e(e);default:return!1}}function Pn(e,t,n="value"){if(!t)return;if(e==null){if(t.nullable)return;throw new Error(`${n} darf nicht null oder undefined sein.`)}let r=Array.isArray(t.type)?t.type:[t.type];if(r&&r.length&&!r.some(i=>da(e,i))){let i=r.join(" oder ");throw new Error(`${n} erwartet Typ ${i}, erhielt ${typeof e}.`)}if(r.includes("array")){if(!Array.isArray(e))throw new Error(`${n} erwartet eine Liste.`);t.items&&e.forEach((o,i)=>{n.includes(".genres")||n.includes("List")&&t.items.type&&Array.isArray(t.items.type)&&t.items.type.includes("string")&&t.items.type.includes("object")||Pn(o,t.items,`${n}[${i}]`)});return}if(r.includes("object")){if(!$e(e))throw new Error(`${n} erwartet ein Objekt.`);let o=t.required||[];for(let s of o){let a=e[s];if(a==null||typeof a=="string"&&!a.trim())throw new Error(`${n}.${s} ist ein Pflichtfeld.`)}let i=t.properties||{};for(let[s,a]of Object.entries(i))e[s]!=null&&Pn(e[s],a,`${n}.${s}`)}}function so(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():t&&typeof t=="object"&&typeof t.tag=="string"?t.tag.trim():null).filter(t=>t&&t.length>0):[]}function ao(e,t){let n={...e};for(let[r,o]of Object.entries(t))n[r]==null?n[r]=Array.isArray(o)?[...o]:o:Array.isArray(o)&&(n[r]=Array.isArray(n[r])?[...n[r]]:[...o]);return n}function lo(e){if(!$e(e)||typeof e.title!="string"||!e.title.trim())return!1;let t=e.ratingKey;return typeof t=="string"||typeof t=="number"}function fa(e){return lo(e)?e.seasons==null?!0:Array.isArray(e.seasons)?e.seasons.every(t=>$e(t)):!1:!1}function ha(e){let t=ao(e,oa);t.title=t.title.trim(),t.ratingKey=String(e.ratingKey).trim();let n=typeof t.thumb=="string"?t.thumb:"",r=typeof t.thumbFile=="string"?t.thumbFile:"";return t.thumb=n,t.thumbFile=r||n,t.summary=typeof t.summary=="string"?t.summary:"",t.href=typeof t.href=="string"?t.href:"",t.tagline=typeof t.tagline=="string"?t.tagline:"",t.genres=so(t.genres),t}function ga(e){let t=ao(e,ia);t.title=t.title.trim(),t.ratingKey=String(e.ratingKey).trim();let n=typeof t.thumb=="string"?t.thumb:"",r=typeof t.thumbFile=="string"?t.thumbFile:"";return t.thumb=n,t.thumbFile=r||n,t.summary=typeof t.summary=="string"?t.summary:"",t.href=typeof t.href=="string"?t.href:"",t.tagline=typeof t.tagline=="string"?t.tagline:"",t.genres=so(t.genres),Array.isArray(e.seasons)?t.seasons=e.seasons.filter($e).map(o=>{let i={...o};return i.episodes=Array.isArray(o.episodes)?o.episodes.filter($e).map(s=>({...s})):[],typeof i.thumb!="string"&&(i.thumb=""),typeof i.thumbFile!="string"&&(i.thumbFile=""),i}):t.seasons=[],t}function Hn(e,t="movie"){if(Pn(e,t==="show"?ua:ca,`${t}List`),!Array.isArray(e))throw new Error("Datensatz ist keine Liste.");let r=t==="show"?fa:lo,o=t==="show"?ga:ha;return e.map((i,s)=>{if(!r(i))throw new Error(`Ung\xFCltiger ${t}-Eintrag an Index ${s}.`);return o(i)})}var oa,ia,sa,aa,la,ca,ua,co=x(()=>{oa=Object.freeze({thumb:"",thumbFile:"",summary:"",href:"",tagline:"",genres:[]}),ia=Object.freeze({thumb:"",thumbFile:"",summary:"",href:"",tagline:"",genres:[],seasons:[]}),sa=Object.freeze({type:"object",required:["title","ratingKey"],properties:{title:{type:"string"},ratingKey:{type:["string","number"]},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0},summary:{type:"string",nullable:!0},href:{type:"string",nullable:!0},tagline:{type:"string",nullable:!0},genres:{type:"array",items:{type:["string","object"]},nullable:!0}}}),aa=Object.freeze({type:"object",properties:{episodes:{type:"array",items:{type:"object"},nullable:!0},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0}}}),la=Object.freeze({type:"object",required:["title","ratingKey"],properties:{title:{type:"string"},ratingKey:{type:["string","number"]},thumb:{type:"string",nullable:!0},thumbFile:{type:"string",nullable:!0},summary:{type:"string",nullable:!0},href:{type:"string",nullable:!0},tagline:{type:"string",nullable:!0},genres:{type:"array",items:{type:["string","object"]},nullable:!0},seasons:{type:"array",items:aa,nullable:!0}}}),ca=Object.freeze({type:"array",items:sa}),ua=Object.freeze({type:"array",items:la})});var uo={};ft(uo,{clearErrors:()=>pa,initErrorHandler:()=>ht,showError:()=>V,showRetryableError:()=>Nn,withErrorHandling:()=>ma});function ht(){q||(q=document.createElement("div"),q.id="errorContainer",q.className="error-container",q.setAttribute("role","alert"),q.setAttribute("aria-live","polite"),document.body.appendChild(q)),window.addEventListener("unhandledrejection",e=>{var t;V("Ein unerwarteter Fehler ist aufgetreten",(t=e.reason)==null?void 0:t.message),e.preventDefault()}),window.addEventListener("error",e=>{var t;V("Ein Fehler ist aufgetreten",(t=e.error)==null?void 0:t.message)})}function V(e,t="",n=5e3){q||ht();let r=document.createElement("div");return r.className="error-toast",r.innerHTML=`
    <div class="error-toast-content">
      <div class="error-toast-icon">\u26A0\uFE0F</div>
      <div class="error-toast-text">
        <div class="error-toast-title">${Rn(e)}</div>
        ${t?`<div class="error-toast-message">${Rn(t)}</div>`:""}
      </div>
      <button class="error-toast-close" aria-label="Schlie\xDFen">\xD7</button>
    </div>
  `,r.querySelector(".error-toast-close").addEventListener("click",()=>{r.classList.add("error-toast-exit"),setTimeout(()=>r.remove(),300)}),q.appendChild(r),n>0&&setTimeout(()=>{r.parentNode&&(r.classList.add("error-toast-exit"),setTimeout(()=>r.remove(),300))},n),requestAnimationFrame(()=>{r.classList.add("error-toast-show")}),r}function ma(e,t="Ein Fehler ist aufgetreten"){return async(...n)=>{try{return await e(...n)}catch(r){throw V(t,r.message),r}}}function Nn(e,t){q||ht();let n=document.createElement("div");n.className="error-toast error-toast-retryable",n.innerHTML=`
    <div class="error-toast-content">
      <div class="error-toast-icon">\u26A0\uFE0F</div>
      <div class="error-toast-text">
        <div class="error-toast-title">${Rn(e)}</div>
      </div>
      <button class="error-toast-retry">Erneut versuchen</button>
      <button class="error-toast-close" aria-label="Schlie\xDFen">\xD7</button>
    </div>
  `;let r=n.querySelector(".error-toast-retry"),o=n.querySelector(".error-toast-close");return r.addEventListener("click",async()=>{n.remove();try{await t()}catch{}}),o.addEventListener("click",()=>{n.classList.add("error-toast-exit"),setTimeout(()=>n.remove(),300)}),q.appendChild(n),requestAnimationFrame(()=>{n.classList.add("error-toast-show")}),n}function pa(){q&&(q.innerHTML="")}function Rn(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}var q,_t=x(()=>{q=null});async function $n(e,t=2,n=!0){if(n){let s=ro(e);if(s!==null)return s}let r=null;for(let s=0;s<=t;s++){try{let a=await fetch(e,{cache:"no-store"});if(a&&a.ok){let l=await a.json();return n&&l&&no(e,l,ba),l}if(a&&a.status===404)return null;r=new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(a){r=a}if(s<t){let a=Math.min(1e3*Math.pow(2,s),5e3);await new Promise(l=>setTimeout(l,a))}}let o=(r==null?void 0:r.message)||"Unbekannter Fehler",i=new Error(`Daten konnten nicht geladen werden: ${e} (${o})`);throw r&&typeof r=="object"&&(i.cause=r),i}function Aa(e){try{let t=document.getElementById(e);if(t&&t.textContent)return JSON.parse(t.textContent)}catch{}return null}function wa(e){try{let t=ya;return(t&&Array.isArray(t[e])?t[e]:null)||null}catch{return null}}function Ia(e){try{return(Array.isArray(window[e])?window[e]:null)||null}catch{return null}}async function go(e,t){let n=null;try{n=await $n(e)}catch{n=null}if(Array.isArray(n)&&n.length)return Be(t==null?void 0:t.label,`primary:${e}`),n;if(t!=null&&t.embedId){let r=Aa(t.embedId);if(Array.isArray(r)&&r.length)return Be(t==null?void 0:t.label,`embedded:${t.embedId}`),r}if(t!=null&&t.exportKey){let r=wa(t.exportKey);if(Array.isArray(r)&&r.length)return Be(t==null?void 0:t.label,`globalBag:${t.exportKey}`),r}if(t!=null&&t.globalVar){let r=Ia(t.globalVar);if(Array.isArray(r)&&r.length)return Be(t==null?void 0:t.label,`window:${t.globalVar}`),r}for(let r of(t==null?void 0:t.altUrls)||[]){let o=null;try{o=await $n(r)}catch{o=null}if(Array.isArray(o)&&o.length)return Be(t==null?void 0:t.label,`alt:${r}`),o}return Be(t==null?void 0:t.label,"empty"),Array.isArray(n)?n:[]}function Bn(e,t){typeof window=="undefined"||typeof document=="undefined"||typeof document.createElement!="function"||Promise.resolve().then(()=>(_t(),uo)).then(n=>{var r;try{(r=n.showError)==null||r.call(n,e,t,8e3)}catch{}}).catch(n=>{})}function Ta(e,t){let n=e==null?"":String(e).trim();if(!n)return"";if(n.startsWith("//")||n.startsWith("/")||Sa.test(n))return n;let r=n.replace(/\\/g,"/"),o=t?t.endsWith("/")?t:`${t}/`:"",i=!1,s=g=>g.split("/").map(p=>{if(!p)return"";try{return encodeURIComponent(decodeURIComponent(p))}catch{return i||(i=!0),encodeURIComponent(p)}}).join("/"),l=r.replace(/^\/+/,"").split("/"),u=[];for(let g of l)if(!(!g||g===".")){if(g===".."){u.length&&u.pop();continue}u.push(g)}let c=u.join("/");if(c.startsWith("data/"))return s(c);let d=u;if(o&&d.length){let g=o.replace(/\/+$/,"").split("/").pop();g&&d[0]===g&&(d=d.slice(1))}let m=d.join("/"),h=s(m);return`${o}${h}`}function mo(e,t){var o,i;if(!e||typeof e!="object")return e;let n=(i=(o=e.thumbFile)!=null?o:e.thumb)!=null?i:"",r=Ta(n,t);if(r)e.thumbFile=r,e.thumb=r;else if(n){let s=String(n);e.thumbFile=s,e.thumb==null&&(e.thumb=s)}return e}function ka(e){return mo(e,va)}function te(e){return mo(e,Ea)}function po(e){return!e||typeof e!="object"||(te(e),Array.isArray(e.seasons)&&e.seasons.forEach(bo)),e}function bo(e){return!e||typeof e!="object"||(te(e),Array.isArray(e.episodes)&&e.episodes.forEach(t=>te(t))),e}function Ca(e){return Array.isArray(e)?(e.forEach(t=>{t&&typeof t=="object"&&ka(t)}),e):[]}function xa(e){return Array.isArray(e)?(e.forEach(t=>{t&&typeof t=="object"&&po(t)}),e):[]}async function yo(){try{let e=await go("data/movies/movies.json",{label:"movies",embedId:"movies-json",exportKey:"movies",globalVar:"__PLEX_MOVIES__",altUrls:["movies/movies.json","data/movies.json","Filme/movies.json","movies.json"]}),t;try{t=Hn(e,"movie")}catch(n){let r=(n==null?void 0:n.message)||"Unbekannte Validierungsfehler",o=new Error(`Ung\xFCltige Filmdaten: ${r}`);throw n instanceof Error&&(o.cause=n),o}return Ca(t)}catch(e){return Bn("Filme konnten nicht geladen werden",(e==null?void 0:e.message)||"Unbekannter Fehler"),[]}}async function vo(){try{let e=await go("data/series/series_index.json",{label:"shows",embedId:"series-json",exportKey:"shows",globalVar:"__PLEX_SHOWS__",altUrls:["series/series_index.json","data/shows.json","data/series.json","Serien/series.json","series/series.json","series.json","shows.json"]}),t;try{t=Hn(e,"show")}catch(n){let r=(n==null?void 0:n.message)||"Unbekannte Validierungsfehler",o=new Error(`Ung\xFCltige Seriendaten: ${r}`);throw n instanceof Error&&(o.cause=n),o}return xa(t)}catch(e){return Bn("Serien konnten nicht geladen werden",(e==null?void 0:e.message)||"Unbekannter Fehler"),[]}}async function Eo(e){if(!e)return null;let t=Ma(e),n=Fa(t);if(n!==void 0)return n;let r=La(e),o=null;for(let i of r)try{let s=await $n(i);if(s&&typeof s=="object"){let a=_a(s);return fo(t,a,e),Ao(a)}}catch(s){o=s}return o&&Bn("Details konnten nicht geladen werden",(o==null?void 0:o.message)||"Bitte sp\xE4ter erneut versuchen."),fo(t,null,e),null}function Be(e,t){if(e)try{ho[e]=t}catch{}}function So(){return{...ho}}function Ma(e){let t=[];(e==null?void 0:e.ratingKey)!==void 0&&(e==null?void 0:e.ratingKey)!==null&&(e==null?void 0:e.ratingKey)!==""&&t.push(`rk:${String(e.ratingKey)}`);let n=Ht(e==null?void 0:e.href);return n&&t.push(`href:${n}`),t}function Ht(e){return e?String(e).trim().replace(/^\.\//,"").replace(/^\/+/,""):""}function Fa(e){for(let t of e)if(ke.has(t)){let n=ke.get(t);return n?Ao(n):null}}function fo(e,t,n){let r=t;e.forEach(l=>{ke.set(l,r)});let o=n==null?void 0:n.ratingKey;o!=null&&ke.set(`rk:${String(o)}`,r);let i=t&&typeof t=="object"?t.ratingKey:void 0;i!=null&&ke.set(`rk:${String(i)}`,r);let s=Ht(n==null?void 0:n.href);s&&ke.set(`href:${s}`,r);let a=t&&typeof t=="object"?Ht(t.href):"";a&&ke.set(`href:${a}`,r)}function La(e){let t=new Set,n=Ht(e==null?void 0:e.href);if(n)if(/^https?:/i.test(n))t.add(n);else{n.startsWith("data/")?t.add(n):t.add(`data/${n}`);let o=n.replace(/^data\//,"");o.startsWith("series/")||t.add(`data/series/${o}`);let i=o.replace(/^series\//,"").replace(/^details\//,"").replace(/\.json$/,"");i&&t.add(`data/series/details/${i}.json`)}let r=e==null?void 0:e.ratingKey;return r!=null&&t.add(`data/series/details/${String(r)}.json`),Array.from(t)}function _a(e){if(!e||typeof e!="object")return null;let t={...e};te(t),t.genres=On(t.genres);let n=Ra(t.cast||t.roles||[]);return t.cast=n,t.roles=n,t.seasons=Array.isArray(t.seasons)?t.seasons.map(Pa).filter(Boolean):[],t.seasonCount=Number.isFinite(t.seasonCount)?t.seasonCount:t.seasons.length,po(t),t}function Pa(e){if(!e||typeof e!="object")return null;let t={...e};return te(t),t.genres=On(t.genres),t.episodes=Array.isArray(t.episodes)?t.episodes.map(Ha).filter(Boolean):[],bo(t),t}function Ha(e){if(!e||typeof e!="object")return null;let t={...e};return te(t),t.genres=On(t.genres),t}function On(e){if(!Array.isArray(e))return[];let t=new Set,n=[];return e.forEach(r=>{let o=null;if(typeof r=="string"){let i=r.trim();i&&(o={tag:i})}else if(r&&typeof r=="object"){let i=String(r.tag||r.title||r.name||r.label||"").trim();i&&(o={...r,tag:i})}o&&!t.has(o.tag)&&(t.add(o.tag),n.push(o))}),n}function Ra(e){return Array.isArray(e)?e.map(t=>{if(!t)return null;if(typeof t=="string"){let n=t.trim();return n?{tag:n}:null}if(typeof t=="object"){let n=String(t.tag||t.name||t.role||"").trim();return n?{...t,tag:n}:{...t}}return null}).filter(Boolean):[]}function Ao(e){if(e==null)return e;try{return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}return e}var ho,ke,ba,Pt,ya,va,Ea,Sa,Oe=x(()=>{_n();co();ho={movies:null,shows:null},ke=new Map,ba=1e3*60*30,Pt="__PLEX_EXPORTER__",ya=(()=>{try{if(typeof globalThis!="undefined"){if(globalThis[Pt])return globalThis[Pt];if(globalThis.window&&globalThis.window[Pt])return globalThis.window[Pt]}}catch{}return null})(),va="data/movies/",Ea="data/series/",Sa=/^[a-z][a-z0-9+.-]*:/i});function pe(e){let t=new Set,n=[];return(e||[]).forEach(r=>{let o="";typeof r=="string"?o=r:r&&typeof r=="object"&&(o=r.tag||r.title||r.name||"");let i=String(o||"").trim();i&&!t.has(i)&&(t.add(i),n.push(i))}),n}function Dn(e,t,n=3){if(!e)return;let r=(t||[]).filter(Boolean);if(r.length>n){let o=r.slice(0,n),i=r.slice(n),s=o.map(l=>Rt(l)),a=Rt(`+ ${i.length}`);a.classList.add("more","card__chip--more"),a.setAttribute("data-more",i.length),a.setAttribute("title",`${i.length} weitere Genres: ${i.join(", ")}`),a._extraChips=i.map(l=>Rt(l)),s.push(a),e.replaceChildren(...s)}else{let o=r.map(i=>Rt(i));e.replaceChildren(...o)}$a(e)}function $a(e=document){try{e.querySelectorAll(".chip.more, .card__chip--more").forEach(t=>{t.dataset.bound||(t.dataset.bound="1",t.addEventListener("click",n=>{n.stopPropagation();let r=t.closest(".card");if(r)r.click();else{let o=t._extraChips||[];try{o.forEach(i=>t.before(i))}catch{}t.remove()}}))})}catch{}}function De(e){return(e&&e.collections||[]).map(t=>t&&(t.tag||t.title||t.name||"")).filter(Boolean)}function O(e){if(!e)return"";let t=[e.originallyAvailableAt,e.year,e.releaseDate,e.premiereDate];for(let n of t){if(n==null)continue;let r=String(n);if(!r)continue;let o=r.match(/\d{4}/);if(o)return o[0]}return""}function J(e){if(e instanceof Number)return J(e.valueOf());if(typeof e=="number")return Number.isFinite(e)?e.toFixed(1):"0.0";if(typeof e=="string"){let t=e.trim();if(!t)return"0.0";let n=Number(t);return Number.isFinite(n)?n.toFixed(1):"0.0"}return"0.0"}function Rt(e){let t=document.createElement("span");return t.className="chip",t.textContent=String(e||""),t}function ze(e){if(!(e!=null&&e.addedAt))return!1;let t=new Date(e.addedAt).getTime();if(!Number.isFinite(t))return!1;let n=k().cfg||{},r=Number(n.newDays||30);return Date.now()-t<=r*24*60*60*1e3}function Ba(){var e,t;try{let n=localStorage.getItem("tmdbToken");if(n&&n.trim())return!0;let r=k();return!!((e=r.cfg)!=null&&e.tmdbToken||(t=r.cfg)!=null&&t.tmdbApiKey)}catch{return!1}}function zn(){try{return localStorage.getItem("useTmdb")==="1"}catch{return!1}}function Nt(){return Ba()}function je(){return zn()}var be=x(()=>{ee()});function Oa(){try{ie=new Set(JSON.parse(localStorage.getItem(To)||"[]"))}catch{ie=new Set}}function ko(){try{localStorage.setItem(To,JSON.stringify(Array.from(ie.values())))}catch{}}function Kn(e){var r,o;if(!e)return"";let t=e.type==="tv"||e.libraryType==="show"?"show":"movie",n=((r=e.ids)==null?void 0:r.imdb)||((o=e.ids)==null?void 0:o.tmdb)||String(e.ratingKey||"");return n?`${t}:${n}`:""}function Gn(e){return ie.has(Kn(e))}function Da(){return ie.size}function Un(e){let t=Kn(e);if(!t)return;ie.has(t)?ie.delete(t):ie.add(t),ko(),qn();let n=document.getElementById("watchlistPanel");n&&!n.hidden&&$t()}function qn(){let e=document.getElementById("watchlistCount");e&&(e.textContent=String(Da()))}function wo(){let e=document.getElementById("watchlistPanel");e&&(e.hidden=!1,e.setAttribute("aria-hidden","false"),$t())}function Io(){let e=document.getElementById("watchlistPanel");e&&(e.hidden=!0,e.setAttribute("aria-hidden","true")),jn(!1)}function za(){ie.clear(),ko(),qn(),$t()}function ja(){let e=Co(),t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="watchlist.json",document.body.append(r),r.click(),r.remove(),setTimeout(()=>URL.revokeObjectURL(r.href),1e3)}function Co(){let e=k(),t=(e.movies||[]).concat(e.shows||[]),n=new Map(t.map(r=>[Kn(r),r]));return Array.from(ie.values()).map(r=>n.get(r)).filter(Boolean)}function $t(){let e=document.getElementById("watchlistItems"),t=document.getElementById("watchlistEmpty");if(!e||!t)return;let n=Co();if(n.length===0){e.replaceChildren(),t.hidden=!1;return}t.hidden=!0;let r=document.createDocumentFragment();n.forEach(o=>{let i=document.createElement("li");i.className="watchlist-item";let s=document.createElement("span");s.className="title",s.textContent=o.title||"";let a=document.createElement("button");a.textContent="Entfernen",a.addEventListener("click",()=>{Un(o),$t()});let l=document.createElement("button");l.textContent="\xD6ffnen",l.addEventListener("click",()=>{var d,m;let u=o.type==="tv"?"show":"movie",c=((d=o.ids)==null?void 0:d.imdb)||((m=o.ids)==null?void 0:m.tmdb)||String(o.ratingKey||"");c&&(location.hash=`#/${u}/${c}`)}),i.append(s,l,a),r.append(i)}),e.replaceChildren(r)}function xo(){Oa(),qn();let e=document.getElementById("openWatchlist"),t=document.getElementById("watchlistToggle"),n=document.getElementById("closeWatchlist"),r=document.getElementById("clearWatchlist"),o=document.getElementById("exportWatchlist");e&&e.addEventListener("click",()=>{wo(),jn(!0)}),t&&t.addEventListener("click",()=>{let i=document.getElementById("watchlistPanel");i&&!i.hidden?Io():(wo(),jn(!0))}),n&&n.addEventListener("click",()=>{Io()}),r&&r.addEventListener("click",()=>{za()}),o&&o.addEventListener("click",()=>{ja()})}function jn(e){let t=document.getElementById("watchlistToggle");t&&t.setAttribute("aria-expanded",e?"true":"false")}var To,ie,Vn=x(()=>{ee();To="watchlist:v1",ie=new Set});function Fo(e){let t=e.querySelector(".v2-tabs");if(!t)return;let n=Array.from(t.querySelectorAll("button[data-t]")),r=s=>{n.forEach(a=>{let l=a.dataset.t===s;a.classList.toggle("active",l),a.setAttribute("aria-selected",l?"true":"false"),a.tabIndex=l?0:-1;let u=e.querySelector(`.v2-pane[data-pane="${a.dataset.t}"]`);u&&(u.hidden=!l,u.setAttribute("aria-hidden",u.hidden?"true":"false"))})},o=(s,a)=>{if(!n.length)return;let l=n.indexOf(s),u=a>0?0:n.length-1,c=l===-1?u:(l+a+n.length)%n.length,d=n[c];d&&(d.focus(),r(d.dataset.t))};t.addEventListener("click",s=>{let a=s.target.closest("button[data-t]");a&&(s.preventDefault(),r(a.dataset.t))}),t.addEventListener("keydown",s=>{let a=s.target.closest("button[data-t]");if(a)switch(s.key){case"ArrowLeft":case"ArrowUp":s.preventDefault(),o(a,-1);break;case"ArrowRight":case"ArrowDown":s.preventDefault(),o(a,1);break;case"Home":s.preventDefault(),n[0]&&(n[0].focus(),r(n[0].dataset.t));break;case"End":if(s.preventDefault(),n.length){let l=n[n.length-1];l.focus(),r(l.dataset.t)}break;default:break}});let i=n.find(s=>s.classList.contains("active"))||n[0];i&&r(i.dataset.t)}var Lo=x(()=>{});function Ka(e){var r;let t=((r=e==null?void 0:e.tmdb)==null?void 0:r.poster)||(e==null?void 0:e.tmdbPoster),n=(e==null?void 0:e.poster)||(e==null?void 0:e.thumbFile)||(e==null?void 0:e.art)||"";return je()&&t?t:n}function Wn(e){let t=(e==null?void 0:e.runtimeMin)||(e==null?void 0:e.durationMin)||(e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null);return Number.isFinite(t)?(e==null?void 0:e.type)==="tv"?`~${t} min/Ep`:`${t} min`:""}function Ga(e){var n;let t=Number((n=e==null?void 0:e.rating)!=null?n:e==null?void 0:e.audienceRating);return Number.isFinite(t)?`\u2605 ${J(t)}`:""}function Yn(e){return(e==null?void 0:e.studio)||(e==null?void 0:e.network)||(e==null?void 0:e.studioName)||""}function Ua(e){let t=[];return ze(e)&&t.push("Neu"),(e==null?void 0:e.type)==="tv"&&Number.isFinite(Number(e==null?void 0:e.seasonCount))&&t.push(`Staffeln: ${e.seasonCount}`),((e==null?void 0:e.genres)||[]).map(r=>r?typeof r=="string"?r:r.tag||r.title||r.name||"":"").filter(Boolean).forEach(r=>t.push(r)),t}function Po(e,t){let n=e.querySelector(".v2-title");n&&(n.textContent=(t==null?void 0:t.title)||(t==null?void 0:t.name)||"");let r=((t==null?void 0:t.tagline)||"").trim(),o=e.querySelector(".v2-meta"),i=e.querySelector(".v2-subline"),s=O(t),a=Wn(t),l=Ga(t),u=Yn(t),c=[s,a,l,u].filter(Boolean);if(i){let p=c.join(" \u2022 ");i.textContent=r||p,i.hidden=!(r||p)}o&&(o.textContent=r&&c.length?c.join(" \u2022 "):"",o.hidden=!(r&&c.length));let d=e.querySelector(".v2-chips");d&&(d.replaceChildren(),Ua(t).forEach(p=>{let f=document.createElement("span");f.className="chip",f.textContent=p,d.appendChild(f)}),d.hidden=!d.childElementCount);let m=e.querySelector(".v2-facts"),h=e.querySelector(".v2-facts-list");if(m&&h){let p=[];s&&p.push(["Jahr",s]);let f=((t==null?void 0:t.contentRating)||"").trim();f&&p.push(["Freigabe",f]),a&&p.push(["Laufzeit",a]),l&&p.push(["Bewertung",l]),u&&p.push(["Studio",u]),h.replaceChildren(),p.forEach(([y,T])=>{let C=document.createElement("dt");C.textContent=y;let M=document.createElement("dd");M.textContent=T,h.append(C,M)}),m.hidden=!p.length}let g=e.querySelector(".v2-poster img");if(g){let p=Ka(t);g.src=p||"",g.alt=t!=null&&t.title?`Poster: ${t.title}`:"",g.loading="lazy",g.decoding="async",g.classList.remove("is-ready"),p?(g.addEventListener("load",_o,{once:!0}),g.addEventListener("error",_o,{once:!0})):g.classList.add("is-ready")}}function _o(e){var t;(t=e.currentTarget)==null||t.classList.add("is-ready")}var Xn=x(()=>{be()});function Ho(e,t){let n=e.querySelector(".v2-overview");if(!n)return;let r=typeof t=="string"?t:"";if(!r){n.textContent="";return}let o=document.createElement("p");o.className="v2-overview-text line-clamp line-clamp-5",o.textContent=r;let i=document.createElement("button");i.type="button",i.className="v2-overview-toggle";let s=u=>{o.classList.toggle("is-expanded",u),i.setAttribute("aria-expanded",String(u)),i.textContent=u?"Weniger anzeigen":"Mehr anzeigen"};i.addEventListener("click",()=>{let u=i.getAttribute("aria-expanded")==="true";s(!u)}),n.replaceChildren(o,i),s(!1),(typeof requestAnimationFrame=="function"?requestAnimationFrame:u=>setTimeout(u,0))(()=>{o.scrollHeight>o.clientHeight+1||(o.classList.add("is-expanded"),i.hidden=!0)})}var Ro=x(()=>{});function qa(e){let t=[e==null?void 0:e.originallyAvailableAt,e==null?void 0:e.releaseDate,e==null?void 0:e.premiereDate,e==null?void 0:e.firstAired,e==null?void 0:e.airDate];for(let r of t){let o=r==null?"":String(r).trim();if(!o)continue;let i=new Date(o);if(Number.isFinite(i.getTime()))try{return i.toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{}let s=o.match(/^\d{4}-\d{2}-\d{2}/);if(s&&s[0])return s[0];if(o.length>=4)return o.slice(0,10)}let n=O(e);return n?String(n):""}function Ce(e){return Array.isArray(e)?e.map(t=>t?typeof t=="string"?t:t.tag||t.title||t.name||"":"").filter(Boolean):[]}function Va(e){let n=(Array.isArray(e==null?void 0:e.genres)?e.genres:[]).map(r=>r?typeof r=="string"?r:r.tag||r.title||r.name||"":"").filter(Boolean);return Array.from(new Set(n))}function Bt(e){if(e instanceof Number)return Bt(e.valueOf());if(typeof e=="number")return Number.isFinite(e)?J(e):"";if(typeof e=="string"){let t=e.trim();if(!t)return"";let n=Number(t);return Number.isFinite(n)?J(n):""}return""}function No(e,t){let n=e.querySelector(".v2-details");if(!n)return;n.replaceChildren();let r=document.createElement("div");r.className="v2-details-grid";let o=[],i=qa(t);i&&o.push(["Ver\xF6ffentlichung",i]);let s=Wn(t);s&&o.push(["Laufzeit",s]);let a=Yn(t);a&&o.push(["Studio",a]);let l=((t==null?void 0:t.contentRating)||"").trim();l&&o.push(["Freigabe",l]);let u=Bt(t==null?void 0:t.rating),c=Bt(t==null?void 0:t.audienceRating),d=Bt(t==null?void 0:t.userRating);if(u?(o.push(["Bewertung",`\u2605 ${u}`]),c&&c!==u&&o.push(["Publikum",`\u2605 ${c}`])):c&&o.push(["Bewertung",`\u2605 ${c}`]),d&&o.push(["Eigene Wertung",`\u2605 ${d}`]),(t==null?void 0:t.type)==="tv"){let A=Number(t==null?void 0:t.seasonCount),w=Number.isFinite(A)?A:Array.isArray(t==null?void 0:t.seasons)?t.seasons.length:null;Number.isFinite(w)&&w>0&&o.push(["Staffeln",String(w)]);let L=Array.isArray(t==null?void 0:t.seasons)?t.seasons.reduce((D,N)=>{if(!N)return D;let G=Array.isArray(N.episodes)?N.episodes.length:0;return D+(Number.isFinite(G)?G:0)},0):null;Number.isFinite(L)&&L>0&&o.push(["Episoden",String(L)])}let m=Ce(t==null?void 0:t.countries);m.length&&o.push(["L\xE4nder",m.join(", ")]);let h=Ce(t==null?void 0:t.collections);h.length&&o.push(["Sammlungen",h.join(", ")]);let g=Ce(t==null?void 0:t.labels);if(g.length&&o.push(["Labels",g.join(", ")]),t!=null&&t.editionTitle&&o.push(["Edition",t.editionTitle]),t!=null&&t.originalTitle&&t.originalTitle!==t.title&&o.push(["Originaltitel",t.originalTitle]),o.length){let A=document.createElement("section");A.className="v2-details-section",A.dataset.section="general";let w=document.createElement("h3");w.className="v2-details-heading",w.textContent="Allgemein";let L=document.createElement("dl");L.className="v2-details-list",o.forEach(([D,N])=>{if(!D||!N)return;let G=document.createElement("dt");G.textContent=D;let F=document.createElement("dd");F.textContent=N,L.append(G,F)}),L.childElementCount&&(A.append(w,L),r.append(A))}let p=Va(t);if(p.length){let A=document.createElement("section");A.className="v2-details-section",A.dataset.section="genres";let w=document.createElement("h3");w.className="v2-details-heading",w.textContent="Genres";let L=document.createElement("div");L.className="v2-chip-group",p.forEach(D=>{let N=document.createElement("span");N.className="chip",N.textContent=D,L.appendChild(N)}),A.append(w,L),r.append(A)}let f=[],y=Ce(t==null?void 0:t.directors);y.length&&f.push(["Regie",y.join(", ")]);let T=Ce(t==null?void 0:t.writers);T.length&&f.push(["Drehbuch",T.join(", ")]);let C=Ce(t==null?void 0:t.producers);C.length&&f.push(["Produktion",C.join(", ")]);let M=Ce((t==null?void 0:t.creators)||(t==null?void 0:t.showrunners));if((t==null?void 0:t.type)==="tv"&&M.length&&f.push(["Creator",M.join(", ")]),f.length){let A=document.createElement("section");A.className="v2-details-section",A.dataset.section="crew";let w=document.createElement("h3");w.className="v2-details-heading",w.textContent="Credits";let L=document.createElement("dl");L.className="v2-details-list",f.forEach(([D,N])=>{if(!D||!N)return;let G=document.createElement("dt");G.textContent=D;let F=document.createElement("dd");F.textContent=N,L.append(G,F)}),L.childElementCount&&(A.append(w,L),r.append(A))}if(r.childElementCount)n.appendChild(r);else{let A=document.createElement("p");A.className="v2-details-empty",A.textContent="Keine zus\xE4tzlichen Details verf\xFCgbar.",n.appendChild(A)}}var $o=x(()=>{be();Xn()});function Bo(e,t){let n=Wa(e,t);if(!n)return;let r=Array.isArray(e)&&!Jn(e)?e||[]:Array.isArray(t)?t:[];n.replaceChildren(),(r||[]).forEach((o,i)=>n.append(Ya(o,i)))}function Jn(e){return e instanceof Element||typeof e=="string"}function Wa(e,t){if(Jn(e)){if(e instanceof Element)return e;if(typeof e=="string")return document.querySelector(e)}if(Jn(t)){if(t instanceof Element)return t;if(typeof t=="string")return document.querySelector(t)}return document.getElementById("seasonsAccordion")}function Ya(e,t){te(e);let n=document.createElement("article");n.className="season-card";let r=document.createElement("div");r.className="season-head";let o=document.createElement("div");o.className="season-thumb";let i=new Image;i.loading="lazy",i.decoding="async",i.src=e.thumbFile||"",i.alt=e.title||`Staffel ${e.seasonNumber||t+1}`,o.append(i);let s=document.createElement("div"),a=document.createElement("div");a.className="season-title",a.textContent=e.title||`Staffel ${e.seasonNumber||t+1}`;let l=document.createElement("div");l.className="season-sub";let u=e.year||e.releaseYear||"",c=Array.isArray(e.episodes)?e.episodes.length:e.episodeCount||0;l.textContent=[u,c?`${c} Episoden`:""].filter(Boolean).join(" \u2022 "),s.append(a,l);let d=document.createElement("div");d.className="chev",d.textContent="\u203A",r.append(o,s,d);let m=document.createElement("div");return m.className="season-body",(e.episodes||[]).forEach(h=>{te(h),m.append(Xa(h))}),r.addEventListener("click",()=>n.classList.toggle("open")),n.append(r,m),n}function Xa(e){var m;let t=document.createElement("div");t.className="episode";let n=document.createElement("div");n.className="ep-title";let r=e.seasonNumber!=null?Number(e.seasonNumber):null,o=e.episodeNumber!=null?Number(e.episodeNumber):null,i=e.seasonEpisode&&String(e.seasonEpisode).toUpperCase()||(Number.isFinite(r)&&Number.isFinite(o)?`S${String(r).padStart(2,"0")}E${String(o).padStart(2,"0")}`:"");n.textContent=`${i?i+" \u2022 ":""}${e.title||""}`;let s=document.createElement("div");s.className="badges";let a=Number((m=e.audienceRating)!=null?m:e.rating);if(Number.isFinite(a)){let h=document.createElement("span");h.className="badge",h.textContent=`${a.toFixed(1)}`,s.append(h)}let l=document.createElement("div");l.className="ep-meta";let u=e.durationMin||(e.duration?Math.round(Number(e.duration)/6e4):null),c=e.durationHuman||(u?`${u} min`:null),d=e.originallyAvailableAt||e.date||"";return l.textContent=[c,d].filter(Boolean).join(" \u2022 "),t.append(n,s,l),t}var Oo=x(()=>{Oe()});function Do(e,t){let n=e.querySelector(".v2-seasons");if(!n)return;let r=Array.isArray(t==null?void 0:t.seasons)?t.seasons:[];if(!r.length){n.innerHTML='<p class="modalv2-loading">Keine Staffel-Informationen verf\xFCgbar.</p>';return}n.innerHTML="",Bo(n,r)}var zo=x(()=>{Oo()});function jo(e,t){var u,c;let n=e.querySelector("#v2Tmdb"),r=e.querySelector("#v2Imdb"),o=e.querySelector("#v2Trailer"),i=((u=t==null?void 0:t.ids)==null?void 0:u.tmdb)||(t==null?void 0:t.tmdbId),s=((c=t==null?void 0:t.ids)==null?void 0:c.imdb)||(t==null?void 0:t.imdbId),a=(t==null?void 0:t.trailer)||(t==null?void 0:t.trailerUrl),l=(t==null?void 0:t.type)==="tv"?"tv":"movie";n&&(i?(n.hidden=!1,n.href=`https://www.themoviedb.org/${l}/${i}`):(n.hidden=!0,n.removeAttribute("href"))),r&&(s?(r.hidden=!1,r.href=`https://www.imdb.com/title/${s}/`):(r.hidden=!0,r.removeAttribute("href"))),o&&(a?(o.hidden=!1,o.onclick=()=>window.open(a,"_blank","noopener")):(o.hidden=!0,o.onclick=null))}var Ko=x(()=>{});function Go(e){return(Array.isArray(e==null?void 0:e.cast)?e.cast:Array.isArray(e==null?void 0:e.roles)?e.roles:[]).map(n=>{var a,l,u;if(!n)return null;if(typeof n=="string"){let c=String(n).trim();return c?{name:c,role:"",thumb:"",tmdbProfile:"",raw:null}:null}let r=String(n.tag||n.name||n.role||"").trim();if(!r)return null;let o=(()=>{let c=String(n.role||"").trim();return c?c.toLowerCase()===r.toLowerCase()?"":c:""})(),i=[(a=n==null?void 0:n.tmdb)==null?void 0:a.profile,(l=n==null?void 0:n.tmdb)==null?void 0:l.profile_path,(u=n==null?void 0:n.tmdb)==null?void 0:u.profilePath,n==null?void 0:n.tmdbProfile,n==null?void 0:n.profile,n==null?void 0:n.profile_path,n==null?void 0:n.profilePath].find(c=>typeof c=="string"&&c.trim()),s=[n==null?void 0:n.thumb,n==null?void 0:n.photo,n==null?void 0:n.image].find(c=>typeof c=="string"&&c.trim())||"";return{name:r,role:o,thumb:s,tmdbProfile:i?String(i).trim():"",raw:n}}).filter(Boolean)}function Uo(e,t){let n=e.querySelector(".v2-cast");if(!n)return;n.innerHTML='<div class="v2-cast-scroll"></div>';let r=n.querySelector(".v2-cast-scroll");if(!r)return;let o=Array.isArray(t)?t.slice(0,12):[];if(!o.length){r.innerHTML='<span class="modalv2-loading">Keine Besetzungsdaten verf\xFCgbar.</span>',r.removeAttribute("role");return}r.setAttribute("role","list");let i=je();o.forEach(s=>{let a=s&&typeof s=="object"&&"name"in s?s:(()=>{let h=String(s||"").trim();return h?{name:h,role:"",thumb:"",tmdbProfile:"",raw:null}:null})();if(!a||!a.name)return;let l=document.createElement("article");l.className="v2-cast-card",l.tabIndex=0,l.setAttribute("role","listitem");let u=String(a.role||"").trim();l.setAttribute("aria-label",u?`${a.name} \u2013 ${u}`:a.name);let c=document.createElement("div");c.className="v2-cast-avatar";let d=tl(a,i);if(d){c.classList.add("has-image");let h=document.createElement("img");h.src=d,h.alt=a.name,h.loading="lazy",h.decoding="async",c.appendChild(h)}else{let h=document.createElement("span");h.className="v2-cast-initials",h.textContent=nl(a.name),h.setAttribute("aria-hidden","true"),c.appendChild(h)}let m=document.createElement("p");if(m.className="v2-cast-name",m.textContent=a.name,l.append(c,m),u){let h=document.createElement("p");h.className="v2-cast-role",h.textContent=u,l.append(h)}else l.classList.add("v2-cast-card--no-role");r.appendChild(l)}),r.children.length||(r.innerHTML='<span class="modalv2-loading">Keine Besetzungsdaten verf\xFCgbar.</span>',r.removeAttribute("role"))}function Qa(e){let t=String(e||"").trim();if(!t)return"";if(/^https?:\/\//i.test(t))return t;if(t.startsWith("//"))return`https:${t}`;let n=t.startsWith("/")?t:`/${t}`;return`${Ja}${Za}${n}`}function el(e){let t=String(e||"").trim();return t?/^https?:\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("//")?`https:${t}`:t:""}function tl(e,t){var o,i,s;if(!e)return"";let n=e.raw||{};if(t){let a=[e.tmdbProfile,(o=n==null?void 0:n.tmdb)==null?void 0:o.profile,(i=n==null?void 0:n.tmdb)==null?void 0:i.profile_path,(s=n==null?void 0:n.tmdb)==null?void 0:s.profilePath,n==null?void 0:n.tmdbProfile,n==null?void 0:n.profile,n==null?void 0:n.profile_path,n==null?void 0:n.profilePath];for(let l of a){let u=Qa(l);if(u)return u}}let r=[e.thumb,n==null?void 0:n.thumb,n==null?void 0:n.photo,n==null?void 0:n.image];for(let a of r){let l=el(a);if(l)return l}return""}function nl(e){let t=String(e||"").trim();if(!t)return"?";let r=t.split(/\s+/).slice(0,2).map(o=>o.charAt(0)).filter(Boolean);return r.length?r.join("").toUpperCase():t.charAt(0).toUpperCase()}var Ja,Za,qo=x(()=>{be();Ja="https://image.tmdb.org/t/p/",Za="w185"});function gt(e){if(e==null||typeof e!="object")return e;if(typeof structuredClone=="function")try{return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}if(Array.isArray(e))return e.map(n=>gt(n));let t={};for(let n of Object.keys(e))t[n]=gt(e[n]);return t}function Ot(e){if(!e||typeof e!="object")return null;let t=gt(e);return t.type==="show"&&(t.type="tv"),t.type||(t.type="movie"),t}function Dt(e){if(!e||typeof e!="object")return null;let t=gt(e);return t.type!=="tv"&&(t.type="tv"),Zn(t),t}function rl(e){if(!e||typeof e!="object")return null;let t=gt(e);return Zn(t),t}function Vo(e){let t=Array.isArray(e==null?void 0:e.seasons)?e.seasons:[],n=t.some(o=>Array.isArray(o==null?void 0:o.episodes)&&o.episodes.length),r=Array.isArray(e==null?void 0:e.cast)?e.cast:Array.isArray(e==null?void 0:e.roles)?e.roles:[];return!t.length||!n||!r.length}function Wo(e,t){if(!e)return e;if(t&&typeof t=="object"){let n=rl(t);Object.assign(e,n)}return Zn(e),e}function Zn(e){if(!e||typeof e!="object")return;Qn(e),e.genres=er(e.genres);let t=sl(e.cast||e.roles||[]);e.cast=t,e.roles=t,e.seasons=Array.isArray(e.seasons)?e.seasons.map(ol).filter(Boolean):[];let n=Number(e.seasonCount);e.seasonCount=Number.isFinite(n)&&n>0?n:e.seasons.length}function ol(e){if(!e||typeof e!="object")return null;let t={...e};return Qn(t),t.genres=er(t.genres),t.episodes=Array.isArray(t.episodes)?t.episodes.map(il).filter(Boolean):[],t}function il(e){if(!e||typeof e!="object")return null;let t={...e};return Qn(t),t.genres=er(t.genres),t}function Qn(e){te(e)}function er(e){if(!Array.isArray(e))return[];let t=new Set,n=[];return e.forEach(r=>{let o=null;if(typeof r=="string"){let i=r.trim();i&&(o={tag:i})}else if(r&&typeof r=="object"){let i=String(r.tag||r.title||r.name||r.label||"").trim();i&&(o={...r,tag:i})}o&&!t.has(o.tag)&&(t.add(o.tag),n.push(o))}),n}function sl(e){return Array.isArray(e)?e.map(t=>{if(!t)return null;if(typeof t=="string"){let n=t.trim();return n?{tag:n}:null}if(typeof t=="object"){let n=String(t.tag||t.name||t.role||"").trim();return n?{...t,tag:n}:{...t}}return null}).filter(Boolean):[]}var Yo=x(()=>{Oe()});var Xo={};ft(Xo,{DEMO_MOVIE:()=>al,DEMO_SERIES:()=>ll});var al,ll,Jo=x(()=>{al={type:"movie",title:"Lumen: Der Aufbruch",tagline:"Eine cineastische Demo f\xFCr das neue Modal",overview:"Die Crew der Lumen wagt den Sprung in unerforschte Welten und enth\xFCllt dabei eine Energiequelle, die alles ver\xE4ndern k\xF6nnte. Zwischen Loyalit\xE4t, Intrigen und berauschenden Bildern entfaltet sich ein Abenteuer, das f\xFCr das Cinematic-Layout entworfen wurde.",summary:"Die Crew der Lumen entdeckt eine Energiequelle, die das Schicksal der Menschheit ver\xE4ndern k\xF6nnte.",runtimeMin:142,contentRating:"FSK 12",studio:"Aurora Pictures",rating:8.4,audienceRating:8,userRating:8.7,originallyAvailableAt:"2024-05-17",countries:[{tag:"Deutschland"},{tag:"Kanada"}],genres:[{tag:"Science-Fiction"},{tag:"Drama"},{tag:"Abenteuer"}],cast:[{name:"Mara Lenz",role:"Captain Alys Vega",tmdbProfile:"/3rxeQHiuCYaXJqfyUG8yt0YdHtH.jpg"},{name:"Tariq Benassi",role:"Navigator Elian Soh",tmdbProfile:"/wGl8DCycJ2U0FvJbLABd8R4FS3X.jpg"},{name:"Hannah Ko",role:"Wissenschaftlerin Dr. Mira Han",tmdbProfile:"/hJuDvwzS0SPlsE6MN4pF2UYDGtt.jpg"}],directors:[{tag:"Jonas Falk"}],writers:[{tag:"Lea Winter"}],producers:[{tag:"Studio Atlas"}],labels:[{tag:"Dolby Atmos"},{tag:"4K"}],collections:[{tag:"Aurora-Saga"}],trailer:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",tmdbPoster:"https://image.tmdb.org/t/p/w500/2lUYbD2C3XSuwqMUbDVDQuz9mqz.jpg",ids:{tmdb:"demo-lumen",imdb:"tt0000001"},addedAt:"2024-06-01T12:00:00Z"},ll={type:"tv",title:"Aurora Station",tagline:"Neue Horizonte in Serie",overview:"Die Besatzung der Aurora Station sch\xFCtzt eine Au\xDFenposten an der Grenze des bekannten Raums. Jede Episode verbindet kosmische R\xE4tsel mit pers\xF6nlichen Geschichten \u2013 perfekt geeignet, um das Cinematic-Modal auszuprobieren.",summary:"Ein orbitaler Au\xDFenposten ringt um Hoffnung und Zusammenhalt, w\xE4hrend eine fremde Macht erwacht.",contentRating:"TV-14",studio:"Nebula Network",originallyAvailableAt:"2023-09-14",seasonCount:2,genres:[{tag:"Science-Fiction"},{tag:"Drama"}],countries:[{tag:"USA"},{tag:"Island"}],creators:[{tag:"Elina S\xF8rensen"}],cast:[{name:"Noah Adler",role:"Commander Ivar Hale",tmdbProfile:"/4MqUjb1SYrzHmFSVoKHSKP5MGGm.jpg"},{name:"Sofia Idris",role:"Ingenieurin Kaia Rhee",tmdbProfile:"/tHMgWz6EpRdbgoMJ2JfzFzjg3QB.jpg"},{name:"Helena Ruiz",role:"Strategin Tala Voss",tmdbProfile:"/ziEuG1ESSofxDCspotYlrwz3Tq.png"}],seasons:[{title:"Staffel 1",seasonNumber:1,year:2023,thumbFile:"https://image.tmdb.org/t/p/w300/4dO2YpC8S9nLmQAXoJLRV8LZRxn.jpg",episodes:[{title:"Kapitel Eins: Erwachen",seasonNumber:1,episodeNumber:1,durationMin:54,originallyAvailableAt:"2023-09-14",audienceRating:8.6},{title:"Kapitel Zwei: Grenzwelten",seasonNumber:1,episodeNumber:2,durationMin:52,originallyAvailableAt:"2023-09-21",audienceRating:8.2}]},{title:"Staffel 2",seasonNumber:2,year:2024,thumbFile:"https://image.tmdb.org/t/p/w300/bSL4hY8SgdKzac8AUbWQm74y87C.jpg",episodes:[{title:"Kapitel Dreizehn: Resonanz",seasonNumber:2,episodeNumber:1,durationMin:56,originallyAvailableAt:"2024-02-08",audienceRating:8.9},{title:"Kapitel Vierzehn: Echo",seasonNumber:2,episodeNumber:2,durationMin:55,originallyAvailableAt:"2024-02-15",audienceRating:8.7}]}],tmdbPoster:"https://image.tmdb.org/t/p/w500/a4I481szRmycyreQTLrRe4f4YJe.jpg",ids:{tmdb:"demo-aurora-station",imdb:"tt0000002"}}});function Zo(){return tr||(tr=Promise.resolve().then(()=>(Jo(),Xo)).catch(e=>({DEMO_MOVIE:null,DEMO_SERIES:null}))),tr}function cl(){if(Z)return Z;let e=document.getElementById("modal-root-v2");if(!e)return null;if(le=e,e.classList.add("modalv2-overlay"),e.hasAttribute("hidden")||e.setAttribute("hidden",""),e.dataset.modalv2Ready||(e.innerHTML=`
      <div class="modalv2-backdrop" data-modalv2-backdrop="1"></div>
      <div class="modalv2-dialog" role="dialog" aria-modal="true">
        <div class="modalv2-scroll" data-modalv2-scroll></div>
      </div>
    `,e.dataset.modalv2Ready="1",e.addEventListener("click",ul)),z=e.querySelector(".modalv2-dialog"),z&&!z.hasAttribute("tabindex")&&z.setAttribute("tabindex","-1"),ve=e.querySelector("[data-modalv2-scroll]"),ve&&!Z){let t=ve.querySelector(".modalv2");t?Z=t:(Z=document.createElement("div"),Z.className="modalv2",Z.setAttribute("hidden",""),ve.appendChild(Z))}return Z}function ul(e){if(!le)return;let t=e.target;(t===le||t&&t.dataset&&t.dataset.modalv2Backdrop)&&rr()}function Qo(){return z?Array.from(z.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(t=>t.hasAttribute("disabled")||t.getAttribute("aria-hidden")==="true"||t.hasAttribute("hidden")?!1:t.offsetParent!==null):[]}function dl(){z&&(xe&&z.removeEventListener("keydown",xe),xe=e=>{if(e.key!=="Tab")return;let t=Qo();if(!t.length)return;let n=t[0],r=t[t.length-1];e.shiftKey?document.activeElement===n&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),n.focus())},z.addEventListener("keydown",xe))}function fl(){!z||!xe||(z.removeEventListener("keydown",xe),xe=null)}function hl(){Ge||(Ge=e=>{e.key==="Escape"&&(e.preventDefault(),rr())},window.addEventListener("keydown",Ge))}function gl(){Ge&&(window.removeEventListener("keydown",Ge),Ge=null)}function zt(){let e=cl();return!e||!le?null:(le.hidden=!1,le.setAttribute("aria-hidden","false"),document.body.classList.add("modalv2-open"),ve&&(ve.scrollTop=0),dl(),hl(),e)}function nr(){if(!z)return;let e=z.querySelector("#v2Close"),t=Qo(),n=e&&!e.hasAttribute("hidden")?e:t[0];if(n||(n=z),n){let r=()=>{try{n.focus()}catch{}};(window.requestAnimationFrame||setTimeout)(r,0)}}function ml(e="Details werden geladen \u2026"){let t=zt();if(!t)return;t.hidden=!1;let n=document.createElement("div");n.className="modalv2-loading",n.textContent=String(e||"Details werden geladen \u2026"),t.replaceChildren(n)}function ei(e){let t=zt();if(!t)return;t.hidden=!1;let n=(e==null?void 0:e.type)==="tv";t.innerHTML=`
    <section class="v2-layout">
      <aside class="v2-side">
        <div class="v2-poster"><img alt=""></div>
        <div class="v2-facts" aria-label="Schnellinfos" hidden>
          <h3 class="v2-facts-title">Schnellinfos</h3>
          <dl class="v2-facts-list"></dl>
        </div>
      </aside>
      <div class="v2-info">
        <header class="v2-head">
          <div class="v2-titlebar">
            <div class="v2-title-wrap">
              <h2 class="v2-title" id="modalV2Title"></h2>
              <div class="v2-subline"></div>
              <div class="v2-meta"></div>
            </div>
            <div class="v2-actions" aria-label="Externe Aktionen">
              <button class="v2-icon-btn" id="v2Close" type="button" aria-label="Schlie\xDFen">
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M6 6l12 12M6 18L18 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                </svg>
              </button>
              <a class="v2-icon-btn" id="v2Tmdb" target="_blank" rel="noopener noreferrer" aria-label="Auf TMDB \xF6ffnen" hidden>
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M4 9h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"></path>
                  <path d="M4 9V7a2 2 0 0 1 2-2h1l2 4 2-4 2 4 2-4h1a2 2 0 0 1 2 2v2" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </a>
              <a class="v2-icon-btn" id="v2Imdb" target="_blank" rel="noopener noreferrer" aria-label="Auf IMDb \xF6ffnen" hidden>
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M12 4l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"></path>
                </svg>
              </a>
              <button class="v2-icon-btn" id="v2Trailer" type="button" aria-label="Trailer abspielen" hidden>
                <svg class="v2-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path d="M9 6l8 6-8 6V6z" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round" stroke-linecap="round"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="v2-chips" aria-label="Attribute"></div>
        </header>
        <nav class="v2-tabs" aria-label="Details Navigation" role="tablist">
          <button type="button" data-t="overview" class="active" id="v2TabOverview" role="tab" aria-controls="v2PaneOverview" aria-selected="true">\xDCberblick</button>
          <button type="button" data-t="details" id="v2TabDetails" role="tab" aria-controls="v2PaneDetails" aria-selected="false">Details</button>
          ${n?'<button type="button" data-t="seasons" id="v2TabSeasons" role="tab" aria-controls="v2PaneSeasons" aria-selected="false">Staffeln</button>':""}
          <button type="button" data-t="cast" id="v2TabCast" role="tab" aria-controls="v2PaneCast" aria-selected="false">Cast</button>
        </nav>
        <section class="v2-body">
          <div class="v2-pane v2-overview" data-pane="overview" id="v2PaneOverview" role="tabpanel" aria-labelledby="v2TabOverview"></div>
          <div class="v2-pane v2-details" data-pane="details" id="v2PaneDetails" role="tabpanel" aria-labelledby="v2TabDetails" hidden></div>
          ${n?'<div class="v2-pane v2-seasons" data-pane="seasons" id="v2PaneSeasons" role="tabpanel" aria-labelledby="v2TabSeasons" hidden></div>':""}
          <div class="v2-pane v2-cast" data-pane="cast" id="v2PaneCast" role="tabpanel" aria-labelledby="v2TabCast" hidden></div>
        </section>
      </div>
    </section>
  `,Po(t,e),jo(t,e),Ho(t,(e==null?void 0:e.overview)||(e==null?void 0:e.summary)||""),No(t,e),(e==null?void 0:e.type)==="tv"&&Do(t,e),Uo(t,Go(e)),Fo(t);let r=t.querySelector("#v2Close");r&&r.addEventListener("click",rr),z&&z.setAttribute("aria-labelledby","modalV2Title"),nr()}async function qe(e){let t=++ye;Ke=document.activeElement instanceof HTMLElement?document.activeElement:null;let n=zt();if(!n)return;let r=await pl(e);if(t===ye){if(!r){n.hidden=!1;let o=document.createElement("div");o.className="modalv2-loading",o.textContent="Film konnte nicht geladen werden.",n.replaceChildren(o),Ue=null,mt=null,nr();return}Ue=r,mt="movie",ei(r)}}async function Ve(e){let t=++ye;Ke=document.activeElement instanceof HTMLElement?document.activeElement:null;let n=await bl(e),r=zt();if(!r||t!==ye)return;if(!n){r.hidden=!1;let i=document.createElement("div");i.className="modalv2-loading",i.textContent="Seriendetails konnten nicht geladen werden.",r.replaceChildren(i),Ue=null,mt=null,nr();return}Ue=n,mt="show";let o=n;if(Vo(o)){if(ml(),t!==ye)return;let i=null;try{i=await Eo(o)}catch{i=null}if(t!==ye)return;i&&(Wo(o,i),Ue=o)}t===ye&&ei(o)}function rr(){if(ye++,!!le){if(le.hidden=!0,le.setAttribute("aria-hidden","true"),document.body.classList.remove("modalv2-open"),fl(),gl(),Z&&(Z.innerHTML="",Z.setAttribute("hidden","")),ve&&(ve.scrollTop=0),Ke&&typeof Ke.focus=="function")try{Ke.focus()}catch{}Ke=null,Ue=null,mt=null}}async function pl(e){if(e==="demo"){let{DEMO_MOVIE:i}=await Zo();return Ot(i)}if(e&&typeof e=="object")return Ot(e);let t=e==null?"":String(e).trim();if(!t)return null;let n=k(),o=(Array.isArray(n==null?void 0:n.movies)?n.movies:[]).find(i=>ti(i,t));return o?Ot(o):null}async function bl(e){if(e==="demo"){let{DEMO_SERIES:i}=await Zo();return Dt(i)}if(e&&typeof e=="object")return Dt(e);let t=e==null?"":String(e).trim();if(!t)return null;let n=k(),o=(Array.isArray(n==null?void 0:n.shows)?n.shows:[]).find(i=>ti(i,t));return o?Dt(o):null}function ti(e,t){var r,o;if(!e)return!1;let n=String(t||"").trim();return n?!!((r=e==null?void 0:e.ids)!=null&&r.imdb&&String(e.ids.imdb)===n||(o=e==null?void 0:e.ids)!=null&&o.tmdb&&String(e.ids.tmdb)===n||(e==null?void 0:e.ratingKey)!=null&&String(e.ratingKey)===n):!1}var le,z,ve,Z,Ke,xe,Ge,ye,mt,Ue,tr,jt=x(()=>{Lo();Xn();Ro();$o();zo();Ko();qo();ee();Oe();Yo();le=null,z=null,ve=null,Z=null,Ke=null,xe=null,Ge=null,ye=0,mt=null,Ue=null,tr=null});function vl(){}function Kt(e){let t=parseFloat(e);return Number.isFinite(t)?t:0}var ni,yl,Gt,ri=x(()=>{ni=typeof requestAnimationFrame=="function"?requestAnimationFrame:e=>setTimeout(e,16),yl=typeof cancelAnimationFrame=="function"?cancelAnimationFrame:e=>clearTimeout(e);Gt=class{constructor({container:t,renderItem:n,getKey:r=vl,updateItem:o=null,getSignature:i=null,overscan:s=2,estimatedItemHeight:a=420,minItemWidth:l=190}){if(!t)throw new Error("VirtualList requires a container element");if(typeof n!="function")throw new Error("VirtualList requires a renderItem function");this.container=t,this.renderItem=n,this.getKey=r,this.updateItem=typeof o=="function"?o:null,this.getSignature=typeof i=="function"?i:null,this.overscan=Math.max(0,s|0),this.estimatedItemHeight=a,this.minItemWidth=l,this.items=[],this.range={start:0,end:0},this.columns=1,this.rowCount=0,this.rowHeight=this.estimatedItemHeight,this.totalHeight=0,this.itemHeight=this.estimatedItemHeight,this.containerTop=0,this.paddingTop=0,this.paddingBottom=0,this.gapY=0,this.gapX=0,this.metricsDirty=!0,this.pendingFrame=0,this.lastWidth=0,this.nodeCache=new Map,this.renderedKeys=new Set,this.itemSignatures=new Map,this.scrollTicking=!1,this.spacer=document.createElement("div"),this.spacer.className="grid-virtual__spacer",this.windowEl=document.createElement("div"),this.windowEl.className="grid-virtual__window",this.itemsHost=document.createElement("div"),this.itemsHost.className="grid-virtual__items",this.container.textContent="",this.windowEl.append(this.itemsHost),this.container.append(this.spacer,this.windowEl),this.measureRoot=document.createElement("div"),this.measureRoot.className="grid-virtual__measure",this.measureRoot.setAttribute("aria-hidden","true"),Object.assign(this.measureRoot.style,{position:"absolute",visibility:"hidden",pointerEvents:"none",inset:"0 auto auto 0",zIndex:"-1"}),this.container.append(this.measureRoot),this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.update=this.update.bind(this),window.addEventListener("scroll",this.handleScroll,{passive:!0}),window.addEventListener("resize",this.handleResize),typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.container)):this.resizeObserver=null}destroy(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),this.resizeObserver&&this.resizeObserver.disconnect(),this.pendingFrame&&(yl(this.pendingFrame),this.pendingFrame=0),this.nodeCache.clear(),this.renderedKeys.clear(),this.itemSignatures.clear(),this.items=[],this.spacer.remove(),this.windowEl.remove(),this.measureRoot.remove()}schedule(t=!1){t&&(this.metricsDirty=!0),!this.pendingFrame&&(this.pendingFrame=ni(()=>{this.pendingFrame=0,this.update()}))}handleScroll(){this.scrollTicking||(this.scrollTicking=!0,this.schedule(!1),ni(()=>{this.scrollTicking=!1}))}handleResize(){let t=this.container.clientWidth;t!==this.lastWidth&&(this.metricsDirty=!0,this.lastWidth=t),this.schedule(!0)}setItems(t){this.items=Array.isArray(t)?t.slice():[],this.metricsDirty=!0,this.pruneCache(),this.measureItems(),this.update()}measureItems(){if(!this.items.length){this.itemHeight=this.estimatedItemHeight;return}let t=this.items[0];this.measureRoot.textContent="";let n=this.renderItem(t,0);if(n instanceof HTMLElement)if(this.measureRoot.append(n),typeof n.getBoundingClientRect=="function"){let r=n.getBoundingClientRect();r&&r.height>0&&(this.itemHeight=r.height)}else n.offsetHeight&&(this.itemHeight=n.offsetHeight);this.measureRoot.textContent=""}pruneCache(){if(!this.items.length){this.nodeCache.forEach(r=>r.remove()),this.nodeCache.clear(),this.itemSignatures.clear(),this.renderedKeys.clear();return}let t=new Set,n=this.getSignature?new Map:null;this.items.forEach((r,o)=>{let i=this.keyFor(r,o);if(t.add(i),n){let s=this.signatureFor(r,o);n.set(i,s);let a=this.itemSignatures.get(i);if(a!==void 0&&a!==s){let l=this.nodeCache.get(i);l&&(l.parentNode&&l.parentNode.removeChild(l),this.nodeCache.delete(i),this.renderedKeys.delete(i))}}}),this.nodeCache.forEach((r,o)=>{t.has(o)||(r.parentNode&&r.parentNode.removeChild(r),this.nodeCache.delete(o),this.renderedKeys.delete(o))}),n?this.itemSignatures=n:this.itemSignatures.clear()}keyFor(t,n){let r=this.getKey?this.getKey(t,n):null;return r==null||r===""?`index-${n}`:String(r)}signatureFor(t,n){if(this.getSignature)try{return this.getSignature(t,n)}catch{return}}refreshMetrics(){let t=getComputedStyle(this.container);this.paddingTop=Kt(t.paddingTop),this.paddingBottom=Kt(t.paddingBottom);let n=getComputedStyle(this.itemsHost),r=n.getPropertyValue?n.getPropertyValue("row-gap"):n.rowGap,o=n.getPropertyValue?n.getPropertyValue("column-gap"):n.columnGap,i=n.getPropertyValue?n.getPropertyValue("gap"):n.gap;this.gapY=Kt(r||i),this.gapX=Kt(o||i);let s=Math.floor((this.container.clientWidth+this.gapX)/(this.minItemWidth+this.gapX));this.columns=Math.max(1,s||1),this.rowHeight=this.itemHeight+this.gapY,this.rowHeight<=0&&(this.rowHeight=this.itemHeight||this.estimatedItemHeight),this.rowCount=this.columns>0?Math.ceil(this.items.length/this.columns):this.items.length,this.totalHeight=Math.max(0,this.rowCount*this.rowHeight),this.updateContainerPosition(),this.spacer.style.height=`${this.totalHeight}px`,this.windowEl.style.top=`${this.paddingTop}px`,this.windowEl.style.paddingBottom=`${this.paddingBottom}px`,this.metricsDirty=!1}updateContainerPosition(){let t=this.container,n=0;for(;t&&t!==document.body;)n+=t.offsetTop,t=t.offsetParent;this.containerTop=n}update(){this.metricsDirty&&this.refreshMetrics(),this.syncVisibleRange()}syncVisibleRange(){if(!this.items.length){this.windowEl.style.transform="translate3d(0, 0, 0)",this.itemsHost.replaceChildren(),this.range={start:0,end:0};return}let t=window.scrollY,n=t+window.innerHeight,r=this.containerTop+this.paddingTop,o=r+this.totalHeight;window.__VLIST_DEBUG;let i;t<=r?i=0:t>=o?i=Math.max(0,this.rowCount-1):i=Math.floor((t-r)/this.rowHeight);let s;n>=o?s=Math.max(0,this.rowCount-1):n<=r?s=0:s=Math.ceil((n-r)/this.rowHeight),i=Math.max(0,Math.min(i,Math.max(0,this.rowCount-1))-this.overscan),s=Math.min(Math.max(0,this.rowCount-1),s+this.overscan);let a=Math.max(0,Math.min(this.items.length,i*this.columns)),l=Math.max(a,Math.min(this.items.length,(s+1)*this.columns));if(a===this.range.start&&l===this.range.end){let p=!1;for(let f=a;f<l;f++){let y=this.keyFor(this.items[f],f);if(!this.renderedKeys.has(y)){p=!0;break}}if(!p)return}this.range={start:a,end:l};let c=Math.floor(a/this.columns)*this.rowHeight;this.windowEl.style.transform=`translate3d(0, ${c}px, 0)`;let d=new Set,m=[];for(let p=a;p<l;p++){let f=this.items[p],y=this.keyFor(f,p),T=this.nodeCache.get(y);if(T){if(this.updateItem){let C=this.updateItem(T,f,p);if(C instanceof HTMLElement&&C!==T)T=C,this.nodeCache.set(y,T);else if(!(C instanceof HTMLElement))continue}}else{if(T=this.renderItem(f,p),!(T instanceof HTMLElement))continue;this.nodeCache.set(y,T)}d.add(y),m.push(T)}let h=this.itemsHost.children;if(h.length===m.length){let p=!0;for(let f=0;f<m.length;f++)if(h[f]!==m[f]){p=!1;break}if(p){this.renderedKeys=d;return}}let g=new Map;for(let p=0;p<h.length;p++)g.set(h[p],p);for(let p=0;p<m.length;p++){let f=m[p],y=h[p];y!==f&&(g.has(f)?this.itemsHost.insertBefore(f,y||null):this.itemsHost.insertBefore(f,y||null))}for(;this.itemsHost.children.length>m.length;)this.itemsHost.lastChild.remove();this.renderedKeys=d}}});var gi={};ft(gi,{renderGrid:()=>W});function El(e){let t=_("article","card");t.dataset.kind=(e==null?void 0:e.type)==="tv"?"show":"movie",t.tabIndex=0,t.setAttribute("role","button"),e!=null&&e.title&&t.setAttribute("aria-label",e.title);let n=_("div","card__media"),r=new Image;r.loading="lazy",r.decoding="async",r.className="card__img",r.alt=(e==null?void 0:e.title)||"",r.style.aspectRatio="2 / 3";let o=qt(e);o&&(r.src=o);let i=_("div","card__media-gradient");i.setAttribute("aria-hidden","true");let s=Ml(e),a=_("div","card__badges");s.forEach(y=>{y instanceof HTMLElement&&a.append(y)}),n.append(r,i),a.childElementCount&&n.append(a);let l=hi(e);if(l>0){let y=_("div","card__progress"),T=document.createElement("span");T.style.width=`${Math.max(0,Math.min(100,l))}%`,y.append(T),n.append(y)}let u=_("div","card__body"),c=document.createElement("h3");c.className="card__title",c.textContent=(e==null?void 0:e.title)||"",e!=null&&e.title&&c.setAttribute("title",e.title);let d=_("div","card__meta"),m=di(e);d.textContent=m.join(" \u2022 "),u.append(c,d);let h=_("div","card__actions"),g=_("div","card__chips"),p=pe(e==null?void 0:e.genres);Dn(g,p,3);let f=document.createElement("button");return f.type="button",f.className="card__primary",ii(f,e),f.addEventListener("click",y=>{y.stopPropagation(),Un(e),ii(f,e)}),h.append(g,f),t.append(n,u,h),t.addEventListener("click",()=>si(e)),t.addEventListener("keydown",y=>{y.target===t&&(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),si(e))}),t}function Sl(e,t){let n=(t||[]).slice().sort((d,m)=>{let h=Number(O(d))||0,g=Number(O(m))||0;return h!==g?h-g:(d.title||"").localeCompare(m.title||"","de")}),r=n.map(d=>Number(O(d))||0).filter(Boolean),o=r.length?Math.min(...r):"",i=n.map(d=>new Date(d.addedAt||0).getTime()).filter(Number.isFinite),s=i.length?new Date(Math.max(...i)).toISOString():null,a=n.map(d=>{var m;return Number((m=d.rating)!=null?m:d.audienceRating)}).filter(Number.isFinite),l=a.length?a.reduce((d,m)=>d+m,0)/a.length:null,u=n.find(d=>d.thumbFile)||n[0]||null,c=Array.from(new Set(n.flatMap(d=>pe(d.genres)))).slice(0,4);return{isCollectionGroup:!0,type:"collection",title:e,collectionName:e,items:n,itemCount:n.length,year:o||"",addedAt:s,rating:l,posterItem:u,genres:c}}function Al(e){let t=document.getElementById("groupCollections"),n=document.getElementById("collectionFilter"),r=n&&n.value;if(!t||!t.checked||r)return e;let o=new Map;e.forEach(s=>{De(s).forEach(a=>{o.has(a)||o.set(a,[]),o.get(a).push(s)})});let i=[];return o.forEach((s,a)=>{i.push(Sl(a,s))}),i.sort((s,a)=>s.title.localeCompare(a.title,"de")),i}function wl(e){let t=_("article","card card--collection");t.dataset.kind="collection",t.tabIndex=0,t.setAttribute("role","button"),e!=null&&e.title&&t.setAttribute("aria-label",e.title);let n=_("div","card__media"),r=e.posterItem||{},o=new Image;o.loading="lazy",o.decoding="async",o.className="card__img",o.alt=(e==null?void 0:e.title)||"",o.style.aspectRatio="2 / 3";let i=qt(r);i&&(o.src=i);let s=_("div","card__media-gradient");s.setAttribute("aria-hidden","true");let a=Fl(e),l=_("div","card__badges");a.forEach(p=>{p instanceof HTMLElement&&l.append(p)}),n.append(o,s),l.childElementCount&&n.append(l);let u=_("div","card__body"),c=document.createElement("h3");c.className="card__title",c.textContent=e.title||"",e!=null&&e.title&&c.setAttribute("title",e.title);let d=_("div","card__meta"),m=fi(e);d.textContent=m.filter(Boolean).join(" \u2022 "),u.append(c,d);let h=_("div","card__actions"),g=_("div","card__chips");return Dn(g,e.genres||[],3),h.append(g),t.append(n,u,h),t.addEventListener("click",()=>{let p=document.getElementById("collectionFilter");p&&(p.value=e.collectionName||e.title||"",p.dispatchEvent(new Event("change",{bubbles:!0})))}),t.addEventListener("keydown",p=>{if(p.target===t&&(p.key==="Enter"||p.key===" ")){p.preventDefault();let f=document.getElementById("collectionFilter");f&&(f.value=e.collectionName||e.title||"",f.dispatchEvent(new Event("change",{bubbles:!0})))}}),t}function Il(e){return Ut||(Ut=new Gt({container:e,overscan:1,estimatedItemHeight:460,minItemWidth:190,getKey:Tl,getSignature:sr,renderItem(t){return ai(t)},updateItem(t,n){return kl(t,n)}}),Ut)}function Tl(e,t){if(e!=null&&e.isCollectionGroup){let r=e.collectionName||e.title||"";return r?`collection:${r}`:`collection-index-${t}`}let n=ir(e);return n?`item:${n}`:`item-index-${t}`}function ai(e){let t=e!=null&&e.isCollectionGroup?wl(e):El(e);return t instanceof HTMLElement&&(t[or]=sr(e)),t}function kl(e,t){if(e instanceof HTMLElement){let r=sr(t);if(e[or]===r)return e[or]=r,e}let n=ai(t);return n instanceof HTMLElement?Hl(e,n):e}function W(e){let{movies:t,shows:n,filtered:r}=k(),o=(e==="shows"?n:t)||[],i=Array.isArray(r)?r:o,s=Al(i),a=document.getElementById("grid");if(!a)return;let l=oi!==e;oi=e,l&&Cl(a),Il(a).setItems(s),l&&xl(a);let c=document.getElementById("empty");c&&(c.hidden=s.length>0),a.setAttribute("aria-busy","false")}function Cl(e){e&&(e.classList.remove("is-entering","is-ready"),e.classList.add("is-leaving"))}function xl(e){e&&(e.classList.remove("is-leaving"),e.classList.add("is-entering"),requestAnimationFrame(()=>{e.classList.add("is-ready"),setTimeout(()=>e.classList.remove("is-entering","is-ready"),240)}))}function qt(e){var r;if(!e)return"";let t=zn()&&(((r=e==null?void 0:e.tmdb)==null?void 0:r.poster)||(e==null?void 0:e.tmdbPoster)),n=(e==null?void 0:e.thumbFile)||(e==null?void 0:e.poster)||(e==null?void 0:e.art)||(e==null?void 0:e.thumb)||"";return t||n||""}function li(e){var o;let t=[];ze(e)&&t.push("Neu");let n=String((e==null?void 0:e.contentRating)||"").trim();n&&t.push(n);let r=Number((o=e==null?void 0:e.rating)!=null?o:e==null?void 0:e.audienceRating);return Number.isFinite(r)&&t.push(`\u2605 ${J(r)}`),t.slice(0,3)}function Ml(e){return li(e).map(ui)}function ci(e){let t=[];return Number.isFinite(e==null?void 0:e.itemCount)&&e.itemCount>0&&t.push(`${e.itemCount} Titel`),e!=null&&e.year&&t.push(String(e.year)),t}function Fl(e){return ci(e).map(ui)}function ui(e){let t=document.createElement("span");return t.className="badge",t.textContent=String(e||""),t}function ii(e,t){if(!e)return;let n=Gn(t);e.textContent=n?"Gemerkt":"Merken",e.classList.toggle("active",n),e.setAttribute("aria-pressed",n?"true":"false")}function di(e){var s;let t=[],n=O(e);n&&t.push(String(n));let r=Ll(e);r&&t.push(r);let o=Number((s=e==null?void 0:e.rating)!=null?s:e==null?void 0:e.audienceRating);Number.isFinite(o)&&t.push(`\u2605 ${J(o)}`);let i=(e==null?void 0:e.studio)||(e==null?void 0:e.network)||"";return i&&t.push(i),t}function fi(e){let t=[];e!=null&&e.year&&t.push(String(e.year));let n=Number(e==null?void 0:e.itemCount);Number.isFinite(n)&&t.push(`${n} Titel`);let r=Number(e==null?void 0:e.rating);return Number.isFinite(r)&&t.push(`\u2605 ${J(r)}`),t}function Ll(e){var r,o;let t=(o=(r=e==null?void 0:e.runtimeMin)!=null?r:e==null?void 0:e.durationMin)!=null?o:e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null,n=Number(t);return!Number.isFinite(n)||n<=0?"":(e==null?void 0:e.type)==="tv"?`~${n} min/Ep`:`${n} min`}function hi(e){var r;let t=Number((r=e==null?void 0:e.viewOffset)!=null?r:e==null?void 0:e.viewoffset),n=Number(e==null?void 0:e.duration);return!Number.isFinite(t)||!Number.isFinite(n)||n<=0?0:Math.max(1,Math.min(100,Math.round(t/n*100)))}function ir(e){var n,r;if(!e)return"";let t=((n=e==null?void 0:e.ids)==null?void 0:n.imdb)||((r=e==null?void 0:e.ids)==null?void 0:r.tmdb);return t?String(t):e!=null&&e.ratingKey?String(e.ratingKey):""}function sr(e){return e!=null&&e.isCollectionGroup?Pl(e):_l(e)}function _l(e){let t=pe(e==null?void 0:e.genres).slice(0,3),n=li(e),r=di(e);return JSON.stringify({id:ir(e),title:(e==null?void 0:e.title)||"",poster:qt(e),badges:n,meta:r,progress:hi(e),watch:Gn(e),genres:t})}function Pl(e){let t=(e==null?void 0:e.posterItem)||null,n=Array.isArray(e==null?void 0:e.genres)?e.genres.slice(0,3).map(String):[],r=ci(e),o=fi(e),i=Number(e==null?void 0:e.itemCount),s=Number(e==null?void 0:e.rating);return JSON.stringify({name:(e==null?void 0:e.collectionName)||(e==null?void 0:e.title)||"",title:(e==null?void 0:e.title)||"",itemCount:Number.isFinite(i)?i:null,year:(e==null?void 0:e.year)||"",rating:Number.isFinite(s)?s:null,poster:qt(t),badges:r,meta:o,genres:n})}function Hl(e,t){if(!(t instanceof HTMLElement))return e;if(!(e instanceof HTMLElement))return t;let n=e.parentNode,r=document.activeElement===e;return n&&n.replaceChild(t,e),r&&typeof t.focus=="function"&&requestAnimationFrame(()=>{try{t.focus({preventScroll:!0})}catch{t.focus()}}),t}function Rl(e,t){if(!e||!t)return;let n=`#/${e}/${t}`,r=(window.location.hash||"")===n;Wt(n,{silent:!0,replace:r})}function si(e){if(!e)return;let t=(e==null?void 0:e.type)==="tv"?"show":"movie",n=ir(e);n&&Rl(t,n),t==="show"?Ve(e):qe(e)}var or,Ut,oi,Vt=x(()=>{ee();Ct();be();Vn();jt();mi();ri();or="__gridVirtualSignature";Ut=null;oi=null});var gr={};ft(gr,{applyFilters:()=>We,computeFacets:()=>ur,initFilters:()=>hr,renderFacets:()=>dr,setFiltersUpdatedHandler:()=>fr,updateFiltersAndGrid:()=>pt});function pi(e){return String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Nl(e,t){let n=pi(t.query||""),r=!!t.onlyNew,o=Number(t.yearFrom)||null,i=Number(t.yearTo)||null,s=t.genres||new Set,a=t.collection||"";if(n&&!pi([e.title,e.originalTitle,e.summary,e.studio,pe(e.genres).join(" "),(e.roles||[]).map(c=>c&&(c.tag||c.role||c.name)).join(" "),De(e).join(" ")].filter(Boolean).join(" ")).includes(n)||r&&!ze(e))return!1;let l=Number(O(e))||null;if(o&&(!l||l<o)||i&&(!l||l>i))return!1;if(s.size){let u=new Set(pe(e.genres));for(let c of s)if(!u.has(c))return!1}return!(a&&!new Set(De(e)).has(a))}function $l(e,t){let n=e.slice();switch(t){case"year-desc":n.sort((r,o)=>(Number(O(o))||0)-(Number(O(r))||0)||String(r.title||"").localeCompare(String(o.title||""),"de"));break;case"year-asc":n.sort((r,o)=>(Number(O(r))||0)-(Number(O(o))||0)||String(r.title||"").localeCompare(String(o.title||""),"de"));break;case"title-desc":n.sort((r,o)=>String(o.title||"").localeCompare(String(r.title||""),"de"));break;case"added-desc":n.sort((r,o)=>new Date(o.addedAt||0)-new Date(r.addedAt||0));break;case"title-asc":default:n.sort((r,o)=>String(r.title||"").localeCompare(String(o.title||""),"de"))}return n}function ur(e,t){let n=new Set,r=new Set,o=new Set,i=a=>(a||[]).forEach(l=>{pe(l.genres).forEach(c=>n.add(c));let u=l.year||(l.originallyAvailableAt?String(l.originallyAvailableAt).slice(0,4):"");u&&r.add(Number(u)),De(l).forEach(c=>o.add(c))});i(e),i(t);let s=[...r].sort((a,l)=>a-l);return{genres:[...n].sort(),years:s,collections:[...o].sort((a,l)=>a.localeCompare(l,"de"))}}function dr(e){let t=$("#yearFrom"),n=$("#yearTo");t&&t.replaceChildren(new Option("Ab Jahr",""),...e.years.map(i=>new Option(String(i),String(i)))),n&&n.replaceChildren(new Option("Bis Jahr",""),...e.years.map(i=>new Option(String(i),String(i))));let r=$("#collectionFilter");r&&r.replaceChildren(new Option("Alle Collections",""),...e.collections.map(i=>new Option(i,i)));let o=$("#genreFilters");if(o){let i=e.genres.map(s=>{let a=document.createElement("button");return a.type="button",a.className="chip",a.textContent=s,a.dataset.name=s,a});o.replaceChildren(...i),cr()}}function Bl(){var l,u,c,d,m;let e=document.getElementById("search")||document.getElementById("q"),t=((e==null?void 0:e.value)||"").trim(),n=((l=$("#onlyNew"))==null?void 0:l.checked)||!1,r=((u=$("#yearFrom"))==null?void 0:u.value)||"",o=((c=$("#yearTo"))==null?void 0:c.value)||"",i=((d=$("#collectionFilter"))==null?void 0:d.value)||"",s=((m=$("#sort"))==null?void 0:m.value)||"title-asc",a=new Set;return document.querySelectorAll("#genreFilters .chip.active").forEach(h=>a.add(h.dataset.name)),{query:t,onlyNew:n,yearFrom:r,yearTo:o,collection:i,genres:a,sort:s}}function We(){let e=k(),n=e.view==="shows"?e.shows:e.movies,r=Bl(),o=(n||[]).filter(s=>Nl(s,r)),i=$l(o,r.sort);return we({filtered:i}),i}function Ol(){ar||(ar=Promise.resolve().then(()=>(Vt(),gi))),ar.then(e=>{let t=e&&e.renderGrid;typeof t=="function"&&t(k().view)}).catch(console.error)}function fr(e){lr=typeof e=="function"?e:null}function pt(){let e=We();if(Ol(),lr)try{let t=Array.isArray(e)?e.slice():[];lr(t,k().view)}catch{}return e}function cr(){let e=document.getElementById("genreFilters");if(!e)return;let t=e.querySelectorAll(".chip.active").length;e.dataset.state=t>0?"active":"empty",e.dataset.count=String(t)}function hr(){let e=$("#sort");e&&e.options.length===0&&[["title-asc","Titel A\u2013Z"],["title-desc","Titel Z\u2013A"],["year-desc","Jahr \u2193"],["year-asc","Jahr \u2191"],["added-desc","Zuletzt hinzugef\xFCgt"]].forEach(([o,i])=>e.add(new Option(i,o)));let t=(o,i="input")=>{let s=$(o);s&&(s.addEventListener(i,()=>{pt()}),i==="input"&&s instanceof HTMLInputElement&&s.type==="search"&&s.addEventListener("search",()=>{pt()}))};t("#search"),t("#q"),t("#onlyNew","change"),t("#yearFrom","change"),t("#yearTo","change"),t("#collectionFilter","change"),t("#sort","change"),t("#groupCollections","change");let n=$("#yearReset");n&&n.addEventListener("click",()=>{let o=$("#yearFrom"),i=$("#yearTo");o&&(o.value=""),i&&(i.value=""),pt()});let r=$("#genreFilters");r&&(r.addEventListener("click",o=>{let i=o.target;i instanceof HTMLElement&&i.classList.contains("chip")&&(i.classList.toggle("active"),cr(),pt())}),cr())}var ar,lr,mr=x(()=>{ee();Ct();be();ar=null;lr=null});var Xe={};ft(Xe,{clearCache:()=>jl,hydrateOptional:()=>Jt,validateToken:()=>Yl});function Dl(){try{return new Map(JSON.parse(localStorage.getItem("tmdbCache")||"[]"))}catch{return new Map}}function zl(){try{localStorage.setItem("tmdbCache",JSON.stringify(Array.from(Me.entries())))}catch{}}function jl(){try{localStorage.removeItem("tmdbCache")}catch{}Me=new Map}function Kl(e){try{let t=localStorage.getItem("tmdbToken");if(t)return{kind:"bearer",value:t}}catch{}return e!=null&&e.tmdbApiKey?{kind:"apikey",value:String(e.tmdbApiKey)}:{kind:"none",value:""}}function Gl(e){var s,a;let t=e.type==="tv"?"tv":"movie",n=((s=e==null?void 0:e.ids)==null?void 0:s.imdb)||"",r=((a=e==null?void 0:e.ids)==null?void 0:a.tmdb)||"",o=(e.title||"").toLowerCase(),i=String(e.year||"").slice(0,4);return[t,n,r,o,i].filter(Boolean).join("|")}function pr(e,t){if(!t||t.kind==="none")return{url:e,init:{}};if(t.kind==="bearer")return{url:e,init:{headers:{Authorization:`Bearer ${t.value}`,Accept:"application/json"}}};let n=e.includes("?")?"&":"?";return{url:`${e}${n}api_key=${encodeURIComponent(t.value)}`,init:{headers:{Accept:"application/json"}}}}async function Xt(e,t){let{url:n,init:r}=pr(e,t),o=await fetch(n,r);if(!o.ok)throw new Error("HTTP "+o.status);return o.json()}function Ul(e){return e!=null&&e.file_path?Yt+bi+e.file_path:""}function ql(e){return e!=null&&e.file_path?Yt+yi+e.file_path:""}async function br(e,t,n,r){let o=await Xt(`${Ye}/${e}/${t}?language=${encodeURIComponent(n||"de-DE")}`,r),i=await Xt(`${Ye}/${e}/${t}/images`,r).catch(l=>({posters:[],backdrops:[]})),s=Ul((i.posters||[])[0])||(o.poster_path?Yt+bi+o.poster_path:""),a=ql((i.backdrops||[])[0])||(o.backdrop_path?Yt+yi+o.backdrop_path:"");return{id:o.id,poster:s,backdrop:a,url:`https://www.themoviedb.org/${e}/${o.id}`}}async function Vl(e,t,n,r,o){let i=encodeURIComponent(t||""),s=n?`&year=${encodeURIComponent(String(n))}`:"",l=((await Xt(`${Ye}/search/${e}?query=${i}${s}&language=${encodeURIComponent(r||"de-DE")}`,o)).results||[])[0];if(!l)throw new Error("not found");return br(e,l.id,r,o)}async function Wl(e,t,n){var s,a;let r=e.type==="tv"?"tv":"movie",o=Gl(e);if(Me.has(o))return Me.get(o);let i;try{if((s=e==null?void 0:e.ids)!=null&&s.tmdb)i=await br(r,e.ids.tmdb,t.lang,n);else if((a=e==null?void 0:e.ids)!=null&&a.imdb){let u=await Xt(`${Ye}/find/${e.ids.imdb}?external_source=imdb_id&language=${encodeURIComponent(t.lang||"de-DE")}`,n),c=r==="movie"?(u.movie_results||[])[0]:(u.tv_results||[])[0];if(c)i=await br(r,c.id,t.lang,n);else throw new Error("not found")}else i=await Vl(r,e.title,e.year,t.lang,n)}catch{i=null}return Me.set(o,i),zl(),i}async function Jt(e,t,n={}){try{Me=Me||Dl();let r=Kl(n);if(!r.value)return;let o=(e||[]).concat(t||[]),i=0,s=40,a=async()=>{let l=o.slice(i,i+4);i+=4,await Promise.all(l.map(async u=>{let c=await Wl(u,n,r);c&&(u.tmdb={id:c.id,poster:c.poster,backdrop:c.backdrop,url:c.url},u.ids=u.ids||{},!u.ids.tmdb&&c.id&&(u.ids.tmdb=String(c.id)))}));try{window.dispatchEvent(new CustomEvent("tmdb:chunk",{detail:{updated:l.length,index:i}}))}catch{}if(i<Math.min(o.length,s))window.requestIdleCallback?window.requestIdleCallback(a,{timeout:500}):setTimeout(a,250);else try{window.dispatchEvent(new CustomEvent("tmdb:done",{detail:{total:Math.min(o.length,s)}}))}catch{}};a()}catch{}}async function Yl(e){let t=String(e||"").trim();if(!t)throw new Error("empty");let n=/^[a-f0-9]{32}$/i.test(t),r=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(t),o=i=>{try{let s=i.split(".")[1],l=atob((u=>u+"=".repeat((4-u.length%4)%4))(s.replace(/-/g,"+").replace(/_/g,"/")));return JSON.parse(l)}catch{return null}};if(n){let{url:i,init:s}=pr(`${Ye}/configuration`,{kind:"apikey",value:t});return(await fetch(i,s)).ok?{ok:!0,as:"apikey",hint:"v3Key"}:{ok:!1,as:"apikey",hint:"looksV3"}}if(r){let i=o(t);if(i&&typeof i=="object"){let l=String(i.iss||"");if(l&&!/themoviedb\.org/i.test(l))return{ok:!1,as:"bearer",hint:"issMismatch"}}let{url:s,init:a}=pr(`${Ye}/trending/movie/day`,{kind:"bearer",value:t});try{if((await fetch(s,a)).ok)return{ok:!0,as:"bearer",hint:null}}catch{}return{ok:!0,as:"bearer",hint:"structOnly"}}return{ok:!1,as:"bearer",hint:null}}var Ye,Yt,bi,yi,Me,Fe=x(()=>{Ye="https://api.themoviedb.org/3",Yt="https://image.tmdb.org/t/p/",bi="w342",yi="w780"});async function Ai(){Je=[];let e=null,t=null;try{let n=await fetch(Xl,{cache:"no-cache"});if(!n.ok)throw new Error(`HTTP ${n.status}`);e=await Ql(n)}catch(n){t=n,Le(`Failed to load policy (${(n==null?void 0:n.message)||"unknown error"})`),V("Hero-Policy konnte nicht geladen werden",(n==null?void 0:n.message)||"Unbekannter Fehler")}return Y=Jl(e),Si=Date.now(),ec(t),Y}function Ze(){return yr(Y)}function wi(){return{movies:Y.poolSizeMovies,series:Y.poolSizeSeries}}function Ii(){let e={};return Ei.forEach(t=>{e[t]={quota:Y.slots[t].quota}}),e}function Ti(){return{...Y.diversity}}function ki(){return{...Y.rotation}}function Ci(){return{...Y.textClamp}}function xi(){return{...Y.fallback}}function Mi(){return Y.language}function bt(){let e=Number(Y.cache.ttlHours),t=Number(Y.cache.graceMinutes);return{ttlHours:e,ttlMs:e*60*60*1e3,graceMinutes:t,graceMs:t*60*1e3}}function Qt(){return Je.slice()}function Fi(){return Si}function Jl(e){let t=yr(vi);if(!e||typeof e!="object")return Le("Policy payload missing or invalid, using defaults."),t;t.poolSizeMovies=ce(e.poolSizeMovies,t.poolSizeMovies,"poolSizeMovies"),t.poolSizeSeries=ce(e.poolSizeSeries,t.poolSizeSeries,"poolSizeSeries");let n=e.slots&&typeof e.slots=="object"?e.slots:{};Ei.forEach(c=>{let d=n[c],m=Zt(d==null?void 0:d.quota,0,1,t.slots[c].quota,`slots.${c}.quota`);t.slots[c]={quota:m}});let r=e.diversity&&typeof e.diversity=="object"?e.diversity:{};t.diversity={genre:Zt(r.genre,0,1,t.diversity.genre,"diversity.genre"),year:Zt(r.year,0,1,t.diversity.year,"diversity.year"),antiRepeat:Zt(r.antiRepeat,0,1,t.diversity.antiRepeat,"diversity.antiRepeat")};let o=e.rotation&&typeof e.rotation=="object"?e.rotation:{};t.rotation={intervalMinutes:ce(o.intervalMinutes,t.rotation.intervalMinutes,"rotation.intervalMinutes"),minPoolSize:ce(o.minPoolSize,t.rotation.minPoolSize,"rotation.minPoolSize")};let i=e.textClamp&&typeof e.textClamp=="object"?e.textClamp:{};t.textClamp={title:ce(i.title,t.textClamp.title,"textClamp.title"),subtitle:ce(i.subtitle,t.textClamp.subtitle,"textClamp.subtitle"),summary:ce(i.summary,t.textClamp.summary,"textClamp.summary")};let s=e.fallback&&typeof e.fallback=="object"?e.fallback:{};t.fallback={prefer:Zl(s.prefer,t.fallback.prefer),allowDuplicates:typeof s.allowDuplicates=="boolean"?s.allowDuplicates:t.fallback.allowDuplicates},t.language=typeof e.language=="string"&&e.language.trim()?e.language.trim():t.language,t.language!==(e.language||"").trim()&&Le("language missing or invalid, defaulted to en-US.");let a=e.cache&&typeof e.cache=="object"?e.cache:{},l=ce(a.ttlHours,t.cache.ttlHours,"cache.ttlHours"),u=ce(a.graceMinutes,t.cache.graceMinutes,"cache.graceMinutes",!0);return t.cache={ttlHours:l,graceMinutes:u},t}function ce(e,t,n,r){let o=Number(e);return Number.isFinite(o)&&(r?o>=0:o>0)?Math.floor(o):(e!=null&&Le(`${n} invalid (${e}), using default (${t}).`),t)}function Zt(e,t,n,r,o){let i=Number(e);return Number.isFinite(i)&&i>=t&&i<=n?i:(e!=null&&Le(`${o} invalid (${e}), using default (${r}).`),r)}function Zl(e,t){return e==="movies"||e==="series"||e==="shows"?e==="shows"?"series":e:(e!=null&&Le(`fallback.prefer invalid (${e}), using default (${t}).`),t)}function yr(e){return JSON.parse(JSON.stringify(e))}async function Ql(e){try{return await e.json()}catch(t){return Le(`Failed to parse hero policy JSON (${(t==null?void 0:t.message)||t}).`),null}}function Le(e){e&&Je.push(e)}function ec(e){if(Je.length){if(e){let t=Je.slice(1);t.length&&V("Hero-Policy Hinweise",t.join(" \u2022 "));return}V("Hero-Policy Hinweise",Je.join(" \u2022 "))}}var Xl,vi,Ei,Y,Si,Je,en=x(()=>{_t();Xl="hero.policy.json",vi=Object.freeze({poolSizeMovies:10,poolSizeSeries:10,slots:{new:{quota:.3},topRated:{quota:.3},oldButGold:{quota:.2},random:{quota:.2}},diversity:{genre:.4,year:.35,antiRepeat:.25},rotation:{intervalMinutes:360,minPoolSize:6},textClamp:{title:96,subtitle:240,summary:220},fallback:{prefer:"movies",allowDuplicates:!1},language:"en-US",cache:{ttlHours:24,graceMinutes:15}}),Ei=["new","topRated","oldButGold","random"],Y=yr(vi),Si=0,Je=[]});function X(...e){try{}catch{}}function Q(){return Date.now()}function nn(e){return new Promise(t=>setTimeout(t,Math.max(0,e||0)))}function rc(e,t){if(e===t)return!0;if(!e||!t)return!1;let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let o of n)if(e[o]!==t[o])return!1;return!0}function on(){var e;return{active:!!R.active,until:Number(R.until)||0,retryAfterMs:Number(R.retryAfterMs)||0,lastStatus:(e=R.lastStatus)!=null?e:null,lastHitAt:Number(R.lastHitAt)||0,strikes:Number(R.strikes)||0}}function oc(){let e=on();for(let t of Sr)try{t(e)}catch(n){X("Rate limit listener failed:",(n==null?void 0:n.message)||n)}}function rn(e){let t={...on(),...e};return rc(R,t)||(R=t,oc()),R}function Hi(e){return Math.min(8e3,400*Math.pow(2,Math.max(0,e)))}function ic(e,t){let n=1200*Math.pow(2,Math.max(0,e-1)),r=Math.max(t||0,n);return Math.min(6e4,r)}function sc(e,t=429){let n=Q(),r=Math.min(5,(R.strikes||0)+1),o=ic(r,e);return Qe=Math.max(Qe,n+o),rn({active:!0,strikes:r,retryAfterMs:o,until:n+o,lastStatus:t,lastHitAt:n}),o}function ac(){if(!R.strikes)return;let e=Math.max(0,R.strikes-1);rn({strikes:e,active:R.active&&R.until>Q()})}function Di(){let e=Q();R.active&&e>=R.until?rn({active:!1,retryAfterMs:0,until:0}):!R.active&&R.strikes>0&&e-R.lastHitAt>9e4&&rn({strikes:Math.max(0,R.strikes-1)}),Qe&&e>=Qe&&(Qe=0)}function lc(e,t,n){let r=e==="tv"?"tv":"movie",o=String(n||"en-US").trim()||"en-US";return`${r}:${String(t||"").trim()}:${o}`}function zi(){if(_i||(_i=!0,typeof localStorage=="undefined"))return;let e;try{if(e=localStorage.getItem(Oi),!e)return}catch(r){X("Failed to read TMDB cache from storage:",(r==null?void 0:r.message)||r);return}let t;try{t=JSON.parse(e)}catch(r){X("Stored TMDB cache invalid JSON:",(r==null?void 0:r.message)||r);return}if(!Array.isArray(t))return;let n=Q();t.forEach(([r,o])=>{var s,a,l,u;if(!r||!o)return;let i=Number((a=(s=o.ts)!=null?s:o.timestamp)!=null?a:o.fetchedAt);Number.isFinite(i)&&(n-i>864e5||ne.set(String(r),{ts:i,data:(u=(l=o.data)!=null?l:o.payload)!=null?u:null}))})}function cc(){let e=Q(),t=!1;for(let[n,r]of ne.entries()){if(!r||typeof r!="object"){ne.delete(n),t=!0;continue}let o=Number(r.ts);(!Number.isFinite(o)||e-o>864e5)&&(ne.delete(n),t=!0)}t&&wr()}function Ri(e){zi();let t=ne.get(e);if(!t)return null;let n=Number(t.ts);return!Number.isFinite(n)||Q()-n>864e5?(ne.delete(e),wr(),null):t}function uc(e,t){zi(),ne.set(e,{ts:Q(),data:t}),dc(),wr()}function dc(){if(ne.size<=60)return;let e=Array.from(ne.entries());e.sort((n,r)=>{var s,a;let o=Number(((s=n[1])==null?void 0:s.ts)||0);return Number(((a=r[1])==null?void 0:a.ts)||0)-o});let t=e.slice(0,60);ne=new Map(t)}function wr(){typeof localStorage!="undefined"&&(vr||(vr=setTimeout(()=>{vr=null,fc()},120)))}function fc(){if(typeof localStorage=="undefined")return;let e=Array.from(ne.entries()).map(([t,n])=>{var r,o;return[t,{ts:(r=n==null?void 0:n.ts)!=null?r:Q(),data:(o=n==null?void 0:n.data)!=null?o:null}]});try{localStorage.setItem(Oi,JSON.stringify(e))}catch(t){X("Failed to persist TMDB cache:",(t==null?void 0:t.message)||t)}}function hc(e){if(!e)return 0;let t=Number(e);if(Number.isFinite(t))return Math.max(0,t*1e3);let n=Date.parse(e);return Number.isFinite(n)?Math.max(0,n-Q()):0}function gc(e){return e===429||e>=500&&e<600}function mc(e){return e&&(e.name==="AbortError"||e.code==="ABORT_ERR")}function pc(e){return mc(e)?!1:!!(e&&typeof e=="object"&&(e.name==="TypeError"&&/network/i.test(e.message||"")||/network/i.test((e==null?void 0:e.message)||"")))}function bc(e,t){if(!t||!t.value)return{url:e,init:{headers:{Accept:"application/json"}}};if(t.kind==="apikey"){let n=e.includes("?")?"&":"?";return{url:`${e}${n}api_key=${encodeURIComponent(t.value)}`,init:{headers:{Accept:"application/json"}}}}return{url:e,init:{headers:{Accept:"application/json",Authorization:`Bearer ${t.value}`}}}}async function yc(){Di();let e=Q(),t=Math.max(0,Pi+400-e),n=Math.max(0,Qe-e),r=Math.max(t,n);r>0&&await nn(r),Pi=Q()}async function et(e,t,{signal:n}={},r=0){let{url:o,init:i}=bc(e,t),s={...i,signal:n};await yc();let a;try{a=await fetch(o,s)}catch(l){if(r<4&&pc(l)){let u=Hi(r);return await nn(u),et(e,t,{signal:n},r+1)}throw l}if(!a.ok){let l=a.status,u=gc(l)&&r<4;if(l===429){let m=hc(a.headers.get("retry-after")),h=sc(m,l);if(u)return await nn(h),et(e,t,{signal:n},r+1)}else if(u){let m=Hi(r);return await nn(m),et(e,t,{signal:n},r+1)}let c=await a.text().catch(()=>""),d=new Error(`HTTP ${l}${c?`: ${c}`:""}`);throw d.status=l,l===429&&(d.code="RATE_LIMIT"),d}return ac(),Di(),a.json()}function ue(e,t){if(!e&&e!==0)return null;let n=String(e||"").trim();return n?{kind:t||(/^[a-f0-9]{32}$/i.test(n)?"apikey":"bearer"),value:n}:null}function vc(){if(typeof localStorage=="undefined")return"";try{return localStorage.getItem("tmdbToken")||""}catch(e){return X("Failed to read tmdbToken from storage:",(e==null?void 0:e.message)||e),""}}function Ec(e){if(!e)return{};let t=e.trim();if(!t)return{};if(t.startsWith("{")||t.startsWith("["))try{let r=JSON.parse(t);if(r&&typeof r=="object")return r}catch(r){X("Failed to parse config.cfg JSON:",(r==null?void 0:r.message)||r)}let n={};return t.split(/\r?\n/).forEach(r=>{let o=r.trim();if(!o||o.startsWith("#")||o.startsWith(";"))return;let i=o.indexOf("=");if(i===-1)return;let s=o.slice(0,i).trim(),a=o.slice(i+1).trim();s&&(n[s]=a)}),n}async function Sc(){return tn||(tn=(async()=>{if(typeof fetch!="function")return{};try{let e=await fetch("config.cfg",{cache:"no-cache"});if(!e.ok)return e.status!==404&&X(`Failed to load config.cfg (HTTP ${e.status})`),{};let t=await e.text();return Er=Ec(t),Er}catch(e){return X("Error loading config.cfg:",(e==null?void 0:e.message)||e),{}}})(),tn)}function Ac(e){if(!e||typeof e!="object")return null;if(e.tmdbToken){let t=ue(e.tmdbToken,"bearer");if(t)return{...t,source:"settings.tmdbToken"}}if(e.tmdbApiKey){let t=ue(e.tmdbApiKey,"apikey");if(t)return{...t,source:"settings.tmdbApiKey"}}return null}function wc(){let e=ue(vc(),"bearer");return e?{...e,source:"localStorage.tmdbToken"}:null}function Ic(e){if(!e||typeof e!="object")return null;if(e.tmdbToken){let t=ue(e.tmdbToken,"bearer");if(t)return{...t,source:"config.cfg.tmdbToken"}}if(e.tmdbApiKey){let t=ue(e.tmdbApiKey,"apikey");if(t)return{...t,source:"config.cfg.tmdbApiKey"}}return null}async function ji(e={},t={}){if(t.credentials){if(typeof t.credentials=="string"||typeof t.credentials=="number"){let s=ue(t.credentials);if(s)return{...s,source:"explicit"}}else if(t.credentials&&typeof t.credentials=="object"&&t.credentials.value){let s=ue(t.credentials.value,t.credentials.kind);if(s)return{...s,source:t.credentials.source||"explicit"}}}let n=Ac(e);if(n)return n;let r=wc();if(r)return r;if(e&&e.tmdbApiKey){let s=ue(e.tmdbApiKey,"apikey");if(s)return{...s,source:"settings.tmdbApiKey"}}let o=await Sc().catch(()=>Er||{}),i=Ic(o);if(i)return i;if(t.fallbackCredential){let s=ue(t.fallbackCredential);if(s)return{...s,source:"fallback"}}return null}function Ki(){return on()}function Gi(e){if(typeof e!="function")return()=>{};Sr.add(e);try{e(on())}catch(t){X("Rate limit listener threw during init:",(t==null?void 0:t.message)||t)}return()=>Sr.delete(e)}function Ui(e,t="original"){let r=(typeof e=="string"?e:"").trim();if(!r)return"";let o=r.startsWith("/")?r:`/${r}`,i=String(t||"original").trim()||"original";return`${tc}${i}${o}`}function tt(e){return e==null?"":String(e).trim()}async function Ir(e,t,n={}){let r=e==="tv"?"tv":"movie",o=tt(t);if(!o)return null;let i=tt(n.language)||"en-US",s=lc(r,o,i);if(!n.forceRefresh){let d=Ri(s);if(d)return{id:o,type:r,language:i,data:d.data,fetchedAt:d.ts,source:"cache"}}let a=n.auth||await ji(n.settings,n.authOptions||{});if(!a)return X("TMDB credentials missing; cannot fetch details."),null;let l=`${Ar}/${r}/${encodeURIComponent(o)}?language=${encodeURIComponent(i)}&append_to_response=${nc}`,u;try{u=await et(l,a,{signal:n.signal})}catch(d){throw X(`Failed to fetch TMDB ${r}#${o}:`,(d==null?void 0:d.message)||d),d}uc(s,u);let c=Ri(s);return{id:o,type:r,language:i,data:u,fetchedAt:(c==null?void 0:c.ts)||Q(),source:"network"}}function Tc(e){if(!e||typeof e!="object")return"";let t=[e.title,e.name,e.originalTitle,e.original_name,e.original_title];for(let n of t){let r=typeof n=="string"?n.trim():"";if(r)return r}return""}function Ni(e){if(e==null)return null;let t=Number(e);if(Number.isFinite(t)&&t>1800)return Math.trunc(t);if(typeof e=="string"){let n=e.match(/(19|20|21)\d{2}/);if(n)return Number(n[0])}return null}function kc(e){var o;if(!e||typeof e!="object")return null;let t=Ni((o=e.year)!=null?o:e.startYear);if(t)return t;let n=e.originallyAvailableAt||e.premieredAt||e.releaseDate||e.firstAirDate,r=Ni(n);return r||null}async function Cc(e,t,n){let r=n.language||"en-US",o=`${Ar}/find/${encodeURIComponent(t)}?external_source=imdb_id&language=${encodeURIComponent(r)}`,i=await et(o,n.auth,{signal:n.signal}),s=e==="tv"?"tv_results":"movie_results",l=(Array.isArray(i==null?void 0:i[s])?i[s]:[]).find(d=>d&&d.id!=null);if(!l||l.id==null)return null;let u=String(l.id),c=await Ir(e,u,n);return c&&(c.id=u,c.resolvedId=u),c}function xc(e,t,n,r){let o=encodeURIComponent(t),i=encodeURIComponent(n||"en-US"),s=`${Ar}/search/${e}?query=${o}&language=${i}`;return r?`${s}&${e==="tv"?"first_air_date_year":"year"}=${encodeURIComponent(String(r))}`:s}async function Mc(e,t,n,r){if(!t)return null;let o=r.language||"en-US",i=xc(e,t,o,n),s=await et(i,r.auth,{signal:r.signal}),a=Array.isArray(s==null?void 0:s.results)?s.results:[];if(!a.length)return null;let l=a.find(d=>d&&d.id!=null)||a[0];if(!l||l.id==null)return null;let u=String(l.id),c=await Ir(e,u,r);return c&&(c.id=u,c.resolvedId=u),c}function Fc(e){let t={tmdb:"",imdb:""};if(!e||typeof e!="object")return t;let n=r=>{let o=typeof r=="string"?r:r==null?void 0:r.id;if(!o)return;let i=String(o).trim();if(!i)return;let[s,a]=i.split("://");if(!a){i.startsWith("tt")&&(t.imdb=i);return}let l=s.toLowerCase(),c=a.split("?")[0].replace(/^\//,"").split("/").pop();if(l==="imdb"||l.includes("imdb")){t.imdb=c||t.imdb;return}if(l==="tmdb"||l.includes("themoviedb")){t.tmdb=c||t.tmdb;return}};return e.ids&&typeof e.ids=="object"&&(e.ids.tmdb&&(t.tmdb=tt(e.ids.tmdb)),e.ids.imdb&&(t.imdb=tt(e.ids.imdb))),n(e.guid),Array.isArray(e.guids)&&e.guids.forEach(n),t}function Lc(e,t){let n=tt(t==null?void 0:t.searchTitle);return n||Tc(e)}async function qi(e,t={}){var u;if(!e||typeof e!="object")return null;let n=e.type==="tv"?"tv":"movie",r=tt(t.language)||"en-US",o=t.auth||await ji(t.settings,t.authOptions||{});if(!o)return X("Skipping TMDB lookup (missing credentials)."),null;let i={...t,auth:o,language:r},s=Fc(e),a=[];s.tmdb&&a.push({label:"direct id",fn:()=>Ir(n,s.tmdb,i)}),s.imdb&&a.push({label:"imdb find",fn:()=>Cc(n,s.imdb,i)});let l=Lc(e,t);if(l){let c=(u=t.searchYear)!=null?u:kc(e);a.push({label:"search",fn:()=>Mc(n,l,c,i)})}for(let c of a)try{let d=await c.fn();if(d)return!d.resolvedId&&d.id&&(d.resolvedId=d.id),d}catch(d){X(`TMDB ${c.label} lookup failed:`,(d==null?void 0:d.message)||d)}return null}var Ar,tc,nc,Oi,ne,_i,vr,Pi,tn,Er,Qe,R,Sr,$i,Bi,Tr=x(()=>{Ar="https://api.themoviedb.org/3",tc="https://image.tmdb.org/t/p/",nc="images,release_dates,content_ratings,credits",Oi="hero.tmdbCache.v1",ne=new Map,_i=!1,vr=null,Pi=0,tn=null,Er={},Qe=0,R={active:!1,until:0,retryAfterMs:0,lastStatus:null,lastHitAt:0,strikes:0},Sr=new Set;(Bi=($i=setInterval(()=>{try{cc()}catch{}},864e5/6)).unref)==null||Bi.call($i)});function Vi(...e){try{}catch{}}function sn(e){return typeof e!="string"?"":e.trim()}function j(e){let t=sn(e);return t||""}function kr(e){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e)&&e>1800&&e<9999)return Math.trunc(e);if(typeof e=="string"){let t=e.match(/(19|20|21)\d{2}/);if(t)return Number(t[0])}return null}function Cr(e){if(!e)return null;try{let t=new Date(e);if(Number.isNaN(t.getTime()))return null;let n=t.getUTCFullYear();return n>1800&&n<9999?n:null}catch{return null}}function Wi(e){let t=Number(e);return!Number.isFinite(t)||t<=0?null:Math.round(t*10)/10}function nt(e){if(e==null)return null;let t=Number(e);return Number.isFinite(t)&&t>0?t>1e3?Math.max(1,Math.round(t/6e4)):Math.round(t):null}function Hc(e,t){let n=[];if(t&&Array.isArray(t.genres)){for(let s of t.genres)if(s&&typeof s=="object"&&s.name){let a=sn(s.name);a&&n.push(a)}}let r=e==null?void 0:e.genres;Array.isArray(r)&&r.forEach(s=>{if(!s)return;if(typeof s=="string"){let l=sn(s);l&&n.push(l);return}let a=sn(s.tag||s.title||s.label||s.name);a&&n.push(a)});let o=new Set,i=[];for(let s of n){let a=s.toLowerCase();o.has(a)||(o.add(a),i.push(s))}return i.slice(0,2)}function Rc(e){let t={},n=(r,o)=>{if(o==null)return;let i=typeof o=="string"?o:String(o),s=j(i);s&&(t[r]=s)};if(e&&typeof e=="object"){e.ratingKey!=null&&n("ratingKey",e.ratingKey),e.ids&&typeof e.ids=="object"&&(n("tmdb",e.ids.tmdb),n("imdb",e.ids.imdb));let r=o=>{let i=typeof o=="string"?o:o==null?void 0:o.id,s=j(i);if(!s)return;let[a,l]=s.split("://");if(l){let u=a.toLowerCase(),d=l.split("?")[0].replace(/^\//,"").split("/").pop();if(u==="imdb"||u.includes("imdb")){n("imdb",d);return}if(u==="tmdb"||u.includes("themoviedb")){n("tmdb",d);return}if(u==="tvdb"||u.includes("thetvdb")){n("tvdb",d);return}}else s.startsWith("tt")&&n("imdb",s)};r(e.guid),Array.isArray(e.guids)&&e.guids.forEach(r)}return t}function Nc(e,t,n){if(t)if(n==="tv"){let r=[t.name,t.original_name];for(let o of r){let i=j(o);if(i)return i}}else{let r=[t.title,t.original_title];for(let o of r){let i=j(o);if(i)return i}}if(e){let r=[e.title,e.name,e.originalTitle];for(let o of r){let i=j(o);if(i)return i}}return""}function $c(e,t){let n=[t==null?void 0:t.tagline,e==null?void 0:e.tagline];for(let r of n){let o=j(r);if(o)return o}return""}function Bc(e,t){let n=[t==null?void 0:t.overview,e==null?void 0:e.summary,e==null?void 0:e.plot,e==null?void 0:e.description];for(let r of n){let o=j(r);if(o)return o}return""}function Oc(e,t,n){var o,i,s;if(t){let a=n==="tv"?t.first_air_date:t.release_date,l=(o=kr(a))!=null?o:Cr(a);if(l)return l;let u=n==="tv"?t.last_air_date:t.release_date,c=(i=kr(u))!=null?i:Cr(u);if(c)return c}let r=(s=kr(e==null?void 0:e.year))!=null?s:Cr(e==null?void 0:e.originallyAvailableAt);return r||null}function Dc(e,t,n){var r,o,i;if(t){if(n==="tv"&&Array.isArray(t.episode_run_time)&&t.episode_run_time.length){let s=nt(t.episode_run_time.find(a=>nt(a)));if(s)return s}if(n==="movie"){let s=nt(t.runtime);if(s)return s}}if(n==="movie"){let s=nt((r=e==null?void 0:e.durationMin)!=null?r:e==null?void 0:e.duration);if(s)return s}else if(n==="tv"){if(Array.isArray(e==null?void 0:e.seasons)){for(let a of e.seasons)if(Array.isArray(a==null?void 0:a.episodes))for(let l of a.episodes){let u=nt((o=l==null?void 0:l.durationMin)!=null?o:l==null?void 0:l.duration);if(u)return u}}let s=nt((i=e==null?void 0:e.durationMin)!=null?i:e==null?void 0:e.duration);if(s)return s}return null}function zc(e,t){var o;let n=Wi(t==null?void 0:t.vote_average);if(n)return n;let r=Wi((o=e==null?void 0:e.rating)!=null?o:e==null?void 0:e.audienceRating);return r||null}function jc(e){let t=Number(e==null?void 0:e.vote_count);return Number.isFinite(t)&&t>0?Math.round(t):null}function Kc(e,t,n){var o,i,s;if(n==="movie"&&((o=t==null?void 0:t.release_dates)!=null&&o.results)){let l=(Array.isArray(t.release_dates.results)?t.release_dates.results:[]).find(d=>d&&d.iso_3166_1==="US"),c=(Array.isArray(l==null?void 0:l.release_dates)?l.release_dates:[]).filter(d=>j(d==null?void 0:d.certification)).sort((d,m)=>{var p,f;let h=Number((p=d==null?void 0:d.type)!=null?p:0),g=Number((f=m==null?void 0:m.type)!=null?f:0);return h-g});if(c.length){let d=j(((i=c.find(m=>m.type===3))==null?void 0:i.certification)||c[0].certification);if(d)return d}}if(n==="tv"&&Array.isArray((s=t==null?void 0:t.content_ratings)==null?void 0:s.results)){let a=t.content_ratings.results.find(u=>u&&u.iso_3166_1==="US"),l=j(a==null?void 0:a.rating);if(l)return l}let r=j(e==null?void 0:e.contentRating);if(r){let a=r.split("/").pop(),l=j(a);if(l)return l}return""}function Gc(e){var r;let t=Array.isArray((r=e==null?void 0:e.images)==null?void 0:r.backdrops)?e.images.backdrops:[],n=[];for(let o of t){if(!o||!o.file_path||o.width&&o.width<_c)continue;let i=Ui(o.file_path,Pc);i&&(n.includes(i)||n.push(i))}return n}function Uc(e,t){let n={seasons:null,episodes:null};if(Number.isFinite(t==null?void 0:t.number_of_seasons)&&(n.seasons=Math.max(0,Math.round(t.number_of_seasons))),Number.isFinite(t==null?void 0:t.number_of_episodes)&&(n.episodes=Math.max(0,Math.round(t.number_of_episodes))),n.seasons==null&&Array.isArray(e==null?void 0:e.seasons)&&(n.seasons=e.seasons.length),n.episodes==null&&Array.isArray(e==null?void 0:e.seasons)){let r=0;e.seasons.forEach(o=>{Array.isArray(o==null?void 0:o.episodes)&&(r+=o.episodes.length)}),r>0&&(n.episodes=r)}return n}function qc(e,t){if(!t||typeof t!="object")return null;let n=t.tmdb||t.imdb||t.ratingKey,r=j(n);if(!r)return null;let o=e==="tv"?"show":"movie";return{id:r,kind:o,label:o==="show"?"Show details":"Movie details",target:`#/${o}/${r}`}}function Vc(e){let t={};return Object.entries(e||{}).forEach(([n,r])=>{let o=j(r);o&&(t[n]=o)}),t}function Wc(e,t){return e.ratingKey?e.ratingKey:e.tmdb?`${t}-${e.tmdb}`:e.imdb?`${t}-${e.imdb}`:""}async function Yi(e,t={}){var C,M;if(!e||typeof e!="object")return null;let n=e.type==="tv"?"tv":"movie",r=j(t.language)||"en-US",o=Rc(e),i=null;if(t.disableTmdb!==!0)try{i=await qi(e,{language:r,settings:t.settings,auth:t.auth,authOptions:t.authOptions,signal:t.signal,searchTitle:t.searchTitle,searchYear:t.searchYear})}catch(A){Vi("TMDB lookup failed:",(A==null?void 0:A.message)||A)}let s=i==null?void 0:i.data;i!=null&&i.resolvedId&&(o.tmdb||(o.tmdb=String(i.resolvedId))),s!=null&&s.id&&!o.tmdb&&(o.tmdb=String(s.id)),s!=null&&s.imdb_id&&!o.imdb&&(o.imdb=String(s.imdb_id).trim()),o=Vc(o);let a=Nc(e,s,n);if(!a)return Vi("Skipping item without title",(e==null?void 0:e.ratingKey)||(e==null?void 0:e.title)||(e==null?void 0:e.guid)||"unknown"),null;let l={id:Wc(o,n)||String((M=(C=e.ratingKey)!=null?C:e.guid)!=null?M:a),type:n,title:a},u=$c(e,s);u&&(l.tagline=u);let c=Bc(e,s);c&&(l.overview=c);let d=Oc(e,s,n);d&&(l.year=d);let m=Dc(e,s,n);m&&(l.runtime=m);let h=zc(e,s);h!=null&&(l.rating=h);let g=jc(s);g!=null&&(l.voteCount=g);let p=Hc(e,s);p.length&&(l.genres=p);let f=Kc(e,s,n);f&&(l.certification=f);let y=Gc(s);if(y.length&&(l.backdrops=y),n==="tv"){let A=Uc(e,s);A.seasons!=null&&(l.seasons=A.seasons),A.episodes!=null&&(l.episodes=A.episodes)}let T=qc(n,o);if(T&&(l.cta=T),Object.keys(o).length&&(l.ids=o),l.language=r,i){let A={id:o.tmdb||(i.id?String(i.id):""),fetchedAt:i.fetchedAt||Date.now(),source:i.source};A.id||delete A.id,A.source||delete A.source,t.includeTmdbRaw&&s&&(A.raw=s),Object.keys(A).length&&(l.tmdb=A)}return t.includeSource&&(l.source=e),l}var _c,Pc,Xi=x(()=>{Tr();_c=1920,Pc="original"});function Ee(){return Date.now()}function Ji(e){try{if(typeof globalThis!="undefined"&&globalThis[e])return globalThis[e]}catch{}return null}function Qc(e,t){if(!e)return null;try{return e.getItem(t)}catch{return null}}function K(e,t,n){if(e)try{n==null?e.removeItem(t):e.setItem(t,n)}catch{}}function eu(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function an(e){try{return JSON.stringify(e)}catch{return null}}function vt(e){return e==="shows"||e==="show"||e==="series"?"series":"movies"}function ln(e){return`${Yc}${vt(e)}`}function xr(e){return`${ln(e)}${rt}`}function Zi(e){return`${Xc}${vt(e)}`}function Mr(e){return`${Jc}${vt(e)}`}function Fr(e){return`${Zc}${vt(e)}`}function yt(e,t){let n=Qc(e,t);if(!n)return null;let r=eu(n);return!r||typeof r!="object"?null:r}function Qi(e){let{local:t}=re(),n=Mr(e),r=yt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:0),slot:typeof(o==null?void 0:o.slot)=="string"?o.slot:(o==null?void 0:o.slot)!=null?String(o.slot):void 0}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function tu(e,t){let n=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts,slot:a.slot})):[],r=an(n);if(r==null)return;let{local:o,session:i}=re(),s=Mr(e);K(o,s,r),K(i,`${s}${rt}`,r)}function Lr(e){let{local:t}=re(),n=Fr(e),r=yt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:0),reason:typeof(o==null?void 0:o.reason)=="string"?o.reason:"",hits:Number(o==null?void 0:o.hits)||0}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function es(e,t){let n=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts,reason:a.reason||"",hits:Number(a.hits)||0})):[],r=an(n);if(r==null)return;let{local:o,session:i}=re(),s=Fr(e);K(o,s,r),K(i,`${s}${rt}`,r)}function re(){return{local:Ji("localStorage"),session:Ji("sessionStorage")}}function ts(e){if(!e||typeof e!="object")return null;let t={kind:vt(e.kind||e.library||e.type),items:Array.isArray(e.items)?e.items.slice():[],updatedAt:Number(e.updatedAt)||Ee(),expiresAt:Number(e.expiresAt)||0,policyHash:typeof e.policyHash=="string"?e.policyHash:"",slotSummary:e.slotSummary&&typeof e.slotSummary=="object"?{...e.slotSummary}:{},meta:e.meta&&typeof e.meta=="object"?{...e.meta}:void 0};return e.generatedAt&&!t.updatedAt&&(t.updatedAt=Number(e.generatedAt)||t.updatedAt),t}function ot(e,{now:t=Ee(),policyHash:n=null,allowExpired:r=!1}={}){let{local:o,session:i}=re(),s=ln(e),a=xr(e),l=yt(i,a),u=yt(o,s),c=l||u||null;if(!c)return null;let d=ts(c);if(!d)return null;let h=(Number(d.expiresAt)||0)>t,g=n?d.policyHash===n:!0;return!r&&!h||n&&!g?null:(d.isExpired=!h,d.matchesPolicy=g,d.source=l?"session":"local",d)}function ns(e,t){let{local:n,session:r}=re();if(!t||typeof t!="object"){rs(e);return}let o=ts({...t,kind:e});if(!o)return;let i=ln(e),s=xr(e),a=an(o);a!=null&&(K(n,i,a),K(r,s,a))}function rs(e){let{local:t,session:n}=re(),r=ln(e),o=xr(e);K(t,r,null),K(n,o,null)}function os(e){let{local:t}=re(),n=Zi(e),r=yt(t,n);return Array.isArray(r)?r.map(o=>{var i,s,a;return{id:typeof(o==null?void 0:o.id)=="string"?o.id:String((o==null?void 0:o.id)||""),ts:Number((a=(s=(i=o==null?void 0:o.ts)!=null?i:o==null?void 0:o.timestamp)!=null?s:o==null?void 0:o.time)!=null?a:o==null?void 0:o.at)}}).filter(o=>o.id&&Number.isFinite(o.ts)):[]}function nu(e,t){let{local:n,session:r}=re(),o=Zi(e),i=Array.isArray(t)?t.map(a=>({id:a.id,ts:a.ts})):[],s=an(i);s!=null&&(K(n,o,s),K(r,`${o}${rt}`,s))}function cn(e){if(!e)return null;if(typeof e=="string")return e.trim()||null;if(typeof e=="number")return`#${e}`;if(e&&typeof e=="object"){if(e.poolId!=null)return String(e.poolId);if(e.poolEntryId!=null)return String(e.poolEntryId);if(e.heroId!=null)return String(e.heroId);if(e.cta&&e.cta.id!=null)return String(e.cta.id);if(e.ids&&typeof e.ids=="object"){if(e.ids.imdb)return`imdb:${e.ids.imdb}`;if(e.ids.tmdb)return`tmdb:${e.ids.tmdb}`;if(e.ids.tvdb)return`tvdb:${e.ids.tvdb}`}if(e.guid)return String(e.guid);if(e.ratingKey!=null)return`rk:${e.ratingKey}`;if(e.id!=null)return String(e.id);if(e.slug)return String(e.slug);if(e.key)return String(e.key);if(e.title){let t=e.year?`:${e.year}`:"";return`title:${e.title}${t}`}}return null}function ru(e){return cn(e)}function is(e,t,{timestamp:n=Ee(),limit:r=80}={}){let o=ru(t);if(!o)return null;let s=os(e).filter(l=>l.id!==o);s.unshift({id:o,ts:n});let a=s.filter(l=>n-l.ts<=12096e5).slice(0,Math.max(1,r));return nu(e,a),a}function _r(e,{now:t=Ee(),windowMs:n=12096e5,limit:r=80}={}){let o=os(e);if(!o.length)return{entries:[],set:new Set};let i=t-Math.max(0,n),s=new Set,a=[];for(let l of o)if(!(!l||!l.id)&&!(l.ts<i)&&!s.has(l.id)&&(s.add(l.id),a.push({id:l.id,ts:l.ts}),a.length>=r))break;return{entries:a,set:s}}function ss(e,t,{timestamp:n=Ee(),ttlMs:r=0,limit:o=120}={}){if(!Array.isArray(t)||!t.length)return[];let i=r>0?Math.max(0,n-r):0,s=Qi(e),a=new Set,l=[];for(let f of s)!f||!f.id||i&&f.ts<i||a.has(f.id)||(a.add(f.id),l.push(f));let u=[],c=new Set;for(let f of t){let y=cn(f);if(!y)continue;let T=typeof(f==null?void 0:f.slot)=="string"?f.slot:f!=null&&f.poolSlot?String(f.poolSlot):void 0;u.push({id:y,ts:n,slot:T}),c.add(y)}let d=l.filter(f=>!c.has(f.id)),h=[...u,...d].filter(f=>f&&f.id).slice(0,Math.max(1,o)),g=[],p=new Set;for(let f of h)p.has(f.id)||(p.add(f.id),g.push(f));return tu(e,g),g}function as(e,{now:t=Ee(),windowMs:n=0,limit:r=120}={}){let o=Qi(e);if(!o.length)return{entries:[],set:new Set};let i=n>0?Math.max(0,t-n):0,s=new Set,a=[];for(let l of o)if(!(!l||!l.id)&&!(i&&l.ts<i)&&!s.has(l.id)&&(s.add(l.id),a.push({id:l.id,ts:l.ts,slot:l.slot}),a.length>=r))break;return{entries:a,set:s}}function ls(e){let{local:t,session:n}=re(),r=Mr(e);K(t,r,null),K(n,`${r}${rt}`,null)}function cs(e,t,{timestamp:n=Ee(),ttlMs:r=0,limit:o=80,reason:i=""}={}){let s=cn(t);if(!s)return null;let a=r>0?Math.max(0,n-r):0,l=Lr(e),u=[],c=0;for(let h of l)if(!(!h||!h.id)){if(h.id===s){c=(h.hits||0)+1;continue}a&&h.ts<a||u.push(h)}let d={id:s,ts:n,reason:i||"",hits:c};u.unshift(d);let m=u.slice(0,Math.max(1,o));return es(e,m),d}function us(e,t){let n=cn(t);if(!n)return;let r=Lr(e),o=r.filter(i=>i&&i.id!==n);o.length!==r.length&&es(e,o)}function ds(e,{now:t=Ee(),windowMs:n=0,limit:r=80}={}){let o=Lr(e);if(!o.length)return{entries:[],set:new Set};let i=n>0?Math.max(0,t-n):0,s=new Set,a=[];for(let l of o)if(!(!l||!l.id)&&!(i&&l.ts<i)&&!s.has(l.id)&&(s.add(l.id),a.push({id:l.id,ts:l.ts,reason:l.reason||"",hits:l.hits||0}),a.length>=r))break;return{entries:a,set:s}}function fs(e){let{local:t,session:n}=re(),r=Fr(e);K(t,r,null),K(n,`${r}${rt}`,null)}var Yc,Xc,Jc,Zc,rt,un=x(()=>{Yc="heroPool:",Xc="heroHistory:",Jc="heroMemory:",Zc="heroFailures:",rt=":session"});function _e(){return Date.now()}function hn(...e){try{}catch{}}function ps(e){return e==="series"||e==="show"||e==="shows"?"series":"movies"}function cu(e,t){if(!e||typeof e!="object")return"";try{let r={poolSize:ps(t)==="series"?e.poolSizeSeries:e.poolSizeMovies,slots:e.slots,diversity:e.diversity,language:e.language||"en-US"};return JSON.stringify(r)}catch(n){return hn("Failed to compute policy signature:",(n==null?void 0:n.message)||n),""}}function it(e,t,n){return Math.min(n,Math.max(t,e))}function uu(e){if(!e)return 0;if(typeof e=="number"&&Number.isFinite(e))return e>1e12?Math.trunc(e):Math.trunc(e*1e3);if(typeof e=="string"){let t=Date.parse(e);if(Number.isFinite(t))return t}return 0}function du(e){if(!e)return null;let t=Number(e);if(Number.isFinite(t)&&t>1800&&t<2100)return Math.trunc(t);if(typeof e=="string"){let n=e.match(/(19|20|21)\d{2}/);if(n)return Number(n[0])}return null}function fu(e){let t=[],n=r=>{if(!r||typeof r!="string")return;let o=r.trim();if(!o)return;let i=o.replace(/\s+/g," ");t.includes(i)||t.push(i)};if(Array.isArray(e==null?void 0:e.genres)){for(let r of e.genres)if(r){if(typeof r=="string"){n(r);continue}typeof r=="object"&&n(r.tag||r.title||r.label||r.name||"")}}if(Array.isArray(e==null?void 0:e.Genre))for(let r of e.Genre)n(typeof r=="string"?r:r==null?void 0:r.tag);return t.slice(0,3)}function hu(e){let t=[e==null?void 0:e.rating,e==null?void 0:e.audienceRating,e==null?void 0:e.userRating];for(let n of t){let r=Number(n);if(Number.isFinite(r)&&r>0)return it(Math.round(r*10)/10,0,10)}return null}function gu(e){let t=[e==null?void 0:e.ratingCount,e==null?void 0:e.audienceRatingCount,e==null?void 0:e.userRatingCount,e==null?void 0:e.viewCount];for(let n of t){let r=Number(n);if(Number.isFinite(r)&&r>=0)return Math.trunc(r)}return 0}function mu(e){if(!e||typeof e!="object")return null;if(e.heroId!=null)return String(e.heroId);if(e.ids&&typeof e.ids=="object"){if(e.ids.imdb)return`imdb:${e.ids.imdb}`;if(e.ids.tmdb)return`tmdb:${e.ids.tmdb}`;if(e.ids.tvdb)return`tvdb:${e.ids.tvdb}`}if(e.guid)return String(e.guid);if(e.ratingKey!=null)return`rk:${e.ratingKey}`;if(e.id!=null)return String(e.id);if(e.slug)return String(e.slug);if(e.key!=null){let t=typeof e.key=="string"?e.key.trim():String(e.key);if(t)return t}if(e.title){let t=e.year?`:${e.year}`:"";return`title:${e.title}${t}`}return null}function pu(e,t){let n={new:0,topRated:0,oldButGold:0,random:0},r=e,o=t&&typeof t=="object"?t:{};fn.forEach((s,a)=>{var c;if(a===fn.length-1){n[s]=Math.max(0,r),r=0;return}let l=Number((c=o[s])==null?void 0:c.quota);if(!Number.isFinite(l)||l<=0){n[s]=0;return}let u=Math.max(0,Math.round(e*it(l,0,1)));n[s]=Math.min(r,u),r-=n[s]});let i=0;for(;r>0;){let s=fn[i%fn.length];n[s]+=1,r-=1,i+=1}return n}function bu(e,t){let n=it(Number(t==null?void 0:t.genre)||.4,.1,.9),r=it(Number(t==null?void 0:t.year)||.35,.1,.9),o=Math.max(1,Math.round(e*it(n*.5,.1,.35))),i=Math.max(1,Math.round(e*it(r*.5,.1,.35)));return{perGenre:o,perYear:i}}function yu(e){if(!Array.isArray(e)||!e.length)return[];let t=_e(),n=new Set,r=[];for(let o of e){if(!o||typeof o!="object")continue;let i=mu(o);if(!i||n.has(i))continue;n.add(i);let s=uu(o.addedAt||o.createdAt||o.added),a=du(o.year||o.originallyAvailableAt),l=hu(o),u=gu(o),c=fu(o),d={id:i,raw:o,addedAt:s,year:a,rating:l!=null?l:0,voteCount:u,genres:c,isNew:s&&t-s<=iu,isOld:a?new Date().getUTCFullYear()-a>=su:!1};r.push(d)}return r}function vu(e){return e.slice().sort((t,n)=>(n.addedAt||0)-(t.addedAt||0))}function Eu(e){return e.slice().sort((t,n)=>{let r=Number.isFinite(t.rating)?t.rating:0,o=Number.isFinite(n.rating)?n.rating:0;if(o!==r)return o-r;let i=(n.voteCount||0)-(t.voteCount||0);return i!==0?i:(n.addedAt||0)-(t.addedAt||0)})}function Su(e){return e.slice().sort((t,n)=>{let r=t.year||0,o=n.year||0;if(r&&o&&r!==o)return r-o;let i=(n.rating||0)-(t.rating||0);return i!==0?i:(n.addedAt||0)-(t.addedAt||0)})}function Au(e){let t=e.slice();for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function gs(e,t){let{caps:n,genreCounts:r,yearCounts:o}=e;if(n.perGenre>0&&t.genres&&t.genres.length){for(let i of t.genres)if((r.get(i)||0)>=n.perGenre)return!1}return!(n.perYear>0&&t.year&&(o.get(t.year)||0)>=n.perYear)}function Pr(e,t,n){if(e.selected.push({...t,slot:n}),e.selectedIds.add(t.id),e.summary[n]=(e.summary[n]||0)+1,t.genres)for(let r of t.genres)e.genreCounts.set(r,(e.genreCounts.get(r)||0)+1);t.year&&e.yearCounts.set(t.year,(e.yearCounts.get(t.year)||0)+1)}function de(e,t,n,r,{allowHistory:o=!1,filter:i}={}){if(t<=0)return 0;let s=[],a=[],l=[];for(let c of e){if(r.selected.length>=r.poolSize||r.summary[n]>=t)break;if(!r.selectedIds.has(c.id)&&!(i&&!i(c))&&gs(r,c)){if(r.failureSet&&r.failureSet.has(c.id)){l.push(c);continue}if(r.memorySet&&r.memorySet.has(c.id)){a.push(c);continue}if(!o&&r.historySet&&r.historySet.has(c.id)){s.push(c);continue}Pr(r,c,n)}}if(r.summary[n]>=t||r.selected.length>=r.poolSize)return r.summary[n];let u=c=>{for(let d of c){if(r.selected.length>=r.poolSize||r.summary[n]>=t)break;r.selectedIds.has(d.id)||gs(r,d)&&Pr(r,d,n)}};return a.length&&u(a),r.summary[n]<t&&s.length&&u(s),r.summary[n]<t&&l.length&&u(l),r.summary[n]}function wu(e,t){for(let n of t){if(e.selected.length>=e.poolSize)break;e.selectedIds.has(n.id)||Pr(e,n,"random")}}function Et(e){let t={...e,timestamp:_e()};for(let n of lu)try{n(t)}catch(r){hn("Progress listener failed:",(r==null?void 0:r.message)||r)}try{typeof window!="undefined"&&typeof window.dispatchEvent=="function"&&typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent(ou,{detail:t}))}catch(n){hn("Failed to dispatch progress event:",(n==null?void 0:n.message)||n)}}async function Iu(e,t,n={}){let r=[],o=e.length,{settings:i,auth:s,authOptions:a,signal:l,disableTmdb:u,kind:c,failureTtlMs:d}=n;for(let m=0;m<e.length;m++){let h=e[m];Et({stage:"normalizing",index:m+1,total:o,slot:h.slot,id:h.id});let g=null,p="",f=!1;try{g=await Yi(h.raw,{language:t,settings:i,auth:s,authOptions:a,signal:l,disableTmdb:u})}catch(y){hn("Failed to normalize hero candidate:",(y==null?void 0:y.message)||y),p=(y==null?void 0:y.message)||"",(y==null?void 0:y.code)==="RATE_LIMIT"&&(f=!0)}if(!g){if(c&&!f)try{cs(c,h.raw||h,{timestamp:_e(),ttlMs:d,reason:p||"normalize"})}catch{}continue}if(c)try{us(c,h.raw||g)}catch{}g.slot=h.slot,g.poolSlot=h.slot,g.poolId=h.id,r.push(g)}return r}function ms(e,t,n,r,o,i){let s=Object.values(t).reduce((g,p)=>g+p,0),a={poolSize:s,caps:bu(s,n),selected:[],summary:{new:0,topRated:0,oldButGold:0,random:0},genreCounts:new Map,yearCounts:new Map,selectedIds:new Set,historySet:(r==null?void 0:r.set)||new Set,memorySet:(o==null?void 0:o.set)||new Set,failureSet:(i==null?void 0:i.set)||new Set},l=yu(e),u=vu(l),c=Eu(l),d=Su(l.filter(g=>g.isOld)),m=Au(l);de(u,t.new,"new",a,{allowHistory:!1,filter:g=>g.isNew}),de(u,t.new,"new",a,{allowHistory:!1}),de(u,t.new,"new",a,{allowHistory:!0}),de(c,t.topRated,"topRated",a,{allowHistory:!1}),de(c,t.topRated,"topRated",a,{allowHistory:!0}),de(d,t.oldButGold,"oldButGold",a,{allowHistory:!1}),de(d,t.oldButGold,"oldButGold",a,{allowHistory:!0});let h=m.filter(g=>!a.selectedIds.has(g.id));if(de(h,t.random,"random",a,{allowHistory:!1}),de(h,t.random,"random",a,{allowHistory:!0}),a.selected.length<s){let g=l.filter(p=>!a.selectedIds.has(p.id));wu(a,g)}return a}function Tu(e,t,n={}){let r=_e(),o=ot(e,{now:r,policyHash:t});if(!o||!Array.isArray(o.items)||!o.items.length)return null;if(o.isExpired){if(n.allowGrace){let{graceMs:i}=bt();if(i&&i>0&&o.expiresAt+i>r)return Et({stage:"cache",status:"grace",kind:e,size:o.items.length}),{...o,fromCache:!0}}return null}return Et({stage:"cache",status:"hit",kind:e,size:o.items.length}),{...o,fromCache:!0}}async function bs(e,t,n={}){let r=n.policy||Ze(),o=ps(e),i=cu(r,o),s=!n.force&&Tu(o,i,{allowGrace:!0});if(s)return s;if(n.force){try{ls(o)}catch{}try{fs(o)}catch{}}let a=o==="series"?r.poolSizeSeries:r.poolSizeMovies;if(!a||a<=0)return{items:[],summary:{},fromCache:!1,updatedAt:_e(),expiresAt:0};Et({stage:"start",kind:o,total:a});let l=pu(a,r.slots),u=bt(),c=_e(),d=(()=>{let w=Math.max(0,u.ttlMs||0)+Math.max(0,u.graceMs||0);return w>0?w:hs})(),m=_r(o,{windowMs:hs,limit:dn}),h=as(o,{now:c,windowMs:d,limit:Math.max(dn*2,a*2)}),g=ds(o,{now:c,windowMs:d}),p=ms(t,l,{...r.diversity,kind:o},m,h,g);if(p.selected.length<a&&m.entries.length){let w=_r(o,{windowMs:au,limit:dn});p=ms(t,l,{...r.diversity,kind:o},w,h,g)}let f=p.selected.slice(0,a),T=(await Iu(f,r.language||"en-US",{...n.tmdb,kind:o,failureTtlMs:d})).slice(0,a),C=_e(),M=C+(u.ttlMs||0),A={kind:o,items:T,updatedAt:C,expiresAt:M,policyHash:i,slotSummary:p.summary,meta:{plan:l,totalCandidates:(t==null?void 0:t.length)||0,selectionCount:T.length}};try{ss(o,T,{timestamp:C,ttlMs:d,limit:Math.max(dn*2,a*2)})}catch{}return ns(o,A),Et({stage:"done",kind:o,size:T.length,updatedAt:C}),{...A,fromCache:!1}}async function ys(e,t,n={}){return bs(e,t,n)}function vs(e,t,n={}){return bs(e,t,{...n,force:!0})}var ou,hs,dn,iu,su,au,fn,lu,Es=x(()=>{Xi();en();un();ou="hero:pool-progress",hs=1e3*60*60*24*7,dn=60,iu=1e3*60*60*24*90,su=12,au=1e3*60*60*24*30,fn=["new","topRated","oldButGold","random"],lu=new Set});function At(...e){try{}catch{}}function As(){return Date.now()}function mn(e){return e==="show"||e==="shows"||e==="series"?"series":"movies"}function xu(e,t){return e===t?!0:!e||!t?!1:e.active===t.active&&e.until===t.until&&e.retryAfterMs===t.retryAfterMs&&e.lastStatus===t.lastStatus&&e.strikes===t.strikes}function Mu(){if(Ss)return;try{E.tmdb.rateLimit={...Ki()}}catch{E.tmdb.rateLimit={active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}}Ss=Gi(t=>{let n=t?{...t}:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0};xu(E.tmdb.rateLimit,n)||(E.tmdb.rateLimit=n,Se())})}function ws(e){return{kind:e,state:"idle",regenerating:!1,size:0,updatedAt:0,expiresAt:0,fromCache:!1,source:"",policyHash:"",slotSummary:{},matchesPolicy:!0,isExpired:!1,lastError:null,lastRefresh:0}}function Is(e){if(!e)return null;let t={...e};return t.slotSummary=e.slotSummary?{...e.slotSummary}:{},t}function Fu(){if(typeof localStorage=="undefined")return null;try{let e=localStorage.getItem(ku);if(e==="1"||e==="0")return e}catch(e){At("Failed to read feature flag:",(e==null?void 0:e.message)||e)}return null}function Lu(e){let t=Fu();return t!=null?{enabled:t==="1",source:"localStorage"}:e&&typeof e.heroPipelineEnabled=="boolean"?{enabled:!!e.heroPipelineEnabled,source:"config.heroPipelineEnabled"}:e&&e.features&&typeof e.features.heroPipeline=="boolean"?{enabled:!!e.features.heroPipeline,source:"config.features.heroPipeline"}:{enabled:!0,source:"default"}}function wt(){return{enabled:E.enabled,featureSource:E.featureSource,ready:E.ready,activeKind:E.activeKind,tmdb:{allowed:E.tmdb.allowed,active:E.tmdb.active,rateLimit:E.tmdb.rateLimit?{...E.tmdb.rateLimit}:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}},status:{movies:Is(E.status.movies),series:Is(E.status.series)},pools:{movies:E.pools.movies.slice(),series:E.pools.series.slice()}}}function Se(){let e=wt();for(let t of Hr)try{t(e)}catch(n){At("Listener failed:",(n==null?void 0:n.message)||n)}try{typeof window!="undefined"&&typeof window.dispatchEvent=="function"&&typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent(Cu,{detail:e}))}catch(t){At("Failed to dispatch pipeline event:",(t==null?void 0:t.message)||t)}return e}function St(e,t){let n=mn(e),r=E.status[n];if(!r)return;let o={...t};o.slotSummary&&(o.slotSummary={...o.slotSummary}),E.status[n]={...r,...o}}function st(){if(!E.enabled){E.ready=!0;return}let t=["movies","series"].every(n=>{let r=E.status[n];return r?r.state==="ready"||r.state==="error"||r.state==="stale":!1});E.ready=t}function Ts(e){let t=mn(e),n=ot(t,{allowExpired:!0});n&&(E.pools[t]=Array.isArray(n.items)?n.items.slice():[],St(t,{state:n.isExpired?"stale":"ready",regenerating:!1,size:E.pools[t].length,updatedAt:Number(n.updatedAt)||0,expiresAt:Number(n.expiresAt)||0,fromCache:!0,source:n.source||"cache",policyHash:n.policyHash||"",slotSummary:n.slotSummary||{},matchesPolicy:n.matchesPolicy!==!1,isExpired:!!n.isExpired}))}function _u(){E.sources.movies||(E.sources.movies=[]),E.sources.series||(E.sources.series=[])}function Pu(){let e=Nt(),n=!(E.tmdb.allowed&&e),r={};if(E.cfg&&typeof E.cfg=="object"){let o=E.cfg.tmdbToken||E.cfg.tmdbApiKey;o&&(r.fallbackCredential=o)}return{disableTmdb:n,settings:E.cfg,authOptions:Object.keys(r).length?r:void 0}}async function Rr(e,{force:t=!1}={}){let n=mn(e);if(!E.enabled)return St(n,{state:"disabled",regenerating:!1}),st(),null;if(_u(),E.inFlight.has(n))return E.inFlight.get(n);let r=n==="series"?E.sources.series:E.sources.movies;St(n,{state:"loading",regenerating:!0,lastError:null}),Se();let o=t?vs:ys,i={policy:E.policy||void 0,tmdb:Pu()},s=o(n,r,i).then(a=>{let l=a||{},u=Array.isArray(l.items)?l.items.slice():[];return E.pools[n]=u,St(n,{state:(l.items,"ready"),regenerating:!1,size:u.length,updatedAt:Number(l.updatedAt)||As(),expiresAt:Number(l.expiresAt)||0,fromCache:!!l.fromCache,source:l.source||(l.fromCache?"cache":"fresh"),policyHash:l.policyHash||"",slotSummary:l.slotSummary||{},matchesPolicy:l.matchesPolicy!==!1,isExpired:!1,lastError:null,lastRefresh:As()}),st(),Se(),l}).catch(a=>{throw At("Failed to build hero pool for",n,(a==null?void 0:a.message)||a),St(n,{state:"error",regenerating:!1,lastError:(a==null?void 0:a.message)||String(a)}),st(),Se(),a}).finally(()=>{E.inFlight.delete(n)});return E.inFlight.set(n,s),s}function Hu(){let e=new Date,t=e.getUTCFullYear(),n=Date.UTC(t,0,1),r=Date.UTC(t,e.getUTCMonth(),e.getUTCDate()),o=Math.max(0,r-n);return Math.floor(o/(24*60*60*1e3))}function Ru(e,t){let n=String((e==null?void 0:e.poolId)||(e==null?void 0:e.id)||"").toLowerCase(),r=String((t==null?void 0:t.poolId)||(t==null?void 0:t.id)||"").toLowerCase();return n<r?-1:n>r?1:0}function Nu(e,t){var c,d;let n=mn(e),r=((c=t==null?void 0:t.pools)==null?void 0:c[n])||[];if(!Array.isArray(r)||!r.length)return{items:[],startIndex:0};let o=r.slice().sort(Ru),i=((d=t.status)==null?void 0:d[n])||{},s=i.updatedAt?Math.floor(Number(i.updatedAt)/(24*60*60*1e3)):0,a=n==="series"?7:0,l=Hu()+s+a,u=o.length?l%o.length:0;return{items:o,startIndex:u}}function ks({cfg:e,policy:t}={}){E.cfg=e||{},E.policy=t||null;let n=Lu(e);return E.enabled=!!n.enabled,E.featureSource=n.source,E.tmdb.allowed=!!(e!=null&&e.tmdbEnabled),E.tmdb.active=E.tmdb.allowed&&Nt(),Mu(),Ts("movies"),Ts("series"),st(),Se(),{enabled:E.enabled,source:E.featureSource}}function Cs({movies:e=[],shows:t=[]}={}){E.sources={movies:Array.isArray(e)?e:[],series:Array.isArray(t)?t:[]}}function pn(e){let t=e==="shows"||e==="series"?"series":"movies";E.activeKind!==t&&(E.activeKind=t,Se())}async function xs(e={}){if(!E.enabled)return st(),{skipped:!0};let n=(e.kinds||["movies","series"]).map(o=>Rr(o)),r=await Promise.allSettled(n);return st(),Se(),r}function Nr(e,t={}){return Rr(e,t)}function gn(e,t={}){return Rr(e,{...t,force:!0})}function Ms(){return E.enabled?Promise.all([gn("movies"),gn("series")]):Promise.resolve({skipped:!0})}function bn(e){let t=!!(E.tmdb.allowed&&Nt());E.tmdb.active!==t&&(E.tmdb.active=t,Se())}function se(){return!!E.enabled}function yn(){return!!E.ready}function Fs(){return wt()}function at(e){let t=wt();return{...Nu(e,t),snapshot:t}}function vn(e){if(typeof e!="function")return()=>{};Hr.add(e);try{e(wt())}catch(t){At("Initial listener invocation failed:",(t==null?void 0:t.message)||t)}return()=>Hr.delete(e)}function Ls(){let e=wt();return{enabled:e.enabled,featureSource:e.featureSource,ready:e.ready,tmdb:e.tmdb,status:e.status,poolSizes:{movies:e.pools.movies.length,series:e.pools.series.length}}}var ku,Cu,Hr,Ss,E,It=x(()=>{Es();un();be();Tr();ku="feature.heroPipeline",Cu="hero:pipeline-update",Hr=new Set,Ss=null,E={cfg:{},policy:null,enabled:!0,featureSource:"default",ready:!1,sources:{movies:[],series:[]},pools:{movies:[],series:[]},status:{movies:ws("movies"),series:ws("series")},tmdb:{allowed:!1,active:!1,rateLimit:{active:!1,until:0,retryAfterMs:0,lastStatus:null,strikes:0}},activeKind:"movies",inFlight:new Map}});function Ps(){let e=document.getElementById("openDebug");e&&e.addEventListener("click",()=>{$u()})}function $u(){var t,n,r,o;let e=document.getElementById("debugOverlay");e||(e=document.createElement("div"),e.id="debugOverlay",e.className="debug-overlay",e.innerHTML=`
      <div class="debug-dialog">
        <div class="debug-header"><h2>Debug</h2></div>
        <div class="debug-body">
          <pre id="debugPre" class="debug-pre"></pre>
          <div class="debug-cache-controls">
            <h3>Cache-Verwaltung</h3>
            <div id="cacheStats" class="cache-stats"></div>
            <div class="cache-buttons">
              <button id="debugClearExpired" class="btn">Abgelaufene l\xF6schen</button>
              <button id="debugClearAll" class="btn">Alles l\xF6schen</button>
            </div>
          </div>
        </div>
        <div class="debug-actions">
          <button id="debugCopy" class="btn">Copy report</button>
          <button id="debugClose" class="btn">Schlie\xDFen</button>
        </div>
      </div>`,document.body.append(e)),e.hidden=!1,$r(),e.addEventListener("click",i=>{i.target===e&&_s()}),(t=document.getElementById("debugClose"))==null||t.addEventListener("click",_s,{once:!0}),(n=document.getElementById("debugCopy"))==null||n.addEventListener("click",Bu,{once:!0}),(r=document.getElementById("debugClearExpired"))==null||r.addEventListener("click",()=>{Lt(),$r()},{once:!0}),(o=document.getElementById("debugClearAll"))==null||o.addEventListener("click",()=>{confirm("Wirklich den gesamten Cache l\xF6schen?")&&(oo(),$r())},{once:!0})}function _s(){let e=document.getElementById("debugOverlay");e&&(e.hidden=!0)}function $r(){var c,d,m,h,g,p,f,y;let e=document.getElementById("debugPre");if(!e)return;let t=k(),n=So(),r=t.cfg||{},o=Ln(),i=Ze(),s=Qt(),a=Ls(),l={view:t.view,counts:{movies:(t.movies||[]).length,shows:(t.shows||[]).length,filtered:(t.filtered||[]).length},dataSources:n,cache:o,heroPolicy:{policy:i,language:Mi(),pools:wi(),slots:Ii(),diversity:Ti(),rotation:ki(),textClamp:Ci(),fallback:xi(),cache:bt(),loadedAt:Fi(),issues:s},heroCache:a,tmdb:{enabled:!!r.tmdbEnabled,lang:r.lang,tokenPresent:!!(localStorage.getItem("tmdbToken")||r.tmdbApiKey)},useTmdbImages:localStorage.getItem("useTmdb")==="1",reduceMotion:localStorage.getItem("prefReduceMotion")==="1",locationHash:location.hash,userAgent:navigator.userAgent};e.textContent=JSON.stringify(l,null,2);let u=document.getElementById("cacheStats");if(u&&o){let T=((c=a==null?void 0:a.status)==null?void 0:c.movies)||{},C=((d=a==null?void 0:a.status)==null?void 0:d.series)||{},M=w=>{if(!Number.isFinite(w)||w<=0)return"n/a";try{return new Date(w).toLocaleString()}catch{return"n/a"}},A=a!=null&&a.enabled?`aktiv (Quelle: ${a.featureSource||"default"})`:`deaktiviert (Quelle: ${(a==null?void 0:a.featureSource)||"default"})`;u.innerHTML=`
      <p>Eintr\xE4ge gesamt: <strong>${o.totalEntries}</strong></p>
      <p>G\xFCltig: <strong>${o.validEntries}</strong> | Abgelaufen: <strong>${o.expiredEntries}</strong></p>
      <p>Gr\xF6\xDFe: <strong>${o.totalSizeMB} MB</strong></p>
      <p>Hero-Pipeline: <strong>${A}</strong></p>
      <p>Filme: <strong>${(g=(h=T.size)!=null?h:(m=a==null?void 0:a.poolSizes)==null?void 0:m.movies)!=null?g:0}</strong> Eintr\xE4ge \xB7 Update: <strong>${M(T.updatedAt)}</strong> \xB7 Ablauf: <strong>${M(T.expiresAt)}</strong></p>
      <p>Serien: <strong>${(y=(f=C.size)!=null?f:(p=a==null?void 0:a.poolSizes)==null?void 0:p.series)!=null?y:0}</strong> Eintr\xE4ge \xB7 Update: <strong>${M(C.updatedAt)}</strong> \xB7 Ablauf: <strong>${M(C.expiresAt)}</strong></p>
    `}}function Bu(){var n;let e=document.getElementById("debugPre");if(!e)return;let t=e.textContent||"";(n=navigator.clipboard)==null||n.writeText(t).catch(r=>{try{let o=document.createElement("textarea");o.value=t,document.body.append(o),o.select(),document.execCommand("copy"),o.remove()}catch{}})}var Hs=x(()=>{ee();Oe();_n();en();It()});function Ns(e){Br=typeof e=="function"?e:null}function $s(e){Or=typeof e=="function"?e:null}function Sn(e){if(Br)try{Br(e)}catch{}}function Du(e){if(Or)try{Or(e)}catch{}}function Bs(e){let t=document.getElementById("settingsOverlay"),n=t==null?void 0:t.querySelector(".settings-dialog"),r=document.getElementById("settingsBtn"),o=document.getElementById("openSettings"),i=document.getElementById("headerSettingsBtn"),s=document.getElementById("settingsClose2"),a=document.getElementById("tmdbTokenInput"),l=document.getElementById("tmdbSave"),u=document.getElementById("tmdbTest"),c=document.getElementById("tmdbStatus"),d=document.getElementById("tmdbClearCache"),m=document.getElementById("tmdbStatusBadge"),h=document.getElementById("prefReduceMotion"),g=document.getElementById("useTmdbSetting"),p=document.getElementById("resetFilters"),f=t==null?void 0:t.querySelector(".settings-body"),y=document.getElementById("heroCacheStatus"),T=document.getElementById("heroRefreshMovies"),C=document.getElementById("heroRefreshShows"),M=document.getElementById("heroRefreshAll");if(!y&&f){let b=document.createElement("div");b.className="settings-row",b.innerHTML=`
      <div class="settings-inline" id="heroRefreshControls">
        <button type="button" id="heroRefreshMovies" class="secondary">Highlights Filme aktualisieren</button>
        <button type="button" id="heroRefreshShows" class="secondary">Highlights Serien aktualisieren</button>
        <button type="button" id="heroRefreshAll" class="secondary">Alle Highlights aktualisieren</button>
      </div>
      <p class="settings-help" id="heroCacheStatus" aria-live="polite"></p>
    `,f.append(b),y=b.querySelector("#heroCacheStatus"),T=b.querySelector("#heroRefreshMovies"),C=b.querySelector("#heroRefreshShows"),M=b.querySelector("#heroRefreshAll")}let A=[T,C,M].filter(Boolean),w=null;function L(b,S){A.forEach(v=>{v&&(v.disabled=b||!se(),v.disabled&&S?v.dataset.heroBusy=S:v.removeAttribute("data-hero-busy"))})}function D(b){if(!Number.isFinite(b)||b<=0)return"unbekannt";try{return new Date(b).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit"})}catch{return"unbekannt"}}function N(b){if(!Number.isFinite(b)||b<=0)return"kein Ablauf";let S=b-Date.now();if(S<=0)return"abgelaufen";let v=S/6e4;if(v<1)return"l\xE4uft in <1 Min ab";if(v<60)return`l\xE4uft in ${Math.round(v)} Min ab`;let I=v/60;if(I<24)return`l\xE4uft in ${Math.round(I)} Std ab`;let H=I/24;return`l\xE4uft in ${Math.round(H)} Tg ab`}function G(b,S){if(!S)return`${b}: keine Daten`;if(S.state==="disabled")return`${b}: deaktiviert`;if(S.state==="loading"||S.regenerating)return`${b}: wird aktualisiert \u2026`;if(S.state==="error")return`${b}: Fehler (${S.lastError||"unbekannt"})`;if(S.state==="stale")return`${b}: ${S.size} Eintr\xE4ge (Cache abgelaufen)`;let v=D(S.updatedAt),I=N(S.expiresAt);return`${b}: ${S.size} Eintr\xE4ge (Update ${v}, ${I})`}function F(b){var I,H,He,Re,Ne,kt;if(!y)return;if(!b||!se()||b.enabled===!1){y.textContent="Hero-Pipeline deaktiviert \u2013 Legacy-Hero aktiv.",L(!0,"disabled");return}let S=!!((H=(I=b.status)==null?void 0:I.movies)!=null&&H.regenerating||(Re=(He=b.status)==null?void 0:He.series)!=null&&Re.regenerating);L(S,S?"busy":"");let v=[];v.push(G("Filme",(Ne=b.status)==null?void 0:Ne.movies)),v.push(G("Serien",(kt=b.status)==null?void 0:kt.series)),b.tmdb&&(b.tmdb.allowed?v.push(`TMDb ${b.tmdb.active?"aktiv":"aus (Toggle)"}`):v.push("TMDb deaktiviert")),b.featureSource&&v.push(`Feature-Flag: ${b.featureSource}`),y.textContent=v.join(" \u2022 ")}async function B(b="all",S="Highlights aktualisieren \u2026"){if(!se())return;if(w)try{await w}catch{}return y&&S&&(y.textContent=S),L(!0,"busy"),w=(b==="movies"||b==="series"?gn(b):Ms()).then(()=>{Sn()}).catch(I=>{}).finally(()=>{w=null,L(!1)}),w}vn(F),t&&t.hidden&&t.setAttribute("aria-hidden","true");let ae=null,U="",Ae=!1,he=new Map,An='a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])';function wn(){return t?Array.from(t.querySelectorAll(An)).filter(b=>!b.hasAttribute("disabled")&&b.getAttribute("aria-hidden")!=="true"):[]}function dt(){n&&typeof n.focus=="function"?n.focus({preventScroll:!0}):t&&typeof t.focus=="function"&&t.focus({preventScroll:!0})}function In(b){if(!t)return;let S=Array.from(document.body.children).filter(v=>v!==t);b?S.forEach(v=>{he.has(v)||he.set(v,{ariaHidden:v.hasAttribute("aria-hidden")?v.getAttribute("aria-hidden"):null,inert:v.hasAttribute("inert")}),v.setAttribute("aria-hidden","true"),v.setAttribute("inert","")}):(S.forEach(v=>{let I=he.get(v);I?(I.ariaHidden===null||I.ariaHidden===void 0?v.removeAttribute("aria-hidden"):v.setAttribute("aria-hidden",I.ariaHidden),I.inert?v.setAttribute("inert",""):v.removeAttribute("inert"),he.delete(v)):(v.removeAttribute("aria-hidden"),v.removeAttribute("inert"))}),he.clear())}function Tn(){!t||Ae||(Ae=!0,t.hidden=!1,t.setAttribute("aria-hidden","false"),ae=document.activeElement instanceof HTMLElement?document.activeElement:null,U=document.body.style.overflow,document.body.style.overflow="hidden",In(!0),ea(),requestAnimationFrame(dt))}function kn(){!t||!Ae||(Ae=!1,t.hidden=!0,t.setAttribute("aria-hidden","true"),In(!1),document.body.style.overflow=U,ae&&typeof ae.focus=="function"&&ae.focus(),ae=null)}function Qs(b){if(!Ae)return;if(b.key==="Escape"){b.preventDefault(),kn();return}if(b.key!=="Tab")return;let S=wn();if(!S.length){b.preventDefault(),dt();return}let v=S[0],I=S[S.length-1],H=document.activeElement;b.shiftKey?(H===v||!t.contains(H))&&(b.preventDefault(),I.focus()):H===I&&(b.preventDefault(),v.focus())}r&&r.addEventListener("click",Tn),o&&o.addEventListener("click",()=>{Tn()}),i&&i.addEventListener("click",Tn),s&&s.addEventListener("click",kn),t&&t.addEventListener("click",b=>{b.target===t&&kn()}),t&&t.addEventListener("keydown",Qs);function P(b="",S=""){if(c){c.textContent=b,c.dataset.kind=S,m&&(m.dataset.kind=S||"",m.title=b||"");try{if(S==="error"&&e&&e.tmdbApiKey){let v=String(localStorage.getItem("tmdbToken")||"").trim(),I=String((a==null?void 0:a.value)||"").trim();if(v&&I){try{localStorage.removeItem("tmdbToken")}catch{}a&&(a.value=""),ge(!0);let H="Ung\xFCltiger Token entfernt. Verwende API Key aus config.json.";c.textContent=H,c.dataset.kind="info",m&&(m.dataset.kind="info",m.title=H)}}}catch{}}}function ge(b){if(g&&(g.disabled=!b,g.title=g.disabled?"Nur verf\xFCgbar mit g\xFCltigem Token oder API Key.":"",!b&&g.checked)){try{localStorage.setItem("useTmdb","0")}catch{}g.checked=!1,W(k().view),Sn()}}function ea(){let b="";try{a&&(a.value=b=localStorage.getItem("tmdbToken")||"")}catch{}try{h&&(h.checked=localStorage.getItem("prefReduceMotion")==="1")}catch{}try{g&&(g.checked=localStorage.getItem("useTmdb")==="1",g.disabled=!b,g.title=g.disabled?"Nur verf\xFCgbar mit g\xFCltigem Token.":"")}catch{}try{ge(!!b||!!(e&&e.tmdbApiKey))}catch{}P("",""),b||P("Kein Token hinterlegt. TMDB ist deaktiviert.","info"),e!=null&&e.tmdbEnabled||P("Hinweis: TMDB in config.json deaktiviert (tmdbEnabled=false).","info"),b?(async()=>{var S;P("Pr\xFCfe Token...","pending");try{let v=await Promise.resolve().then(()=>(Fe(),Xe)),I=await((S=v.validateToken)==null?void 0:S.call(v,b));I&&I.ok?(ge(!0),I.as==="bearer"?P("Token g\xFCltig (v4 Bearer).","success"):I.as==="apikey"&&P('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success")):(ge(!1),(I==null?void 0:I.hint)==="looksV3"?P('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):P("Token ung\xFCltig oder keine Berechtigung (401).","error"))}catch{P("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}})():ge(!!(e&&e.tmdbApiKey))}T&&T.addEventListener("click",()=>{B("movies","Aktualisiere Film-Highlights \u2026")}),C&&C.addEventListener("click",()=>{B("series","Aktualisiere Serien-Highlights \u2026")}),M&&M.addEventListener("click",()=>{B("all","Aktualisiere alle Highlights \u2026")}),l&&l.addEventListener("click",async()=>{var S,v;let b=String((a==null?void 0:a.value)||"").trim();try{localStorage.setItem("tmdbToken",b)}catch{}if(!b){P("Kein Token hinterlegt. TMDB ist deaktiviert.","info"),ge(!!(e&&e.tmdbApiKey)),bn((S=g==null?void 0:g.checked)!=null?S:!1),B("all","Highlights aktualisieren (Token entfernt)\u2026");return}P("Pr\xFCfe Token...","pending");try{let I=await Promise.resolve().then(()=>(Fe(),Xe)),H=await((v=I.validateToken)==null?void 0:v.call(I,b));H&&H.ok?(ge(!0),H.as==="bearer"?P("Token g\xFCltig (v4 Bearer).","success"):H.as==="apikey"&&P('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success")):(ge(!1),(H==null?void 0:H.hint)==="looksV3"?P('Eingegebener Wert sieht wie ein v3 API Key aus. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):P("Token ung\xFCltig oder keine Berechtigung (401).","error"))}catch{P("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}bn(!0),B("all","Highlights aktualisieren (Token ge\xE4ndert)\u2026")}),u&&u.addEventListener("click",async()=>{var S;let b=String((a==null?void 0:a.value)||"").trim();if(!b){P("Bitte Token eingeben.","error");return}P("Pr\xFCfe Token...","pending");try{let v=await Promise.resolve().then(()=>(Fe(),Xe)),I=await((S=v.validateToken)==null?void 0:S.call(v,b));I&&I.ok?I.as==="bearer"?P("Token g\xFCltig (v4 Bearer).","success"):I.as==="apikey"&&P('API Key g\xFCltig (v3). Tipp: dauerhaft in site/config.json unter "tmdbApiKey" eintragen.',"success"):(I==null?void 0:I.hint)==="looksV3"?P('Eingegebener Wert sieht wie ein v3 API Key aus. Dieser funktioniert hier nicht als Bearer. Bitte in config.json als "tmdbApiKey" eintragen oder v4 Bearer Token verwenden.',"error"):P("Token ung\xFCltig oder keine Berechtigung (401).","error")}catch{P("Pr\xFCfung fehlgeschlagen. Netzwerk/Browser-Konsole pr\xFCfen.","error")}}),d&&d.addEventListener("click",()=>{Promise.resolve().then(()=>(Fe(),Xe)).then(b=>{var S;return(S=b.clearCache)==null?void 0:S.call(b)}),B("all","Highlights aktualisieren (TMDB-Cache geleert)\u2026")}),h&&h.addEventListener("change",()=>{try{localStorage.setItem("prefReduceMotion",h.checked?"1":"0")}catch{}Du(h.checked)}),g&&g.addEventListener("change",()=>{try{localStorage.setItem("useTmdb",g.checked?"1":"0")}catch{}g.checked&&!Rs&&(Rs=!0,Promise.resolve().then(()=>(Fe(),Xe)).then(b=>{var v;let S=k();(v=b.hydrateOptional)==null||v.call(b,S.movies,S.shows,S.cfg)}).catch(b=>{}),setTimeout(()=>{g.checked&&W(k().view)},1200),setTimeout(()=>{g.checked&&W(k().view)},3e3)),bn(!0),W(k().view),Sn()}),p&&p.addEventListener("click",()=>{let b=document.getElementById("search");b&&(b.value="");let S=document.getElementById("q");S&&(S.value="");let v=document.getElementById("onlyNew");v&&(v.checked=!1);let I=document.getElementById("yearFrom"),H=document.getElementById("yearTo");I&&(I.value=""),H&&(H.value="");let He=document.getElementById("collectionFilter");He&&(He.value=""),document.querySelectorAll("#genreFilters .chip.active").forEach(Ne=>Ne.classList.remove("active"));let Re=document.getElementById("genreFilters");Re&&(Re.dataset.state="empty",Re.dataset.count="0"),Promise.resolve().then(()=>(mr(),gr)).then(Ne=>{let kt=Ne.applyFilters();W(k().view),Sn(kt)})})}var Br,Or,Rs,Os=x(()=>{ee();Vt();It();Br=null,Or=null,Rs=!1});function Gr(e){return lt=e||null,lt}function Gs(){var t,n,r,o,i,s,a,l;if(Dr)return Dr;let e={title:((n=(t=document.getElementById("heroTitle"))==null?void 0:t.textContent)==null?void 0:n.trim())||"",tagline:((o=(r=document.getElementById("heroTagline"))==null?void 0:r.textContent)==null?void 0:o.trim())||"",overview:((s=(i=document.getElementById("heroOverview"))==null?void 0:i.textContent)==null?void 0:s.trim())||"",cta:((l=(a=document.getElementById("heroCta"))==null?void 0:a.textContent)==null?void 0:l.trim())||""};return Dr=e,e}function Us(e){jr=typeof e=="function"?e:null}function qs(e="default",t={}){let n=document.getElementById("hero"),r=document.getElementById("heroTitle"),o=document.getElementById("heroTagline"),i=document.getElementById("heroOverview"),s=document.getElementById("heroCta"),a=document.getElementById("heroMeta"),l=document.getElementById("heroMetaPrimary"),u=document.getElementById("heroMetaSecondary"),c=document.getElementById("heroMetaTertiary"),d=document.getElementById("heroPicture"),m=document.getElementById("heroBackdropImage"),h=document.getElementById("heroBackdropLarge"),g=document.getElementById("heroBackdropMedium");if(!n||!r||!o||!i||!s||!a)return!1;let p=Gs(),f={...Ds.default,...Ds[e]||{},...t||{}};Gr(null),Kr=e,n.dataset.heroKind="fallback",n.dataset.heroId="",n.dataset.state="fallback",n.classList.remove("hero--has-media"),qr(d,m,h,g),r.textContent=f.title||p.title;let y=f.tagline||"";o.textContent=y||p.tagline,o.hidden=!y,o.dataset.taglinePaused="0",delete o.dataset.heroBound,o.classList.remove("is-fading");let T=f.overview||"";i.textContent=T,i.hidden=!T;let C=f.cta||p.cta||s.textContent||"Browse featured titles";s.textContent=C;let M=typeof f.ctaAction=="function"&&f.ctaEnabled===!0;return s.disabled=!M,s.setAttribute("aria-disabled",M?"false":"true"),M?(s.onclick=()=>{try{f.ctaAction()}catch{}},s.setAttribute("aria-label",f.ctaLabel||C)):(s.onclick=null,s.removeAttribute("aria-label")),a.hidden=!0,l&&(l.innerHTML=""),u&&(u.innerHTML=""),c&&(c.innerHTML=""),!0}function Pe(e){var M,A;let t=document.getElementById("hero"),n=document.getElementById("heroTitle"),r=document.getElementById("heroTagline"),o=document.getElementById("heroOverview"),i=document.getElementById("heroCta"),s=document.getElementById("heroMeta"),a=document.getElementById("heroMetaPrimary"),l=document.getElementById("heroMetaSecondary"),u=document.getElementById("heroMetaTertiary"),c=document.getElementById("heroPicture"),d=document.getElementById("heroBackdropImage"),m=document.getElementById("heroBackdropLarge"),h=document.getElementById("heroBackdropMedium");if(!t||!n||!r||!o||!i||!s)return;let g=Gs(),p=ju(e);if(!p){Gr(null),Kr=null,t.dataset.heroKind="",t.dataset.heroId="",t.dataset.state="empty",t.classList.remove("hero--has-media"),qr(c,d,m,h),n.textContent=g.title,r.textContent=g.tagline,r.hidden=!g.tagline,r.dataset.taglinePaused="0",delete r.dataset.heroBound,r.classList.remove("is-fading"),o.textContent=g.overview,o.hidden=!g.overview,i.textContent=g.cta||"View details",i.disabled=!0,i.setAttribute("aria-disabled","true"),i.removeAttribute("aria-label"),i.onclick=null,s.hidden=!0,a&&(a.innerHTML=""),l&&(l.innerHTML=""),u&&(u.innerHTML="");return}let f=Vs(p);if(!f)return Pe([]);Gr(f),Kr=null;let y=f.type==="tv"?"show":"movie",T=((M=f.cta)==null?void 0:M.id)||f.id||"";try{is(y==="show"?"series":"movies",f)}catch{}if(t.dataset.heroKind=y,t.dataset.heroId=T,t.dataset.state="ready",n.textContent=f.title||g.title,r){let w=f.tagline||"";r.textContent=w,r.hidden=!w,r.dataset.taglinePaused=w?"1":"0",w?r.dataset.heroBound="1":delete r.dataset.heroBound,r.classList.remove("is-fading")}if(o){let w=f.overview||"";o.textContent=w,o.hidden=!w}let C=((A=f.cta)==null?void 0:A.label)||(y==="show"?"View show details":"View movie details");i.textContent=C,i.disabled=!1,i.setAttribute("aria-disabled","false"),i.setAttribute("aria-label",f.title?`${C}: ${f.title}`:C),i.onclick=()=>sd(f),nd(a,l,u,s,f),od(t,c,d,m,h,f)}function ju(e){if(Array.isArray(e)&&e.length){let n=Ur(e);if(n.length)return zs(n)}let t=Gu();return t.length?zs(t):null}function Ur(e){if(!Array.isArray(e))return[];let t=[];return e.forEach(n=>{if(!Ku(n))return;let r=Vs(n);r&&t.push(r)}),t}function Ku(e){return!(!e||typeof e!="object"||e.isCollectionGroup||(typeof e.type=="string"?e.type.toLowerCase():"")==="collection")}function zs(e){if(e.length===1)return e[0];let t=Math.floor(Math.random()*e.length),n=e[t];return lt&&e.length>1&&n&&lt&&n.id===lt.id&&e.find(o=>o&&o.id!==lt.id)||n}function Gu(){let e=k(),t=e.view==="shows"?"series":"movies",n=ot(t,{allowExpired:!0})||null,r=Array.isArray(n==null?void 0:n.items)?Ur(n.items):[];if(r.length)return r;let i=(Array.isArray(e.filtered)&&e.filtered.length?e.filtered:null)||(t==="series"?e.shows:e.movies)||[];return Ur(i)}function Vs(e){return!e||typeof e!="object"?null:Uu(e)?{...e,cta:e.cta?{...e.cta}:null}:qu(e)}function Uu(e){var n;if(!e||typeof e!="object")return!1;let t=((n=e==null?void 0:e.cta)==null?void 0:n.id)||(e==null?void 0:e.heroId);return!!(e.title&&t)}function qu(e){if(!e||typeof e!="object")return null;let t=e.type==="tv"?"tv":"movie",n=String(e.title||e.name||"").trim();if(!n)return null;let r=Vu(e),o=r.tmdb||r.imdb||r.ratingKey||"";if(!o)return null;let i=Wu(e),s=Yu(e,t),a=Xu(e),l=Ju(e),u=Zu(e),c=Qu(e),d=ed(e),m=td(e),h={id:o,kind:t==="tv"?"show":"movie",label:t==="tv"?"View show details":"View movie details",target:`#/${t==="tv"?"show":"movie"}/${o}`};return{id:r.ratingKey||`${t}-${o}`,type:t,title:n,tagline:d,overview:c,year:i,runtime:s,rating:a,genres:l,certification:u,cta:h,ids:r,backdrops:m}}function Vu(e){let t={};return e!=null&&e.ids&&typeof e.ids=="object"&&(e.ids.tmdb&&(t.tmdb=String(e.ids.tmdb)),e.ids.imdb&&(t.imdb=String(e.ids.imdb)),e.ids.tvdb&&(t.tvdb=String(e.ids.tvdb))),(e==null?void 0:e.ratingKey)!=null&&(t.ratingKey=String(e.ratingKey)),e!=null&&e.guid&&(t.guid=String(e.guid)),t}function Wu(e){let t=O(e);return t?Number(t):null}function Yu(e,t){var r,o;let n=(o=(r=e==null?void 0:e.runtimeMin)!=null?r:e==null?void 0:e.durationMin)!=null?o:e!=null&&e.duration?Math.round(Number(e.duration)/6e4):null;return!Number.isFinite(n)||n<=0?null:Math.max(1,Math.round(n))}function Xu(e){var n;let t=Number((n=e==null?void 0:e.rating)!=null?n:e==null?void 0:e.audienceRating);return Number.isFinite(t)?t:null}function Ju(e){let t=Array.isArray(e==null?void 0:e.genres)?e.genres:[],n=[];return t.forEach(r=>{if(!r)return;if(typeof r=="string"){let i=r.trim();i&&n.push(i);return}let o=r.tag||r.title||r.name||r.label||"";o&&n.push(o)}),Array.from(new Set(n))}function Zu(e){let t=typeof(e==null?void 0:e.contentRating)=="string"?e.contentRating.trim():"";if(!t)return"";let n=t.split("/"),r=n[n.length-1];return r?r.trim():t}function Qu(e){let t=[e==null?void 0:e.summary,e==null?void 0:e.plot,e==null?void 0:e.description,e==null?void 0:e.tagline];for(let n of t){if(typeof n!="string")continue;let r=n.trim();if(r)return r}return""}function ed(e){let t=[e==null?void 0:e.tagline];for(let n of t){if(typeof n!="string")continue;let r=n.trim();if(r)return r}return""}function td(e){var i,s,a,l,u;let t=je(),n=[(i=e==null?void 0:e.tmdb)==null?void 0:i.backdrop,(s=e==null?void 0:e.tmdb)==null?void 0:s.backdrop_path,(a=e==null?void 0:e.tmdb)==null?void 0:a.backdropPath,(l=e==null?void 0:e.tmdb)==null?void 0:l.background,(u=e==null?void 0:e.tmdb)==null?void 0:u.art],r=[e==null?void 0:e.art,e==null?void 0:e.background,e==null?void 0:e.thumbBackground,e==null?void 0:e.coverArt,e==null?void 0:e.thumb,e==null?void 0:e.thumbFile],o=[];return t&&n.forEach(c=>{let d=js(c,!0);d&&!o.includes(d)&&o.push(d)}),r.forEach(c=>{let d=js(c,!1);d&&!o.includes(d)&&o.push(d)}),o}function js(e,t){if(typeof e!="string")return"";let n=e.trim();return n?n.startsWith("http")?n:n.startsWith("/")&&t&&!n.startsWith("/library/")?`https://image.tmdb.org/t/p/original${n}`:n:""}function nd(e,t,n,r,o){let i=rd(o),[s=[],a=[],l=[]]=i;zr(e,s),zr(t,a),zr(n,l);let u=s.length||a.length||l.length;r.hidden=!u}function rd(e){let t=[],n=[];if(Number.isFinite(e.year)&&n.push({text:String(e.year),label:"Release year"}),Number.isFinite(e.runtime)){let i=e.type==="tv"?`${e.runtime} min/ep`:id(e.runtime);n.push({text:i,label:e.type==="tv"?"Episode runtime":"Runtime"})}e.certification&&n.push({text:e.certification,label:"Certification",kind:"certification"}),n.length&&t.push(n);let r=[];if(e.rating!=null){let i=J(e.rating);r.push({text:`\u2605 ${i}`,label:`Average rating ${i} out of 10`,kind:"rating"})}if(e.voteCount!=null){let i=zu.format(e.voteCount);r.push({text:`${i} votes`,label:`${i} votes recorded`})}if(e.type==="tv"){let i=[];Number.isFinite(e.seasons)&&e.seasons>0&&i.push(`${e.seasons} ${e.seasons===1?"Season":"Seasons"}`),Number.isFinite(e.episodes)&&e.episodes>0&&i.push(`${e.episodes} ${e.episodes===1?"Episode":"Episodes"}`),i.length&&r.push({text:i.join(" \u2022 "),label:"Episode availability"})}r.length&&t.push(r);let o=[];return Array.isArray(e.genres)&&e.genres.slice(0,3).forEach(i=>{let s=typeof i=="string"?i:"";s&&o.push({text:s,label:`Genre: ${s}`})}),o.length&&t.push(o),t}function zr(e,t){if(!e)return;if(!t||!t.length){e.innerHTML="",e.hidden=!0;return}let n=document.createDocumentFragment();t.forEach(r=>{let o=document.createElement("span");o.className="hero__badge",r.kind==="certification"&&o.classList.add("hero__badge--certification"),r.kind==="rating"&&o.classList.add("hero__badge--rating"),o.textContent=r.text,r.label&&o.setAttribute("aria-label",r.label),n.appendChild(o)}),e.replaceChildren(n),e.hidden=!1}function od(e,t,n,r,o,i){let a=(Array.isArray(i.backdrops)?i.backdrops.filter(Boolean):[])[0]||"";if(!t||!n){e.classList.toggle("hero--has-media",!!a);return}if(!a){qr(t,n,r,o),e.classList.remove("hero--has-media");return}e.classList.add("hero--has-media"),Ks(r,a),Ks(o,a),n.src=a,n.alt=i.title?`${i.title} backdrop`:"",n.removeAttribute("hidden"),t.hidden=!1}function Ks(e,t){e&&(t?e.srcset=t:e.removeAttribute("srcset"))}function qr(e,t,n,r){n&&n.removeAttribute("srcset"),r&&r.removeAttribute("srcset"),t&&(t.removeAttribute("src"),t.setAttribute("hidden","")),e&&(e.hidden=!0)}function id(e){if(!Number.isFinite(e)||e<=0)return"";let t=Math.floor(e/60),n=Math.round(e%60);return t&&n?`${t}h ${n}m`:t?`${t}h`:`${n}m`}function sd(e){let t=e==null?void 0:e.cta,n=(t==null?void 0:t.kind)||(e.type==="tv"?"show":"movie"),r=(t==null?void 0:t.id)||e.id;!n||!r||(ad(n,r,t==null?void 0:t.target),n==="show"?Ve(r):qe(r))}function ad(e,t,n){if(!e||!t)return;let r=n||`#/${e}/${t}`,o=(window.location.hash||"")===r;if(typeof jr=="function")try{jr(r,{silent:!0,replace:o});return}catch{}try{window.location.hash=r}catch{}}var zu,lt,Dr,jr,Kr,Ds,Vr=x(()=>{ee();jt();be();un();zu=typeof Intl!="undefined"?new Intl.NumberFormat("en-US"):{format:e=>String(e)},lt=null,Dr=null,jr=null,Kr=null,Ds={default:{title:"Highlights temporarily unavailable",tagline:"TMDb data could not be loaded just now.",overview:"The hero banner falls back to a neutral gradient until artwork and metadata are available again. Feel free to keep browsing and refresh later."},"rate-limit":{title:"Highlights are catching their breath",tagline:"TMDb is currently rate limiting our artwork requests.",overview:"We are slowing down hero generation until the limit resets. Your library stays accessible in the meantime."},error:{title:"Highlights paused",tagline:"Fresh TMDb data is temporarily unavailable.",overview:"We will automatically retry fetching artwork. You can also trigger a manual refresh from the settings when you are ready."}}});function Ws({onRefresh:e=Pe}={}){let t=document.getElementById("hero"),n=document.getElementById("heroTimer"),r=n?n.querySelector(".hero-timer__bar"):null;if(!t||!n||!r)return null;if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return n.hidden=!0,null;n.removeAttribute("aria-hidden"),n.dataset.state="running";let i=15e3,s=new Set,a=!1,l=0,u=null,c=0,d=se(),m=C(),h=[],g=0,p=!1,f="",y=null,T=null;d&&(D(at(m)),y=vn(()=>{D(at(m))})),T=Zr(()=>{let F=C();F!==m&&(m=F,d&&D(at(m)))});function C(){return k().view==="shows"?"series":"movies"}function M(){return s.size>0}function A(){let F=M();n.dataset.state=F?"paused":"running",a&&!F&&(c=0),a=F}function w(F,B){B?s.add(F):s.delete(F),A()}function L(){return h.length?(g=(g+1)%h.length,h[g]):null}function D(F){var dt;if(!F)return;let B=Array.isArray(F.items)?F.items:[],U=(dt=(F.snapshot||Fs()).status)==null?void 0:dt[m],Ae=!yn()||(U==null?void 0:U.regenerating),he=`${m}:${(U==null?void 0:U.updatedAt)||0}:${B.length}`,An=h.length>0,wn=p;if(h=B,g=B.length?F.startIndex%B.length:0,p=Ae||!B.length,w("pipeline",p),!p&&B.length&&(!An||wn||f!==he)){try{e==null||e([B[g]])}catch{}l=0,r.style.setProperty("--p","0")}f=he}function N(F){if(M()){c=F,u=requestAnimationFrame(N);return}c||(c=F);let B=Math.max(0,F-c);c=F,l+=B;let ae=Math.max(0,Math.min(1,l/i));if(r.style.setProperty("--p",String(ae)),ae>=1){l=0,c=F,r.style.setProperty("--p","0");try{if(d){let U=L();U?e==null||e([U]):e==null||e()}else e==null||e()}catch{}}u=requestAnimationFrame(N)}function G(){u||(u=requestAnimationFrame(N))}return t.addEventListener("mouseenter",()=>{w("hover",!0)}),t.addEventListener("mouseleave",()=>{w("hover",!1)}),document.addEventListener("visibilitychange",()=>{w("hidden",document.hidden)}),document.hidden?w("hidden",!0):A(),G(),{pause(){w("manual",!0)},resume(){w("manual",!1)},reset(){l=0,r.style.setProperty("--p","0")},destroy(){y&&y(),T&&T()}}}var Ys=x(()=>{Vr();ee();It()});function ld(e,t){if(Tt.reason===e)return;Tt.reason=e;let n=Xs[e]||Xs.default;try{n(t)}catch{}}function fe(e){var t,n,r,o;if(Array.isArray(e)&&e.length){Tt.reason=null,Pe(e);return}if(se()){let i=k().view==="shows"?"series":"movies",s=at(i),a=(n=(t=s==null?void 0:s.snapshot)==null?void 0:t.status)==null?void 0:n[i],l=yn(),u=a==null?void 0:a.regenerating,c=Array.isArray(s==null?void 0:s.items)?s.items:[],d=(o=(r=s==null?void 0:s.snapshot)==null?void 0:r.tmdb)==null?void 0:o.rateLimit,m=!!(d!=null&&d.active),h=(a==null?void 0:a.state)==="error";if(!c.length&&(h||m&&l&&!u)){let p=h?"error":"rate-limit";qs(p)&&ld(p,{status:a,rateLimit:d});return}if(l&&!u&&c.length){let p=s.startIndex%c.length,f=c[p];if(f){Tt.reason=null,Pe([f]);return}}}Tt.reason=null,Pe(e)}function ut(e,t=!0){let n=document.getElementById("footerMeta");if(n){let o=n.querySelector("#footerStatus");o?o.textContent=e:n.textContent=e,n.dataset.state=t?"loading":"ready"}let r=document.getElementById("grid");r&&r.setAttribute("aria-busy",t?"true":"false")}async function cd(){let e=!!globalThis.__PLEX_TEST_MODE__;ht(),hd(),Qr(),ut("Initialisiere \u2026",!0),Ie("Initialisiere \u2026",8),eo(18);let t=fetch("config.json").then(a=>a.json()).catch(a=>(V("Konfiguration konnte nicht geladen werden","Verwende Standardeinstellungen"),{startView:"movies",tmdbEnabled:!1})),n=Ai().catch(a=>Ze()),[r,o]=await Promise.all([t,n]),i=ks({cfg:r,policy:o});we({cfg:r,view:r.startView||"movies",heroPolicy:o,heroPolicyIssues:Qt(),heroPipelineEnabled:i.enabled,heroPipelineSource:i.source});try{ut("Filme laden \u2026",!0),Ie("Filme laden \u2026",25);let a=await yo();ut("Serien laden \u2026",!0),Ie("Serien laden \u2026",45);let l=await vo();ut("Filter vorbereiten \u2026",!0),Ie("Filter vorbereiten \u2026",60);let u=ur(a,l);if(we({movies:a,shows:l,facets:u}),Cs({movies:a,shows:l}),pn(k().view),se()){ut("Highlights vorbereiten \u2026",!0),Ie("Highlights vorbereiten \u2026",70);try{await xs()}catch{}}ut("Ansicht aufbauen \u2026",!0),Ie("Ansicht aufbauen \u2026",85),Fn(),Xr(),dr(u),hr();let c=We();if(dd(!0),W(k().view),fd(),Ft(),r.tmdbEnabled&&(window.requestIdleCallback?window.requestIdleCallback(()=>{var d;return(d=Jt)==null?void 0:d(a,l,r)},{timeout:600}):setTimeout(()=>{var d;return(d=Jt)==null?void 0:d(a,l,r)},400)),!e)xo(),Bs(r),gd(),md(),pd(),bd(),yd(),fe(c),Ws({onRefresh:fe}),Ps();else try{fe(c)}catch{}Zs(!0)}catch(a){throw Ft(),Fn(),Nn("Fehler beim Laden der Daten",()=>window.location.reload()),a}let s;window.addEventListener("tmdb:chunk",()=>{s||(s=requestAnimationFrame(()=>{s=null;try{localStorage.getItem("useTmdb")==="1"&&W(k().view),fe()}catch{}}))}),window.addEventListener("tmdb:done",()=>{try{localStorage.getItem("useTmdb")==="1"&&W(k().view),fe()}catch{}})}function ud(e){if(/^#\/(movies|shows)$/.test(e)){let s=e.includes("shows")?"shows":"movies";we({view:s}),pn(s),Nr(s==="shows"?"series":"movies").catch(l=>{});let a=We();return Xr(),W(s),fe(a),!0}let t=e.match(/^#\/(movie|show)\/(.+)/);if(!t)return!1;let[,n,r]=t,i=((n==="movie"?k().movies:k().shows)||[]).find(s=>{var a,l;return((a=s==null?void 0:s.ids)==null?void 0:a.imdb)===r||((l=s==null?void 0:s.ids)==null?void 0:l.tmdb)===r||String(s==null?void 0:s.ratingKey)===r});return i?(n==="show"?Ve(i):qe(i),!0):!1}function Zs(e=!1){let t=window.location.hash||"";!e&&!Yr.shouldHandle(t)||(e&&Yr.markProcessed(t),ud(t))}function Xr(){let e=document.getElementById("libraryTabs");if(!e)return;let t=Array.from(e.querySelectorAll("[data-lib]")),n=k().view==="shows"?"shows":"movies";t.forEach(r=>{let o=r.dataset.lib==="series"?"shows":"movies",i=n===o;r.classList.toggle("is-active",i),r.setAttribute("aria-pressed",i?"true":"false"),r.dataset.bound!=="true"&&(r.addEventListener("click",()=>{let s=r.dataset.lib==="series"?"shows":"movies";if(k().view===s)return;if(we({view:s}),pn(s),se()){let u=Nr(s==="shows"?"series":"movies");u&&typeof u.catch=="function"&&u.catch(c=>{})}Wt(s==="movies"?"#/movies":"#/shows",{silent:!0}),Xr();let l=We();W(s),fe(l)}),r.dataset.bound="true")})}function dd(e=!1){let t=document.getElementById("heroStats");if(!t)return;let n=k(),r=(n.movies||[]).length,o=(n.shows||[]).length,i=t.querySelector('[data-stat="movies"]'),s=t.querySelector('[data-stat="shows"]');!i||!s||(e?(Js(i,r),Js(s,o)):(i.textContent=String(r),s.textContent=String(o)))}function Js(e,t){if(!e)return;let n=Number(e.textContent)||0,r=Number(t)||0;if(n===r){e.textContent=String(r);return}let o=480,i=performance.now();function s(a){let l=Math.min(1,(a-i)/o),u=Math.round(n+(r-n)*(l<.5?2*l*l:-1+(4-2*l)*l));e.textContent=String(u),l<1?requestAnimationFrame(s):e.textContent=String(r)}requestAnimationFrame(s)}function fd(){let e=document.getElementById("footerMeta");if(!e)return;let t=document.getElementById("footerStatus"),n=k(),r=n.movies||[],o=n.shows||[],i=r.concat(o).map(u=>new Date(u.addedAt||0).getTime()).filter(Number.isFinite),a=(i.length?new Date(Math.max(...i)):new Date).toISOString().slice(0,10);t&&(t.textContent=`Stand: ${a}`),e.dataset.state="ready";let l=document.getElementById("grid");l&&l.setAttribute("aria-busy","false")}function Jr(e){var t,n;try{let r=document.body;r?((t=document.documentElement)==null||t.classList.remove("reduce-motion","reduced-motion"),r.classList.remove("reduced-motion"),r.classList.toggle("reduce-motion",e)):((n=document.documentElement)==null||n.classList.toggle("reduce-motion",e),window.addEventListener("DOMContentLoaded",()=>Jr(e),{once:!0}))}catch{}}function hd(){try{let e=localStorage.getItem("prefReduceMotion")==="1";Jr(e)}catch{}}function gd(){let e=document.getElementById("toggleAdvanced"),t=document.getElementById("advancedFilters");if(!e||!t)return;let n=!1,r=0,o=()=>{n=!1,r&&(clearTimeout(r),r=0),t.dataset.state==="closing"?(t.dataset.state="closed",t.hidden=!0,t.style.removeProperty("--advanced-max")):t.dataset.state==="open"?t.style.removeProperty("--advanced-max"):t.dataset.state==="expanding"&&(t.dataset.state="open",t.style.removeProperty("--advanced-max"))},i=()=>{r&&clearTimeout(r),r=window.setTimeout(o,320)};t.addEventListener("transitionend",l=>{l.target!==t||l.propertyName!=="max-height"||o()});let s=()=>{n||(n=!0,t.hidden=!1,t.dataset.state="expanding",t.setAttribute("aria-hidden","false"),t.style.setProperty("--advanced-max","0px"),requestAnimationFrame(()=>{let l=t.scrollHeight;t.style.setProperty("--advanced-max",l+"px"),t.dataset.state="open",i()}))},a=()=>{if(n)return;n=!0;let l=t.scrollHeight;t.style.setProperty("--advanced-max",l+"px"),t.dataset.state="closing",t.setAttribute("aria-hidden","true"),requestAnimationFrame(()=>{t.style.setProperty("--advanced-max","0px"),i()})};e.addEventListener("click",()=>{e.getAttribute("aria-expanded")==="true"?(e.setAttribute("aria-expanded","false"),a()):(e.setAttribute("aria-expanded","true"),s())})}function md(){let e=document.getElementById("siteLogo");e&&e.addEventListener("error",()=>{e.classList.add("logo-missing");let i=document.querySelector(".site-header__brand-text .site-header__label");i&&i.classList.remove("sr-only")});let t=document.getElementById("heroTagline"),n=["Curated spotlights and smart filters for every mood.","Bring Plex highlights on the road with offline browsing.","Plan your next movie night with shareable watchlists."],r=0;t&&!t.textContent&&(t.textContent=n[r]);function o(){!t||t.dataset.taglinePaused==="1"||(t.classList.add("is-fading"),setTimeout(()=>{if(!t||t.dataset.taglinePaused==="1"){t&&t.classList.remove("is-fading");return}r=(r+1)%n.length,t.textContent=n[r],t.classList.remove("is-fading")},280))}t?(t.dataset.taglinePaused=t.dataset.taglinePaused==="1"?"1":"0",ct&&clearInterval(ct),ct=setInterval(o,6e3),setTimeout(o,3e3)):ct&&(clearInterval(ct),ct=null)}function pd(){let e=document.getElementById("scrollProgress");if(!e)return;let t=()=>{let n=document.documentElement.scrollTop||document.body.scrollTop||0,r=document.documentElement.scrollHeight-document.documentElement.clientHeight||1,o=Math.max(0,Math.min(100,n/r*100));e.style.width=o+"%"};addEventListener("scroll",t,{passive:!0}),t()}function bd(){let e=document.getElementById("scrollTop");if(!e)return;let t=()=>{let n=window.scrollY||0;e.style.display=n>300?"block":"none"};addEventListener("scroll",t,{passive:!0}),t(),e.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"}))}function yd(){let e=document.querySelector(".filters");if(!e||typeof CSS!="undefined"&&typeof CSS.supports=="function"&&CSS.supports("animation-timeline: scroll()"))return;let n=window.scrollY||window.pageYOffset||0,r=!1,o=!1,i=120,s=8,a=d=>{r!==d&&(r=d,e.classList.toggle("is-hidden",r))},l=()=>{o=!1;let d=window.scrollY||window.pageYOffset||0;if(d<=i){a(!1),n=d;return}let m=d-n;n=d,m>s?a(!0):m<-s&&a(!1)},u=()=>{o||(o=!0,requestAnimationFrame(l))};window.addEventListener("scroll",u,{passive:!0}),window.addEventListener("resize",l);let c=()=>a(!1);e.addEventListener("focusin",c),e.addEventListener("pointerenter",c,{passive:!0}),e.addEventListener("pointerdown",c,{passive:!0}),l()}var ct,Tt,Xs,Yr,Wt,Wr,mi=x(()=>{ee();to();Oe();mr();Vt();jt();Fe();Vn();Hs();_t();Os();Vr();Ys();en();It();ct=null,Tt={reason:null},Xs={"rate-limit":()=>V("TMDb drosselt Anfragen","Highlights werden kurzzeitig langsamer aktualisiert."),error:e=>{var t;return V("Highlights vor\xFCbergehend nicht verf\xFCgbar",((t=e==null?void 0:e.status)==null?void 0:t.lastError)||"TMDb-Daten konnten nicht geladen werden.")},default:()=>V("Highlights vor\xFCbergehend nicht verf\xFCgbar","TMDb-Daten konnten nicht geladen werden.")};Yr=(()=>{let e=window.location.hash||"",t=null;function n(s){if(typeof s!="string")return"";let a=s.trim();return a?a.startsWith("#")?a:`#${a}`:""}function r(s,a={}){let{replace:l=!1,silent:u=!1}=a,c=n(s);if(!c)return;let d=window.location.hash||"";if(c===d){if(l&&history&&typeof history.replaceState=="function")try{history.replaceState(null,"",c)}catch{}u&&(t=c,e=c);return}let m=l?"replaceState":"pushState",h=!1;try{history&&typeof history[m]=="function"&&(history[m](null,"",c),h=!0)}catch{}if(!h){window.location.hash=c,u&&(t=c,e=c);return}if(u){t=c,e=c;return}try{let g=typeof HashChangeEvent=="function"?new HashChangeEvent("hashchange"):new Event("hashchange");window.dispatchEvent(g)}catch{}}function o(s){let a=typeof s=="string"?s:"";return t&&a===t?(t=null,!1):(t=null,a===e?!1:(e=a,!0))}function i(s){e=typeof s=="string"?s:"",t=null}return{navigate:r,shouldHandle:o,markProcessed:i}})(),Wt=(e,t)=>Yr.navigate(e,t);Us(Wt);Wr=null;window.addEventListener("hashchange",()=>{Wr&&clearTimeout(Wr),Wr=setTimeout(()=>{Zs(!1)},50)});fr(e=>{try{fe(e)}catch{}});Ns(e=>{try{fe(e)}catch{}});$s(e=>{try{Jr(!!e)}catch{}});globalThis.__PLEX_TEST_MODE__||cd();window.addEventListener("load",()=>{try{Ft()}catch{}})});mi();export{cd as boot,Wt as navigateToHash};
//# sourceMappingURL=main.js.map
